{"version":3,"sources":["components/PhotoSeries/views/tags/XYTagChip.style.js","components/PhotoSeries/views/tags/XYTagChip.jsx","components/PhotoSeries/views/tags/XYTagSelect.jsx","components/PhotoSeries/views/tags/XYTagSelect.style.js","components/PhotoSeries/views/tags/XYTagChooser.jsx","components/PhotoSeries/views/tags/XYTagChooser.style.js","components/PhotoSeries/views/tags/useXYTags.js","components/PhotoSeries/views/subViews/Photo.jsx","components/PhotoSeries/views/subViews/Photo.style.js","lib/useComponentSize.js","config.js","lib/SeriesConfig.js","components/PhotoSeries/views/tags/TagChip.jsx","components/PhotoSeries/views/controls/ShortLongText.jsx","lib/Tags.js","components/maps/markers/Dot.jsx","components/maps/BaseStaticMap.jsx","components/maps/MapDot.jsx","mapStyles/index.js","lib/sensors.js","components/maps/controls/StyleButtons.jsx","components/PhotoSeries/views/dialogs/BigText.jsx","components/PhotoSeries/views/dialogs/DeleteDialog.jsx","components/PhotoSeries/views/dialogs/BigTextEdit.jsx","components/PhotoSeries/views/controls/PhotoFadeSlider.jsx","components/PhotoSeries/views/controls/TagControl.style.js","components/PhotoSeries/views/controls/TagView.jsx","components/PhotoSeries/views/controls/DateControl.jsx","components/PhotoSeries/views/controls/TagControl.jsx","components/PhotoSeries/views/dialogs/TagEdit.jsx","components/PhotoSeries/views/controls/DateView.jsx","components/PhotoSeries/views/subViews/PhotoInfoInner.jsx","components/maps/markers/MyLocation.jsx","components/maps/controls/MyLocationButton.jsx","components/maps/BaseMap.jsx","components/PhotoSeries/views/dialogs/MapDirPicker.jsx","components/PhotoSeries/views/subViews/SeriesEditInner.jsx","components/PhotoSeries/views/subViews/SeriesEditInner.style.js","components/PhotoSeries/views/subViews/PhotoGrid.jsx","components/PhotoSeries/views/subViews/PhotoGrid.style.js","components/PhotoSeries/views/NewPhoto.jsx","lib/Photo.js","lib/Series.js","lib/useCamera.js","components/PhotoSeries/views/CameraTool.jsx","components/PhotoSeries/views/CameraTool.style.js","components/PhotoSeries/views/PhotoReviewTool.jsx","components/PhotoSeries/views/PhotoReviewTool.style.js","components/PhotoSeries/views/NewPhotoInfo.jsx","components/PhotoSeries/views/NewPhotoInfo.style.js","lib/useFileInput.js","components/PhotoSeries/views/controls/LibraryFilePicker.jsx","lib/datelib.js","components/PhotoSeries/contexts.js","translations.js","graphql/queries.js","contexts.js","lib/useGraphQL.js","lib/ErrorBoundary.jsx","components/auth/auth.style.js","components/auth/useAuthCommon.js","components/auth/AuthContainer.jsx","components/auth/SignIn.jsx","components/auth/ConfirmSignIn.jsx","components/auth/RequireNewPassword.jsx","components/auth/SignUp.jsx","components/auth/Loading.jsx","components/auth/ConfirmSignUp.jsx","components/auth/ForgotPassword.jsx","lib/useAuthentication.js","lib/useShowAddToHome.js","redux/actions.js","redux/reducers/map.js","redux/reducers/home.js","redux/reducers/uploader.js","redux/reducers/index.js","redux/storeConfig.js","redux/withReduxProvider.js","components/UploadControl.jsx","lib/s3upload.js","graphql/Uploader.connect.js","permissions.js","graphql/mutations.js","components/PhotoSeries/views/controls/AddFab.jsx","components/PhotoSeries/views/controls/ContextMenu.jsx","components/PhotoSeries/views/subViews/SeriesInfo.jsx","components/PhotoSeries/views/subViews/SeriesInfo.style.js","components/PhotoSeries/views/subViews/SwipeShow.jsx","components/PhotoSeries/views/subViews/SwipeShow.style.js","components/PhotoSeries/views/SeriesView.jsx","components/PhotoSeries/views/SeriesView.style.js","components/PhotoSeries/views/SeriesEdit.jsx","components/PhotoSeries/views/SeriesEdit.style.js","components/PhotoSeries/views/Slideshow.jsx","components/PhotoSeries/views/Slideshow.style.js","components/PhotoSeries/views/dialogs/CancelConfirm.jsx","components/PhotoSeries/views/subViews/PhotoInfo.jsx","components/PhotoSeries/views/PhotoViewTool.jsx","components/PhotoSeries/views/PhotoViewTool.style.js","lib/AccessHelper.js","components/PhotoSeries/index.jsx","lib/localdb.js","graphql/Series.connect.js","lib/useClusteredData.js","components/maps/HomeMap.style.js","icons/AppLogo.jsx","components/TopBar.jsx","components/Search/SearchInput.jsx","components/misc/TinyChip.jsx","components/misc/SeriesListItem.jsx","components/misc/ClusterSelected.jsx","components/maps/markers/Single.jsx","components/maps/markers/Cluster.jsx","components/maps/HomeMap.jsx","graphql/Map.connect.js","components/Search/SearchContextItem.jsx","components/Search/SearchContextResults.jsx","components/Search/SearchResults.jsx","components/Search/SearchPlaceholder.jsx","lib/useOnline.js","components/Search/Search.jsx","graphql/Search.connect.js","components/MyProfile/MeCard.jsx","components/MyProfile/MyProfile.jsx","graphql/Profile.connect.js","components/misc/FindOnMapButton.jsx","components/MyFeed/FeedItem.jsx","components/MyFeed/MyFeed.jsx","graphql/Feed.connect.js","components/misc/OfflineBar.jsx","components/BottomBar.jsx","App.jsx","components/misc/ErrorScreen.jsx","App.connect.js","serviceWorker.js","index.js","lib/util.js"],"names":["tagChips","useStyles","makeStyles","theme","xyTagChip","cursor","color","fontSize","background","height","position","left","top","editing","reversedChip","flexDirection","right","deleteIcon","width","chipAvatarIcon","chipAvatar","reversedDelete","margin","concat","chipBucket","display","reversedChipBucket","XYTagChip","_ref","edit","tag","newSize","onTagDragOver","onTagDragStop","onTagDelete","onNewTag","props","Object","objectWithoutProperties","isReversed","relCoords","x","newWidth","classes","useTheme","stopBadness","e","preventDefault","stopPropagation","react_default","a","createElement","react_draggable_default","disabled","bounds","bottom","newHeight","y","onDrag","data","onStop","onClick","className","classNames","Chip","assign","style","palette","getContrastText","label","id","onDelete","Cancel_default","avatar","Avatar","MyLocation_default","root","noOptionsMessage","padding","spacing","singleValue","placeholder","input","valueContainer","flexWrap","flex","alignItems","overflow","paper","zIndex","marginTop","XYTagSelect","tagConfig","onChange","options","values","map","tc","value","console","log","allowAdditions","react_select_esm","components","Control","Menu","NoOptionsMessage","Option","Placeholder","ValueContainer","blurInputOnSelect","isClearable","isSearchable","Creatable_default","TextField","fullWidth","InputProps","inputComponent","inputProps","objectSpread","selectProps","inputRef","innerRef","children","innerProps","textFieldProps","_ref2","Typography","_ref3","Paper","square","_ref4","ref","_ref5","isFocused","isSelected","MenuItem","buttonRef","selected","component","fontWeight","_ref6","header","listItem","dlgBody","paddingLeft","paddingRight","paddingBottom","closeButton","grey","XYTagChooser","coords","open","seriesConfig","onClose","xyTags","tags","filter","t","allowXY","Dialog","scroll","fullScreen","paperScrollPaper","aria-labelledby","DialogTitle","IconButton","Close_default","length","variant","tagType","idx","key","tags_XYTagSelect","useXYTags","photo","setResizeActive","useContext","SeriesContext","_useState","useState","_useState2","slicedToArray","isDragging","setIsDragging","_useState3","_useState4","newTagDialog","setNewTagDialog","tagClass","Tags","addTag","__isNew__","createNewXYTagObj","createExistingXYTagObj","toConsumableArray","updateTagLocation","oldTag","newX","parseInt","multiplier","newY","onAddTagTrigger","pageX","window","innerWidth","pageY","innerHeight","TagChooser","tags_XYTagChooser","Boolean","getRelXYTags","inner","transform","img","formControl","Photo","opacity","showTags","transition","refImgWrap","useRef","setNewSize","url","setUrl","_useState5","_useState6","urlRetryCounter","setURLRetryCounter","useEffect","base64","current","newUrl","getPhotoUrl","getURL","_useComponentSize","useComponentSize","_useComponentSize$siz","size","urlWithRetries","_useXYTags","tags_XYTagChip","alt","onError","err","error","setTimeout","src","onLoad","event","_event$target","target","naturalHeight","naturalWidth","Math","min","getSize","el","minSize","defaultSize","max","offsetWidth","offsetHeight","resizeActiveRef","_Users_matt_Work_Git_PBR_PhotoMonitoring_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__","resizeActive","setComponentSize","handleResizeDebounced","useCallback","debounce","useLayoutEffect","ResizeObserver","resizeObserver","observe","disconnect","addEventListener","removeEventListener","__webpack_require__","d","__webpack_exports__","mapConfig","home","endpoints","localDb","aws","ACCESS","_mapStyles__WEBPACK_IMPORTED_MODULE_0__","tagColors","mapBoxToken","process","styles","MapStyles","baseurl","REACT_APP_BASEURL","AppStateTypes","FEED","MAP","SEARCH","PROFILE","SERIES","NEW_SERIES_CAMERA","NEW_SERIES_LIBRARY","SEARCH_TABS","TAG","LOCATION","USER","MapModeTypes","FREE","graphql","imgStore","Auth","region","userPoolId","userPoolWebClientId","mandatorySignIn","cookieStorage","domain","expires","secure","OPEN","description","PRIVATE","PUBLIC","TYPES","SeriesConfig","_this","this","_Users_matt_Work_Git_PBR_PhotoMonitoring_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_2__","getTagType","typeId","config","find","tt","getTagTypeIndex","findIndex","getXYTagTypes","getNonXYTagTypes","allowNonXY","getSeriesMeta","keys","meta","type","reduce","acc","_Users_matt_Work_Git_PBR_PhotoMonitoring_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__","_Users_matt_Work_Git_PBR_PhotoMonitoring_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_0__","default","getPhotoMeta","Error","marginRight","TagChip","_Users_matt_Work_Git_PBR_PhotoMonitoring_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_0__","react__WEBPACK_IMPORTED_MODULE_1___default","_material_ui_core_Chip__WEBPACK_IMPORTED_MODULE_2__","_material_ui_icons_Cancel__WEBPACK_IMPORTED_MODULE_3___default","react__WEBPACK_IMPORTED_MODULE_0__","react__WEBPACK_IMPORTED_MODULE_0___default","n","classnames__WEBPACK_IMPORTED_MODULE_1__","classnames__WEBPACK_IMPORTED_MODULE_1___default","_material_ui_core_Typography__WEBPACK_IMPORTED_MODULE_2__","_material_ui_core_FormLabel__WEBPACK_IMPORTED_MODULE_3__","_material_ui_core_styles__WEBPACK_IMPORTED_MODULE_4__","whiteSpace","&::before","content","ShortLongText","text","formLabel","defaultProps","_Users_matt_Work_Git_PBR_PhotoMonitoring_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_1__","findTagById","tagId","getXYTags","xyTagIds","indexOf","getNonXYTags","NonXYTagIds","createNewTagObj","uuid","createExistingTagObj","_Users_matt_Work_Git_PBR_PhotoMonitoring_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__","group","primary","main","textAlign","transformOrigin","rootActive","svgDot","dot","stroke","secondary","contrastText","strokeWidth","fill","directionIndicator","name","textShadow","nameActive","dark","Single","direction","version","viewBox","cx","cy","r","svgArc","fillOpacity","strokeOpacity","BaseStaticMap","controlPadding","viewport","mapStyles","onMapDataEvent","passthroughProps","mapRef","currStyle","setCurrStyle","projection","setProjection","recalcProjection","getDistanceScales","useMemo","esm","mapStyle","onData","mapboxApiAccessToken","StyleButtons","Array","isArray","c","handleChild","child","stylechooser","initStyle","MapDot","staticMap","editable","latitude","longitude","Map","BaseMap","mapProps","touchRotate","dragRotate","showMe","lockPan","onViewportChange","Dot","_Satellite_json__WEBPACK_IMPORTED_MODULE_0__","_TopoMap_json__WEBPACK_IMPORTED_MODULE_1__","_material_ui_icons__WEBPACK_IMPORTED_MODULE_2__","_material_ui_icons__WEBPACK_IMPORTED_MODULE_3__","_material_ui_icons__WEBPACK_IMPORTED_MODULE_4__","_material_ui_icons__WEBPACK_IMPORTED_MODULE_5__","toolTip","Icon","SatelliteOutlined","ActiveIcon","SatIcon","Satellite","TerrainOutlined","Terrain","TopoMap","useGeolocation","accuracy","altitude","altitudeAccuracy","heading","speed","timestamp","Date","now","state","setState","mountedRef","watchIdRef","onEvent","navigator","geolocation","getCurrentPosition","watchPosition","clearWatch","useDeviceOrientation","absolute","alpha","beta","gamma","deviceOrientation","setDeviceOrientation","handleDeviceOrientation","speedDialFab","border","speedDialAction","marginBottom","speedDialIcon","speedDialLabel","setOpen","noEventSetOpen","_material_ui_lab_SpeedDial__WEBPACK_IMPORTED_MODULE_2__","ariaLabel","speedDial","fab","icon","_material_ui_lab_SpeedDialAction__WEBPACK_IMPORTED_MODULE_3__","tooltipPlacement","ButtonProps","TooltipClasses","tooltip","tooltipTitle","tooltipOpen","_material_ui_core_Typography__WEBPACK_IMPORTED_MODULE_1__","_material_ui_core_DialogContent__WEBPACK_IMPORTED_MODULE_2__","_material_ui_core_Dialog__WEBPACK_IMPORTED_MODULE_3__","_material_ui_core_IconButton__WEBPACK_IMPORTED_MODULE_4__","_material_ui_core_DialogTitle__WEBPACK_IMPORTED_MODULE_5__","_material_ui_icons_Close__WEBPACK_IMPORTED_MODULE_6__","_material_ui_icons_Close__WEBPACK_IMPORTED_MODULE_6___default","_material_ui_core_styles__WEBPACK_IMPORTED_MODULE_7__","body","title","alignSelf","dlgTitle","flexGrow","BigText","maxWidth","disableTypography","_material_ui_core_Dialog__WEBPACK_IMPORTED_MODULE_1__","_material_ui_core_DialogTitle__WEBPACK_IMPORTED_MODULE_2__","_material_ui_core_DialogContent__WEBPACK_IMPORTED_MODULE_3__","_material_ui_core_Button__WEBPACK_IMPORTED_MODULE_4__","_material_ui_core_Typography__WEBPACK_IMPORTED_MODULE_5__","_material_ui_core_DialogActions__WEBPACK_IMPORTED_MODULE_6__","DeleteDialog","message","onConfirm","disableBackdropClick","disableEscapeKeyDown","BigTextEdit","onOk","multiline","setValue","_material_ui_core_DialogTitle__WEBPACK_IMPORTED_MODULE_7__","_material_ui_core_TextField__WEBPACK_IMPORTED_MODULE_5__","rows","rowsMax","defaultValue","_material_ui_core_DialogActions__WEBPACK_IMPORTED_MODULE_4__","_material_ui_core_Button__WEBPACK_IMPORTED_MODULE_6__","sliderLabel","container","track","thumb","PhotoFadeSlider","slider","setSlider","_material_ui_lab_Slider__WEBPACK_IMPORTED_MODULE_3__","vertical","TagControl_style","tagContainer","actionButtons","TagControl","tagValues","fieldTitle","rootEdit","textBody","DateControl","hint","timestampToHTML5Input","textField","HTML5InputToTimestamp","controls_TagControl","onSelectChange","inputValue","action","removedValue","option","val","newVal","tcv","newCreateVal","v","selectOptions","remainingTags","deleteRemoves","isMulti","onMouseDown","onTouchEnd","_ref7","_ref8","_ref9","dlgContent","overflowY","TagEdit","onCancel","DialogContent","field","DialogActions","Button","DateView","formatDate","dlgTitleContainer","catTagTitle","paddingTop","DIALOGS","PhotoInfo","canEdit","delta","_useState2$","activeDialog","activeDialogContext","setActiveDialog","tagInst","TagClass","metaKeys","JSON","parse","controls_DateControl","takenOn","controls_DateView","note","Divider","TagView","Fragment","List","list","ListItem","ListItemText","render","dialogs_TagEdit","svgAccuracyDot","MyLocation","accHeight","pixelsPerMeter","accWidth","MyLocationButton","Fab","aria-label","initViewport","lockToBounds","incomingOnViewportChange","incomingOnTransitionStart","onTransitionStart","incomingOnTransitionEnd","onTransitionEnd","transitions","mapContainerRef","mapBoxRef","innerTransitionsRef","defaultViewVals","setViewport","isTransitioning","setIsTransitioning","_useState7","_useState8","myPosition","geoMarker","markers_MyLocation","zoom","viewportChange","newViewport","getMap","_bounds","minlng","minlat","maxlng","maxlat","_fitBounds","WebMercatorViewport","fitBounds","offset","dragPan","React","cloneElement","hideNavControls","showZoom","touchZoom","scrollZoom","showCompass","controls_MyLocationButton","transitionDuration","transitionInterpolator","FlyToInterpolator","transitionEasing","easeCubic","bearing","pitch","mapWrapper","sliderWrapper","sliderRoor","MapDirPicker","initLat","initLong","initDir","setCoords","setRotation","_ref2$viewport","FormLabel","mapFormLabel","Slider","step","access","accessRadio","grow","marginLeft","mapInnerWrap","minHeight","minWidth","chips","SeriesEditInner","series","FormControlLabel","control","Switch","checked","dialogs_MapDirPicker","newNote","tile","addFab","notDeleteable","unSelectedTile","& img","selectedTile","snackbarContent","backgroundColor","red","snackbar","PhotoGrid","photos","columns","multiSelect","onTileClick","selectMode","setSelectMode","selectedItems","setSelectedItems","deleteConfirm","setDeleteConfirm","_useContext","ac","handleCancelSelection","toggleListItem","remaining","arrId","sortedPhotos","sort","b","GridList","cols","cellHeight","canDelete","canUser","photoUrl","GridListTile","handlePhotoTap","handleAddToSelection","Remove_default","Add_default","GridListTileBar","Snackbar","autoHideDuration","ContentProps","aria-describedby","confirmation","MODES","NewPhoto","inputMethod","onCreate","isNewSeries","_Users_matt_Work_Git_PBR_PhotoMonitoring_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_2__","newPhoto","setNewPhoto","SeriesClass","newSeries","setNewSeries","photoRefId","setPhotoRefId","history","mode","_changeMode","orientation","geo","changeMode","newModeName","_Users_matt_Work_Git_PBR_PhotoMonitoring_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__","react__WEBPACK_IMPORTED_MODULE_3___default","_CameraTool__WEBPACK_IMPORTED_MODULE_7__","onShutter","refId","photoInitObj","PhotoClass","exif","foundIdx","newData","slice","parser","exifParser","create","Buffer","from","stringify","rawData","orient","geolocate","_controls_LibraryFilePicker__WEBPACK_IMPORTED_MODULE_9__","onLibraryAdd","date","String","DateTimeOriginal","GPSLatitude","isNumeric","GPSLongitude","fullNewPhotoObject","_PhotoReviewTool__WEBPACK_IMPORTED_MODULE_6__","defaultRefPhotoId","captured","onRetry","oldHistory","oldMode","pop","_NewPhotoInfo__WEBPACK_IMPORTED_MODULE_8__","onSave","_Users_matt_Work_Git_PBR_PhotoMonitoring_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","setMeta","convertJSDatetoTimestamp","Series","Webcam","webcamElement","canvasElement","classCallCheck","location","protocol","hostname","warn","mediaDevices","getUserMedia","aspectRatio","srcObject","getTracks","stop","Promise","resolve","reject","undefined","audio","video","facingMode","then","mediaStream","URL","createObjectURL","onloadedmetadata","play","onplaying","catch","imageWidth","videoWidth","imageHeight","videoHeight","context","getContext","drawImage","_this2","_this$_drawImage","_drawImage","toBlob","blob","arguments","quality","_this$_drawImage2","toDataURL","cameraErrorText","disabledFab","cameraFab","@media (orientation: landscape)","@media (orientation: portrait)","cameraIcon","cancelFab","cancelIcon","swipeDrawer","libraryFab","myLocationFab","myLocationIcon","capturedContainer","referenceContainer","reference","CameraTool","newRefPhoto","p","refPhoto","setRefPhoto","drawerOpen","setDrawerOpen","_useCamera","onCapture","cameraError","setCameraError","cameraOnline","setCameraOnline","camRef","initCamera","document","getElementById","setup","captureImage","asyncToGenerator","regenerator_default","mark","_callee","capturedData","wrap","_context","prev","next","takeBase64Photo","apply","delayedOrientationChange","destroy","useCamera","CssBaseline","autoPlay","playsInline","muted","buttonFab","Camera_default","PhotoLibrary_default","libraryIcon","SwipeableDrawer","anchor","paperAnchorLeft","onOpen","tabIndex","swipeDrawerContainer","role","onKeyDown","referenceTextContainer","newText","refText","PhotoReviewTool","NewPhotoInfo","seriesDelta","setSeriesDelta","photoDelta","setPhotoDelta","PhotoInfoInner","newAttr","useFileInput","clickRef","element","handleChange","evt","file","files","reader","FileReader","onload","result","readAsDataURL","click","fileClickEl","forceClick","LibraryFilePicker","_useFileInput","formatDatAgo","moment__WEBPACK_IMPORTED_MODULE_0__","moment__WEBPACK_IMPORTED_MODULE_0___default","utctimestamp","format","moment","fromNow","jsDate","utc","isoStr","createContext","addLocaleData","frLocaleData","IntlWrapper","index_es","locale","allSeries","gql","_templateObject","pollQuery","_templateObject2","userSeries","_templateObject3","seriesFromList","_templateObject4","seriesWithTag","_templateObject5","tagSearch","_templateObject6","geoSeries","_templateObject7","getUser","_templateObject8","geocode","_templateObject9","getMyFeed","_templateObject10","userSearch","_templateObject11","getWholeSeries","_templateObject12","AppContext","LOCAL_STORAGE_TOKEN","ErrorBoundary","possibleConstructorReturn","getPrototypeOf","call","hasError","_this$state","FallbackUI","fallback","Component","auth_style","spacer","forgotPassword","switch","switchButton","&:last-child","borderRadius","&:first-child","phoneNumInner","phoneNumDropdown","noSignin","useAuthCommon","containerRef","handleKeyPress","found","getElementsByClassName","bgSwoosh","bgSwooshFill","light","AuthContainer","xmlns","preserveAspectRatio","SignIn","loading","handleSignup","handleForgotPassword","federated","handleInputChange","handleBeAnonymous","handleSignIn","auth_AuthContainer","autoFocus","autoComplete","Link","Toolbar","disableGutters","ConfirmSignIn","handleBack","handleConfirm","RequireNewPassword","change","requiredAttributes","placeholders","attribute","SignUp","signUpFields","signUpFieldLabels","signUpFieldPlaceholders","countryDialCodes","defaultDialCode","selectVal","setSelectVal","handleDialCodeChange","f","FormControl","InputLabel","htmlFor","shrink","required","Select","dialCode","Loading","ConfirmSignUp","handleResend","resendCode","ForgotPassword","handleSubmit","handleSendCode","sent","setSent","Amplify","configure","defaultAuthState","authState","authData","signedIn","lib_useAuthentication","setAuth","authScreen","dist","onStateChange","hideDefault","useAuthentication_SignIn","useAuthentication_Loading","useAuthentication_RequireNewPassword","useAuthentication_ConfirmSignIn","useAuthentication_ConfirmSignUp","useAuthentication_ForgotPassword","useAuthentication_SignUp","accessToken","signInUserSession","jwtToken","isGod","idToken","payload","signOut","forceSignIn","newProps","changeState","signIn","auth_SignIn","SignInOrig","hide","includes","checkCustomSignUpFields","signUpConfig","sortFields","getDefaultDialCode","I18n","get","signUp","auth_SignUp","SignUpOrig","_this3","confirm","auth_ConfirmSignIn","ConfirmSignInOrig","_this4","resend","auth_ConfirmSignUp","ConfirmSignUpOrig","challengeParam","split","part","charAt","toUpperCase","substr","toLowerCase","join","auth_RequireNewPassword","RequireNewPasswordOrig","auth_Loading","LoadingOrig","_this5","send","submit","auth_ForgotPassword","ForgotPasswordOrig","isIos","userAgent","test","useShowAddToHome","deferredPrompt","handleBeforePrompt","a2hsBtn","querySelector","addToHomeScreen","showAddToHomeScreen","prompt","userChoice","choiceResult","outcome","standalone","Actions","actions","newDomain","params","seriesId","initialPhoto","viewportSave","uploadObj","newProgress","mapInit","homeInit","initState","store","activeUpload","combineReducers","newStateHistory","activeSeries","newParams","uploader","newStore","newActive","persistConfig","storage","persistedReducer","persistReducer","rootReducer","storeConfig","preloadedState","createStore","compose","applyMiddleware","thunk","persistor","persistStore","withReduxProvider","BaseComponent","_storeConfig","es","integration_react","msgText","messageInner","UploadControl","progress","LinearProgress","UploadControlCOSMOSWrapper","useWrapperStyles","displayName","updateUploadProgress","completeActiveUpload","formData","FormData","preAuth","fields","forEach","fieldkey","append","dataURLtoFile","headers","Content-Type","onUploadProgress","progressEvent","loaded","total","floor","axios","post","stack","dataurl","filename","arr","mime","match","bstr","atob","u8arr","Uint8Array","charCodeAt","File","interceptors","request","use","response","connect","dispatch","uploadingRef","_x","_x2","_x3","_doUpload","s3Upload","components_UploadControl","permissions","admin","create:own","read:any","update:any","delete:any","create:any","nonuser","series_public","series_open","user","read:own","update:own","delete:own","deletePhoto","mutations_templateObject","deleteSeries","mutations_templateObject2","updateSeries","mutations_templateObject3","updatePhoto","mutations_templateObject4","createPhoto","mutations_templateObject5","createSeries","mutations_templateObject6","watchSeries","mutations_templateObject7","unWatchSeries","mutations_templateObject8","mixins","toolbar","directionUp","AddFab","onCameraClick","onLibraryClick","down","setDown","downRef","onDown","currentTarget","block","SpeedDial","onBlur","onTouchStart","SpeedDialAction","AddAPhoto_default","ContextMenu","anchorEl","menuItems","divider","ListItemIcon","primaryTypographyProps","tagListItem","chip","SeriesInfo","seriesConfigInst","SeriesConfigClass","newTags","existing","count","defineProperty","tagKey","idtk","subheading","photoWrapper","dateCaption","mobileStepper","manualBack","manualForward","tagButton","slideshowButton","dots","SwipeShow","onImageSelect","initPhotoIndex","activePhoto","setActivePhoto","setShowTags","singular","react_swipeable_views_lib_default","axis","index","onChangeIndex","enableMouseEvents","KeyboardArrowRight_default","KeyboardArrowLeft_default","subtitle","actionIcon","Badge","badgeContent","Label_default","MobileStepper","steps","activeStep","isFullScreen","slides","appBar","-webkit-overflow-scrolling","tabMenu","mapWrap","toolbarTitle","textOverflow","gridList","titleBar","menuButton","SeriesView","onSlideshowStart","onEditSeries","onDeletePhotos","onCameraAdd","onDeleteSeries","onMenuBack","onWatch","onUnWatch","watching","owned","contextEl","setContextEl","can","update","delete","contribute","listTypeTab","setListTypeTab","AppBar","ArrowBack_default","Slideshow_default","aria-haspopup","MoreVert_default","controls_ContextMenu","AddAlertIcon","EditIcon","DeleteIcon","Tabs","Tab","subViews_SwipeShow","subViews_SeriesInfo","controls_AddFab","SeriesEdit","setDelta","swipeAble","slideContainer","slide","dotActive","iconButton","active","last","labelBadge","tagChip","Slideshow","_useStepper","useStepper","lastStep","handleForward","paused","pause","showXYTags","setShowXYTags","duration","titlePosition","PlayCircleFilled_default","PauseCircleFilled_default","nextButton","backButton","num","interval","setActiveStep","setPaused","setLastStep","timerRef","createTimer","setInterval","oldStep","destroyTimer","clearInterval","CancelConfirm","dirty","newDelta","dialogs_CancelConfirm","appBarEdit","tipChip","activeButton","STATES","PhotoViewTool","initPhotoId","onUpdatePhoto","setMode","tagsClass","desired","onCommitTags","infoButton","Info_default","containerStyle","photoidx","subViews_PhotoInfo","AccessHelper","userSub","permissionObj","ownOrAny","obj","createdUser","isOwner","attrs","ownAny","perm","otherPerm","attributes","granted","AccessControl","sub","VIEW_ONLY_MODES","RepeatablePhotos","modeName","inputMethodINIT","currentUserId","currentUserRole","accessControl","onNewSeries","onChangePhoto","onNewPhoto","onDeletePhoto","AccesHelper","pid","ph","onApprovePhoto","onCreateSeries","_callee2","onNewSeriesReturn","_context2","newPid","newInputMethod","canUpdate","to","lastMode","views_SeriesView","photoIdArr","sp","views_SeriesEdit","views_PhotoViewTool","views_Slideshow","contexts","Provider","localUUID","openDb","upgradeDB","createObjectStore","prefix","uuidv4","withGetSelectedQuery","skip","variables","withUpdateSeriesMutation","_ref10","mutate","ownProps","updateSeriesMutation","sanitizeUpdateParams","optimisticResponse","__typename","_ref11","qdata","readQuery","query","writeQuery","qdataAll","limit","summary","seriesSummaries","s","withUpdatePhotoMutation","_ref12","updatePhotoMutation","sanitizedPhotoDelta","newT","_ref13","updatedPhoto","withDeleteSeriesDeleteMutation","_ref14","deleteSeriesMutation","_ref15","withDeletePhotoMutation","_ref16","deletePhotoMutation","photoId","_ref17","finalCount","photoCount","withCreateNewSeries","_ref18","createSeriesMutation","featured","_ref19","newAllSeriesEntry","push","withCreateNewPhoto","_ref20","createPhotoMutation","ext","newPhotoInput","createdOn","toString","username","Username","updatedBy","updatedOn","paths","large","orig","medium","_ref21","withWatchSeriesMutation","_ref22","watchSeriesMutation","_ref23","withUnWatchSeriesMutation","_ref24","unWatchSeriesMutation","_ref25","connectedWithApollo","onAfterSeriesDelete","onBack","queueUpload","doneCreatingSeries","currentUser","PhotoSeries","_len","_key","photoNoId","photoData","abrupt","_state$home$current","inputObj","desiredParams","newDesiredParams","remainder","useClusteredData","filterBounds","currentZoom","sizeScale","queryVersion","clusteredData","setClusteredData","single","cluster","filteredData","setFilteredData","setVersion","updateDataDebounce","updatedData","_args","updateData","filterDataDebounce","filtered","_args2","filterData","filteredClusteredData","tree","rbush","screenCoords","project","properties","zoomLevels","geoJSON","point","clear","load","_loop","z","radius","sqrt","pow","neighbors","search","minX","minY","maxX","maxY","neighbor","newGeoJSON","centroid","featureCollection","reducedPhotoCount","points","newZ","geometry","coordinates","AppLogo","createSvgIcon","strokeLinecap","strokeDasharray","strokeMiterlimit","vectorEffect","strokeLinejoin","searchIcon","transparent","TopBar","isTransparent","Menu_default","AccountCircle_default","Drawer","fullList","callback","button","ExitToApp_default","useSearchBarStyles","shape","fade","common","white","&:hover","breakpoints","up","inputRoot","inputInput","pointerEvents","justifyContent","SearchInput","debounceSearchText","Search_default","InputBase","TinyChip","chipContainer","accessPUBLIC","accessPRIVATE","accessOPEN","objectFit","titleText","dateContainer","dateLabel","dateText","imgContainer","SeriesListItem","showCreatedOn","showLastPhoto","accessLabel","misc_TinyChip","latest","ClusterSelected","seriesCount","onZoomTo","ZoomOutMap_default","&.PUBLIC","&.PRIVATE","&.OPEN","avatarActive","badge","badgeActive","Cluster","numeral","& .myPosMarker","& .singleMarker","& .clusterMarker","topBar","zoomOutFab","selectedPopup","defaultView","HomeMap","seriesList","setActiveSeries","onSeriesClick","onSearchClick","pushMapHistory","popMapHistory","clearMapHistory","mapViewObj","setMapViewObj","mapViewRef","homeMapContainerRef","setCurrentZoom","setTransitions","_useState9","_useState10","selectedItem","setSelectedItem","bufferPts","buffer","units","bbox","saveMap","updateSelectedItem","item","object","pts","lngBuff","latBuff","buffBounds","onMarkerClick","LinearInterpolator","markersRendered","offsetLeft","offsetTop","markers_Single","markers_Cluster","selectedItemRender","misc_SeriesListItem","selectedSeries","misc_ClusterSelected","components_TopBar","Search_SearchInput","maxZoom","minZoom","viewZoom","getBounds","_map$getBounds","_map$getBounds$_sw","_sw","minLng","lng","minLat","lat","_map$getBounds$_ne","_ne","maxLng","maxLat","oldMinLng","oldMinLat","oldMaxLng","oldMaxLat","onNativeClick","POLL_INTERVAL","withAllSeries","nextToken","fetchMore","updateQuery","fetchMoreResult","setSeriesProps","readyForPolling","withPollQuery","lastCheck","_ref5$ownProps","seriesProps","updateIncrement","changedSeries","oldList","newSeriesSummaries","seriesStatus","polledSeries","ds","oldSeries","oldId","AllSeriesConnect","PollQueryConnect","mapFuncs","tab","setLastCheck","allSeriesQUERY","pollSeriesQUERY","maps_HomeMap","chosenItem","avatarImg","SearchContextItem","gravatar","TheIcon","PlaceIcon","LabelIcon","PersonIcon","elevation","ListItemAvatar","Search_SearchContextItem","listSection","placeholderText","ul","SearchContextResults","contextResults","setContextChoice","cr","overflowX","SearchResults","contextChoice","onResultClick","subheader","SearchPlaceholder","PlaceholderIcon","useOnline","setOnline","setOffline","newDate","online","since","TABS","tabs","Search","currentTab","setCurrentTab","defaultText","searchText","setSearchText","searchResults","onMapClick","Search_SearchResults","Search_SearchContextResults","Search_SearchPlaceholder","PortableWifiOffIcon","indicatorColor","textColor","flexContainer","centered","TAGS","withTagSearch","ceil","withUserSearch","searchStr","withGeoCode","geocoder","relevance","placeName","center","withTagSeries","tagSeries","withUserSeries","createdBy","withGeoSearch","defaultTab","jumpToSeries","jumpToMap","bboxFunc","withContextQuery","withSearchQuery","ComposedSearch","newContextChoice","newTab","gravatarImg","MeCard","onAvatarClick","filterContainer","filterChip","FILTERS","SORT","MyProfile","feed","filterVal","setFilter","sortVal","setSort","sortAsc","setSortAsc","sortSetter","newSort","filteredFeed","fi","firstname","MyProfile_MeCard","MyProfile_FilterSortItem","asc","useFilterStyles","FilterSortItem","arrow","withGetUserQuery","userQ","withuserSeriesQuery","seriesQ","withMyWatchedSeriesQuery","watchedSeriesQ","seriesQArr","watchedSeriesQArr","arraySeries","components_MyProfile_MyProfile","placeAvatar","placeIcon","FindOnMapButton","Place_default","findOnMapButtonContainer","titleContainer","EVENT_VERBS","FeedItem","onImageClick","onProfileClick","misc_FindOnMapButton","listContainer","vList","feedContainer","MyFeed","events","fetchNewest","listRef","dist_es","rowCount","rowHeight","rowRenderer","isScrolling","isVisible","parent","row","MyFeed_FeedItem","wEnd","almostAtEnd","ROWHEIGHT","scrollTop","withFeedQuery","loadingNewest","loadingMore","start","myFeed","end","jumpToUser","components_MyFeed_MyFeed","OfflineBar","_useOnline","sinceStr","setSinceStr","calcSinceStr","clearTimer","BottomBar","onHomeClick","edge","HomeOutlined_default","MapOutlined_default","SearchOutlined_default","PersonOutline_default","homeConfig","offlineBar","activeWrapper","flexShrink","uploaderContainer","App","setHomeState","showBottomBar","ActiveComponent","FeedConnect","MapConnect","ProfileConnect","SearchConnect","SeriesConnect","misc_OfflineBar","components_BottomBar","Uploader_connect","fontFamily","ErrorScreen","Error_default","BugReport_default","withAppState","Wrapped","_useAuthentication","useAuthentication","apolloClient","token","cache","InMemoryCache","authLink","setContext","_","authorization","httpLink","createHttpLink","uri","ApolloClient","link","ApolloLink","tokenName","connectToDevTools","createApolloClient","appContext","getValues","base","lib_ErrorBoundary","react_apollo_esm","client","translations_IntlWrapper","isLocalhost","registerValidSW","swUrl","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","require","ReactDOM","App_connect","href","origin","fetch","contentType","status","ready","unregister","reload","checkValidServiceWorker","isNaN","parseFloat","isFinite","func","wait","immediate","timeout","innerArgs","callNow","clearTimeout"],"mappings":"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","file":"static/js/main.0ed92bcc.chunk.js","sourcesContent":["const tagChips = {\n  height: 20\n}\n\nexport default theme => ({\n  xyTagChip: {\n    cursor: 'pointer',\n    color: 'white',\n    fontSize: '0.6em',\n    background: '#444444',\n    height: tagChips.height,\n    position: 'absolute',\n    left: -tagChips.height / 2,\n    top: -tagChips.height / 2\n  },\n  editing: {\n    // color: 'white',\n    // background: theme.palette.secondary.main\n  },\n  // The tag is flipped on the right side of the screen\n  reversedChip: {\n    flexDirection: 'row-reverse',\n    left: 'unset',\n    right: -tagChips.height / 2\n  },\n  deleteIcon: {\n    // color: 'white',\n    width: tagChips.height - 1,\n    height: tagChips.height - 1\n  },\n  chipAvatarIcon: {\n    color: 'white',\n    width: tagChips.height - 4,\n    height: tagChips.height - 4\n  },\n  chipAvatar: {\n    background: 'inherit',\n    width: tagChips.height,\n    height: tagChips.height\n  },\n  reversedDelete: {\n    margin: `0 -${tagChips.height / 8}px 0 ${tagChips.height / 8}px`\n  },\n  // The chip bucket is the container div for the chip and represents the\n  // Actual XY coordinates. The chip itself is offset to make the\n  chipBucket: {\n    width: 1,\n    height: 1,\n    display: 'flex',\n    flexDirection: 'row',\n    position: 'absolute'\n  },\n  reversedChipBucket: {\n    flexDirection: 'row-reverse'\n  }\n})\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\nimport Draggable from 'react-draggable'\n\nimport Chip from '@material-ui/core/Chip'\nimport Avatar from '@material-ui/core/Avatar'\n\nimport CancelIcon from '@material-ui/icons/Cancel'\nimport MyLocation from '@material-ui/icons/MyLocation'\n\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport style from './XYTagChip.style'\n\nconst useStyles = makeStyles(style)\n\nconst XYTagChip = ({\n  color, edit, tag, newSize,\n  onTagDragOver, onTagDragStop, onNewTag, onTagDelete, ...props\n}) => {\n  const isReversed = tag.relCoords.x > newSize.newWidth / 2\n  const classes = useStyles()\n  const theme = useTheme()\n  const stopBadness = (e) => {\n    e.preventDefault()\n    e.stopPropagation()\n  }\n\n  const handleDrag = (e, data) => {\n    stopBadness(e)\n    onTagDragOver(data, tag)\n  }\n  const handleStopDrag = (e, data) => {\n    stopBadness(e)\n    onTagDragStop(data, tag)\n  }\n\n  // Draggable chip if it is editable\n  return (\n    <Draggable\n      disabled={!edit}\n      bounds={{ left: 10, top: 10, right: newSize.newWidth - 10, bottom: newSize.newHeight - 10 }}\n      position={{ x: tag.relCoords.x, y: tag.relCoords.y }}\n      onDrag={handleDrag}\n      onStop={handleStopDrag}\n      onClick={stopBadness}\n    >\n      <div className={classNames(classes.chipBucket, isReversed && classes.reversedChipBucket)}>\n        <Chip\n          style={{\n            background: color ? `${color}!important` : null,\n            color: color ? `${theme.palette.getContrastText(color)}!important` : null\n          }}\n          color={edit ? 'secondary' : 'default'}\n          label={tag.label}\n          data={tag.id}\n          onClick={stopBadness}\n          onDelete={edit ? onTagDelete(tag) : null}\n          deleteIcon={edit ? <CancelIcon className={classNames(classes.deleteIcon, isReversed && classes.reversedDelete)} /> : <div />}\n          className={classNames(\n            classes.xyTagChip,\n            isReversed && classes.reversedChip,\n            edit && classes.editing\n          )}\n          {...props}\n          avatar={<Avatar className={classNames(classes.chipAvatar, edit && classes.editing)}>\n            <MyLocation className={classNames(classes.chipAvatarIcon, edit && classes.editing)} />\n          </Avatar>}\n        />\n      </div>\n    </Draggable>\n  )\n}\n\nXYTagChip.propTypes = {\n  color: PropTypes.string,\n  edit: PropTypes.bool,\n  tag: PropTypes.object.isRequired,\n  newSize: PropTypes.object,\n  onTagDragOver: PropTypes.func,\n  onTagDragStop: PropTypes.func,\n  onNewTag: PropTypes.func,\n  onTagDelete: PropTypes.func\n}\n\nexport default XYTagChip\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport Paper from '@material-ui/core/Paper'\nimport Typography from '@material-ui/core/Typography'\nimport TextField from '@material-ui/core/TextField'\nimport MenuItem from '@material-ui/core/MenuItem'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport Select from 'react-select'\nimport CreatableSelect from 'react-select/lib/Creatable'\nimport style from './XYTagSelect.style'\n\nconst useStyles = makeStyles(style)\n\nconst XYTagSelect = ({ tagConfig, onChange }) => {\n  const classes = useStyles()\n  const options = tagConfig.values.map(tc => ({ label: tc.label, value: tc.id }))\n  console.log('XYTagSelect', tagConfig)\n  return (\n    <div className={classes.root}>\n      {!tagConfig.allowAdditions && (\n        <Select\n          options={options}\n          classes={classes}\n          components={{\n            Control,\n            Menu,\n            NoOptionsMessage,\n            Option,\n            Placeholder,\n            ValueContainer\n          }}\n          value={null}\n          // onBlur={e => e.preventDefault()}\n          blurInputOnSelect\n          isClearable={false}\n          onChange={onChange}\n          placeholder={tagConfig.label}\n          isSearchable\n        />\n      ) }\n      { tagConfig.allowAdditions && (\n        <CreatableSelect\n          options={options}\n          classes={classes}\n          components={{\n            Control,\n            Menu,\n            NoOptionsMessage,\n            Option,\n            Placeholder,\n            ValueContainer\n          }}\n          value={null}\n          isClearable={false}\n          // onBlur={e => e.preventDefault()}\n          blurInputOnSelect\n          onChange={onChange}\n          placeholder={tagConfig.label}\n          isSearchable\n        />\n      )}\n    </div>\n  )\n}\nXYTagSelect.propTypes = {\n  tagConfig: PropTypes.object.isRequired,\n  onChange: PropTypes.func.isRequired\n}\n\nexport default XYTagSelect\n\nfunction Control (props) {\n  return (\n    <TextField\n      fullWidth\n      InputProps={{\n        inputComponent,\n        inputProps: {\n          className: props.selectProps.classes.input,\n          inputRef: props.innerRef,\n          children: props.children,\n          ...props.innerProps\n        }\n      }}\n      {...props.selectProps.textFieldProps}\n    />\n  )\n}\n\nconst NoOptionsMessage = ({ innerProps, selectProps, children }) => (\n  <Typography\n    color='textSecondary'\n    className={selectProps.classes.noOptionsMessage}\n    {...innerProps}\n  >\n    {children}\n  </Typography>\n)\n\nconst Menu = ({ selectProps, innerProps, children }) => (\n  <Paper square className={selectProps.classes.paper} {...innerProps}>\n    {children}\n  </Paper>\n)\n\nconst inputComponent = ({ inputRef, ...props }) => <div ref={inputRef} {...props} />\n\nconst Placeholder = (props) => (\n  <Typography\n    color='textSecondary'\n    className={props.selectProps.classes.placeholder}\n    {...props.innerProps}\n  >\n    {props.children}\n  </Typography>\n)\n\nconst Option = ({ innerRef, isFocused, isSelected, innerProps, children }) => (\n  <MenuItem\n    buttonRef={innerRef}\n    selected={isFocused}\n    component='div'\n    style={{ fontWeight: isSelected ? 500 : 400 }}\n    {...innerProps}\n  >\n    {children}\n  </MenuItem>\n)\n\nconst ValueContainer = ({ selectProps, children }) => (\n  <div className={selectProps.classes.valueContainer}>{children}</div>\n)\nValueContainer.propTypes = {\n  selectProps: PropTypes.object.isRequired,\n  children: PropTypes.any\n}\n","export default theme => ({\n  root: {\n    width: '100%'\n  },\n  noOptionsMessage: {\n    padding: `${theme.spacing(1)}px ${theme.spacing(1) * 2}px`\n  },\n  singleValue: {\n    fontSize: 16\n  },\n  placeholder: {\n    position: 'absolute',\n    left: 2,\n    fontSize: 16\n  },\n  input: {\n    display: 'flex',\n    padding: 0\n  },\n  valueContainer: {\n    display: 'flex',\n    flexWrap: 'wrap',\n    flex: 1,\n    alignItems: 'center',\n    overflow: 'hidden'\n  },\n  paper: {\n    position: 'absolute',\n    zIndex: 100,\n    marginTop: theme.spacing(1),\n    left: 0,\n    right: 0\n  }\n})\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport Typography from '@material-ui/core/Typography'\nimport IconButton from '@material-ui/core/IconButton'\n\nimport CloseIcon from '@material-ui/icons/Close'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport XYTagSelect from './XYTagSelect'\nimport style from './XYTagChooser.style'\n\nconst useStyles = makeStyles(style)\n\nconst XYTagChooser = ({ coords, open, seriesConfig, onNewTag, onClose }) => {\n  const classes = useStyles()\n  const xyTags = seriesConfig.tags.filter(t => t.allowXY)\n  if (!coords) return null\n  return (\n    <Dialog\n      open={open}\n      scroll='paper'\n      fullScreen\n      classes={{ paperScrollPaper: classes.root }}\n      onClose={() => onClose()}\n      aria-labelledby='simple-dialog-title'\n    >\n      <DialogTitle id='simple-dialog-title' className={classes.header}>\n      New Tag:\n        <IconButton className={classes.closeButton} onClick={onClose}>\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n      <div className={classes.dlgBody}>\n        {xyTags.length > 1 && (\n          <Typography variant='caption'>What kind of tag would you like to create?</Typography>\n        )}\n\n        {xyTags.map((tagType, idx) => (\n          <div className={classes.listItem} key={`tagSelect${idx}`}>\n            <XYTagSelect tagConfig={tagType} onChange={onNewTag(coords, tagType)} />\n          </div>\n        ))}\n      </div>\n    </Dialog>\n  )\n}\n\nXYTagChooser.propTypes = {\n  seriesConfig: PropTypes.object.isRequired,\n  open: PropTypes.bool.isRequired,\n  coords: PropTypes.object,\n  onClose: PropTypes.func.isRequired,\n  onNewTag: PropTypes.func.isRequired\n}\n\nexport default XYTagChooser\n","export default theme => ({\n  root: {\n    overflow: 'visible'\n  },\n  header: {\n    padding: theme.spacing(1) * 2\n  },\n  listItem: {\n    flexDirection: 'column'\n  },\n  dlgBody: {\n    paddingLeft: theme.spacing(1) * 2,\n    paddingRight: theme.spacing(1) * 2,\n    paddingBottom: theme.spacing(1) * 2\n  },\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500]\n  }\n})\n","import React, { useState, useContext } from 'react'\nimport { SeriesContext } from '../../contexts'\nimport XYTagChooser from './XYTagChooser'\nimport Tags from '../../../../lib/Tags'\n\nconst useXYTags = (photo, newSize, onChange, setResizeActive) => {\n  const { seriesConfig } = useContext(SeriesContext)\n\n  // we hold the tags in state so that every little drag motion\n  // doesn't cause an updated state until you let go\n  const [isDragging, setIsDragging] = useState(false)\n  const [newTagDialog, setNewTagDialog] = useState(null)\n\n  const tagClass = new Tags(seriesConfig, photo.tags)\n\n  const onNewTag = (coords, tagType) => ({ value, __isNew__: isNew }) => {\n    let addTag = isNew\n      ? tagClass.createNewXYTagObj(value, tagType.id, coords)\n      : tagClass.createExistingXYTagObj(value, tagType.id, coords)\n\n    setNewTagDialog(null)\n    onChange({ ...photo, tags: [...photo.tags, addTag] })\n  }\n\n  const onTagDelete = (tag) => () => {\n    const tags = photo.tags.filter(oldTag => oldTag.id !== tag.id)\n    onChange({\n      ...photo,\n      tags\n    })\n  }\n\n  // When the photo is tapped, send the x,y coords of that tap\n  // to a dialog we will open\n  const onAddTagTrigger = (e) => {\n    if (!newTagDialog) {\n      // Turn off resizing so mobile keyboards don't complete F us.\n      setResizeActive(false)\n      setNewTagDialog({\n        x: parseInt(e.pageX - (window.innerWidth - newSize.newWidth) / 2 * newSize.multiplier, 10),\n        y: parseInt(e.pageY - (window.innerHeight - newSize.newHeight) / 2 * newSize.multiplier, 10)\n      })\n    }\n  }\n\n  // This gets used by the drag AND the stop\n  const updateTagLocation = ({ x, y }, tag) => {\n    const newTags = photo.tags.map(oldTag => {\n      if (oldTag.id !== tag.id) return oldTag\n      else {\n        let newX = parseInt(x / newSize.multiplier, 10)\n        let newY = parseInt(y / newSize.multiplier, 10)\n\n        return {\n          ...oldTag,\n          coords: { x: newX, y: newY }\n        }\n      }\n    })\n    return newTags\n  }\n\n  const onTagDragStop = (coords, tag) => {\n    const tags = updateTagLocation(coords, tag)\n    setIsDragging(false)\n    onChange({\n      ...photo,\n      tags\n    })\n  }\n\n  const onTagDragOver = (coords, tag) => {\n    updateTagLocation(coords, tag)\n    setIsDragging(true)\n  }\n  const TagChooser = () => (\n    <XYTagChooser\n      open={!isDragging && Boolean(newTagDialog)}\n      coords={newTagDialog}\n      seriesConfig={seriesConfig}\n      onNewTag={onNewTag}\n      onClose={() => {\n        setNewTagDialog(null)\n        // Turn on resizing again.\n        setResizeActive(true)\n      }}\n    />\n  )\n\n  return {\n    onNewTag,\n    onTagDelete,\n    onAddTagTrigger,\n    onTagDragOver,\n    onTagDragStop,\n    TagChooser,\n    getRelXYTags: tagClass.getRelXYTags\n  }\n}\n\nexport default useXYTags\n","import React, { useState, useRef, useContext, useEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\n\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport useComponentSize from '../../../../lib/useComponentSize'\n\nimport { SeriesContext } from '../../contexts'\nimport XYTagChip from '../tags/XYTagChip'\nimport useXYTags from '../tags/useXYTags'\n\nimport style from './Photo.style'\nconst useStyles = makeStyles(style)\n\nconst Photo = ({ photo, opacity, edit, showTags, transition, onChange, className }) => {\n  const classes = useStyles()\n  const refImgWrap = useRef(null)\n  const [newSize, setNewSize] = useState({ multiplier: 1 })\n  const [url, setUrl] = useState(null)\n  const [urlRetryCounter, setURLRetryCounter] = useState(0)\n  const { seriesConfig } = useContext(SeriesContext)\n\n  useEffect(() => {\n    function getURL () {\n      if (!photo.base64) {\n        const newUrl = seriesConfig.getPhotoUrl(photo, 'large')\n        if (refImgWrap.current) setUrl(newUrl)\n      }\n      else {\n        if (refImgWrap.current) setUrl(photo.base64)\n      }\n    }\n    getURL()\n  }, [photo])\n\n  const { size: { height, width }, setResizeActive } = useComponentSize(refImgWrap)\n  const urlWithRetries = urlRetryCounter > 0 ? `${url}?retry=${urlRetryCounter}` : url\n\n  // All tag-related info is put in its own hook\n  const { onAddTagTrigger, TagChooser, getRelXYTags, onTagDragOver, onTagDragStop, onTagDelete } = useXYTags(photo, { height, width }, onChange, setResizeActive)\n\n  const handleImageLoaded = event => {\n    if (refImgWrap.current) {\n      const { naturalHeight, naturalWidth } = event.target\n\n      // 4 different cases of orientation:\n      const multiplier = Math.min(\n        height / naturalHeight,\n        width / naturalWidth\n      )\n\n      const newWidth = multiplier * naturalWidth\n      const newHeight = multiplier * naturalHeight\n\n      setNewSize({ newWidth, newHeight, naturalWidth, naturalHeight, multiplier })\n    }\n  }\n\n  return (\n    <div\n      className={classNames(classes.root, className)}\n      style={{ opacity: opacity !== null ? opacity : 1 }}\n      ref={refImgWrap}\n    >\n      <div\n        className={classes.inner}\n        style={{\n          height: newSize ? newSize.newHeight : 1,\n          width: newSize ? newSize.newWidth : 1\n        }}\n        onClick={onAddTagTrigger}\n      >\n        { showTags || edit\n          ? (\n            <div className={className}>\n              { getRelXYTags(newSize.multiplier).map((tag, idx) => (\n                <XYTagChip\n                  key={`xytag-${idx}`}\n                  color={tag.color}\n                  {...{ edit, newSize, tag, onTagDragOver, onTagDragStop, onTagDelete }} />\n              ))}\n            </div>\n          ) : null\n        }\n        <img\n          className={classes.img}\n          alt={urlWithRetries}\n          onError={(err) => {\n            if (urlRetryCounter < 10) {\n              console.log('Image Retry', urlRetryCounter)\n              console.error(err)\n              setTimeout(() => {\n                if (refImgWrap.current) setURLRetryCounter(urlRetryCounter + 1)\n              }, 4000)\n            }\n          }}\n          src={urlWithRetries}\n          onLoad={handleImageLoaded}\n          style={{ height: newSize.newHeight, width: newSize.newWidth }}\n        />\n      </div>\n      {edit && <TagChooser />}\n    </div>\n  )\n}\n\nPhoto.propTypes = {\n  className: PropTypes.string,\n  opacity: PropTypes.number,\n  photo: PropTypes.object.isRequired,\n  edit: PropTypes.bool,\n  showTags: PropTypes.bool,\n  transition: PropTypes.string,\n  onChange: PropTypes.func\n}\n\nexport default Photo\n","// import { fade } from '@material-ui/core/styles/colorManipulator'\nexport default theme => ({\n  root: {\n    // maxWidth: 400,\n    display: 'block',\n    position: 'relative',\n    width: '100%',\n    height: '100%',\n    background: 'black',\n    overflow: 'hidden'\n  },\n  inner: {\n    position: 'absolute',\n    top: '50%',\n    left: '50%',\n    transform: 'translateY(-50%) translateX(-50%)',\n    overflow: 'hidden'\n  },\n  xyTags: {\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    // opacity: 0.8,\n    // border: '4px solid red',\n    height: '100%',\n    width: '100%'\n    // background: 'rgba(150, 150, 150, 0.5)'\n  },\n  img: {\n    display: 'block'\n  },\n  formControl: {\n    width: '100%'\n  }\n})\n","import { useCallback, useState, useLayoutEffect, useRef } from 'react'\nimport { debounce } from './util'\n\nconst getSize = (el, minSize, defaultSize) => {\n  if (!el) return defaultSize || minSize || { width: 0, height: 0 }\n\n  if (minSize) {\n    return {\n      width: Math.max(minSize.width, el.offsetWidth),\n      height: Math.max(minSize.height, el.offsetHeight)\n    }\n  }\n  else {\n    return {\n      width: el.offsetWidth,\n      height: el.offsetHeight\n    }\n  }\n}\n\nconst useComponentSize = (ref, minSize, defaultSize) => {\n  const resizeActiveRef = useRef()\n  const [resizeActive, setResizeActive] = useState(true)\n\n  resizeActiveRef.current = resizeActive\n  const [size, setComponentSize] = useState(\n    getSize(ref ? ref.current : null, minSize, defaultSize)\n  )\n\n  const handleResize = () => {\n    if (!resizeActiveRef.current || !ref.current) return\n    const newSize = getSize(ref.current, minSize, defaultSize)\n    if (newSize.height !== size.height || newSize.width !== size.width) {\n      // console.log('handleResize Called', { newSize, size })\n      setComponentSize(newSize)\n    }\n  }\n\n  const handleResizeDebounced = useCallback(\n    debounce(handleResize, 500),\n    []\n  )\n\n  useLayoutEffect(() => {\n    if (!ref.current) return\n    handleResizeDebounced()\n\n    if (typeof ResizeObserver === 'function') {\n      let resizeObserver = new ResizeObserver(handleResizeDebounced)\n      resizeObserver.observe(ref.current)\n\n      return () => {\n        resizeObserver.disconnect(ref.current)\n        resizeObserver = null\n      }\n    }\n    else {\n      window.addEventListener('resize', handleResizeDebounced)\n\n      return () => {\n        window.removeEventListener('resize', handleResizeDebounced)\n      }\n    }\n  },\n  [ref.current])\n\n  return { size, setResizeActive }\n}\n\nexport default useComponentSize\n","import MapStyles from './mapStyles'\n\nexport default {\n  // Bright Pastel\n  tagColors: [\n    '#418CF0', '#FCB441', '#E0400A', '#056492', '#BFBFBF', '#1A3B69', '#FFE382', '#129CDD', '#CA6B4B',\n    '#005CDB', '#F3D288', '#506381', '#F1B9A8', '#E0830A', '#7893BE'\n  ]\n}\n\nexport const mapConfig = {\n  mapBoxToken: process.env.REACT_APP_MAPBOX_TOKEN,\n  styles: MapStyles\n}\n\nlet baseurl = process.env.REACT_APP_BASEURL\nlet basename = process.env.REACT_APP_BASENAME\nlet domain = process.env.REACT_APP_DOMAIN\nif (process.env.NODE_ENV && process.env.NODE_ENV === 'development') {\n  domain = 'localhost'\n  basename = ''\n}\nconsole.log('config: ', baseurl, basename)\n\nexport const home = {\n  AppStateTypes: {\n    FEED: 'feed', // Looking at the Home Feed\n    MAP: 'map', // Looking at the map\n    SEARCH: 'search', // looking at the search\n    PROFILE: 'profile', // Looking at user information\n    SERIES: 'series', // Looking at one particular series\n    NEW_SERIES_CAMERA: 'new_series_camera', // Looking at one particular sereis\n    NEW_SERIES_LIBRARY: 'new_series_library' // Looking at one particular sereis\n  },\n  SEARCH_TABS: {\n    TAG: 'tag',\n    LOCATION: 'location',\n    USER: 'user'\n  },\n  MapModeTypes: {\n    FREE: 'free', //\n    USER: 'user', // filtered to a given user\n    TAG: 'tag' // filtered to a given tag\n  }\n}\n\nexport const federated = {\n  // oauth_config: {\n\n  // },\n  // google_client_id: process.env.REACT_APP_GOOGLE_APP_ID\n}\n\nexport const endpoints = {\n  graphql: process.env.REACT_APP_GRAPHQL\n}\n\nexport const localDb = {\n  imgStore: 'imgStore'\n}\n\nexport const aws = {\n  Auth: {\n    // REQUIRED - Amazon Cognito Identity Pool ID\n    // identityPoolId: process.env.REACT_APP_COGNITO_IDPOOLID, // XX-XXXX-X:XXXXXXXX-XXXX-1234-abcd-1234567890ab\n    // REQUIRED - Amazon Cognito Region\n    region: process.env.REACT_APP_AWS_REGION,\n    // OPTIONAL - Amazon Cognito User Pool ID\n    userPoolId: process.env.REACT_APP_COGNITO_USER_POOL_ID,\n    // OPTIONAL - Amazon Cognito Web Client ID (26-char alphanumeric string)\n    userPoolWebClientId: process.env.REACT_APP_COGNITO_CLIENT_ID,\n    // OPTIONAL - Enforce user authentication prior to accessing AWS resources or not\n    mandatorySignIn: true,\n    // OPTIONAL - Configuration for cookie storage\n    cookieStorage: {\n      // REQUIRED - Cookie domain (only required if cookieStorage is provided)\n      domain: `${domain}`,\n      // OPTIONAL - Cookie path\n      // path: `/${basename}`,\n      // OPTIONAL - Cookie expiration in days\n      expires: 20,\n      // OPTIONAL - Cookie secure flag\n      secure: false\n    }\n\n  }\n\n}\n\nexport const ACCESS = {\n  OPEN: {\n    label: 'Open',\n    description: 'Open series can be seen and contributed to by anyone',\n    color: 'green'\n  },\n  PRIVATE: {\n    label: 'Private',\n    description: 'Private series can only be seen by their createors',\n    color: 'red'\n  },\n  PUBLIC: {\n    label: 'Public',\n    description: 'Public series can be seen by everyone',\n    color: 'blue'\n  }\n}\n","const TYPES = {\n  // Series meta gets appended automatically to the seriees\n  SERIES: 'SERIES',\n  // Same but now only gets appended to the photo\n  PHOTO: 'PHOTO'\n}\nclass SeriesConfig {\n  constructor (seriesConfig) {\n    if (!seriesConfig) throw new Error('No seriesConfig object provided to SeriesConfig class')\n    this.config = seriesConfig\n  }\n\n  getTagType = (typeId) => this.config.tags.find(tt => tt.id === typeId)\n  // getTagTypeIndex = (typeId) => this.config.tags.findIndex(tt => tt.id === typeId)\n  getTagTypeIndex = (typeId) => {\n    // console.log('HERE', typeId)\n    return this.config.tags.findIndex(tt => tt.id === typeId)\n  }\n\n  getXYTagTypes = () => this.config.tags.filter(tt => tt.allowXY)\n  getNonXYTagTypes = () => this.config.tags.filter(tt => tt.allowNonXY)\n\n  getSeriesMeta = () => Object.keys(this.config.meta)\n    .filter(key => this.config.meta[key].type === TYPES.SERIES)\n    .reduce((acc, key) => ({\n      ...acc,\n      [key]: this.config.meta[key].default\n    }), {})\n\n  getPhotoMeta = () => Object.keys(this.config.meta)\n    .filter(key => this.config.meta[key].type === TYPES.PHOTO)\n    .reduce((acc, key) => ({\n      ...acc,\n      [key]: this.config.meta[key].default\n    }), {})\n}\n\nexport default SeriesConfig\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport Chip from '@material-ui/core/Chip'\nimport CancelIcon from '@material-ui/icons/Cancel'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\n\nexport const tagChips = {\n  height: 20\n}\n\nconst style = theme => ({\n  root: {\n    fontSize: '0.6em',\n    height: tagChips.height,\n    marginRight: theme.spacing(1) / 2,\n    marginTop: theme.spacing(1) / 2\n  },\n  deleteIcon: {\n    width: tagChips.height - 1,\n    height: tagChips.height - 1\n  },\n  chipAvatar: {\n    width: tagChips.height,\n    height: tagChips.height\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst TagChip = ({ edit, tag, color, onDelete, ...props }) => {\n  const classes = useStyles()\n  const theme = useTheme()\n  return (\n    <Chip\n      style={{\n        background: color || null,\n        color: color ? `${theme.palette.getContrastText(color)}` : null\n      }}\n      label={tag.label}\n      data={tag.id}\n      onDelete={edit ? () => onDelete(tag) : null}\n      deleteIcon={(\n        <CancelIcon\n          className={classes.deleteIcon}\n          onClick={e => {\n            console.log('this click')\n          }}\n          style={{\n            opacity: 0.5,\n            color: color ? `${theme.palette.getContrastText(color)}` : null\n          }}\n        />\n      )}\n      className={classes.root}\n      {...props}\n    />\n  )\n}\n\nTagChip.propTypes = {\n  color: PropTypes.string.isRequired,\n  edit: PropTypes.bool,\n  tag: PropTypes.object.isRequired,\n  onDelete: PropTypes.func\n}\n\nexport default TagChip\n","import React from 'react'\nimport classNames from 'classnames'\nimport PropTypes from 'prop-types'\nimport Typography from '@material-ui/core/Typography'\nimport FormLabel from '@material-ui/core/FormLabel'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst style = theme => ({\n  root: {\n    position: 'relative',\n    display: 'block',\n    overflow: 'hidden',\n    whiteSpace: 'pre-line',\n    '&::before': {\n      content: '\"  \"',\n      display: 'block',\n      position: 'absolute',\n      bottom: 0,\n      width: '100%',\n      height: 100,\n      background: `linear-gradient(180deg, rgba(255,255,255,0) 0%, ${theme.palette.background.paper} 100%)`\n    }\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst ShortLongText = ({ label, text, height, onClick }) => {\n  const classes = useStyles()\n  return (\n    <div onClick={onClick}>\n      {label && (\n        <FormLabel className={classes.formLabel}>\n          {label}\n        </FormLabel>\n      )}\n      <Typography\n\n        variant='body1'\n        color='inherit'\n        style={{ height }}\n        className={classNames(classes.root)}\n      >\n        {text}\n      </Typography>\n    </div>\n  )\n}\n\nShortLongText.propTypes = {\n  label: PropTypes.string,\n  text: PropTypes.string,\n  height: PropTypes.number,\n  onClick: PropTypes.func\n}\nShortLongText.defaultProps = {\n  height: 100\n}\n\nexport default ShortLongText\n","import uuid from 'uuid/v4'\nimport SeriesConfig from './SeriesConfig'\n\nclass Tags {\n  constructor (seriesConfig, tags) {\n    this.tags = tags\n    this.seriesConfig = new SeriesConfig(seriesConfig)\n  }\n\n  findTagById = (typeId, tagId) => {\n    return this.seriesConfig.getTagType(typeId).values\n      .find(tt => tt.id === tagId)\n  }\n\n  // Filter the list of tags to those that are XY tags\n  getXYTags = () => {\n    const xyTagIds = this.seriesConfig.getXYTagTypes().map(tt => tt.id)\n    return this.tags.filter(tag => xyTagIds.indexOf(tag.typeId) > -1 && tag.coords && tag.coords.x)\n  }\n\n  getNonXYTags = () => {\n    const NonXYTagIds = this.seriesConfig.getNonXYTagTypes().map(tt => tt.id)\n    return this.tags.filter(tag => NonXYTagIds.indexOf(tag.typeId) > -1)\n  }\n\n  createNewTagObj = (label, typeId) => (\n    { id: uuid(), label, typeId }\n  )\n\n  createExistingTagObj = (id, typeId) => ({\n    ...this.findTagById(typeId, id),\n    typeId\n  })\n\n  createNewXYTagObj = (label, typeId, coords) => ({\n    id: uuid(),\n    label,\n    typeId,\n    coords\n  })\n\n  createExistingXYTagObj = (id, typeId, coords) => ({\n    ...this.findTagById(typeId, id),\n    typeId,\n    coords\n  })\n\n  // Get tags in a way that's easy to render them\n  // We augment these tags with relative positions\n  // and a group number for coloring.\n  getRelXYTags = (multiplier) => this.getXYTags().map(tag => ({\n    ...tag,\n    group: this.seriesConfig.getTagTypeIndex(tag.typeId),\n    relCoords: {\n      x: tag.coords.x * multiplier,\n      y: tag.coords.y * multiplier\n    }\n  }))\n}\n\nexport default Tags\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst style = theme => ({\n  root: {\n    color: theme.palette.primary.main,\n    position: 'absolute',\n    top: '50%',\n    left: '50%',\n    textAlign: 'center',\n    transformOrigin: '50% 50%',\n    transform: 'translateY(-50%) translateX(-50%)',\n    zIndex: 1\n  },\n  rootActive: {\n    zIndex: 1000\n  },\n  svgDot: {\n    zIndex: 102,\n    width: 20,\n    height: 20,\n    position: 'absolute',\n    top: '50%',\n    left: '50%',\n    textAlign: 'center',\n    transformOrigin: '50% 50%',\n    transform: 'translateY(-50%) translateX(-50%)'\n  },\n  dot: {\n    stroke: theme.palette.secondary.contrastText,\n    strokeWidth: '1',\n    fill: theme.palette.secondary.main\n  },\n  directionIndicator: {\n    position: 'absolute',\n    left: '50%',\n    // transformOrigin: '50% 50%',\n    // transform: 'translateY(-50%) translateX(-50%)',\n    zIndex: 100\n  },\n  name: {\n    color: 'white',\n    fontWeight: 'bold',\n    textShadow: `\n        0px 0px 4px #000000, \n        0px 0px 4px #000000 \n    `,\n    zIndex: 122,\n    position: 'relative'\n    // textStroke: '1px white'\n  },\n  nameActive: {\n    color: theme.palette.secondary.dark,\n    textShadow: `\n    0px 0px 2px #FFFFFF, \n    0px 0px 2px #FFFFFF,\n    0px 0px 4px #FFFFFF \n`\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst Single = ({ direction }) => {\n  const classes = useStyles()\n  return (\n    <div className={classes.root}>\n      <svg className={classes.svgDot} version='1.1' viewBox='0, 0, 10, 10' >\n        <circle cx='5' cy='5' r='4' className={classes.dot} />\n      </svg>\n      {direction && direction >= 0 ? (\n        <div className={classes.directionIndicator}>\n          <svg className={classes.svgArc}\n            version='1.1'\n            width='100'\n            height='100'\n            viewBox='0, 0, 100, 100'\n            style={{ transform: `translateY(-50%) translateX(-50%) rotateZ(${direction}deg)` }}>\n            <path d='M50,0 C60.946,0.151 72.136,3.514 80.675,10.56 L50,50 L19.325,10.56 C27.938,3.461 39,0.278 50,0 z'\n              fill='#009DC1'\n              fillOpacity='0.444'\n              strokeWidth='0.5'\n              strokeOpacity='0.6'\n              stroke='#FFFFFF'\n            />\n          </svg>\n        </div>\n      ) : null}\n    </div>\n  )\n}\n\nSingle.propTypes = {\n  direction: PropTypes.number\n}\n\nexport default Single\n","import React, { useState, useRef, useMemo } from 'react'\nimport { StaticMap } from 'react-map-gl'\nimport PropTypes from 'prop-types'\nimport { getDistanceScales } from 'viewport-mercator-project'\nimport useComponentSize from '../../lib/useComponentSize'\nimport StyleButtons from './controls/StyleButtons'\nimport { mapConfig } from '../../config'\nimport classNames from 'classnames'\nimport 'mapbox-gl/dist/mapbox-gl.css'\nimport './BaseMap.css'\n\n/**\n * Note that this component technically has state but it is designed to be functionally stateless\n */\nconst BaseStaticMap = (props) => {\n  const {\n    controlPadding,\n    viewport,\n    children,\n    mapStyles,\n    onMapDataEvent,\n    ...passthroughProps\n  } = props\n\n  const mapRef = useRef(null)\n  const { size } = useComponentSize(mapRef, { width: 100, height: 50 })\n\n  const [currStyle, setCurrStyle] = useState(0)\n  const [projection, setProjection] = useState(null)\n\n  const recalcProjection = () => {\n    if (!size || size.width < 10 || size.height < 10) return\n    try {\n      const projection = getDistanceScales(viewport)\n      // console.log('recalcProjection', { projection, size })\n      setProjection(projection)\n    }\n    catch (e) {\n      // Sometimes we don't have a valid bound. Don't make a big deal out of it.\n      console.error(e)\n    }\n  }\n\n  if (!projection) recalcProjection()\n  useMemo(recalcProjection, [size])\n\n  return (\n    <div className={classNames('BaseMap', props.className)} ref={mapRef} style={{ height: '100%', width: '100%' }}>\n      <StaticMap\n        {...viewport}\n        height={size.height}\n        width={size.width}\n        mapStyle={mapStyles[currStyle].style}\n        onData={onMapDataEvent}\n        mapboxApiAccessToken={mapConfig.mapBoxToken}\n        {...passthroughProps}\n      >\n        { mapStyles && mapStyles.length > 1 ? (\n          <StyleButtons\n            controlPadding={controlPadding}\n            currStyle={currStyle}\n            mapStyles={mapStyles}\n            setCurrStyle={setCurrStyle}\n          />\n        ) : null }\n        {\n          children && Array.isArray(children)\n            ? children.map(c => handleChild(c, viewport, size.height, size.width, projection))\n            : handleChild(children, viewport, size.height, size.width, projection)\n        }\n      </StaticMap>\n    </div>\n  )\n}\n\nfunction handleChild (child, viewport, height, width, projection) {\n  return typeof child === 'function'\n    ? child(viewport, height, width, projection)\n    : child\n}\n\nBaseStaticMap.propTypes = {\n  // Anything else we want to add to the map\n  children: PropTypes.any,\n  deckelements: PropTypes.array,\n  data: PropTypes.array,\n  // Maybe we want map controls to be padded\n  controlPadding: PropTypes.object,\n\n  minPitch: PropTypes.number,\n  maxPitch: PropTypes.number,\n  pitch: PropTypes.number,\n\n  // Lock the bounds of a map to a rectangle [minlng, minlat], [maxlng, maxlat]\n  bounds: PropTypes.array,\n  // Lock the possible zoom levels to a range: [minZoom, maxZoom]\n  zoomBounds: PropTypes.array,\n  // InitialBounds of the map.\n  InnerBounds: PropTypes.array,\n\n  // List of valid styles that will get picker buttons\n  mapStyles: PropTypes.array,\n\n  // Just some default props we probably won't set.\n  latitude: PropTypes.number,\n  longitude: PropTypes.number,\n  zoom: PropTypes.number,\n\n  onMapDataEvent: PropTypes.func\n}\nBaseStaticMap.defaultProps = {\n  controlPadding: {},\n  stylechooser: true,\n  // viewport: {\n  //   zoom: 12,\n  //   latitude: 49.3050394,\n  //   longitude: -123.1398254\n  // },\n  initStyle: 0,\n  mapStyles: mapConfig.styles\n}\n\nexport default BaseStaticMap\n","import React from 'react'\nimport PropTypes from 'prop-types'\n// import { makeStyles } from '@material-ui/core/styles'\nimport { Marker } from 'react-map-gl'\nimport BaseMap from './BaseMap'\nimport Dot from './markers/Dot'\nimport BaseStaticMap from './BaseStaticMap'\n// import style from './MapDot.style'\n\n// const useStyles = makeStyles(style)\n\nconst MapDot = ({ staticMap, editable, latitude, longitude, onChange, direction, ...props }) => {\n  const Map = staticMap ? BaseStaticMap : BaseMap\n  // const classes = useStyles()\n  const mapProps = staticMap ? {} : {\n    touchRotate: false,\n    dragRotate: false,\n    showMe: editable,\n    lockPan: !editable,\n    onViewportChange: onChange\n  }\n\n  return (\n    <Map\n      {...mapProps}\n      {...props}\n    >\n      {latitude && longitude ? (\n        <Marker\n          className={'singleMarker'}\n          latitude={latitude}\n          longitude={longitude}\n        >\n          <Dot direction={direction} />\n        </Marker>\n      )\n        : <Dot direction={direction} />\n      }\n\n    </Map>\n  )\n}\n\nMapDot.propTypes = {\n  direction: PropTypes.number,\n  latitude: PropTypes.number,\n  longitude: PropTypes.number,\n  editable: PropTypes.bool,\n  staticMap: PropTypes.bool,\n  onChange: PropTypes.func\n}\n\nexport default MapDot\n","import Satellite from './Satellite.json'\n// import BasicMap from './BasicMap.json'\nimport TopoMap from './TopoMap.json'\n\nimport {\n  Satellite as SatIcon,\n  SatelliteOutlined,\n  // DirectionsCar,\n  // DirectionsCarOutlined,\n  Terrain,\n  TerrainOutlined\n} from '@material-ui/icons'\n\nexport default [\n  {\n    toolTip: 'Sat',\n    Icon: SatelliteOutlined,\n    ActiveIcon: SatIcon,\n    color: 'green',\n    style: Satellite\n  },\n  {\n    toolTip: 'Topo',\n    Icon: TerrainOutlined,\n    ActiveIcon: Terrain,\n    color: 'blue',\n    style: TopoMap\n  }\n]\n","import { useState, useEffect, useRef } from 'react'\n\nexport const useGeolocation = () => {\n  const [state, setState] = useState({\n    accuracy: null,\n    altitude: null,\n    altitudeAccuracy: null,\n    heading: null,\n    latitude: null,\n    longitude: null,\n    speed: null,\n    timestamp: Date.now()\n  })\n  const mountedRef = useRef()\n  const watchIdRef = useRef()\n  mountedRef.current = true\n\n  const onEvent = event => {\n    if (mountedRef.current) {\n      setState({\n        accuracy: event.coords.accuracy,\n        altitude: event.coords.altitude,\n        altitudeAccuracy: event.coords.altitudeAccuracy,\n        heading: event.coords.heading,\n        latitude: event.coords.latitude,\n        longitude: event.coords.longitude,\n        speed: event.coords.speed,\n        timestamp: event.timestamp\n      })\n    }\n  }\n\n  useEffect(() => {\n    navigator.geolocation.getCurrentPosition(onEvent)\n    watchIdRef.current = navigator.geolocation.watchPosition(onEvent)\n\n    return () => {\n      mountedRef.current = false\n      navigator.geolocation.clearWatch(watchIdRef.current)\n    }\n  }, [navigator.geolocation])\n\n  return state\n}\n\nexport function useDeviceOrientation () {\n  const [deviceOrientation, setDeviceOrientation] = useState({ absolute: false, alpha: null, beta: null, gamma: null })\n\n  function handleDeviceOrientation (event) {\n    setDeviceOrientation({\n      absolute: event.absolute,\n      alpha: event.alpha,\n      beta: event.beta,\n      gamma: event.gamma\n    })\n  }\n\n  useEffect(() => {\n    window.addEventListener('deviceorientation', handleDeviceOrientation, true)\n\n    return () => {\n      window.removeEventListener('deviceorientation', handleDeviceOrientation)\n    }\n  }, [])\n\n  return deviceOrientation\n}\n\nexport function playClickAudio (clickSound) {\n  let audio = new Audio('data:audio/mp3;base64,' + clickSound.base64)\n  audio.play()\n}\n","import React, { useState } from 'react'\nimport PropTypes from 'prop-types'\nimport SpeedDial from '@material-ui/lab/SpeedDial'\nimport SpeedDialAction from '@material-ui/lab/SpeedDialAction'\n// import MapLayersIcon from '@material-ui/icons/Layers'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\n\nconst style = theme => ({\n  root: {\n    zIndex: 10,\n    position: 'absolute'\n  },\n  speedDialFab: {\n    border: '2px solid',\n    background: theme.palette.secondary.main,\n    color: theme.palette.secondary.contrastText,\n    width: 40,\n    height: 40\n  },\n  speedDialAction: {\n    border: '2px solid',\n    background: theme.palette.primary.main,\n    color: theme.palette.primary.contrastText,\n    marginTop: 0,\n    marginBottom: 0\n  },\n  speedDialIcon: {\n    // border: '1px solid red'\n  },\n  speedDialLabel: {\n    background: 'black',\n    color: 'white'\n  }\n})\n\nconst useStyles = makeStyles(style)\n\nconst StyleButtons = ({ controlPadding, currStyle, mapStyles, setCurrStyle }) => {\n  const [open, setOpen] = useState(false)\n  const classes = useStyles()\n  const theme = useTheme()\n  const noEventSetOpen = (e, state) => {\n    console.log('noEventSetOpen', e, state)\n    e.preventDefault()\n    e.stopPropagation()\n    setOpen(state)\n  }\n\n  if (!mapStyles || !Array.isArray(mapStyles) || mapStyles.length < 2 || !mapStyles[currStyle]) return null\n\n  const currStyleObj = mapStyles[currStyle]\n  const ActiveIcon = currStyleObj.ActiveIcon\n\n  return (\n    <div className={classes.root} style={{\n      top: controlPadding.top ? controlPadding.top : theme.spacing(2),\n      right: controlPadding.right ? controlPadding.right : theme.spacing(2)\n    }}>\n      {mapStyles.length > 1 && (\n        <SpeedDial\n          ariaLabel='SpeedDial example'\n          className={classes.speedDial}\n          classes={{\n            fab: classes.speedDialFab\n          }}\n          icon={<ActiveIcon className={classes.icon} />}\n          // onBlur={(e) => noEventSetOpen(e, false)}\n          onClick={(e) => noEventSetOpen(e, !open)}\n          onClose={(e) => noEventSetOpen(e, false)}\n          // onFocus={(e) => noEventSetOpen(e, true)}\n          // onMouseEnter={(e) => noEventSetOpen(e, true)}\n          // onMouseLeave={(e) => noEventSetOpen(e, false)}\n          open={open}\n          direction='left'\n        >\n\n          {mapStyles.map(({ Icon, ActiveIcon, toolTip }, idx) => (\n            <SpeedDialAction\n              key={`stylebutton${idx}`}\n              // Bit of a hack here. This function isn't quite ready for primetime\n              icon={<Icon className={classes.speedDialIcon} />}\n              tooltipPlacement='bottom'\n              ButtonProps={{\n                classes: {\n                  root: classes.speedDialAction\n                }\n              }}\n              TooltipClasses={{\n                tooltip: classes.speedDialLabel\n              }}\n              tooltipTitle={toolTip}\n              tooltipOpen\n              onClick={() => {\n                console.log('SET', idx)\n                setCurrStyle(idx)\n                setOpen(false)\n              }}\n            />\n          ))}\n\n        </SpeedDial>\n      ) }\n    </div>\n  )\n}\n\nStyleButtons.propTypes = {\n  // controlPadding: {top, right, bottom, left}\n  controlPadding: PropTypes.object,\n  currStyle: PropTypes.number,\n  mapStyles: PropTypes.array,\n  setCurrStyle: PropTypes.func\n}\nStyleButtons.defaultProps = {\n  controlPadding: {}\n}\n\nexport default StyleButtons\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport Typography from '@material-ui/core/Typography'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport Dialog from '@material-ui/core/Dialog'\nimport IconButton from '@material-ui/core/IconButton'\nimport DialogTitle from '@material-ui/core/DialogTitle'\n\nimport CloseIcon from '@material-ui/icons/Close'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst style = theme => ({\n  root: {\n\n  },\n  body: {\n    overflow: 'hidden',\n    whiteSpace: 'pre-line',\n    paddingBottom: theme.spacing(1)\n  },\n  title: {\n    alignSelf: 'flex-start',\n    width: '100%',\n    margin: 0,\n    display: 'flex',\n    padding: theme.spacing(2)\n  },\n  dlgTitle: {\n    flexGrow: 1\n  },\n  closeButton: {\n    alignSelf: 'flex-start',\n    color: theme.palette.grey[500]\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst BigText = ({ open, onClose, title, body }) => {\n  const classes = useStyles()\n  return (\n    <Dialog\n      scroll='paper'\n      open={open}\n      fullWidth\n      maxWidth='xl'\n      onClose={onClose}\n      aria-labelledby='simple-dialog-title'\n    >\n      <DialogTitle className={classes.title} disableTypography>\n        <Typography className={classes.dlgTitle}>{title}</Typography>\n        <IconButton className={classes.closeButton} onClick={onClose}>\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent>\n        <Typography variant='body2' className={classes.body}>{body}</Typography>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nBigText.propTypes = {\n  open: PropTypes.bool,\n  onClose: PropTypes.func,\n  title: PropTypes.string,\n  body: PropTypes.string\n}\n\nexport default BigText\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport Button from '@material-ui/core/Button'\nimport Typography from '@material-ui/core/Typography'\nimport DialogActions from '@material-ui/core/DialogActions'\n\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst style = theme => ({\n\n})\nconst useStyles = makeStyles(style)\n\nconst DeleteDialog = ({ title, message, onConfirm, open }) => {\n  const classes = useStyles()\n  return (\n    <Dialog\n      className={classes.root}\n      disableBackdropClick\n      open={open}\n      disableEscapeKeyDown\n      maxWidth='xl'\n      aria-labelledby='confirmation-dialog-title'\n    >\n      <DialogTitle id='confirmation-dialog-title'>{title}</DialogTitle>\n      <DialogContent>\n        <Typography>\n          {message}\n        </Typography>\n\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => onConfirm(false)} color='primary'>\n      No\n        </Button>\n        <Button onClick={() => onConfirm(true)} color='primary'>\n      Yes\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nDeleteDialog.propTypes = {\n  open: PropTypes.bool,\n  title: PropTypes.string.isRequired,\n  message: PropTypes.string.isRequired,\n  onConfirm: PropTypes.func.isRequired\n}\n\nexport default DeleteDialog\n","import React, { useState } from 'react'\nimport PropTypes from 'prop-types'\n// import Typography from '@material-ui/core/Typography'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport TextField from '@material-ui/core/TextField'\nimport Button from '@material-ui/core/Button'\nimport DialogTitle from '@material-ui/core/DialogTitle'\n\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst style = theme => ({\n  root: {\n\n  },\n  body: {\n    overflow: 'hidden',\n    whiteSpace: 'pre-line',\n    paddingBottom: theme.spacing(1)\n  },\n  title: {\n    margin: 0,\n    padding: theme.spacing(2)\n  },\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500]\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst BigTextEdit = ({ open, onOk, title, body, multiline }) => {\n  const classes = useStyles()\n  const [value, setValue] = useState(body || '')\n  return (\n    <Dialog\n      scroll='paper'\n      open={open}\n      fullWidth\n      onClose={() => onOk(value)}\n    >\n      <DialogTitle className={classes.title}>\n        {title}\n      </DialogTitle>\n      <DialogContent>\n        <TextField\n          className={classes.body}\n          multiline={multiline}\n          fullWidth\n          rows={6}\n          rowsMax={20}\n          onChange={e => setValue(e.target.value)}\n          defaultValue={body}\n        />\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => onOk(body)}>Cancel</Button>\n        <div style={{ flexGrow: 1 }} />\n        <Button onClick={() => onOk(value)}>Ok</Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nBigTextEdit.propTypes = {\n  open: PropTypes.bool,\n  multiline: PropTypes.bool,\n  onOk: PropTypes.func,\n  title: PropTypes.string,\n  body: PropTypes.string\n}\n\nexport default BigTextEdit\n","import React, { useState } from 'react'\nimport PropTypes from 'prop-types'\nimport Typography from '@material-ui/core/Typography'\nimport Slider from '@material-ui/lab/Slider'\n// import { Menu as MenuIcon } from '@material-ui/icons'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst style = theme => ({\n  root: {\n    color: 'white',\n    zIndex: 10,\n    display: 'flex',\n    flexDirection: 'column',\n    position: 'absolute',\n    height: '50%',\n    top: '45%',\n    left: '0',\n    transform: 'translateY(-50%)'\n  },\n  sliderLabel: {\n    display: 'block',\n    flexGrow: 1,\n    textAlign: 'center',\n    padding: theme.spacing(3, 0, 3, 0)\n  },\n  container: {\n    // padding: '10px 36px'\n  },\n  track: {\n    width: `4px!important`,\n    background: 'white'\n  },\n  thumb: {\n    transform: 'translate(50%, -50%)',\n    background: 'white',\n    width: 30,\n    height: 30\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst PhotoFadeSlider = ({ defaultValue, onChange }) => {\n  const classes = useStyles()\n  // we control the state internally so we get a smooth experience\n  const [slider, setSlider] = useState(defaultValue)\n\n  const onSliderMove = (event, value) => {\n    setSlider(value)\n    // send it back if we need to\n    onChange(value)\n  }\n\n  return (\n    <div className={classes.root}>\n      <Typography className={classes.sliderLabel} color='inherit' variant='caption'>New</Typography>\n      <Slider\n        classes={{\n          container: classes.container,\n          track: classes.track,\n          thumb: classes.thumb\n        }}\n        value={slider}\n        aria-labelledby='label'\n        onChange={onSliderMove}\n        vertical\n      />\n      <Typography className={classes.sliderLabel} color='inherit' variant='caption'>Reference</Typography>\n    </div>\n  )\n}\n\nPhotoFadeSlider.propTypes = {\n  defaultValue: PropTypes.number,\n  onChange: PropTypes.func\n}\n\nPhotoFadeSlider.defaultProps = {\n  defaultValue: 100,\n  onChange: () => {}\n}\n\nexport default PhotoFadeSlider\n","export default theme => ({\n  root: {\n    width: '100%'\n  },\n  tagContainer: {\n  },\n  formControl: {\n\n  },\n  actionButtons: {\n    textAlign: 'right'\n  },\n  noOptionsMessage: {\n    padding: theme.spacing(1, 2)\n  },\n  singleValue: {\n    fontSize: 16\n  },\n  placeholder: {\n    position: 'absolute',\n    left: 2,\n    fontSize: 16\n  },\n  input: {\n    display: 'flex',\n    padding: 0\n  },\n  valueContainer: {\n    display: 'flex',\n    flexWrap: 'wrap',\n    flex: 1,\n    alignItems: 'center',\n    overflow: 'hidden'\n  },\n  paper: {\n    position: 'absolute',\n    zIndex: 1,\n    marginTop: theme.spacing(1),\n    left: 0,\n    right: 0\n  }\n})\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\nimport Typography from '@material-ui/core/Typography'\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport TagChip from '../tags/TagChip'\nimport style from './TagControl.style'\n\nconst useStyles = makeStyles(style)\n/**\n * Just to be clear: the state here is being stored as []\n */\nconst TagControl = ({ tags, label, tagConfig, className }) => {\n  const classes = useStyles()\n  // Filter to just this tag type\n  const tagValues = tags.filter(tag => tag.typeId === tagConfig.id && !tag.coords)\n\n  return (\n    <div className={classNames(classes.root, className)}>\n      <Typography variant='overline' className={classes.fieldTitle}>\n        {tagConfig.label}\n      </Typography>\n      <div className={classes.tagContainer}>\n        {tagValues.map((tag, idx) => (\n          <TagChip tag={tag} key={`tagchip${idx}`} color={tagConfig.color} />\n        ))}\n      </div>\n\n    </div>\n  )\n}\n\nTagControl.propTypes = {\n  className: PropTypes.string,\n  label: PropTypes.string,\n  tags: PropTypes.array,\n  tagConfig: PropTypes.object\n}\n\nexport default TagControl\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\nimport {\n  TextField,\n  Typography\n} from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { timestampToHTML5Input, HTML5InputToTimestamp } from '../../../../lib/datelib'\n\nconst style = theme => ({\n  root: {\n  },\n  rootEdit: {\n  },\n  formControl: {\n    width: '100%'\n  },\n  textBody: {\n    whiteSpace: 'pre-line'\n  },\n  actionButtons: {\n    textAlign: 'right'\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst DateControl = ({\n  label,\n  value,\n  hint,\n  onChange,\n  className\n}) => {\n  const classes = useStyles()\n  return (\n    <div className={classNames(classes.root, className)}>\n      <Typography variant='overline' className={classes.fieldTitle}>\n        {label}\n      </Typography>\n      <TextField\n        type='datetime-local'\n        fullWidth\n        value={timestampToHTML5Input(value)}\n        className={classes.textField}\n        onChange={(e) => onChange(HTML5InputToTimestamp(e.target.value))}\n      />\n      {hint && <Typography variant='caption' className={classes.hint}>{hint}</Typography>}\n    </div>\n  )\n}\n\nDateControl.propTypes = {\n  className: PropTypes.string,\n  label: PropTypes.string.isRequired,\n  hint: PropTypes.string,\n  value: PropTypes.string, // all timestamps come in as integerstrings\n  onChange: PropTypes.func.isRequired\n}\n\nexport default DateControl\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\nimport uuid from 'uuid/v4'\nimport Paper from '@material-ui/core/Paper'\nimport TextField from '@material-ui/core/TextField'\nimport Typography from '@material-ui/core/Typography'\nimport MenuItem from '@material-ui/core/MenuItem'\n\nimport Select from 'react-select'\nimport CreatableSelect from 'react-select/lib/Creatable'\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport TagChip from '../tags/TagChip'\nimport style from './TagControl.style'\nconst useStyles = makeStyles(style)\n\n/**\n * Just to be clear: the state here is being stored as []\n */\nconst TagControl = ({\n  tags, onChange,\n  hint, tagConfig, className\n}) => {\n  const classes = useStyles()\n  // console.log('TagControl Rnder', { tags, tagConfig })\n  const onSelectChange = (inputValue, { action, removedValue, option }) => {\n    // If this was the last tag then close the menu\n    switch (action) {\n      case 'clear':\n        onChange([])\n        break\n      case 'remove-value':\n        // Remember we need to potentially remove it from the old AND the new\n        onChange(tags.filter(val => val.id !== removedValue.value))\n        break\n      case 'select-option':\n        const newVal = {\n          ...tagConfig.values.find(tcv => tcv.id === option.value),\n          typeId: tagConfig.id\n        }\n        onChange([...tags, newVal])\n        break\n      case 'create-option':\n        const newLabel = inputValue.find(v => v.__isNew__).value\n        const newCreateVal = {\n          label: newLabel,\n          id: uuid(),\n          typeId: tagConfig.id\n        }\n        onChange([...tags, newCreateVal])\n        break\n      default:\n        break\n    }\n  }\n\n  const SingleValue = ({ removeProps, innerProps, data, ...props }) => {\n    // console.log('SingleValue PROPS', { removeProps, innerProps, data, props })\n    return (\n      <TagChip tag={data} onDelete={(e) => {\n        // console.log('EVENT', e)\n        removeProps.onClick()\n      }} color={tagConfig.color} edit />\n    )\n  }\n  SingleValue.propTypes = {\n    removeProps: PropTypes.any,\n    innerProps: PropTypes.any,\n    data: PropTypes.any\n  }\n\n  const MultiValue = ({ removeProps, innerProps, data, ...props }) => {\n    // console.log('MultiValue PROPS', { removeProps, innerProps, data, props })\n    return (\n      <TagChip tag={data} onDelete={(e) => {\n        // console.log('EVENT', e)\n        removeProps.onClick()\n      }} color={tagConfig.color} edit />\n    )\n  }\n  MultiValue.propTypes = {\n    removeProps: PropTypes.any,\n    innerProps: PropTypes.any,\n    data: PropTypes.any\n  }\n\n  // Filter to just this tag type\n  const tagValues = tags.filter(tag => tag.typeId === tagConfig.id && !tag.coords)\n  // Now format it as {label, value: id} for react-select\n  const selectOptions = tagValues.map(val => ({ label: val.label, value: val.id }))\n\n  // Filter out things we haven't chosen yet\n  // Also transform the options into a label/value pair for react-select\n  const remainingTags = tagConfig.values\n    .filter(val => tagValues.map(t => t.id).indexOf(val.id) === -1)\n    .map(val => ({ label: val.label, value: val.id }))\n\n  // console.log('TAG DEBUG', { value, tagValues, tagConfig })\n\n  return (\n    <div className={classNames(classes.root, className)}>\n      <Typography variant='overline' className={classes.fieldTitle}>\n        {tagConfig.label}\n      </Typography>\n      {!tagConfig.allowAdditions && (\n        <Select\n          options={remainingTags}\n          classes={classes}\n          isFocused\n          components={{\n            Control,\n            Menu,\n            //   MultiValue,\n            NoOptionsMessage,\n            Option,\n            Placeholder,\n            //   SingleValue,\n            ValueContainer\n          }}\n          deleteRemoves\n          value={selectOptions}\n          isClearable={false}\n          onChange={onSelectChange}\n          placeholder='Select Tags'\n          isMulti\n          isSearchable\n        />\n      ) }\n      { tagConfig.allowAdditions && (\n        <CreatableSelect\n          options={remainingTags}\n          classes={classes}\n          isFocused\n          deleteRemoves\n          components={{\n            Control,\n            Menu,\n            //   MultiValue,\n            NoOptionsMessage,\n            Option,\n            Placeholder,\n            //   SingleValue,\n            ValueContainer\n          }}\n          value={selectOptions}\n          isClearable={false}\n          onChange={onSelectChange}\n          placeholder='Select Tags'\n          isMulti\n          isSearchable\n        />\n      )}\n      {hint && <Typography variant='caption' className={classes.hint}>{hint}</Typography>}\n    </div>\n  )\n}\n\nTagControl.propTypes = {\n  className: PropTypes.string,\n  hint: PropTypes.string,\n  tags: PropTypes.array,\n  onChange: PropTypes.func.isRequired,\n  tagConfig: PropTypes.object\n}\n\nexport default TagControl\n\nfunction Control (props) {\n  // console.log('CONTROL PROPS', props)\n  return (\n    <TextField\n      fullWidth\n      InputProps={{\n        inputComponent,\n        inputProps: {\n          className: props.selectProps.classes.input,\n          inputRef: props.innerRef,\n          children: props.children,\n          // innerProps: {\n          onMouseDown: (e) => {\n            props.innerProps.onMouseDown(e)\n          },\n          onTouchEnd: (e) => {\n            props.innerProps.onTouchEnd(e)\n          }\n          // }\n          // ...props.innerProps\n        }\n      }}\n      {...props.selectProps.textFieldProps}\n    />\n  )\n}\n\nconst NoOptionsMessage = ({ innerProps, selectProps, children }) => (\n  <Typography\n    color='textSecondary'\n    className={selectProps.classes.noOptionsMessage}\n    {...innerProps}\n  >\n    {children}\n  </Typography>\n)\n\nconst Menu = ({ selectProps, innerProps, children }) => (\n  <Paper square className={selectProps.classes.paper} {...innerProps}>\n    {children}\n    {/* {console.log('MENU PROPS', { selectProps, innerProps, children })} */}\n  </Paper>\n)\n\nconst inputComponent = ({ inputRef, ...props }) => <div ref={inputRef} {...props} />\n\nconst Placeholder = (props) => (\n  <Typography\n    color='textSecondary'\n    className={props.selectProps.classes.placeholder}\n    {...props.innerProps}\n  >\n    {props.children}\n  </Typography>\n)\n\nconst Option = ({ innerRef, isFocused, isSelected, innerProps, children }) => (\n  <MenuItem\n    buttonRef={innerRef}\n    selected={isFocused}\n    component='div'\n    style={{ fontWeight: isSelected ? 500 : 400 }}\n    {...innerProps}\n  >\n    {children}\n  </MenuItem>\n)\n\nconst ValueContainer = ({ selectProps, children }) => (\n  <div className={selectProps.classes.valueContainer}>{children}</div>\n)\nValueContainer.propTypes = {\n  selectProps: PropTypes.any,\n  children: PropTypes.any\n}\n","import React, { useState } from 'react'\nimport PropTypes from 'prop-types'\n// import Typography from '@material-ui/core/Typography'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport Typography from '@material-ui/core/Typography'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport Button from '@material-ui/core/Button'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport IconButton from '@material-ui/core/IconButton'\n\nimport CloseIcon from '@material-ui/icons/Close'\nimport TagControl from '../controls/TagControl'\n\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst style = theme => ({\n  root: {\n  },\n  dlgContent: {\n    // position: 'relative',\n    // maxWidth: '200px',\n    overflowY: 'visible!important',\n    paddingBottom: 300\n    // overflowX: 'hidden'\n  },\n  title: {\n    width: '100%',\n    margin: 0,\n    display: 'flex',\n    padding: theme.spacing(2)\n  },\n  dlgTitle: {\n    flexGrow: 1\n  },\n  closeButton: {\n    color: theme.palette.grey[500]\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst TagEdit = ({ open, title, onOk, onCancel, tags, tagConfig }) => {\n  const classes = useStyles()\n  const [value, setValue] = useState(tags)\n  return (\n    <Dialog\n      className={classes.root}\n      scroll='body'\n      fullScreen\n      open={open}\n      onClose={() => onOk(value)}\n    >\n      <DialogTitle className={classes.title} disableTypography>\n        <Typography className={classes.dlgTitle}>{title}</Typography>\n        <IconButton className={classes.closeButton} onClick={onCancel}>\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent className={classes.dlgContent}>\n        <TagControl\n          className={classes.field}\n          tags={value}\n          tagConfig={tagConfig}\n          onChange={setValue}\n        />\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={onCancel}>Cancel</Button>\n        <div style={{ flexGrow: 1 }} />\n        <Button onClick={() => setValue(tags)}>Reset</Button>\n        <Button onClick={() => onOk(value)}>Ok</Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nTagEdit.propTypes = {\n  open: PropTypes.bool,\n  title: PropTypes.string,\n  onOk: PropTypes.func,\n  onCancel: PropTypes.func,\n  tags: PropTypes.array.isRequired,\n  tagConfig: PropTypes.object.isRequired\n}\n\nexport default TagEdit\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\nimport Typography from '@material-ui/core/Typography'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { formatDate } from '../../../../lib/datelib'\n\nconst style = theme => ({\n  root: { },\n  rootEdit: { },\n  formControl: {\n    width: '100%'\n  },\n  textBody: {\n    whiteSpace: 'pre-line'\n  },\n  actionButtons: {\n    textAlign: 'right'\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst DateView = ({\n  label,\n  value,\n  className\n}) => {\n  const classes = useStyles()\n  return (\n    <div className={classNames(classes.root, className)}>\n      <Typography variant='overline' className={classes.fieldTitle}>\n        {label}\n      </Typography>\n      <Typography variant='body1' className={classes.hint}>{value ? formatDate(value) : ''}</Typography>\n    </div>\n  )\n}\n\nDateView.propTypes = {\n  className: PropTypes.string,\n  label: PropTypes.string.isRequired,\n  value: PropTypes.string\n}\n\nexport default DateView\n","import React, { useContext, useState } from 'react'\nimport PropTypes from 'prop-types'\n\nimport Typography from '@material-ui/core/Typography'\nimport Divider from '@material-ui/core/Divider'\nimport List from '@material-ui/core/List'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemText from '@material-ui/core/ListItemText'\n\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport TagView from '../controls/TagView'\nimport ShortLongText from '../controls/ShortLongText'\nimport DateControl from '../controls/DateControl'\nimport TagClass from '../../../../lib/Tags'\nimport BigTextEdit from '../dialogs/BigTextEdit'\nimport BigText from '../dialogs/BigText'\nimport TagEdit from '../dialogs/TagEdit'\n\nimport { SeriesContext } from '../../contexts'\nimport DateView from '../controls/DateView'\n\nconst style = theme => ({\n  root: {\n    height: '90%',\n    width: '85%'\n  },\n  dlgTitleContainer: {\n    display: 'flex',\n    padding: 0\n  },\n  catTagTitle: {\n    marginTop: theme.spacing(2)\n  },\n  dlgTitle: {\n    flexGrow: 1,\n    paddingTop: theme.spacing(2),\n    paddingBottom: theme.spacing(1),\n    paddingLeft: theme.spacing(3)\n  },\n  field: {\n    marginBottom: theme.spacing(2)\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst DIALOGS = {\n  NOTEEDIT: 'noteEdit',\n  NOTEVIEW: 'noteView',\n  PHOTOTAKEN: 'taken',\n  TAGEDIT: 'tag',\n  CANCEL: 'cancel'\n}\n\nconst PhotoInfo = ({ canEdit, photo, delta, onChange }) => {\n  const classes = useStyles()\n  const { seriesConfig } = useContext(SeriesContext)\n  const [{ activeDialog, activeDialogContext }, setActiveDialog] = useState({})\n\n  const tagInst = new TagClass(seriesConfig, delta.tags || photo.tags)\n\n  let metaKeys = []\n  try {\n    metaKeys = photo.meta ? Object.keys(JSON.parse(photo.meta)) : []\n  }\n  catch (e) {\n    console.error(e)\n  }\n  return (\n    <div>\n      {canEdit ? (\n        <DateControl\n          className={classes.field}\n          label='Photo taken on'\n          value={delta.takenOn || photo.takenOn}\n          onChange={takenOn => onChange({ takenOn })}\n          canEdit={canEdit}\n        />\n      )\n        : (\n          <DateView\n            label='Photo taken on'\n            value={delta.takenOn || photo.takenOn}\n          />\n        )}\n\n      {(canEdit || photo.note) && (\n        <ShortLongText\n          label='Photo Note'\n          text={delta.note || photo.note}\n          onClick={() => {\n            if (canEdit) setActiveDialog({ activeDialog: DIALOGS.NOTEEDIT })\n            else setActiveDialog({ activeDialog: DIALOGS.NOTEVIEW })\n          }}\n        />\n      )}\n      <Typography variant='subtitle1' className={classes.catTagTitle}>Category tags</Typography>\n      <Divider />\n      {tagInst.seriesConfig.getNonXYTagTypes().map((tt, idx) => (\n        <div\n          key={`tagtype-${idx}`}\n          onClick={() => canEdit ? setActiveDialog({ activeDialog: DIALOGS.TAGEDIT, activeDialogContext: tt }) : null}\n        >\n          <TagView\n            className={classes.field}\n            label={tt.label}\n            tags={delta.tags || photo.tags}\n            tagConfig={tt}\n          />\n        </div>\n      ))}\n\n      {metaKeys.length > 0 && Object.keys(seriesConfig.meta).length > 0 && (\n        <React.Fragment>\n          <Typography className={classes.heading}>Metadata</Typography>\n          <Divider />\n          <List className={classes.list}>\n            {metaKeys.map((key, idx) => seriesConfig.meta[key] ? (\n              <ListItem key={`metadata${idx}`}>\n                <ListItemText\n                  primary={seriesConfig.meta[key].label}\n                  secondary={seriesConfig.meta[key].render(photo.meta[key])}\n                />\n              </ListItem>\n            ) : null\n            )}\n          </List>\n        </React.Fragment>\n      )}\n      {activeDialog && activeDialog === DIALOGS.NOTEEDIT && (\n        <BigTextEdit\n          open\n          multiline\n          onOk={note => {\n            onChange({ note })\n            setActiveDialog({})\n          }}\n          title='Edit Photo Note'\n          body={delta.note || photo.note}\n        />\n      )}\n      {activeDialog && activeDialog === DIALOGS.NOTEVIEW && (\n        <BigText\n          open\n          multiline\n          onClose={() => setActiveDialog({})}\n          title='Photo Note'\n          body={delta.note || photo.note}\n        />\n      )}\n      {activeDialog && activeDialog === DIALOGS.TAGEDIT && (\n        <TagEdit\n          open\n          title={`Edit Tags: ${activeDialogContext.label}`}\n          onOk={tags => {\n            setActiveDialog({})\n            onChange({ tags })\n          }}\n          onCancel={() => setActiveDialog({})}\n          tags={delta.tags || photo.tags}\n          tagConfig={activeDialogContext}\n        />\n      )}\n    </div>\n  )\n}\n\nPhotoInfo.propTypes = {\n  canEdit: PropTypes.bool,\n  onChange: PropTypes.func.isRequired,\n  photo: PropTypes.object.isRequired,\n  delta: PropTypes.object.isRequired\n}\n\nexport default PhotoInfo\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst style = theme => ({\n  root: {\n    width: 1,\n    height: 1,\n    zIndex: 1\n  },\n  svgDot: {\n    width: 20,\n    height: 20,\n    position: 'absolute',\n    top: '50%',\n    left: '50%',\n    textAlign: 'center',\n    transformOrigin: '50% 50%',\n    transform: 'translateY(-50%) translateX(-50%)'\n  },\n  svgAccuracyDot: {\n    position: 'absolute',\n    top: '50%',\n    left: '50%',\n    textAlign: 'center',\n    transformOrigin: '50% 50%',\n    transform: 'translateY(-50%) translateX(-50%)'\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst MyLocation = ({ position, projection }) => {\n  const classes = useStyles()\n  const accuracy = 20 // assume 20m to start\n  // metersPerPixel [12, 12, 12]\n  // pixelsPerMeter [0: 0.08029229250399847, 1: -0.08029229250399847, 2: 0.08029229250399847]\n  // console.log('POSITION', { position, projection })\n  const accHeight = projection.pixelsPerMeter[0] * (accuracy)\n  const accWidth = projection.pixelsPerMeter[1] * (accuracy)\n  return (\n    <div className={classes.root}>\n      {/* This is the accuracy radius */}\n      <svg\n        style={{ height: accHeight, width: accWidth }}\n        className={classes.svgAccuracyDot}\n        version='1.1'\n        viewBox='0, 0, 100, 100'\n      >\n        <circle cx='50' cy='50' r={49}\n          stroke='#8888FF'\n          fillOpacity='0.4'\n          strokeWidth='1'\n          fill='#AAAAFF'\n        />\n      </svg>\n      {/* This is the dot */}\n      <svg className={classes.svgDot} version='1.1' viewBox='0, 0, 10, 10'>\n        <circle cx='5' cy='5' r='4'\n          stroke='#FFFFFF'\n          strokeWidth='1'\n          fill='#4444FF'\n        />\n      </svg>\n    </div>\n  )\n}\n\nMyLocation.propTypes = {\n  position: PropTypes.object,\n  projection: PropTypes.object\n}\n\nexport default MyLocation\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport Fab from '@material-ui/core/Fab'\nimport MyLocationIcon from '@material-ui/icons/MyLocation'\n\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\n\nconst style = theme => ({\n  root: {\n    border: '1px solid',\n    background: theme.palette.grey[100],\n    color: 'black',\n    width: 40,\n    height: 40,\n    zIndex: 10,\n    position: 'absolute'\n    // margin: theme.spacing(0.5),\n    // padding: theme.spacing(0.5),\n    // border: '2px solid',\n    // borderRadius: theme.spacing(1),\n    // background: theme.palette.common.white,\n    // fontSize: 20,\n    // position: 'absolute',\n    // zIndex: 100,\n    // bottom: theme.spacing(10),\n    // right: theme.spacing(2)\n  }\n})\n\nconst useStyles = makeStyles(style)\n\nconst MyLocationButton = ({ onClick, controlPadding, disabled }) => {\n  const classes = useStyles()\n  const theme = useTheme()\n  return (\n    <Fab\n      disabled={disabled}\n      style={{\n        top: 56 + (controlPadding.top ? controlPadding.top : theme.spacing(2)),\n        right: controlPadding.right ? controlPadding.right : theme.spacing(2)\n      }}\n      aria-label='myLocation'\n      className={classes.root}\n      onClick={onClick}\n    >\n      <MyLocationIcon />\n    </Fab>\n  )\n}\n\nMyLocationButton.propTypes = {\n  controlPadding: PropTypes.object,\n  onClick: PropTypes.func.isRequired,\n  disabled: PropTypes.bool\n}\n\nexport default MyLocationButton\n","import React, { useState, useRef, useMemo, useEffect } from 'react'\nimport ReactMapGL, { NavigationControl, Marker, FlyToInterpolator } from 'react-map-gl'\nimport PropTypes from 'prop-types'\nimport { easeCubic } from 'd3-ease'\nimport WebMercatorViewport, { getDistanceScales } from 'viewport-mercator-project'\nimport useComponentSize from '../../lib/useComponentSize'\nimport MyLocation from './markers/MyLocation'\nimport { useGeolocation } from '../../lib/sensors'\n// import { debounce } from '../../lib/util'\nimport StyleButtons from './controls/StyleButtons'\nimport MyLocationButton from './controls/MyLocationButton'\nimport { mapConfig } from '../../config'\nimport classNames from 'classnames'\nimport 'mapbox-gl/dist/mapbox-gl.css'\nimport './BaseMap.css'\n\n/**\n * Note that this component technically has state but it is designed to be functionally stateless\n */\nconst BaseMap = (props) => {\n  // pull what we need out of the props\n  const {\n    showMe,\n    children,\n    mapStyles,\n    controlPadding,\n    viewport: initViewport,\n    bounds,\n    lockToBounds,\n    lockPan,\n    initStyle,\n    onViewportChange: incomingOnViewportChange,\n    onTransitionStart: incomingOnTransitionStart,\n    onTransitionEnd: incomingOnTransitionEnd,\n    transitions,\n    onMapDataEvent,\n    stylechooser,\n    ...passthroughProps\n  } = props\n\n  const mapContainerRef = useRef(null)\n  const mapBoxRef = useRef(null)\n  const innerTransitionsRef = useRef(null)\n\n  const { size } = useComponentSize(mapContainerRef)\n\n  const [currStyle, setCurrStyle] = useState(initStyle)\n\n  // This is the truth of the viewport!!\n  const [viewport, setViewport] = useState({ ...defaultViewVals, ...initViewport })\n  const [isTransitioning, setIsTransitioning] = useState(false)\n  const [projection, setProjection] = useState(null)\n\n  let myPosition = {}\n  if (showMe) {\n    myPosition = useGeolocation()\n  }\n  const geoMarker = (myPosition.latitude && myPosition.longitude)\n    ? (\n      <Marker key='myPos' className='myPosMarker' latitude={myPosition.latitude} longitude={myPosition.longitude} style={{ zIndex: 1 }}>\n        <MyLocation position={myPosition} projection={projection} />\n      </Marker>\n    ) : null\n\n  // Recalculate the projection if we need to but only when zoom changes\n  useMemo(() => {\n    if (!size || size.width < 10 || size.height < 10) return\n    if (mapStyles.length <= currStyle) setCurrStyle(initStyle)\n    try {\n      const projection = getDistanceScales(viewport)\n      // console.log('recalcProjection', { projection, size })\n      setProjection(projection)\n    }\n    catch (e) {\n      console.log('ERROR', viewport)\n      console.error(e)\n    }\n  }, [viewport.zoom, size])\n\n  const flyToMe = () => {\n    if (!myPosition.latitude || !myPosition.longitude) return\n    const transitionTime = 2000\n    innerTransitionsRef.current = {\n      transitionDuration: transitionTime,\n      transitionInterpolator: new FlyToInterpolator(),\n      transitionEasing: easeCubic\n    }\n    // You get `transitionTime` ms to figure this out. then we just jump\n    setTimeout(() => {\n      if (innerTransitionsRef.current) innerTransitionsRef.current = null\n    }, transitionTime)\n    setViewport({\n      ...viewport,\n      latitude: myPosition.latitude,\n      longitude: myPosition.longitude,\n      zoom: viewport.zoom > 10 ? viewport.zoom : 12\n    })\n  }\n\n  /**\n   * Callback fired when the user changes the viewport object\n   * @param {*} viewport\n   */\n  const onViewportChange = (viewportChange) => {\n    const newViewport = { ...viewportChange }\n    // Here we set/reset the bounds\n    if (bounds && lockToBounds) {\n      if (newViewport.longitude < bounds[0]) newViewport.longitude = bounds[0]\n      else if (newViewport.longitude > bounds[2]) newViewport.longitude = bounds[2]\n\n      if (newViewport.latitude < bounds[1]) newViewport.latitude = bounds[1]\n      else if (newViewport.latitude > bounds[3]) newViewport.latitude = bounds[3]\n    }\n    if (lockPan) {\n      newViewport.latitude = viewport.latitude\n      newViewport.longitude = viewport.longitude\n    }\n\n    // console.log('onViewportChange', newViewport)\n    // Fire the external callback so parent components can track viewport if they need to\n    if (!isTransitioning && typeof incomingOnViewportChange === 'function') {\n      incomingOnViewportChange({\n        viewport: newViewport,\n        size,\n        projection,\n        map: mapBoxRef.current && mapBoxRef.current.getMap()\n      })\n    }\n    setViewport(newViewport)\n  }\n\n  const recalcZoomBounds = () => {\n    // console.log('Should I recalc viewbounds?')\n    if (!bounds || !size || size.width < 10 || size.height < 10 || isTransitioning) return\n    // On the first run we're going to try to center the bounds.\n    const [minlng, minlat, maxlng, maxlat] = bounds\n    try {\n      console.log('recalcZoomBounds')\n      const { longitude, latitude, zoom } = new WebMercatorViewport({ ...size, ...viewport }).fitBounds(\n        [ [minlng, minlat], [maxlng, maxlat] ],\n        { padding: 40, offset: [0, 0] }\n      )\n      console.log('Changing Zoom ', bounds, viewport.zoom, zoom, viewport)\n\n      // console.log('recalcZoomBounds')\n      setViewport({ ...viewport, longitude, latitude, zoom })\n    }\n    catch (e) {\n      // Sometimes we don't have a valid bound. Don't make a big deal out of it.\n      console.error(e)\n    }\n  }\n\n  const handleTransitionStart = () => {\n    console.log('handleTransitionStart (internal)')\n    setIsTransitioning(true)\n    if (typeof incomingOnTransitionStart === 'function') incomingOnTransitionStart()\n  }\n\n  const handleTransitionEnd = () => {\n    console.log('handleTransitionEnd (internal)')\n    setIsTransitioning(false)\n    innerTransitionsRef.current = null\n    if (incomingOnTransitionEnd) incomingOnTransitionEnd()\n    if (typeof incomingOnViewportChange === 'function') {\n      incomingOnViewportChange({\n        viewport,\n        size,\n        projection,\n        map: mapBoxRef.current && mapBoxRef.current.getMap()\n      })\n    }\n  }\n\n  // RecalcZoombounds should only be done sparingly\n  useMemo(recalcZoomBounds, [size, bounds])\n\n  useEffect(() => {\n    setViewport({ ...viewport, ...initViewport })\n  }\n  , [initViewport])\n\n  return (\n    <div className={classNames('mapContainer', props.className)} ref={mapContainerRef}>\n      {size.height > 0 && size.width > 0 && (\n        <ReactMapGL\n          {...viewport}\n          {...(innerTransitionsRef.current || transitions)}\n          ref={map => {\n            mapBoxRef.current = map\n          }}\n          height={size.height}\n          width={size.width}\n          mapStyle={currStyle < mapStyles.length ? mapStyles[currStyle].style : mapStyles[0].style}\n          onData={onMapDataEvent}\n          onTransitionStart={handleTransitionStart}\n          onTransitionEnd={handleTransitionEnd}\n          dragPan={!lockPan}\n          onViewportChange={onViewportChange}\n          mapboxApiAccessToken={mapConfig.mapBoxToken}\n          {...passthroughProps}\n        >\n          {\n            children && Array.isArray(children)\n              ? children.map((c, idx) => c ? React.cloneElement(\n                handleChild(c, viewport, size.height, size.width, projection),\n                { key: `mapChild-${idx}` }\n              ) : null)\n              : handleChild(children, viewport, size.height, size.width, projection)\n          }\n          {/* Make sure the controls are above everything else */}\n          { stylechooser && (\n            <StyleButtons\n              controlPadding={controlPadding}\n              currStyle={currStyle}\n              mapStyles={mapStyles}\n              setCurrStyle={setCurrStyle}\n            />\n          )}\n          {/* Augment children with some props they need to survive in this harsh world */}\n          { !props.hideNavControls && (\n            <NavigationControl\n              onViewportChange={viewport => onViewportChange({ ...viewport, ...size })}\n              showZoom={!props.touchZoom === false && !props.scrollZoom === false}\n              showCompass={!props.touchRotate === false && !props.dragRotate === false}\n            />\n          )}\n          {showMe && (\n            <React.Fragment>\n              {geoMarker}\n              <MyLocationButton disabled={!myPosition || !myPosition.latitude} controlPadding={controlPadding} onClick={flyToMe} />\n            </React.Fragment>\n          )}\n        </ReactMapGL>\n      )}\n    </div>\n  )\n}\n\nBaseMap.propTypes = {\n  // Anything else we want to add to the map\n  children: PropTypes.any,\n  data: PropTypes.array,\n  // Maybe we want map controls to be padded\n  controlPadding: PropTypes.object,\n\n  showMe: PropTypes.bool,\n\n  // Separate transitions from viewport so we can set them independently\n  transitions: PropTypes.object,\n  initStyle: PropTypes.number,\n\n  // Some switches to make things easier\n  stylechooser: PropTypes.bool,\n  lockPan: PropTypes.bool,\n  lockRotation: PropTypes.bool,\n  lockZoom: PropTypes.bool,\n  lockToBounds: PropTypes.bool,\n  hideNavControls: PropTypes.bool,\n\n  // bounds of the map. may be locked or not [minlng, minlat], [maxlng, maxlat]\n  bounds: PropTypes.array,\n\n  // List of valid styles that will get picker buttons\n  mapStyles: PropTypes.array,\n\n  onMapDataEvent: PropTypes.func,\n  onViewportChange: PropTypes.func\n}\n\nBaseMap.defaultProps = {\n  controlPadding: {},\n  stylechooser: true,\n  initStyle: 0,\n  mapStyles: mapConfig.styles,\n  lockToBounds: false\n}\n\nexport default BaseMap\n\nconst defaultViewVals = {\n  latitude: 49.3050394,\n  longitude: -123.1398254,\n  bearing: 0,\n  pitch: 0,\n  zoom: 12\n}\n\nfunction handleChild (child, viewport, height, width, projection) {\n  return typeof child === 'function'\n    ? child(viewport, height, width, projection)\n    : child\n}\n","import React, { useState, useMemo } from 'react'\nimport PropTypes from 'prop-types'\nimport Typography from '@material-ui/core/Typography'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport Button from '@material-ui/core/Button'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport FormLabel from '@material-ui/core/FormLabel'\nimport Slider from '@material-ui/lab/Slider'\n\nimport MapDot from '../../../maps/MapDot'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst style = theme => ({\n  root: {\n\n  },\n  dlgContent: {\n    display: 'flex',\n    flexDirection: 'column',\n    padding: 0\n  },\n  mapWrapper: {\n    flexGrow: 1\n  },\n  sliderWrapper: {\n    padding: '20px'\n  },\n  slider: {\n    padding: '22px 0px'\n  },\n  sliderRoor: {\n    padding: '0 20px'\n  },\n  body: {\n    overflow: 'hidden',\n    whiteSpace: 'pre-line',\n    paddingBottom: theme.spacing(1)\n  },\n  title: {\n    background: theme.palette.primary.main,\n    color: theme.palette.primary.contrastText,\n    margin: 0,\n    padding: theme.spacing(2)\n  },\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500]\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst MapDirPicker = ({ open, onOk, onCancel, title, latitude: initLat, longitude: initLong, direction: initDir }) => {\n  const classes = useStyles()\n  const [{ longitude, latitude }, setCoords] = useState({ longitude: initLong, latitude: initLat })\n  const [direction, setRotation] = useState(initDir)\n\n  const initViewport = useMemo(() => ({\n    zoom: 18,\n    latitude: initLat,\n    longitude: initLong\n  }), [initLat, initLong])\n\n  const mapChange = ({ viewport: { longitude, latitude } }) => setCoords({ longitude, latitude })\n\n  return (\n    <Dialog\n      scroll='paper'\n      open={open}\n      fullWidth\n      fullScreen\n      onClose={onCancel}\n    >\n      <DialogTitle className={classes.title} disableTypography>\n        <Typography color='inherit'>{title}</Typography>\n      </DialogTitle>\n      <DialogContent className={classes.dlgContent}>\n        <div className={classes.mapWrapper}>\n          <MapDot\n            editable\n            className={classes.map}\n            direction={direction > 0 ? direction : null}\n            viewport={initViewport}\n            onChange={mapChange}\n          />\n        </div>\n        <div className={classes.sliderWrapper}>\n          <FormLabel className={classes.mapFormLabel}>Direction {direction > -1 ? '' : '(off)'}</FormLabel>\n          <Slider\n            classes={{ root: classes.sliderRoor, container: classes.slider }}\n            value={direction || -1}\n            min={-1}\n            max={360}\n            step={1}\n            onChange={(e, value) => setRotation(value)}\n          />\n        </div>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={onCancel}>Cancel</Button>\n        <div style={{ flexGrow: 1 }} />\n        <Button onClick={() => onOk({ longitude, latitude, direction })}>Ok</Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nMapDirPicker.propTypes = {\n  open: PropTypes.bool,\n  latitude: PropTypes.number,\n  longitude: PropTypes.number,\n  direction: PropTypes.number,\n  onOk: PropTypes.func,\n  onCancel: PropTypes.func,\n  title: PropTypes.string\n}\n\nexport default MapDirPicker\n","\nimport React, { useState } from 'react'\nimport PropTypes from 'prop-types'\n\nimport TextField from '@material-ui/core/TextField'\nimport FormLabel from '@material-ui/core/FormLabel'\nimport Typography from '@material-ui/core/Typography'\nimport FormControlLabel from '@material-ui/core/FormControlLabel'\nimport Switch from '@material-ui/core/Switch'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport MapDot from '../../../maps/MapDot'\n\nimport MapDirPicker from '../dialogs/MapDirPicker'\nimport BigTextEdit from '../dialogs/BigTextEdit'\n\nimport style from './SeriesEditInner.style'\nimport { ACCESS } from '../../../../config'\nimport ShortLongText from '../controls/ShortLongText'\n\nconst DIALOGS = {\n  MAPPICK: 'mapPicker',\n  NOTEEDIT: 'noteEdit'\n}\n\nconst useStyles = makeStyles(style)\n\n/**\n * SeriesEdit appears in two places so we need this to be a bit reusable\n */\nconst SeriesEditInner = ({ series, delta, onChange }) => {\n  const classes = useStyles()\n  const [activeDialog, setActiveDialog] = useState(null)\n\n  const viewport = { zoom: 18 }\n  if ((delta.latitude || series.coords[1]) && (delta.longitude || series.coords[0])) {\n    viewport.longitude = delta.longitude || series.coords[0]\n    viewport.latitude = delta.latitude || series.coords[1]\n  }\n\n  const access = delta.access || series.access || 'PRIVATE'\n  // console.log('ACESS', access)\n  return (\n    <div>\n      <TextField\n        label='Series Name'\n        fullWidth\n        placeholder='New Series'\n        className={classes.field}\n        value={delta.name || series.name || ''}\n        onChange={e => onChange({ ...delta, name: e.target.value })}\n      />\n      <div className={classes.mapWrapper} onClick={() => setActiveDialog(DIALOGS.MAPPICK)}>\n        <FormLabel className={classes.mapFormLabel}>Location</FormLabel>\n        <div className={classes.mapInnerWrap}>\n          <MapDot\n            staticMap\n            className={classes.map}\n            direction={delta.direction || series.direction}\n            viewport={viewport}\n          />\n        </div>\n      </div>\n      <div className={classes.field}>\n        <FormLabel>Series Access</FormLabel>\n        <div className={classes.access}>\n          <FormControlLabel\n            className={classes.accessRadio}\n            control={\n              <Switch\n                checked={['OPEN', 'PUBLIC'].indexOf(access) > -1}\n                onChange={(e) => {\n                  onChange({ ...delta, access: e.target.checked ? 'PUBLIC' : 'PRIVATE' })\n                }}\n                value={'PUBLIC'}\n              />\n            }\n            label={<div>\n              <Typography variant='body2' component='div'>{ACCESS.PUBLIC.label}</Typography>\n              <Typography variant='caption' component='div'>{ACCESS.PUBLIC.description}</Typography>\n            </div>}\n\n          />\n          <FormControlLabel\n            className={classes.accessRadio}\n            disabled={['PRIVATE'].indexOf(access) > -1}\n            control={\n              <Switch\n                checked={['OPEN'].indexOf(access) > -1}\n                onChange={(e) => onChange({ ...delta, access: e.target.checked ? 'OPEN' : 'PUBLIC' })}\n                value={'OPEN'}\n              />\n            }\n            label={<div>\n              <Typography variant='body2' component='div'>{ACCESS.OPEN.label}</Typography>\n              <Typography variant='caption' component='div'>{ACCESS.OPEN.description}</Typography>\n            </div>}\n          />\n        </div>\n      </div>\n\n      <ShortLongText\n        onClick={() => setActiveDialog(DIALOGS.NOTEEDIT)}\n        className={classes.field}\n        label='Series Note'\n        text={delta.note || series.note}\n      />\n      {activeDialog === DIALOGS.MAPPICK && (\n        <MapDirPicker\n          open\n          title='Series Location & Direction'\n          latitude={delta.latitude || series.coords[1]}\n          longitude={delta.longitude || series.coords[0]}\n          direction={delta.direction || series.direction}\n          onOk={(data) => {\n            onChange({ ...delta, ...data })\n            setActiveDialog(null)\n          }}\n          onCancel={() => setActiveDialog(null)}\n        />\n      )}\n      {activeDialog === DIALOGS.NOTEEDIT && (\n        <BigTextEdit\n          open\n          title='Series Note'\n          body={delta.note || series.note}\n          multiline\n          onOk={(newNote) => {\n            onChange({ ...delta, note: newNote })\n            setActiveDialog(null)\n          }}\n          onCancel={() => setActiveDialog(null)}\n        />\n      )}\n    </div>\n  )\n}\n\nSeriesEditInner.propTypes = {\n  // now some functions\n  series: PropTypes.object.isRequired,\n  delta: PropTypes.object.isRequired,\n  onChange: PropTypes.func.isRequired\n}\n\nexport default SeriesEditInner\n","export default theme => ({\n  root: {\n\n  },\n  inner: {\n    display: 'flex',\n    flexDirection: 'column'\n    // padding: theme.spacing(1)\n  },\n  dlgTitle: {\n    background: theme.palette.primary.main,\n    color: theme.palette.primary.contrastText\n  },\n  access: {\n    display: 'flex'\n  },\n  accessRadio: {\n    flex: '1 1 50%'\n  },\n  grow: {\n    flexGrow: 1\n  },\n  field: {\n    flexGrow: 0,\n    marginBottom: theme.spacing(1) * 2\n  },\n  slider: {\n    paddingLeft: theme.spacing(1),\n    paddingRight: theme.spacing(1)\n  },\n  textField: {\n    marginLeft: theme.spacing(1),\n    marginRight: theme.spacing(1),\n    width: '100%'\n  },\n  formLabel: {\n    display: 'block',\n    marginTop: theme.spacing(1),\n    marginBottom: theme.spacing(1)\n  },\n  mapFormLabel: {\n    display: 'block',\n    marginTop: theme.spacing(1),\n    marginBottom: theme.spacing(1)\n  },\n  mapInnerWrap: {\n    flexGrow: 1,\n    height: '200px',\n    minHeight: '200px'\n  },\n  mapWrapper: {\n    flexGrow: 1,\n    display: 'flex',\n    flexDirection: 'column',\n    paddingBottom: theme.spacing(1) * 2\n  },\n  formControl: {\n    margin: theme.spacing(1),\n    minWidth: 120\n  },\n  chips: {\n    display: 'flex',\n    flexWrap: 'wrap'\n  }\n})\n","import React, { useState, useContext } from 'react'\nimport classNames from 'classnames'\nimport PropTypes from 'prop-types'\n\nimport GridList from '@material-ui/core/GridList'\nimport GridListTile from '@material-ui/core/GridListTile'\nimport GridListTileBar from '@material-ui/core/GridListTileBar'\nimport Snackbar from '@material-ui/core/Snackbar'\nimport Button from '@material-ui/core/Button'\nimport Fab from '@material-ui/core/Fab'\n\nimport AddIcon from '@material-ui/icons/Add'\nimport RemoveIcon from '@material-ui/icons/Remove'\n\nimport { SeriesContext } from '../../contexts'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport style from './PhotoGrid.style'\nimport DeleteDialog from '../dialogs/DeleteDialog'\nimport { formatDate } from '../../../../lib/datelib'\n\nconst useStyles = makeStyles(style)\n\nconst PhotoGrid = ({ photos, columns, multiSelect, onDelete, onTileClick }) => {\n  const [selectMode, setSelectMode] = useState(false)\n  const classes = useStyles()\n  const [selectedItems, setSelectedItems] = useState([])\n  const [deleteConfirm, setDeleteConfirm] = useState(false)\n\n  const { seriesConfig, ac } = useContext(SeriesContext)\n\n  const handleAddToSelection = (e, id) => {\n    e.preventDefault()\n    e.stopPropagation()\n\n    setSelectMode(true)\n    toggleListItem(id)\n  }\n\n  const handleCancelSelection = () => {\n    setSelectMode(false)\n    setSelectedItems([])\n  }\n\n  const onDeleteConfirm = (confirmation) => {\n    setDeleteConfirm(false)\n    if (confirmation === true && selectedItems.length < photos.length) onDelete(selectedItems)\n    handleCancelSelection()\n  }\n\n  const toggleListItem = (id) => {\n    const index = selectedItems.indexOf(id)\n    if (index < 0) setSelectedItems([...selectedItems, id])\n    else {\n      const remaining = selectedItems.filter(arrId => arrId !== id)\n      if (remaining.length === 0) handleCancelSelection()\n      setSelectedItems(remaining)\n    }\n  }\n\n  const handlePhotoTap = (e, photo) => {\n    e.preventDefault()\n    e.stopPropagation()\n    // Select / deselect the item in edit mode\n    if (selectMode) toggleListItem(photo.id)\n    // navigate if tileClick selected\n    else onTileClick(photo.id)\n  }\n\n  const sortedPhotos = [...photos]\n  sortedPhotos.sort((a, b) => parseInt(b.takenOn, 10) - parseInt(a.takenOn, 10))\n\n  return (\n    <div>\n      <GridList cols={columns} cellHeight={200} className={classes.root}>\n        {sortedPhotos.map((photo, idx) => {\n          const selected = selectedItems.indexOf(photo.id) > -1\n          const canDelete = ac.canUser('delete', photo, 'photo')\n\n          let photoUrl = seriesConfig.getPhotoUrl(photo, 'thumb') || photo.base64\n\n          return (\n            <GridListTile\n              key={`gridTile${idx}`}\n              onClick={(e) => canDelete && handlePhotoTap(e, photo)}\n              className={classNames(\n                classes.tile,\n                selectMode && !canDelete && classes.notDeleteable,\n                selectMode && canDelete && !selected && classes.unSelectedTile,\n                selectMode && selected && classes.selectedTile\n              )}\n            >\n              <img src={photoUrl} alt={photoUrl} className={classes.img} />\n              {canDelete && multiSelect && (\n                <Fab size='small' aria-label='Add' className={classes.addFab} onClick={(e) => handleAddToSelection(e, photo.id)}>\n                  {!selectMode || !selected ? <AddIcon /> : <RemoveIcon />}\n                </Fab>\n              )}\n              <GridListTileBar\n                title={<span>{formatDate(photo.takenOn)}</span>}\n              />\n            </GridListTile>\n          )\n        })}\n      </GridList>\n      <Snackbar\n        open={selectMode}\n        autoHideDuration={null}\n        ContentProps={{\n          'aria-describedby': 'snackbar-fab-message-id',\n          className: classes.snackbarContent\n        }}\n        message={<span id='snackbar-fab-message-id'>{selectedItems.length} Photos selected</span>}\n        action={<div>\n          <Button color='inherit' disabled={selectedItems.length >= photos.length} size='small' onClick={() => setDeleteConfirm(true)}>\n                Delete\n          </Button>\n          <Button color='inherit' size='small' onClick={() => handleCancelSelection()}>\n                Cancel\n          </Button>\n        </div>\n        }\n        className={classes.snackbar}\n      />\n\n      <DeleteDialog\n        open={deleteConfirm}\n        onConfirm={onDeleteConfirm}\n        title={`Delete ${selectedItems.length} Photos`}\n        message='Are you sure you want to delete these photos?'\n      />\n    </div>\n\n  )\n}\n\nPhotoGrid.propTypes = {\n  photos: PropTypes.array.isRequired,\n  columns: PropTypes.number,\n\n  multiSelect: PropTypes.bool,\n  onDelete: PropTypes.func,\n  onTileClick: PropTypes.func.isRequired\n}\nPhotoGrid.defaultProps = {\n  multiSelect: true,\n  columns: 2\n}\n\nexport default PhotoGrid\n","import { red } from '@material-ui/core/colors'\nexport default theme => ({\n  root: {\n\n  },\n  tile: {\n\n  },\n  addFab: {\n    position: 'absolute',\n    zIndex: 10,\n    top: theme.spacing(1),\n    left: theme.spacing(1),\n    opacity: 0.3\n  },\n  notDeleteable: {\n    background: 'black',\n    opacity: 0.1\n    // '& img': {\n    // }\n  },\n  unSelectedTile: {\n    '& img': {\n      opacity: 0.7\n    }\n  },\n  selectedTile: {\n    padding: `${theme.spacing(2)}px!important`,\n    '& img': {\n      opacity: 1\n    }\n  },\n  img: {\n\n  },\n  snackbarContent: {\n    backgroundColor: red[700]\n  },\n  snackbar: {\n  }\n})\n","import React, { useState, useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport exifParser from 'exif-parser'\nimport { isNumeric } from '../../../lib/util'\n\nimport PhotoReviewTool from './PhotoReviewTool'\nimport CameraTool from './CameraTool'\nimport NewPhotoInfo from './NewPhotoInfo'\nimport LibraryFilePicker from './controls/LibraryFilePicker'\n\nimport PhotoClass from '../../../lib/Photo'\nimport SeriesClass from '../../../lib/Series'\nimport { useDeviceOrientation, useGeolocation } from '../../../lib/sensors'\n\nimport { SeriesContext } from '../contexts'\n\nconst MODES = {\n  CAMERA: 'camera',\n  FILEPICKER: 'library',\n  PHOTOREVIEW: 'photoreview',\n  PHOTOINFOEDIT: 'photoinfoedit'\n}\n\nconst NewPhoto = ({ inputMethod, onCreate, onCancel, isNewSeries }) => {\n  const { seriesConfig, series } = useContext(SeriesContext)\n  const [newPhoto, setNewPhoto] = useState(null)\n  const [newSeries, setNewSeries] = useState(isNewSeries ? new SeriesClass(seriesConfig).series : null)\n\n  const [photoRefId, setPhotoRefId] = useState(null)\n  const [mode, _changeMode] = useState({ current: inputMethod, history: [] })\n  const orientation = useDeviceOrientation()\n  const geo = useGeolocation()\n\n  const photos = series && series.photos ? series.photos : []\n\n  const onLibraryAdd = (data) => {\n    console.log('onLibraryAdd Debug GOT DATA', { data })\n    const find = 'base64,'\n    let exif = {}\n    const foundIdx = data.indexOf(find) + find.length\n    const newData = data.slice(foundIdx)\n    const parser = exifParser.create(Buffer.from(newData, 'base64'))\n    console.log('onLibraryAdd Buffered')\n    try {\n      exif = parser.parse()\n      console.log('got EXIF', JSON.stringify(exif))\n    }\n    catch (err) {\n    // got invalid data, handle error\n      console.error('EXIF ERROR', err)\n    }\n    // Ok, now try to get the datetime off the EXIF\n    let date = String(Date.now())\n    try {\n      date = String(exif.tags.DateTimeOriginal)\n    }\n    catch (err) {\n      console.log('EXIF', exif)\n      console.error('ERROR GETTING TIMESTAMP', err)\n    }\n    console.log('isNewSeries', { isNewSeries })\n    if (isNewSeries) {\n      let { latitude, longitude } = geo\n      // Stanley park as a fallback if we can't get the geo\n      if (!latitude || !longitude) {\n        latitude = 49.3050394\n        longitude = -123.1398254\n      }\n      try {\n        if (exif.tags.GPSLatitude && isNumeric(exif.tags.GPSLatitude) && exif.tags.GPSLongitude && isNumeric(exif.tags.GPSLongitude)) {\n          latitude = exif.tags.GPSLatitude\n          longitude = exif.tags.GPSLongitude\n        }\n      }\n      catch (e) {\n        console.error('GPS Longitude and Latitude could not be determined')\n      }\n      console.log('LATLONG FOR LIB PICK', { geo, latitude, longitude })\n      setNewSeries({ ...newSeries, latitude, longitude })\n    }\n    const photoInitObj = new PhotoClass(seriesConfig).photo\n    const fullNewPhotoObject = {\n      ...photoInitObj,\n      takenOn: date,\n      rawData: { exif },\n      base64: data\n    }\n    setNewPhoto(fullNewPhotoObject)\n    changeMode(MODES.PHOTOREVIEW)\n    console.log('onLibraryAdd FINISHED', fullNewPhotoObject)\n  }\n\n  const changeMode = (newModeName) => {\n    console.log('NEWPHOTO changeMode', mode, newModeName)\n    _changeMode({\n      current: newModeName,\n      history: [...mode.history, mode.current]\n    })\n  }\n  const lastMode = () => {\n    if (mode.history.length > 0) {\n      const oldHistory = [...mode.history]\n      const oldMode = oldHistory.pop()\n      _changeMode({\n        current: oldMode,\n        history: oldHistory\n      })\n    }\n    else {\n      onCancel()\n    }\n  }\n\n  const onShutter = (data, refId) => {\n    const photoInitObj = new PhotoClass(seriesConfig).photo\n\n    console.log('onShutter Debug GOT DATA', { data })\n    const find = 'base64,'\n    let exif = {}\n    const foundIdx = data.base64.indexOf(find) + find.length\n    const newData = data.base64.slice(foundIdx)\n    const parser = exifParser.create(Buffer.from(newData, 'base64'))\n    console.log('onLibraryAdd Buffered')\n    try {\n      exif = parser.parse()\n      console.log('got EXIF', JSON.stringify(exif))\n    }\n    catch (err) {\n    // got invalid data, handle error\n      console.error('EXIF ERROR', err)\n    }\n\n    if (isNewSeries) {\n      let { latitude, longitude } = geo\n      // Stanley park as a fallback if we can't get the geo\n      if (!latitude || !longitude) {\n        latitude = 49.3050394\n        longitude = -123.1398254\n      }\n      setNewSeries({ ...newSeries, latitude, longitude })\n    }\n    setNewPhoto({\n      ...photoInitObj,\n      rawData: {\n        orient: orientation,\n        geolocate: geo\n      },\n      base64: data.base64\n    })\n    setPhotoRefId(refId)\n    changeMode(MODES.PHOTOREVIEW)\n  }\n\n  let component = null\n  switch (mode.current) {\n    case MODES.CAMERA:\n      component = (\n        <CameraTool\n          photos={photos}\n          onShutter={onShutter}\n          onCancel={onCancel}\n        />\n      )\n      break\n    case MODES.FILEPICKER:\n      component = <LibraryFilePicker onLibraryAdd={onLibraryAdd} />\n      // fileClick() // move this to useEffect to help with click handling\n      break\n    case MODES.PHOTOREVIEW:\n      component = (\n        <PhotoReviewTool\n          defaultRefPhotoId={photoRefId}\n          photos={photos}\n          captured={newPhoto}\n          onConfirm={() => changeMode(MODES.PHOTOINFOEDIT)}\n          onCancel={onCancel}\n          onRetry={lastMode}\n        />\n      )\n      break\n    case MODES.PHOTOINFOEDIT:\n      component = (\n        <NewPhotoInfo\n          photo={newPhoto}\n          newSeries={newSeries}\n          onSave={onCreate}\n          onCancel={onCancel}\n        />\n      )\n      break\n    default:\n      console.log('NEWPHOTO: default state. you should NEVER see this', mode)\n      onCancel()\n  }\n\n  return component\n}\n\nNewPhoto.propTypes = {\n  inputMethod: PropTypes.oneOf(['camera', 'library']),\n  onCreate: PropTypes.func.isRequired,\n  onCancel: PropTypes.func.isRequired,\n  isNewSeries: PropTypes.bool,\n  seriesConfig: PropTypes.object,\n  // This might be a new series so we might have\n  // actions to work on that\n  // This will be provided EITHER photos or onSeriesCreate\n  photos: PropTypes.array\n}\n\nexport default NewPhoto\n","import uuid from 'uuid/v4'\nimport { convertJSDatetoTimestamp } from './datelib'\nimport SeriesConfig from './SeriesConfig'\n\nclass Photo {\n  constructor (seriesConfig, photo) {\n    this.config = new SeriesConfig(seriesConfig)\n    if (photo) this.photo = photo\n    else {\n      this.photo = this.newPhoto()\n    }\n  }\n\n  setMeta = () => {\n    this.meta = JSON.stringify(this.config.getPhotoMeta())\n  }\n\n  newPhoto = () => ({\n    id: '_' + uuid(),\n    takenOn: convertJSDatetoTimestamp(new Date()),\n    meta: JSON.stringify(this.config.getPhotoMeta()),\n    tags: []\n  })\n}\n\nexport default Photo\n","import uuid from 'uuid/v4'\nimport SeriesConfig from './SeriesConfig'\n\nclass Series {\n  constructor (seriesConfig, series) {\n    this.config = new SeriesConfig(seriesConfig)\n    if (series) this.series = series\n    else {\n      this.series = this.newSeries()\n    }\n  }\n\n  setMeta = () => {\n    this.meta = JSON.stringify(this.config.getSeriesMeta())\n  }\n\n  newSeries = () => ({\n    id: '_' + uuid(),\n    meta: JSON.stringify(this.config.getSeriesMeta()),\n    photos: []\n  })\n}\n\nexport default Series\n","import { useState, useEffect, useRef } from 'react'\n\nexport const useCamera = (onCapture) => {\n  const [cameraError, setCameraError] = useState(false)\n  const [cameraOnline, setCameraOnline] = useState(false)\n  const camRef = useRef()\n\n  const initCamera = () => {\n    if (!camRef.current) {\n      camRef.current = new Webcam(\n        document.getElementById('webcam'),\n        document.createElement('canvas')\n      )\n      camRef.current.setup(\n        window.innerWidth, // width\n        window.innerHeight // height\n      )\n        .then((data) => {\n          setCameraOnline(true)\n        })\n        .catch((e) => {\n          console.error(e)\n          setCameraError(true)\n        })\n    }\n  }\n\n  const captureImage = async () => {\n    if (camRef.current && cameraOnline) {\n      const capturedData = camRef.current.takeBase64Photo({ type: 'jpeg', quality: 1 })\n      onCapture(capturedData)\n    }\n  }\n\n  const delayedOrientationChange = () => {\n    window.setTimeout(initCamera, 1000)\n  }\n\n  useEffect(() => {\n    window.addEventListener('orientationchange', delayedOrientationChange)\n    if (!camRef.current && !cameraError) initCamera()\n    return () => {\n      window.removeEventListener('orientationchange', delayedOrientationChange)\n      if (camRef.current) {\n        camRef.current.destroy()\n        setCameraError(false)\n        setCameraOnline(false)\n      }\n      camRef.current = null\n    }\n  }, [])\n\n  return { cameraError, captureImage, cameraOnline }\n}\n\nclass Webcam {\n  constructor (webcamElement, canvasElement) {\n    this.webcamElement = webcamElement\n    this.canvasElement = canvasElement\n\n    if (window.location.protocol !== 'https:' && window.location.hostname !== 'localhost') {\n      console.warn('getUserMedia() must be run from a secure origin: https or localhost.\\nChanging protocol to https.')\n    }\n\n    if (!navigator.mediaDevices && !navigator.getUserMedia) {\n      console.warn(`Your browser doesn't support navigator.mediaDevices.getUserMedia and navigator.getUserMedia.`)\n    }\n  }\n\n  adjustVideoSize (width, height) {\n    const aspectRatio = width / height\n    if (width >= height) {\n      this.webcamElement.width = aspectRatio * this.webcamElement.height\n    }\n    else if (width < height) {\n      this.webcamElement.height = this.webcamElement.width / aspectRatio\n    }\n  }\n\n  async destroy () {\n    try {\n      this.webcamElement.srcObject.getTracks()[0].stop()\n      this.webcamElement = null\n      this.canvasElement = null\n    }\n    catch (e) {\n      console.error(e)\n    }\n  }\n\n  async setup (width, height) {\n    return new Promise((resolve, reject) => {\n      if (navigator.mediaDevices.getUserMedia !== undefined) {\n        navigator.mediaDevices.getUserMedia({ audio: false, video: { facingMode: 'environment', width, height } })\n          .then((mediaStream) => {\n            if ('srcObject' in this.webcamElement) {\n              this.webcamElement.srcObject = mediaStream\n            }\n            else {\n              // For older browsers withouth the srcObject.\n              this.webcamElement.src = window.URL.createObjectURL(mediaStream)\n            }\n            this.webcamElement.onloadedmetadata = (e) => {\n              this.webcamElement.play()\n            }\n            this.webcamElement.onplaying = (e) => {\n              resolve()\n            }\n          })\n          .catch(err => reject(err))\n      }\n      else {\n        reject(new Error('Error accessing camera'))\n      }\n    })\n  }\n\n  _drawImage () {\n    const imageWidth = this.webcamElement.videoWidth\n    const imageHeight = this.webcamElement.videoHeight\n\n    const context = this.canvasElement.getContext('2d')\n    this.canvasElement.width = imageWidth\n    this.canvasElement.height = imageHeight\n\n    context.drawImage(this.webcamElement, 0, 0, imageWidth, imageHeight)\n\n    return { imageHeight, imageWidth }\n  }\n\n  takeBlobPhoto () {\n    const { imageWidth, imageHeight } = this._drawImage()\n    return new Promise((resolve, reject) => {\n      this.canvasElement.toBlob((blob) => {\n        resolve({ blob, imageHeight, imageWidth })\n      })\n    })\n  }\n\n  takeBase64Photo ({ type, quality } = { type: 'jpeg', quality: 1 }) {\n    const { imageHeight, imageWidth } = this._drawImage()\n    const base64 = this.canvasElement.toDataURL('image/' + type, quality)\n    return { base64, imageHeight, imageWidth }\n  }\n}\n","import React, { useState } from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\n\nimport Fab from '@material-ui/core/Fab'\nimport SwipeableDrawer from '@material-ui/core/SwipeableDrawer'\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport Typography from '@material-ui/core/Typography'\n\nimport CameraIcon from '@material-ui/icons/Camera'\nimport CancelIcon from '@material-ui/icons/Cancel'\nimport PhotoLibraryIcon from '@material-ui/icons/PhotoLibrary'\n\nimport PhotoFadeSlider from './controls/PhotoFadeSlider'\nimport PhotoGrid from './subViews/PhotoGrid'\nimport Photo from './subViews/Photo'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport style from './CameraTool.style'\nimport { useCamera } from '../../../lib/useCamera'\n\nconst useStyles = makeStyles(style)\n\n// https://googlechrome.github.io/samples/image-capture/grab-frame-take-photo.html\nconst CameraTool = ({ photos, onCancel, onShutter, defaultRefPhotoId }) => {\n  const classes = useStyles()\n  const [slider, setSlider] = useState(50)\n  const newRefPhoto = defaultRefPhotoId\n    ? photos.find(p => p.id === defaultRefPhotoId)\n    : photos && photos.length > 0 ? photos[0] : null\n\n  const [refPhoto, setRefPhoto] = useState(newRefPhoto)\n  const [drawerOpen, setDrawerOpen] = useState(false)\n  const { cameraError, captureImage, cameraOnline } = useCamera((data) => onShutter(data, refPhoto ? refPhoto.id : null))\n\n  const handleTileClick = (id) => {\n    setRefPhoto(photos.find(p => p.id === id))\n    setDrawerOpen(false)\n  }\n\n  return (\n    <div className={classes.root}>\n      <CssBaseline />\n      { !cameraError && Boolean(refPhoto) && (\n        <PhotoFadeSlider defaultValue={slider} onChange={setSlider} />\n      )}\n\n      { cameraError && (\n        <div className={classes.cameraErrorText}>\n          <Typography variant='subtitle1' color='inherit'>No Camera Access</Typography>\n          <Typography variant='body2' color='inherit'>Please enabled access in your settings.</Typography>\n        </div>\n      )}\n\n      <div className={classes.captured}>\n        { Boolean(refPhoto) && (\n          <div className={classes.reference} >\n            <Photo\n              className={classes.referenceContainer}\n              opacity={(100 - slider) / 100}\n              photo={refPhoto}\n            />\n          </div>\n        )}\n        { !cameraError && (\n          <video\n            autoPlay\n            playsInline\n            muted\n            id='webcam'\n            width={window.innerWidth}\n            height={window.innerHeight}\n            className={classes.video}\n          />\n        )}\n      </div>\n\n      <Fab\n        color='primary'\n        aria-label='Take Photo'\n        classes={{\n          disabled: classes.disabledFab\n        }}\n        disabled={cameraError || !cameraOnline}\n        className={classNames(classes.cameraFab, classes.buttonFab)}\n        onClick={captureImage}\n      >\n        <CameraIcon className={classes.cameraIcon} />\n      </Fab>\n\n      <Fab\n        color='secondary'\n        aria-label='cancel'\n        onClick={onCancel}\n        classes={{\n          disabled: classes.disabledFab\n        }}\n        className={classNames(classes.cancelFab, classes.buttonFab)}\n      >\n        <CancelIcon className={classes.cancelIcon} />\n      </Fab>\n\n      <Fab\n        aria-label='cancel'\n        className={classNames(classes.libraryFab, classes.buttonFab)}\n        classes={{\n          disabled: classes.disabledFab\n        }}\n        disabled={!photos || photos.length === 0}\n        onClick={() => setDrawerOpen(true)}\n      >\n        <PhotoLibraryIcon className={classes.libraryIcon} />\n      </Fab>\n\n      <SwipeableDrawer\n        anchor='left'\n        open={drawerOpen}\n        classes={{\n          paperAnchorLeft: classes.swipeDrawer\n        }}\n        onClose={() => setDrawerOpen(false)}\n        onOpen={() => setDrawerOpen(true)}\n      >\n        <div\n          tabIndex={0}\n          className={classes.swipeDrawerContainer}\n          role='button'\n          onClick={() => setDrawerOpen(false)}\n          onKeyDown={() => setDrawerOpen(false)}\n        >\n          <PhotoGrid\n            multiSelect={false}\n            columns={1}\n            photos={photos}\n            onTileClick={handleTileClick}\n          />\n        </div>\n      </SwipeableDrawer>\n\n    </div>\n  )\n}\n\nCameraTool.propTypes = {\n  photos: PropTypes.array,\n  defaultRefPhotoId: PropTypes.string, // id of the reference photo\n  onCancel: PropTypes.func.isRequired,\n  onShutter: PropTypes.func.isRequired\n}\n\nexport default CameraTool\n","export default theme => ({\n  root: {\n    background: 'black',\n    // border: '5px solid red',\n    height: '100%',\n    width: '100%'\n  },\n  cameraErrorText: {\n    color: 'white',\n    position: 'absolute',\n    top: '50%',\n    left: '50%',\n    width: '90%',\n    transform: 'translateY(-50%) translateX(-50%)',\n    textAlign: 'center'\n  },\n  disabledFab: {\n    color: '#AAAAA!important',\n    background: '#DDDDDD!important',\n    opacity: 0.2\n  },\n  cameraFab: {\n    position: 'absolute',\n    zIndex: 10,\n    '@media (orientation: landscape)': {\n      right: '20px',\n      top: '50%',\n      transform: 'translateY(-50%)',\n      height: '25vh',\n      width: '25vh'\n    },\n    '@media (orientation: portrait)': {\n      bottom: '20px',\n      left: '50%',\n      transform: 'translateX(-50%)',\n      height: '25vw',\n      width: '25vw'\n    }\n  },\n  cameraIcon: {\n    height: '100%',\n    width: '100%'\n  },\n  cancelFab: {\n    position: 'absolute',\n    zIndex: 10,\n    '@media (orientation: landscape)': {\n      right: '15px',\n      top: '15px',\n      height: '15vh',\n      width: '15vh'\n    },\n    '@media (orientation: portrait)': {\n      right: '15px',\n      bottom: '15px',\n      height: '15vw',\n      width: '15vw'\n    }\n  },\n  cancelIcon: {\n    height: '100%',\n    width: '100%'\n  },\n\n  swipeDrawer: {\n    width: '50%'\n  },\n\n  libraryFab: {\n    position: 'absolute',\n    zIndex: 10,\n    '@media (orientation: landscape)': {\n      left: '15px',\n      top: '15px',\n      height: '15vh',\n      width: '15vh'\n    },\n    '@media (orientation: portrait)': {\n      left: '15px',\n      top: '15px',\n      height: '15vw',\n      width: '15vw'\n    }\n  },\n\n  myLocationFab: {\n    position: 'absolute',\n    zIndex: 10,\n    '@media (orientation: landscape)': {\n      right: '15px',\n      bottom: '15px',\n      height: '15vh',\n      width: '15vh'\n    },\n    '@media (orientation: portrait)': {\n      left: '15px',\n      bottom: '15px',\n      height: '15vw',\n      width: '15vw'\n    }\n  },\n  myLocationIcon: {\n    height: '80%',\n    width: '80%'\n  },\n  capturedContainer: {\n    position: 'absolute',\n    zIndex: 1,\n    height: '100%',\n    width: '100%'\n  },\n  referenceContainer: {\n    position: 'absolute',\n    zIndex: 2,\n    height: '100%',\n    width: '100%'\n  },\n  captured: {\n\n  },\n  reference: {\n\n  },\n  video: {\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    height: '100vh',\n    width: '100vw',\n    zIndex: 1\n    // '@media (orientation: portrait)': {\n    //   transform: 'rotate(90)'\n    // }\n  }\n  // overlayImage: {\n  //   position: 'absolute',\n  //   top: 0,\n  //   left: 0,\n  //   zIndex: 3,\n  //   height: '100vh',\n  //   width: '100vw',\n  //   textAlign: 'center'\n  // },\n  // overlayImageInner: {\n  //   '@media (orientation: landscape)': {\n  //     height: '100%',\n  //     width: 'auto'\n  //   },\n  //   '@media (orientation: portrait)': {\n  //     width: '100%',\n  //     height: 'auto'\n  //   }\n  // },\n  // newImage: {\n  //   position: 'absolute',\n  //   top: 0,\n  //   left: 0,\n  //   zIndex: 2\n  // }\n})\n","import React, { useState, useContext } from 'react'\nimport PropTypes from 'prop-types'\n\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport Snackbar from '@material-ui/core/Snackbar'\nimport Button from '@material-ui/core/Button'\n\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport Photo from './subViews/Photo'\nimport PhotoFadeSlider from './controls/PhotoFadeSlider'\nimport style from './PhotoReviewTool.style'\n\nimport { SeriesContext } from '../contexts'\nconst useStyles = makeStyles(style)\n\nconst PhotoReviewTool = ({\n  captured, defaultRefPhotoId,\n  onConfirm, onCancel, onRetry\n}) => {\n  const { series } = useContext(SeriesContext)\n  const photos = series && series.photos ? series.photos : null\n  const classes = useStyles()\n\n  const newRefPhoto = defaultRefPhotoId\n    ? photos.find(p => p.id === defaultRefPhotoId)\n    : photos && photos.length > 0 ? photos[0] : null\n\n  const [refPhoto, setRefPhoto] = useState(newRefPhoto)\n  const [slider, setSlider] = useState(100)\n\n  if (!captured) return 'Loading...'\n\n  return (\n    <div className={classes.root}>\n      <CssBaseline />\n      { Boolean(refPhoto) && (\n        <PhotoFadeSlider defaultValue={100} onChange={setSlider} />\n      )}\n\n      <div className={classes.captured}>\n        <Photo\n          opacity={slider / 100}\n          className={classes.capturedContainer}\n          photo={captured}\n        />\n      </div>\n      { Boolean(refPhoto) && (\n        <div className={classes.reference} >\n          <Photo\n            className={classes.referenceContainer}\n            photo={refPhoto}\n          />\n        </div>\n      )}\n      <Snackbar\n        open\n        autoHideDuration={null}\n        ContentProps={{\n          'aria-describedby': 'snackbar-fab-message-id',\n          className: classes.snackbarContent\n        }}\n        message={<span id='snackbar-fab-message-id'>Keep this photo?</span>}\n        action={<div>\n          <Button color='inherit' size='small' onClick={onCancel}>\n                Cancel\n          </Button>\n          {Boolean(onRetry) && (\n            <Button color='inherit' size='small' onClick={onRetry}>\n          Retry\n            </Button>\n          )}\n\n          <Button color='inherit' size='small' onClick={onConfirm}>\n                Keep\n          </Button>\n        </div>\n        }\n        className={classes.snackbar}\n      />\n    </div>\n  )\n}\n\nPhotoReviewTool.propTypes = {\n  defaultRefPhotoId: PropTypes.string,\n  captured: PropTypes.object,\n  // Now some functions\n  onConfirm: PropTypes.func.isRequired,\n  onCancel: PropTypes.func.isRequired,\n  onRetry: PropTypes.func // only for camera\n\n}\n\nexport default PhotoReviewTool\n","export default theme => ({\n  root: {\n    background: 'rgb(150,150, 150)',\n    // border: '5px solid red',\n    height: '100%',\n    width: '100%'\n  },\n  capturedContainer: {\n    position: 'absolute',\n    zIndex: 1,\n    height: '100%',\n    width: '100%'\n  },\n  referenceContainer: {\n    position: 'absolute',\n    zIndex: 0,\n    height: '100%',\n    width: '100%'\n  },\n  captured: {\n\n  },\n  reference: {\n\n  },\n  referenceTextContainer: {\n    width: '100%',\n    display: 'flex',\n    color: 'white',\n    background: 'rgba(0,0,0,0.5)',\n    padding: theme.spacing(3),\n    position: 'absolute',\n    zIndex: 4,\n    top: 0\n  },\n  newText: {\n    flexGrow: 1,\n    color: 'white',\n    textShadow: '1 1 1 black',\n    textAlign: 'right'\n  },\n  refText: {\n    flexGrow: 1,\n    color: 'white',\n    textShadow: '1 1 1 black'\n  }\n})\n","import React, { useState } from 'react'\nimport PropTypes from 'prop-types'\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport Typography from '@material-ui/core/Typography'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport Button from '@material-ui/core/Button'\n\nimport SeriesEditInner from './subViews/SeriesEditInner'\n\n// import { SeriesContext } from '../contexts'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport style from './NewPhotoInfo.style'\nimport PhotoInfoInner from './subViews/PhotoInfoInner'\n\nconst useStyles = makeStyles(style)\n\nconst NewPhotoInfo = ({ photo, newSeries, onCancel, onSave }) => {\n  const classes = useStyles()\n  // const { series } = useContext(SeriesContext)\n  const [seriesDelta, setSeriesDelta] = useState(newSeries || {})\n  const [photoDelta, setPhotoDelta] = useState(photo)\n\n  // console.log('NewPhotoInfo', {\n  //   seriesDelta,\n  //   photoDelta,\n  //   photo,\n  //   series,\n  //   newSeries,\n  //   onCancel,\n  //   onSave\n  // })\n  // console.log('NewPhotoInfo', { series, seriesDelta, photoDelta })\n\n  return (\n    <div className={classes.root}>\n      <CssBaseline /> {/* You only need this in a root element. Don't put it anywhere else in the dom */}\n      <Dialog\n        fullScreen\n        fullWidth\n        scroll='paper'\n        disableBackdropClick\n        disableEscapeKeyDown\n        onClose={onCancel}\n        aria-labelledby='customized-dialog-title'\n        open\n      >\n        <DialogTitle disableTypography className={classes.dlgTitleContainer}>\n          <Typography variant='h5' className={classes.dlgTitle}>\n          New Photo Properties\n          </Typography>\n        </DialogTitle>\n        <DialogContent>\n\n          {!!newSeries && (\n            <SeriesEditInner\n              series={newSeries}\n              delta={seriesDelta}\n              onChange={setSeriesDelta}\n            />\n          )}\n\n          <PhotoInfoInner\n            photo={photo}\n            canEdit\n            delta={photoDelta}\n            onChange={(newAttr) => setPhotoDelta({ ...photoDelta, ...newAttr })}\n          />\n\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={onCancel} color='primary'>\n            Cancel\n          </Button>\n          <Button onClick={() => onSave({ series: seriesDelta, photo: photoDelta })} color='primary'>\n            Next\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </div>\n  )\n}\n\nNewPhotoInfo.propTypes = {\n  photo: PropTypes.object.isRequired,\n  newSeries: PropTypes.object,\n  // Standard functions\n  onCancel: PropTypes.func.isRequired,\n  onSave: PropTypes.func\n}\n\nexport default NewPhotoInfo\n","export default theme => ({\n  root: {\n\n  },\n  formLabel: {\n    color: theme.palette.text.secondary\n  },\n  mapFormLabel: {\n    marginTop: theme.spacing(2),\n    marginBottom: theme.spacing(1),\n    color: theme.palette.text.secondary\n  },\n  map: {\n    marginBottom: theme.spacing(2)\n  },\n  mapWrapper: {\n    marginBottom: theme.spacing(2)\n  },\n  field: {\n    marginBottom: theme.spacing(2)\n  }\n})\n","import React, { useEffect, useRef } from 'react'\n\nconst useFileInput = (onChange = () => {}) => {\n  const inputRef = useRef()\n  const clickRef = useRef()\n\n  const element = (\n    <input style={{ display: 'none' }} ref={inputRef} type='file' />\n  )\n\n  const forceClick = () => {\n    if (inputRef.current) inputRef.current.click()\n  }\n\n  useEffect(() => {\n    const handleChange = evt => {\n      const [file] = [...inputRef.current.files]\n      if (file) {\n        const reader = new FileReader()\n        reader.onload = e => {\n          onChange(e.target.result)\n        }\n        reader.readAsDataURL(file)\n      }\n      inputRef.current.value = null\n    }\n\n    if (inputRef.current) {\n      inputRef.current.addEventListener('change', handleChange)\n      if (!clickRef.current) {\n        inputRef.current.click()\n        clickRef.current = true\n      }\n    }\n    return () => {\n      if (inputRef.current) {\n        inputRef.current.removeEventListener('change', handleChange)\n      }\n    }\n  }, [inputRef.current])\n\n  return { fileClickEl: element, forceClick }\n}\n\nexport default useFileInput\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport Typography from '@material-ui/core/Typography'\nimport PhotoLibraryIcon from '@material-ui/icons/PhotoLibrary'\nimport { makeStyles } from '@material-ui/core/styles'\nimport useFileInput from '../../../../lib/useFileInput'\n\nconst color = '#AAAAAA'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    height: '100%',\n    display: 'flex',\n    flexDirection: 'column',\n    textAlign: 'center',\n    color,\n    border: `20px solid ${color}`\n  },\n  icon: {\n    margin: 'auto',\n    flex: '1 1 50%',\n    height: '70%',\n    width: '70%'\n  },\n  text: {\n    flex: '1 1 50%'\n  }\n}))\n\nconst LibraryFilePicker = ({ onLibraryAdd }) => {\n  const classes = useStyles()\n  const { fileClickEl, forceClick } = useFileInput(onLibraryAdd)\n  return (\n    <div className={classes.root} onClick={forceClick}>\n      {fileClickEl}\n      <PhotoLibraryIcon className={classes.icon}color='inherit' />\n      <Typography variant='h2' className={classes.text} color='inherit'>\n        Import from Library\n      </Typography>\n    </div>\n  )\n}\n\nLibraryFilePicker.propTypes = {\n  onLibraryAdd: PropTypes.func.isRequired\n}\n\nexport default LibraryFilePicker\n","import moment from 'moment'\n\n/**\n * Takes a UTC unix timestamp integer or string (milliseconds)\n * and a valid moment format string and returns a formatted\n * date string\n * @param {*} utctimestamp\n * @param {*} format\n */\nexport const formatDate = (utctimestamp, format = 'LLLL') => {\n  return moment(utctimestamp, 'x').format(format)\n}\n\nexport const formatDatAgo = (utctimestamp) => {\n  return moment(utctimestamp, 'x').fromNow()\n}\n\n/**\n * Takes a UTC timestamp and returns a moment object in LOCAL mode\n * @param {*} utctimestamp\n */\nexport const parseDate = (utctimestamp) => {\n  return moment(utctimestamp, 'x')\n}\n\n/**\n * This returns the object in LOCAL mode\n * @param {*} jsDate\n */\nexport const convertJSDatetoTimestamp = (jsDate) => {\n  return moment\n    .utc(jsDate)\n    .format('x')\n}\n\n/**\n *\n * @param {*} utctimestamp\n */\nexport function timestampToHTML5Input (utctimestamp) {\n  // // trim the Z and milliseconds + seconds\n  return moment(utctimestamp, 'x').format('YYYY-MM-DDTkk:mm')\n}\n\n/**\n * Returns an integer timestamp\n * @param {*} isoStr\n */\nexport function HTML5InputToTimestamp (isoStr) {\n  return moment(new Date(isoStr), 'YYYY-MM-DDTkk:mm').format('x')\n}\n","import React from 'react'\n\nexport const SeriesContext = React.createContext({})\n","// https://medium.com/@shalkam/create-react-app-i18n-the-easy-way-b05536c594cb\nimport React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { IntlProvider, addLocaleData } from 'react-intl'\nimport frLocaleData from 'react-intl/locale-data/fr'\n\naddLocaleData(frLocaleData)\n\nexport const IntlContext = React.createContext({})\n\n// the format message hook\nexport const useIntl = () => {\n  const intl = useContext(IntlContext)\n  return intl.formatMessage\n}\n\nexport const IntlWrapper = ({ children }) => (\n  <IntlProvider locale='en'>\n    {children}\n  </IntlProvider>\n)\nIntlWrapper.propTypes = {\n  children: PropTypes.any\n}\n","import gql from 'graphql-tag'\n\nexport const allSeries = gql`\n  query allSeries($limit: Int, $nextToken: String) {\n    allSeries(limit: $limit, nextToken: $nextToken) {\n      seriesSummaries {\n        id\n        name\n        access\n        createdUser {\n          id\n          gravatar\n          gravatarProfile\n          username        \n        }\n        updatedOn\n        createdOn\n        photoCount\n        coords\n        direction\n        watchers\n        featured {\n          id\n          takenOn\n          paths {\n            base\n            thumb\n            medium\n            large\n          }\n        }\n        latest {\n          id\n          takenOn\n          paths {\n            base\n            thumb\n            medium\n            large\n          }\n        }\n      }\n      nextToken\n    }\n  }\n`\n\nexport const pollQuery = gql`\n  query pollQuery($lastCheck: String!, $limit: Int, $nextToken: String) {\n    changedSeries(lastCheck: $lastCheck, limit: $limit, nextToken: $nextToken){\n      seriesSummaries {\n        id\n        name\n        access\n        createdUser {\n          id\n          gravatar\n          gravatarProfile\n          username        \n        }\n        updatedOn\n        createdOn\n        photoCount\n        coords\n        direction\n        watchers\n        featured {\n          id\n          takenOn\n          paths {\n            base\n            thumb\n            medium\n            large\n          }\n        }\n        latest {\n          id\n          takenOn\n          paths {\n            base\n            thumb\n            medium\n            large\n          }\n        }\n      }\n    }\n  }\n`\n\nexport const userSeries = gql`\n  query userSeries($createdBy: ID) {\n    userSeries(createdBy: $createdBy ) {\n      seriesSummaries {\n        id\n        name\n        access\n        \n        createdUser {\n          id\n          gravatar\n          gravatarProfile\n          username        \n        }\n        updatedOn\n        createdOn\n        \n        photoCount\n        coords\n        direction\n        watchers\n        \n        featured {\n          id\n          takenOn\n          paths {\n            base\n            thumb\n            medium\n            large\n          }\n        }\n        latest {\n          id\n          takenOn\n          paths {\n            base\n            thumb\n            medium\n            large\n          }\n        }\n      }\n      nextToken\n    }\n  }\n`\n\nexport const seriesFromList = gql`\n  query seriesFromList($seriesList: [ID]) {\n    arraySeries(seriesIds: $seriesList) {\n      id\n      name\n      access\n      createdUser {\n        id\n        gravatar\n        gravatarProfile\n        username        \n      }\n      updatedOn\n      createdOn\n      photoCount\n      coords\n      direction\n      watchers\n      featured {\n        id\n        takenOn\n        paths {\n          base\n          thumb\n          medium\n          large\n        }\n      }\n      latest {\n          id\n          takenOn\n          paths {\n            base\n            thumb\n            medium\n            large\n          }\n        }\n    }\n  }\n`\n\nexport const seriesWithTag = gql`\n  query seriesWithTag($tag: String!, $limit: Int) {\n    tagSeries(tag: $tag, limit: $limit) {\n      seriesSummaries{\n        id\n        name\n        access\n        createdUser {\n          id\n          gravatar\n          gravatarProfile\n          username        \n        }\n        updatedOn\n        createdOn\n        photoCount\n        coords\n        direction\n        watchers\n        featured {\n          id\n          takenOn\n          paths {\n            base\n            thumb\n            medium\n            large\n          }\n        }\n        latest {\n          id\n          takenOn\n          paths {\n            base\n            thumb\n            medium\n            large\n          }\n        }\n      }\n      nextToken\n    }\n  }\n`\n\nexport const tagSearch = gql`\n  query tagSearch($limit: Int, $tag: String) {\n    tags(limit: $limit, tag: $tag ){\n      name\n      count\n    }\n  }\n`\n\nexport const geoSeries = gql`\n  query seriesInGeoBounds($bounds: [Float], $limit: Int, $nextToken: String) {\n    seriesInGeoBounds(bounds: $bounds, limit: $limit, nextToken: $nextToken) {\n      seriesSummaries {\n        id\n        name\n        access\n        createdUser {\n          id\n          gravatar\n          gravatarProfile\n          username        \n        }\n        updatedOn\n        photoCount\n        coords\n        direction\n        watchers\n        featured {\n          id\n          takenOn\n          paths {\n            base\n            thumb\n            medium\n            large\n          }\n        }\n        latest {\n          id\n          takenOn\n          paths {\n            base\n            thumb\n            medium\n            large\n          }\n        }\n      }\n    }\n  }\n`\n\nexport const getUser = gql`\n  query getUser($userId: ID) {\n    user(id: $userId){\n      id\n      username\n      gravatar\n      gravatarProfile\n      createdOn\n      updatedOn\n      createdOn\n      watching\n    }\n  }\n`\n\nexport const geocode = gql`\n  query geocode($search: String!) {\n    geocoder(search: $search) {\n      relevance\n      text\n      placeName\n      bbox\n      center\n      # geoType\n      # context\n    }\n  }\n`\nexport const getMyFeed = gql`\n  query myFeed($start: String, $end: String, $limit: Int) {\n    myFeed(start: $start, end: $end, limit: $limit) {\n      feed {\n        series {\n          id\n          name\n          createdUser {\n            id\n            gravatar\n            username\n          }\n          updatedOn\n          createdOn\n          access\n          coords\n          watchers\n          photoCount\n        }\n        photo {\n          id\n          updatedOn\n          createdOn\n          createdUser {\n            id\n            gravatar\n            gravatarProfile\n            username\n          }\n          paths {\n            base\n            thumb\n            medium\n          }\n        }\n        relation\n      }\n      window\n    }\n  }\n`\n\nexport const userSearch = gql`\n  query userSearch($searchStr: String!, $limit: Int) {\n    userSearch(searchStr: $searchStr, limit: $limit ){\n      id\n      username\n      gravatar\n      gravatarProfile\n      createdOn\n      updatedOn\n      createdOn\n    }\n  }\n`\n\nexport const getWholeSeries = gql`\nquery getWholeSeries($id: ID!) {\n  series(id: $id) {\n    id\n    name\n    note\n    meta\n    watchers\n    createdOn\n    createdUser {\n      id\n      gravatar\n      gravatarProfile\n      username\n    }\n    updatedOn\n    createdOn\n    coords\n    direction\n    photoCount\n    featured {\n      id\n      takenOn\n      paths {\n        base\n        large\n        thumb\n        medium\n      }\n    }\n    latest {\n      id\n      paths {\n        base\n        large\n        thumb\n        medium\n      }\n      takenOn\n    }\n    photos {\n      id\n      meta\n      createdOn\n      takenOn\n      updatedOn\n      createdOn\n      createdUser {\n        id\n        gravatar\n        gravatarProfile\n        username\n      }\n      tags {\n        label\n        typeId\n        coords {\n          x\n          y\n        }\n      }\n      paths {\n        base\n        large\n        thumb\n        medium\n      }\n    }\n  }\n}\n`\n","import React from 'react'\n\nexport const AppContext = React.createContext({})\n","import { createHttpLink } from 'apollo-link-http'\nimport { setContext } from 'apollo-link-context'\n// import PropTypes from 'prop-types'\nimport { endpoints } from '../config'\nimport { ApolloLink } from 'apollo-link'\nimport { InMemoryCache, ApolloClient } from 'apollo-boost'\n\nconst LOCAL_STORAGE_TOKEN = 'apollo-token'\n/**\n * Helper function to create our Apollo Client object\n * @param {*} token\n */\nexport function createApolloClient (token = '') {\n  // Set up our headers for authentication through graphql\n  const cache = new InMemoryCache()\n\n  // The auth link is just used to decorate our HTTP headers with authentication data\n  const authLink = setContext((_, { headers }) => {\n    const newHeaders = {\n      ...headers,\n      authorization: token ? `Bearer ${token}` : ''\n    }\n    // on Dev machines, allow us to fake a user. This will ONLY work with a complimentary\n    // Dev graphql endpoint and singin is still required.\n\n    // This was done so we can test what the App looks like from varying perspectives\n    if (process.env.NODE_ENV === 'development' && process.env.REACT_APP_FAKE_USER) {\n      newHeaders.auth_user = process.env.REACT_APP_FAKE_USER\n    }\n    return { headers: newHeaders }\n  })\n\n  // HTTP link creates the network connection to our graphql host\n  const httpLink = createHttpLink({ uri: endpoints.graphql })\n  console.log('Creating Apollo Client Client', endpoints.graphql, token ? 'TOKEN PROVIDED' : 'NO TOKEN')\n\n  const apolloClient = new ApolloClient({\n    link: ApolloLink.from([authLink, httpLink]),\n    tokenName: LOCAL_STORAGE_TOKEN,\n    cache,\n    connectToDevTools: true\n  })\n\n  // Now put it all together\n  return apolloClient\n}\n\n// Note: this method comes from isntructions here:\n// https://www.apollographql.com/docs/react/recipes/authentication.html\n// export const withApollo = compose(\n//   lifecycle({\n//     shouldComponentUpdate (nextProps) {\n//       const { authStore: { jwtToken: oldToken } } = nextProps\n//       const { authStore: { jwtToken: newToken } } = this.props\n//       if (newToken === oldToken) {\n//         return true\n//       }\n//       return true\n//     }\n//   }),\n//   withWrapClient\n// )\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\n/**\n * Note: this was one of the few components we didn't use hooks for\n * mostly because I couldn't find an easy way to do getDerivedStateFromError()\n *\n * We might revise this later\n */\nclass ErrorBoundary extends React.Component {\n  constructor (props) {\n    super(props)\n    this.state = { hasError: false }\n  }\n\n  static getDerivedStateFromError (error) {\n    // Update state so the next render will show the fallback UI.\n    console.error(error)\n    return { hasError: true, error }\n  }\n\n  // componentDidCatch (error, info) {\n  //   console.error(error)\n  //   // You can also log the error to an error reporting service\n  //   // logErrorToMyService(error, info)\n  // }\n\n  render () {\n    const { hasError, error } = this.state\n    const { fallback } = this.props\n    const FallbackUI = fallback\n    if (hasError) {\n      // You can render any custom fallback UI\n      return <FallbackUI error={error} />\n    }\n\n    return this.props.children\n  }\n}\nErrorBoundary.propTypes = {\n  fallback: PropTypes.any,\n  children: PropTypes.any\n}\n\nexport default ErrorBoundary\n","export default theme => ({\n  root: {\n  },\n  spacer: {\n    flexGrow: 1\n  },\n  forgotPassword: {\n    width: '100%',\n    textAlign: 'right'\n  },\n  switch: {\n\n  },\n  switchButton: {\n    flexGrow: 1,\n    '&:last-child': {\n      borderRadius: 0\n    },\n    '&:first-child': {\n      borderRadius: 0\n    }\n  },\n  phoneNumInner: {\n    marginTop: theme.spacing(1),\n    display: 'flex'\n    // border: '1px solid red'\n  },\n  phoneNumDropdown: {\n    margin: theme.spacing(1),\n    minWidth: 120\n  },\n  noSignin: {\n    marginTop: theme.spacing(2)\n  }\n})\n","import { useRef, useEffect } from 'react'\n\nconst useAuthCommon = () => {\n  const containerRef = useRef()\n  const handleKeyPress = (event) => {\n    if (event.key === 'Enter') {\n      if (containerRef.current) {\n        try {\n          const found = containerRef.current.getElementsByClassName('enterAction')\n          if (found && found[0]) found[0].click()\n        }\n        catch (e) {\n          console.error('useAuthCommon::handleKeyPress', e)\n        }\n      }\n    }\n  }\n  useEffect(() => {\n    if (containerRef.current) {\n      try {\n        document.addEventListener('keypress', handleKeyPress, false)\n      }\n      catch (e) {\n        console.error('useAuthCommon::useEffect', e)\n      }\n      return () => document.removeEventListener('keypress', handleKeyPress, false)\n    }\n  }, [])\n\n  return containerRef\n}\n\nexport default useAuthCommon\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport Typography from '@material-ui/core/Typography'\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport { makeStyles } from '@material-ui/core/styles'\n// import style from './auth.style'\nimport useAuthCommon from './useAuthCommon'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    height: '100%'\n  },\n  bgSwoosh: {\n    width: '100%',\n    height: '100%',\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    zIndex: 0\n  },\n  inner: {\n    width: '100%',\n    minWidth: 200,\n    maxWidth: 300,\n    position: 'absolute',\n    zIndex: 2,\n    textAlign: 'center',\n    top: '50%',\n    left: '50%',\n    transformOrigin: '50% 50%',\n    transform: 'translateY(-50%) translateX(-50%)'\n  },\n  bgSwooshFill: {\n    fill: theme.palette.primary.light\n  }\n}))\n\nconst AuthContainer = ({ children }) => {\n  const containerRef = useAuthCommon()\n  const classes = useStyles()\n  return (\n    <div ref={containerRef} className={classes.root}>\n      <CssBaseline />\n      {/* Look for: LoginSwoosh.svg */}\n      <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 500 500' preserveAspectRatio='none' className={classes.bgSwoosh}>\n        <path className={classes.bgSwooshFill} d=' M 0 0 L 500 0 C 500 209.782 489.956 180 250 180 C 10.044 180 0 219.954 0 370 L 0 0 Z ' />\n      </svg>\n\n      <div className={classes.inner}>\n        {/* Look for: Logo.svg */}\n        <img alt='logo' src={`${process.env.PUBLIC_URL}/icons/Logo.svg`} />\n        <Typography variant='h5'>App Name Here</Typography>\n        {children}\n      </div>\n    </div>\n  )\n}\n\nAuthContainer.propTypes = {\n  children: PropTypes.any\n}\n\nexport default AuthContainer\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport TextField from '@material-ui/core/TextField'\nimport Button from '@material-ui/core/Button'\nimport Link from '@material-ui/core/Link'\nimport Toolbar from '@material-ui/core/Toolbar'\n// import MenuIcon from '@material-ui/core/Menu'\n// import { FederatedButtons } from 'aws-amplify-react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport style from './auth.style'\nimport AuthContainer from './AuthContainer'\nimport { Typography } from '@material-ui/core'\n\nconst useStyles = makeStyles(style)\n\nconst SignIn = ({ loading,\n  handleSignup,\n  federated,\n  handleForgotPassword,\n  handleInputChange,\n  handleBeAnonymous,\n  handleSignIn, ...props }) => {\n  const classes = useStyles()\n  return (\n    <AuthContainer>\n      {/* {props.federated && (\n        <FederatedButtons {...props} />\n      )} */}\n      <TextField\n        id='username'\n        fullWidth\n        key='username'\n        name='username'\n        label='Username'\n        autoFocus\n        className={classes.textField}\n        margin='normal'\n        onChange={handleInputChange}\n      />\n      <TextField\n        fullWidth\n        id='password'\n        label='Password'\n        key='password'\n        name='password'\n        type='password'\n        className={classes.textField}\n        autoComplete='current-password'\n        margin='normal'\n        onChange={handleInputChange}\n      />\n      <Link component='button' variant='body2' className={classes.forgotPassword} disabled={loading} onClick={handleForgotPassword}>\n          Forgot Password\n      </Link>\n      <Toolbar disableGutters>\n\n        <Button component='button' color='secondary' variant='contained' disabled={loading} onClick={handleSignup}>\n          New Account\n        </Button>\n        <div className={classes.spacer} />\n        <Button\n          className='enterAction'\n          component='button'\n          color='primary'\n          variant='contained'\n          disabled={loading}\n          onClick={handleSignIn}\n        >\n          Sign In\n        </Button>\n      </Toolbar>\n\n      <div className={classes.noSignin}>\n        <Button fullWidth variant={'outlined'} onClick={handleBeAnonymous}>\n          Continue without logging in\n        </Button>\n        <Typography variant='caption'>You will not be able to add content and many features will be unavailable.</Typography>\n      </div>\n    </AuthContainer>\n  )\n}\n\nSignIn.propTypes = {\n  loading: PropTypes.bool,\n  federated: PropTypes.object,\n  handleSignup: PropTypes.func.isRequired,\n  handleForgotPassword: PropTypes.func.isRequired,\n  handleInputChange: PropTypes.func.isRequired,\n  handleBeAnonymous: PropTypes.func.isRequired,\n  handleSignIn: PropTypes.func.isRequired\n}\n\nexport default SignIn\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport TextField from '@material-ui/core/TextField'\nimport Button from '@material-ui/core/Button'\nimport Toolbar from '@material-ui/core/Toolbar'\n// import MenuIcon from '@material-ui/core/Menu'\nimport { makeStyles } from '@material-ui/core/styles'\nimport style from './auth.style'\nimport AuthContainer from './AuthContainer'\n\nconst useStyles = makeStyles(style)\n\nconst ConfirmSignIn = ({ handleInputChange, handleBack, handleConfirm }) => {\n  const classes = useStyles()\n  return (\n    <AuthContainer>\n      <TextField\n        id='mfaCode'\n        fullWidth\n        autoFocus\n        label='MFA Code'\n        name='code'\n        className={classes.textField}\n        margin='normal'\n        onChange={handleInputChange}\n      />\n\n      <Toolbar disableGutters>\n        <Button color='secondary' variant='contained' onClick={handleBack}>\n          Back\n        </Button>\n        <div className={classes.spacer} />\n        <Button\n          className='enterAction'\n          color='primary'\n          variant='contained'\n          onClick={handleConfirm}\n        >\n          Confirm\n        </Button>\n      </Toolbar>\n    </AuthContainer>\n  )\n}\n\nConfirmSignIn.propTypes = {\n  handleInputChange: PropTypes.func.isRequired,\n  handleBack: PropTypes.func.isRequired,\n  handleConfirm: PropTypes.func.isRequired\n}\n\nexport default ConfirmSignIn\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport TextField from '@material-ui/core/TextField'\nimport Button from '@material-ui/core/Button'\nimport Typography from '@material-ui/core/Typography'\nimport Toolbar from '@material-ui/core/Toolbar'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport style from './auth.style'\nimport AuthContainer from './AuthContainer'\n\nconst useStyles = makeStyles(style)\n\nconst RequireNewPassword = ({ change, requiredAttributes, placeholders, handleInputChange }) => {\n  const classes = useStyles()\n  return (\n    <AuthContainer>\n      <Typography>A new password is required</Typography>\n      <TextField\n        id='newassword'\n        fullWidth\n        autoFocus\n        label='New Password'\n        className={classes.textField}\n        type='password'\n        autoComplete='new-password'\n        margin='normal'\n        onChange={handleInputChange}\n      />\n      {requiredAttributes\n        .map((attribute, idx) => (\n          <TextField\n            fullWidth\n            key={attribute}\n            name={attribute}\n            className={classes.textField}\n            placeholder={placeholders[idx]}\n            type='text'\n            margin='normal'\n            onChange={handleInputChange}\n          />\n        ))}\n\n      <Toolbar disableGutters>\n\n        <Button color='secondary' variant='contained'>\n          Back\n        </Button>\n        <div className={classes.spacer} />\n        <Button\n          color='primary'\n          variant='contained'\n          onClick={change}\n          className='enterAction'\n        >\n          Change\n        </Button>\n      </Toolbar>\n    </AuthContainer>\n  )\n}\n\nRequireNewPassword.propTypes = {\n  change: PropTypes.func.isRequired,\n  handleInputChange: PropTypes.func.isRequired,\n  requiredAttributes: PropTypes.array,\n  placeholders: PropTypes.array\n}\n\nexport default RequireNewPassword\n","import React, { useState } from 'react'\nimport PropTypes from 'prop-types'\nimport TextField from '@material-ui/core/TextField'\nimport Button from '@material-ui/core/Button'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport FormControl from '@material-ui/core/FormControl'\nimport InputLabel from '@material-ui/core/InputLabel'\nimport Select from '@material-ui/core/Select'\nimport AuthContainer from './AuthContainer'\n\n// import MenuIcon from '@material-ui/core/Menu'\nimport { makeStyles } from '@material-ui/core/styles'\nimport style from './auth.style'\n// import AuthPhoneNum from './AuthPhoneNum'\nconst useStyles = makeStyles(style)\n\nconst SignUp = ({ handleInputChange, signUpFields, signUpFieldLabels, signUpFieldPlaceholders,\n  handleSignup, handleBack, countryDialCodes, defaultDialCode }) => {\n  console.log('SIGNUPPROPS', { defaultDialCode, countryDialCodes, signUpFields, signUpFieldLabels, signUpFieldPlaceholders })\n  const [selectVal, setSelectVal] = useState(defaultDialCode)\n  const classes = useStyles()\n  const handleDialCodeChange = e => {\n    handleInputChange(e)\n    setSelectVal(e.target.value)\n  }\n  return (\n    <AuthContainer>\n      {\n        signUpFields.map((field, idx) => {\n          return field.key !== 'phone_number' ? (\n            <TextField\n              fullWidth\n              autoFocus={signUpFields.findIndex(f => f.key === field.key) === 0}\n              type={field.type}\n              name={field.key}\n              key={field.key}\n              placeholder={signUpFieldPlaceholders[idx]}\n              label={signUpFieldLabels[idx]}\n              className={classes.textField}\n              margin='normal'\n              onChange={handleInputChange}\n            />\n          ) : (\n            <FormControl\n              className={classes.phoneNumDropdown}\n              fullWidth\n              key='phonenum'\n            >\n              <InputLabel htmlFor='dial_code' shrink>\n                {signUpFieldLabels[idx]}\n                {field.required ? '*' : ''}\n              </InputLabel>\n              <div className={classes.phoneNumInner}>\n                <Select\n                  value={selectVal}\n                  onChange={handleDialCodeChange}\n                  inputProps={{\n                    name: 'dial_code',\n                    id: 'dial_code'\n                  }}\n                >\n                  {countryDialCodes.map(dialCode =>\n                    <option key={dialCode} value={dialCode}>\n                      {dialCode}\n                    </option>\n                  )}\n                </Select>\n                <TextField\n                  placeholder={signUpFieldPlaceholders[idx]}\n                  type='tel'\n                  fullWidth\n                  id='phone_line_number'\n                  key='phone_line_number'\n                  name='phone_line_number'\n                  onChange={handleInputChange}\n                />\n              </div>\n            </FormControl>\n          )\n        })\n      }\n      <Toolbar disableGutters>\n        <Button color='secondary' variant='outlined' onClick={handleBack}>\n          Back\n        </Button>\n        <div className={classes.spacer} />\n        <Button\n          className='enterAction'\n          component='button'\n          color='primary'\n          variant='contained'\n          onClick={handleSignup}\n        >\n          Create Account\n        </Button>\n      </Toolbar>\n    </AuthContainer>\n  )\n}\n\nSignUp.propTypes = {\n  handleInputChange: PropTypes.func.isRequired,\n  signUpFields: PropTypes.array.isRequired,\n  signUpFieldLabels: PropTypes.array.isRequired,\n  signUpFieldPlaceholders: PropTypes.array.isRequired,\n  countryDialCodes: PropTypes.array.isRequired,\n  defaultDialCode: PropTypes.string.isRequired,\n  handleSignup: PropTypes.func.isRequired,\n  handleBack: PropTypes.func.isRequired\n}\n\nexport default SignUp\n","import React from 'react'\n// import PropTypes from 'prop-types'\n// import MenuIcon from '@material-ui/core/Menu'\n// import { makeStyles } from '@material-ui/core/styles'\n// import style from './auth.style'\nimport AuthContainer from './AuthContainer'\nimport { Typography } from '@material-ui/core'\n\n// const useStyles = makeStyles(style)\n\nconst Loading = () => {\n  // const classes = useStyles()\n  return (\n    <AuthContainer>\n      <Typography variant='h3'>Loading...</Typography>\n    </AuthContainer>\n  )\n}\n\nLoading.propTypes = {\n}\n\nexport default Loading\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport TextField from '@material-ui/core/TextField'\nimport Button from '@material-ui/core/Button'\nimport Link from '@material-ui/core/Link'\nimport Toolbar from '@material-ui/core/Toolbar'\n// import MenuIcon from '@material-ui/core/Menu'\nimport { makeStyles } from '@material-ui/core/styles'\nimport style from './auth.style'\nimport AuthContainer from './AuthContainer'\n\nconst useStyles = makeStyles(style)\n\nconst ConfirmSignUp = ({ handleInputChange, handleBack, handleResend, handleConfirm }) => {\n  const classes = useStyles()\n  return (\n    <AuthContainer>\n      <TextField\n        id='username'\n        fullWidth\n        autoFocus\n        name='username'\n        label='Username'\n        className={classes.textField}\n        margin='normal'\n        onChange={handleInputChange}\n      />\n      <TextField\n        id='confirmationCode'\n        fullWidth\n        name='code'\n        label='Confirmation Code'\n        className={classes.textField}\n        margin='normal'\n        onChange={handleInputChange}\n\n      />\n      <Link component='button' variant='body2' className={classes.resendCode} onClick={handleResend}>\n          Resend Code\n      </Link>\n      <Toolbar disableGutters>\n\n        <Button color='secondary' variant='outlined' onClick={handleBack}>\n          Back\n        </Button>\n        <div className={classes.spacer} />\n        <Button\n          color='primary'\n          variant='contained'\n          className='enterAction'\n          onClick={handleConfirm}\n        >\n          Sign In\n        </Button>\n      </Toolbar>\n    </AuthContainer>\n  )\n}\n\nConfirmSignUp.propTypes = {\n  handleInputChange: PropTypes.func.isRequired,\n  handleBack: PropTypes.func.isRequired,\n  handleResend: PropTypes.func.isRequired,\n  handleConfirm: PropTypes.func.isRequired\n}\n\nexport default ConfirmSignUp\n","import React, { useState } from 'react'\nimport PropTypes from 'prop-types'\nimport Link from '@material-ui/core/Link'\nimport TextField from '@material-ui/core/TextField'\nimport Typography from '@material-ui/core/Typography'\nimport Button from '@material-ui/core/Button'\n\nimport Toolbar from '@material-ui/core/Toolbar'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport style from './auth.style'\nimport AuthContainer from './AuthContainer'\n\nconst useStyles = makeStyles(style)\n\nconst ForgotPassword = ({ handleSubmit, handleInputChange, handleSendCode, handleBack }) => {\n  const [sent, setSent] = useState(false)\n  const classes = useStyles()\n  return (\n    <AuthContainer>\n      <Typography>Forgot Password</Typography>\n      {!sent && (\n        <TextField\n          id='username'\n          autoFocus\n          fullWidth\n          label='Username'\n          name='username'\n          className={classes.textField}\n          margin='normal'\n          onChange={handleInputChange}\n        />\n      )}\n      {sent && (\n        <TextField\n          id='changecode'\n          fullWidth\n          autoFocus\n          label='Code'\n          name='code'\n          className={classes.textField}\n          margin='normal'\n          onChange={handleInputChange}\n        />\n      )}\n      {sent && (\n        <TextField\n          id='newpassword'\n          fullWidth\n          label='New Password'\n          className={classes.textField}\n          type='password'\n          name='password'\n          autoComplete='current-password'\n          margin='normal'\n          onChange={handleInputChange}\n        />\n      )}\n      {sent && (\n        <Link component='button' variant='body2' className={classes.resendCode} onClick={handleSendCode}>\n          Resend Code\n        </Link>\n\n      )}\n      <Toolbar disableGutters>\n        <Button\n          color='secondary'\n          variant='outlined'\n          onClick={() => {\n            sent ? setSent(false) : handleBack()\n          }}\n        >\n          Back\n        </Button>\n        <div className={classes.spacer} />\n        {!sent && (\n          <Button\n            color='primary'\n            variant='contained'\n            className='enterAction'\n            onClick={() => {\n              setSent(true)\n              handleSendCode()\n            }}\n          >\n          Send Code\n          </Button>\n        )}\n        {sent && (\n          <Button\n            className='enterAction'\n            color='primary'\n            variant='contained'\n            onClick={handleSubmit}\n          >\n          Submit\n          </Button>\n        )}\n      </Toolbar>\n    </AuthContainer>\n  )\n}\n\nForgotPassword.propTypes = {\n  handleSubmit: PropTypes.func.isRequired,\n  handleInputChange: PropTypes.func.isRequired,\n  handleSendCode: PropTypes.func.isRequired,\n  handleBack: PropTypes.func.isRequired\n}\n\nexport default ForgotPassword\n","import React, { useState } from 'react'\nimport Amplify, { Auth } from 'aws-amplify'\nimport { I18n } from '@aws-amplify/core' // ConsoleLogger as Logger\nimport countryDialCodes from 'aws-amplify-react/dist/Auth/common/country-dial-codes'\nimport {\n  Authenticator,\n  SignIn as SignInOrig,\n  SignUp as SignUpOrig,\n  ConfirmSignIn as ConfirmSignInOrig,\n  ConfirmSignUp as ConfirmSignUpOrig,\n  RequireNewPassword as RequireNewPasswordOrig,\n  Loading as LoadingOrig,\n  VerifyContact as VerifyContactOrig,\n  ForgotPassword as ForgotPasswordOrig\n} from 'aws-amplify-react'\n\nimport CompSignIn from '../components/auth/SignIn'\nimport CompConfirmSignIn from '../components/auth/ConfirmSignIn'\nimport CompRequireNewPassword from '../components/auth/RequireNewPassword'\nimport CompSignUp from '../components/auth/SignUp'\nimport CompLoading from '../components/auth/Loading'\nimport CompConfirmSignUp from '../components/auth/ConfirmSignUp'\n// import CompVerifyContact from '../components/auth/VerifyContact'\nimport CompForgotPassword from '../components/auth/ForgotPassword' // or 'aws-amplify-react-native';\nimport { aws } from '../config'\n\nAmplify.configure(aws)\n\nconst defaultAuthState = { authState: 'init', authData: {}, signedIn: null }\n\nconst useAuthentication = () => {\n  const [{ authState, authData, signedIn }, setAuth] = useState(defaultAuthState)\n\n  // Set up the trinary\n  // if (authState === 'signedIn') signedIn = true\n\n  const handleAuthStateChange = (state, data) => {\n    // console.log('handleAuthStateChange', { state, data })\n    setAuth({\n      authState: state,\n      authData: data,\n      // true = signedIn, false = beAnonymous, null = showLoginScreen\n      signedIn: !state || state.length === 0\n        ? null\n        : state === 'signedIn'\n          ? true\n          : signedIn\n    })\n  }\n\n  const signOut = () => Auth.signOut()\n    .then(data => console.log(data))\n    .catch(err => console.log(err))\n\n  const beAnonymous = () => {\n    setAuth({ authState, authData, signedIn: false })\n  }\n\n  const authScreen = signedIn ? null\n    : <Authenticator onStateChange={handleAuthStateChange} hideDefault>\n      <SignIn handleBeAnonymous={beAnonymous} />\n      <Loading />\n      <RequireNewPassword />\n      {/* <RequireNewPasswordOrig /> */}\n      <ConfirmSignIn />\n      <ConfirmSignUp />\n      {/* <VerifyContact /> NOT READY */}\n      <VerifyContactOrig />\n      <ForgotPassword />\n      <SignUp />\n      {/* <SignUpOrig /> */}\n    </Authenticator>\n\n  let accessToken = null\n  try {\n    if (signedIn) accessToken = authData.signInUserSession.accessToken.jwtToken\n    // console.log(`ACCESS TOKEN ${eqSpacer}\\n${accessToken}\\n/ACCESS TOKEN ${eqSpacer}`)\n  }\n  catch (e) {\n    console.error(e)\n  }\n  let isGod = false\n  try {\n    isGod = authData.signInUserSession.idToken.payload['cognito:groups'].indexOf('GodUsers') > -1\n  }\n  catch (e) {}\n\n  return {\n    authState,\n    authData,\n    isGod,\n    signOut,\n    forceSignIn: () => setAuth(defaultAuthState),\n    signedIn,\n    accessToken,\n    authScreen\n  }\n}\n\nexport default useAuthentication\n\nclass SignIn extends SignInOrig {\n  showComponent () {\n    const { loading } = this.state\n    const newProps = {\n      ...this.props,\n      loading,\n      handleForgotPassword: () => this.changeState('forgotPassword'),\n      handleSignup: () => this.changeState('signUp'),\n      handleInputChange: this.handleInputChange,\n      handleSignIn: this.signIn\n    }\n    return <CompSignIn {...newProps} />\n  }\n}\n\nclass SignUp extends SignUpOrig {\n  showComponent () {\n    const { hide } = this.props\n    if (hide && hide.includes(SignUp)) {\n      return null\n    }\n    if (this.checkCustomSignUpFields()) {\n      this.signUpFields = this.props.signUpConfig.signUpFields\n    }\n    this.sortFields()\n\n    const newProps = {\n      ...this.props,\n      countryDialCodes,\n      defaultDialCode: this.getDefaultDialCode(),\n      handleInputChange: this.handleInputChange,\n      signUpFields: this.signUpFields,\n      signUpFieldLabels: this.signUpFields.map(field => I18n.get(field.label)),\n      signUpFieldPlaceholders: this.signUpFields.map(field => I18n.get(field.placeholder)),\n      handleSignup: this.signUp,\n      handleBack: () => this.changeState('signIn')\n    }\n    return <CompSignUp {...newProps} />\n  }\n}\n\nclass ConfirmSignIn extends ConfirmSignInOrig {\n  showComponent () {\n    const newProps = {\n      ...this.props,\n      handleBack: () => this.changeState('signIn'),\n      handleInputChange: this.handleInputChange,\n      handleConfirm: this.confirm\n    }\n    return <CompConfirmSignIn {...newProps} />\n  }\n}\n\nclass ConfirmSignUp extends ConfirmSignUpOrig {\n  showComponent () {\n    const newProps = {\n      ...this.props,\n      handleBack: () => this.changeState('signIn'),\n      handleInputChange: this.handleInputChange,\n      handleConfirm: this.confirm,\n      handleResend: this.resend\n    }\n    return <CompConfirmSignUp {...newProps} />\n  }\n}\n\nclass RequireNewPassword extends RequireNewPasswordOrig {\n  showComponent () {\n    const user = this.props.authData\n    const { requiredAttributes } = user.challengeParam\n    const placeholders = Array.isArray(requiredAttributes)\n      ? requiredAttributes.map(attribute => I18n.get(convertToPlaceholder(attribute)))\n      : []\n\n    const newProps = {\n      ...this.props,\n      handleInputChange: this.handleInputChange,\n      requiredAttributes,\n      placeholders,\n      change: this.change\n    }\n    return <CompRequireNewPassword {...newProps} />\n  }\n}\n\nclass Loading extends LoadingOrig {\n  showComponent () {\n    return <CompLoading {...this.props} />\n  }\n}\n// class VerifyContact extends VerifyContactOrig {\n//   showComponent () {\n//     const user = this.props.authData\n//     if (!user) {\n//       verifyLogger.debug('no user for verify')\n//       return null\n//     }\n//     const { unverified } = user\n//     if (!unverified) {\n//       verifyLogger.debug('no unverified on user')\n//       return null\n//     }\n//     const { email, phoneNumber } = unverified\n\n//     const { authData } = this.props\n//     const newProps = {\n//       ...this.props,\n//       handleInputChange: this.handleInputChange,\n//       handleSkip: () => this.changeState('signedIn', authData),\n//       handleVerify: this.verify,\n//       handleSubmit: this.submit\n//     }\n//     return <CompVerifyContact {...newProps} />\n//   }\n// }\nclass ForgotPassword extends ForgotPasswordOrig {\n  showComponent () {\n    const newProps = {\n      ...this.props,\n      handleBack: () => this.changeState('signIn'),\n      handleInputChange: this.handleInputChange,\n      handleConfirm: this.confirm,\n      handleResend: this.send,\n      handleSubmit: this.submit,\n      handleSendCode: this.send\n    }\n    return <CompForgotPassword {...newProps} />\n  }\n}\n\n// const verifyLogger = new Logger('VerifyContact')\n\nfunction convertToPlaceholder (str) {\n  return str.split('_').map(part => part.charAt(0).toUpperCase() + part.substr(1).toLowerCase()).join(' ')\n}\n\n// const eqSpacer = '==============================================================='\n","import { useEffect } from 'react'\n/**\n * Everything below here is about the prompt for installing a PWA\n */\n\n// Detects if device is on iOS\nconst isIos = () => {\n  // console.log('isIos', window.navigator.userAgent)\n  const userAgent = window.navigator.userAgent.toLowerCase()\n  return /iphone|ipad|ipod/.test(userAgent)\n}\n// Detects if device is in standalone mode\nconst isInStandaloneMode = () => ('standalone' in window.navigator) && (window.navigator.standalone)\n\nconst useShowAddToHome = () => {\n  const handleBeforePrompt = e => {\n    // Prevent Chrome 67 and earlier from automatically showing the prompt\n    e.preventDefault()\n    // Stash the event so it can be triggered later.\n    deferredPrompt = e\n    showAddToHomeScreen()\n  }\n\n  useEffect(() => {\n    // Checks if should display install popup notification:\n    if (isIos() && !isInStandaloneMode()) {\n      console.log('I AM on IOS and I am NOT in standalone mode.')\n    // this.setState({ showInstallMessage: true })\n    }\n\n    window.addEventListener('beforeinstallprompt', handleBeforePrompt)\n    return () => {\n      window.removeEventListener('beforeinstallprompt', handleBeforePrompt)\n    }\n  }, [])\n\n  function addToHomeScreen () {\n    const a2hsBtn = document.querySelector('.ad2hs-prompt') // hide our user interface that shows our A2HS button\n    a2hsBtn.style.display = 'none' // Show the prompt\n    deferredPrompt.prompt() // Wait for the user to respond to the prompt\n    deferredPrompt.userChoice\n      .then(choiceResult => {\n        if (choiceResult.outcome === 'accepted') console.log('User accepted the A2HS prompt')\n        else console.log('User dismissed the A2HS prompt')\n\n        deferredPrompt = null\n      })\n  }\n\n  function showAddToHomeScreen () {\n    const a2hsBtn = document.querySelector('.ad2hs-prompt')\n    a2hsBtn.style.display = 'block'\n    a2hsBtn.addEventListener('click', addToHomeScreen)\n  }\n\n  let deferredPrompt\n  return {\n    // This could get more complicated but we'll leave it simple for now.\n    isIos: isIos()\n  }\n}\n\nexport default useShowAddToHome\n","/**\n * We put our action types at the top to keep them straight\n *\n * This is just a handy enumeration we use everywhere to make sure we're\n * all talking about the same ations\n */\nexport const Actions = {\n\n  HOME_CHANGE_STATE: 'HOME_CHANGE_STATE',\n  HOME_CHANGE_ACTIVE_SERIES: 'HOME_CHANGE_ACTIVE_SERIES',\n  HOME_STATE_BACK: 'HOME_STATE_BACK',\n\n  MAP_HISTORY_POP: 'MAP_HISTORY_POP',\n  MAP_HISTORY_PUSH: 'MAP_HISTORY_PUSH',\n  MAP_HISTORY_CLEAR: 'MAP_HISTORY_CLEAR',\n\n  UPLOADER_START: 'UPLOADER_START',\n  UPLOADER_COMPLETE: 'UPLOADER_COMPLETE',\n  UPLOADER_UPDATE_PROGRESS: 'UPLOADER_UPDATE_PROGRESS'\n\n}\n\n/**\n * Now here are the actual action functions we will be dispatching\n * The actions have arguments related to what they do but they action they\n * dispatch consists only of a type and data3\n */\nexport default {\n  setHomeState: (newDomain, params) => ({ type: Actions.HOME_CHANGE_STATE, data: { newDomain, params } }),\n  homeStateBack: () => ({ type: Actions.HOME_STATE_BACK }),\n  setActiveSeries: (seriesId, initialPhoto) => ({ type: Actions.HOME_CHANGE_ACTIVE_SERIES, data: { seriesId, initialPhoto } }),\n\n  popMapHistory: () => ({ type: Actions.MAP_HISTORY_POP }),\n  pushMapHistory: (viewportSave) => ({ type: Actions.MAP_HISTORY_PUSH, data: viewportSave }),\n  clearMapHistory: () => ({ type: Actions.MAP_HISTORY_CLEAR }),\n\n  queueUpload: (uploadObj) => ({ type: Actions.UPLOADER_START, data: uploadObj }),\n  // startActiveUpload: () => ({ type: Actions.UPLOADER_START }),\n  completeActiveUpload: () => ({ type: Actions.UPLOADER_COMPLETE }),\n  updateUploadProgress: (newProgress) => ({ type: Actions.UPLOADER_UPDATE_PROGRESS, data: newProgress })\n\n}\n","import { Actions } from '../actions'\nimport { home } from '../../config'\nconst mapInit = [\n  {\n    mode: home.MapModeTypes.FREE,\n    // selectedItem: null\n    viewport: {\n      // 'latitude': 49.2707848, // vancouver\n      // 'longitude': -123.0714866,\n      latitude: 36.80191008366581, // Grand Canyon\n      longitude: -111.63999999999784,\n      zoom: 11\n    }\n  }\n]\n\nexport default (state = mapInit, action) => {\n  const { type, data } = action\n\n  switch (type) {\n    case Actions.MAP_HISTORY_CLEAR:\n      const newClearerHistory = state.length > 0 ? [[state.length - 1]] : []\n      return newClearerHistory\n\n    case Actions.MAP_HISTORY_POP:\n      return state.slice(0, -1)\n\n    case Actions.MAP_HISTORY_PUSH:\n      return [...state, data]\n    default:\n      return state\n  }\n}\n","import { Actions } from '../actions'\nimport { home } from '../../config'\n\nconst homeInit = {\n  history: [],\n  current: {\n    domain: home.AppStateTypes.FEED\n    // search: null // { tab, text }\n    // defaultSearchTab:\n    // defaultSearchText:\n    // activeSeries: 'fda17bae-0335-4f0d-9065-dc8d7aa23ed1',\n    // initialPhoto: 'someguid'\n  }\n}\n\nexport default (state = homeInit, action) => {\n  const { type, data } = action\n  const { history, current } = state\n\n  switch (type) {\n    case Actions.HOME_STATE_BACK:\n      const newStateHistory = [...history]\n      const newCurrentState = newStateHistory.length > 0 ? newStateHistory.pop() : homeInit.current\n      return {\n        current: newCurrentState,\n        history: newStateHistory\n      }\n\n    case Actions.HOME_CHANGE_ACTIVE_SERIES:\n      const { activeSeries, initialPhoto } = current\n      return {\n        history,\n        current: {\n          ...current,\n          activeSeries: activeSeries || null,\n          initialPhoto: activeSeries && initialPhoto ? initialPhoto : null\n        }\n      }\n\n    case Actions.HOME_CHANGE_STATE:\n      const { newDomain, params } = data\n      const newParams = params || {}\n      const newHistory = [...history, current]\n      return {\n        history: newHistory,\n        current: {\n          ...current,\n          domain: newDomain,\n          ...newParams\n        }\n      }\n\n    default:\n      return state\n  }\n}\n","import { Actions } from '../actions'\n\nconst initState = {\n  store: [],\n  activeUpload: null\n}\n\nexport default (state = initState, action) => {\n  const { type, data } = action\n  const { store, activeUpload } = state\n\n  switch (type) {\n    case Actions.UPLOADER_START:\n      if (!activeUpload) {\n        return {\n          ...state,\n          activeUpload: data\n        }\n      }\n      else {\n        return {\n          ...state,\n          store: [...store, data]\n        }\n      }\n    case Actions.UPLOADER_COMPLETE:\n      if (store.length === 0) {\n        return {\n          ...state,\n          activeUpload: null\n        }\n      }\n      else {\n        const newStore = [...store]\n        const newActive = newStore.pop()\n        return {\n          ...state,\n          store: newStore,\n          activeUpload: newActive\n        }\n      }\n    case Actions.UPLOADER_UPDATE_PROGRESS:\n      return {\n        ...state,\n        activeUpload: { ...activeUpload, ...data }\n      }\n    default:\n      return state\n  }\n}\n","import { combineReducers } from 'redux'\nimport map from './map'\nimport home from './home'\nimport uploader from './uploader'\n\nexport default combineReducers({ map, home, uploader })\n","import { createStore, applyMiddleware, compose } from 'redux'\nimport thunk from 'redux-thunk'\nimport rootReducer from './reducers'\nimport { persistStore, persistReducer } from 'redux-persist'\nimport storage from 'redux-persist/lib/storage' // defaults to localStorage for web\n\n// import api from '../middleware/api'\n// https://github.com/reduxjs/redux/blob/master/examples/real-world/src/middleware/api.js\n\nconst persistConfig = {\n  key: 'root',\n  storage\n}\n\nconst persistedReducer = persistReducer(persistConfig, rootReducer)\n\n/**\n * On Dev we want our devTools available\n */\nconst configureStoreDev = preloadedState => {\n  const { devToolsEnhancer } = require('redux-devtools-extension')\n  const { createLogger } = require('redux-logger')\n  const store = createStore(\n    persistedReducer,\n    preloadedState,\n    compose(\n      devToolsEnhancer(),\n      applyMiddleware(\n        thunk,\n        createLogger()\n      )\n    )\n  )\n  if (module.hot) {\n    // Enable Webpack hot module replacement for reducers\n    module.hot.accept('./reducers', () => {\n      store.replaceReducer(rootReducer)\n    })\n  }\n  return store\n}\n\n/**\n * Production gets a simpler more performant store:\n */\nconst configureStoreProd = preloadedState => {\n  const store = createStore(\n    persistedReducer,\n    preloadedState,\n    compose(\n      applyMiddleware(\n        thunk\n      )\n    )\n  )\n  return store\n}\n\nexport default () => {\n  const store = process.env.NODE_ENV === 'production' ? configureStoreProd() : configureStoreDev()\n  return {\n    store,\n    persistor: persistStore(store)\n  }\n}\n","import React from 'react'\nimport { PersistGate } from 'redux-persist/integration/react'\nimport { Provider } from 'react-redux'\nimport storeConfig from './storeConfig'\n/**\n * In this example, 'store' is the configured Redux store and\n *'persist' is a function that returns a Promise to rehydrate the\n * Redux store using redux-persist\n *\n * FROM: https://medium.com/hexient-labs/redux-store-provider-hoc-3495281905c\n */\nconst withReduxProvider = BaseComponent => (props) => {\n  const { store, persistor } = storeConfig()\n  console.log('withReduxProvider', { props, store, persistor })\n  return (\n    <Provider store={store}>\n      <PersistGate loading={<div>loading persistgate</div>} persistor={persistor}>\n        <BaseComponent {...props} />\n      </PersistGate>\n    </Provider>\n  )\n}\n\nexport default withReduxProvider\n","import React from 'react'\nimport classNames from 'classnames'\nimport PropTypes from 'prop-types'\nimport Paper from '@material-ui/core/Paper'\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport LinearProgress from '@material-ui/core/LinearProgress'\nimport Typography from '@material-ui/core/Typography'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst style = theme => ({\n  root: {\n    background: 'black',\n    color: theme.palette.primary.contrastText,\n    padding: theme.spacing(1) * 2\n  },\n  message: {\n    // width: '100%'\n  },\n  msgText: {\n    display: 'flex'\n  },\n  spacer: {\n    flexGrow: 1\n  },\n  messageInner: {\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst UploadControlUnstyled = ({ className, text, progress }) => {\n  const classes = useStyles()\n  if (!text) return null\n  const message = `Uploading: ${text}`\n  return (\n    <div className={classNames(classes.root, className)}>\n      <div className={classes.messageInner}>\n        <div className={classes.msgText}>\n          <Typography color='inherit'>{message}</Typography>\n          <div className={classes.spacer} />\n          <Typography color='inherit'>{progress}%</Typography>\n        </div>\n        <LinearProgress color='secondary' variant='determinate' value={progress} />\n      </div>\n    </div>\n  )\n}\n\nUploadControlUnstyled.propTypes = {\n  className: PropTypes.string,\n  text: PropTypes.string,\n  progress: PropTypes.number\n}\n\nconst UploadControl = UploadControlUnstyled\nexport default UploadControl\n\nexport const UploadControlCOSMOSWrapper = ({ text, progress }) => {\n  // const [someStateItem, setSomeStateItem] = useState()\n  const classes = useWrapperStyles()\n  return (\n    <div className={classes.root}>\n      <CssBaseline /> {/* You only need this in a root element. Don't put it anywhere else in the dom */}\n      <Paper className={classes.paper}>\n        <Typography variant='h5'>\n          This is a dummy component.\n        </Typography>\n      </Paper>\n      <UploadControl text={text} progress={progress} />\n    </div>\n  )\n}\n\nUploadControlCOSMOSWrapper.propTypes = {\n  text: PropTypes.string,\n  progress: PropTypes.number\n}\nconst wrapperStyle = theme => ({\n  root: {\n    height: '100%',\n    display: 'flex',\n    flexDirection: 'column'\n  },\n  paper: {\n    flexGrow: 1\n  }\n})\n\nconst useWrapperStyles = makeStyles(wrapperStyle)\n\nUploadControlCOSMOSWrapper.displayName = UploadControl.displayName\nexport const UploadControlTest = UploadControlCOSMOSWrapper\n","import axios from 'axios'\nimport FormData from 'form-data'\n\n/**\n * DEbuggers for AXIOS\n */\naxios.interceptors.request.use(\n  request => {\n    console.log('AXIOS:::: Starting Request', request)\n    return request\n  },\n  err => {\n    console.log('AXIOS:::: Starting Request ERROR', err)\n    return Promise.reject(err)\n  }\n)\n\naxios.interceptors.response.use(\n  response => {\n    console.log('AXIOS:::: Response', response)\n    return response\n  },\n  err => {\n    console.log('AXIOS:::: Starting Response ERROR', err)\n    return Promise.reject(err)\n  }\n)\n\nexport default async function doUpload (activeUpload, updateUploadProgress, completeActiveUpload) {\n  console.log('UploadConntect: upload start', activeUpload)\n\n  // Initialising the HTML POST form for posting to S3 directly\n  let formData = new FormData()\n  // Take the auth credentials that we got from the backend and add them to our S3 POST\n  Object.keys(activeUpload.preAuth.fields).forEach(fieldkey => {\n    console.log('APPEND', fieldkey, activeUpload.preAuth.fields[fieldkey])\n    formData.append(fieldkey, activeUpload.preAuth.fields[fieldkey])\n  })\n  const file = dataURLtoFile(activeUpload.base64, 'a.png')\n  formData.append('file', file)\n\n  const config = {\n    headers: {\n      'Content-Type': 'multipart/form-data'\n    },\n    onUploadProgress: progressEvent => {\n      const { loaded, total } = progressEvent\n      // Do something with the progress details\n      console.log('PROGRESSEVENT', loaded, total, Math.floor(100 * loaded / total))\n      updateUploadProgress({ progress: Math.floor(100 * loaded / total) })\n    }\n  }\n\n  console.log('FORMDATA', formData)\n  // Upload file to S3\n  await axios.post(\n    activeUpload.preAuth.url,\n    formData,\n    config\n  ).catch(err => {\n    console.error(err)\n    console.log(err.stack)\n  })\n  console.log('UploadConntect: upload done')\n  completeActiveUpload()\n}\n\nfunction dataURLtoFile (dataurl, filename) {\n  var arr = dataurl.split(','); var mime = arr[0].match(/:(.*?);/)[1]\n\n  var bstr = atob(arr[1]); var n = bstr.length; var u8arr = new Uint8Array(n)\n  while (n--) {\n    u8arr[n] = bstr.charCodeAt(n)\n  }\n  return new File([u8arr], filename, { type: mime })\n}\n","import React, { useRef, useEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport { connect } from 'react-redux'\nimport actions from '../redux/actions'\nimport UploadControl from '../components/UploadControl'\nimport s3Upload from '../lib/s3upload'\n\nconst UploadConntect = ({\n  activeUpload,\n  completeActiveUpload,\n  updateUploadProgress,\n  ...props\n}) => {\n  const uploadingRef = useRef()\n  useEffect(() => {\n    uploadingRef.current = uploadingRef.current && !!activeUpload\n\n    if (activeUpload && !uploadingRef.current) {\n      s3Upload(activeUpload, updateUploadProgress, completeActiveUpload)\n    }\n  }, [Boolean(activeUpload)])\n\n  if (!activeUpload) return null\n  return <UploadControl text={'Uploading thing'} progress={activeUpload.progress || 0} {...props} />\n}\nUploadConntect.propTypes = {\n  // All from redux\n  activeUpload: PropTypes.object,\n  completeActiveUpload: PropTypes.func.isRequired,\n  updateUploadProgress: PropTypes.func.isRequired\n}\n\n/**\n * Map our redux state and functions\n */\nconst mapStateToProps = (state, props) => {\n  const { activeUpload } = state.uploader\n  return { activeUpload }\n}\n\nconst mapDispatchToProps = dispatch => ({\n  completeActiveUpload: () => {\n    dispatch(actions.completeActiveUpload())\n  },\n  updateUploadProgress: (newProgress) => {\n    dispatch(actions.updateUploadProgress(newProgress))\n  }\n})\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(UploadConntect)\n","/**\n * Valid Roles are: admin, user, nonuser\n *\n * Valid Resources are: series, series_public, series_open, photo\n *\n * For more see:\n * https://docs.google.com/spreadsheets/d/1oXsZrsuyOSFs_tufRluSjQiR6OSTObWiGsKDUKb5vLk/edit#gid=0\n *\n * RTFM:\n * https://onury.io/accesscontrol/?content=guide#resources-and-resource-attributes\n */\nexport default {\n  // Admin is god. Be careful who you give this to.\n  admin: {\n    series: {\n      'create:own': ['*'],\n      'read:any': ['*'],\n      'update:any': ['*'],\n      'delete:any': ['*']\n    },\n    photo: {\n      'create:any': ['*'],\n      'read:any': ['*'],\n      'update:any': ['*'],\n      'delete:any': ['*']\n    }\n  },\n  // Logged out users can see public stuff but nothing esle\n  nonuser: {\n    photo: {\n      'read:any': ['*'],\n      'update:any': ['*'],\n      'delete:any': ['*']\n    },\n    series_public: {\n      'read:any': ['*']\n    },\n    series_open: {\n      'read:any': ['*']\n    }\n  },\n  // Users are the key permissions role in V0\n  // Note: we could inherit from user but we keep it explicit for now\n  user: {\n    series: {\n      'create:own': ['*'],\n      'read:own': ['*'],\n      'update:own': ['*'],\n      'delete:own': ['*']\n    },\n    series_public: {\n      'read:any': ['*']\n    },\n    series_open: {\n      'read:any': ['*'],\n      'update:any': ['photos']\n    },\n    photo: {\n      'read:any': ['*'],\n      'create:own': ['*'],\n      'update:own': ['*'],\n      'delete:own': ['*']\n    }\n  }\n}\n","import gql from 'graphql-tag'\n\nexport const deletePhoto = gql`\n  mutation deletePhoto($seriesId: ID!, $photoId: ID!) {\n    deletePhoto(seriesId: $seriesId, photoId: $photoId)\n  }\n`\n\nexport const deleteSeries = gql`\n  mutation deleteSeries($id: ID!) {\n    deleteSeries(id: $id)\n  }\n`\n\nexport const updateSeries = gql`\n  mutation updateSeries($series: UpdateSeriesInput!) {\n    updateSeries(series: $series){\n      id\n      name\n      note\n      meta\n      latitude\n      longitude\n      direction\n      photoCount\n      featured {\n        id\n        takenOn\n        paths {\n          base\n          thumb\n          medium\n          large\n        }\n      }     \n    }\n  }\n`\n\nexport const updatePhoto = gql`\n  mutation updatePhoto($photo: UpdatePhotoInput!) {\n    updatePhoto(photo: $photo){\n      id\n    }\n  }\n`\n\nexport const createPhoto = gql`\n  mutation createPhoto($photo: NewPhotoInput!, $ext: String!) {\n    createPhoto(photo: $photo, ext: $ext) {\n      photo {\n        id\n        meta\n        createdUser {\n          id\n          gravatar\n          gravatarProfile\n          name\n        }\n        seriesId\n        # createdOn\n        takenOn\n        # updatedOn\n        tags {\n          label\n          typeId\n          coords {\n            x\n            y\n          }\n        }\n        paths {\n          base\n          thumb\n          medium\n          large\n        }\n      }\n      preAuth\n    }\n  }\n`\n\nexport const createSeries = gql`\n  mutation createSeries($series: NewSeriesInput!) {\n    createSeries(series: $series) {\n      id\n      name\n      note\n      meta\n      # createdOn\n      # updatedOn\n      latitude\n      longitude\n      direction\n      photoCount\n      featured {\n        id\n        takenOn\n        paths {\n          base\n          thumb\n          medium\n          large\n        }\n      }\n      # latest {\n      #   id\n      #   paths {\n      #     thumb\n      #   }\n      #   createdBy\n      #   createdOn\n      #   takenOn\n      #   updatedOn\n      # }\n      photos {\n        id\n        meta\n        createdUser {\n          id\n          gravatar\n          gravatarProfile\n          name\n        }   \n        # createdOn\n        takenOn\n        # updatedOn\n        tags {\n          label\n          typeId\n          coords {\n            x\n            y\n          }\n        }\n        paths {\n          base\n          thumb\n          medium\n          large\n        }\n      }\n    }\n  }\n`\n\nexport const watchSeries = gql`\n  mutation watch($seriesId: ID) {\n    watchSeries(seriesId: $seriesId)\n  }\n`\n\nexport const unWatchSeries = gql`\n  mutation unWatch($seriesId: ID) {\n    unWatchSeries(seriesId: $seriesId)\n  }\n`\n","import React, { useState, useRef } from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\nimport SpeedDial from '@material-ui/lab/SpeedDial'\nimport SpeedDialAction from '@material-ui/lab/SpeedDialAction'\n\n// import useNewImageMenu from '../PhotoSeries/views/controls/useNewImageMenu'\nimport AddCameraIcon from '@material-ui/icons/AddAPhoto'\nimport PhotoLibraryIcon from '@material-ui/icons/PhotoLibrary'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    position: 'absolute',\n    bottom: theme.mixins.toolbar / 2,\n    left: '50%',\n    transformOrigin: '50% 50%',\n    transform: 'translateY(-50%) translateX(-50%)'\n  },\n  speedDialFab: {\n    background: theme.palette.secondary.main,\n    color: theme.palette.secondary.contrastText\n  },\n  directionUp: {\n  }\n}))\n\nconst AddFab = ({ className, children, onCameraClick, onLibraryClick }) => {\n  const [open, setOpen] = useState(false)\n  const [down, setDown] = useState(false)\n  const classes = useStyles()\n  // const theme = useTheme()\n  const downRef = useRef(down)\n  downRef.current = down\n\n  const startTimer = (el) => {\n    setDown(true)\n    if (!open) {\n      setTimeout(() => {\n        if (downRef.current) setOpen(true)\n      }, 300)\n    }\n  }\n\n  // const onUp = (e) => {\n  //   // console.log('onUp', e.currentTarget)\n  //   // setSeries(series)\n  //   setDown(false)\n  //   setOpen(false)\n  //   // onCameraClick()\n  // }\n\n  const onDown = (e) => {\n    // console.log('onDown', e.currentTarget)\n    // setSeries(series)\n    startTimer(e.currentTarget)\n  }\n\n  const block = (e) => {\n    if (e && e.stopPropagation) {\n      e.stopPropagation()\n      e.preventDefault()\n    }\n  }\n\n  return (\n    <SpeedDial\n      ariaLabel='SpeedDial photo adder'\n      onBlur={(e) => {\n        setTimeout(() => setOpen(false), 250)\n      }}\n      classes={{\n        directionUp: classes.directionUp,\n        root: classes.root,\n        fab: classNames(classes.speedDialFab, className)\n      }}\n      icon={children}\n      onClick={(e) => {\n        block(e)\n        setDown(false)\n        if (!open) {\n          console.log('cameraclick MAIN')\n          onCameraClick()\n        }\n      }}\n      onMouseDown={onDown}\n      // onMouseUp={onUp}\n      onTouchStart={onDown}\n      // onTouchEnd={onUp}\n\n      open={open}\n      direction='up'\n    >\n      <SpeedDialAction\n        // Bit of a hack here. This function isn't quite ready for primetime\n        icon={<AddCameraIcon className={classes.speedDialIcon} />}\n        tooltipPlacement='right'\n        tooltipTitle='From Camera'\n        tooltipOpen\n        onClick={(e) => {\n          console.log('cameraclick')\n          setOpen(false)\n          setDown(false)\n          onCameraClick()\n          block(e)\n        }}\n      />\n      <SpeedDialAction\n        // Bit of a hack here. This function isn't quite ready for primetime\n        icon={<PhotoLibraryIcon className={classes.speedDialIcon} />}\n        tooltipPlacement='right'\n        tooltipTitle='From Photo Library'\n        tooltipOpen\n        onClick={(e) => {\n          console.log('libraryClick')\n          setOpen(false)\n          setDown(false)\n          onLibraryClick()\n          block(e)\n        }}\n      />\n    </SpeedDial>\n  )\n}\n\nAddFab.propTypes = {\n  className: PropTypes.string,\n  children: PropTypes.any,\n  onCameraClick: PropTypes.func.isRequired,\n  onLibraryClick: PropTypes.func.isRequired\n}\n\nexport default AddFab\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport Menu from '@material-ui/core/Menu'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport Divider from '@material-ui/core/Divider'\n\n// import { Menu as MenuIcon } from '@material-ui/icons'\n\nconst ContextMenu = ({ anchorEl, onClose, menuItems }) => {\n  return (\n    <Menu\n      anchorEl={anchorEl}\n      open={!!anchorEl}\n      onClose={onClose}\n    >\n      {menuItems.map(({ icon, color, text, hide, disabled, action, divider }, idx) => {\n        const Icon = icon || null\n        if (hide) return null\n        if (divider) return <Divider key={`contextMenu-${idx}`} />\n        return (\n          <MenuItem\n            key={`contextMenu-${idx}`}\n            disabled={disabled}\n            onClick={() => {\n              onClose()\n              action()\n            }}>\n            {Icon && (\n              <ListItemIcon>\n                <Icon color={disabled ? 'disabled' : color} />\n              </ListItemIcon>\n            )}\n            <ListItemText primary={text} primaryTypographyProps={{ color }} />\n          </MenuItem>\n        )\n      })}\n    </Menu>\n  )\n}\n\nContextMenu.propTypes = {\n  anchorEl: PropTypes.object,\n  onClose: PropTypes.func,\n  menuItems: PropTypes.arrayOf(PropTypes.shape({\n    text: PropTypes.string,\n    icon: PropTypes.any,\n    divider: PropTypes.any,\n    hide: PropTypes.bool,\n    disabled: PropTypes.bool,\n    color: PropTypes.string,\n    action: PropTypes.func\n  }))\n}\n\nexport default ContextMenu\n","import React, { useState } from 'react'\nimport PropTypes from 'prop-types'\n\nimport Divider from '@material-ui/core/Divider'\nimport List from '@material-ui/core/List'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport Typography from '@material-ui/core/Typography'\nimport FormLabel from '@material-ui/core/FormLabel'\n\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport TagChip from '../tags/TagChip'\nimport style from './SeriesInfo.style'\n\nimport ShortLongText from '../controls/ShortLongText'\nimport BigText from '../dialogs/BigText'\nimport { formatDate } from '../../../../lib/datelib'\nimport SeriesConfigClass from '../../../../lib/SeriesConfig'\n\nconst DIALOGS = {\n  NOTEVIEW: 'NOTEVIEW'\n}\nconst useStyles = makeStyles(style)\n\nconst SeriesInfo = ({ seriesConfig, series }) => {\n  const classes = useStyles()\n  const seriesConfigInst = new SeriesConfigClass(seriesConfig)\n  const [activeDialog, setActiveDialog] = useState(null)\n  const newTags = series.photos.reduce((acc, { tags }) => {\n    tags.forEach(tag => {\n      if (!acc[tag.typeId]) {\n        acc[tag.typeId] = {\n          [tag.label]: { ...tag, count: 1 }\n        }\n      }\n      else if (acc[tag.typeId][tag.label]) {\n        const existing = acc[tag.typeId][tag.label]\n        acc[tag.typeId][tag.label] = { ...existing, count: existing.count + 1 }\n      }\n      else acc[tag.typeId][tag.label] = { ...tag, count: 1 }\n    })\n    return acc\n  }, {})\n\n  let metaKeys = []\n  try {\n    metaKeys = series.meta ? Object.keys(JSON.parse(series.meta)) : []\n  }\n  catch (e) {\n    console.error(e)\n  }\n\n  return (\n    <div className={classes.root}>\n      <div className={classes.field}>\n        <FormLabel className={classes.formLabel}>\n      Series Name\n        </FormLabel>\n        <Typography variant='body1' color='inherit'>\n          {series.name}\n        </Typography>\n      </div>\n      {series.note && (\n        <ShortLongText\n          label='Series Note'\n          text={series.note}\n          onClick={() => setActiveDialog(DIALOGS.NOTEVIEW)}\n        />\n      )}\n\n      <Typography className={classes.heading} variant='subtitle1'>Series Summary</Typography>\n      <Divider />\n      <List className={classes.list}>\n        <ListItem disableGutters>\n          <ListItemText\n            primary={`Photos: ${series.photos.length}`}\n            secondary={series.photos.length > 0 && (\n              <span>\n             First: {formatDate(series.photos[series.photos.length - 1].takenOn, 'lll')}\n                <br />\n             Latest: {formatDate(series.photos[0].takenOn, 'lll')}\n              </span>\n            )}\n          />\n        </ListItem>\n\n        <ListItem disableGutters>\n          <ListItemText>\n            <FormLabel className={classes.formLabel}>\n              Tags in use (across all photos)\n            </FormLabel>\n            <Divider />\n            {Object.keys(newTags).length === 0 && (\n              <Typography variant='caption'>No photos in this series have tags</Typography>\n            )}\n            {Object.keys(newTags).map((tagKey, idtk) => (\n              <div key={`tagchipkey${idtk}`} className={classes.tagListItem}>\n                <Typography className={classes.subheading} variant='overline'>{seriesConfigInst.getTagType(tagKey).label}</Typography>\n                <Divider />\n                {Object.values(newTags[tagKey]).length > 0\n                  ? (\n                    Object.values(newTags[tagKey]).map((tag, idx) => (\n                      <TagChip\n                        key={`tagchip-${idtk}-${idx}`}\n                        tag={tag}\n                        color={seriesConfigInst.getTagType(tagKey).color}\n                      />\n                    ))\n                  )\n                  : (\n                    <Typography variant='caption'>No photos in this series have tags</Typography>\n                  )\n                }\n              </div>\n            ))}\n          </ListItemText>\n        </ListItem>\n\n      </List>\n\n      {metaKeys.length > 0 && Object.keys(seriesConfig.meta).length > 0 && (\n        <React.Fragment>\n          <FormLabel className={classes.formLabel}>\n            Metadata\n          </FormLabel>\n          <Divider />\n          <List className={classes.list}>\n            {metaKeys.map((key, idx) => seriesConfig.meta[key] ? (\n              <ListItem key={`metadata${idx}`}>\n                <ListItemText\n                  primary={seriesConfig.meta[key].label}\n                  secondary={seriesConfig.meta[key].render(series.meta[key])}\n                />\n              </ListItem>\n            ) : null\n            )}\n          </List>\n        </React.Fragment>\n      )}\n      {activeDialog === DIALOGS.NOTEVIEW && (\n        <BigText\n          open\n          multiline\n          onClose={() => setActiveDialog(null)}\n          title='Series Note'\n          body={series.note}\n        />\n      )}\n    </div>\n  )\n}\n\nSeriesInfo.propTypes = {\n  seriesConfig: PropTypes.object.isRequired,\n  series: PropTypes.object.isRequired\n}\n\nexport default SeriesInfo\n","export default theme => ({\n  root: {\n    margin: theme.spacing(1),\n    backgroundColor: theme.palette.background.paper,\n    marginBottom: 60 // a little extra room for the FAB\n\n  },\n  field: {\n    marginBottom: theme.spacing(1)\n  },\n  list: {\n    padding: theme.spacing(1)\n  },\n  heading: {\n    marginTop: theme.spacing(1)\n  },\n  tagListItem: {\n    marginTop: theme.spacing(1),\n    marginBottom: theme.spacing(2)\n  },\n  chip: {\n    margin: theme.spacing(0.5)\n  }\n})\n","import React, { useState } from 'react'\nimport PropTypes from 'prop-types'\n\nimport MobileStepper from '@material-ui/core/MobileStepper'\nimport IconButton from '@material-ui/core/IconButton'\nimport GridListTileBar from '@material-ui/core/GridListTileBar'\nimport Badge from '@material-ui/core/Badge'\n\nimport LabelIcon from '@material-ui/icons/Label'\n// import RemoveRedEye from '@material-ui/icons/RemoveRedEye'\nimport KeyboardArrowLeft from '@material-ui/icons/KeyboardArrowLeft'\nimport KeyboardArrowRight from '@material-ui/icons/KeyboardArrowRight'\n\nimport SwipeableViews from 'react-swipeable-views'\nimport Photo from './Photo'\nimport { formatDate } from '../../../../lib/datelib'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport style from './SwipeShow.style'\n\nconst useStyles = makeStyles(style)\n\nconst SwipeShow = ({ photos, initialPhoto, onImageSelect }) => {\n  const classes = useStyles()\n  const theme = useTheme()\n  const initPhotoIndex = initialPhoto ? photos.findIndex(p => p.id === initialPhoto) || 0 : 0\n  const [activePhoto, setActivePhoto] = useState(initPhotoIndex >= 0 ? initPhotoIndex : 0)\n  const [showTags, setShowTags] = useState(false)\n  const singular = photos.length < 2\n\n  const sortedPhotos = [...photos]\n  sortedPhotos.sort((a, b) => parseInt(b.takenOn, 10) - parseInt(a.takenOn, 10))\n\n  const handleForward = () => setActivePhoto(activePhoto >= sortedPhotos.length ? 0 : activePhoto + 1)\n  const handleBack = () => setActivePhoto(activePhoto <= 0 ? sortedPhotos.length - 1 : activePhoto - 1)\n\n  return (\n    <div className={classes.root}>\n      <div className={classes.inner}>\n        <SwipeableViews\n          axis={theme.direction === 'rtl' ? 'x-reverse' : 'x'}\n          index={activePhoto}\n          onChangeIndex={(val) => setActivePhoto(val)}\n          enableMouseEvents\n        >\n          {sortedPhotos.map((photo, idx) => (\n            <div className={classes.photoWrapper} key={`swipeshowpic-${idx}`} onClick={() => onImageSelect(sortedPhotos[activePhoto].id)}>\n              <Photo photo={photo} className={classes.photo} showTags={showTags} />\n            </div>\n          ))}\n        </SwipeableViews>\n        <IconButton size='small' className={classes.manualBack} onClick={handleBack} color='inherit' disabled={activePhoto === 0}>\n          {theme.direction === 'rtl' ? <KeyboardArrowRight /> : <KeyboardArrowLeft />}\n        </IconButton>\n        <IconButton size='small' className={classes.manualForward} onClick={handleForward} color='inherit' disabled={activePhoto === photos.length - 1}>\n          {theme.direction === 'rtl' ? <KeyboardArrowLeft /> : <KeyboardArrowRight />}\n        </IconButton>\n        <GridListTileBar\n          title={singular ? 'Photo' : `Photo (${activePhoto + 1}/${sortedPhotos.length})`}\n          subtitle={sortedPhotos.length > 0 && (\n            <span>{formatDate(sortedPhotos[activePhoto].takenOn)}</span>\n          )}\n          actionIcon={\n            <React.Fragment>\n              <IconButton className={classes.tagButton} onClick={() => setShowTags(!showTags)}>\n                <Badge color={showTags ? 'primary' : 'secondary'} badgeContent={sortedPhotos[activePhoto].tags ? sortedPhotos[activePhoto].tags.filter(tag => tag.coords).length : null}>\n                  <LabelIcon />\n                </Badge>\n              </IconButton>\n            </React.Fragment>\n          }\n        />\n      </div>\n      {!singular &&\n      <MobileStepper\n        steps={sortedPhotos.length}\n        position='static'\n        activeStep={activePhoto}\n        classes={{\n          root: classes.mobileStepper,\n          dots: classes.dots\n        }}\n      />\n      }\n    </div>\n  )\n}\n\nSwipeShow.propTypes = {\n  // This is just the basic shape of the photo object\n  initialPhoto: PropTypes.string,\n  photos: PropTypes.arrayOf(PropTypes.shape({\n    img: PropTypes.string,\n    tags: PropTypes.array,\n    date: PropTypes.date\n  })),\n  transition: PropTypes.number,\n  onImageSelect: PropTypes.func.isRequired\n}\n\nSwipeShow.defaultProps = {\n  transition: 5000,\n  isFullScreen: false,\n  slides: []\n}\n\nexport default SwipeShow\n","export default theme => ({\n  root: {\n    position: 'relative'\n  },\n  inner: {\n    position: 'relative'\n  },\n  photoWrapper: {\n    minHeight: 250,\n    height: 250\n  },\n  dateCaption: {\n    padding: theme.spacing(1),\n    background: 'black',\n    color: 'white',\n    textAlign: 'center'\n  },\n  mobileStepper: {\n    // position: 'absolute',\n    // bottom: theme.spacing(1),\n    // right: theme.spacing(1)\n  },\n  manualBack: {\n    color: 'white',\n    zIndex: 10,\n    position: 'absolute',\n    transform: 'translateY(-50%)',\n    left: 0,\n    top: '50%'\n  },\n  manualForward: {\n    color: 'white',\n    zIndex: 10,\n    position: 'absolute',\n    transform: 'translateY(-50%)',\n    right: 0,\n    top: '50%'\n  },\n  tagButton: {\n    color: 'rgba(255, 255, 255, 0.54)'\n  },\n  slideshowButton: {\n    color: 'rgba(255, 255, 255, 0.54)'\n  },\n  dots: {\n    margin: '0 auto'\n  }\n})\n","import React, { useState, useContext } from 'react'\nimport PropTypes from 'prop-types'\n\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport AppBar from '@material-ui/core/AppBar'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport IconButton from '@material-ui/core/IconButton'\nimport Typography from '@material-ui/core/Typography'\nimport Tabs from '@material-ui/core/Tabs'\nimport Tab from '@material-ui/core/Tab'\n\nimport ArrowBackIcon from '@material-ui/icons/ArrowBack'\n\nimport AddCameraIcon from '@material-ui/icons/AddAPhoto'\nimport MoreIcon from '@material-ui/icons/MoreVert'\n\nimport AddAlertIcon from '@material-ui/icons/AddAlert'\nimport SlideshowIcon from '@material-ui/icons/Slideshow'\nimport EditIcon from '@material-ui/icons/Edit'\nimport DeleteIcon from '@material-ui/icons/Delete'\n\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport MapDot from '../../maps/MapDot'\nimport AddFab from './controls/AddFab'\n\nimport ContextMenu from './controls/ContextMenu'\n\nimport SeriesInfo from './subViews/SeriesInfo'\nimport SwipeShow from './subViews/SwipeShow'\nimport PhotoGrid from './subViews/PhotoGrid'\n\nimport DeleteDialog from './dialogs/DeleteDialog'\n\nimport { SeriesContext } from '../contexts'\n\nimport style from './SeriesView.style'\nconst useStyles = makeStyles(style)\n\nconst SeriesView = ({\n  onSlideshowStart, onChange,\n  onEditSeries, onDeletePhotos, onCameraAdd,\n  onDeleteSeries, onLibraryAdd, onTileClick, onMenuBack,\n  onWatch, onUnWatch, initialPhoto,\n  watching, owned\n}) => {\n  const classes = useStyles()\n  const [contextEl, setContextEl] = useState()\n  const [deleteConfirm, setDeleteConfirm] = useState(false)\n\n  const { series, seriesConfig, ac } = useContext(SeriesContext)\n\n  const onDeleteConfirm = (confirmation) => {\n    setDeleteConfirm(false)\n    if (confirmation === true) onDeleteSeries(series.id)\n  }\n\n  const viewport = { zoom: 16 }\n  if (series.coords && series.coords.length === 2) {\n    viewport.longitude = series.coords[0]\n    viewport.latitude = series.coords[1]\n  }\n\n  const can = {\n    update: ac.canUser('update', series, 'series', '*'),\n    delete: ac.canUser('delete', series, 'series', '*'),\n    contribute: ac.canUser('update', series, 'series', ['photos'])\n  }\n  // console.log('FINAL DEBUG', can)\n  const [listTypeTab, setListTypeTab] = useState(0)\n  return (\n    <div className={classes.root}>\n      <CssBaseline />\n      <AppBar position='static' className={classes.appBar}>\n        <Toolbar disableGutters>\n          <IconButton className={classes.menuButton} color='inherit' onClick={onMenuBack} aria-label='Menu'>\n            <ArrowBackIcon />\n          </IconButton>\n          <Typography variant='subtitle1' color='inherit' className={classes.toolbarTitle}>\n            {series.name || 'Series'}\n          </Typography>\n\n          <IconButton className={classes.menuButton} color='inherit' onClick={onSlideshowStart} aria-label='Menu'>\n            <SlideshowIcon />\n          </IconButton>\n          <IconButton\n            aria-haspopup='true'\n            color='inherit'\n            onClick={event => setContextEl(event.currentTarget)}\n          >\n            <MoreIcon />\n          </IconButton>\n\n          <ContextMenu anchorEl={contextEl} onClose={() => setContextEl(null)} menuItems={[\n            {\n              text: 'Watch Series',\n              icon: AddAlertIcon,\n              hide: !onWatch || owned || watching,\n              action: onWatch\n            },\n            {\n              text: 'Unwatch Series',\n              icon: AddAlertIcon,\n              hide: !onUnWatch || owned || !watching,\n              action: onUnWatch\n            },\n            // {\n            //   text: 'Start Slideshow',\n            //   icon: SlideshowIcon,\n            //   hide: !onSlideshowStart,\n            //   action: onSlideshowStart\n            // },\n            { divider: true },\n            {\n              text: 'Edit Series',\n              icon: EditIcon,\n              hide: !onEditSeries || !can.update,\n              action: onEditSeries\n            },\n            {\n              text: 'Delete Series',\n              icon: DeleteIcon,\n              hide: !setDeleteConfirm || !can.delete,\n              color: 'error',\n              action: () => setDeleteConfirm(true)\n            }\n          ]} />\n        </Toolbar>\n        <Tabs variant='fullWidth'\n          value={listTypeTab}\n          onChange={(e, value) => setListTypeTab(value)}\n        >\n          <Tab label='Info' />\n          <Tab label='Map' />\n          <Tab label='Photos' />\n        </Tabs>\n      </AppBar>\n\n      <div className={classes.inner}>\n        {listTypeTab === 0 && (\n          <React.Fragment>\n            {series.photos && series.photos.length > 0 && (\n              <SwipeShow\n                photos={series.photos}\n                initialPhoto={initialPhoto}\n                onImageSelect={onTileClick}\n              />\n            )}\n            <SeriesInfo series={series} seriesConfig={seriesConfig} onChange={onChange} />\n          </React.Fragment>\n        )}\n        {series.photos && listTypeTab === 2 && (\n          <PhotoGrid\n            photos={series.photos}\n            onTileClick={onTileClick}\n            onDelete={onDeletePhotos}\n          />\n        )}\n      </div>\n\n      {listTypeTab === 1 && (\n        <MapDot\n          longitude={series.longitude}\n          latitude={series.latitude}\n          viewport={viewport}\n          direction={series.direction}\n        />\n      )}\n      {listTypeTab === 0 && can.contribute && (\n        <AddFab\n          className={classes.AddFab}\n          onCameraClick={onCameraAdd}\n          onLibraryClick={onLibraryAdd}\n        >\n          <AddCameraIcon />\n        </AddFab>\n      )}\n\n      <DeleteDialog\n        open={deleteConfirm}\n        onConfirm={onDeleteConfirm}\n        title='Delete Series'\n        message='Are you sure you want to delete this series? The record and all images associated with it will be gone forever.'\n      />\n    </div>\n  )\n}\n\nSeriesView.propTypes = {\n  initialPhoto: PropTypes.string,\n  watching: PropTypes.bool,\n  owned: PropTypes.bool,\n  // Action functions\n  onSlideshowStart: PropTypes.func.isRequired,\n  onChange: PropTypes.func.isRequired,\n  onDeletePhotos: PropTypes.func.isRequired,\n  onDeleteSeries: PropTypes.func.isRequired,\n  onCameraAdd: PropTypes.func.isRequired,\n  onEditSeries: PropTypes.func.isRequired,\n  onLibraryAdd: PropTypes.func.isRequired,\n  onTileClick: PropTypes.func.isRequired,\n  onMenuBack: PropTypes.func.isRequired,\n  onWatch: PropTypes.func.isRequired,\n  onUnWatch: PropTypes.func.isRequired\n}\n\nexport default SeriesView\n","export default theme => ({\n  root: {\n    display: 'flex',\n    height: '100%',\n    flexDirection: 'column',\n    overflow: 'hidden'\n  },\n  appBar: {\n    flexGrow: 0\n  },\n  inner: {\n    position: 'relative',\n    flexGrow: 1,\n    overflowY: 'scroll',\n    '-webkit-overflow-scrolling': 'touch'\n  },\n  tabMenu: {\n    marginTop: theme.spacing(7)\n  },\n  mapWrap: {\n    position: 'absolute',\n    height: '100%',\n    width: '100%',\n    top: 0,\n    left: 0\n  },\n  toolbarTitle: {\n    flexGrow: 1,\n    textOverflow: 'ellipsis',\n    whiteSpace: 'nowrap',\n    overflow: 'hidden'\n  },\n  AddFab: {\n    background: theme.palette.secondary.main,\n    color: theme.palette.secondary.contrastText\n  },\n  grow: {\n    flexGrow: 1\n  },\n  gridList: {\n    flexWrap: 'nowrap',\n    // Promote the list into his own layer on Chrome. This cost memory but helps keeping high FPS.\n    transform: 'translateZ(0)'\n  },\n  titleBar: {\n    display: 'flex',\n    padding: theme.spacing(1)\n  },\n  menuButton: {\n    // marginLeft: -12,\n    // marginRight: 20\n  }\n})\n","\nimport React, { useState, useContext } from 'react'\nimport PropTypes from 'prop-types'\n\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport Button from '@material-ui/core/Button'\nimport Typography from '@material-ui/core/Typography'\n\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport { SeriesContext } from '../contexts'\n\nimport style from './SeriesEdit.style'\nimport SeriesEditInner from './subViews/SeriesEditInner'\n\nconst useStyles = makeStyles(style)\n\nconst SeriesEdit = ({ onOk, onCancel }) => {\n  const classes = useStyles()\n  const { series } = useContext(SeriesContext)\n  const [delta, setDelta] = useState({})\n\n  return (\n    <Dialog\n      scroll='paper'\n      className={classes.root}\n      fullScreen\n      open\n      fullWidth\n      onClose={onCancel}\n    >\n      <CssBaseline />\n      <DialogTitle disableTypography className={classes.dlgTitle}>\n        <Typography variant='subtitle1' color='inherit' className={classes.grow}>\n           Edit Series Details\n        </Typography>\n      </DialogTitle>\n      <DialogContent className={classes.inner}>\n        <SeriesEditInner\n          series={series}\n          delta={delta}\n          onChange={setDelta}\n        />\n      </DialogContent>\n      <DialogActions>\n        <Button className={classes.menuButton} color='inherit' onClick={() => setDelta({})} aria-label='Menu'>\n            Reset\n        </Button>\n        <Button className={classes.menuButton} color='inherit' onClick={onCancel} aria-label='Menu'>\n            Cancel\n        </Button>\n        <Button className={classes.menuButton} color='inherit' onClick={() => onOk({ id: series.id, ...delta })} aria-label='Menu'>\n            Ok\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nSeriesEdit.propTypes = {\n  // now some functions\n  onOk: PropTypes.func.isRequired,\n  onCancel: PropTypes.func.isRequired\n}\n\nexport default SeriesEdit\n","export default theme => ({\n  root: {\n\n  },\n  inner: {\n    display: 'flex',\n    flexDirection: 'column'\n    // padding: theme.spacing(1)\n  },\n  dlgTitle: {\n    background: theme.palette.primary.main,\n    color: theme.palette.primary.contrastText\n  },\n  grow: {\n    flexGrow: 1\n  },\n  field: {\n    flexGrow: 0,\n    marginBottom: theme.spacing(2)\n  },\n  slider: {\n    paddingLeft: theme.spacing(1),\n    paddingRight: theme.spacing(1)\n  },\n  textField: {\n    marginLeft: theme.spacing(1),\n    marginRight: theme.spacing(1),\n    width: '100%'\n  },\n  formLabel: {\n    display: 'block',\n    marginTop: theme.spacing(1),\n    marginBottom: theme.spacing(1)\n  },\n  mapFormLabel: {\n    display: 'block',\n    marginTop: theme.spacing(1),\n    marginBottom: theme.spacing(1)\n  },\n  mapInnerWrap: {\n    flexGrow: 1\n  },\n  mapWrapper: {\n    flexGrow: 1,\n    display: 'flex',\n    flexDirection: 'column',\n    paddingBottom: theme.spacing(2)\n  },\n  formControl: {\n    margin: theme.spacing(1),\n    minWidth: 120\n  },\n  chips: {\n    display: 'flex',\n    flexWrap: 'wrap'\n  }\n})\n","import React, { useState, useEffect, useRef } from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\n\nimport Badge from '@material-ui/core/Badge'\nimport Typography from '@material-ui/core/Typography'\nimport IconButton from '@material-ui/core/IconButton'\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport GridListTile from '@material-ui/core/GridListTile'\nimport GridListTileBar from '@material-ui/core/GridListTileBar'\nimport MobileStepper from '@material-ui/core/MobileStepper'\nimport Button from '@material-ui/core/Button'\n\nimport ArrowBackIcon from '@material-ui/icons/ArrowBack'\nimport LabelIcon from '@material-ui/icons/Label'\nimport PauseIcon from '@material-ui/icons/PauseCircleFilled'\nimport PlayIcon from '@material-ui/icons/PlayCircleFilled'\nimport KeyboardArrowLeft from '@material-ui/icons/KeyboardArrowLeft'\nimport KeyboardArrowRight from '@material-ui/icons/KeyboardArrowRight'\n\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\n\nimport Photo from './subViews/Photo'\nimport { formatDate } from '../../../lib/datelib'\nimport useComponentSize from '../../../lib/useComponentSize'\n\nimport style from './Slideshow.style'\n\nconst useStyles = makeStyles(style)\n\nconst Slideshow = ({ onCancel, photos, transition }) => {\n  const classes = useStyles()\n  const theme = useTheme()\n  const { activeStep, lastStep, handleForward, handleBack, paused, pause, play } = useStepper(photos.length, transition)\n  const [showXYTags, setShowXYTags] = useState(false)\n\n  const refImgWrap = useRef(null)\n  const { size: { height, width } } = useComponentSize(refImgWrap)\n\n  return (\n    <div className={classes.root}>\n      <CssBaseline />\n      <div ref={refImgWrap} className={classes.slideContainer}>\n        {photos.map((slide, idx) => (\n          <GridListTile\n            key={`slide-${idx}`}\n            className={classNames(\n              classes.slide,\n              activeStep === idx && classes.active,\n              lastStep === idx && classes.last\n            )}\n            onClick={() => setShowXYTags(!showXYTags)}\n            style={{\n              height,\n              width,\n              transition: theme.transitions.create(['opacity'], { duration: 1 / 4 * transition })\n            }}\n          >\n            <Photo photo={slide} className={classes.photo} showTags={showXYTags} />\n            <Typography className={classes.labelBadge} >\n            Tags: {showXYTags ? 'On ' : 'Off '}\n              <Badge color='secondary' badgeContent={photos[activeStep].tags.filter(tag => tag.coords).length}>\n                <LabelIcon color='inherit' />\n              </Badge>\n            </Typography>\n\n            <GridListTileBar\n              titlePosition='top'\n              title={(\n                <Typography color='inherit' variant='caption'>\n                  <IconButton className={classes.iconButton} onClick={(e) => onCancel()}>\n                    <ArrowBackIcon />\n                  </IconButton>\n                  {formatDate(slide.takenOn)}\n                </Typography>\n              )}\n              subtitle={<em>{paused ? 'Paused' : '    '}</em>}\n              actionIcon={paused ? (\n                <IconButton className={classes.iconButton} onClick={(e) => {\n                  e.preventDefault()\n                  e.stopPropagation()\n                  play()\n                }}>\n                  <PlayIcon />\n                </IconButton>\n              ) : (\n                <IconButton className={classes.iconButton} onClick={(e) => {\n                  e.preventDefault()\n                  e.stopPropagation()\n                  pause()\n                }}>\n                  <PauseIcon />\n                </IconButton>\n              )}\n            />\n          </GridListTile>\n        ))}\n        <IconButton size='small' className={classes.manualBack} onClick={handleBack} color='inherit'>\n          {theme.direction === 'rtl' ? <KeyboardArrowRight /> : <KeyboardArrowLeft />}\n        </IconButton>\n        <IconButton size='small' className={classes.manualForward} onClick={handleForward} color='inherit'>\n          {theme.direction === 'rtl' ? <KeyboardArrowLeft /> : <KeyboardArrowRight />}\n        </IconButton>\n      </div>\n\n      <MobileStepper\n        steps={photos.length}\n        position='static'\n        activeStep={activeStep}\n        classes={{\n          root: classes.mobileStepper,\n          dotActive: classes.dotActive\n        }}\n        nextButton={\n          <Button color='inherit' size='small' onClick={handleForward} disabled={activeStep === photos.length - 1}>\n            Next\n            {theme.direction === 'rtl' ? <KeyboardArrowLeft /> : <KeyboardArrowRight />}\n          </Button>\n        }\n        backButton={\n          <Button color='inherit' size='small' onClick={handleBack} disabled={activeStep === 0}>\n            {theme.direction === 'rtl' ? <KeyboardArrowRight /> : <KeyboardArrowLeft />}\n            Back\n          </Button>\n        }\n      />\n    </div>\n  )\n}\n\nSlideshow.propTypes = {\n  // We might want to go full screen\n  isFullScreen: PropTypes.bool,\n  // This is just the basic shape of the photo object\n  photos: PropTypes.array,\n  transition: PropTypes.number,\n  onCancel: PropTypes.func.isRequired\n}\n\nSlideshow.defaultProps = {\n  transition: 5000,\n  isFullScreen: false,\n  slides: []\n}\n\nexport default Slideshow\n\n/**\n * Custom React Hook for all our timer handling\n */\nconst useStepper = (num, interval) => {\n  const [activeStep, setActiveStep] = useState(0)\n  const [paused, setPaused] = useState(false)\n  const [lastStep, setLastStep] = useState(0)\n  const timerRef = useRef()\n\n  const handleForward = () => {\n    setLastStep(activeStep)\n    if (activeStep + 1 >= num) setActiveStep(0)\n    else setActiveStep(activeStep + 1)\n    if (!paused) {\n      destroyTimer()\n      createTimer()\n    }\n  }\n  const handleBack = () => {\n    setLastStep(activeStep)\n    if (activeStep - 1 < 0) setActiveStep(num - 1)\n    else setActiveStep(activeStep - 1)\n    if (!paused) {\n      destroyTimer()\n      createTimer()\n    }\n  }\n\n  const pause = () => {\n    destroyTimer()\n    setPaused(true)\n  }\n  const play = () => {\n    setPaused(false)\n    destroyTimer()\n    createTimer()\n  }\n\n  const createTimer = () => {\n    timerRef.current = window.setInterval(\n      // We need to use the alternate notation for the useState function\n      // because setInterval will only have access to the activeStep it was\n      // initialized with\n      () => setActiveStep(oldStep => {\n        setLastStep(oldStep)\n        return (oldStep + 1 >= num) ? 0 : oldStep + 1\n      })\n      , interval\n    )\n  }\n  const destroyTimer = () => {\n    if (timerRef.current) window.clearInterval(timerRef.current)\n  }\n\n  useEffect(() => {\n    createTimer()\n    return () => {\n      destroyTimer()\n    }\n  }, []) // Pass in empty array to run useEffect only on mount.\n\n  return { activeStep, lastStep, handleForward, handleBack, setActiveStep, paused, pause, play }\n}\n","export default theme => ({\n  root: {\n    // maxWidth: 400,\n    height: '100%',\n    display: 'flex',\n    flexDirection: 'column'\n  },\n  swipeAble: {\n    height: '100%'\n  },\n  slideContainer: {\n    flexGrow: 1\n  },\n  mobileStepper: {\n    flexGrow: 0,\n    background: theme.palette.grey[800],\n    color: theme.palette.getContrastText(theme.palette.grey[800])\n  },\n  slide: {\n    top: 0,\n    zIndex: 0,\n    opacity: 0,\n    position: 'absolute',\n    display: 'block',\n    overflow: 'hidden',\n    width: '100%',\n    height: '100%',\n    minHeight: 300\n  },\n  dotActive: {\n    background: 'white'\n  },\n  iconButton: {\n    color: 'white'\n  },\n  active: {\n    zIndex: 5,\n    opacity: 1\n  },\n  last: {\n    opacity: 1,\n    zIndex: 4\n  },\n  tagContainer: {\n\n  },\n  labelBadge: {\n    color: 'white',\n    zIndex: 10,\n    position: 'absolute',\n    right: theme.spacing(2),\n    bottom: theme.spacing(1),\n    opacity: 0.8\n  },\n  tagChip: {\n    // height: theme.spacing(3),\n    marginRight: theme.spacing(1),\n    fontSize: 10,\n    height: theme.spacing(2),\n    padding: theme.spacing(0.5)\n  },\n  xyTagChip: {\n    position: 'absolute',\n    fontSize: theme.spacing(1),\n    height: theme.spacing(2)\n  },\n  manualBack: {\n    color: 'white',\n    zIndex: 10,\n    position: 'absolute',\n    transform: 'translateY(-50%)',\n    left: 0,\n    top: '50%'\n  },\n  manualForward: {\n    color: 'white',\n    zIndex: 10,\n    position: 'absolute',\n    transform: 'translateY(-50%)',\n    right: 0,\n    top: '50%'\n  }\n})\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport Button from '@material-ui/core/Button'\nimport Typography from '@material-ui/core/Typography'\nimport DialogActions from '@material-ui/core/DialogActions'\n\n// import MenuIcon from '@material-ui/icons/MenuIcon'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst style = theme => ({\n\n})\n\nconst useStyles = makeStyles(style)\n\nconst CancelConfirm = ({ title, message, onConfirm, open }) => {\n  const classes = useStyles()\n  return (\n    <Dialog\n      className={classes.root}\n      disableBackdropClick\n      fullWidth\n      open={open}\n      disableEscapeKeyDown\n      maxWidth='xl'\n      aria-labelledby='confirmation-dialog-title'\n    >\n      <DialogTitle id='confirmation-dialog-title'>{title}</DialogTitle>\n      <DialogContent>\n        <Typography>\n          {message}\n        </Typography>\n\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => onConfirm(false)} color='primary'>\n      No\n        </Button>\n        <Button onClick={() => onConfirm(true)} color='secondary'>\n      Yes\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nCancelConfirm.propTypes = {\n  open: PropTypes.bool,\n  title: PropTypes.string.isRequired,\n  message: PropTypes.string.isRequired,\n  onConfirm: PropTypes.func.isRequired\n}\n\nexport default CancelConfirm\n","import React, { useState } from 'react'\nimport PropTypes from 'prop-types'\n\nimport Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport IconButton from '@material-ui/core/IconButton'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport Typography from '@material-ui/core/Typography'\nimport DialogActions from '@material-ui/core/DialogActions'\n\nimport CloseIcon from '@material-ui/icons/Close'\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport CancelConfirm from '../dialogs/CancelConfirm'\n\nimport PhotoInfoInner from './PhotoInfoInner'\n\nconst style = theme => ({\n  root: {\n    height: '90%',\n    width: '85%'\n  },\n  dlgTitleContainer: {\n    display: 'flex',\n    padding: 0\n  },\n  dlgTitle: {\n    flexGrow: 1,\n    paddingTop: theme.spacing(2),\n    paddingBottom: theme.spacing(1),\n    paddingLeft: theme.spacing(3)\n  },\n  field: {\n    marginBottom: theme.spacing(2)\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst DIALOGS = {\n  NOTEEDIT: 'noteEdit',\n  NOTEVIEW: 'noteView',\n  PHOTOTAKEN: 'taken',\n  TAGEDIT: 'tag',\n  CANCEL: 'cancel'\n}\n\nconst PhotoInfo = ({ canEdit, photo, onCancel, onOk, open }) => {\n  const classes = useStyles()\n  const [activeDialog, setActiveDialog] = useState(null)\n  const [delta, setDelta] = useState({})\n\n  const dirty = delta && Object.keys(delta).length > 0\n\n  return (\n    <Dialog\n      fullScreen\n      fullWidth\n      onClose={() => {\n        if (dirty) setActiveDialog(DIALOGS.CANCEL)\n        else onCancel()\n      }}\n      aria-labelledby='customized-dialog-title'\n      open={open}\n    >\n      <DialogTitle disableTypography className={classes.dlgTitleContainer}>\n        <Typography variant='h5' className={classes.dlgTitle}>\n          Photo Properties\n        </Typography>\n        <IconButton onClick={onCancel}>\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent>\n        <PhotoInfoInner\n          photo={photo}\n          delta={delta}\n          onChange={newDelta => setDelta({ ...delta, ...newDelta })}\n          canEdit={canEdit}\n        />\n      </DialogContent>\n\n      <DialogActions>\n        {!canEdit && (\n          <Button onClick={onCancel} color='primary'>\n            Ok\n          </Button>\n        )}\n        {canEdit && !dirty && (\n          <Button onClick={onCancel} color='primary'>\n            Back\n          </Button>\n        )}\n        {canEdit && dirty && (\n          <React.Fragment>\n            <Button onClick={() => setActiveDialog(DIALOGS.CANCEL)} color='primary'>\n              Cancel\n            </Button>\n            <Button onClick={() => setDelta({})} color='primary'>\n              Reset\n            </Button>\n            <Button onClick={() => onOk(delta)} color='primary'>\n              Ok\n            </Button>\n          </React.Fragment>\n        )}\n      </DialogActions>\n      {activeDialog && activeDialog === DIALOGS.CANCEL && (\n        <CancelConfirm\n          open\n          title='Lose unsaved changes?'\n          message='You will lose any changes you made to this form'\n          onConfirm={confirm => {\n            setActiveDialog(null)\n            if (confirm) onCancel()\n          }}\n        />\n      )}\n    </Dialog>\n  )\n}\n\nPhotoInfo.propTypes = {\n  canEdit: PropTypes.bool,\n  onCancel: PropTypes.func.isRequired,\n  onOk: PropTypes.func.isRequired,\n  open: PropTypes.bool,\n  photo: PropTypes.object.isRequired\n}\n\nexport default PhotoInfo\n","import React, { useState, useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\n\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport Button from '@material-ui/core/Button'\nimport MobileStepper from '@material-ui/core/MobileStepper'\nimport Typography from '@material-ui/core/Typography'\nimport AppBar from '@material-ui/core/AppBar'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport IconButton from '@material-ui/core/IconButton'\nimport Badge from '@material-ui/core/Badge'\nimport Chip from '@material-ui/core/Chip'\n\nimport ArrowBackIcon from '@material-ui/icons/ArrowBack'\nimport InfoIcon from '@material-ui/icons/Info'\nimport LabelIcon from '@material-ui/icons/Label'\n\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\n\nimport PhotoInfo from './subViews/PhotoInfo'\nimport Photo from './subViews/Photo'\n\nimport { formatDate } from '../../../lib/datelib'\nimport Tags from '../../../lib/Tags'\nimport SwipeableViews from 'react-swipeable-views'\nimport { SeriesContext } from '../contexts'\n\nimport style from './PhotoViewTool.style'\nconst useStyles = makeStyles(style)\n\nconst STATES = {\n  VIEWPIC: 0,\n  SHOWINFO: 1,\n  SHOWTAGS: 2,\n  EDITTAGS: 3,\n  FIRSTAGEDIT: 4\n}\n\nconst PhotoViewTool = ({ photos, initPhotoId, onMenuBack, onUpdatePhoto, newPhoto }) => {\n  const classes = useStyles()\n  const theme = useTheme()\n  const { series, seriesConfig, ac } = useContext(SeriesContext)\n  const [activePhoto, setActivePhoto] = useState(initPhotoId ? photos.findIndex(p => p.id === initPhotoId) : 0)\n  // This is a special copy of the photo so we can play around with the XY tags and undo\n  // if we need to\n  const photo = photos[activePhoto]\n  const [delta, setDelta] = useState(newPhoto ? photo : {})\n  const [mode, setMode] = useState({\n    current: newPhoto ? STATES.FIRSTAGEDIT : STATES.VIEWPIC,\n    last: null\n  })\n\n  const tagsClass = new Tags(seriesConfig, delta.tags || photo.tags)\n\n  const changeMode = (desired) => {\n    setMode({ current: desired, last: mode.current })\n  }\n\n  const onCommitTags = () => {\n    changeMode(STATES.SHOWTAGS)\n    onUpdatePhoto(photo, { id: photo.id, ...delta })\n  }\n\n  const onCommitTagsFirst = () => {\n    onUpdatePhoto(photo, { id: photo.id, ...delta })\n    onMenuBack()\n  }\n\n  const onCancelTagEdit = () => {\n    changeMode(STATES.SHOWTAGS)\n    setDelta(photo)\n  }\n\n  const photoClick = (e) => {\n    if (mode.current === STATES.VIEWPIC) {\n      e.preventDefault()\n      e.stopPropagation()\n      changeMode(STATES.SHOWINFO)\n    }\n  }\n\n  const can = {\n    update: ac.canUser('update', series, 'series') ||\n            ac.canUser('update', photo, 'photo')\n  }\n\n  const sortedPhotos = [...photos]\n  sortedPhotos.sort((a, b) => parseInt(b.takenOn, 10) - parseInt(a.takenOn, 10))\n\n  return (\n    <div className={classes.root}>\n      <CssBaseline /> {/* You only need this in a root element. Don't put it anywhere else in the dom */}\n      <AppBar position='static' className={classNames(classes.appBar, mode.current !== STATES.VIEWPIC ? classes.appBarEdit : null)}>\n        <Toolbar>\n          {mode.current !== STATES.FIRSTAGEDIT && (\n            <IconButton\n              className={classes.menuButton}\n              color='inherit'\n              aria-label='Menu'\n              onClick={() => onMenuBack()}\n            >\n              <ArrowBackIcon />\n            </IconButton>\n          )}\n          <div className={classes.grow}>\n            <Typography variant='subtitle2' color='inherit' >\n              {newPhoto ? 'Add Tags' : `Photo View (${activePhoto + 1}/${photos.length})`}\n            </Typography>\n            <Typography variant='subtitle2' color='inherit'>\n              {formatDate(photo.takenOn, 'lll')}\n            </Typography>\n          </div>\n\n          { mode.current === STATES.EDITTAGS &&\n          <Button color='inherit' onClick={onCancelTagEdit}>\n            Cancel\n          </Button>\n          }\n\n          { mode.current === STATES.EDITTAGS &&\n          <Button color='inherit' onClick={onCommitTags}>\n            Save\n          </Button>\n          }\n          { mode.current === STATES.FIRSTAGEDIT &&\n          <Button color='inherit' onClick={onCommitTagsFirst}>\n            Next\n          </Button>\n          }\n\n          { can.update && mode.current === STATES.SHOWTAGS &&\n          <Button color='inherit' onClick={() => changeMode(STATES.EDITTAGS)}>\n            Edit\n          </Button>\n          }\n\n          { (mode.current !== STATES.EDITTAGS && mode.current !== STATES.FIRSTAGEDIT) &&\n          <IconButton color='inherit'\n            className={classNames(classes.tagButton, mode.current === STATES.SHOWTAGS && classes.activeButton)}\n            onClick={() => changeMode(mode.current === STATES.SHOWTAGS ? STATES.VIEWPIC : STATES.SHOWTAGS)}\n          >\n            <Badge className={classes.margin} badgeContent={tagsClass.getXYTags().length} color='primary'>\n              <LabelIcon />\n            </Badge>\n          </IconButton>\n          }\n\n          { (mode.current !== STATES.EDITTAGS && mode.current !== STATES.FIRSTAGEDIT) &&\n          <IconButton color='inherit'\n            className={classNames(classes.infoButton, mode.current === STATES.SHOWINFO && classes.activeButton)}\n            onClick={() => changeMode(mode.current === STATES.SHOWINFO ? STATES.VIEWPIC : STATES.SHOWINFO)}\n          >\n            <InfoIcon />\n          </IconButton>\n          }\n\n        </Toolbar>\n      </AppBar>\n      <div className={classes.inner} onClick={photoClick}>\n        <SwipeableViews\n          axis={theme.direction === 'rtl' ? 'x-reverse' : 'x'}\n          index={activePhoto}\n          containerStyle={{ height: '100%' }}\n          style={{ height: '100%' }}\n          disabled={mode.current !== STATES.VIEWPIC}\n          onChangeIndex={(val) => setActivePhoto(val)}\n          enableMouseEvents\n        >\n          {sortedPhotos.map((photoidx, idx) => (\n            <div className={classes.photoWrapper} key={`swipeshowpic-${idx}`}>\n              <Photo\n                showTags={mode.current === STATES.SHOWTAGS}\n                photo={{ ...photoidx, ...delta }}\n                edit={can.update && (mode.current === STATES.EDITTAGS || mode.current === STATES.FIRSTAGEDIT)}\n                onChange={setDelta}\n                onCommitTags={onCommitTags}\n              />\n            </div>\n          ))}\n        </SwipeableViews>\n\n        {mode.current === STATES.VIEWPIC && (\n          <MobileStepper\n            steps={sortedPhotos.length}\n            position='bottom'\n            activeStep={activePhoto}\n            classes={{\n              root: classes.mobileStepper,\n              dots: classes.dots,\n              dot: classes.dot,\n              dotActive: classes.dotActive\n            }}\n          />\n        )}\n      </div>\n      <PhotoInfo\n        open={mode.current === STATES.SHOWINFO}\n        photo={photo}\n        canEdit={can.update}\n        onOk={(newDelta) => {\n          onUpdatePhoto(photo, { id: photo.id, ...newDelta })\n          changeMode(mode.last)\n        }}\n        onCancel={() => changeMode(mode.last)}\n      />\n      { (mode.current === STATES.EDITTAGS || mode.current === STATES.FIRSTAGEDIT) && (\n        <Chip\n          label='Tap to tag features...'\n          onClick={() => {}}\n          className={classes.tipChip}\n        />\n      )}\n    </div>\n  )\n}\n\nPhotoViewTool.propTypes = {\n  photos: PropTypes.array.isRequired,\n  initPhotoId: PropTypes.string,\n  newPhoto: PropTypes.bool,\n  // Now some action functions\n  onMenuBack: PropTypes.func.isRequired,\n  onUpdatePhoto: PropTypes.func.isRequired\n}\n\nexport default PhotoViewTool\n","export default theme => ({\n  root: {\n    display: 'flex',\n    height: '100%',\n    flexDirection: 'column',\n    overflow: 'hidden'\n  },\n  appBar: {\n    flexGrow: 0\n  },\n  appBarEdit: {\n    color: theme.palette.secondary.contrastText,\n    background: theme.palette.secondary.main\n  },\n  grow: {\n    flexGrow: 1\n  },\n  photoWrapper: {\n    height: '100%'\n  },\n  inner: {\n    flex: '1 1',\n    position: 'relative'\n  },\n  tabMenu: {\n    marginTop: theme.spacing(7)\n  },\n  tipChip: {\n    position: 'absolute',\n    zIndex: 11,\n    bottom: 20,\n    left: '50%',\n    opacity: 0.6,\n    transform: 'translateX(-50%)'\n  },\n  mobileStepper: {\n    background: 'none'\n  },\n  dots: {\n    margin: '0 auto'\n  },\n  dot: {\n    border: '1px solid #FFFFFF77'\n  },\n  dotActive: {\n    background: theme.palette.secondary.main\n  },\n  // tagButton: {\n  //   zIndex: 10,\n  //   color: 'white',\n  //   position: 'absolute',\n  //   fontSize: '2.5rem',\n  //   top: 10,\n  //   left: 10,\n  //   opacity: 0.8\n  // },\n  // infoButton: {\n  //   zIndex: 10,\n  //   color: 'white',\n  //   position: 'absolute',\n  //   top: 10,\n  //   right: 10,\n  //   opacity: 0.8\n  // },\n  activeButton: {\n    color: theme.palette.secondary.main,\n    opacity: 1\n  }\n})\n","import AccessControl from 'accesscontrol'\n\nclass AccessHelper {\n  constructor (userSub, role, permissionObj) {\n    this.userSub = userSub\n    this.role = role\n    this.permissionObj = permissionObj\n    this.ac = new AccessControl(permissionObj)\n  }\n\n  // Return the string 'Own' or the string 'Any'\n  ownOrAny = (obj) => {\n    if (!obj || !obj.createdUser || !obj.createdUser.id) throw new Error(`No Created user found`)\n    try {\n      return obj.createdUser.id === this.userSub ? 'Own' : 'Any'\n    }\n    catch (e) {\n      return 'Any'\n    }\n  }\n\n  isOwner = (obj) => {\n    if (!obj || !obj.createdUser || !obj.createdUser.id) throw new Error(`No Created user found`)\n    try {\n      return obj.createdUser.id === this.userSub\n    }\n    catch (e) {\n      return false\n    }\n  }\n\n  toString () {\n    console.log('AccessHelper:', { sub: this.userSub, role: this.role })\n  }\n\n  canUser = (action, obj, type, attrs) => {\n    if (['series', 'photo'].indexOf(type) < 0) throw new Error(`canUser: type not supported ${type}`)\n\n    try {\n      const ownAny = this.ownOrAny(obj)\n\n      const perm = this.ac.can(this.role)[`${action}${ownAny}`](type)\n      let otherPerm = null\n      if (type === 'series') {\n        if (obj.access === 'PUBLIC') otherPerm = this.ac.can(this.role)[`${action}${ownAny}`]('series_public')\n        else if (obj.access === 'OPEN') otherPerm = this.ac.can(this.role)[`${action}${ownAny}`]('series_open')\n      }\n\n      // Trying to recreate the form `can(role).readAny`\n      if (attrs) {\n        if (otherPerm) {\n          return !!perm.attributes.find(p => p === '*' || attrs.indexOf(p) > -1) ||\n           !!otherPerm.attributes.find(p => p === '*' || attrs.indexOf(p) > -1)\n        }\n        else return !!perm.attributes.find(p => p === '*' || attrs.indexOf(p) > -1)\n      }\n      else {\n        if (otherPerm) return perm.granted || otherPerm.granted\n        else return perm.granted\n      }\n    }\n    catch (e) {\n      console.error(e)\n      return false\n    }\n  }\n}\n\nexport default AccessHelper\n","import React, { useState, useEffect } from 'react'\nimport PropTypes from 'prop-types'\n\nimport SeriesView from './views/SeriesView'\nimport SeriesEdit from './views/SeriesEdit'\nimport Slideshow from './views/Slideshow'\nimport PhotoViewTool from './views/PhotoViewTool'\nimport NewPhoto from './views/NewPhoto'\n\nimport AccesHelper from '../../lib/AccessHelper'\n\nimport { SeriesContext } from './contexts'\n\nexport const MODES = {\n  SERIES_VIEW: 'series',\n  SERIES_EDIT: 'editseries',\n  NEWPHOTO: 'newphoto',\n  NEWSERIES: 'newseries',\n  REVIEW: 'review',\n  PHOTO_VIEW: 'photoviewer',\n  PHOTO_VIEW_NEW: 'newphotoviewer',\n  SLIDESHOW: 'slideshow'\n}\nconst VIEW_ONLY_MODES = [MODES.SERIES_VIEW, MODES.PHOTO_VIEW, MODES.SLIDESHOW]\nconst VALID_STARTMODES = [MODES.SERIES_VIEW, MODES.NEWPHOTO, MODES.NEWSERIES, MODES.PHOTO_REVIEW, MODES.PHOTO_VIEW]\n\n/**\n * This component ties all the Repeat Photo components together\n */\nconst RepeatablePhotos = ({\n  modeName, series, seriesConfig, inputMethod: inputMethodINIT,\n  currentUserId, currentUserRole, accessControl, initialPhoto,\n  onChange, onClose, onDelete, onNewSeries, onChangePhoto,\n  onNewPhoto, onDeletePhoto,\n  onWatch, onUnWatch, watching, owned\n}) => {\n  // Manage view modes separately\n  // This is a pretty normal pattern for context\n  const [state, setState] = useState({\n    series,\n    seriesConfig,\n    ac: accessControl ? new AccesHelper(currentUserId, currentUserRole, accessControl) : null\n  })\n  const [mode, setMode] = useState({\n    current: {\n      name: modeName || MODES.SERIES_VIEW,\n      pid: initialPhoto,\n      inputMethod: inputMethodINIT\n    },\n    history: []\n  })\n  // console.log('RepeatablePhotos', state)\n\n  useEffect(() => setState({ ...state, series }), [series])\n\n  // When anything changes about a photo\n  const onUpdatePhoto = (photo, photoDelta) => {\n    const newSeries = { ...state.series }\n    newSeries.photos = newSeries.photos.map(ph => ph.id === photoDelta.id ? { ...ph, ...photoDelta } : ph)\n    onChangePhoto(photo, { ...photoDelta, seriesId: newSeries.id })\n  }\n\n  const onApprovePhoto = async ({ photo: photoDelta, series: seriesDelta }) => {\n    const newSeries = {\n      ...series,\n      photos: [...series.photos, photoDelta]\n    }\n    await onNewPhoto(photoDelta)\n    // THIS SEEMS A LITTLE HACKY BUT GO WITH IT FOR NOW\n    setState({ ...state, series: newSeries })\n    changeMode(MODES.PHOTO_VIEW_NEW, photoDelta.id)\n  }\n\n  const onCreateSeries = async ({ photo: photoDelta, series: seriesDelta }) => {\n    console.log('RepeatablePhotos: waiting for series ID', { seriesDelta, photoDelta })\n    const onNewSeriesReturn = await onNewSeries(seriesDelta, photoDelta)\n    console.log('RepeatablePhotos: waiting for series ID DONE', onNewSeriesReturn)\n  }\n\n  // When a photo is removed\n  const onDeletePhotos = (photoIdArr) => {\n    series.photos.filter(sp => photoIdArr.indexOf(sp.id) > -1).forEach(p => onDeletePhoto(p))\n  }\n\n  // Here's our modeChanger. My guess it will get a lot more complicated\n  // once the reducers get in and working\n  const changeMode = (newModeName, newPid, newInputMethod) => {\n    const canUpdate = state.ac.canUser('update', series, 'series')\n    if (state === null) onClose()\n    if (!canUpdate && VIEW_ONLY_MODES.indexOf(newModeName) < 0) {\n      console.error('ILLEGAL MODE CHANGE!!!!!', { from: mode.current, to: newModeName, canUpdate })\n    }\n    else {\n      // console.log('CHANGING MODE TO', newModeName)\n      setMode({\n        current: {\n          name: newModeName,\n          pid: newPid,\n          inputMethod: newInputMethod\n        },\n        history: [...mode.history, mode.current]\n      })\n    }\n  }\n  const lastMode = () => {\n    // console.log('REPEATABLEPHOTOS lastMode', mode)\n    if (mode.history.length > 0) {\n      const oldHistory = [...mode.history]\n      const oldMode = oldHistory.pop()\n      setMode({\n        current: oldMode,\n        history: oldHistory\n      })\n    }\n    else {\n      onClose()\n    }\n  }\n\n  // The action to initiate the photo viewer\n  const viewPhoto = (pid) => {\n    // console.log('DEBUG', mode, series.photos.find(p => p.id === pid))\n    changeMode(MODES.PHOTO_VIEW, pid)\n  }\n\n  let component = null\n\n  switch (mode.current.name) {\n    case MODES.SERIES_VIEW:\n      component = (\n        <SeriesView\n          // This one has lots of functions\n          onSlideshowStart={() => changeMode(MODES.SLIDESHOW)}\n          onChange={() => {\n            console.log('onChange NOT IMPLEMENTED')\n          }}\n          watching={watching}\n          owned={owned}\n          initialPhoto={initialPhoto}\n          onDeletePhotos={onDeletePhotos}\n          onDeleteSeries={onDelete}\n          onCameraAdd={() => changeMode(MODES.NEWPHOTO, null, 'camera')}\n          onEditSeries={() => changeMode(MODES.SERIES_EDIT)}\n          onLibraryAdd={() => changeMode(MODES.NEWPHOTO, null, 'library')}\n          onTileClick={viewPhoto}\n          onMenuBack={onClose}\n          onWatch={onWatch}\n          onUnWatch={onUnWatch}\n        />\n      )\n      break\n    case MODES.SERIES_EDIT:\n      component = (\n        <SeriesEdit\n          onCancel={() => changeMode(MODES.SERIES_VIEW)}\n          onOk={(seriesDelta) => {\n            onChange(series, { ...seriesDelta, id: series.id })\n            changeMode(MODES.SERIES_VIEW)\n          }}\n        />\n      )\n      break\n    case MODES.PHOTO_VIEW:\n      component = (\n        <PhotoViewTool\n          photos={state.series.photos}\n          initPhotoId={mode.current.pid}\n          onMenuBack={lastMode}\n          onUpdatePhoto={onUpdatePhoto}\n        />\n      )\n      break\n    case MODES.PHOTO_VIEW_NEW:\n      component = (\n        <PhotoViewTool\n          photos={state.series.photos}\n          initPhotoId={mode.current.pid}\n          newPhoto\n          onMenuBack={() => changeMode(MODES.SERIES_VIEW)}\n          onUpdatePhoto={onUpdatePhoto}\n        />\n      )\n      break\n    case MODES.SLIDESHOW:\n      component = (\n        <Slideshow photos={state.series.photos} onCancel={lastMode} />\n      )\n      break\n    case MODES.NEWPHOTO:\n      component = (\n        <NewPhoto\n          inputMethod={mode.current.inputMethod}\n          photos={series ? series.photos : null}\n          onCreate={onApprovePhoto}\n          onCancel={lastMode}\n        />\n      )\n      break\n    case MODES.NEWSERIES:\n      component = (\n        <NewPhoto\n          inputMethod={mode.current.inputMethod}\n          isNewSeries\n          onCreate={onCreateSeries}\n          onCancel={lastMode}\n        />\n      )\n      break\n    default:\n      console.log('REPEATABLEPHOTO: default state. you should NEVER see this', state)\n      component = null\n  }\n\n  return (\n    <SeriesContext.Provider value={state}>\n      {component}\n    </SeriesContext.Provider>\n  )\n}\n\nRepeatablePhotos.propTypes = {\n  modeName: PropTypes.oneOf(VALID_STARTMODES),\n  seriesConfig: PropTypes.object.isRequired,\n  watching: PropTypes.bool,\n  owned: PropTypes.bool,\n\n  currentUserId: PropTypes.string,\n  currentUserRole: PropTypes.string,\n  accessControl: PropTypes.object,\n\n  inputMethod: PropTypes.oneOf(['camera', 'library']),\n  series: PropTypes.object,\n  initialPhoto: PropTypes.string,\n\n  // Now some functions to handle actions we might take\n  onChange: PropTypes.func.isRequired,\n  onChangePhoto: PropTypes.func.isRequired,\n  onDeletePhoto: PropTypes.func.isRequired,\n  onNewPhoto: PropTypes.func.isRequired,\n  onNewSeries: PropTypes.func.isRequired,\n  onDelete: PropTypes.func.isRequired,\n  onClose: PropTypes.func.isRequired,\n  onWatch: PropTypes.func.isRequired,\n  onUnWatch: PropTypes.func.isRequired\n\n}\nRepeatablePhotos.defaultProps = {\n  mode: MODES.SERIES_VIEW\n}\n\nexport default RepeatablePhotos\n","import { openDb } from 'idb'\nimport { localDb } from '../config'\nimport uuidv4 from 'uuid/v4'\n\n/**\n * This is a leftover from the original, static RepeatablePhotos app.\n * For now it's just a decent way of storing the image data\n */\nconst dbPromise = openDb('serieslistDB', 1, upgradeDB => {\n  console.log('UPGRADE NEEDED', upgradeDB)\n  const store = upgradeDB.createObjectStore(localDb.imgStore)\n  console.log('UPGRADE NEEDED STORE', store)\n}).catch(e => {\n  console.error('ERROR', e)\n})\n\nexport const localUUID = (prefix) => {\n  return `__LOCAL_${prefix}::${uuidv4()}`\n}\n\nexport async function get (key) {\n  const db = await dbPromise\n  return db.transaction(localDb.imgStore).objectStore(localDb.imgStore).get(key)\n}\nexport async function getAll () {\n  const db = await dbPromise\n  return db.transaction(localDb.imgStore).objectStore(localDb.imgStore).getAll()\n}\nexport async function getOne () {\n  const db = await dbPromise\n  return db.transaction(localDb.imgStore).objectStore(localDb.imgStore).getAll(null, 1)\n}\nexport async function setEntry (key, val) {\n  const db = await dbPromise\n  const tx = db.transaction(localDb.imgStore, 'readwrite')\n  tx.objectStore(localDb.imgStore).put(val, key)\n  return tx.complete\n}\nexport async function deleteEntry (key) {\n  const db = await dbPromise\n  const tx = db.transaction(localDb.imgStore, 'readwrite')\n  tx.objectStore(localDb.imgStore).delete(key)\n  return tx.complete\n}\nexport async function clear () {\n  const db = await dbPromise\n  const tx = db.transaction(localDb.imgStore, 'readwrite')\n  tx.objectStore(localDb.imgStore).clear()\n  return tx.complete\n}\nexport async function keys () {\n  const db = await dbPromise\n  return db.transaction(localDb.imgStore).objectStore(localDb.imgStore).getAllKeys()\n}\n","import React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { home } from '../config'\nimport permissions from '../permissions'\nimport { graphql, compose } from 'react-apollo'\nimport { connect } from 'react-redux'\nimport actions from '../redux/actions'\nimport { getWholeSeries, allSeries } from './queries'\nimport { deletePhoto, deleteSeries, updateSeries, createPhoto, createSeries, updatePhoto, watchSeries, unWatchSeries } from './mutations'\nimport RepeatablePhotos, { MODES } from '../components/PhotoSeries'\nimport { localUUID } from '../lib/localdb'\nimport { AppContext } from '../contexts'\n\nconst SeriesConnect = ({\n  series, loading, domain, activeSeries, initialPhoto,\n  onAfterSeriesDelete, onBack, queueUpload, doneCreatingSeries,\n  createSeriesMutation, createPhotoMutation,\n  updateSeriesMutation, updatePhotoMutation,\n  deleteSeriesMutation, deletePhotoMutation,\n  watchSeriesMutation, unWatchSeriesMutation\n}) => {\n  const { role, currentUser, seriesConfig, user, signedIn } = useContext(AppContext)\n  let inputMethod = 'camera'\n  // Hack until we can get good loading object sorted\n  if (domain === home.AppStateTypes.SERIES) {\n    if (!series && !loading) return 'No series...'\n    else if (loading) return 'Loading...'\n  }\n  else {\n    if (domain === home.AppStateTypes.NEW_SERIES_CAMERA) inputMethod = 'camera'\n    else if (domain === home.AppStateTypes.NEW_SERIES_LIBRARY) inputMethod = 'library'\n  }\n\n  // console.log('SeriesConnect', { series, loading, currentState, activeSeries, role, currentUser })\n  let modeName = MODES.SERIES_VIEW\n  if (domain !== home.AppStateTypes.SERIES) modeName = MODES.NEWSERIES\n\n  return <RepeatablePhotos\n    modeName={modeName}\n    inputMethod={inputMethod}\n\n    owned={signedIn && user && series && user.id === series.id}\n    watching={signedIn && user && user.watching && user.watching.indexOf(activeSeries) > -1}\n\n    // Everything we need to determine access\n    currentUserId={currentUser.attributes.sub}\n    currentUserRole={role}\n    accessControl={permissions}\n\n    series={series}\n    initialPhoto={initialPhoto}\n    seriesConfig={seriesConfig}\n    // Now some functions to handle actions we might take\n    onNewPhoto={({ base64, ...newPhoto }) => {\n      console.log('onNewPhoto', { base64, ...newPhoto })\n      const ext = base64.split(';')[0].split('/')[1]\n      return createPhotoMutation(newPhoto, ext)\n        .then(({ data }) => {\n          // Don't start an upload until you get back a proper id\n          if (data.createPhoto.preAuth) {\n            const preAuth = JSON.parse(data.createPhoto.preAuth)\n            console.log('PREAUTH', data.createPhoto.preAuth)\n            queueUpload({\n              id: newPhoto.id,\n              seriesId: data.createPhoto.seriesId,\n              base64,\n              preAuth\n            })\n          }\n          return data\n        })\n        .catch(err => {\n          console.log('onNewPhoto Graphql Error', err.stack)\n          console.error(err)\n        })\n    }}\n    onChangePhoto={(photo, photoDelta) => updatePhotoMutation(photo, photoDelta)\n      .catch(err => {\n        console.log('onChangePhoto Graphql Error', err.stack)\n        console.error(err)\n      })\n    }\n    onDeletePhoto={(photo) => deletePhotoMutation(photo.id)\n      .then((...data) => {\n        console.log('photo deleted', data)\n      })\n      .catch(err => {\n        console.log('onDeletePhoto Graphql Error', err.stack)\n        console.error(err)\n      })\n    }\n    onChange={(series, seriesDelta) => updateSeriesMutation(series, seriesDelta)\n      .catch(err => {\n        console.log('onChange Graphql Error', err.stack)\n        console.error(err)\n      })\n    }\n    onNewSeries={(newSeries, photoNoId) => {\n      console.log('Series.connect: onNewSeries starting', newSeries)\n      return createSeriesMutation(newSeries)\n        .then(async ({ data }) => {\n          const { base64, ...newPhoto } = photoNoId\n          const ext = base64.split(';')[0].split('/')[1]\n          console.log('Series.connect: done createSeriesMutation', data)\n          const { data: photoData } = await createPhotoMutation({ ...photoNoId, seriesId: data.createSeries.id }, ext)\n\n          const preAuth = JSON.parse(photoData.createPhoto.preAuth)\n          console.log('PREAUTH', photoData.createPhoto.preAuth)\n          queueUpload({\n            id: newPhoto.id,\n            seriesId: photoData.createPhoto.seriesId,\n            base64,\n            preAuth\n          })\n          doneCreatingSeries(data.createSeries.id)\n          return data\n        })\n        .catch(err => {\n          console.log('onNewSeries Graphql Error', err.stack)\n          console.error(err)\n        })\n    }}\n    onDelete={() => deleteSeriesMutation()\n      .then(onAfterSeriesDelete)\n      .catch(err => {\n        console.log('onDelete Graphql Error', err.stack)\n        console.error(err)\n      })\n    }\n    onClose={onBack}\n    onWatch={signedIn ? watchSeriesMutation : null}\n    onUnWatch={signedIn ? unWatchSeriesMutation : null}\n  />\n}\nSeriesConnect.propTypes = {\n  domain: PropTypes.string,\n  activeSeries: PropTypes.string,\n  initialPhoto: PropTypes.string,\n\n  // From Redux\n  onAfterSeriesDelete: PropTypes.func,\n  doneCreatingSeries: PropTypes.func,\n  queueUpload: PropTypes.func,\n  onBack: PropTypes.func,\n\n  // Data from apollo\n  series: PropTypes.object,\n\n  // Functions From Apollo\n  loading: PropTypes.bool,\n  updateSeriesMutation: PropTypes.func,\n  updatePhotoMutation: PropTypes.func,\n  deleteSeriesMutation: PropTypes.func,\n  deletePhotoMutation: PropTypes.func,\n  createSeriesMutation: PropTypes.func,\n  createPhotoMutation: PropTypes.func,\n  watchSeriesMutation: PropTypes.func,\n  unWatchSeriesMutation: PropTypes.func\n}\n\n/**\n * Here's the graphql HOC that gets an individual series\n */\nconst withGetSelectedQuery = graphql(getWholeSeries, {\n  props: ({ data }) => {\n    if (data.error) console.error(data.error)\n    // console.log('HERE', data)\n    let series = null\n    try {\n      if (!data.loading && !data.error) series = data.series\n    }\n    catch (e) {\n      console.error(data)\n      console.error(e)\n    }\n    return {\n      data,\n      loading: data.loading,\n      series\n    }\n  },\n  skip: ({ activeSeries, isNewSeries }) => !activeSeries || isNewSeries,\n  options: ({ activeSeries }) => ({\n    variables: {\n      id: activeSeries\n    }\n  })\n})\n\nconst withUpdateSeriesMutation = graphql(updateSeries, {\n  props: ({ mutate, ownProps }) => ({\n    // We turn this into a thunk so we can handle the business logic here and not in a JSX region\n    updateSeriesMutation: (series, seriesDelta) => mutate({\n      // input UpdateSeries {\n      //   id: ID!\n      //   name: String\n      //   note: String\n      //   latitude: Float\n      //   longitude: Float\n      //   direction: Int\n      // }\n      variables: { series: sanitizeUpdateParams(seriesDelta, ['id', 'name', 'access', 'note', 'latitude', 'longitude', 'direction']) },\n      optimisticResponse: {\n        updateSeries: {\n          ...series,\n          ...seriesDelta,\n          __typename: 'Series'\n        }\n      },\n      update: (store, { data }) => {\n        // console.log('withUpdateSeriesMutation start Manip:', JSON.stringify(data, null, 2))\n        const qdata = store.readQuery({ query: getWholeSeries, variables: { id: ownProps.activeSeries } })\n        qdata.series = { ...qdata.series, ...seriesDelta }\n        store.writeQuery({ query: getWholeSeries, data: qdata })\n        // console.log('withUpdateSeriesMutation Done Manip:', qdata)\n\n        // Update: allSeries\n        // We might not have called this query yet so let it throw if it wants\n        try {\n          const qdataAll = store.readQuery({ query: allSeries, variables: { limit: 100 } })\n          // console.log('withUpdateSeriesMutation qdataAll:', qdataAll)\n          const summary = sanitizeUpdateParams(seriesDelta, ['id', 'name', 'access', 'latitude', 'longitude', 'direction'])\n          qdataAll.allSeries.seriesSummaries = qdataAll.allSeries.seriesSummaries.map(s => s.id !== summary.id\n            ? s\n            : { ...s, ...summary }\n          )\n          store.writeQuery({ query: allSeries, data: qdataAll })\n          // console.log('withUpdateSeriesMutation qdataAll WRITE:', qdataAll)\n        }\n        catch (e) { }\n      }\n    })\n  })\n})\n\n// id: ID!\n// seriesId: ID!\n// takenOn: String\n// tags: [TagInput]\n// note: String\nconst withUpdatePhotoMutation = graphql(updatePhoto, {\n  props: ({ mutate, ownProps }) => ({\n    // We turn this into a thunk so we can handle the business logic here and not in a JSX region\n    updatePhotoMutation: (photo, photoDelta) => {\n      const sanitizedPhotoDelta = sanitizeUpdateParams(photoDelta, [ 'id', 'seriesId', 'takenOn', 'tags', 'note' ])\n      if (sanitizedPhotoDelta.tags && sanitizedPhotoDelta.tags.length > 0) {\n        // input TagInput {\n        //   label: String\n        //   typeId: String,\n        //   coords: ImageCoordsInput\n        // }\n        sanitizedPhotoDelta.tags = sanitizedPhotoDelta.tags.map(t => {\n          const newT = sanitizeUpdateParams(t, [ 'label', 'typeId', 'coords' ])\n          if (newT.coords) newT.coords = sanitizeUpdateParams(newT.coords, [ 'x', 'y' ])\n          return newT\n        })\n      }\n      // console.log('withUpdatePhotoMutation', sanitizedPHoto)\n      return mutate({\n      // input UpdatePhoto {\n      //   id: ID!\n      //   seriesId: ID!\n      //   takenOn: String\n      //   tags: [TagInput]\n      //   note: String\n      // }\n        variables: { photo: sanitizedPhotoDelta },\n        optimisticResponse: {\n          updatePhoto: {\n            ...photo,\n            ...sanitizedPhotoDelta,\n            __typename: 'Photo'\n          }\n        },\n        update: (store, { data }) => {\n          // console.log('updatePhotoMutation start Manip:', JSON.stringify(data, null, 2))\n          const qdata = store.readQuery({ query: getWholeSeries, variables: { id: ownProps.activeSeries } })\n          // Gotta add Typenames\n          const updatedPhoto = {\n            ...sanitizedPhotoDelta,\n            tags: sanitizedPhotoDelta.tags ? sanitizedPhotoDelta.tags.map(t => {\n              const newT = { ...t, __typename: 'Tag' }\n              newT.coords = newT.coords ? { ...newT.coords, __typename: 'ImageCoords' } : null\n              return newT\n            }) : []\n          }\n          // console.log('updatePhotoMutation', updatedPhoto)\n          qdata.series.photos = qdata.series.photos.map(photo => photo.id !== photoDelta.id ? photo : { ...photo, ...updatedPhoto })\n\n          store.writeQuery({ query: getWholeSeries, data: qdata })\n          // console.log('updatePhotoMutation Manip:', { qdata })\n        }\n      })\n    }\n  })\n})\n\nconst withDeleteSeriesDeleteMutation = graphql(deleteSeries, {\n  props: ({ mutate, ownProps }) => {\n    return {\n      deleteSeriesMutation: () => mutate({\n        variables: { id: ownProps.activeSeries },\n        optimisticResponse: {\n          deleteSeries: ownProps.activeSeries\n        },\n        update: (store, { data }) => {\n          try {\n            const qdataAll = store.readQuery({ query: allSeries, variables: { limit: 100 } })\n            qdataAll.allSeries.seriesSummaries = qdataAll.allSeries.seriesSummaries.filter(s => s.id !== data.deleteSeries)\n            store.writeQuery({ query: allSeries, data: qdataAll })\n          }\n          catch (e) { }\n        }\n      })\n    }\n  }\n})\n\nconst withDeletePhotoMutation = graphql(deletePhoto, {\n  props: ({ mutate, ownProps }) => ({\n    // We turn this into a thunk so we can handle the business logic here and not in a JSX region\n    deletePhotoMutation: (photoId) => mutate({\n      variables: { seriesId: ownProps.series.id, photoId },\n      optimisticResponse: {\n        deletePhoto: photoId\n      },\n      update: (store, { data }) => {\n        console.log('deletePhotoMutation start Manip:', JSON.stringify(data, null, 2))\n        let finalCount = null\n\n        const qdata = store.readQuery({ query: getWholeSeries, variables: { id: ownProps.activeSeries } })\n        qdata.series.photos = qdata.series.photos.filter(photo => photo.id !== data.deletePhoto)\n\n        finalCount = qdata.series.photos.length\n        qdata.series.photoCount = finalCount\n        store.writeQuery({ query: getWholeSeries, data: qdata })\n        console.log('deletePhotoMutation start Manip WRITE:', qdata)\n\n        // Update: allSeries\n        // We might not have called this query yet so let it throw if it wants\n        try {\n          const qdataAll = store.readQuery({ query: allSeries, variables: { limit: 100 } })\n          console.log('deletePhotoMutation qdataAll:', qdataAll)\n          qdataAll.allSeries.seriesSummaries = qdataAll.allSeries.seriesSummaries.map(s => s.id !== data.deletePhoto\n            ? s\n            : { ...s, photoCount: finalCount !== null ? finalCount : s.photoCount }\n          )\n          store.writeQuery({ query: allSeries, data: qdataAll })\n          console.log('deletePhotoMutation qdataAll WRITE:', qdataAll)\n        }\n        catch (e) { }\n\n        console.log('Done Manip:', qdata.series.photos)\n      }\n    })\n  })\n})\n\nconst withCreateNewSeries = graphql(createSeries, {\n  props: ({ mutate, ownProps }) => {\n    return {\n      createSeriesMutation: (newSeries) => {\n        // input NewSeriesInput {\n        //   name: String!\n        //   note: String\n        //   latitude: Float!\n        //   longitude: Float!\n        //   direction: Int\n        //   meta: String\n        // }\n        return mutate({\n          variables: { series: sanitizeUpdateParams(newSeries, ['name', 'note', 'latitude', 'longitude', 'direction', 'meta']) },\n          optimisticResponse: {\n            'createSeries': {\n              'id': localUUID('SERIES'),\n              'name': newSeries.name || null,\n              'note': newSeries.note || null,\n              'meta': newSeries.meta || {},\n              'featured': newSeries.featured || null,\n              'coords': newSeries.coords || null,\n              'direction': newSeries.direction || null,\n              'photoCount': 0,\n              'photos': [],\n              __typename: 'Series'\n            }\n          },\n          update: (store, { data }) => {\n            // We need to write this query from scratch\n            console.log('STARTING TO CREATE THE SERIES', data, store)\n            // dumpLog(store.data, '##CACHE-NEW_SERIES_BEFORE')\n            try {\n              store.writeQuery({ query: getWholeSeries,\n                data: { series: data.createSeries }\n              })\n              console.log('Series write getWholeSeries', { series: data.createSeries })\n            }\n            catch (e) {\n              console.error(e)\n            }\n\n            try {\n              const qdataAll = store.readQuery({ query: allSeries, variables: { limit: 100 } })\n              // console.log('createSeriesMutation qdataAll:', qdataAll)\n              const newAllSeriesEntry = sanitizeUpdateParams(data.createSeries, ['id', 'name', 'updatedOn', 'featured', 'longitude', 'latitude', 'photoCount', 'seriesStatus', 'direction'])\n              qdataAll.allSeries.seriesSummaries.push(newAllSeriesEntry)\n              store.writeQuery({ query: allSeries, data: qdataAll })\n              // console.log('createSeriesMutation qdataAll WRITE:', qdataAll)\n            }\n\n            catch (e) {\n              // dumpLog(store.data, '##CACHE-NEW_SERIES_ERROR')\n              console.error('createSeriesMutation allSeries error')\n              console.error(e)\n            }\n            // dumpLog(store.data, '##CACHE-NEW_SERIES_AFTER')\n          }\n        })\n      }\n    }\n  }\n})\n\nconst withCreateNewPhoto = graphql(createPhoto, {\n  props: ({ mutate, ownProps }) => {\n    return {\n      createPhotoMutation: (newPhoto, ext) => {\n        // input NewPhotoInput {\n        //   seriesId: ID!\n        //   takenOn: String\n        //   meta: String\n        //   tags: [TagInput]\n        //   note: String\n        // }\n        // When we're not creating a series the seriesId isn't passed in\n        // so we add it now\n        const { base64, ...newPhotoInput } = newPhoto\n        if (!newPhotoInput.seriesId && ownProps.activeSeries) {\n          newPhotoInput.seriesId = ownProps.activeSeries\n        }\n        return mutate({\n          variables: { photo: sanitizeUpdateParams(newPhotoInput, [ 'seriesId', 'takenOn', 'meta', 'tags', 'note' ]), ext },\n          optimisticResponse: {\n            'createPhoto': {\n              'photo': {\n                'id': localUUID('PHOTO'),\n                'meta': newPhotoInput.meta,\n                'seriesId': newPhotoInput.seriesId,\n                'createdOn': Date.now().toString(),\n                'createdUser': {\n                  'id': ownProps.authData.attributes.sub,\n                  'username': ownProps.authData.Username\n                },\n                'updatedBy': ownProps.authData.attributes.sub,\n                'updatedOn': Date.now().toString(),\n                'takenOn': newPhotoInput.takenOn,\n                'tags': newPhotoInput.tags || [],\n                'paths': {\n                  large: null,\n                  orig: null,\n                  thumb: null,\n                  medium: null,\n                  __typename: 'Paths'\n                },\n                '__typename': 'Photo'\n              },\n              'preAuth': null,\n              '__typename': 'NewPhotoOutput'\n            }\n          },\n          update: (store, { data }) => {\n            // Update: getWholeSeries\n            console.log('createPhotoMutation store.readQuery:', { data, store, ownProps })\n\n            try {\n              const qdata = store.readQuery({ query: getWholeSeries, variables: { id: data.createPhoto.seriesId } })\n              qdata.series.photos = qdata.series.photos = [...qdata.series.photos, data.createPhoto]\n\n              store.writeQuery({ query: getWholeSeries, data: qdata })\n            }\n            catch (e) {\n              // This won't fire on new series and that's ok for now.\n            }\n\n            // Update: allSeries\n            // We might not have called this query yet so let it throw if it wants\n            let qdataAll = null\n            try {\n              qdataAll = store.readQuery({ query: allSeries, variables: { limit: 100 } })\n              console.log('createPhotoMutation qdataAll:', qdataAll)\n              qdataAll.allSeries.seriesSummaries = qdataAll.allSeries.seriesSummaries.map(s => s.id !== data.createPhoto.photo.seriesId\n                ? s\n                : { ...s, photoCount: s.photoCount + 1 }\n              )\n              store.writeQuery({ query: allSeries, data: qdataAll })\n              console.log('createPhotoMutation qdataAll: WRITE', qdataAll)\n            }\n            catch (e) {\n              console.error('createPhotoMutation allSeries ERROR')\n              console.error(e)\n            }\n          }\n        })\n      }\n    }\n  }\n})\n\nconst withWatchSeriesMutation = graphql(watchSeries, {\n  props: ({ mutate, ownProps }) => {\n    return {\n      watchSeriesMutation: () => mutate({\n        variables: { id: ownProps.activeSeries },\n        optimisticResponse: {\n          watchSeries: ownProps.activeSeries\n        },\n        update: (store, { data }) => {\n          // TODO: modify the getuser query to add this to the list of favourites\n          // try {\n          //   const qdataAll = store.readQuery({ query: allSeries, variables: { limit: 100 } })\n          //   qdataAll.allSeries.seriesSummaries = qdataAll.allSeries.seriesSummaries.filter(s => s.id !== data.deleteSeries)\n          //   store.writeQuery({ query: allSeries, data: qdataAll })\n          // }\n          // catch (e) { }\n        }\n      })\n    }\n  }\n})\n\nconst withUnWatchSeriesMutation = graphql(unWatchSeries, {\n  props: ({ mutate, ownProps }) => {\n    return {\n      unWatchSeriesMutation: () => mutate({\n        variables: { id: ownProps.activeSeries },\n        optimisticResponse: {\n          unWatchSeries: ownProps.activeSeries\n        },\n        update: (store, { data }) => {\n          // try {\n          //   const qdataAll = store.readQuery({ query: allSeries, variables: { limit: 100 } })\n          //   qdataAll.allSeries.seriesSummaries = qdataAll.allSeries.seriesSummaries.filter(s => s.id !== data.deleteSeries)\n          //   store.writeQuery({ query: allSeries, data: qdataAll })\n          // }\n          // catch (e) { }\n        }\n      })\n    }\n  }\n})\n\n/**\n * Compose all our queries together\n */\nconst connectedWithApollo = compose(\n  withGetSelectedQuery,\n  withCreateNewSeries,\n  withCreateNewPhoto,\n  withUpdateSeriesMutation,\n  withUpdatePhotoMutation,\n  withDeleteSeriesDeleteMutation,\n  withDeletePhotoMutation,\n  withWatchSeriesMutation,\n  withUnWatchSeriesMutation\n)(SeriesConnect)\n\n/**\n * Map our redux state and functions\n */\nconst mapStateToProps = (state, props) => {\n  const { current: { activeSeries, initialPhoto, domain } } = state.home\n  return { activeSeries, initialPhoto, domain }\n}\n\nconst mapDispatchToProps = dispatch => ({\n  onBack: () => {\n    dispatch(actions.homeStateBack())\n  },\n  onAfterSeriesDelete: (key, newProgress) => {\n    dispatch(actions.setActiveSeries(null))\n    dispatch(actions.homeStateBack())\n  },\n  queueUpload: (uploadObj) => {\n    dispatch(actions.queueUpload(uploadObj))\n  },\n  doneCreatingSeries: (seriesId) => {\n    dispatch(actions.setActiveSeries(seriesId))\n    dispatch(actions.setHomeState(home.AppStateTypes.SERIES))\n  }\n})\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(connectedWithApollo)\n\n/**\n * We need to filter out null values and params we don't desire\n */\nfunction sanitizeUpdateParams (inputObj, desiredParams) {\n  const newDesiredParams = [...desiredParams, '__typename']\n  const remainder = Object.keys(inputObj).filter(key => newDesiredParams.indexOf(key) > -1)\n  console.log('sanitizeUpdateParams', { orig: Object.keys(inputObj), remainder })\n  return remainder.reduce((acc, key) => ({ ...acc, [key]: inputObj[key] }), {})\n}\n\nfunction dumpLog (obj, name) {\n  console.log(`${Date.now()}__${name}`, JSON.stringify(obj, null, 2))\n}\n","import { useState, useEffect, useCallback, useRef } from 'react'\nimport uuid from 'uuid/v4'\nimport WebMercatorViewport from 'viewport-mercator-project'\nimport rbush from 'rbush'\nimport { point, centroid, featureCollection } from '@turf/turf'\nimport { debounce } from './util'\n\nconst useClusteredData = (data, filterBounds, currentZoom, viewport, sizeScale, queryVersion) => {\n  const [clusteredData, setClusteredData] = useState([])\n  const [filteredData, setFilteredData] = useState({ single: [], cluster: [] })\n  const [version, setVersion] = useState(0)\n\n  // We promisify and debounce the expensive stuff so it runs outside our render loop\n  const updateDataDebounce = useCallback(debounce(async (...innerArgs) => {\n    const updatedData = await updateData(...innerArgs)\n    setClusteredData(updatedData)\n    // setClusteredData(updatedData)\n    setVersion(version + 1)\n  }, 1000), [])\n\n  const filterDataDebounce = useCallback(debounce(async (...innerArgs) => {\n    const filtered = await filterData(...innerArgs)\n    setFilteredData(filtered)\n  }, 300), [])\n\n  // Here's the really expensive call. Make sure this only runs when the data changes\n  useEffect(() => {\n    updateDataDebounce(data, sizeScale, viewport)\n  }, [data.length, queryVersion])\n\n  useEffect(() => {\n    filterDataDebounce(clusteredData, filterBounds, currentZoom)\n  }, [clusteredData, currentZoom, filterBounds, version])\n\n  return { filteredClusteredData: filteredData }\n}\n\nexport default useClusteredData\n\n// Compute icon clusters\n// We use the projected positions instead of longitude and latitude to build\n// the spatial index, because this particular dataset is distributed all over\n// the world, we can't use some fixed deltaLon and deltaLat\nconst updateData = (data, sizeScale, viewport) => {\n  // console.log('----------------------------------UPDATE CLUSTER----------------------------------', { data, sizeScale, viewport })\n\n  if (!data) {\n    return []\n  }\n  const tree = rbush(9, ['.x', '.y', '.x', '.y'])\n\n  const transform = new WebMercatorViewport({\n    ...viewport,\n    zoom: 0\n  })\n\n  // console.log('DATA', data)\n  // The root of this is GeoJSON so that's what we have to build\n  const newData = data.map(p => {\n    // Create some GeoJSON that we can render as a dot\n    let screenCoords = [0, 0]\n    try {\n      screenCoords = transform.project(p.coords)\n    }\n    catch (e) {\n      console.error(e)\n    }\n    const { longitude, latitude, ...properties } = p\n    return {\n      x: screenCoords[0],\n      y: screenCoords[1],\n      photoCount: properties.photoCount,\n      zoomLevels: [],\n      geoJSON: p.coords ? point(p.coords, { ...properties }) : null\n    }\n  })\n\n  tree.clear()\n  tree.load(newData)\n\n  for (let z = 0; z <= 20; z++) {\n    const radius = sizeScale / Math.sqrt(2) / Math.pow(2, z)\n    // const radius = 60 / Math.sqrt(2) / Math.pow(2, z)\n\n    newData.forEach(p => {\n      if (p.zoomLevels[z] === undefined) {\n        // this point does not belong to a cluster\n        const { x, y } = p\n\n        // find all points within radius that do not belong to a cluster\n        const neighbors = tree\n          .search({\n            minX: x - radius,\n            minY: y - radius,\n            maxX: x + radius,\n            maxY: y + radius\n          })\n          .filter(neighbor => neighbor.zoomLevels[z] === undefined)\n\n        // only show the center point at this zoom level\n        neighbors.forEach(neighbor => {\n          if (neighbor === p) {\n            const newGeoJSON = neighbors.length === 1\n              ? p.geoJSON\n              : centroid(featureCollection(neighbors.map(n => n.geoJSON)))\n\n            newGeoJSON.properties = {\n              ...newGeoJSON.properties,\n              id: newGeoJSON.properties.id || uuid(),\n              count: neighbors.length,\n              reducedPhotoCount: neighbors.reduce((acc, { photoCount }) => photoCount ? acc + photoCount : acc, 0),\n              points: neighbors.map(n => n.geoJSON)\n            }\n            p.zoomLevels[z] = newGeoJSON\n          }\n          else {\n            neighbor.zoomLevels[z] = null\n          }\n        })\n      }\n    })\n  }\n\n  // console.log('----------------------------------UPDATE CLUSTER DONE----------------------------------')\n  return newData.map(({ zoomLevels }) => zoomLevels)\n}\n\nfunction filterData (clusteredData, filterBounds, newZ) {\n  // console.log('----------------------------------FILTER CLUSTER----------------------------------', { clusteredData, filterBounds, newZ })\n\n  return clusteredData\n    // Filter out anything not relevant to this zoom level\n    .filter(d => !!d[newZ])\n    // Restructure the object to be a little more JSON-friendly\n    .reduce((acc, zoomLevels) => {\n      const geoJSON = zoomLevels[newZ]\n      const coords = geoJSON.geometry.coordinates\n      const { count } = geoJSON.properties\n\n      if (!filterBounds || filterBounds.length < 4 || (\n        filterBounds[0] < coords[0] && filterBounds[1] < coords[1] &&\n        filterBounds[2] > coords[0] && filterBounds[3] > coords[1]\n      )) {\n        if (count > 1) acc.cluster.push(geoJSON)\n        else acc.single.push(geoJSON)\n      }\n      return acc\n    }, {\n      single: [],\n      cluster: []\n    })\n}\n","export default theme => ({\n  root: {\n    position: 'relative',\n    height: '100%',\n    '& .myPosMarker': {\n      zIndex: 1\n    },\n    '& .singleMarker': {\n      zIndex: 3\n    },\n    '& .clusterMarker': {\n      zIndex: 2\n    }\n  },\n  fab: {\n    background: theme.palette.secondary.main,\n    color: theme.palette.secondary.contrastText\n  },\n  topBar: {\n    position: 'absolute',\n    zIndex: 1000,\n    top: 0\n  },\n  zoomOutFab: {\n    margin: theme.spacing(0.5),\n    padding: theme.spacing(0.5),\n    border: '2px solid',\n    borderRadius: theme.spacing(1),\n    background: theme.palette.common.white,\n    fontSize: 20,\n    position: 'absolute',\n    zIndex: 100,\n    bottom: theme.spacing(2),\n    right: theme.spacing(10)\n  },\n  selectedPopup: {\n    padding: theme.spacing(0, 1, 0, 1),\n    width: '90%',\n    maxWidth: 400,\n    zIndex: 2000,\n    position: 'absolute',\n    bottom: theme.spacing(1),\n    left: '50%',\n    transformOrigin: '0% 50%',\n    transform: 'translateY(0%) translateX(-50%)'\n  }\n})\n","import React from 'react'\nimport createSvgIcon from '@material-ui/icons/utils/createSvgIcon'\n\nexport default createSvgIcon(\n  <React.Fragment>\n    <path d='M 5.4 0 L 18.6 0 C 21.58 0 24 2.42 24 5.4 L 24 18.6 C 24 21.58 21.58 24 18.6 24 L 5.4 24 C 2.42 24 0 21.58 0 18.6 L 0 5.4 C 0 2.42 2.42 0 5.4 0 Z'\n      style={{\n        fill: 'none',\n        stroke: '#000000',\n        strokeWidth: 2,\n        strokeLinecap: 'square',\n        strokeDasharray: '0.1,3',\n        strokeMiterlimit: 5\n      }} />\n    <path d=' M 12 1.333 L 15.135 7.685 L 22.145 8.704 L 17.072 13.648 L 18.27 20.63 L 12 17.333 L 5.73 20.63 L 6.928 13.648 L 1.855 8.704 L 8.865 7.685 L 12 1.333 Z ' fill='rgb(235,235,235)' vectorEffect='non-scaling-stroke'\n      strokeWidth='1'\n      stroke='rgb(0,0,0)'\n      strokeLinejoin='miter'\n      strokeLinecap='square'\n      strokeMiterlimit='3' />\n  </React.Fragment>, 'AppLogo')\n","import React, { useState, useContext } from 'react'\nimport classNames from 'classnames'\nimport PropTypes from 'prop-types'\n\nimport Toolbar from '@material-ui/core/Toolbar'\nimport Drawer from '@material-ui/core/Drawer'\nimport Divider from '@material-ui/core/Divider'\nimport IconButton from '@material-ui/core/IconButton'\nimport List from '@material-ui/core/List'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport MenuIcon from '@material-ui/icons/Menu'\nimport AppLogo from '../icons/AppLogo'\nimport { AppContext } from '../contexts'\n\nimport ExitToAppIcon from '@material-ui/icons/ExitToApp'\nimport AccountCircleIcon from '@material-ui/icons/AccountCircle'\n\n// import MenuIcon from '@material-ui/core/Menu'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst style = theme => ({\n  root: {\n    padding: '2px 4px',\n    display: 'flex',\n    alignItems: 'center',\n    width: '100%',\n    background: theme.palette.primary.main,\n    color: theme.palette.primary.contrastText\n  },\n  searchIcon: {\n    opacity: 0.3,\n    marginRight: theme.spacing(1)\n  },\n  transparent: {\n    background: 'none',\n    color: theme.palette.text.primary\n  },\n  input: {\n    background: '#FFFFFF',\n    border: '1px solid #AAAAAA',\n    borderRadius: theme.spacing(1) * 2,\n    paddingLeft: theme.spacing(1),\n    marginLeft: 0,\n    flex: 1\n  },\n  children: {\n    flexGrow: 1\n  },\n  iconButton: {\n    padding: 10\n  },\n  divider: {\n    width: 1,\n    height: 28,\n    margin: 4\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst TopBar = ({ className, children, isTransparent, menuItems }) => {\n  const classes = useStyles()\n  const [drawerOpen, setDrawerOpen] = useState(false)\n  const { signOut, signedIn, forceSignIn } = useContext(AppContext)\n  return (\n    <Toolbar className={classNames(classes.root, className, isTransparent ? classes.transparent : null)} disableGutters>\n      <IconButton className={classes.iconButton}>\n        <AppLogo />\n      </IconButton>\n      {/* {hasSearch && (\n        <InputBase\n          className={classes.input}\n          placeholder='Search...'\n          endAdornment={\n            <InputAdornment position='end'>\n              <SearchIcon className={classes.searchIcon} />\n            </InputAdornment>\n          }\n        />\n      )} */}\n      <div className={classes.children}>\n        {children}\n      </div>\n      {signedIn && (\n        <IconButton\n          color='inherit'\n          className={classes.iconButton}\n          aria-label='Menu'\n          onClick={() => setDrawerOpen(!drawerOpen)}>\n          <MenuIcon color='inherit' />\n        </IconButton>\n      )}\n      {!signedIn && (\n        <IconButton\n          color='primary'\n          className={classes.iconButton}\n          aria-label='Menu'\n          onClick={forceSignIn}\n        >\n          <AccountCircleIcon color='primary' />\n        </IconButton>\n      )}\n      <Drawer anchor='top' open={drawerOpen} onClose={() => setDrawerOpen(false)}>\n        <div\n          tabIndex={0}\n          role='button'\n          onClick={() => setDrawerOpen(false)}\n          onKeyDown={() => setDrawerOpen(false)}\n        >\n          <div className={classes.fullList}>\n            <List>\n              {menuItems && menuItems.map(({ callback, text, icon, color }, idx) => (\n                <ListItem button key={`top-menu-item-${idx}`} onClick={callback}>\n                  {icon && <ListItemIcon color={color}>{icon}</ListItemIcon>}\n                  <ListItemText primary={text} color={color} />\n                </ListItem>\n              ))}\n            </List>\n            {menuItems && <Divider />}\n            <List>\n              {signedIn && (\n                <ListItem button onClick={signOut}>\n                  <ListItemIcon>\n                    <ExitToAppIcon />\n                  </ListItemIcon>\n                  <ListItemText primary='Sign Out' />\n                </ListItem>\n              )}\n            </List>\n          </div>\n\n        </div>\n      </Drawer>\n    </Toolbar>\n  )\n}\n\nTopBar.propTypes = {\n  className: PropTypes.string,\n  children: PropTypes.any,\n  isTransparent: PropTypes.bool,\n  menuItems: PropTypes.arrayOf(PropTypes.shape({\n    callback: PropTypes.func,\n    text: PropTypes.string,\n    icon: PropTypes.any,\n    color: PropTypes.string\n  }))\n}\n\nexport default TopBar\n","import React, { useRef, useLayoutEffect, useCallback } from 'react'\nimport PropTypes from 'prop-types'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\nimport InputBase from '@material-ui/core/InputBase'\n\nimport SearchIcon from '@material-ui/icons/Search'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { debounce } from '../../lib/util'\n\nconst useSearchBarStyles = makeStyles(theme => ({\n  root: {\n    position: 'relative',\n    borderRadius: theme.shape.borderRadius,\n    backgroundColor: fade(theme.palette.common.white, 0.3),\n    '&:hover': {\n      backgroundColor: fade(theme.palette.common.white, 0.5)\n    },\n    marginRight: theme.spacing(2),\n    marginLeft: 0,\n    width: '100%',\n    [theme.breakpoints.up('sm')]: {\n      marginLeft: theme.spacing(3),\n      width: 'auto'\n    }\n  },\n  inputRoot: {\n    color: 'inherit'\n  },\n  inputInput: {\n    padding: theme.spacing(1, 1, 1, 7),\n    transition: theme.transitions.create('width'),\n    width: '100%',\n    [theme.breakpoints.up('md')]: {\n      width: 200\n    }\n  },\n  searchIcon: {\n    width: theme.spacing(7),\n    height: '100%',\n    position: 'absolute',\n    pointerEvents: 'none',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center'\n  }\n}))\n\n/**\n *\n */\nexport const SearchInput = ({ autoFocus, disabled, onChange, onClick, defaultValue }) => {\n  const inputRef = useRef()\n  const classes = useSearchBarStyles()\n\n  const debounceSearchText = useCallback(\n    debounce(onChange, 500),\n    [onChange]\n  )\n\n  useLayoutEffect(() => {\n    if (inputRef.current) {\n      // console.log('Setting focus')\n      // inputRef.current.focus()\n    }\n  }, [])\n  return (\n    <div className={classes.root} onClick={onClick}>\n      <div className={classes.searchIcon}>\n        <SearchIcon />\n      </div>\n      <InputBase\n        autoFocus={!disabled && autoFocus}\n        inputProps={{\n          onBlur: () => {\n            // console.log('onBlur')\n            // inputRef.current.focus()\n          }\n        }}\n        onChange={(e) => {\n          // console.log('onChange', e.target.value)\n          debounceSearchText(e.target.value)\n        }}\n        placeholder='Search'\n        disabled={disabled}\n        defaultValue={defaultValue}\n\n        inputRef={inputRef}\n        classes={{\n          root: classes.inputRoot,\n          input: classes.inputInput\n        }}\n      />\n    </div>\n  )\n}\n\nSearchInput.propTypes = {\n  autoFocus: PropTypes.bool,\n  disabled: PropTypes.bool,\n  onChange: PropTypes.func,\n  defaultValue: PropTypes.string,\n  onClick: PropTypes.func\n}\n\nexport default SearchInput\n","import React from 'react'\nimport classNames from 'classnames'\nimport Chip from '@material-ui/core/Chip'\nimport { makeStyles } from '@material-ui/core/styles'\nconst useStyles = makeStyles(theme => ({\n  root: {\n    height: theme.spacing(2),\n    marginRight: theme.spacing(1)\n  },\n  label: {\n    padding: theme.spacing(0, 1, 0, 1),\n    borderRadius: theme.spacing(0.5)\n  }\n}))\n\nconst TinyChip = (props) => {\n  const classes = useStyles()\n  return (\n    <Chip\n      {...props}\n      classes={{\n        root: classNames(classes.root, props.className),\n        label: classes.label\n      }}\n    />\n  )\n}\n\nexport default TinyChip\n","import React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport List from '@material-ui/core/List'\nimport TinyChip from './TinyChip'\nimport Typography from '@material-ui/core/Typography'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { formatDate } from '../../lib/datelib'\n\nimport { ACCESS } from '../../config'\nimport { AppContext } from '../../contexts'\n\nconst style = theme => ({\n  root: {\n    margin: 0,\n    padding: theme.spacing(1)\n  },\n  chipContainer: {\n    display: 'flex',\n    width: '100%'\n  },\n  grow: { flexGrow: 1 },\n  accessPUBLIC: {\n    color: 'white',\n    background: ACCESS.PUBLIC.color\n  },\n  accessPRIVATE: {\n    color: 'white',\n    background: ACCESS.PRIVATE.color\n  },\n  accessOPEN: {\n    color: 'white',\n    background: ACCESS.OPEN.color\n  },\n  img: {\n    objectFit: 'cover',\n    height: '100%',\n    width: '100%'\n  },\n  text: {\n    margin: 0,\n    padding: theme.spacing(0, 1),\n    alignSelf: 'flex-start'\n  },\n  titleText: {\n    textOverflow: 'ellipsis',\n    whiteSpace: 'nowrap',\n    overflow: 'hidden'\n  },\n  dateContainer: {\n    display: 'flex'\n  },\n  dateLabel: {\n    fontWeight: 'bold',\n    flex: '1 1 50px'\n  },\n  dateText: {\n\n  },\n  imgContainer: {\n    flex: '0 0 25%',\n    alignSelf: 'flex-start',\n    height: '100%'\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst SeriesListItem = ({ series, loading, onClick, children, showCreatedOn, showLastPhoto }) => {\n  const classes = useStyles()\n  const { seriesConfig } = useContext(AppContext)\n  if (loading || !series) return 'LOADING...'\n  let thumb = null\n  let accessLabel = ACCESS.PRIVATE.label\n  try {\n    thumb = seriesConfig.getPhotoUrl(series.featured, 'thumb')\n    accessLabel = series.access ? ACCESS[series.access].label : ACCESS.PRIVATE.label\n  }\n  catch (e) {\n    console.error(e)\n  }\n  return (\n    <ListItem className={classes.root} button component='div' disableGutters>\n      <div className={classes.imgContainer} >\n        <img alt='thumbnail' src={thumb} className={classes.img} onClick={onClick} />\n      </div>\n      <ListItemText className={classes.text} disableTypography onClick={onClick}>\n        <Typography variant='body1' component='div' className={classes.titleText}>\n          {series.name || loading}\n        </Typography>\n        <Typography variant='body2' component='div'>\n          {series.access && <TinyChip label={accessLabel} className={classes[`access${series.access}`]} />}\n          Series <strong>by:</strong> {series.createdUser.username}\n        </Typography>\n        <Typography variant='caption' component='div'>{`${series.photoCount || 0} Photos`}</Typography>\n\n        {showCreatedOn && <div className={classes.dateContainer}>\n          <Typography variant='caption' className={classes.dateLabel}>Created:</Typography>\n          <Typography variant='caption' className={classes.dateText}>{formatDate(series.createdOn, 'llll')}</Typography>\n        </div>}\n        {showLastPhoto && <div className={classes.dateContainer}>\n          <Typography variant='caption' className={classes.dateLabel}>Last Photo:</Typography>\n          <Typography variant='caption' className={classes.dateText}>{formatDate(series.latest.takenOn, 'llll')}</Typography>\n        </div>}\n      </ListItemText>\n      {/*  <TinyChip label='Watching' color='secondary' /> */}\n      {children}\n    </ListItem>\n  )\n}\n\nSeriesListItem.propTypes = {\n  series: PropTypes.object,\n  loading: PropTypes.bool,\n  showCreatedOn: PropTypes.bool,\n  showLastPhoto: PropTypes.bool,\n  onClick: PropTypes.func,\n  children: PropTypes.array\n}\n\nexport default SeriesListItem\n\nconst useCosmosStyles = makeStyles(theme => ({\n  root: {\n\n  }\n}))\n\nexport const SeriesListItemCosmos = (props) => {\n  // const classes = useCosmosStyles()\n  return (\n    <List disablePadding dense>\n      <SeriesListItem {...props} />\n    </List>\n  )\n}\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport List from '@material-ui/core/List'\n// import IconButton from '@material-ui/core/IconButton'\n// import ListItemSecondaryAction from '@material-ui/core/ListItemSecondaryAction'\nimport ZoomOutMapIcon from '@material-ui/icons/ZoomOutMap'\n// import CancelIcon from '@material-ui/icons/Cancel'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { ListItemIcon } from '@material-ui/core'\n\nconst style = theme => ({\n  root: {\n\n  }\n})\n\nconst useStyles = makeStyles(style)\n\nconst ClusterSelected = ({ seriesCount, reducedPhotoCount, onZoomTo, onClose }) => {\n  const classes = useStyles()\n  console.log('cluster selected', { seriesCount, reducedPhotoCount })\n  return (\n    <List>\n      <ListItem className={classes.root}>\n        <ListItemIcon onClick={onZoomTo}>\n          <ZoomOutMapIcon />\n        </ListItemIcon>\n        <ListItemText\n          onClick={onZoomTo}\n          primary={`${seriesCount} Photo series`}\n          secondary={`containing ${reducedPhotoCount} individual photo${reducedPhotoCount === 1 ? '' : 's'}`}\n        />\n        {/* <ListItemSecondaryAction>\n          <IconButton aria-label='Close' onClick={onClose}>\n            <CancelIcon />\n          </IconButton>\n        </ListItemSecondaryAction> */}\n\n      </ListItem>\n    </List>\n  )\n}\n\nClusterSelected.propTypes = {\n  seriesCount: PropTypes.number.isRequired,\n  reducedPhotoCount: PropTypes.number.isRequired,\n  onZoomTo: PropTypes.func.isRequired,\n  onClose: PropTypes.func.isRequired\n}\n\nexport default ClusterSelected\n","import React from 'react'\nimport classNames from 'classnames'\nimport PropTypes from 'prop-types'\nimport Typography from '@material-ui/core/Typography'\nimport Badge from '@material-ui/core/Badge'\nimport Avatar from '@material-ui/core/Avatar'\nimport Camera from '@material-ui/icons/Camera'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { ACCESS } from '../../../config'\n\nconst style = theme => ({\n  root: {\n    color: theme.palette.primary.main,\n    width: 150,\n    position: 'absolute',\n    top: '50%',\n    left: '50%',\n    textAlign: 'center',\n    transformOrigin: '50% 50%',\n    transform: 'translateY(-50%) translateX(-50%)'\n  },\n  rootActive: {\n    zIndex: 1000\n  },\n  icon: {\n    // height: 16,\n    // width: 16\n  },\n  avatar: {\n    position: 'relative',\n    margin: '0 auto',\n    background: 'green',\n    color: 'white',\n    border: '2px solid white',\n    height: 40,\n    width: 40,\n    zIndex: 120,\n    '&.PUBLIC': { background: ACCESS.PUBLIC.color },\n    '&.PRIVATE': { background: ACCESS.PRIVATE.color },\n    '&.OPEN': { background: ACCESS.OPEN.color }\n  },\n  avatarActive: {\n    background: '#FFFF00',\n    color: 'black',\n    border: `2px solid black`,\n    '&.PUBLIC': { background: '#FFFF00' },\n    '&.PRIVATE': { background: '#FFFF00' },\n    '&.OPEN': { background: '#FFFF00' }\n  },\n  badge: {\n    zIndex: 124,\n    color: theme.palette.secondary.contrastText,\n    background: theme.palette.secondary.main,\n    transform: 'scale(1) translate(30%, -30%)'\n  },\n  badgeActive: {\n    color: theme.palette.primary.contrastText,\n    background: theme.palette.primary.main\n  },\n  directionIndicator: {\n    position: 'absolute',\n    top: 20,\n    left: '50%',\n    // transformOrigin: '50% 50%',\n    // transform: 'translateY(-50%) translateX(-50%)',\n    zIndex: 100\n  },\n  name: {\n    color: 'white',\n    fontWeight: 'bold',\n    textShadow: `\n        0px 0px 4px #000000, \n        0px 0px 4px #000000 \n    `,\n    zIndex: 122,\n    position: 'relative'\n    // textStroke: '1px white'\n  },\n  nameActive: {\n    color: 'black',\n    textShadow: `\n    0px 0px 2px #FFFFFF, \n    0px 0px 2px #FFFFFF,\n    0px 0px 4px #FFFFFF \n`\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst Single = ({ name, access, onClick, active, photoCount, direction }) => {\n  const classes = useStyles()\n  return (\n    <div className={classNames(classes.root, active ? classes.rootActive : null, access)}>\n      <Badge classes={{ badge: classNames(classes.badge, active ? classes.badgeActive : null, access) }} badgeContent={photoCount}>\n        <Avatar className={classNames(classes.avatar, active ? classes.avatarActive : null, access)} onClick={onClick}>\n          <Camera className={classes.icon} color='inherit' />\n        </Avatar>\n      </Badge>\n      {direction && direction >= 0 ? (\n        <div className={classes.directionIndicator}>\n          <svg className={classes.svgArc}\n            version='1.1'\n            width='100'\n            height='100'\n            viewBox='0, 0, 100, 100'\n            style={{ transform: `translateY(-50%) translateX(-50%) rotateZ(${direction}deg)` }}>\n            <path d='M50,0 C60.946,0.151 72.136,3.514 80.675,10.56 L50,50 L19.325,10.56 C27.938,3.461 39,0.278 50,0 z'\n              fill='#009DC1'\n              fillOpacity='0.444'\n              strokeWidth='1'\n              strokeOpacity='0.6'\n              stroke='#FFFFFF'\n            />\n          </svg>\n        </div>\n      ) : null}\n      <Typography variant='body1' className={classNames(classes.name, active ? classes.nameActive : null)}>\n        {name}\n      </Typography>\n    </div>\n  )\n}\n\nSingle.propTypes = {\n  access: PropTypes.string,\n  name: PropTypes.string,\n  photoCount: PropTypes.number,\n  onClick: PropTypes.func.isRequired,\n  direction: PropTypes.number,\n  active: PropTypes.bool\n}\n\nexport default Single\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\nimport Avatar from '@material-ui/core/Avatar'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport numeral from 'numeral'\n\n\nconst style = theme => ({\n  avatar: {\n    background: theme.palette.primary.dark,\n    border: `2px solid ${theme.palette.primary.contrastText}`,\n    color: theme.palette.primary.contrastText\n  },\n  avatarActive: {\n    background: '#FFFF00',\n    border: `2px solid black`,\n    color: 'black',\n    zIndex: 1000\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst Cluster = ({ seriesCount, active, onClick }) => {\n  const classes = useStyles()\n  return (\n    <Avatar onClick={onClick} className={classNames(classes.avatar, active ? classes.avatarActive : null)}>\n      {numeral(seriesCount).format('0,0')}\n    </Avatar>\n  )\n}\n\nCluster.propTypes = {\n  seriesCount: PropTypes.number,\n  onClick: PropTypes.func.isRequired,\n  active: PropTypes.bool\n}\n\nexport default Cluster\n","\nimport React, { useState, useMemo, useRef, useEffect, useCallback } from 'react'\nimport PropTypes from 'prop-types'\nimport Paper from '@material-ui/core/Paper'\nimport { FlyToInterpolator, LinearInterpolator, Marker } from 'react-map-gl'\nimport { easeCubic } from 'd3-ease'\nimport MapStyles from '../../mapStyles'\n\nimport BaseMap from './BaseMap'\nimport useClusteredData from '../../lib/useClusteredData'\nimport { bbox, featureCollection, buffer, point } from '@turf/turf'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { debounce } from '../../lib/util'\nimport style from './HomeMap.style'\n\nimport TopBar from '../TopBar'\nimport SearchInput from '../Search/SearchInput'\nimport SeriesListItem from '../misc/SeriesListItem'\nimport ClusterSelected from '../misc/ClusterSelected'\n\nimport SingleMarker from './markers/Single'\nimport ClusterMarker from './markers/Cluster'\n\nconst useStyles = makeStyles(style)\n\nconst defaultView = {\n  zoom: 4,\n  latitude: 44.629701,\n  longitude: -120.333379\n}\n\nconst SIZESCALE = 80\n\nconst HomeMap = ({\n  seriesList, initViewport, loading, activeSeries, queryVersion,\n  setActiveSeries, onSeriesClick, onSearchClick,\n  popMapHistory, pushMapHistory, clearMapHistory\n}) => {\n  const [mapViewObj, setMapViewObj] = useState({\n    viewport: { ...defaultView, ...initViewport.viewport },\n    bounds: initViewport.bounds,\n    filterBounds: null\n  })\n  const classes = useStyles()\n  const mapViewRef = useRef()\n  const [isTransitioning, setIsTransitioning] = useState(false)\n  const homeMapContainerRef = useRef()\n\n  const [currentZoom, setCurrentZoom] = useState(0)\n  const [transitions, setTransitions] = useState(null)\n  const [selectedItem, setSelectedItem] = useState()\n\n  // This custom hook is heavily debounced\n  const { filteredClusteredData } = useClusteredData(\n    seriesList || [],\n    mapViewObj.filterBounds,\n    currentZoom,\n    mapViewObj.viewport,\n    SIZESCALE,\n    queryVersion\n  )\n\n  // If we're coming back to the map with something aleady selected then we need to\n  // reselect the series we had before\n  useEffect(() => {\n    if (!activeSeries || !seriesList || selectedItem) return\n    try {\n      const selected = seriesList.find(s => s.id === activeSeries)\n      // if (selected && homeMapContainerRef.current) setSelectedItem(selected)\n      if (selected && selected.coords) {\n        const bufferPts = buffer(point(selected.coords), 10, { units: 'meters' })\n        const bounds = bbox(bufferPts)\n        console.log('DEBUG', { bufferPts, bounds })\n        setMapViewObj({ ...mapViewObj, bounds })\n      }\n    }\n    catch (e) {\n      console.error(e)\n    }\n  }, [seriesList])\n  // Once we have the zoom in place we might need to select an initial series\n  useEffect(() => {\n    if (!activeSeries || !filteredClusteredData.single || selectedItem) return\n    try {\n      const selected = filteredClusteredData.single.find(s => s.properties.id === activeSeries)\n      if (selected && homeMapContainerRef.current) setSelectedItem(selected)\n    }\n    catch (e) {\n      console.error(e)\n    }\n  }, [filteredClusteredData.single])\n\n  const saveMap = useCallback(debounce(() => {\n    const { latitude, longitude, zoom, bearing, pitch, altitude } = mapViewRef.current ? mapViewRef.current : mapViewObj.viewport\n    setTimeout(() => pushMapHistory({\n      ...initViewport,\n      viewport: { latitude, longitude, zoom, bearing, pitch, altitude }\n    }), 2000)\n  }, 2000, true))\n\n  const updateSelectedItem = (item) => {\n    // regardless, set the map selected Item\n    setSelectedItem(item)\n    if (item && item.properties && item.properties.count === 1) {\n      setActiveSeries(item.properties.id)\n    }\n    saveMap()\n  }\n\n  const onZoomTo = (object) => {\n    try {\n      const pts = featureCollection(object.properties.points)\n      const bufferPts = buffer(pts, 1000, { units: 'meters' })\n      const bounds = bbox(bufferPts)\n      // buffer a further 10%\n      const lngBuff = (bounds[2] - bounds[0]) * 0.2\n      const latBuff = (bounds[3] - bounds[1]) * 0.2\n      const buffBounds = [\n        bounds[0] - lngBuff,\n        bounds[1] - latBuff,\n        bounds[2] + lngBuff,\n        bounds[3] + latBuff\n      ]\n\n      setTransitions({\n        transitionDuration: 2000,\n        transitionInterpolator: new FlyToInterpolator(),\n        transitionEasing: easeCubic\n      })\n      setMapViewObj({ ...mapViewObj, bounds: buffBounds })\n      if (object.properties.count > 1) setTimeout(() => updateSelectedItem(null), 2000)\n    }\n    catch (e) {\n      console.error(e)\n    }\n  }\n\n  const onViewportChange = ({ viewport, map }) => {\n    mapViewRef.current = viewport\n    // mapViewObj\n    // {\n    //   \"_sw\": {\n    //     \"lng\": -120.40788003760076,\n    //     \"lat\": 44.609051464438835\n    //   },\n    //   \"_ne\": {\n    //     \"lng\": -120.25887796240545,\n    //     \"lat\": 44.65034319161438\n    //   }\n    // minX, minY, maxX, maxY\n    // [W-122.87948116236043, S26.15346805640254, E-82.00799782432676, N47.3795453070757]\n    const viewZoom = Math.floor(viewport.zoom)\n    if (!isTransitioning && map && map.getBounds) {\n      // console.log('onViewportChange', isTransitioning)\n      const { _sw: { lng: minLng, lat: minLat }, _ne: { lng: maxLng, lat: maxLat } } = map.getBounds()\n      const [oldMinLng, oldMinLat, oldMaxLng, oldMaxLat] = mapViewObj.filterBounds || [minLng, minLat, maxLng, maxLat]\n      if (viewZoom !== currentZoom ||\n        oldMinLng >= minLng || oldMinLat >= minLat ||\n        oldMaxLng <= maxLng || oldMaxLat <= maxLat\n      ) {\n        // console.log('RECALCING filterBounds')\n        const filterBounds = [\n          minLng - (maxLng - minLng) / 2,\n          minLat - (maxLat - minLat) / 2,\n          maxLng + (maxLng - minLng) / 2,\n          maxLat + (maxLat - minLat) / 2\n        ]\n        setMapViewObj({ ...mapViewObj, filterBounds })\n      }\n    }\n    if (viewZoom !== currentZoom) {\n      setCurrentZoom(viewZoom)\n    }\n  }\n  // Debounce this to improve performance\n  // const onViewportChangeDebounced = useCallback(debounce(onViewportChange, 300), [])\n\n  const lock = {}\n\n  const onMarkerClick = (obj) => {\n    // Second click zooms\n    if (selectedItem && selectedItem.properties.id === obj.properties.id) {\n      // console.log('onMarkerClick SECOND CLICK')\n      onZoomTo(selectedItem)\n    }\n    else {\n      // console.log('onMarkerClick First click')\n      setTransitions({\n        transitionDuration: 500,\n        transitionInterpolator: new LinearInterpolator(),\n        transitionEasing: easeCubic\n      })\n      setMapViewObj({\n        viewport: {\n          longitude: obj.geometry.coordinates[0],\n          latitude: obj.geometry.coordinates[1]\n        }\n      })\n    }\n    updateSelectedItem(obj)\n  }\n\n  // This one should be debounced by filteredClusteredData\n  const markersRendered = useMemo(() => ([\n    ...filteredClusteredData.single.map(obj => (\n      <Marker\n        className={'singleMarker'}\n        key={`single-${obj.properties.id}`}\n        latitude={obj.geometry.coordinates[1]}\n        longitude={obj.geometry.coordinates[0]}\n        offsetLeft={0}\n        offsetTop={-20}\n      >\n        <SingleMarker name={obj.properties.name}\n          access={obj.properties.access}\n          photoCount={obj.properties.photoCount}\n          onClick={() => onMarkerClick(obj)}\n          direction={currentZoom > 10 && obj.properties.direction ? obj.properties.direction : null}\n          active={selectedItem && selectedItem.properties.id === obj.properties.id}\n        />\n      </Marker>\n    )),\n    ...filteredClusteredData.cluster.map(obj => (\n      <Marker\n        className='clusterMarker'\n        key={`cluster-${obj.properties.id}`}\n        latitude={obj.geometry.coordinates[1]}\n        longitude={obj.geometry.coordinates[0]}\n        offsetLeft={-20}\n        offsetTop={-20}\n      >\n        <ClusterMarker\n          seriesCount={obj.properties.count}\n          photoCount={obj.properties.reducedPhotoCount}\n          onClick={() => onMarkerClick(obj)}\n          active={\n            selectedItem &&\n            selectedItem.properties.id === obj.properties.id &&\n            selectedItem.properties.count === obj.properties.count\n          }\n        />\n      </Marker>\n    ))\n  ]), [filteredClusteredData, selectedItem])\n\n  const selectedItemRender = useMemo(() => !!selectedItem && (\n    <Paper className={classes.selectedPopup}>\n      {selectedItem.properties.count === 1\n        ? <SeriesListItem\n          loading={loading.selectedSeries}\n          series={selectedItem.properties}\n          onClick={() => onSeriesClick(selectedItem.properties.id)}\n        />\n        : <ClusterSelected\n          seriesCount={selectedItem.properties.count}\n          reducedPhotoCount={selectedItem.properties.reducedPhotoCount}\n          onClose={() => updateSelectedItem(null)}\n          onZoomTo={() => onZoomTo(selectedItem)}\n        />\n      }\n    </Paper>\n  ), [selectedItem])\n\n  return (\n    <div className={classes.root} ref={homeMapContainerRef}>\n      <TopBar isTransparent className={classes.topBar}>\n        <SearchInput\n          onClick={onSearchClick}\n          defaultValue={''}\n        />\n      </TopBar>\n      <BaseMap\n        showMe\n        // This should only change on INIT or transition events\n        viewport={mapViewObj.viewport}\n        transitions={transitions}\n        mapStyles={MapStyles}\n        controlPadding={{ top: 56 }}\n        initStyle={MapStyles.length > 1 ? 1 : 0}\n        {...lock}\n        onTransitionStart={() => {\n          // console.log('handletransitionStart')\n          setIsTransitioning(true)\n        }}\n        onTransitionEnd={() => {\n          // console.log('handletransitionEnd')\n          setIsTransitioning(false)\n          setTransitions(null)\n        }}\n        bounds={mapViewObj.bounds}\n        maxZoom={20}\n        minZoom={1}\n        onViewportChange={onViewportChange}\n        onNativeClick={() => {\n          if (selectedItem) updateSelectedItem(null)\n        }}\n      >\n        {markersRendered}\n      </BaseMap>\n\n      {selectedItemRender}\n    </div>\n  )\n}\n\nHomeMap.propTypes = {\n  seriesList: PropTypes.array,\n  queryVersion: PropTypes.number,\n  activeSeries: PropTypes.string,\n  initViewport: PropTypes.object,\n  loading: PropTypes.object,\n  // These all get loaded up through mapFuncs in HomeMap.connect\n  onSearchClick: PropTypes.func,\n  setActiveSeries: PropTypes.func,\n  onSeriesClick: PropTypes.func,\n  popMapHistory: PropTypes.func,\n  pushMapHistory: PropTypes.func,\n  clearMapHistory: PropTypes.func\n}\n\nexport default HomeMap\n\nfunction getInitialState (initViewport) {\n  return {\n    viewport: { ...defaultView, ...initViewport.viewport },\n    bounds: initViewport.bounds,\n    filterBounds: null\n  }\n}\n","import React, { useEffect, useState, useRef, useMemo } from 'react'\nimport PropTypes from 'prop-types'\nimport { connect } from 'react-redux'\nimport { graphql } from 'react-apollo'\nimport { allSeries, pollQuery } from './queries'\nimport actions from '../redux/actions'\nimport { home } from '../config'\nimport HomeMap from '../components/maps/HomeMap'\n\nconst POLL_INTERVAL = 5 // (seconds)\n\n/**\n * The outer component handles the lastCheck variable which, when changed will\n * cause the poll event\n */\nconst HomeMapConnector = ({ initViewport, activeSeries, mapFuncs }) => {\n  const [seriesProps, setSeriesProps] = useState()\n  const [queryVersion, setVersion] = useState(0)\n  const updateIncrement = () => setVersion(queryVersion + 1)\n  const timerRef = useRef()\n  const [lastCheck, setLastCheck] = useState(null)\n  timerRef.current = lastCheck\n\n  // These are expensive queries so we render them memoized to prevent erroneous re-renders\n  const allSeriesQUERY = useMemo(() => <AllSeriesConnect setSeriesProps={setSeriesProps} />, [])\n  const pollSeriesQUERY = useMemo(() => <PollQueryConnect lastCheck={lastCheck} seriesProps={seriesProps} updateIncrement={updateIncrement} />, [lastCheck])\n\n  // Initiate the polling process. We simply update the timestamp every N seconds\n  useEffect(() => {\n    if (!seriesProps) return\n    function ping () {\n      if (timerRef.current) setLastCheck(String(Date.now() - POLL_INTERVAL * 1000))\n    }\n    if (!timerRef.current && seriesProps.readyForPolling) timerRef.current = setInterval(ping, POLL_INTERVAL * 1000)\n    return () => {\n      if (timerRef.current) {\n        console.log('clear poll timer')\n        clearInterval(timerRef.current)\n        timerRef.current = null\n      }\n    }\n  }, [seriesProps])\n\n  return (\n    <React.Fragment>\n      {allSeriesQUERY}\n      {pollSeriesQUERY}\n      <HomeMap\n        queryVersion={queryVersion}\n        seriesList={seriesProps && seriesProps.allSeries ? seriesProps.allSeries.seriesSummaries : []}\n        activeSeries={activeSeries}\n        initViewport={initViewport}\n        loading={{\n        }}\n        {...mapFuncs}\n      />\n    </React.Fragment>\n  )\n}\nHomeMapConnector.propTypes = {\n  activeSeries: PropTypes.string, // from redux\n  initViewport: PropTypes.object, // from redux\n  mapFuncs: PropTypes.object // from redux passed straight through to the map\n\n}\n\nconst withAllSeries = graphql(allSeries, {\n  props: ({ data, ownProps }) => {\n    // If there's more data to load we should go get another batch\n    if (!data.loading && !data.error && data.allSeries && data.allSeries.seriesSummaries.length > 0 && data.allSeries.nextToken) {\n      data.fetchMore({\n        variables: { ...data.variables, nextToken: data.allSeries.nextToken },\n        // How do we mush the new query with the old one\n        updateQuery: (prev, { fetchMoreResult }) => {\n          return {\n            allSeries: {\n              ...fetchMoreResult.allSeries,\n              seriesSummaries: [ ...prev.allSeries.seriesSummaries, ...fetchMoreResult.allSeries.seriesSummaries ]\n            }\n          }\n        }\n      })\n    }\n    else if (data.loading || data.error) {\n      ownProps.setSeriesProps(data)\n    }\n    else {\n      ownProps.setSeriesProps({ ...data, readyForPolling: true })\n    }\n    return null\n  },\n  options: {\n    variables: { limit: 100 }\n  }\n})\n\n/**\n * Here's the graphql HOC that gets an individual series\n */\nconst withPollQuery = graphql(pollQuery, {\n  skip: ({ lastCheck }) => !lastCheck,\n  props: ({ data, ownProps: { seriesProps, updateIncrement } }) => {\n    if (data.error) {\n      console.log('POLL FAIL', data.error, data)\n      console.error(data.error)\n    }\n    if (!data.loading && data.changedSeries && data.changedSeries.seriesSummaries) {\n      // console.log('POLLING', { data, seriesProps })\n      const newData = data.changedSeries.seriesSummaries\n      const oldList = seriesProps.allSeries.seriesSummaries\n\n      // If the polling has begun and we have some good polling data back then\n      // Process it and decide if we need to incorporate it\n      if (data.changedSeries) {\n        let newSeriesSummaries = seriesProps.allSeries.seriesSummaries\n        newData.forEach(({ seriesStatus, ...polledSeries }) => {\n          if (seriesStatus === 'deleted') {\n            console.log('Polling found a series to delete: ', polledSeries.id)\n            newSeriesSummaries = oldList.filter(s => s.id !== polledSeries.id)\n          }\n          else {\n            const idx = oldList.findIndex(ds => ds.id === polledSeries.id)\n            if (idx >= 0) {\n              console.log('Polling found a series to Update: ', polledSeries.id)\n              newSeriesSummaries = oldList.map((oldSeries, oldId) => oldId === idx ? polledSeries : oldSeries)\n            }\n            else {\n              console.log('Polling found a series to add: ', polledSeries.id)\n              newSeriesSummaries = [...oldList, polledSeries]\n            }\n          }\n          seriesProps.updateQuery((data, options) => {\n            try {\n              const newData = { ...data }\n              newData.allSeries.seriesSummaries = newSeriesSummaries\n              updateIncrement()\n              return data\n            }\n            catch (e) {\n              console.error(e)\n              return data\n            }\n          })\n        })\n      }\n    }\n    return null\n  },\n  options: ({ lastCheck }) => ({\n    variables: {\n      limit: 100,\n      lastCheck\n    }\n  })\n})\n\n// We're using graphql() HOC because it's convenient but it doesn't need to render anything\nconst AllSeriesConnect = withAllSeries(() => null)\nconst PollQueryConnect = withPollQuery(() => null)\n\n// The only part of the state the main view caes about is teh window\nconst mapStateToProps = (state, props) => {\n  const { current: { activeSeries } } = state.home\n  const initViewport = state.map.slice(-1).pop()\n  return { activeSeries, initViewport }\n}\n\n// There are a few presentational actions the main window can use\nconst mapDispatchToProps = dispatch => ({\n  mapFuncs: {\n    setActiveSeries: (seriesId) => {\n      dispatch(actions.setActiveSeries(seriesId))\n    },\n    onSeriesClick: () => {\n      dispatch(actions.setHomeState(home.AppStateTypes.SERIES))\n    },\n    onSearchClick: () => {\n      dispatch(actions.setHomeState(home.AppStateTypes.SEARCH, { search: { tab: home.SEARCH_TABS.LOCATION, text: '' } }))\n    },\n    popMapHistory: () => {\n      dispatch(actions.popMapHistory())\n    },\n    pushMapHistory: (viewportSave) => {\n      dispatch(actions.pushMapHistory(viewportSave))\n    },\n    clearMapHistory: () => {\n      dispatch(actions.clearMapHistory())\n    }\n  }\n})\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(HomeMapConnector)\n","import React from 'react'\nimport classNames from 'classnames'\nimport PropTypes from 'prop-types'\nimport List from '@material-ui/core/List'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemAvatar from '@material-ui/core/ListItemAvatar'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\nimport IconButton from '@material-ui/core/IconButton'\nimport Avatar from '@material-ui/core/Avatar'\n\nimport PlaceIcon from '@material-ui/icons/Place'\nimport PersonIcon from '@material-ui/icons/Person'\nimport LabelIcon from '@material-ui/icons/Label'\nimport CancelIcon from '@material-ui/icons/Cancel'\n\nimport { makeStyles } from '@material-ui/core/styles'\nconst useStyles = makeStyles(theme => ({\n  root: {\n\n  },\n  chosenItem: {\n    background: theme.palette.grey[300]\n  },\n  avatar: {\n\n  },\n  avatarImg: {\n    height: '100%',\n    width: '100%',\n    objectFit: 'cover'\n  }\n}))\n\nconst SearchContextItem = ({ variant, name, description, gravatar, onClick, onCancel }) => {\n  const classes = useStyles()\n  let TheIcon = PlaceIcon\n\n  const getAvatar = (src) => () => (\n    <Avatar className={classes.avatar}>\n      <img className={classes.avatarImg} alt='profile' src={src} />\n    </Avatar>\n  )\n\n  switch (variant) {\n    case 'tag':\n      TheIcon = LabelIcon\n      break\n    case 'location':\n      TheIcon = PlaceIcon\n      break\n    case 'user':\n      TheIcon = gravatar ? getAvatar(gravatar) : PersonIcon\n      break\n    default:\n      break\n  }\n  return (\n    <ListItem\n      className={classNames(classes.root, onCancel ? classes.chosenItem : null)}\n      elevation={1}\n      button={!!onClick}\n      onClick={onClick}\n    >\n      <ListItemAvatar>\n        <Avatar>\n          <TheIcon />\n        </Avatar>\n      </ListItemAvatar>\n      <ListItemText primary={name} secondary={description} />\n      {onCancel && (\n        <ListItemIcon>\n          <IconButton onClick={onCancel}>\n            <CancelIcon />\n          </IconButton>\n        </ListItemIcon>\n      )}\n    </ListItem>\n  )\n}\n\nSearchContextItem.propTypes = {\n  variant: PropTypes.oneOf(['tag', 'location', 'user']),\n  onClick: PropTypes.func,\n  gravatar: PropTypes.string,\n  name: PropTypes.string.isRequired,\n  description: PropTypes.string,\n  onCancel: PropTypes.func\n}\n\nexport default SearchContextItem\n\nexport const SearchContexItemCosmos = () => {\n  return (\n    <List>\n      <SearchContextItem variant='tag' name='SomeTag' description='Some description of what I am' />\n      <SearchContextItem variant='location' name='Some Location' description='Some description of what I am' />\n      <SearchContextItem variant='user' name='User McUserSon' description='Some description of what I am' />\n    </List>\n  )\n}\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport List from '@material-ui/core/List'\nimport Typography from '@material-ui/core/Typography'\n\nimport SearchContextItem from './SearchContextItem'\n// import MenuIcon from '@material-ui/icons/Menu'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    width: '100%',\n    backgroundColor: theme.palette.background.paper,\n    position: 'relative',\n    overflow: 'auto'\n  },\n  listSection: {\n    backgroundColor: 'inherit'\n  },\n  placeholderText: {\n    textAlign: 'center',\n    padding: theme.spacing(3, 1),\n    color: theme.palette.grey[400]\n  },\n  ul: {\n    backgroundColor: 'inherit',\n    padding: 0\n  }\n}))\n\nconst SearchContextResults = ({ variant, loading, contextResults, setContextChoice }) => {\n  const classes = useStyles()\n  if (loading) {\n    return <Typography className={classes.placeholderText} variant='h3'>Searching...</Typography>\n  }\n  else if (!contextResults || contextResults.length === 0) {\n    return <Typography className={classes.placeholderText} variant='h4'>No {variant} results</Typography>\n  }\n\n  return (\n    <List className={classes.root}>\n      {contextResults.map((cr, idx) => (\n        <SearchContextItem\n          key={`scr-${idx}`}\n          variant={variant}\n          onClick={() => setContextChoice(cr)}\n          {...cr}\n        />\n      ))}\n    </List>\n  )\n}\n\nSearchContextResults.propTypes = {\n  variant: PropTypes.oneOf(['tag', 'location', 'user']),\n  loading: PropTypes.bool,\n  contextResults: PropTypes.array.isRequired,\n  setContextChoice: PropTypes.func.isRequired\n}\n\nexport default SearchContextResults\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport List from '@material-ui/core/List'\nimport Typography from '@material-ui/core/Typography'\n\nimport SearchContextItem from './SearchContextItem'\n// import MenuIcon from '@material-ui/icons/Menu'\nimport { makeStyles } from '@material-ui/core/styles'\nimport SeriesListItem from '../misc/SeriesListItem'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    height: '100%'\n  },\n  list: {\n    width: '100%',\n    height: '100%',\n    backgroundColor: theme.palette.background.paper,\n    position: 'relative',\n    overflowX: 'hidden',\n    overflowY: 'scroll'\n  },\n  placeholderText: {\n    textAlign: 'center',\n    padding: theme.spacing(3, 1),\n    color: theme.palette.grey[400]\n  },\n  listSection: {\n    backgroundColor: 'inherit'\n  },\n  ul: {\n    backgroundColor: 'inherit',\n    padding: 0\n  }\n}))\n\nconst SearchResults = ({ variant, loading, seriesList, contextChoice, onCancel, onResultClick }) => {\n  const classes = useStyles()\n\n  let content = null\n  if (loading) {\n    content = (\n      <Typography className={classes.placeholderText} variant='h3'>Searching...</Typography>\n    )\n  }\n  else if (seriesList && seriesList.length > 0) {\n    content = seriesList.map((series, idx) => (\n      <SeriesListItem\n        key={`series-${idx}`}\n        series={series}\n        onClick={() => onResultClick(series.id)}\n        showCreatedOn\n        showLastPhoto\n      />\n    ))\n  }\n  else {\n    content = (\n      <Typography className={classes.placeholderText} variant='h4'>No series found</Typography>\n    )\n  }\n\n  return (\n    <div className={classes.root}>\n      <SearchContextItem {...contextChoice} variant={variant} onCancel={onCancel} />\n      <List className={classes.list} subheader={<li />}>\n        {content}\n      </List>\n    </div>\n  )\n}\n\nSearchResults.propTypes = {\n  variant: PropTypes.oneOf(['tag', 'location', 'user']),\n  seriesList: PropTypes.array.isRequired,\n  loading: PropTypes.bool,\n  contextChoice: PropTypes.object.isRequired,\n  onResultClick: PropTypes.func.isRequired,\n  onCancel: PropTypes.func.isRequired\n}\n\nexport default SearchResults\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport Typography from '@material-ui/core/Typography'\n// import MenuIcon from '@material-ui/icons/Menu'\nimport { makeStyles } from '@material-ui/core/styles'\nconst useStyles = makeStyles(theme => ({\n  root: {\n    flexGrow: 1,\n    padding: '10%',\n    display: 'flex',\n    flexDirection: 'column',\n    opacity: 0.3,\n    textAlign: 'center'\n  },\n  icon: {\n    width: '100%',\n    flex: '1 1 40%',\n    color: theme.palette.primary.light,\n    opacity: 0.5\n  },\n  primary: {\n    flex: '1 1 30%',\n    width: '100%'\n  },\n  secondary: {\n    flex: '1 1 30%',\n    width: '100%'\n  }\n}))\n\nconst SearchPlaceholder = ({ icon, primary, secondary }) => {\n  const classes = useStyles()\n  const PlaceholderIcon = icon\n  return (\n    <div className={classes.root}>\n      <PlaceholderIcon className={classes.icon} />\n      {primary && (\n        <Typography className={classes.primary} variant='h3'>\n          {primary}\n        </Typography>\n      )}\n      {secondary && (\n        <Typography className={classes.secondary} variant='h4'>\n          {secondary}\n        </Typography>\n      )}\n    </div>\n  )\n}\n\nSearchPlaceholder.propTypes = {\n  icon: PropTypes.object,\n  primary: PropTypes.string,\n  secondary: PropTypes.string\n}\n\nexport default SearchPlaceholder\n","import { useEffect, useState } from 'react'\n\nconst useOnline = () => {\n  const [state, setState] = useState(null)\n\n  const setOnline = () => {\n    console.log('ONLINE')\n    setState(null)\n  }\n  const setOffline = () => {\n    console.log('OFFLINE')\n    const newDate = Date.now()\n    setState(newDate)\n  }\n\n  useEffect(() => {\n    window.addEventListener('online', setOnline)\n    window.addEventListener('offline', setOffline)\n\n    return () => {\n      window.removeEventListener('online', setOnline)\n      window.removeEventListener('offline', setOffline)\n    }\n  }, [])\n\n  return {\n    online: state === null,\n    since: state\n  }\n}\n\nexport default useOnline\n","import React, { useEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport Typography from '@material-ui/core/Typography'\nimport Tabs from '@material-ui/core/Tabs'\nimport Tab from '@material-ui/core/Tab'\n\nimport SearchContextResults from './SearchContextResults'\nimport SearchResults from './SearchResults'\nimport SearchPlaceholder from './SearchPlaceholder'\nimport TopBar from '../TopBar'\nimport SearchInput from './SearchInput'\nimport useOnline from '../../lib/useOnline'\nimport { home } from '../../config'\nimport PortableWifiOffIcon from '@material-ui/icons/PortableWifiOff'\nimport LabelIcon from '@material-ui/icons/Label'\nimport PlaceIcon from '@material-ui/icons/Place'\nimport PersonIcon from '@material-ui/icons/Person'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst TABS = home.SEARCH_TABS\n\nconst style = theme => ({\n  root: {\n    height: '100%',\n    display: 'flex',\n    overflow: 'hidden',\n    flexDirection: 'column'\n  },\n  tabs: {\n  },\n  tab: {\n    flexGrow: 1\n  },\n  grow: {\n    flexGrow: 1\n  }\n})\n\nconst useStyles = makeStyles(style)\n\nconst Search = ({\n  onMenuBack, currentTab, setCurrentTab, defaultText, searchText,\n  setSearchText, contextResults, searchResults, contextChoice,\n  loading, setContextChoice, onMapClick, onResultClick\n}) => {\n  const classes = useStyles()\n\n  const { online } = useOnline()\n\n  // If there's only one thing then use it\n  useEffect(() => {\n    if (contextResults && !searchResults && contextResults.length === 1) {\n      setContextChoice(contextResults[0])\n    }\n  }, [contextResults])\n\n  // TODO: How to get from search results back to context results?\n  let placeholder = {}\n  switch (currentTab) {\n    case TABS.TAG:\n      placeholder = { primary: 'Tag search', secondary: 'example: \\'beaver...\\'', icon: LabelIcon }\n      break\n    case TABS.USER:\n      placeholder = { primary: 'User search', secondary: 'example: \\'SuperGreg123...\\'', icon: PersonIcon }\n      break\n    case TABS.LOCATION:\n      placeholder = { primary: 'Location Search', secondary: 'example: \\'Vancouver...\\'', icon: PlaceIcon }\n      break\n\n    default:\n      break\n  }\n\n  let content = null\n  if (!online) {\n    content = (\n      <SearchPlaceholder\n        primary='Search Disabled'\n        secondary='(Offline)'\n        icon={PortableWifiOffIcon}\n      />\n    )\n  }\n  else if (contextChoice && searchResults) {\n    content = (\n      <SearchResults\n        variant={currentTab}\n        loading={loading}\n        onResultClick={onResultClick}\n        seriesList={searchResults}\n        contextChoice={contextChoice}\n        onCancel={() => setContextChoice(null)}\n      />\n    )\n  }\n  else if (contextResults) {\n    content = (\n      <SearchContextResults\n        loading={loading}\n        variant={currentTab}\n        contextResults={contextResults}\n        setContextChoice={currentTab === TABS.LOCATION ? onMapClick : setContextChoice}\n      />\n    )\n  }\n  else if (defaultText.length > 0) {\n    content = (\n      <Typography>Searching for {`'${searchText}'` || '...'}</Typography>\n    )\n  }\n  else {\n    content = <SearchPlaceholder {...placeholder} />\n  }\n\n  return (\n    <div className={classes.root}>\n      <TopBar>\n        <SearchInput\n          disabled={!online}\n          autoFocus\n          onChange={setSearchText}\n          defaultValue={searchText}\n        />\n      </TopBar>\n      {online && (\n        <Tabs\n          value={currentTab}\n          disabled={!online}\n          onChange={(e, val) => setCurrentTab(val)}\n          indicatorColor='primary'\n          textColor='primary'\n          classes={{ flexContainer: classes.tabs }}\n          centered\n        >\n          <Tab className={classes.tab} value={TABS.TAG} label='Tags' />\n          <Tab className={classes.tab} value={TABS.LOCATION} label='Places' />\n          <Tab className={classes.tab} value={TABS.USER} label='Users' />\n        </Tabs>\n      )}\n      {content}\n    </div>\n  )\n}\n\nSearch.propTypes = {\n  onMenuBack: PropTypes.func.isRequired,\n  loading: PropTypes.bool,\n  currentTab: PropTypes.string.isRequired,\n  setCurrentTab: PropTypes.func.isRequired,\n  searchText: PropTypes.string.isRequired,\n  setSearchText: PropTypes.func.isRequired,\n  contextResults: PropTypes.array,\n  searchResults: PropTypes.array,\n  contextChoice: PropTypes.object,\n  setContextChoice: PropTypes.func.isRequired,\n  onMapClick: PropTypes.func.isRequired,\n  onResultClick: PropTypes.func.isRequired\n}\nSearch.defaultProps = {\n  currentTab: TABS.TAGS,\n  defaultText: ''\n}\n\nexport default Search\n","import React, { useCallback, useState, useEffect, useRef } from 'react'\nimport PropTypes from 'prop-types'\nimport { home } from '../config'\n// import { smallestHash } from 'geotilehash'\nimport { graphql, compose } from 'react-apollo'\nimport { point, bbox as bboxFunc, buffer } from '@turf/turf'\n\nimport { connect } from 'react-redux'\nimport actions from '../redux/actions'\nimport { tagSearch, seriesWithTag, userSearch, userSeries, geocode, geoSeries } from './queries'\nimport Search from '../components/Search/Search'\n// import { AppContext } from '../contexts'\nimport { debounce } from '../lib/util'\nimport { formatDatAgo } from '../lib/datelib'\n\nconst SearchConnect = ({\n  jumpToMap, jumpToSeries, defaultTab, defaultText\n}) => {\n  // const { role, user } = useContext(AppContext)\n\n  const [currentTab, setCurrentTab] = useState(defaultTab || home.SEARCH_TABS.TAG)\n  // We separate these because one of them needs to be immediate and the\n  const [searchText, setSearchText] = useState(defaultText || '')\n  const [contextChoice, setContextChoice] = useState(null)\n\n  const handleTabChange = (newTab) => {\n    setContextChoice(null)\n    setCurrentTab(newTab)\n  }\n  const handleContextChoiceChange = (newContextChoice) => {\n    setContextChoice(newContextChoice)\n  }\n  const handleSearchTextChange = (text) => {\n    setSearchText(text)\n    setContextChoice(null)\n  }\n\n  let withContextQuery = null\n  let withSearchQuery = null\n\n  switch (currentTab) {\n    case home.SEARCH_TABS.TAG:\n      withContextQuery = withTagSearch\n      withSearchQuery = withTagSeries\n      break\n    case home.SEARCH_TABS.LOCATION:\n      withContextQuery = withGeoSearch\n      withSearchQuery = withGeoCode\n      break\n    case home.SEARCH_TABS.USER:\n      withContextQuery = withUserSearch\n      withSearchQuery = withUserSeries\n      break\n    default:\n      break\n  }\n\n  // TODO: We're going to need a debounce so we're not constantly hitting the server as we type.\n  // TODO: If there's no result then more typing won't return more.\n\n  const ComposedSearch = compose(\n    withContextQuery,\n    withSearchQuery\n  )(Search)\n\n  return <ComposedSearch {...{ currentTab, searchText, contextChoice }}\n    onMenuBack={() => {}}\n    onMapClick={jumpToMap}\n    onResultClick={jumpToSeries}\n    setContextChoice={handleContextChoiceChange}\n    setCurrentTab={handleTabChange}\n    setSearchText={handleSearchTextChange}\n  />\n}\nSearchConnect.propTypes = {\n  searchResults: PropTypes.array,\n  contextResults: PropTypes.array,\n  loading: PropTypes.bool,\n  jumpToMap: PropTypes.func,\n  jumpToSeries: PropTypes.func\n}\n/*****************************************************************\n *  PART 1: SEARCH QUERIES\n *****************************************************************/\n\n/**\n * Here's the graphql HOC that gets an individual series\n */\nconst withTagSearch = graphql(tagSearch, {\n  props: ({ data }) => {\n    if (data.error) console.error(data.error)\n    // console.log('withTagSearch', data)\n    let series = null\n    try {\n      if (!data.loading && !data.error) series = data.series\n    }\n    catch (e) {\n      console.error(data)\n      console.error(e)\n    }\n    const contextResults = data.tags ? data.tags.map(({ name, count }) => ({\n      name, description: `~ ${Math.ceil(count / 10) * 10} Photo series tagged`\n    })) : []\n\n    return {\n      contextResults,\n      loading: data.loading,\n      series\n    }\n  },\n  // skip: ({ searchText }) => !searchText || searchText.length < 3,\n  options: ({ searchText }) => ({\n    variables: {\n      tag: !searchText || searchText.length < 3 ? '' : searchText,\n      limit: 10\n    }\n  })\n})\n\nconst withUserSearch = graphql(userSearch, {\n  props: ({ data }) => {\n    if (data.error) console.error(data.error)\n    // console.log('withUserSearch', data)\n    let series = null\n    try {\n      if (!data.loading && !data.error) series = data.series\n    }\n    catch (e) {\n      console.error(data)\n      console.error(e)\n    }\n\n    const contextResults = data.userSearch ? data.userSearch.map(({ username, gravatar, createdOn, id }) => ({\n      name: username,\n      id,\n      description: `Joined ${formatDatAgo(createdOn)}`,\n      gravatar\n    })) : []\n\n    return {\n      contextResults,\n      loading: data.loading,\n      series\n    }\n  },\n  skip: ({ searchText }) => !searchText || searchText.length < 3,\n  options: ({ searchText }) => ({\n    variables: {\n      searchStr: searchText,\n      limit: 10\n    }\n  })\n})\n\nconst withGeoCode = graphql(geocode, {\n  props: ({ data }) => {\n    if (data.error) console.error(data.error)\n    // console.log('withGeoCode', data)\n    let series = null\n    try {\n      if (!data.loading && !data.error) series = data.series\n    }\n    catch (e) {\n      console.error(data)\n      console.error(e)\n    }\n\n    const contextResults = data.geocoder ? data.geocoder.map(({ relevance, text, placeName, bbox, center }) => ({\n      name: text,\n      description: placeName,\n      bbox,\n      center,\n      relevance\n    })) : []\n\n    return {\n      contextResults,\n      loading: data.loading,\n      series\n    }\n  },\n  skip: ({ searchText }) => !searchText || searchText.length < 3,\n  options: ({ searchText }) => ({\n    variables: {\n      search: searchText\n      // limit: 10\n    }\n  })\n})\n\n/*****************************************************************\n * PART 2: SERIES SEARCH QUERIES\n *****************************************************************/\n\nconst withTagSeries = graphql(seriesWithTag, {\n  props: ({ data }) => {\n    if (data.error) console.error(data.error)\n    // console.log('withTagSeries', data)\n    let series = null\n    try {\n      if (!data.loading && !data.error) series = data.series\n    }\n    catch (e) {\n      console.error(data)\n      console.error(e)\n    }\n\n    const searchResults = data.tagSeries && data.tagSeries.seriesSummaries\n      ? data.tagSeries.seriesSummaries\n      : []\n\n    return {\n      searchResults,\n      loading: data.loading,\n      series\n    }\n  },\n  skip: ({ contextChoice }) => !contextChoice,\n  options: ({ contextChoice }) => ({\n    variables: {\n      tag: contextChoice.name,\n      limit: 10\n    }\n  })\n})\n\nconst withUserSeries = graphql(userSeries, {\n  props: ({ data }) => {\n    if (data.error) console.error(data.error)\n    // console.log('withUserSeries', data)\n    let series = null\n    try {\n      if (!data.loading && !data.error) series = data.series\n    }\n    catch (e) {\n      console.error(data)\n      console.error(e)\n    }\n\n    const searchResults = data.userSeries && data.userSeries.seriesSummaries\n      ? data.userSeries.seriesSummaries\n      : []\n\n    return {\n      searchResults,\n      loading: data.loading,\n      series\n    }\n  },\n  skip: ({ contextChoice }) => !contextChoice,\n  options: ({ contextChoice }) => ({\n    variables: {\n      createdBy: contextChoice.id\n      // limit: 10\n    }\n  })\n})\n\nconst withGeoSearch = graphql(geoSeries, {\n  props: ({ data }) => {\n    if (data.error) console.error(data.error)\n    // console.log('HERE', data)\n    let series = null\n    try {\n      if (!data.loading && !data.error) series = data.series\n    }\n    catch (e) {\n      console.error(data)\n      console.error(e)\n    }\n    return {\n      data,\n      loading: data.loading,\n      series\n    }\n  },\n  skip: ({ contextChoice }) => !contextChoice,\n  options: ({ contextChoice }) => ({\n    variables: {\n      bounds: contextChoice.bbox\n      // limit: 10\n      // nextToken\n    }\n  })\n})\n\n/**\n * Map our redux state and functions\n */\nconst mapStateToProps = (state, props) => {\n  const { current: { search, activeSeries, domain } } = state.home\n  return {\n    defaultTab: search ? search.tab : null,\n    defaultText: search ? search.text : null,\n    activeSeries,\n    domain\n  }\n}\n\nconst mapDispatchToProps = dispatch => ({\n  onBack: () => {\n    dispatch(actions.homeStateBack())\n  },\n  queueUpload: (uploadObj) => {\n    dispatch(actions.queueUpload(uploadObj))\n  },\n  jumpToSeries: (seriesId) => {\n    dispatch(actions.setHomeState(home.AppStateTypes.SERIES, { activeSeries: seriesId }))\n  },\n\n  jumpToMap: ({ bbox, center }) => {\n    let bounds = bbox\n    if (!bounds && center) {\n      const bufferPts = buffer(point(center), 500, { units: 'meters' })\n      bounds = bboxFunc(bufferPts)\n    }\n\n    if (bounds) {\n      dispatch(actions.pushMapHistory({\n        mode: home.MapModeTypes.FREE,\n        bounds: bounds\n      }))\n      dispatch(actions.setHomeState(home.AppStateTypes.MAP, { activeSeries: null, initialPhoto: null }))\n    }\n  }\n})\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(SearchConnect)\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemText from '@material-ui/core/ListItemText'\n// import MenuIcon from '@material-ui/icons/Menu'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { formatDate } from '../../lib/datelib'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n\n  },\n  gravatarImg: {\n    display: 'block',\n    marginRight: theme.spacing(2),\n    width: '100%',\n    maxWidth: '25%',\n    height: 'auto'\n  }\n}))\n\nconst MeCard = ({ user, loading, onAvatarClick }) => {\n  const classes = useStyles()\n\n  if (loading || !user) return 'LOADING...'\n  console.log('USER', user)\n\n  return (\n    <ListItem className={classes.root} onClick={onAvatarClick} disableGutters>\n      <img alt='profile' className={classes.gravatarImg} src={user.gravatar} />\n      <ListItemText\n        primary={user.username}\n        secondary={`Since ${formatDate(user.createdOn)}`}\n      />\n    </ListItem>\n  )\n}\n\nMeCard.propTypes = {\n  user: PropTypes.object,\n  loading: PropTypes.bool,\n  onAvatarClick: PropTypes.func.isRequired\n}\n\nexport default MeCard\n","import React, { useState } from 'react'\nimport PropTypes from 'prop-types'\nimport Typography from '@material-ui/core/Typography'\nimport Divider from '@material-ui/core/Divider'\n\nimport SeriesListItem from '../misc/SeriesListItem'\nimport { makeStyles } from '@material-ui/core/styles'\nimport TopBar from '../TopBar'\nimport MeCard from './MeCard'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex',\n    flexDirection: 'column',\n    height: '100%'\n  },\n  filterContainer: {\n    color: '#AAAAAA'\n  },\n  filterChip: {\n\n  },\n  seriesList: {\n    height: '100%',\n    overflowX: 'hidden',\n    overflowY: 'scroll'\n  }\n}))\n\nconst FILTERS = {\n  ALL: 'All',\n  OWN: 'Own',\n  CONTRIBUTED: 'Contributed',\n  WATCHING: 'Watching'\n}\n\nconst SORT = {\n  ACTIVITY: 'Last Photo',\n  CREATED: 'Created',\n  NAME: 'Name'\n}\n\nconst MyProfile = ({ user, feed, loading }) => {\n  const classes = useStyles()\n\n  const [filterVal, setFilter] = useState(FILTERS.ALL)\n  const [sortVal, setSort] = useState(SORT.ACTIVITY)\n  const [sortAsc, setSortAsc] = useState(true)\n\n  const sortSetter = (newSort) => {\n    if (newSort === sortVal) setSortAsc(!sortAsc)\n    else setSort(newSort)\n  }\n\n  let filteredFeed = []\n\n  switch (filterVal) {\n    case FILTERS.ALL:\n      filteredFeed = [...feed]\n      break\n    case FILTERS.OWN:\n      filteredFeed = feed.filter(fi => fi.createdUser.id === user.id)\n      break\n    case FILTERS.CONTRIBUTED:\n      filteredFeed = []\n      break\n    case FILTERS.WATCHING:\n      filteredFeed = feed.filter(fi => user.watching.indexOf(fi.id) > -1)\n      break\n    default:\n      break\n  }\n\n  switch (sortVal) {\n    case SORT.ACTIVITY:\n      if (sortAsc) filteredFeed.sort((a, b) => a.latest.takenOn - b.latest.takenOn)\n      else filteredFeed.sort((a, b) => b.latest.takenOn - a.latest.takenOn)\n      break\n    case SORT.CREATED:\n      if (sortAsc) filteredFeed.sort((a, b) => a.createdOn - b.createdOn)\n      else filteredFeed.sort((a, b) => b.createdOn - a.createdOn)\n      break\n    case SORT.NAME:\n      if (sortAsc) {\n        filteredFeed.sort((a, b) => {\n          if (a.name < b.name) {\n            return -1\n          }\n          if (a.name > b.firstname) {\n            return 1\n          }\n          return 0\n        })\n      }\n      else {\n        filteredFeed.sort((a, b) => {\n          if (b.name < a.name) {\n            return -1\n          }\n          if (b.name > a.name) {\n            return 1\n          }\n          return 0\n        })\n      }\n      break\n    default:\n      break\n  }\n\n  console.log('MyProfile', { loading, feed })\n  return (\n    <div className={classes.root}>\n      <TopBar>\n        <Typography>My Profile</Typography>\n      </TopBar>\n      <MeCard user={user} />\n      <Divider />\n      <div className={classes.filterContainer}>\n        <div>\n          <Typography component='span'>Filter: </Typography>\n          <FilterSortItem active={filterVal === FILTERS.ALL} onClick={() => setFilter(FILTERS.ALL)} label={FILTERS.ALL} />\n        |\n          <FilterSortItem active={filterVal === FILTERS.OWN} onClick={() => setFilter(FILTERS.OWN)} label={FILTERS.OWN} />\n        |\n          <FilterSortItem active={filterVal === FILTERS.CONTRIBUTED} onClick={() => setFilter(FILTERS.CONTRIBUTED)} label={FILTERS.CONTRIBUTED} />\n        |\n          <FilterSortItem active={filterVal === FILTERS.WATCHING} onClick={() => setFilter(FILTERS.WATCHING)} label={FILTERS.WATCHING} />\n\n        </div>\n        <div>\n          <Typography component='span'>Sort: </Typography>\n          <FilterSortItem asc={sortAsc} active={sortVal === SORT.NAME} onClick={() => sortSetter(SORT.NAME)} label={SORT.NAME} />\n        |\n          <FilterSortItem asc={sortAsc} active={sortVal === SORT.ACTIVITY} onClick={() => sortSetter(SORT.ACTIVITY)} label={SORT.ACTIVITY} />\n        |\n          <FilterSortItem asc={sortAsc} active={sortVal === SORT.CREATED} onClick={() => sortSetter(SORT.CREATED)} label={SORT.CREATED} />\n        </div>\n      </div>\n      <div className={classes.seriesList}>\n        {filteredFeed.map((series, idx) => (\n          <SeriesListItem\n            key={`seriesListItem${idx}`}\n            series={series}\n            showCreatedOn\n            showLastPhoto\n          />\n        ))}\n      </div>\n    </div>\n  )\n}\n\nMyProfile.propTypes = {\n  user: PropTypes.object,\n  loading: PropTypes.object.isRequired,\n  feed: PropTypes.array.isRequired\n}\n\nexport default MyProfile\n\nconst useFilterStyles = makeStyles(theme => ({\n  root: {\n    margin: theme.spacing(0, 1, 0, 1)\n  }\n}))\n\nconst FilterSortItem = ({ active, asc, onClick, label }) => {\n  const classes = useFilterStyles()\n\n  const arrow = active && typeof asc !== 'undefined'\n    ? asc === true ? '' : ''\n    : ' '\n\n  return (\n    <Typography\n      className={classes.root}\n      onClick={onClick}\n      variant='caption'\n      color={active ? 'textPrimary' : 'textSecondary'}\n    >\n      {label} {arrow}\n    </Typography>\n  )\n}\n\nFilterSortItem.propTypes = {\n  active: PropTypes.bool,\n  asc: PropTypes.bool,\n  onClick: PropTypes.func.isRequired,\n  label: PropTypes.string.isRequired\n}\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { graphql, compose } from 'react-apollo'\n\nimport { getUser, userSeries, seriesFromList } from './queries'\nimport MyProfile from '../components/MyProfile/MyProfile'\n\nconst ProfileConnect = ({ data }) => {\n  const { userQ, seriesQ, watchedSeriesQ } = data\n  const user = userQ && userQ.user ? userQ.user : null\n\n  const seriesQArr = seriesQ && seriesQ.userSeries && seriesQ.userSeries.seriesSummaries ? seriesQ.userSeries.seriesSummaries : []\n  const watchedSeriesQArr = watchedSeriesQ && watchedSeriesQ.arraySeries ? watchedSeriesQ.arraySeries : []\n  console.log('ProfileConnect', { seriesQArr, watchedSeriesQ, watchedSeriesQArr })\n  const feed = [...seriesQArr, ...watchedSeriesQArr]\n  const loading = {\n    user: userQ.loading,\n    list: Boolean(\n      (seriesQ && seriesQ.loading) ||\n      (watchedSeriesQ && watchedSeriesQ.loading))\n  }\n\n  return <MyProfile user={user} loading={loading} feed={feed}\n  />\n}\n\nProfileConnect.propTypes = {\n  data: PropTypes.object // from graphql\n}\n\n// This one is really simple.\nconst withGetUserQuery = graphql(getUser, {\n  props: ({ data, ownProps }) => {\n    // console.log('ProfileConnect withGetUserQuery', { data, ownProps })\n    return { data: { userQ: data } }\n  }\n})\n\nconst withuserSeriesQuery = graphql(userSeries, {\n  skip: ({ data }) => !data.userQ.user,\n  props: ({ data, ownProps }) => {\n    // console.log('ProfileConnect withuserSeriesQuery', { data, ownProps })\n    return { data: { ...ownProps.data, seriesQ: data } }\n  }\n})\n\n// const withMyPhotosQuery = graphql(myPhotos)\n\nconst withMyWatchedSeriesQuery = graphql(seriesFromList, {\n  props: ({ data, ownProps }) => {\n    // console.log('ProfileConnect withMyWatchedSeriesQuery', { data, ownProps })\n    return { data: { ...ownProps.data, watchedSeriesQ: data } }\n  },\n  skip: ({ data }) => {\n    try {\n      return data.userQ.user.watching.length < 1\n    }\n    catch (e) {\n      return true\n    }\n  },\n  options: ({ data }) => {\n    return {\n      variables: { seriesList: data.userQ.user.watching }\n    }\n  }\n})\n\n/**\n * Compose all our queries together\n */\nexport default compose(\n  withGetUserQuery,\n  withuserSeriesQuery,\n  // withMyPhotosQuery,\n  withMyWatchedSeriesQuery\n)(ProfileConnect)\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport Avatar from '@material-ui/core/Avatar'\nimport IconButton from '@material-ui/core/IconButton'\n\nimport PlaceIcon from '@material-ui/icons/Place'\nimport { makeStyles } from '@material-ui/core/styles'\nconst useStyles = makeStyles(theme => ({\n  root: {\n    textAlign: 'center'\n  },\n  placeAvatar: {\n    color: 'white',\n    background: theme.palette.primary.main,\n    margin: 'auto'\n  },\n  placeIcon: {\n  }\n}))\n\nconst FindOnMapButton = ({ onClick }) => {\n  const classes = useStyles()\n  return (\n    <div className={classes.root}>\n      <Avatar className={classes.placeAvatar}>\n        <IconButton color='inherit' onClick={e => {\n          e.preventDefault()\n          e.stopPropagation()\n          onClick()\n        }}>\n          <PlaceIcon color='inherit' />\n        </IconButton>\n      </Avatar>\n      {/* <Typography variant='caption' component='div'>MAP</Typography> */}\n    </div>\n  )\n}\n\nFindOnMapButton.propTypes = {\n  onClick: PropTypes.func.isRequired\n}\n\nexport default FindOnMapButton\n","import React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport Paper from '@material-ui/core/Paper'\nimport Typography from '@material-ui/core/Typography'\n// import MenuIcon from '@material-ui/icons/Menu'\nimport { makeStyles } from '@material-ui/core/styles'\nimport FindOnMapButton from '../misc/FindOnMapButton'\n// import StarIcon from '@material-ui/icons/Star'\n// import StarBorderIcon from '@material-ui/icons/StarBorder'\nimport { Avatar } from '@material-ui/core'\nimport { AppContext } from '../../contexts'\nimport { formatDate } from '../../lib/datelib'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    height: '100%',\n    padding: theme.spacing(0, 0.5, 1, 0.5)\n  },\n  imgContainer: {\n    overflow: 'hidden',\n    height: '100%',\n    position: 'relative'\n  },\n  findOnMapButtonContainer: {\n    position: 'absolute',\n    opacity: 0.8,\n    bottom: theme.spacing(1),\n    right: theme.spacing(1)\n  },\n  titleContainer: {\n    background: '#444444AA',\n    color: 'white',\n    position: 'absolute',\n    alignItems: 'center',\n    display: 'flex',\n    top: 0,\n    width: '100%',\n    paddingRight: theme.spacing(1)\n  },\n  avatar: {\n    border: '1px solid white',\n    margin: theme.spacing(0, 1)\n  },\n  title: {\n    flexGrow: 1\n  },\n  img: {\n    objectFit: 'cover',\n    height: '100%',\n    width: '100%'\n  }\n  // gravatarImg: {\n  // }\n}))\n\nconst EVENT_VERBS = {\n  DELETE: 'Deleted',\n  ADD: 'Added'\n}\n\nconst FeedItem = ({ event, onMapClick, onImageClick, onProfileClick, onSeriesClick }) => {\n  const { series, photo } = event\n  // console.log('EVENT', { series, relation, photo })\n  const classes = useStyles()\n  const { seriesConfig } = useContext(AppContext)\n\n  // const isDelete = event.verb === 'ADD'\n  // const seriesWatching = user.watching && user.watching.indexOf(series.id) > -1\n\n  return (\n    <Paper className={classes.root} elevation={1}>\n      <div className={classes.imgContainer}>\n        {/* <div className={classes.imgContainer}> */}\n        <img\n          alt='medium'\n          className={classes.img}\n          src={seriesConfig.getPhotoUrl(photo, 'medium')}\n          onClick={() => onImageClick(series.id, photo.id)}\n        />\n        {/* </div> */}\n        {/* <div className={classes.findOnMapButtonContainer}>\n          <FindOnMapButton onClick={() => onMapClick(series)} />\n        </div> */}\n        <div className={classes.titleContainer}>\n          <Avatar onClick={() => onProfileClick(photo.createdUser.username)} className={classes.avatar}>\n            <img alt='profile' className={classes.gravatarImg} src={photo.createdUser.gravatar} />\n          </Avatar>\n          <div className={classes.title}>\n            <Typography variant='body1' color='inherit'>{series.name}</Typography>\n            <Typography variant='body2' color='inherit'>{photo.createdUser.username} {EVENT_VERBS.ADD} a photo</Typography>\n            <Typography variant='caption' color='inherit'>{formatDate(photo.updatedOn)}</Typography>\n          </div>\n          {/* <IconButton color='inherit' className={classes.watchButton} >\n            {seriesWatching ? <StarIcon color='inherit' /> : <StarBorderIcon color='inherit' />}\n          </IconButton> */}\n          <FindOnMapButton onClick={() => onMapClick(series.id, photo.id)} />\n        </div>\n      </div>\n    </Paper>\n  )\n}\n\nFeedItem.propTypes = {\n  // TODO: THIS IS NOT THE SHAPE WE WANT. NEED TO HASH THIS OUT\n  event: PropTypes.object.isRequired,\n  onSeriesClick: PropTypes.func.isRequired,\n  onImageClick: PropTypes.func.isRequired,\n  onProfileClick: PropTypes.func.isRequired,\n  onMapClick: PropTypes.func.isRequired\n}\n\nexport default FeedItem\n\nexport const FeedItemCosmos = (props) => {\n  return (\n    <div>\n      <FeedItem {...props} />\n      <FeedItem {...props} />\n      <FeedItem {...props} />\n      <FeedItem {...props} />\n      <FeedItem {...props} />\n      <FeedItem {...props} />\n      <FeedItem {...props} />\n      <FeedItem {...props} />\n      <FeedItem {...props} />\n      <FeedItem {...props} />\n      <FeedItem {...props} />\n    </div>\n  )\n}\nFeedItemCosmos.propTypes = {\n  // TODO: THIS IS NOT THE SHAPE WE WANT. NEED TO HASH THIS OUT\n  event: PropTypes.object.isRequired\n}\n","import React, { useRef } from 'react'\nimport PropTypes from 'prop-types'\nimport Typography from '@material-ui/core/Typography'\n\nimport { List } from 'react-virtualized' // InfiniteLoader\nimport useOnline from '../../lib/useOnline'\n\n// import MenuIcon from '@material-ui/icons/Menu'\nimport { makeStyles } from '@material-ui/core/styles'\nimport FeedItem from './FeedItem'\n\nimport TopBar from '../TopBar'\n\nimport useComponentSize from '../../lib/useComponentSize'\n\nconst ROWHEIGHT = 300\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex',\n    flexDirection: 'column',\n    height: '100%'\n  },\n  listContainer: {\n    flexGrow: 1,\n    overflowX: 'hidden'\n  },\n  vList: {\n    height: '100%',\n    width: '100%'\n  },\n  feedContainer: {\n    flexGrow: 1,\n    // Promote the list into his own layer on Chrome. This cost memory but helps keeping high FPS.\n    transform: 'translateZ(0)'\n  },\n  grow: {\n    flexGrow: 1\n  }\n}))\n\nconst MyFeed = ({\n  events, loading, onMapClick, onImageClick, onProfileClick,\n  onSeriesClick, fetchNewest, fetchMore, window\n}) => {\n  const classes = useStyles()\n  const listRef = useRef()\n  const { size } = useComponentSize(listRef)\n  const { online } = useOnline()\n\n  const rowRenderer = ({\n    index, // Index of row\n    isScrolling, // The List is currently being scrolled\n    isVisible, // This row is visible within the List (eg it is not an overscanned row)\n    key, // Unique key within array of rendered rows\n    parent, // Reference to the parent List (instance)\n    style // Style object to be applied to row (to position it);\n    // This must be passed through to the rendered row element.\n  }) => {\n    const row = events[index]\n    let content\n    if (index < events.length && row) {\n      content = <FeedItem\n        event={events[index]}\n        onSeriesClick={onSeriesClick}\n        onImageClick={onImageClick}\n        onProfileClick={onProfileClick}\n        onMapClick={onMapClick}\n      />\n    }\n    else if (index === events.length) {\n      // content = <div className={classes.placeholder} style={{ width: row.size }} />\n      const wEnd = window && window[0] === 0\n      content = <Typography>LOADING...</Typography>\n      // console.log('LOADING', { style, parent })\n      const almostAtEnd = ROWHEIGHT * 4 + parent.state.scrollTop > style.top\n\n      if (!online) {\n        content = <Typography>No loading while offline</Typography>\n      }\n      else if (wEnd) {\n        content = <Typography>No More Content to load</Typography>\n      }\n      // Only if we're online, not loading and visible\n      else if (!loading && almostAtEnd) {\n        fetchMore()\n      }\n    }\n\n    return (\n      <div className={classes.row} key={key} style={style}>\n        {content}\n      </div>\n    )\n  }\n  rowRenderer.propTypes = {\n    index: PropTypes.any,\n    key: PropTypes.any,\n    style: PropTypes.any,\n    isScrolling: PropTypes.any,\n    isVisible: PropTypes.any,\n    parent: PropTypes.any\n  }\n\n  // console.log('DEBUGLIST', size)\n\n  return (\n    <div className={classes.root}>\n      <TopBar>\n        <Typography className={classes.grow}>Feed</Typography>\n      </TopBar>\n      <div className={classes.listContainer} ref={listRef}>\n        <List\n          height={size.height}\n          width={size.width}\n          className={classes.vList}\n          rowCount={events.length + 1}\n          rowHeight={ROWHEIGHT}\n          rowRenderer={rowRenderer}\n        />\n      </div>\n    </div>\n  )\n}\n\nMyFeed.propTypes = {\n  events: PropTypes.array.isRequired,\n  loading: PropTypes.bool,\n  window: PropTypes.arrayOf(PropTypes.number),\n  onSeriesClick: PropTypes.func.isRequired,\n  onImageClick: PropTypes.func.isRequired,\n  onProfileClick: PropTypes.func.isRequired,\n  onMapClick: PropTypes.func.isRequired,\n  fetchNewest: PropTypes.func.isRequired,\n  fetchMore: PropTypes.func.isRequired\n}\n\nexport default MyFeed\n","import React, { useRef, useState, useEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport { graphql } from 'react-apollo'\nimport { home } from '../config'\nimport actions from '../redux/actions'\nimport { connect } from 'react-redux'\nimport { getMyFeed } from './queries'\nimport MyFeed from '../components/MyFeed/MyFeed'\nimport useOnline from '../lib/useOnline'\n\nconst POLL_INTERVAL = 20 // (seconds)\nconst FEED_LIMIT = 5 // (items to load)\n\nconst FeedConnect = ({\n  data, loading, fetchMore, fetchNewest,\n  loadingNewest,\n  loadingMore,\n  jumpToSeries,\n  jumpToMap,\n  jumpToUser\n}) => {\n  const timerRef = useRef()\n  const { online } = useOnline()\n  const [lastCheck, setLastCheck] = useState(null)\n  timerRef.current = lastCheck\n\n  // Initiate the polling process. We simply update the timestamp every N seconds\n  useEffect(() => {\n    function ping () {\n      if (!loading && online) fetchNewest()\n      if (timerRef.current) setLastCheck(String(Date.now() - POLL_INTERVAL * 1000))\n    }\n    if (!timerRef.current) timerRef.current = setInterval(ping, POLL_INTERVAL * 1000)\n    return () => {\n      if (timerRef.current) {\n        console.log('clear poll timer')\n        clearInterval(timerRef.current)\n        timerRef.current = null\n      }\n    }\n  }, [])\n\n  const events = data.myFeed ? data.myFeed.feed || [] : []\n  const window = data.myFeed ? data.myFeed.window.map(v => parseInt(v, 10)) || [null, null] : [null, null]\n\n  return (\n    <MyFeed {...{ events, loading, window, fetchMore, fetchNewest, jumpToSeries }}\n      onSeriesClick={() => {}}\n      onImageClick={jumpToSeries}\n      onProfileClick={jumpToUser}\n      onMapClick={jumpToMap}\n    />\n  )\n}\n\nFeedConnect.propTypes = {\n  data: PropTypes.object, // from graphql\n  loading: PropTypes.bool, // from graphql\n  loadingNewest: PropTypes.bool, // from graphql\n  loadingMore: PropTypes.bool, // from graphql\n  fetchMore: PropTypes.func,\n  fetchNewest: PropTypes.func,\n  jumpToSeries: PropTypes.func,\n  jumpToMap: PropTypes.func,\n  jumpToUser: PropTypes.func\n}\n\nconst withFeedQuery = graphql(getMyFeed, {\n  props: ({ data }) => {\n    if (data.error) console.error(data.error)\n\n    // TODO: Not sure this will propagate correctly. Test it.\n    let loadingNewest = false\n    let loadingMore = false\n\n    // console.log('withFeedQuery', data)\n\n    // One Thunk function designed for getting everything since the last check\n    const fetchNewest = () => {\n      loadingNewest = true\n      console.log('fetchNewest', data)\n      data.fetchMore({\n        variables: { ...data.variables, start: data.myFeed.window[1] },\n        // How do we mush the new query with the old one\n        updateQuery: (prev, { fetchMoreResult }) => {\n          loadingNewest = false\n          return {\n            myFeed: {\n              ...fetchMoreResult.myFeed,\n              // put the newest stuff first\n              feed: [ ...fetchMoreResult.myFeed.feed, ...prev.myFeed.feed ],\n              window: [prev.myFeed.window[0], fetchMoreResult.myFeed.window[1]]\n            }\n          }\n        }\n      })\n    }\n\n    // A second Thunk function designed to get more elements in the feed history\n    const fetchMore = () => {\n      loadingMore = true\n      console.log('fetchMore', data)\n      data.fetchMore({\n        variables: { ...data.variables, end: data.myFeed.window[0] },\n        // How do we mush the new query with the old one\n        updateQuery: (prev, { fetchMoreResult }) => {\n          loadingMore = false\n          return {\n            myFeed: {\n              ...fetchMoreResult.myFeed,\n              feed: [ ...prev.myFeed.feed, ...fetchMoreResult.myFeed.feed ],\n              window: [fetchMoreResult.myFeed.window[0], prev.myFeed.window[1]]\n            }\n          }\n        }\n      })\n    }\n\n    return {\n      data,\n      loadingNewest,\n      loadingMore,\n      fetchNewest, // This is the poll we do every n seconds\n      fetchMore, // This is when we scroll to the bottom of the list\n      loading: data.loading\n    }\n  },\n  // skip: ({ activeSeries, isNewSeries }) => !activeSeries || isNewSeries,\n  options: ({ activeSeries }) => ({\n    variables: {\n      limit: FEED_LIMIT\n    }\n  })\n})\n\n/**\n * Map our redux state and functions\n */\nconst mapStateToProps = (state, props) => {\n  return { }\n}\n\n// We're using graphql() HOC because it's convenient but it doesn't need to render anything\n// const FeedQueryConnect = withFeedQuery(() => null)\nconst mapDispatchToProps = dispatch => ({\n  jumpToSeries: (seriesId, photoId) => {\n    dispatch(actions.setHomeState(home.AppStateTypes.SERIES, { activeSeries: seriesId, initialPhoto: photoId }))\n  },\n  jumpToUser: (username) => {\n    dispatch(actions.setHomeState(home.AppStateTypes.SEARCH, { search: { tab: home.SEARCH_TABS.USER, text: username } }))\n  },\n  jumpToMap: (seriesId, photoId) => {\n    dispatch(actions.pushMapHistory({\n      mode: home.MapModeTypes.FREE\n    }))\n    dispatch(actions.setHomeState(home.AppStateTypes.MAP, { activeSeries: seriesId, initialPhoto: photoId }))\n  }\n})\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(\n  withFeedQuery(FeedConnect)\n)\n","import React, { useRef, useEffect, useState } from 'react'\nimport Typography from '@material-ui/core/Typography'\n// import MenuIcon from '@material-ui/icons/Menu'\nimport { makeStyles } from '@material-ui/core/styles'\nimport useOnline from '../../lib/useOnline'\nimport moment from 'moment'\n\nconst CHECKINTERVAL = 5000\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    background: 'black',\n    color: 'white',\n    textAlign: 'center'\n  }\n}))\n\nconst OfflineBar = () => {\n  const classes = useStyles()\n  const { online, since } = useOnline()\n  const [sinceStr, setSinceStr] = useState()\n  const timerRef = useRef()\n\n  const calcSinceStr = () => {\n    const newText = moment(since, 'x').fromNow()\n    // console.log('OFFLINE SINCE', since, newText)\n    setSinceStr(newText)\n  }\n  const clearTimer = () => {\n    if (timerRef.current) {\n      clearInterval(timerRef.current)\n      timerRef.current = null\n    }\n  }\n\n  useEffect(() => {\n    if (since && !timerRef.current) {\n      calcSinceStr()\n      timerRef.current = setInterval(calcSinceStr, CHECKINTERVAL)\n    }\n    else if (!since)clearTimer()\n    return () => {\n      clearTimer()\n    }\n  }, [since])\n\n  if (online) return null\n  return (\n    <Typography className={classes.root} variant='caption' component='div'>\n      Offline ({sinceStr})\n    </Typography>\n  )\n}\n\nexport default OfflineBar\n","import React from 'react'\nimport classNames from 'classnames'\nimport PropTypes from 'prop-types'\n\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport AppBar from '@material-ui/core/AppBar'\nimport Paper from '@material-ui/core/Paper'\nimport Typography from '@material-ui/core/Typography'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport Button from '@material-ui/core/Button'\n// import Fab from '@material-ui/core/Fab'\n\nimport HomeIcon from '@material-ui/icons/HomeOutlined'\nimport MapIcon from '@material-ui/icons/MapOutlined'\nimport SearchIcon from '@material-ui/icons/SearchOutlined'\nimport AddIcon from '@material-ui/icons/Add'\nimport PersonOutline from '@material-ui/icons/PersonOutline'\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport useOnline from '../lib/useOnline'\nimport AddFab from '../components/PhotoSeries/views/controls/AddFab'\nimport OfflineBar from './misc/OfflineBar'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n  },\n  text: {\n    padding: theme.spacing(2, 2, 0)\n  },\n  paper: {\n    paddingBottom: 50\n  },\n  list: {\n    marginBottom: theme.spacing(2)\n  },\n  subheader: {\n    backgroundColor: theme.palette.background.paper\n  },\n  grow: {\n    flexGrow: 1\n  },\n  spacer: {\n    width: 40,\n    flexGrow: 1\n  }\n}))\n\nconst BottomBar = ({ className, signedIn, onHomeClick, onMapClick, onSearchClick, onProfileClick, onCameraClick, onLibraryClick }) => {\n  const classes = useStyles()\n  const { online } = useOnline()\n\n  return (\n    <AppBar position='static' className={classNames(classes.root, className)}>\n      <Toolbar>\n        {signedIn && (\n          <Button\n            edge='start'\n            className={classes.grow}\n            color='inherit'\n            onClick={onHomeClick}\n          >\n            <HomeIcon />\n          </Button>\n        )}\n        <Button\n          edge='start'\n          className={classes.grow}\n          color='inherit'\n          onClick={onMapClick}\n        >\n          <MapIcon />\n        </Button>\n        {signedIn && (\n          <AddFab\n            onCameraClick={onCameraClick}\n            onLibraryClick={onLibraryClick}\n          >\n            <AddIcon />\n          </AddFab>\n        )}\n        <div className={classes.spacer} />\n        <Button\n          color='inherit'\n          className={classes.grow}\n          disabled={!online}\n          onClick={onSearchClick}\n        >\n          <SearchIcon />\n        </Button>\n        {signedIn && (\n          <Button\n            edge='end'\n            color='inherit'\n            className={classes.grow}\n            onClick={onProfileClick}\n          >\n            <PersonOutline />\n          </Button>\n        )}\n      </Toolbar>\n    </AppBar>\n  )\n}\n\nBottomBar.propTypes = {\n  className: PropTypes.string,\n  signedIn: PropTypes.bool,\n  // Here are our button handlers\n  onHomeClick: PropTypes.func.isRequired,\n  onMapClick: PropTypes.func.isRequired,\n  onSearchClick: PropTypes.func.isRequired,\n  onProfileClick: PropTypes.func.isRequired,\n  onCameraClick: PropTypes.func.isRequired,\n  onLibraryClick: PropTypes.func.isRequired\n}\n\nexport default BottomBar\n\nexport const BottomBarCosmosWrapper = (props) => {\n  // const [someStateItem, setSomeStateItem] = useState()\n  const classes = useWrapperStyles()\n  return (\n    <div className={classes.root}>\n      <OfflineBar />\n      <CssBaseline /> {/* You only need this in a root element. Don't put it anywhere else in the dom */}\n      <Paper className={classes.paper}>\n        <Typography variant='h5'>\n          This is a dummy component.\n        </Typography>\n      </Paper>\n      <BottomBar {...props} />\n    </div>\n  )\n}\n\nconst wrapperStyle = theme => ({\n  root: {\n    height: '100%',\n    display: 'flex',\n    flexDirection: 'column'\n  },\n  paper: {\n    flexGrow: 1\n  }\n})\n\nconst useWrapperStyles = makeStyles(wrapperStyle)\n","import React, { useContext, useEffect } from 'react'\nimport PropTypes from 'prop-types'\n\nimport CssBaseline from '@material-ui/core/CssBaseline'\n\nimport UploaderConnect from './graphql/Uploader.connect'\nimport SeriesConnect from './graphql/Series.connect'\nimport MapConnect from './graphql/Map.connect'\nimport SearchConnect from './graphql/Search.connect'\nimport ProfileConnect from './graphql/Profile.connect'\nimport FeedConnect from './graphql/Feed.connect'\n\nimport OfflineBar from './components/misc/OfflineBar'\nimport BottomBar from './components/BottomBar'\nimport { AppContext } from './contexts'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport { home as homeConfig } from './config'\n\nconst STATES = homeConfig.AppStateTypes\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    height: '100%',\n    overflow: 'hidden',\n    display: 'flex',\n    flexDirection: 'column'\n  },\n  offlineBar: {\n    flex: '0 0'\n  },\n  activeWrapper: {\n    overflow: 'hidden',\n    flexGrow: 1,\n    flexShrink: 1\n  },\n  uploaderContainer: {\n    zIndex: 2000,\n    flex: '0 0'\n  }\n}))\n\n/**\n * This is the over-arching wrapper for the app. It combines all the\n * same place. Time will tell if that's a good strategy.\n */\nconst App = ({ domain, setHomeState, onCameraClick, onLibraryClick }) => {\n  const classes = useStyles()\n  const { signedIn } = useContext(AppContext)\n\n  console.log('Rendering AppConnect', domain, signedIn)\n\n  // console.log('App', { currentState, user, signedIn, signOut })\n\n  useEffect(() => {\n    // No home feed for anonymous users\n    if (!signedIn && domain === STATES.FEED) setHomeState(STATES.MAP)\n  }, [domain])\n\n  let showBottomBar = true\n  let ActiveComponent = FeedConnect\n  switch (domain) {\n    case STATES.FEED:\n      ActiveComponent = FeedConnect\n      break\n    case STATES.MAP:\n      ActiveComponent = MapConnect\n      break\n    case STATES.PROFILE:\n      ActiveComponent = ProfileConnect\n      break\n    case STATES.SEARCH:\n      ActiveComponent = SearchConnect\n      break\n    case STATES.SERIES:\n      ActiveComponent = SeriesConnect\n      showBottomBar = false\n      break\n    case STATES.NEW_SERIES_CAMERA:\n      ActiveComponent = SeriesConnect\n      showBottomBar = false\n      break\n    case STATES.NEW_SERIES_LIBRARY:\n      ActiveComponent = SeriesConnect\n      showBottomBar = false\n      break\n    default:\n      break\n  }\n\n  return (\n    <div className={classes.root}>\n      <CssBaseline /> {/* You only need this in a root element. Don't put it anywhere else in the dom */}\n      <OfflineBar className={classes.offlineBar} />\n      <div className={classes.activeWrapper}>\n        <ActiveComponent />\n      </div>\n      {showBottomBar && (\n        <BottomBar\n          signedIn={signedIn}\n          onHomeClick={() => setHomeState(STATES.FEED)}\n          onMapClick={() => setHomeState(STATES.MAP)}\n          onSearchClick={() => setHomeState(STATES.SEARCH, { search: null })}\n          onProfileClick={() => setHomeState(STATES.PROFILE)}\n          onCameraClick={onCameraClick}\n          onLibraryClick={onLibraryClick}\n        />\n      )}\n      {/* Uploader is persistent across all views */}\n      <UploaderConnect className={classes.uploaderContainer} />\n    </div>\n  )\n}\n\nApp.propTypes = {\n  // All of this comes in from From Redux\n  domain: PropTypes.string.isRequired,\n  setHomeState: PropTypes.func.isRequired,\n  onCameraClick: PropTypes.func.isRequired,\n  onLibraryClick: PropTypes.func.isRequired\n}\n\nexport default App\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport Typography from '@material-ui/core/Typography'\nimport Button from '@material-ui/core/Button'\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport BugReportIcon from '@material-ui/icons/BugReport'\nimport ErrorIcon from '@material-ui/icons/Error'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    height: '100%',\n    overflow: 'hidden',\n    padding: theme.spacing(1),\n    display: 'flex',\n    flexDirection: 'column',\n    textAlign: 'center',\n    color: theme.palette.text.primary,\n    border: `20px solid ${theme.palette.text.secondary}`\n  },\n  icon: {\n    margin: 'auto',\n    flex: '1 1 20%',\n    height: '70%',\n    width: '70%'\n  },\n  text: {\n  },\n  stack: {\n    padding: theme.spacing(2),\n    marginBottom: theme.spacing(2),\n    fontSize: '8px',\n    flexGrow: 1,\n    textAlign: 'left',\n    whiteSpace: 'pre-wrap',\n    overflow: 'scroll',\n    color: theme.palette.error.main,\n    fontFamily: 'Consolas, monaco, monospace'\n  }\n}))\n\nconst ErrorScreen = ({ error }) => {\n  const classes = useStyles()\n\n  let stackEl = null\n  try {\n    if (process.env.NODE_ENV === 'development') {\n      stackEl = (\n        <Typography className={classes.stack}>\n          {error.stack}\n        </Typography>\n      )\n    }\n  }\n  catch (e) {}\n\n  return (\n    <div className={classes.root}>\n      <CssBaseline />\n      <ErrorIcon className={classes.icon}color='inherit' />\n      <Typography variant='subtitle1' className={classes.text} color='inherit'>\n        Something went wrong\n      </Typography>\n      {error && error.message && <Typography variant='body1' className={classes.text} color='inherit'>\n        {error.message}\n      </Typography>}\n      {stackEl}\n      <Button variant='outlined' disabled>\n        <BugReportIcon />\n        File a bug report\n      </Button>\n    </div>\n  )\n}\n\nErrorScreen.propTypes = {\n  error: PropTypes.object\n}\n\nexport default ErrorScreen\n","import React, { useMemo } from 'react'\nimport { Query, ApolloProvider, compose } from 'react-apollo'\nimport { IntlWrapper } from './translations'\nimport { getUser } from './graphql/queries'\nimport { AppContext } from './contexts'\n\nimport { createApolloClient } from './lib/useGraphQL'\nimport ErrorBoundary from './lib/ErrorBoundary'\nimport useAuthentication from './lib/useAuthentication'\nimport useShowAddToHome from './lib/useShowAddToHome'\nimport withReduxProvider from './redux/withReduxProvider'\nimport { connect } from 'react-redux'\nimport actions from './redux/actions'\nimport config, { home as homeConfig } from './config'\n\nimport App from './App'\nimport ErrorScreen from './components/misc/ErrorScreen'\n\n/**\n * HOC for AppContext and ApolloProvider\n */\nexport const withApolloAuthProvider = Wrapped => (props) => {\n  // console.log('withApolloAuthProvider', props)\n  const { signedIn, isGod, authData, signOut, authScreen, accessToken, forceSignIn } = useAuthentication()\n  const apolloClient = useMemo(() => createApolloClient(accessToken), [accessToken])\n\n  // This triggers all the PWA Goodness\n  const { isIos } = useShowAddToHome()\n\n  // If the user hasn't decided to be anonymous or sign in yet show them the login screen\n  console.log('Rendering AppConnect', { isIos, props, signedIn, isGod, authData })\n  if (signedIn === null) return authScreen\n\n  // These are the things the rest of the app needs to find:\n  const appContext = {\n    signOut,\n    forceSignIn,\n    isIos,\n    signedIn,\n    role: !signedIn\n      ? 'anonymous'\n      : isGod\n        ? 'admin'\n        : 'user',\n    currentUser: authData, // TODO: Need this supported by a graphql query\n    seriesConfig: {\n      meta: {},\n      tags: [\n        {\n          id: 'freeBothType',\n          label: null,\n          color: config.tagColors[0],\n          allowXY: true,\n          allowNonXY: true,\n          allowAdditions: true,\n          // This one returns a promise\n          getValues: () => Promise.resolve(['a', 'b', 'c']),\n          values: []\n        }\n      ],\n      getPhotoUrl: (photo, size) => {\n        try {\n          return `${photo.paths.base}${photo.paths[size]}`\n        }\n        catch (e) {\n          return null\n        }\n      }\n    }\n  }\n\n  return (\n    // We wrap the outside in an error handler\n    <ErrorBoundary fallback={ErrorScreen}>\n      <ApolloProvider client={apolloClient}>\n        <Query query={getUser} skip={!signedIn}>\n          {({ loading, error, data }) => {\n            if (loading) return <p>Loading...</p>\n            if (error) {\n              console.error(error)\n            }\n            if (signedIn) appContext.user = data.user\n            return (\n              <AppContext.Provider value={appContext}>\n                <IntlWrapper>\n                  <Wrapped {...props} />\n                </IntlWrapper>\n              </AppContext.Provider>\n            )\n          }}\n        </Query>\n      </ApolloProvider>\n    </ErrorBoundary>\n  )\n}\n\n/**\n * Map our redux state and functions\n */\nconst mapStateToProps = (state, props) => {\n  const { domain } = state.home.current\n  console.log('mapStateToProps', { state, props })\n  return { domain }\n}\n\nconst mapDispatchToProps = dispatch => ({\n  setHomeState: (newDomain, newParams) => {\n    dispatch(actions.setHomeState(newDomain, newParams))\n  },\n  onCameraClick: () => {\n    dispatch(actions.setHomeState(homeConfig.AppStateTypes.NEW_SERIES_CAMERA))\n  },\n  onLibraryClick: () => {\n    dispatch(actions.setHomeState(homeConfig.AppStateTypes.NEW_SERIES_LIBRARY))\n  }\n})\n\n/**\n * Nearly everything we do depends on who you are as a user so we commit this to state\n */\n\n// The order we compose things here matters a lot\nconst withAppState = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)\n\nexport default compose(\n  // ORDER IS CRITICAL HERE\n  withReduxProvider,\n  withApolloAuthProvider,\n  withAppState\n)(App)\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n)\n\nexport function register (config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href)\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config)\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          )\n        })\n      }\n      else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config)\n      }\n    })\n  }\n}\n\nfunction registerValidSW (swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing\n        if (installingWorker == null) {\n          return\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              )\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration)\n              }\n            }\n            else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.')\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration)\n              }\n            }\n          }\n        }\n      }\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error)\n    })\n}\n\nfunction checkValidServiceWorker (swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type')\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload()\n          })\n        })\n      }\n      else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config)\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      )\n    })\n}\n\nexport function unregister () {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister()\n    })\n  }\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport AppConnect from './App.connect'\n\nimport * as serviceWorker from './serviceWorker'\n// Here's our global overrides css\nimport './index.css'\n// This is the font we need\nrequire('typeface-roboto')\n\nconsole.log('Rendering Main App')\nReactDOM.render(<AppConnect />, document.getElementById('root'))\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.register()\n","import numeral from 'numeral'\n\nexport const isNumeric = num => {\n  try {\n    return !isNaN(parseFloat(num)) && isFinite(num)\n  }\n  catch (e) {\n    return false\n  }\n}\n/**\n * This is a correction to strip === signs off of base64-encoded strings\n * @param {} x\n */\nexport const urlizeb64 = x => x.replace('+', '-').replace('/', '_').replace(/=+$/, '')\n\n/**\n * We need numbers displayed consistently. This is how we do it.\n * @param {*} num\n * @param {*} precision\n */\nexport function formatNum (num, precision) {\n  try {\n    const precstr = precision > 0 ? '.' + Array(precision + 1).join('0') : ''\n    const newprec = isNumeric(num) ? numeral(num).format(`0,0${precstr}`) : num\n    return newprec.replace(/(\\.(0{0,1}[1-9]*))0+$/, '$1')\n  }\n  catch (e) {\n    return num\n  }\n}\n\n/**\n * Magic function to clear mouse selection. Use sparingly.\n */\nexport function clearSelection () {\n  if (document.selection && document.selection.empty) {\n    document.selection.empty()\n  }\n  else if (window.getSelection) {\n    var sel = window.getSelection()\n    sel.removeAllRanges()\n  }\n}\n\nexport function isObjectWithKeys (obj) {\n  return ((typeof obj === 'object') && (obj !== null) && Object.keys(obj).length > 0)\n}\n\n/**\n * Dom node parsing is weird because it may return an array or a single element with no way to know\n * which is which.\n */\nexport function makeDomArray (domnode) {\n  if (!domnode) return []\n  const keys = Object.keys(domnode)\n  // This is not the pattern we expect\n  if (keys.length > 1 || keys.length === 0) throw Error('Expected nester domnode structure.')\n  if (!domnode) return []\n  if (!domnode[keys[0]]) return []\n  return Array.isArray(domnode[keys[0]]) ? domnode[keys[0]] : [domnode[keys[0]]]\n}\n\nexport function capitalizeFirstLetter (string) {\n  return string.charAt(0).toUpperCase() + string.slice(1)\n}\n\n/**\n * Good for comparing two purely numeric arrays\n * @param {*} arr1\n * @param {*} arr2\n */\nexport function numericArrayCompare (arr1, arr2) {\n  if (!Array.isArray(arr1) || !Array.isArray(arr2)) return false\n  if (arr1.length !== arr2.length) return false\n\n  return !arr1.some((el, idx) => el !== arr2[idx])\n}\n\n/**\n * We need a function to add the padding '=' signs back before we decode\n * @param {*} hash\n */\nexport function decodeUnbufferedBase64 (hash) {\n  const missingPadding = hash.length % 4\n  if (missingPadding !== 0) {\n    const newhash = hash + Array(4 - missingPadding).join('=')\n    return Buffer.from(newhash, 'base64').toString()\n  }\n  else {\n    return Buffer.from(hash, 'base64').toString()\n  }\n}\n\nexport function encodeUnbufferedBase64 (str) {\n  return urlizeb64(Buffer.from(str).toString('base64'))\n}\n\n/**\n *\n * @param {*} o\n */\nexport function isObject (o) {\n  return o instanceof Object && o.constructor === Object\n}\n\n/**\n * XML to JSON is a non-trivial exercise. We can make certain assumptions\n * about our incoming file\n * @param {*} data\n */\nexport function arrToObj (data) {\n  for (const key in data) {\n    // Make sure we're looping over legitimate objects\n    if (data.hasOwnProperty(key)) {\n      const keyDat = data[key]\n      if (keyDat._) {\n        keyDat.val = keyDat._\n        delete keyDat._\n      }\n      if (keyDat.$) {\n        keyDat.attr = keyDat.$\n        delete keyDat.$\n      }\n      if (typeof keyDat === 'object') {\n        data[key] = arrToObj(keyDat)\n        // There's a pattern we want to collapse\n        // It puts every single individual value into its own array. Not cool\n        if (Array.isArray(keyDat) && keyDat.length === 1 && typeof keyDat[0] === 'string') {\n          if (isNumeric(keyDat[0])) data[key] = Number(keyDat[0])\n          else data[key] = keyDat[0].replace(/\\\\/g, '/')\n        }\n        else if (Array.isArray(keyDat) && keyDat.length === 1 &&\n        // The second case is when it puts objects into its own array\n          isObject(keyDat[0]) &&\n          Object.keys(keyDat[0]).length === 1) {\n          // xml2js does a weird thing where attributes get put into the following structure\n          // [{ \"_\": \"475945.992587164,5125837.37170763\", \"$\": { \"units\": \"m\"  } }]\n          data[key] = keyDat[0][Object.keys(keyDat[0])[0]]\n        }\n        // Dynamo DB does not like empty strings\n        if (typeof data[key] && data[key].length === 0) {\n          delete data[key]\n        }\n        if (typeof data[key] === 'string' && isNumeric(data[key])) data[key] = Number(data[key])\n      }\n    }\n  }\n  return data\n}\n\n/**\n * Returns a random number between min (inclusive) and max (exclusive)\n */\nexport function getRandomArbitraryInt (min, max) {\n  return parseInt(Math.random() * (max - min) + min, 10)\n}\n\n/**\n * Returns a function, that, as long as it continues to be invoked, will not\n * be triggered. The function will be called after it stops being called for\n * N milliseconds. If `immediate` is passed, trigger the function on the\n * leading edge, instead of the trailing.\n * @param {*} func\n * @param {*} wait\n * @param {*} immediate\n */\nexport function debounce (func, wait, immediate) {\n  let timeout = null\n  return (...innerArgs) => {\n    const context = this\n    // const args = arguments\n    const callNow = immediate && !timeout\n    clearTimeout(timeout)\n\n    timeout = setTimeout(() => {\n      timeout = null\n      if (!immediate) {\n        // console.log('debounce', innerArgs)\n        func.apply(context, innerArgs)\n      }\n    }, wait)\n    if (callNow) {\n      // console.log('debounce', innerArgs)\n      func.apply(context, innerArgs)\n    }\n  }\n};\n\n// var myEfficientFn = debounce(function() {\n// // All the taxing stuff you do\n// }, 250);\n\n// window.addEventListener('resize', myEfficientFn);\n"],"sourceRoot":""}