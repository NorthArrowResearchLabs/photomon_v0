{"version":3,"sources":["lib/SeriesConfig.js","lib/Photo.js","lib/datelib.js","lib/util.js","translations.js","graphql/fragments.js","graphql/queries.js","themes/index.js","contexts.js","components/auth/useAuthCommon.js","icons/AppLogo.jsx","components/auth/AuthContainer.jsx","components/auth/Loading.jsx","lib/ErrorBoundary.jsx","components/misc/ErrorScreen.jsx","graphql/mutations.js","containers/Error.connect.js","mapStyles/index.js","config.js","graphql/mutations/updateQueries.js","graphql/mutations/createSeries.js","graphql/offline.js","graphql/useGraphQL.js","components/auth/auth.style.js","components/auth/SignIn.jsx","components/auth/ConfirmSignIn.jsx","components/auth/RequireNewPassword.jsx","components/auth/SignUp.jsx","components/auth/ConfirmSignUp.jsx","components/auth/ForgotPassword.jsx","lib/useAuthentication.js","lib/sensors.js","components/misc/InstallPrompt.jsx","lib/useShowAddToHome.js","lib/useOnline.js","lib/useResponsive.js","redux/actions.js","redux/reducers/map.js","redux/reducers/home.js","redux/reducers/uploader.js","redux/reducers/flags.js","redux/reducers/offline.js","redux/reducers/index.js","redux/storeConfig.js","redux/withReduxProvider.js","components/UploadControl.jsx","lib/s3upload.js","containers/Uploader.connect.js","permissions.js","graphql/mutations/deleteSeries.js","graphql/mutations/updateSeries.js","graphql/mutations/deletePhoto.js","graphql/mutations/createPhoto.js","graphql/mutations/updatePhoto.js","graphql/mutations/watch.js","graphql/mutations/unwatch.js","components/PhotoSeries/contexts.js","components/PhotoSeries/views/QRDisplay.jsx","icons/QRCode.jsx","components/PhotoSeries/views/controls/AddFab.jsx","components/PhotoSeries/views/controls/ContextMenu.jsx","components/PhotoSeries/views/tags/TagChip.jsx","components/PhotoSeries/views/controls/ShortLongText.jsx","components/PhotoSeries/views/controls/UserListItem.jsx","components/PhotoSeries/views/dialogs/BigText.jsx","components/PhotoSeries/views/subViews/SeriesInfo.jsx","components/PhotoSeries/views/subViews/SeriesInfo.style.js","lib/useComponentSize.js","components/PhotoSeries/views/tags/XYTagChip.style.js","components/PhotoSeries/views/tags/XYTagChip.jsx","components/PhotoSeries/views/tags/XYTagSelect.jsx","components/PhotoSeries/views/tags/XYTagSelect.style.js","components/PhotoSeries/views/tags/XYTagChooser.jsx","components/PhotoSeries/views/tags/XYTagChooser.style.js","lib/Tags.js","components/PhotoSeries/views/tags/useXYTags.js","components/PhotoSeries/views/subViews/BrokenImg.jsx","components/PhotoSeries/views/subViews/RawImage.jsx","components/PhotoSeries/views/subViews/Photo.jsx","components/PhotoSeries/views/subViews/Photo.style.js","components/PhotoSeries/views/subViews/SwipeShow.jsx","components/PhotoSeries/views/subViews/SwipeShow.style.js","components/PhotoSeries/views/dialogs/DeleteDialog.jsx","components/PhotoSeries/views/subViews/PhotoGrid.jsx","components/PhotoSeries/views/subViews/PhotoGrid.style.js","components/PhotoSeries/views/SeriesView.style.js","components/PhotoSeries/views/SeriesView.jsx","components/maps/markers/MyLocation.jsx","components/maps/controls/StyleButtons.jsx","components/maps/controls/MyLocationButton.jsx","components/maps/BaseMap.jsx","components/maps/markers/Dot.jsx","components/maps/BaseStaticMap.jsx","components/maps/MapDot.jsx","components/PhotoSeries/views/dialogs/MapDirPicker.jsx","components/PhotoSeries/views/dialogs/BigTextEdit.jsx","components/PhotoSeries/views/subViews/SeriesEditInner.jsx","components/PhotoSeries/views/subViews/SeriesEditInner.style.js","components/PhotoSeries/views/SeriesEdit.jsx","components/PhotoSeries/views/SeriesEdit.style.js","components/PhotoSeries/views/Slideshow.jsx","components/PhotoSeries/views/Slideshow.style.js","components/PhotoSeries/views/dialogs/CancelConfirm.jsx","components/PhotoSeries/views/controls/TagControl.style.js","components/PhotoSeries/views/controls/TagView.jsx","components/PhotoSeries/views/controls/DateControl.jsx","components/PhotoSeries/views/controls/TagControl.jsx","components/PhotoSeries/views/dialogs/TagEdit.jsx","components/PhotoSeries/views/controls/DateView.jsx","components/PhotoSeries/views/subViews/PhotoInfoInner.jsx","components/PhotoSeries/views/subViews/PhotoInfo.jsx","components/PhotoSeries/views/PhotoViewTool.jsx","components/PhotoSeries/views/PhotoViewTool.style.js","components/PhotoSeries/views/controls/PhotoFadeSlider.jsx","components/PhotoSeries/views/PhotoReviewTool.jsx","components/PhotoSeries/views/PhotoReviewTool.style.js","lib/useCamera.js","components/PhotoSeries/views/CameraTool.jsx","components/PhotoSeries/views/CameraTool.style.js","components/PhotoSeries/views/NewPhotoInfo.jsx","components/PhotoSeries/views/NewPhotoInfo.style.js","lib/useFileInput.js","components/PhotoSeries/views/controls/LibraryFilePicker.jsx","lib/Series.js","components/PhotoSeries/views/NewPhoto.jsx","lib/AccessHelper.js","components/PhotoSeries/views/SeriesNotFound.jsx","components/PhotoSeries/views/SeriesLoading.jsx","components/PhotoSeries/index.jsx","containers/Series.connect.js","lib/useClusteredData.js","components/maps/HomeMap.style.js","icons/AppLogoSimple.jsx","icons/Apple.jsx","components/misc/FeatureDisabled.jsx","components/SideDrawer.jsx","components/AboutApp.jsx","components/TopBar.jsx","components/Search/SearchInput.jsx","components/misc/SeriesListItem.jsx","components/misc/ClusterSelected.jsx","components/misc/ViewListDialog.jsx","components/maps/markers/Single.jsx","components/maps/markers/Cluster.jsx","components/maps/HomeMap.jsx","containers/Map.connect.js","components/Search/SearchContextItem.jsx","components/Search/SearchContextResults.jsx","components/Search/SearchEnder.jsx","components/Search/SearchResults.jsx","components/Search/SearchPlaceholder.jsx","components/Search/Search.jsx","containers/Search.connect.js","components/MyProfile/MeCard.jsx","components/MyProfile/MyProfile.jsx","containers/Profile.connect.js","components/MyFeed/FeedEnder.jsx","components/misc/FindOnMapButton.jsx","components/MyFeed/FeedItem.jsx","components/MyFeed/MyFeed.jsx","containers/Feed.connect.js","components/maps/OfflineMap.style.js","components/maps/OfflineMap.jsx","containers/OfflineMap.connect.js","components/PhotoSeries/views/QRReader.jsx","components/misc/OfflineBar.jsx","components/BottomBar.jsx","components/App.jsx","containers/App.connect.js","serviceWorker.js","index.js"],"names":["TYPES","SeriesConfig","seriesConfig","_this","this","Object","_Users_matt_Work_Git_PBR_PhotoMonitoring_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_2__","getTagType","typeId","config","tags","find","tt","id","getTagTypeIndex","findIndex","getXYTagTypes","filter","allowXY","getNonXYTagTypes","allowNonXY","getSeriesMeta","keys","meta","key","type","reduce","acc","_Users_matt_Work_Git_PBR_PhotoMonitoring_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__","_Users_matt_Work_Git_PBR_PhotoMonitoring_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_0__","default","getPhotoMeta","Error","__webpack_exports__","Photo","photo","setMeta","JSON","stringify","newPhoto","concat","uuidv4","uploadToken","takenOn","convertJSDatetoTimestamp","Date","getExif","dataUrl","console","log","exif","exifDateTime","exifGPS","foundIdx","indexOf","length","newData","slice","exifParser","create","Buffer","from","parse","err","DateTimeOriginal","String","GPSLatitude","isNumeric","GPSLongitude","e","error","__webpack_require__","d","formatDate","formatDatAgo","timestampToHTML5Input","HTML5InputToTimestamp","moment__WEBPACK_IMPORTED_MODULE_0__","moment__WEBPACK_IMPORTED_MODULE_0___default","n","utctimestamp","format","arguments","undefined","moment","fromNow","jsDate","utc","isoStr","debounce","num","isNaN","parseFloat","isFinite","func","wait","immediate","timeout","_len","innerArgs","Array","_key","context","callNow","clearTimeout","setTimeout","apply","addLocaleData","frLocaleData","React","createContext","IntlWrapper","_ref","children","react_default","a","createElement","index_es","locale","photoSummaryFragment","gql","_templateObject","photoSummaryKeys","userSummaryFragment","_templateObject2","seriesSummaryFragment","_templateObject3","seriesSummaryKeys","seriesFragment","_templateObject4","seriesKeys","photoFragment","_templateObject5","userFragment","_templateObject6","allSeries","queries_templateObject","pollQuery","queries_templateObject2","userSeries","queries_templateObject3","seriesFromList","queries_templateObject4","queries_templateObject5","seriesWithTag","queries_templateObject6","tagSearch","_templateObject7","geoSeriesIdOnly","_templateObject8","_templateObject9","getUser","_templateObject10","geocode","_templateObject11","getMyFeed","_templateObject12","userSearch","_templateObject13","getWholeSeries","_templateObject14","getNewS3Credentials","_templateObject15","typography","useNextVariants","overrides","MuiDialog","paper","@media (max-width:321px)","margin","paperFullWidth","width","colors","home","palette","primary","main","secondary","text","fade","series","lighten","topbar","bottombar","login","background","themes","createMuiTheme","AppContext","useAuthCommon","containerRef","useRef","handleKeyPress","event","current","found","getElementsByClassName","click","useEffect","document","addEventListener","removeEventListener","RawSVG","Fragment","createSvgIcon","useStyles","makeStyles","theme","root","height","bgSwoosh","position","top","left","zIndex","spacer","flex","logo","minHeight","inner","minWidth","maxWidth","display","flexDirection","textAlign","AuthContainer","classes","ThemeProvider","ref","className","CssBaseline","AppLogo","Typography","variant","Loading","message","auth_AuthContainer","ErrorBoundary","props","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","state","hasError","info","_this$state","FallbackUI","fallback","Component","SEND_STATES","overflow","padding","spacing","color","border","button","icon","opacity","flexGrow","stack","marginBottom","fontSize","whiteSpace","fontFamily","ErrorScreen","sendState","reportError","_useState","useState","_useState2","slicedToArray","dlgOpen","setDialogOpen","_useState3","_useState4","note","setNote","stackEl","buttonText","disabled","Error_default","Button","onClick","BugReport_default","Dialog","open","fullWidth","onClose","aria-labelledby","DialogTitle","DialogContent","DialogContentText","TextField","autoFocus","multiline","onChange","target","value","rowsMax","placeholder","label","DialogActions","deletePhoto","mutations_templateObject","deleteSeries","mutations_templateObject2","updateSeries","mutations_templateObject3","updateSeriesKeys","updatePhoto","mutations_templateObject4","updatePhotoKeys","createPhoto","mutations_templateObject5","newPhotoKeys","createSeries","mutations_templateObject6","newSeriesKeys","watchSeries","mutations_templateObject7","unWatchSeries","mutations_templateObject8","reportBug","mutations_templateObject9","withReportBugMutation","graphql","mutate","_ref$ownProps","ownProps","reduxState","setState","reportJSON","errObj","env","process","toString","variables","update","store","_ref2","data","connect","map","other","uploader","objectWithoutProperties","newMap","objectSpread","Wrapped","assign","src_mapStyles","toolTip","Icon","SatelliteOutlined","ActiveIcon","SatIcon","style","Satellite","TerrainOutlined","Terrain","TopoMap","tagColors","mapConfig","mapBoxToken","styles","MapStyles","baseurl","REACT_APP_BASEURL","Offline","seriesImgsToCache","highestOfflineTileZoom","maxMapTileArea","AppStateTypes","FEED","MAP","SEARCH","PROFILE","SERIES","QRCAPTURE","NEW_SERIES_CAMERA","NEW_SERIES_LIBRARY","OFFLINE_DOWNLOAD","SEARCH_TABS","TAG","LOCATION","USER","MapModeTypes","FREE","endpoints","aws","Auth","region","userPoolId","userPoolWebClientId","mandatorySignIn","cookieStorage","domain","expires","secure","ACCESS","OPEN","description","green","PRIVATE","red","PUBLIC","blue","getWholeSeriesUpdate","query","qVal","readQuery","_","cloneDeep","warn","writeQuery","getWholeSeriesPhotoUpdate","remove","seriesId","photos","ph","idx","toConsumableArray","updateSeriesSummaries","origArr","newArr","s","newAllSeriesEntry","pick","seriesStatus","__typename","allSeriesUpdate","limit","seriesSummaries","nextToken","allSeriesPhotoUpdate","newS","latest","featured","photoSummary","userSeriesUpdate","feedUpdate","myFeed","feed","window","fItem","fitem","_id","newSeriesSummary","newPhotoSummary","relation","updateFeedList","watchUpdate","user","watching","sid","Set","withMutation","createSeriesMutation","_createSeriesMutation","asyncToGenerator","regenerator_default","mark","_callee","newSeries","ext","_ownProps$user","gravatar","gravatarProfile","username","meUserSummary","optimisticResponse","mutationStackId","wrap","_context","prev","next","access","createOptimisticResponse","pushMutationPromise","sent","abrupt","updateThunk","doneCreatingSeries","then","popMutationPromise","stop","_x","_x2","_x3","cb","_ref3","photoResponse","createdOn","now","createdUser","updatedUser","createdBy","updatedBy","updatedOn","seriesCreatedBy","coords","paths","base","large","orig","thumb","medium","photoResponseSummary","name","direction","photoCount","watchers","preAuth","mutations_createSeries","localforage","storeName","imgStore","createInstance","stateStore","OFFLINEMUTATIONS","getPendingPromise","getItem","mutations","setPendingPromise","setItem","params","mutation","pm","proxyUpdateForId","proxy","resp","updateHandler","__optimistic","Promise","resolve","restoreRequests","client","forEach","pendingMutation","Amplify","configure","LOCAL_STORAGE_TOKEN","APOLLOSTATES","INITIALIZING","AUTHENTICATING","LOADING","APPLY_MUTATIONS","ERROR","DONE","useGraphQL","setClient","done","setDone","_useState5","_useState6","currState","setCurrState","createApolloClient","newClient","newState","getCurrentToken","currSession","currentSession","accessToken","jwtToken","t0","_callee3","cache","authLink","httpLink","retry","apolloClient","_context3","InMemoryCache","persistCache","storage","setContext","_callee2","headers","token","newHeaders","_context2","authorization","createHttpLink","uri","RetryLink","attempts","max","Infinity","retryIf","_operation","ApolloClient","link","ApolloLink","tokenName","addTypename","connectToDevTools","auth_style","forgotPassword","switch","switchButton","&:last-child","borderRadius","&:first-child","phoneNumInner","marginTop","phoneNumDropdown","warnText","fontStyle","noSignin","SignIn","loading","handleSignup","handleForgotPassword","federated","handleInputChange","handleBeAnonymous","handleSignIn","textField","autoComplete","Toolbar","disableGutters","component","size","ConfirmSignIn","handleBack","handleConfirm","RequireNewPassword","change","requiredAttributes","placeholders","attribute","SignUp","signUpFields","signUpFieldLabels","signUpFieldPlaceholders","countryDialCodes","defaultDialCode","selectVal","setSelectVal","handleDialCodeChange","field","f","FormControl","InputLabel","htmlFor","shrink","required","Select","inputProps","dialCode","ConfirmSignUp","handleResend","Link","resendCode","ForgotPassword","handleSubmit","handleSendCode","setSent","defaultAuthState","authState","authData","signedIn","useAuthentication","_useState2$","setAuth","authScreen","dist","onStateChange","hideDefault","useAuthentication_SignIn","useAuthentication_Loading","useAuthentication_RequireNewPassword","useAuthentication_ConfirmSignIn","useAuthentication_ConfirmSignUp","useAuthentication_ForgotPassword","useAuthentication_SignUp","isGod","signInUserSession","idToken","payload","signOut","catch","forceSignIn","newProps","changeState","signIn","auth_SignIn","SignInOrig","_this2","hide","includes","checkCustomSignUpFields","signUpConfig","sortFields","getDefaultDialCode","I18n","get","signUp","auth_SignUp","SignUpOrig","_this3","confirm","auth_ConfirmSignIn","ConfirmSignInOrig","_this4","resend","auth_ConfirmSignUp","ConfirmSignUpOrig","challengeParam","isArray","split","part","charAt","toUpperCase","substr","toLowerCase","join","auth_RequireNewPassword","RequireNewPasswordOrig","auth_Loading","LoadingOrig","_this5","send","submit","auth_ForgotPassword","ForgotPasswordOrig","useGeolocation","accuracy","altitude","altitudeAccuracy","heading","latitude","longitude","speed","timestamp","mountedRef","watchIdRef","onEvent","navigator","geolocation","getCurrentPosition","watchPosition","clearWatch","isIos","test","userAgent","vendor","opera","content","messageWrapper","contrastText","boxShadow","animation","@keyframes installPulse","0%","50%","100%","textWrapper","paddingLeft","buttons","InstallPrompt","onInstall","Snackbar","anchorOrigin","vertical","horizontal","Paper","elevation","paragraph","useShowAddToHome","showInstall","dismissInstall","deferredPrompt","setPrompt","handleBeforePrompt","preventDefault","installPrompt","useMemo","misc_InstallPrompt","addToHomeScreen","prompt","userChoice","choiceResult","outcome","standalone","useOnline","onLine","newDate","online","offlineSince","getState","_window","orientation","innerWidth","innerHeight","_window$screen","screen","wOrient","bIsIos","bIsPhone","isPhone","windowSize","screenSize","activeElement","tagName","useResponsive","mediaQueries","handleResizeDebounced","useCallback","stopPropagation","useLayoutEffect","Actions","actions","newDomain","initialPhoto","flagName","flagVal","viewport","bVal","viewportSave","uploadObj","newProgress","mapInit","mode","zoom","homeInit","history","initState","activeUpload","defaultFlags","iOSWarning","install","useLoggedOut","offlineInit","completedDownload","combineReducers","action","newStateHistory","newCurrentState","pop","activeSeries","newParams","newHistory","newStore","newActive","flags","defineProperty","offline","persistConfig","persistedReducer","persistReducer","rootReducer","storeConfig","preloadedState","createStore","compose","applyMiddleware","thunk","persistor","persistStore","withReduxProvider","BaseComponent","_storeConfig","es","integration_react","msgText","messageInner","UploadControl","progress","classNames","LinearProgress","UploadControlCOSMOSWrapper","useWrapperStyles","displayName","updateUploadProgress","completeActiveUpload","restartUpload","formData","file","FormData","fields","fieldkey","substring","append","Content-Type","onUploadProgress","progressEvent","loaded","total","Math","floor","axios","post","url","t1","removeItem","t2","t3","interceptors","request","use","reject","response","NewS3Credentials","skip","qItem","onDone","s3Credentials","options","_ref4","photoId","withGetNewS3Credentials","dispatch","uploadingRef","setQItem","useContext","newS3","_x4","_doUpload","s3Upload","components_UploadControl","permissions","admin","create:own","read:any","update:any","delete:any","create:any","nonuser","series_public","series_open","read:own","update:own","delete:own","deleteSeriesMutation","_deleteSeriesMutation","mutations_deleteSeries","updateSeriesMutation","_updateSeriesMutation","seriesDelta","createdSeries","mutations_updateSeries","deletePhotoMutation","_deletePhotoMutation","mutations_deletePhoto","createPhotoMutation","_createPhotoMutation","newPhotoInput","mutations_createPhoto","updatePhotoMutation","_updatePhotoMutation","photoDelta","newUpdatePhoto","t","newT","mutations_updatePhoto","watchSeriesMutation","_watchSeriesMutation","watch","unWatchSeriesMutation","_unWatchSeriesMutation","unwatch","SeriesContext","title","qrPaper","qrCode","QRDisplay","qrCodeEl","setQRCodeEl","obj","encodedId","encodeURI","QRCode","svgStr","dangerouslySetInnerHTML","__html","x","y","pulseCol","light","fab","&::before","animationIterationCount","animationTimingFunction","@keyframes fabPulse","90%","directionUp","actionsClosed","modalContainer","bottom","transformOrigin","transform","subFabContainer","subFab","subFabIcon","AddFab","onCameraClick","onLibraryClick","setOpen","down","setDown","timerRef","downRef","elRef","onDown","currentTarget","block","rootContainer","Fab","onMouseDown","onTouchStart","disableFocusRipple","disableTouchRipple","disableRipple","aria-label","Modal","aria-describedby","Zoom","in","unmountOnExit","PhotoLibrary_default","AddAPhoto_default","ContextMenu","anchorEl","menuItems","Menu_Menu","divider","Divider","MenuItem","ListItemIcon","ListItemText","primaryTypographyProps","tagChips","marginRight","deleteIcon","chipAvatar","TagChip","edit","tag","onDelete","useTheme","Chip","getContrastText","Cancel_default","ShortLongText","FormLabel","formLabel","defaultProps","imgContainer","gravatarImg","objectFit","UserListItem","onAvatarClick","ListItem","ListItemAvatar","Avatar","alt","src","body","paddingBottom","alignSelf","dlgTitle","closeButton","BigText","scroll","disableTypography","IconButton","Close_default","DIALOGS","backgroundColor","list","numPhotos","tagListItem","chip","SeriesInfo","_useContext","seriesConfigInst","SeriesConfigClass","activeDialog","setActiveDialog","newTags","existing","count","metaKeys","controls_ShortLongText","List","dense","controls_UserListItem","tagKey","idtk","subheading","values","tags_TagChip","render","dialogs_BigText","getSize","el","minSize","defaultSize","offsetWidth","offsetHeight","useComponentSize","resizeActiveRef","resizeActive","setResizeActive","setComponentSize","handleResize","newSize","ResizeObserver","resizeObserver","observe","disconnect","xyTagChip","cursor","editing","reversedChip","right","chipAvatarIcon","reversedDelete","chipBucket","reversedChipBucket","XYTagChip","onTagDragOver","onTagDragStop","onTagDelete","onNewTag","isReversed","relCoords","newWidth","stopBadness","react_draggable_default","bounds","newHeight","onDrag","onStop","avatar","MyLocation_default","noOptionsMessage","singleValue","input","valueContainer","flexWrap","alignItems","XYTagSelect","tagConfig","tc","allowAdditions","react_select_esm","components","Control","Menu","NoOptionsMessage","Option","Placeholder","ValueContainer","blurInputOnSelect","isClearable","isSearchable","Creatable_default","InputProps","inputComponent","selectProps","inputRef","innerRef","innerProps","textFieldProps","square","_ref5","isFocused","isSelected","buttonRef","selected","fontWeight","_ref6","header","listItem","dlgBody","paddingRight","grey","XYTagChooser","xyTags","fullScreen","paperScrollPaper","tagType","tags_XYTagSelect","Tags","findTagById","tagId","getXYTags","xyTagIds","getNonXYTags","NonXYTagIds","createNewTagObj","createExistingTagObj","createNewXYTagObj","createExistingXYTagObj","getRelXYTags","multiplier","group","useXYTags","isDragging","setIsDragging","newTagDialog","setNewTagDialog","tagClass","addTag","__isNew__","updateTagLocation","oldTag","newX","parseInt","newY","onAddTagTrigger","pageX","pageY","TagChooser","tags_XYTagChooser","Boolean","circularProgress","BrokenImg","CircularProgress","BrokenImage_default","img","imgBroken","RawImage","getPhotoUrls","sizePriority","imgRef","cover","imgUrls","setImgUrls","altImgRef","altIndex","setAltIndex","broken","setBroken","finalURl","subViews_BrokenImg","onError","brokenImg","formControl","showTags","transition","refImgWrap","setNewSize","_useComponentSize","_useComponentSize$siz","_useXYTags","_imgRef$current","naturalHeight","naturalWidth","min","handleNewSize","tags_XYTagChip","subViews_RawImage","rawImage","photoWrapper","dateCaption","dark","mobileStepper","manualBack","manualForward","tagButton","slideshowButton","dots","SwipeShow","onImageSelect","initPhotoIndex","p","activePhoto","setActivePhoto","setShowTags","singular","sortedPhotos","sort","b","react_swipeable_views_lib_default","axis","index","onChangeIndex","val","enableMouseEvents","subViews_Photo","KeyboardArrowRight_default","KeyboardArrowLeft_default","GridListTileBar","subtitle","actionIcon","Badge","badgeContent","Label_default","MobileStepper","steps","activeStep","isFullScreen","slides","DeleteDialog","onConfirm","disableBackdropClick","disableEscapeKeyDown","tile","addFab","notDeleteable","unSelectedTile","& img","selectedTile","snackbarContent","snackbar","PhotoGrid","columns","multiSelect","onTileClick","selectMode","setSelectMode","selectedItems","setSelectedItems","urls","setUrls","_useState7","_useState8","deleteConfirm","setDeleteConfirm","ac","handleCancelSelection","toggleListItem","remaining","arrId","t4","t5","t6","t7","t8","t9","GridList","cols","cellHeight","canDelete","canUser","GridListTile","handlePhotoTap","handleAddToSelection","Remove_default","Add_default","autoHideDuration","ContentProps","dialogs_DeleteDialog","confirmation","SeriesView_style","appBar","overflowY","-webkit-overflow-scrolling","tabMenu","mapWrap","toolbarTitle","textOverflow","grow","gridList","titleBar","menuButton","placeholderInner","progressWrapper","placeholderText","SeriesView","onSlideshowStart","onEditSeries","onDeletePhotos","onCameraAdd","onDeleteSeries","onLibraryAdd","onMenuBack","onWatch","onUnWatch","onFindOnMap","owned","contextEl","setContextEl","showQR","setShowQR","listTypeTab","setListTypeTab","can","delete","contribute","dialogOpen","AppBar","ArrowBack_default","aria-haspopup","MoreVert_default","controls_ContextMenu","PlaceIcon","AddAlertIcon","QRCodeIcon","SlideshowIcon","EditIcon","DeleteIcon","Tabs","Tab","subViews_SwipeShow","subViews_SeriesInfo","subViews_PhotoGrid","controls_AddFab","views_QRDisplay","svgDot","svgAccuracyDot","MyLocation","projection","accHeight","pixelsPerMeter","accWidth","version","viewBox","cx","cy","r","stroke","fillOpacity","strokeWidth","fill","speedDialFab","speedDialAction","speedDialIcon","speedDialLabel","StyleButtons","controlPadding","currStyle","mapStyles","setCurrStyle","noEventSetOpen","SpeedDial","ariaLabel","speedDial","SpeedDialAction","tooltipPlacement","ButtonProps","TooltipClasses","tooltip","tooltipTitle","tooltipOpen","MyLocationButton","BaseMap","myPosition","showMe","initViewport","lockToBounds","lockPan","initStyle","incomingOnViewportChange","onViewportChange","incomingOnTransitionStart","onTransitionStart","incomingOnTransitionEnd","onTransitionEnd","transitions","onMapDataEvent","stylechooser","passthroughProps","mapContainerRef","mapBoxRef","innerTransitionsRef","defaultViewVals","setViewport","isTransitioning","setIsTransitioning","setProjection","geoMarker","esm","captureDrag","markers_MyLocation","getDistanceScales","viewportChange","newViewport","getMap","_bounds","minlng","minlat","maxlng","maxlat","_fitBounds","WebMercatorViewport","fitBounds","offset","mapStyle","onData","dragPan","mapboxApiAccessToken","c","cloneElement","handleChild","controls_StyleButtons","hideNavControls","showZoom","touchZoom","scrollZoom","showCompass","touchRotate","dragRotate","controls_MyLocationButton","transitionDuration","transitionInterpolator","FlyToInterpolator","transitionEasing","easeCubic","bearing","pitch","child","rootActive","dot","directionIndicator","textShadow","nameActive","Single","svgArc","strokeOpacity","BaseStaticMap","mapRef","recalcProjection","MapDot","staticMap","editable","Map","mapProps","Dot","dlgContent","mapWrapper","sliderWrapper","slider","sliderRoot","MapDirPicker","onOk","onCancel","initLat","initLong","initDir","setCoords","setRotation","maps_MapDot","_ref2$viewport","mapFormLabel","Slider","step","textArea","BigTextEdit","setValue","rows","defaultValue","accessRadio","marginLeft","mapInnerWrap","chips","SeriesEditInner","delta","FormControlLabel","control","Switch","checked","dialogs_MapDirPicker","dialogs_BigTextEdit","newNote","SeriesEdit","setDelta","subViews_SeriesEditInner","swipeAble","slideContainer","slide","dotActive","iconButton","active","last","tagContainer","labelBadge","tagChip","Slideshow","_useStepper","useStepper","lastStep","handleForward","paused","pause","play","showXYTags","setShowXYTags","duration","titlePosition","PlayCircleFilled_default","PauseCircleFilled_default","nextButton","backButton","interval","setActiveStep","setPaused","setLastStep","createTimer","setInterval","oldStep","destroyTimer","clearInterval","CancelConfirm","TagControl_style","actionButtons","TagControl","tagValues","fieldTitle","rootEdit","textBody","DateControl","hint","onSelectChange","inputValue","removedValue","option","newVal","tcv","newCreateVal","v","selectOptions","remainingTags","deleteRemoves","isMulti","onTouchEnd","_ref7","_ref8","_ref9","TagEdit","controls_TagControl","DateView","dlgTitleContainer","catTagTitle","paddingTop","PhotoInfo","canEdit","activeDialogContext","tagInst","TagClass","controls_DateControl","controls_DateView","TagView","dialogs_TagEdit","dirty","PhotoInfoInner","newDelta","dialogs_CancelConfirm","appBarEdit","tipChip","activeButton","STATES","PhotoViewTool","initPhotoId","onUpdatePhoto","setMode","tagsClass","changeMode","desired","onCommitTags","infoButton","Info_default","containerStyle","photoidx","subViews_PhotoInfo","sliderLabel","rail","track","PhotoFadeSlider","setSlider","captured","reference","libraryFab","@media (orientation: landscape)","@media (orientation: portrait)","swipeDrawer","referenceTextContainer","newText","refText","PhotoReviewTool","defaultRefPhotoId","onRetry","newRefPhoto","refPhoto","setRefPhoto","drawerOpen","setDrawerOpen","controls_PhotoFadeSlider","buttonFab","disabledFab","libraryIcon","SwipeableDrawer","anchor","paperAnchorLeft","onOpen","tabIndex","swipeDrawerContainer","role","onKeyDown","useCamera","onCapture","cameraError","setCameraError","cameraOnline","setCameraOnline","camRef","Webcam","getElementById","setup","destroy","captureImage","capturedData","takeDataURLPhoto","quality","captureRawData","takeImageData","webcamElement","canvasElement","location","protocol","hostname","mediaDevices","getUserMedia","aspectRatio","srcObject","getTracks","audio","video","facingMode","mediaStream","URL","createObjectURL","onloadedmetadata","onplaying","imageWidth","videoWidth","imageHeight","videoHeight","getContext","drawImage","_this$_drawImage","_drawImage","getImageData","_this$_drawImage2","toBlob","fileBlob","_this$_drawImage3","toDataURL","cameraErrorText","cameraFab","cameraIcon","cancelFab","cancelIcon","myLocationFab","myLocationIcon","CameraTool","onShutter","setSize","_useCamera","autoPlay","playsInline","muted","Camera_default","NewPhotoInfo","onSave","setSeriesDelta","setPhotoDelta","newAttr","useFileInput","preferCamera","initialClick","anyFile","clickRef","element","accept","capture","handleChange","evt","files","reader","FileReader","onloadend","result","getExtFromFile","readAsDataURL","fileClickEl","forceClick","LibraryFilePicker","cameraPicker","_useFileInput","cameraWords","PhotoLibraryIcon","CameraAltIcon","Series","MODES","NewPhoto","inputMethod","onCreate","isNewSeries","geoRef","newPhotoData","setNewPhotoData","SeriesClass","setNewSeries","PhotoClass","setNewPhoto","photoRefId","setPhotoRefId","_useState9","_useState10","_changeMode","absolute","alpha","beta","gamma","deviceOrientation","setDeviceOrientation","handleDeviceOrientation","useDeviceOrientation","geo","newModeName","_getExif","date","_geoRef$current","_newPhoto","rawData","sensors","views_CameraTool","refId","_getExif2","_geoRef$current2","controls_LibraryFilePicker","views_PhotoReviewTool","oldHistory","oldMode","views_NewPhotoInfo","AccessHelper","userSub","permissionObj","ownOrAny","isOwner","attrs","ownAny","perm","otherPerm","attributes","granted","AccessControl","sub","SeriesNotFound","SeriesLoading","thickness","VIEW_ONLY_MODES","RepeatablePhotos","modeName","inputMethodINIT","currentUserId","currentUserRole","accessControl","onNewSeries","onChangePhoto","onNewPhoto","onDeletePhoto","AccesHelper","seriesState","pid","onApprovePhoto","newPid","newInputMethod","canUpdate","to","lastMode","views_SeriesLoading","views_SeriesNotFound","views_SeriesView","photoIdArr","sp","views_SeriesEdit","views_PhotoViewTool","views_Slideshow","views_NewPhoto","Provider","withGetSelectedQuery","connectedWithApollo","onAfterSeriesDelete","onBack","queueUpload","currentUser","INPUT_MODES","getValues","PhotoSeries","_x6","_x5","_state$home$current","useClusteredData","filterBounds","currentZoom","sizeScale","queryVersion","clusteredData","setClusteredData","single","cluster","filteredData","setFilteredData","setVersion","updateDataDebounce","updatedData","_args","updateData","filterDataDebounce","filtered","_args2","filterData","filteredClusteredData","tree","rbush","screenCoords","project","properties","zoomLevels","geoJSON","point","clear","load","_loop","z","radius","sqrt","pow","neighbors","search","minX","minY","maxX","maxY","neighbor","newGeoJSON","centroid","featureCollection","uuid","reducedPhotoCount","points","newZ","geometry","coordinates","push","Apple","FeatureDisabled","IconComp","AppleIcon","PaperProps","drawerInner","disableListItem","fullList","SideDrawer","onDisabledClick","onAboutClick","onQRClick","onOfflineMenuClick","AccountCircle_default","loginButton","MobileScreenShare_default","CloudDownload_default","ExitToApp_default","dialogContent","iconContainer","& path","stop1","stopColor","stop2","buttonIcon","scrollText","overflowX","AboutApp","Container","focusable","aria-hidden","x2","y2","href","Email_default","borderBottom","searchIcon","transparent","iOsIcon","transparentLogo","transparentLogoIcon","qrButton","qrButtonTransparent","TopBar","isTransparent","hideLogo","AppLogoSimple","components_SideDrawer","misc_FeatureDisabled","components_AboutApp","components_TopBar","TopBar_TopBar","useSearchBarStyles","shape","common","white","&:hover","breakpoints","up","inputRoot","inputInput","pointerEvents","justifyContent","SearchInput","debounceSearchText","blur","Search_default","InputBase","onBlur","chipContainer","accessLabel","accessPUBLIC","accessPRIVATE","accessOPEN","verticalAlign","textSm","titleText","dateContainer","dateLabel","dateText","imgFiller","imgContainerSm","SeriesListItem","showCreatedOn","showLastPhoto","small","misc_SeriesListItem","listItemText","compoundButton","ClusterSelected","seriesCount","onZoomTo","onViewList","ZoomOutMap_default","ViewList_default","ViewListDialog","seriesList","onSelect","disablePadding","&.PUBLIC","&.PRIVATE","&.OPEN","avatarActive","badge","badgeActive","Cluster","numeral","& .myPosMarker","& .singleMarker","& .clusterMarker","topBar","loadingWrapper","zoomOutFab","selectedPopup","defaultView","HomeMap","onSeriesNavigate","onSeriesMapSelect","onSearchClick","pushMapHistory","popMapHistory","clearMapHistory","mapViewObj","setMapViewObj","mapViewRef","homeMapContainerRef","setCurrentZoom","showViewList","setShowViewList","setTransitions","_useState11","_useState12","selectedItem","setSelectedItem","bufferPts","buffer","units","bbox","updateSelectedItem","item","delay","saveObj","transitionInterruption","maxZoom","minZoom","maxPitch","minPitch","saveMap","object","pts","paddedPoint","lngBuff","latBuff","buffBounds","onMarkerClick","LinearInterpolator","markersRendered","offsetLeft","offsetTop","markers_Single","markers_Cluster","selectedItemRender","misc_ClusterSelected","Search_SearchInput","components_maps_BaseMap","viewZoom","getBounds","_map$getBounds","_map$getBounds$_sw","_sw","minLng","lng","minLat","lat","_map$getBounds$_ne","_ne","maxLng","maxLat","oldMinLng","oldMinLat","oldMaxLng","oldMaxLat","onNativeClick","misc_ViewListDialog","POLL_INTERVAL","withAllSeries","fetchMore","updateQuery","fetchMoreResult","setSeriesProps","readyForPolling","withPollQuery","lastCheck","_ref5$ownProps","seriesProps","updateIncrement","changedSeries","oldList","newSeriesSummaries","polledSeries","ds","oldSeries","oldId","AllSeriesConnect","PollQueryConnect","mapFuncs","tab","setLastCheck","allSeriesQUERY","pollSeriesQUERY","maps_HomeMap","chosenItem","closeIcon","avatarImg","SearchContextItem","TheIcon","LabelIcon","PersonIcon","Search_SearchContextItem","listSection","ul","SearchContextResults","contextResults","setContextChoice","cr","SearchEnder","ctxItem","SearchResults","contextChoice","onResultClick","listRef","enderRef","handleScroll","_listRef$current","scrollTop","Search_SearchEnder","subheader","onScroll","SearchPlaceholder","PlaceholderIcon","TABS","tabs","ListWrapper","Search","currentTab","setCurrentTab","defaultText","searchText","setSearchText","searchResults","onMapClick","Search_SearchResults","Search_SearchContextResults","Search_SearchPlaceholder","PortableWifiOffIcon","indicatorColor","flexContainer","centered","TAGS","withTagSearch","ceil","withUserSearch","searchStr","withGeoCode","geocoder","_ref10","relevance","placeName","center","_ref11","_ref12","withTagSeries","_ref13","tagSeries","_ref14","_ref15","_ref16","withUserSeries","_ref17","_ref18","_ref19","_ref20","defaultTab","jumpToSeries","jumpToMap","_ref21","bboxFunc","withContextQuery","withSearchQuery","ComposedSearch","newContextChoice","newTab","MeCard","filterContainer","filterChip","seriesListItemWrap","noneFound","SORT","MyProfile","mySeries","watchingSeries","sortVal","setSort","sortAsc","setSortAsc","sortSetter","newSort","tabFeed","firstname","MyProfile_MeCard","MyProfile_FilterSortItem","asc","useFilterStyles","FilterSortItem","arrow","withuserSeriesQuery","seriesQ","withMyWatchedSeriesQuery","watchedSeriesQ","queryWrapped","arraySeries","components_MyProfile_MyProfile","FeedEnder","placeAvatar","placeIcon","FindOnMapButton","Place_default","findOnMapButtonContainer","titleContainer","seriesName","EVENT_VERBS","FeedItem","onImageClick","onProfileClick","onSeriesClick","misc_FindOnMapButton","listContainer","vList","feedContainer","MyFeed","events","fetchNewest","dist_es","rowCount","rowHeight","rowRenderer","isScrolling","isVisible","parent","row","MyFeed_FeedItem","wEnd","MyFeed_FeedEnder","almostAtEnd","ROWHEIGHT","withFeedQuery","loadingNewest","loadingMore","start","end","jumpToUser","components_MyFeed_MyFeed","rectContents","black","areaLabel","rectContentsDownloading","rectIcon","tooBig","tickText","svgRect","svgCutout","svgBorder","svgBorderNavigating","svgBorderLocked","svgBorderTooBig","svgBorderDownloading","downloadingProgress","downloadingProgressCircle","snackError","OfflineMap","toolState","onStartDownload","onUnlock","onCancelComplete","mapWrapperRef","setBounds","viewState","area","setArea","classWithState","setGeoState","rectSide","newArea","abs","metersPerPixel","dx","degreesPerPixel","dy","newBounds","snack","onSnackClose","snackTimeout","SnackbarContent","unlocked","doubleClickZoom","rectStyle","boxCorners","totalProgress","tileTick","seriesTick","seriesPhotoTick","CheckCircleOutline_default","Lock_default","SignalWifiOff_default","xmlns","fillRule","withGeoSearch","seriesInGeoBounds","setSeriesIds","ids","WholeSeriesConnect","GeoQuery","lastMapViewport","_state$offline","setOfflineCompleted","setOfflineViewport","setToolState","limiterRef","seriesIds","activeSeriesId","setActiveSeriesId","seriesPhotos","setSeriesPhotos","setTileTick","_useState13","_useState14","setSeriesTick","_useState15","_useState16","setSeriesPhotoTick","tileTickRef","onTileTick","onSeriesPhotoTick","onSeriesTick","theTick","theIds","thePhotos","addCount","schedule","makeRequest","finalState","geoSeriesQuery","wholeSeriesQuery","dropWaitingJobs","Bottleneck","maxConcurrent","tiles","zoomRange","xtileLeft","long2tile","xtileRight","ytileTop","lat2tile","ytileBottom","getTileURL","getTiles","newTotal","maps_OfflineMap","method","xhr","XMLHttpRequest","onload","status","statusText","onerror","replace","qrIcon","backupText","manualImg","tipPaper","docContainer","cameraContainer","cameraContainerError","snackErr","snackSuccess","snackMsg","QRReader","capturedBlob","setCapturedBlob","setErr","code","setCode","captureFunc","scan","scannedCode","decodedUrl","jsQRFromBlob","decodeURI","jsQR","OfflineBar","sinceStr","setSinceStr","calcSinceStr","clearTimer","homeConfig","borderTop","BottomBar","onHomeClick","edge","HomeOutlined_default","MapOutlined_default","SearchOutlined_default","PersonOutline_default","components_BottomBar","outerRoot","offlineBar","activeWrapper","flexShrink","uploaderContainer","App","onQRCapture","setHomeState","showBottomBar","activeProps","ActiveComponent","FeedConnect","MapConnect","ProfileConnect","SearchConnect","SeriesConnect","misc_OfflineBar","Uploader_connect","setUseOffline","_useAuthentication","_useGraphQL","apolloDone","apolloState","_useOnline","_useShowAddToHome","responsive","appContext","_getPhotoUrls","react_apollo_esm","translations_IntlWrapper","lib_ErrorBoundary","ErrorConnect","isLocalhost","match","registerValidSW","swUrl","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","require","ReactDOM","App_connect","origin","fetch","contentType","ready","unregister","reload","checkValidServiceWorker"],"mappings":"qHAAMA,EAEI,SAFJA,EAIG,QAiCMC,IA9Bb,SAAAA,EAAaC,GAAc,IAAAC,EAAAC,KACzB,GADyBC,OAAAC,EAAA,EAAAD,CAAAD,KAAAH,GAAAG,KAK3BG,WAAa,SAACC,GAAD,OAAYL,EAAKM,OAAOC,KAAKC,KAAK,SAAAC,GAAE,OAAIA,EAAGC,KAAOL,KALpCJ,KAO3BU,gBAAkB,SAACN,GAEjB,OAAOL,EAAKM,OAAOC,KAAKK,UAAU,SAAAH,GAAE,OAAIA,EAAGC,KAAOL,KATzBJ,KAY3BY,cAAgB,kBAAMb,EAAKM,OAAOC,KAAKO,OAAO,SAAAL,GAAE,OAAIA,EAAGM,WAZ5Bd,KAa3Be,iBAAmB,kBAAMhB,EAAKM,OAAOC,KAAKO,OAAO,SAAAL,GAAE,OAAIA,EAAGQ,cAb/BhB,KAe3BiB,cAAgB,kBAAMhB,OAAOiB,KAAKnB,EAAKM,OAAOc,MAC3CN,OAAO,SAAAO,GAAG,OAAIrB,EAAKM,OAAOc,KAAKC,GAAKC,OAASzB,IAC7C0B,OAAO,SAACC,EAAKH,GAAN,OAAAnB,OAAAuB,EAAA,EAAAvB,CAAA,GACHsB,EADGtB,OAAAwB,EAAA,EAAAxB,CAAA,GAELmB,EAAMrB,EAAKM,OAAOc,KAAKC,GAAKM,WAC3B,KApBqB1B,KAsB3B2B,aAAe,kBAAM1B,OAAOiB,KAAKnB,EAAKM,OAAOc,MAC1CN,OAAO,SAAAO,GAAG,OAAIrB,EAAKM,OAAOc,KAAKC,GAAKC,OAASzB,IAC7C0B,OAAO,SAACC,EAAKH,GAAN,OAAAnB,OAAAuB,EAAA,EAAAvB,CAAA,GACHsB,EADGtB,OAAAwB,EAAA,EAAAxB,CAAA,GAELmB,EAAMrB,EAAKM,OAAOc,KAAKC,GAAKM,WAC3B,MA1BC5B,EAAc,MAAM,IAAI8B,MAAM,yDACnC5B,KAAKK,OAASP,uKCmBlB+B,EAAA,EArBE,SAAAC,EAAahC,EAAciC,GAAO,IAAAhC,EAAAC,KAAAC,OAAAC,EAAA,EAAAD,CAAAD,KAAA8B,GAAA9B,KAQlCgC,QAAU,WACRjC,EAAKoB,KAAOc,KAAKC,UAAUnC,EAAKM,OAAOsB,iBATP3B,KAYlCmC,SAAW,iBAAO,CAChB1B,GAAE,KAAA2B,OAAOC,OACTC,YAAaD,MACbE,QAASC,YAAyB,IAAIC,MACtCtB,KAAMc,KAAKC,UAAUnC,EAAKM,OAAOsB,gBACjCrB,KAAM,KAhBNN,KAAKK,OAAS,IAAIR,IAAaC,GACpBE,KAAK+B,MAAZA,GAEW/B,KAAKmC,YAmBjB,IAeMO,EAAU,SAACC,GACtBC,QAAQC,IAAI,yBAEZ,IAAIC,EAAO,KACPC,EAAe,KACfC,EAAU,KACd,IACE,IACMC,EAAWN,EAAQO,QADZ,qBACiCC,OACxCC,EAAUT,EAAQU,MAAMJ,GAE9BH,EADeQ,IAAWC,OAAOC,EAAOC,KAAKL,EAAS,WACxCM,QACdd,QAAQC,IAAI,WAAYC,GAE1B,MAAOa,GAELf,QAAQC,IAAI,aAAcc,GAE5B,GAAIb,GAAQA,EAAKxC,KAAM,CAErB,IACMwC,EAAKxC,MAAQwC,EAAKxC,KAAKsD,kBAAoBC,OAAOf,EAAKxC,KAAKsD,oBAC9Db,EAAec,OAAOf,EAAKxC,KAAKsD,mBAGpC,MAAOD,GACLf,QAAQC,IAAI,0BAA2B,CAAEc,MAAKb,SAGhD,IACMA,EAAKxC,KAAKwD,aAAeC,YAAUjB,EAAKxC,KAAKwD,cAAgBhB,EAAKxC,KAAK0D,cAAgBD,YAAUjB,EAAKxC,KAAK0D,gBAC7GhB,EAAU,CAACF,EAAKxC,KAAK0D,aAAclB,EAAKxC,KAAKwD,cAGjD,MAAOG,GACLrB,QAAQsB,MAAM,uDAGlB,MAAO,CAAEpB,OAAMC,eAAcC,gjwECnF/BmB,EAAAC,EAAAvC,EAAA,sBAAAwC,IAAAF,EAAAC,EAAAvC,EAAA,sBAAAyC,IAAAH,EAAAC,EAAAvC,EAAA,sBAAAW,IAAA2B,EAAAC,EAAAvC,EAAA,sBAAA0C,IAAAJ,EAAAC,EAAAvC,EAAA,sBAAA2C,IAAA,IAAAC,EAAAN,EAAA,KAAAO,EAAAP,EAAAQ,EAAAF,GASaJ,EAAa,SAACO,GAAkC,IAApBC,EAAoBC,UAAA3B,OAAA,QAAA4B,IAAAD,UAAA,GAAAA,UAAA,GAAX,OAChD,OAAOE,IAAOJ,EAAc,KAAKC,OAAOA,IAG7BP,EAAe,SAACM,GAC3B,OAAOI,IAAOJ,EAAc,KAAKK,WAetBzC,EAA2B,SAAC0C,GACvC,OAAOF,IACJG,IAAID,GACJL,OAAO,MAOL,SAASN,EAAuBK,GAErC,OAAOI,IAAOJ,EAAc,KAAKC,OAAO,oBAOnC,SAASL,EAAuBY,GACrC,OAAOJ,IAAO,IAAIvC,KAAK2C,GAAS,oBAAoBP,OAAO,gFCjD7D,SAAArB,GAAAW,EAAAC,EAAAvC,EAAA,sBAAAkC,IAAAI,EAAAC,EAAAvC,EAAA,sBAAAwD,IAAAlB,EAAA,SAEaJ,EAAY,SAAAuB,GACvB,IACE,OAAQC,MAAMC,WAAWF,KAASG,SAASH,GAE7C,MAAOrB,GACL,OAAO,IAgKJ,SAASoB,EAAUK,EAAMC,EAAMC,GAAW,IAAA7F,EAAAC,KAC3C6F,EAAU,KACd,OAAO,WAAkB,QAAAC,EAAAhB,UAAA3B,OAAd4C,EAAc,IAAAC,MAAAF,GAAAG,EAAA,EAAAA,EAAAH,EAAAG,IAAdF,EAAcE,GAAAnB,UAAAmB,GACvB,IAAMC,EAAUnG,EAEVoG,EAAUP,IAAcC,EAC9BO,aAAaP,GAEbA,EAAUQ,WAAW,WACnBR,EAAU,KACLD,GAEHF,EAAKY,MAAMJ,EAASH,IAErBJ,GACCQ,GAEFT,EAAKY,MAAMJ,EAASH,8MClL1BQ,YAAcC,KAEaC,IAAMC,cAAc,IAAxC,IAQMC,EAAc,SAAAC,GAAA,IAAGC,EAAHD,EAAGC,SAAH,OACzBC,EAAAC,EAAAC,cAACC,EAAA,EAAD,CAAcC,OAAO,MAClBL,soEChBE,IAAMM,EAAuBC,IAAHC,KAqBpBC,EAAmB,CAC9B,KACA,UACA,kBACA,YACA,YACA,WACA,cACA,SAGWC,EAAsBH,IAAHI,KAgBnBC,EAAwBL,IAAHM,IAuBhCP,EACAI,GAEWI,EAAoB,CAC/B,KACA,OACA,SACA,cACA,eACA,YACA,YACA,aACA,SACA,YACA,WACA,WACA,UAGWC,EAAiBR,IAAHS,IA4BzBV,EACAI,GAEWO,EAAa,CACxB,KACA,OACA,SACA,OACA,OACA,WACA,eACA,YACA,YACA,cACA,cACA,SACA,YACA,aACA,WACA,UAGWC,EAAgBX,IAAHY,IAsCxBT,GAoBWU,EAAeb,IAAHc,m7HC/LlB,IAAMC,EAAYf,IAAHgB,IAUpBX,GAGWY,EAAYjB,IAAHkB,IASpBb,GAGWc,EAAanB,IAAHoB,IAUrBf,GAYWgB,GATwBrB,IAAHsB,IAMhCjB,GAG4BL,IAAHuB,IASzBf,EACAG,IAGWa,GAAgBxB,IAAHyB,IAUxBpB,GAGWqB,GAAY1B,IAAH2B,KAwBTC,IAbY5B,IAAH6B,IAUpBxB,GAG6BL,IAAH8B,MAafC,GAAU/B,IAAHgC,IAMlBnB,GAGWoB,GAAUjC,IAAHkC,KAcPC,GAAYnC,IAAHoC,IAkBpB/B,EACAN,GAGWsC,GAAarC,IAAHsC,IAMrBzB,GAGW0B,GAAiBvC,IAAHwC,IASzBhC,EACAG,GAEW8B,GAAsBzC,IAAH0C,yBClL1BC,GAAa,CACjBC,iBAAiB,GAGbC,GAAY,CAEhBC,UAAW,CACTC,MAAO,CACLC,2BAA4B,CAC1BC,OAAQ,KAGZC,eAAgB,CACdF,2BAA4B,CAC1BG,MAAO,wBAMTC,GACC,UADDA,GAEE,UAFFA,GAGO,UAHPA,GAIQ,UAIRC,GAAO,CACXC,QAAS,CACPC,QAAS,CACPC,KAAMJ,IAERK,UAAW,CACTD,KAAMJ,IAERM,KAAM,CACJH,QAASH,GACTK,UAAWE,gBAAKP,GAAY,MAGhCT,cACAE,cAGIe,GAAS,CACbN,QAAS,CACPC,QAAS,CACPC,KAAMK,mBAAQT,GAAY,KAE5BK,UAAW,CACTD,KAAMJ,IAERM,KAAM,CACJH,QAASH,GACTK,UAAWE,gBAAKP,GAAY,MAGhCT,cACAE,cAIIiB,GAAS,CACbR,QAAS,CACPC,QAAS,CACPC,KAAMJ,IAERK,UAAW,CACTD,KAAMJ,KAGVT,eAGIoB,GAAY,CAChBT,QAAS,CACPC,QAAS,CACPC,KAAMJ,IAERK,UAAW,CACTD,KAAMJ,KAGVT,eAGIqB,GAAQ,CACZV,QAAS,CACPC,QAAS,CACPC,KAAMJ,IAERK,UAAW,CACTD,KAAMJ,IAERM,KAAM,CACJH,QAASH,GACTK,UAAWE,gBAAKP,GAAmB,KAErCa,WAAY,CACV3J,QAAS8I,GACTL,MAAOK,KAGXT,cACAE,cAGaqB,GAAA,CACbb,KAAMc,aAAed,IACrBW,MAAOG,aAAeH,IACtBJ,OAAQO,aAAeP,IACvBE,OAAQK,aAAeL,IACvBC,UAAWI,aAAeJ,KCtHfK,GAAa/E,IAAMC,cAAc,kCC8B/B+E,GA9BO,WACpB,IAAMC,EAAeC,mBACfC,EAAiB,SAACC,GACtB,GAAkB,UAAdA,EAAMzK,KACJsK,EAAaI,QACf,IACE,IAAMC,EAAQL,EAAaI,QAAQE,uBAAuB,eACtDD,GAASA,EAAM,IAAIA,EAAM,GAAGE,QAElC,MAAOhI,GACLrB,QAAQsB,MAAM,gCAAiCD,KAiBvD,OAZAiI,oBAAU,WACR,GAAIR,EAAaI,QAAS,CACxB,IACEK,SAASC,iBAAiB,WAAYR,GAAgB,GAExD,MAAO3H,GACLrB,QAAQsB,MAAM,2BAA4BD,GAE5C,OAAO,kBAAMkI,SAASE,oBAAoB,WAAYT,GAAgB,MAEvE,IAEIF,uBC1BIY,GAASxF,EAAAC,EAAAC,cAACF,EAAAC,EAAMwF,SAAP,KACpBzF,EAAAC,EAAAC,cAAA,QAAM5C,EAAE,+MACR0C,EAAAC,EAAAC,cAAA,QAAM5C,EAAE,gNACR0C,EAAAC,EAAAC,cAAA,QAAM5C,EAAE,iNACR0C,EAAAC,EAAAC,cAAA,QAAM5C,EAAE,wNACR0C,EAAAC,EAAAC,cAAA,QAAM5C,EAAE,sNACR0C,EAAAC,EAAAC,cAAA,QAAM5C,EAAE,sNAGKoI,QAAcF,GAAQ,qBCA/BG,GAAYC,aAAW,SAAAC,GAAK,MAAK,CACrCC,KAAM,CACJC,OAAQ,QAEVC,SAAU,CACRvC,MAAO,OACPsC,OAAQ,OACRE,SAAU,WACVC,IAAK,EACLC,KAAM,EACNC,OAAQ,GAEVC,OAAQ,CACNC,KAAM,UAERC,KAAM,CACJD,KAAM,UACN7C,MAAO,OACP+C,UAAW,IAEbC,MAAO,CACLlD,OAAQ,SACRE,MAAO,OACPsC,OAAQ,OACRW,SAAU,IACVC,SAAU,IACVC,QAAS,OACTC,cAAe,SACfC,UAAW,aAiCAC,GA7BO,SAAAjH,GAAkB,IAAfC,EAAeD,EAAfC,SACjB6E,EAAeD,KACfqC,EAAUrB,KAChB,OACE3F,EAAAC,EAAAC,cAAC+G,GAAA,EAAD,CAAepB,MAAOrB,GAAOF,OAC3BtE,EAAAC,EAAAC,cAAA,OAAKgH,IAAKtC,EAAcuC,UAAWH,EAAQlB,MACzC9F,EAAAC,EAAAC,cAACkH,GAAA,EAAD,MAMApH,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQP,OAEtBzG,EAAAC,EAAAC,cAACmH,GAAD,CAASF,UAAWH,EAAQT,OAE5BvG,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,MAApB,YACCxH,EACDC,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQX,aCtCnBmB,GAdC,SAAA1H,GAAiB,IAAd2H,EAAc3H,EAAd2H,QAEjB,OACEzH,EAAAC,EAAAC,cAACwH,GAAD,KACE1H,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,MAApB,cACCE,GAAWzH,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,YAAYE,qDCgCnCE,eArCb,SAAAA,EAAaC,GAAO,IAAA3O,EAAA,OAAAE,OAAA0O,GAAA,EAAA1O,CAAAD,KAAAyO,GAClB7L,QAAQC,IAAI,8BACZ9C,EAAAE,OAAA2O,GAAA,EAAA3O,CAAAD,KAAAC,OAAA4O,GAAA,EAAA5O,CAAAwO,GAAAK,KAAA9O,KAAM0O,KACDK,MAAQ,CAAEC,UAAU,GAHPjP,mFAaDmE,EAAO+K,GACxBrM,QAAQC,IAAI,mCACZD,QAAQsB,MAAMA,oCAKN,IAAAgL,EACoBlP,KAAK+O,MAAzBC,EADAE,EACAF,SAAU9K,EADVgL,EACUhL,MACAiL,EAAenP,KAAK0O,MAA9BU,SACR,OAAIJ,GACFpM,QAAQC,IAAI,0BAELiE,EAAAC,EAAAC,cAACmI,EAAD,CAAYjL,MAAOA,KAGrBlE,KAAK0O,MAAM7H,4DAvBa3C,GAI/B,OAFAtB,QAAQC,IAAI,0CACZD,QAAQsB,MAAMA,GACP,CAAE8K,UAAU,EAAM9K,gBAXDuC,IAAM4I,6ICMrBC,GACH,SADGA,GAEF,UAFEA,GAGL,OAHKA,GAIJ,QAGH7C,GAAYC,aAAW,SAAAC,GAAK,MAAK,CACrCC,KAAM,CACJC,OAAQ,OACR0C,SAAU,SACVC,QAAS7C,EAAM8C,QAAQ,GACvB/B,QAAS,OACTC,cAAe,SACfC,UAAW,SACX8B,MAAO/C,EAAMjC,QAAQI,KAAKH,QAC1BgF,OAAM,cAAAvN,OAAgBuK,EAAMjC,QAAQI,KAAKD,YAE3C+E,OAAQ,GAIRC,KAAM,CACJC,QAAS,GACTzF,OAAQ,OACR+C,KAAM,UAEN7C,MAAO,OAETO,KAAM,GAENqC,OAAQ,CACN4C,SAAU,GAEZC,MAAO,CACLR,QAAS7C,EAAM8C,QAAQ,GACvBQ,aAActD,EAAM8C,QAAQ,GAC5BS,SAAU,MACVH,SAAU,EACVnC,UAAW,OACXuC,WAAY,WACZZ,SAAU,SACVG,MAAO/C,EAAMjC,QAAQxG,MAAM0G,KAC3BwF,WAAY,kCA4GDC,GAxGK,SAAAzJ,GAAuC,IAApC1C,EAAoC0C,EAApC1C,MAAOoM,EAA6B1J,EAA7B0J,UAAWC,EAAkB3J,EAAlB2J,YACjCzC,EAAUrB,KADyC+D,EAExBC,oBAAS,GAFeC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAElDI,EAFkDF,EAAA,GAEzCG,EAFyCH,EAAA,GAAAI,EAGjCL,mBAAS,IAHwBM,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAGlDE,EAHkDD,EAAA,GAG5CE,EAH4CF,EAAA,GAKrDG,EAAUpK,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQX,SAYtC,IAAIgE,EAAa,kBACbC,GAAW,EACX1B,EAAQ,UACZ,OAAQY,GACN,KAAKhB,GACH6B,EAAa,kBACb,MACF,KAAK7B,GACH8B,GAAW,EACX1B,EAAQ,UACRyB,EAAa,aACb,MACF,KAAK7B,GACHI,EAAQ,UACR0B,GAAW,EACXD,EAAa,8BACb,MACF,KAAK7B,GACHI,EAAQ,YACR0B,GAAW,EACXD,EAAa,2BAMjB,OACErK,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,MACtB9F,EAAAC,EAAAC,cAACkH,GAAA,EAAD,MACApH,EAAAC,EAAAC,cAACqK,GAAAtK,EAAD,CAAWkH,UAAWH,EAAQ+B,KAAMH,MAAM,UAC1C5I,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,YAAYJ,UAAWH,EAAQhD,KAAM4E,MAAM,WAA/D,wBAGCxL,GAASA,EAAMqK,SAAWzH,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,QAAQJ,UAAWH,EAAQhD,KAAM4E,MAAM,WACnFxL,EAAMqK,SAETzH,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CACErD,UAAWH,EAAQ8B,OACnBvB,QAAQ,YACR+C,SAAUA,EACV1B,MAAOA,EACP6B,QAAS,kBAAMV,GAAc,KAE7B/J,EAAAC,EAAAC,cAACwK,GAAAzK,EAAD,MACCoK,GAEFD,EACDpK,EAAAC,EAAAC,cAACyK,GAAA,EAAD,CAAQC,KAAMd,EAASe,WAAS,EAACC,QAAS,kBAAMf,GAAc,IAAQgB,kBAAgB,qBACpF/K,EAAAC,EAAAC,cAAC8K,GAAA,EAAD,CAAarR,GAAG,qBAAhB,gBACAqG,EAAAC,EAAAC,cAAC+K,GAAA,EAAD,KACEjL,EAAAC,EAAAC,cAACgL,GAAA,EAAD,4DAGAlL,EAAAC,EAAAC,cAACiL,GAAA,EAAD,CACEC,WAAS,EACT7H,OAAO,QACP8H,WAAS,EACTC,SAAU,SAACnO,GAAD,OAAOgN,EAAQhN,EAAEoO,OAAOC,QAClCC,QAAQ,IACR9R,GAAG,OACH+R,YAAY,sCACZC,MAAM,OACNd,WAAS,KAGb7K,EAAAC,EAAAC,cAAC0L,GAAA,EAAD,KACE5L,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQC,QAAS,kBAAMV,GAAc,IAAQnB,MAAM,WAAnD,UAGA5I,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQC,QAAS,WACfhB,EAAYS,GACZH,GAAc,IACbnB,MAAM,WAHT,qwDCjJH,IAAMiD,GAAcvL,IAAHwL,MAMXC,GAAezL,IAAH0L,MAOZC,GAAe3L,IAAH4L,MAOZC,GAAmB,CAC9B,KACA,SACA,OACA,OACA,SACA,aAGWC,GAAc9L,IAAH+L,MAOXC,GAAkB,CAC7B,KACA,WACA,UACA,OACA,QAGWC,GAAcjM,IAAHkM,KAUtBvL,GAEWwL,GAAe,CAC1B,WACA,UACA,OACA,UACA,SACA,OACA,OACA,eAGWC,GAAepM,IAAHqM,KAavB7L,EACAG,GAEW2L,GAAgB,CAC3B,SACA,OACA,OACA,SACA,YACA,QAGWC,GAAcvM,IAAHwM,MAMXC,GAAgBzM,IAAH0M,MAMbC,GAAY3M,IAAH4M,MC9FhBC,GAAwBC,YAAQH,GAAW,CAC/CrF,MAAO,SAAA9H,GAA2D,IAAxDuN,EAAwDvN,EAAxDuN,OAAwDC,EAAAxN,EAAhDyN,SAAYC,EAAoCF,EAApCE,WAAYpQ,EAAwBkQ,EAAxBlQ,MAAOqQ,EAAiBH,EAAjBG,SAG/C,OAFA3R,QAAQC,IAAI,8BAA+B,CAAEsR,SAAQG,aAAYpQ,UAC7DiQ,EAAOjQ,OAAOqQ,EAASjF,IACpB,CACLiB,YAAa,SAACS,GACZuD,EAASjF,IACT,IAAIkF,EAAa,GACXC,EAAS,CAAEzD,OAAMsD,aAAYpQ,QAAOwQ,IAAKC,i0BAC/C/R,QAAQC,IAAI,sCAAuC4R,GACnD,IACED,EAAavS,KAAKC,UAAUuS,GAE9B,MAAOxQ,GACLuQ,EAAatQ,EAAM0Q,WAGrB,OADAhS,QAAQC,IAAI,uCAAwC2R,GAC7CL,EAAO,CACZU,UAAW,CAAEL,cACbM,OAAQ,SAACC,EAADC,GAAqB,IAAXC,EAAWD,EAAXC,KAChBrS,QAAQC,IAAI,+BAAgCoS,GAC5CV,EAASjF,YAwBN4F,gBAbS,SAACnG,EAAOL,GAAU,IAChCyG,EAAkCpG,EAAlCoG,IAAK1K,EAA6BsE,EAA7BtE,KAAmB2K,GAAUrG,EAAvBsG,SADqBpV,OAAAqV,EAAA,EAAArV,CACE8O,EADF,4BAElCwG,EAASJ,EAAI9R,OAAO,GAE1B,MAAO,CACLiR,WAAWrU,OAAAuV,EAAA,EAAAvV,CAAA,GACNmV,EADK,CAERD,IAAKI,EACL9K,WAKSyK,CAnDM,SAACxG,GAAU,IAAA8B,EACJC,mBAASnB,IADLoB,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GACvBzB,EADuB2B,EAAA,GAChB6D,EADgB7D,EAAA,GAExB+E,EAAUxB,GAAsB5D,IACtC,OAAOvJ,EAAAC,EAAAC,cAACyO,EAADxV,OAAAyV,OAAA,GAAahH,EAAb,CAAoB6F,SAAUA,EAAUjE,UAAWvB,wHCG5D4G,GAAA,CACE,CACEC,QAAS,MACTC,KAAMC,KACNC,WAAYC,KACZtG,MAAO,QACPuG,MAAOC,IAET,CACEN,QAAS,OACTC,KAAMM,KACNJ,WAAYK,KACZ1G,MAAO,OACPuG,MAAOI,qCCrBEC,GAAY,CACvB,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UACxF,UAAW,UAAW,UAAW,UAAW,UAAW,WAG5CC,GAAY,CACvBC,YAAa7B,uEACb8B,OAAQC,IAGNC,GAAUhC,g0BAAYiC,kBAO1BhU,QAAQC,IAAI,WAAY8T,GANThC,eAQR,IAGMlK,GAAO,CAClBoM,QAAS,CACPC,kBAAmB,CAAC,QAAS,SAC7BC,uBAAwB,GACxBC,eAAgB,MAElBC,cAAe,CACbC,KAAM,OACNC,IAAK,MACLC,OAAQ,SACRC,QAAS,UACTC,OAAQ,SACRC,UAAW,YACXC,kBAAmB,oBACnBC,mBAAoB,qBACpBC,iBAAkB,oBAEpBC,YAAa,CACXC,IAAK,MACLC,SAAU,WACVC,KAAM,QAERC,aAAc,CACZC,KAAM,OACNF,KAAM,OACNF,IAAK,QAWIK,GAAY,CACvB/D,QAASS,mEAGEuD,GAAM,CACjBC,KAAM,CAIJC,OAAQzD,YAER0D,WAAY1D,sBAEZ2D,oBAAqB3D,4BAErB4D,iBAAiB,EAEjBC,cAAe,CAEbC,OAAM,GAAArW,OAjECuS,oCAqEP+D,QAAS,GAETC,QAAQ,KAODC,GAAS,CACpBC,KAAM,CACJpG,MAAO,OACPqG,YAAa,uDACbpJ,MAAOqJ,MAETC,QAAS,CACPvG,MAAO,UACPqG,YAAa,2BACbpJ,MAAOuJ,MAETC,OAAQ,CACNzG,MAAO,SACPqG,YAAa,6DACbpJ,MAAOyJ,mECvFEC,GAAuB,SAACrE,EAAO/J,GAC1C,IAAM6J,EAAY,CAAEpU,GAAIuK,EAAOvK,IACzB4Y,EAAQ1P,GACVvG,EAAU,CACZ4H,OAAQ,IAEV,IACE,IAAMsO,EAAOvE,EAAMwE,UAAU,CAAEF,QAAOxE,cACtCzR,EAAUoW,KAAEC,UAAUH,GAExB,MAAOrV,GACLrB,QAAQ8W,KAAK,gDAEf,IACEtW,EAAQ4H,OAAR/K,OAAAuV,EAAA,EAAAvV,CAAA,GAAsBmD,EAAQ4H,OAAWA,GACzC+J,EAAM4E,WAAW,CAAEN,QAAOxE,YAAWI,KAAM7R,IAC3CR,QAAQC,IAAI,4CAEd,MAAOoB,GACLrB,QAAQsB,MAAM,mDAWL0V,GAA4B,SAAC7E,EAAOhT,GAA0B,IAAnB8X,EAAmB/U,UAAA3B,OAAA,QAAA4B,IAAAD,UAAA,IAAAA,UAAA,GACnE+P,EAAY,CAAEpU,GAAIsB,EAAM+X,UACxBT,EAAQ1P,GACd,IAEE,IAAM2P,EAAOvE,EAAMwE,UAAU,CAAEF,QAAOxE,cAChCzR,EAAUoW,KAAEC,UAAUH,GAC5B,GAAIO,EACFzW,EAAQ4H,OAAO+O,OAAS3W,EAAQ4H,OAAO+O,OAAOlZ,OAAO,SAAAmZ,GAAE,OAAIA,EAAGvZ,KAAOsB,EAAMtB,SAExE,CACH,IAAMwZ,EAAM7W,EAAQ4H,OAAO+O,OAAOpZ,UAAU,SAAAqZ,GAAE,OAAIA,EAAGvZ,KAAOsB,EAAMtB,KAC9DwZ,GAAO,GACT7W,EAAQ4H,OAAO+O,OAAf9Z,OAAAia,GAAA,EAAAja,CAA4BmD,EAAQ4H,OAAO+O,QAC3C3W,EAAQ4H,OAAO+O,OAAOE,GAAOlY,GAG7BqB,EAAQ4H,OAAO+O,OAAf,GAAA3X,OAAAnC,OAAAia,GAAA,EAAAja,CAA4BmD,EAAQ4H,OAAO+O,QAA3C,CAAmDhY,IAGvDgT,EAAM4E,WAAW,CAAEN,QAAOxE,YAAWI,KAAM7R,IAC3CR,QAAQC,IAAI,iDAEd,MAAOoB,GACLrB,QAAQsB,MAAM,uEAYlB,SAASiW,GAAuBC,EAASpP,GAAwB,IAC3DqP,EAAS,GACb,GAF+DvV,UAAA3B,OAAA,QAAA4B,IAAAD,UAAA,IAAAA,UAAA,GAG7DuV,EAASD,EAAQvZ,OAAO,SAAAyZ,GAAC,OAAIA,EAAE7Z,KAAOuK,EAAOvK,SAE1C,CACH,IAAM8Z,EAAoBf,KAAEgB,KAAKxP,EAAQlD,GACzCuS,EAAM,GAAAjY,OAAAnC,OAAAia,GAAA,EAAAja,CAAOma,GAAP,CAAAna,OAAAuV,EAAA,EAAAvV,CAAA,GACDsa,EADC,CACkBE,aAAc,KAAMC,WAAY,oBAI1D,OADA9X,QAAQC,IAAI,8CAA+CwX,GACpDA,EA0DF,IAAMM,GAAkB,SAAC5F,EAAO/J,GAA2B,IAAnB6O,EAAmB/U,UAAA3B,OAAA,QAAA4B,IAAAD,UAAA,IAAAA,UAAA,GAC1D+P,EAAY,CAAE+F,MAAO,KACrBvB,EAAQlR,EACV/E,EAAU,CACZ+E,UAAW,CACT0S,gBAAiB,GACjBC,UAAW,KACXJ,WAAY,oBAGhB,IAEE,IAAMpB,EAAOvE,EAAMwE,UAAU,CAAEF,QAAOxE,cACtCzR,EAAUoW,KAAEC,UAAUH,GAExB,MAAOrV,GACLrB,QAAQ8W,KAAK,2CAGf,IACEtW,EAAQ+E,UAAU0S,gBAAkBV,GAAsB/W,EAAQ+E,UAAU0S,gBAAiB7P,EAAQ6O,GACrG9E,EAAM4E,WAAW,CAAEN,QAAOxE,YAAWI,KAAM7R,IAC3CR,QAAQC,IAAI,uCAEd,MAAOoB,GACLrB,QAAQsB,MAAM,8CAYL6W,GAAuB,SAAChG,EAAO/J,EAAQjJ,GAA0B,IAAnB8X,EAAmB/U,UAAA3B,OAAA,QAAA4B,IAAAD,UAAA,IAAAA,UAAA,GACtEuU,EAAQlR,EACd,IACE,IAAMmR,EAAOvE,EAAMwE,UAAU,CAAEF,QAAOxE,UAAW,CAAE+F,MAAO,OACpDxX,EAAUoW,KAAEC,UAAUH,GAE5BlW,EAAQ+E,UAAU0S,gBAAkBzX,EAAQ+E,UAAU0S,gBAAgB1F,IAAI,SAAAmF,GACxE,GAAIA,EAAE7Z,KAAOsB,EAAM+X,SAAU,OAAOQ,EAElC,IAAMU,EAAOxB,KAAEC,UAAUa,GACzB,GAAIT,GAAU7O,EAERgQ,EAAKC,OAAOxa,KAAOsB,EAAMtB,KAC3Bua,EAAKC,OAASjQ,EAAO+O,OAAO/O,EAAO+O,OAAO5W,OAAS,IAGjD6X,EAAKE,SAASza,KAAOsB,EAAMtB,KAC7Bua,EAAKE,SAAWlQ,EAAO+O,OAAO/O,EAAO+O,OAAO5W,OAAS,QAGpD,CAEH,IAAMgY,EAAe3B,KAAEgB,KAAKzY,EAAOuF,GACnC6T,EAAaT,WAAa,eAC1BM,EAAKC,OAASE,EAEhB,OAAOH,IAGXjG,EAAM4E,WAAW,CAAEN,QAAOpE,KAAM7R,IAChCR,QAAQC,IAAI,4CAEd,MAAOoB,GACLrB,QAAQsB,MAAM,yDAWLkX,GAAmB,SAACrG,EAAO/J,GAA2B,IAAnB6O,EAAmB/U,UAAA3B,OAAA,QAAA4B,IAAAD,UAAA,IAAAA,UAAA,GAC3DuU,EAAQ9Q,EAEVnF,EAAU,CACZmF,WAAY,CACVsS,gBAAiB,GACjBC,UAAW,KACXJ,WAAY,oBAGhB,IAEE,IAAMpB,EAAOvE,EAAMwE,UAAU,CAAEF,UAC/BjW,EAAUoW,KAAEC,UAAUH,GAExB,MAAOrV,GACLrB,QAAQ8W,KAAK,4CAGf,IACEtW,EAAQmF,WAAWsS,gBAAkBV,GAAsB/W,EAAQmF,WAAWsS,gBAAiB7P,EAAQ6O,GACvG9E,EAAM4E,WAAW,CAAEN,QAAOpE,KAAM7R,IAChCR,QAAQC,IAAI,wCAEd,MAAOoB,GACLrB,QAAQsB,MAAM,+CAaLmX,GAAa,SAACtG,EAAO/J,EAAQjJ,GAA0B,IAAnB8X,EAAmB/U,UAAA3B,OAAA,QAAA4B,IAAAD,UAAA,IAAAA,UAAA,GAC5DuU,EAAQ9P,GAEVnG,EAAU,CACZkY,OAAQ,CACNC,KAAM,GACNC,OAAQ,KACRd,WAAY,oBAGhB,IAEE,IAAMpB,EAAOvE,EAAMwE,UAAU,CAAEF,UAC/BjW,EAAUoW,KAAEC,UAAUH,GAExB,MAAOrV,GACLrB,QAAQ8W,KAAK,sCAGf,IACEtW,EAAQkY,OAAOC,KA1LnB,SAAyBnB,EAASpP,EAAQjJ,GAAuB,IAC3DsY,EAAS,GACb,GAF+DvV,UAAA3B,OAAA,QAAA4B,IAAAD,UAAA,IAAAA,UAAA,GAI7DuV,EAASD,EAAQvZ,OAAO,SAAA4a,GACtB,QAAIzQ,GAAUyQ,EAAMzQ,OAAOvK,KAAOuK,EAAOvK,OAChCsB,GAAS0Z,EAAM1Z,MAAMtB,KAAOsB,EAAMtB,UAI1C,CAEH,IAAMwZ,EAAMG,EAAQzZ,UAAU,SAAA+a,GAAK,OAAIA,EAAMC,MAAQ5Z,EAAMtB,KAErDmb,EAAmB5Q,EAASwO,KAAEgB,KAAKxP,EAAQrD,GAAqB,KACtEiU,EAAiBlB,WAAa,gBAE9B,IAAMmB,EAAkBrC,KAAEgB,KAAKzY,EAAOuF,GACtCuU,EAAgBnB,WAAa,eAGzBT,GAAO,GACTI,EAAMpa,OAAAia,GAAA,EAAAja,CAAOma,IACNH,GAAKlY,MAAQ8Z,EAIpBxB,EAAM,GAAAjY,OAAAnC,OAAAia,GAAA,EAAAja,CAAOma,GAAP,CAAgB,CACpBuB,IAAKE,EAAgBpb,GACrBuK,OAAQ4Q,EACR7Z,MAAO8Z,EACPC,SAAU,QACVpB,WAAY,sBAKlB,OADA9X,QAAQC,IAAI,uCAAwCwX,GAC7CA,EAqJiB0B,CAAe3Y,EAAQkY,OAAOC,KAAMvQ,EAAQjJ,EAAO8X,GACzE9E,EAAM4E,WAAW,CAAEN,QAAOpE,KAAM7R,IAChCR,QAAQC,IAAI,kCAEd,MAAOoB,GACLrB,QAAQC,IAAI,QAAS,CAAEO,YACvBR,QAAQsB,MAAM,yCAUL8X,GAAc,SAACjH,EAAO+E,GAA6B,IAAnBD,EAAmB/U,UAAA3B,OAAA,QAAA4B,IAAAD,UAAA,IAAAA,UAAA,GACxDuU,EAAQlQ,GACd,IACE,IAAMmQ,EAAOvE,EAAMwE,UAAU,CAAEF,UACzBjW,EAAUoW,KAAEC,UAAUH,GAG1BlW,EAAQ6Y,KAAKC,SADXrC,EACsBzW,EAAQ6Y,KAAKC,SAASrb,OAAO,SAAAsb,GAAG,OAAIA,IAAQrC,IAGpE7Z,OAAAia,GAAA,EAAAja,CAA4B,IAAImc,IAAJ,GAAAha,OAAAnC,OAAAia,GAAA,EAAAja,CAAYmD,EAAQ6Y,KAAKC,UAAY,IAArC,CAAyCpC,MAGvE/E,EAAM4E,WAAW,CAAEN,QAAOpE,KAAM7R,IAChCR,QAAQC,IAAI,kCAAmCgX,EAAS,UAAY,SAEtE,MAAO5V,GACLrB,QAAQsB,MAAM,qCChULmY,GAAenI,YAAQV,GAAc,CAChD9E,MAAO,SAAA9H,GAA0B,IAAvBuN,EAAuBvN,EAAvBuN,OAAQE,EAAezN,EAAfyN,SAChB,MAAO,CACLiI,qBAAoB,eAAAC,EAAAtc,OAAAuc,EAAA,EAAAvc,CAAAwc,EAAA1V,EAAA2V,KAAE,SAAAC,EAAOC,EAAWza,EAAU0a,GAA5B,IAAAC,EAAArc,EAAAsc,EAAAC,EAAAC,EAAAC,EAAArI,EAAAsI,EAAAC,EAAA,OAAAX,EAAA1V,EAAAsW,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAAAV,EACgCzI,EAAS4H,KAArDxb,EADYqc,EACZrc,GAAIsc,EADQD,EACRC,SAAUC,EADFF,EACEE,gBAAiBC,EADnBH,EACmBG,SACjCC,EAAgB,CAAEzc,KAAIsc,WAAUC,kBAAiBC,WAAUvC,WAAY,eACxEkC,EAAUa,SAAQb,EAAUa,OAAS,WAEpC5I,EAAY,CAChB7J,OAAQwO,KAAEgB,KAAKoC,EAAWlJ,IAC1B3R,MAAOyX,KAAEgB,KAAKrY,EAAUoR,IACxBsJ,OAEIM,EAAqBO,GAAyB,CAAER,gBAAeN,YAAWza,WAAU0a,QAVtES,EAAAE,KAAA,EAWUG,GAAoB,CAAE9I,YAAWsI,sBAAsB3J,IAXjE,cAWd4J,EAXcE,EAAAM,KAYpBhb,QAAQC,IAAI,+BAAgC,CAAE+Z,YAAWza,WAAU0S,YAAWsI,qBAAoBN,QAZ9ES,EAAAO,OAAA,SAab1J,EAAO,CACZU,YAEAsI,qBACArI,OAAQgJ,GAAY,GAAIzJ,EAAS0J,sBAChCC,KAAK,SAAA/I,GAIN,OAFArS,QAAQC,IAAI,8BAA+BoS,GAC3CgJ,GAAmBb,GACZnI,KAtBW,yBAAAqI,EAAAY,SAAAvB,MAAF,gBAAAwB,EAAAC,EAAAC,GAAA,OAAA9B,EAAAjW,MAAAtG,KAAA8E,YAAA,OA6BpBgZ,GAAc,SAAC5X,EAASoY,GAAV,OAAiB,SAACvJ,EAADC,GAAqB,IAAXC,EAAWD,EAAXC,KAE7CrS,QAAQC,IAAI,oCAAqC,CAAEoS,SACnDmE,GAAqBrE,EAAOE,EAAKzB,aAAaxI,QAC9CoQ,GAAiBrG,EAAOE,EAAKzB,aAAaxI,QAC1C2P,GAAgB5F,EAAOE,EAAKzB,aAAaxI,QACzCqQ,GAAWtG,EAAOE,EAAKzB,aAAaxI,OAAQiK,EAAKzB,aAAaxI,OAAO+O,OAAO,IAExEuE,GAAIA,EAAGrJ,EAAKzB,aAAaxI,OAAOvK,MAGhCid,GAA2B,SAAAa,GAAiD,IAA9CrB,EAA8CqB,EAA9CrB,cAAeN,EAA+B2B,EAA/B3B,UAAWza,EAAoBoc,EAApBpc,SACtDqc,GAD0ED,EAAV1B,IAChD,CACpBpc,GAAI0B,EAAS1B,GACbU,KAAMgB,EAAShB,MAAQ,KACvB2Y,SAAU8C,EAAUnc,GACpBge,UAAWhc,KAAKic,MAAM9J,WACtB+J,YAAazB,EACb0B,YAAa1B,EACb2B,UAAW3B,EAAczc,GACzBqe,UAAW5B,EAAczc,GACzB6B,YAAaH,EAASG,YACtByc,UAAWtc,KAAKic,MAAM9J,WACtBoK,gBAAiB9B,EAAczc,GAC/B8B,QAASJ,EAASI,QAClB0c,OAAQ9c,EAAS8c,QAAU,KAC3B3e,KAAM6B,EAAS7B,MAAQ,GACvB4e,MAAO,CACLC,KAAM,KACNC,MAAO,KACPC,KAAM,KACNC,MAAO,KACPC,OAAQ,KACR7E,WAAY,SAEdA,WAAY,UAER8E,EAAuBhG,KAAEgB,KAAKgE,EAAelX,GAEnD,MAAO,CACLkM,aAAc,CACZxI,OAAQ,CACNvK,GAAImc,EAAUnc,GACdgf,KAAM7C,EAAU6C,KAChBzO,KAAM4L,EAAU5L,MAAQ,KACxByM,OAAQb,EAAUa,OAClBtc,KAAMyb,EAAUzb,MAAQ,KACxB+Z,SAASjb,OAAAuV,EAAA,EAAAvV,CAAA,GACJuf,EADG,CAEN9E,WAAY,iBAEdO,OAAOhb,OAAAuV,EAAA,EAAAvV,CAAA,GACFuf,EADC,CAEJ9E,WAAY,iBAEdD,aAAc,KACdwE,OAAQrC,EAAUqC,QAAU,KAC5BS,UAAW9C,EAAU8C,WAAa,KAClCC,WAAY,EACZhB,YAAazB,EACb0B,YAAa1B,EACb2B,UAAW3B,EAAczc,GACzBqe,UAAW5B,EAAczc,GACzBge,UAAWhc,KAAKic,MAAM9J,WACtBmK,UAAWtc,KAAKic,MAAM9J,WACtBgL,SAAU,EACV7F,OAAQ,CAACyE,GACT9D,WAAY,UAEdmF,QAAS,KACTnF,WAAY,eAKHoF,GAAA,CACbzD,gBACAyB,qCCnHFiC,KAAY1f,OAAO,CACjB2f,UAAW,WACXlH,YAAa,gBAGR,IAAMmH,GAAWF,KAAYG,eAAe,CACjDT,KAAM,aAEKU,GAAaJ,KAAYG,eAAe,CACnDT,KAAM,eAGFW,GAAmB,mBAGzB,SAASC,KACP,OAAOF,GAAWG,QAAQF,IACvBpC,KAAK,SAAAuC,GAEJ,OADA3d,QAAQC,IAAI,6BAA8BZ,KAAKyB,MAAM6c,IAAc,IAC5Dte,KAAKyB,MAAM6c,IAAc,KAKtC,SAASC,GAAmBD,GAE1B,OADA3d,QAAQC,IAAI,6BAA8B0d,GACnCJ,GAAWM,QAAQL,GAAkBne,KAAKC,UAAUqe,IAStD,SAAS5C,GAAqB+C,EAAQC,EAAUza,GACrD,IAAMzF,EAAK4B,OACX,OAAOge,KACJrC,KAAK,SAAAuC,GAAS,OAAIA,EAAUne,OAAO,CAAE3B,KAAIigB,SAAQC,WAAUza,cAC3D8X,KAAK,SAAA/I,GAEJ,OADArS,QAAQC,IAAI,+BAAgCoS,GACrCA,IAER+I,KAAKwC,IACLxC,KAAK,kBAAMvd,IAGT,SAASwd,GAAoBxd,GAClC,OAAO4f,KACJrC,KAAK,SAAAuC,GAAS,OAAIA,EAAU1f,OAAO,SAAA+f,GAAE,OAAIA,EAAGngB,KAAOA,MACnDud,KAAK,SAAA/I,GAEJ,OADArS,QAAQC,IAAI,8BAA+BoS,GACpCA,IAER+I,KAAKwC,IAaV,SAASK,GAAkBpgB,EAAIyF,GAC7B,OAAO,SAAC4a,EAAOC,GAGb,OAbJ,SAAwBA,EAAM7a,GAI5B,OADAtD,QAAQC,IAAI,yBAA0B,CAAEke,OAAM7a,YAC1C6a,EAAK9L,KAAKzB,aAAqBA,GAAasK,YAAY5X,GAChD,aAMV8a,CAAcD,EAAM7a,EAApB8a,CAA6BF,EAAOC,GAE/BA,EAAK9L,KAAKgM,aACHC,QAAQC,UADgBlD,GAAmBxd,IAOpD,SAAS2gB,GAAiBC,GAC/B,OAAOhB,KACJrC,KAAK,SAAAuC,GAAS,OAAIA,EAAUe,QAAQ,SAAAC,GACnC3e,QAAQC,IAAI,2BAA4B0d,EAAWgB,GADG,IAE9C9gB,EAAkC8gB,EAAlC9gB,GAAIigB,EAA8Ba,EAA9Bb,OAAQC,EAAsBY,EAAtBZ,SAAUza,EAAYqb,EAAZrb,QAC9Bwa,EAAOvD,mBAAmB8D,cAAe,EACzCP,EAAO5L,OAAS+L,GAAiBpgB,EAAIyF,GACrCwa,EAAOC,SAAWA,EAClBU,EAAOlN,OAAOuM,0CC9EpBc,KAAQC,UAAUvJ,IAElB,IAAMwJ,GAAsB,eAEfC,GAAe,CAC1BC,aAAc,eACdC,eAAgB,iBAChBC,QAAS,gBACTC,gBAAiB,mBACjBC,MAAO,SACPC,KAAM,QAoBOC,OAjBf,WAAuB,IAAA1R,EACOC,mBAAS,MADhBC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GACd6Q,EADc3Q,EAAA,GACNyR,EADMzR,EAAA,GAAAI,EAEGL,oBAAS,GAFZM,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAEdsR,EAFcrR,EAAA,GAERsR,EAFQtR,EAAA,GAAAuR,EAGa7R,mBAASkR,GAAaC,cAHnCW,EAAAtiB,OAAA0Q,GAAA,EAAA1Q,CAAAqiB,EAAA,GAGdE,EAHcD,EAAA,GAGHE,EAHGF,EAAA,GAcrB,OATArW,oBAAU,iDACRwW,CAAmB,SAACC,EAAWC,GAC7BhgB,QAAQC,IAAI,uBAAwB+f,EAAUD,GAC9CR,EAAUQ,GACVN,GAAShB,GAAUsB,IAAcC,IAAajB,GAAaM,MAC3DQ,EAAaG,MAEd,IAEI,CAAEvB,SAAQe,OAAMI,cASnBK,GAAe,eAAAjc,EAAA3G,OAAAuc,EAAA,EAAAvc,CAAAwc,EAAA1V,EAAA2V,KAAG,SAAAC,IAAA,IAAAmG,EAAA,OAAArG,EAAA1V,EAAAsW,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAAAF,EAAAC,KAAA,EAAAD,EAAAE,KAAA,EAEMrF,QAAK4K,iBAFX,cAEdD,EAFcxF,EAAAM,KAAAN,EAAAO,OAAA,SAGbiF,EAAYE,YAAYC,UAHX,cAAA3F,EAAAC,KAAA,EAAAD,EAAA4F,GAAA5F,EAAA,SAAAA,EAAAO,OAAA,SAMb,MANa,yBAAAP,EAAAY,SAAAvB,EAAA,iBAAH,yBAAA/V,EAAAN,MAAAtG,KAAA8E,YAAA,gDAUrB,SAAAqe,EAAmC/Q,GAAnC,IAAAgR,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAA/G,EAAA1V,EAAAsW,KAAA,SAAAoG,GAAA,cAAAA,EAAAlG,KAAAkG,EAAAjG,MAAA,cAEQ4F,EAAQ,IAAIM,KAAc,IAFlCD,EAAAlG,KAAA,EAQInL,EAAS,KAAMuP,GAAaG,SARhC2B,EAAAjG,KAAA,EASUmG,wBAAa,CACjBP,QACAQ,QAASzD,KAXf,OAAAsD,EAAAjG,KAAA,uBAAAiG,EAAAlG,KAAA,EAAAkG,EAAAP,GAAAO,EAAA,SAeI7gB,QAAQsB,MAAM,+BAAduf,EAAAP,IACA9Q,EAAS,KAAMuP,GAAaK,OAhBhCyB,EAAA5F,OAAA,yBAqBQwF,EAAWQ,aAAU,eAAAtF,EAAAte,OAAAuc,EAAA,EAAAvc,CAAAwc,EAAA1V,EAAA2V,KAAC,SAAAoH,EAAOtK,EAAPxE,GAAA,IAAA+O,EAAAC,EAAAC,EAAA,OAAAxH,EAAA1V,EAAAsW,KAAA,SAAA6G,GAAA,cAAAA,EAAA3G,KAAA2G,EAAA1G,MAAA,cAAYuG,EAAZ/O,EAAY+O,QAAZG,EAAA1G,KAAA,EACNqF,KADM,cACpBmB,EADoBE,EAAAtG,KAGpBqG,EAHoBhkB,OAAAuV,EAAA,EAAAvV,CAAA,GAIrB8jB,EAJqB,CAKxBI,cAAeH,EAAK,UAAA5hB,OAAa4hB,GAAU,KALnBE,EAAArG,OAAA,SAcnB,CAAEkG,QAASE,IAdQ,wBAAAC,EAAAhG,SAAA4F,MAAD,gBAAA1F,EAAAC,GAAA,OAAAE,EAAAjY,MAAAtG,KAAA8E,YAAA,IAkBrBwe,EAAWc,aAAe,CAAEC,IAAKpM,GAAU/D,UAC3CqP,EAAQ,IAAIe,KAAU,CAC1BC,SAAU,CACRC,IAAKC,IACLC,QAAS,SAACxgB,EAAOygB,GAEf,OADA/hB,QAAQC,IAAI,iBAAkB,CAAEqB,QAAOygB,gBAChC,MAIb/hB,QAAQC,IAAI,gCAAiCoV,GAAU/D,SAEjDsP,EAAe,IAAIoB,KAAa,CACpCC,KAAMC,KAAWrhB,KAAK,CAAC8f,EAAOF,EAAUC,IACxCyB,UAAWrD,GACXsD,aAAa,EACb5B,QACA6B,mBAAmBtQ,IAGrBvC,EAAS,KAAMuP,GAAaI,iBA3D9B0B,EAAAjG,KAAA,GA4DQ4D,GAAgBoC,GA5DxB,QA8DEpR,EAASoR,EAAc7B,GAAaM,MA9DtC,yBAAAwB,EAAAvF,SAAAiF,EAAA,+FC1De+B,GAAA,SAAAvY,GAAK,MAAK,CACvBC,KAAM,GAENO,OAAQ,CACN4C,SAAU,GAEZoV,eAAgB,CACd5a,MAAO,OACPqD,UAAW,SAEbwX,OAAQ,GAGRC,aAAc,CACZtV,SAAU,EACVuV,eAAgB,CACdC,aAAc,GAEhBC,gBAAiB,CACfD,aAAc,IAGlBE,cAAe,CACbC,UAAW/Y,EAAM8C,QAAQ,GACzB/B,QAAS,QAGXiY,iBAAkB,CAChBtb,OAAQsC,EAAM8C,QAAQ,GACtBjC,SAAU,KAEZoY,SAAU,CACRF,UAAW/Y,EAAM8C,QAAQ,GACzBoW,UAAW,UAEbC,SAAU,CACRzb,OAAQsC,EAAM8C,QAAQ,EAAG,GACzBD,QAAS7C,EAAM8C,QAAQ,GACvB7B,UAAW,OACX+B,OAAM,sBACNtE,WAAU,eC5BRoB,GAAYC,aAAWuJ,IAkFd8P,GAhFA,SAAAnf,GAMgB,IANbof,EAMapf,EANbof,QAChBC,EAK6Brf,EAL7Bqf,aAEAC,GAG6Btf,EAJ7Buf,UAI6Bvf,EAH7Bsf,sBACAE,EAE6Bxf,EAF7Bwf,kBACAC,EAC6Bzf,EAD7Byf,kBACAC,EAA6B1f,EAA7B0f,aACMxY,GADuB7N,OAAAqV,EAAA,EAAArV,CAAA2G,EAAA,sHACb6F,MAChB,OACE3F,EAAAC,EAAAC,cAACwH,GAAD,KAIE1H,EAAAC,EAAAC,cAACiL,GAAA,EAAD,CACExR,GAAG,WACHkR,WAAS,EACTvQ,IAAI,WACJqe,KAAK,WACLhN,MAAM,WACN/C,MAAM,UACNwC,WAAS,EACTjE,UAAWH,EAAQyY,UACnBlc,OAAO,SACP+H,SAAUgU,IAEZtf,EAAAC,EAAAC,cAACiL,GAAA,EAAD,CACEN,WAAS,EACTlR,GAAG,WACHgS,MAAM,WACN/C,MAAM,UACNtO,IAAI,WACJqe,KAAK,WACLpe,KAAK,WACL4M,UAAWH,EAAQyY,UACnBC,aAAa,mBACbnc,OAAO,SACP+H,SAAUgU,IAEZtf,EAAAC,EAAAC,cAACyf,GAAA,EAAD,CAASC,gBAAc,GAErB5f,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQqV,UAAU,SAASjX,MAAM,YAAYrB,QAAQ,YAAY+C,SAAU4U,EAASzU,QAAS0U,GAA7F,eAGAnf,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQX,SACxBrG,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CACErD,UAAU,cACV0Y,UAAU,SACVjX,MAAM,UACNrB,QAAQ,YACR+C,SAAU4U,EACVzU,QAAS+U,GANX,YAWFxf,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQ5B,MAAM,UAAU6B,QAAS2U,EAAsBU,KAAK,SAA5D,mBAGA9f,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQgY,UACtBhf,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQK,WAAS,EAACiV,KAAK,QAAQvY,QAAS,WAAYkD,QAAS8U,EAAmB3W,MAAM,WAAtF,+BAGA5I,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,UAAUJ,UAAWH,EAAQ8X,SAAUlW,MAAM,gBAAgBiX,UAAU,OAA3F,iFClEFla,GAAYC,aAAWuJ,IAyCd4Q,GAvCO,SAAAjgB,GAAsD,IAAnDwf,EAAmDxf,EAAnDwf,kBAAmBU,EAAgClgB,EAAhCkgB,WAAYC,EAAoBngB,EAApBmgB,cAChDjZ,EAAUrB,KAChB,OACE3F,EAAAC,EAAAC,cAACwH,GAAD,KACE1H,EAAAC,EAAAC,cAACiL,GAAA,EAAD,CACExR,GAAG,UACHkR,WAAS,EACTO,WAAS,EACTO,MAAM,WACNgN,KAAK,OACLxR,UAAWH,EAAQyY,UACnBlc,OAAO,SACP+H,SAAUgU,IAGZtf,EAAAC,EAAAC,cAACyf,GAAA,EAAD,CAASC,gBAAc,GACrB5f,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQ5B,MAAM,YAAYrB,QAAQ,YAAYkD,QAASuV,GAAvD,QAGAhgB,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQX,SACxBrG,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CACErD,UAAU,cACVyB,MAAM,UACNrB,QAAQ,YACRkD,QAASwV,GAJX,cCrBFta,GAAYC,aAAWuJ,IA0Dd+Q,GAxDY,SAAApgB,GAAqE,IAAlEqgB,EAAkErgB,EAAlEqgB,OAAQC,EAA0DtgB,EAA1DsgB,mBAAoBC,EAAsCvgB,EAAtCugB,aAAcf,EAAwBxf,EAAxBwf,kBAChEtY,EAAUrB,KAChB,OACE3F,EAAAC,EAAAC,cAACwH,GAAD,KACE1H,EAAAC,EAAAC,cAACoH,GAAA,EAAD,mCACAtH,EAAAC,EAAAC,cAACiL,GAAA,EAAD,CACExR,GAAG,aACHkR,WAAS,EACTO,WAAS,EACTO,MAAM,eACNxE,UAAWH,EAAQyY,UACnBllB,KAAK,WACLmlB,aAAa,eACbnc,OAAO,SACP+H,SAAUgU,IAEXc,EACE/R,IAAI,SAACiS,EAAWnN,GAAZ,OACHnT,EAAAC,EAAAC,cAACiL,GAAA,EAAD,CACEN,WAAS,EACTvQ,IAAKgmB,EACL3H,KAAM2H,EACNnZ,UAAWH,EAAQyY,UACnB/T,YAAa2U,EAAalN,GAC1B5Y,KAAK,OACLgJ,OAAO,SACP+H,SAAUgU,MAIhBtf,EAAAC,EAAAC,cAACyf,GAAA,EAAD,CAASC,gBAAc,GAErB5f,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQ5B,MAAM,YAAYrB,QAAQ,aAAlC,QAGAvH,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQX,SACxBrG,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CACE5B,MAAM,UACNrB,QAAQ,YACRkD,QAAS0V,EACThZ,UAAU,eAJZ,4CCnCFxB,GAAYC,aAAWuJ,IAiGdoR,GA/FA,SAAAzgB,GACqD,IADlDwf,EACkDxf,EADlDwf,kBAAmBkB,EAC+B1gB,EAD/B0gB,aAAcC,EACiB3gB,EADjB2gB,kBAAmBC,EACF5gB,EADE4gB,wBACpEvB,EAAkErf,EAAlEqf,aAAca,EAAoDlgB,EAApDkgB,WAAYW,EAAwC7gB,EAAxC6gB,iBAAkBC,EAAsB9gB,EAAtB8gB,gBAC5C9kB,QAAQC,IAAI,cAAe,CAAE6kB,kBAAiBD,mBAAkBH,eAAcC,oBAAmBC,4BAD/B,IAAAhX,EAEhCC,mBAASiX,GAFuBhX,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAE3DmX,EAF2DjX,EAAA,GAEhDkX,EAFgDlX,EAAA,GAG5D5C,EAAUrB,KACVob,EAAuB,SAAA5jB,GAC3BmiB,EAAkBniB,GAClB2jB,EAAa3jB,EAAEoO,OAAOC,QAExB,OACExL,EAAAC,EAAAC,cAACwH,GAAD,KAEI8Y,EAAanS,IAAI,SAAC2S,EAAO7N,GACvB,MAAqB,iBAAd6N,EAAM1mB,IACX0F,EAAAC,EAAAC,cAACiL,GAAA,EAAD,CACEN,WAAS,EACTO,UAAgE,IAArDoV,EAAa3mB,UAAU,SAAAonB,GAAC,OAAIA,EAAE3mB,MAAQ0mB,EAAM1mB,MACvDC,KAAMymB,EAAMzmB,KACZoe,KAAMqI,EAAM1mB,IACZA,IAAK0mB,EAAM1mB,IACXoR,YAAagV,EAAwBvN,GACrCxH,MAAO8U,EAAkBtN,GACzBhM,UAAWH,EAAQyY,UACnBlc,OAAO,SACP+H,SAAUgU,IAGZtf,EAAAC,EAAAC,cAACghB,GAAA,EAAD,CACE/Z,UAAWH,EAAQ6X,iBACnBhU,WAAS,EACTvQ,IAAI,YAEJ0F,EAAAC,EAAAC,cAACihB,GAAA,EAAD,CAAYC,QAAQ,YAAYC,QAAM,GACnCZ,EAAkBtN,GAClB6N,EAAMM,SAAW,IAAM,IAE1BthB,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQ2X,eACtB3e,EAAAC,EAAAC,cAACqhB,GAAA,EAAD,CACE/V,MAAOqV,EACPvV,SAAUyV,EACVS,WAAY,CACV7I,KAAM,YACNhf,GAAI,cAGLgnB,EAAiBtS,IAAI,SAAAoT,GAAQ,OAC5BzhB,EAAAC,EAAAC,cAAA,UAAQ5F,IAAKmnB,EAAUjW,MAAOiW,GAC3BA,MAIPzhB,EAAAC,EAAAC,cAACiL,GAAA,EAAD,CACEO,YAAagV,EAAwBvN,GACrC5Y,KAAK,MACLsQ,WAAS,EACTlR,GAAG,oBACHW,IAAI,oBACJqe,KAAK,oBACLrN,SAAUgU,QAOtBtf,EAAAC,EAAAC,cAACyf,GAAA,EAAD,CAASC,gBAAc,GACrB5f,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQ5B,MAAM,YAAYrB,QAAQ,WAAWkD,QAASuV,GAAtD,QAGAhgB,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQX,SACxBrG,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CACErD,UAAU,cACV0Y,UAAU,SACVjX,MAAM,UACNrB,QAAQ,YACRkD,QAAS0U,GALX,gCC3EFxZ,GAAYC,aAAWuJ,IAuDduS,GArDO,SAAA5hB,GAAoE,IAAjEwf,EAAiExf,EAAjEwf,kBAAmBU,EAA8ClgB,EAA9CkgB,WAAY2B,EAAkC7hB,EAAlC6hB,aAAc1B,EAAoBngB,EAApBmgB,cAC9DjZ,EAAUrB,KAChB,OACE3F,EAAAC,EAAAC,cAACwH,GAAD,KACE1H,EAAAC,EAAAC,cAACiL,GAAA,EAAD,CACExR,GAAG,WACHkR,WAAS,EACTO,WAAS,EACTuN,KAAK,WACLhN,MAAM,WACNxE,UAAWH,EAAQyY,UACnBlc,OAAO,SACP+H,SAAUgU,IAEZtf,EAAAC,EAAAC,cAACiL,GAAA,EAAD,CACExR,GAAG,mBACHkR,WAAS,EACT8N,KAAK,OACLhN,MAAM,oBACNxE,UAAWH,EAAQyY,UACnBlc,OAAO,SACP+H,SAAUgU,IAGZtf,EAAAC,EAAAC,cAAC0hB,GAAA,EAAD,CAAM/B,UAAU,SAAStY,QAAQ,QAAQJ,UAAWH,EAAQ6a,WAAYpX,QAASkX,GAAjF,eAGA3hB,EAAAC,EAAAC,cAACyf,GAAA,EAAD,CAASC,gBAAc,GAErB5f,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQ5B,MAAM,YAAYrB,QAAQ,WAAWkD,QAASuV,GAAtD,QAGAhgB,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQX,SACxBrG,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CACE5B,MAAM,UACNrB,QAAQ,YACRJ,UAAU,cACVsD,QAASwV,GAJX,cCjCFta,GAAYC,aAAWuJ,IAiGd2S,GA/FQ,SAAAhiB,GAAqE,IAAlEiiB,EAAkEjiB,EAAlEiiB,aAAczC,EAAoDxf,EAApDwf,kBAAmB0C,EAAiCliB,EAAjCkiB,eAAgBhC,EAAiBlgB,EAAjBkgB,WAAiBtW,EAClEC,oBAAS,GADyDC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GACnFoN,EADmFlN,EAAA,GAC7EqY,EAD6ErY,EAAA,GAEpF5C,EAAUrB,KAChB,OACE3F,EAAAC,EAAAC,cAACwH,GAAD,KACE1H,EAAAC,EAAAC,cAACoH,GAAA,EAAD,yBACEwP,GACA9W,EAAAC,EAAAC,cAACiL,GAAA,EAAD,CACExR,GAAG,WACHyR,WAAS,EACTP,WAAS,EACTc,MAAM,WACNgN,KAAK,WACLxR,UAAWH,EAAQyY,UACnBlc,OAAO,SACP+H,SAAUgU,IAGbxI,GACC9W,EAAAC,EAAAC,cAACiL,GAAA,EAAD,CACExR,GAAG,aACHkR,WAAS,EACTO,WAAS,EACTO,MAAM,OACNgN,KAAK,OACLxR,UAAWH,EAAQyY,UACnBlc,OAAO,SACP+H,SAAUgU,IAGbxI,GACC9W,EAAAC,EAAAC,cAACiL,GAAA,EAAD,CACExR,GAAG,cACHkR,WAAS,EACTc,MAAM,eACNxE,UAAWH,EAAQyY,UACnBllB,KAAK,WACLoe,KAAK,WACL+G,aAAa,mBACbnc,OAAO,SACP+H,SAAUgU,IAGbxI,GACC9W,EAAAC,EAAAC,cAAC0hB,GAAA,EAAD,CAAM/B,UAAU,SAAStY,QAAQ,QAAQJ,UAAWH,EAAQ6a,WAAYpX,QAASuX,GAAjF,eAKFhiB,EAAAC,EAAAC,cAACyf,GAAA,EAAD,CAASC,gBAAc,GACrB5f,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CACE5B,MAAM,YACNrB,QAAQ,WACRkD,QAAS,WACPqM,EAAOmL,GAAQ,GAASjC,MAJ5B,QASAhgB,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQX,UACtByQ,GACA9W,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CACE5B,MAAM,UACNrB,QAAQ,YACRJ,UAAU,cACVsD,QAAS,WACPwX,GAAQ,GACRD,MANJ,aAYDlL,GACC9W,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CACErD,UAAU,cACVyB,MAAM,UACNrB,QAAQ,YACRkD,QAASsX,GAJX,aC/DVrH,KAAQC,UAAUvJ,IAElB,IAAM8Q,GAAmB,CAAEC,UAAW,OAAQC,SAAU,GAAIC,SAAU,MAqEvDC,GAnEW,WAAM,IAAA5Y,EACuBC,mBAASuY,IADhCtY,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAAA6Y,EAAA3Y,EAAA,GACrBuY,EADqBI,EACrBJ,UAAWC,EADUG,EACVH,SAAUC,EADAE,EACAF,SAAYG,EADZ5Y,EAAA,GAoBxBmS,EAAe,eAAAjc,EAAA3G,OAAAuc,EAAA,EAAAvc,CAAAwc,EAAA1V,EAAA2V,KAAG,SAAAC,IAAA,IAAAmG,EAAA,OAAArG,EAAA1V,EAAAsW,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAAAF,EAAAE,KAAA,EACIrF,QAAK4K,iBADT,cAChBD,EADgBxF,EAAAM,KAEtBhb,QAAQC,IAAI,OAAQigB,EAAYE,aAFV1F,EAAAO,OAAA,SAGfiF,GAAeA,EAAYE,YAAcF,EAAYE,YAAc,MAHpD,wBAAA1F,EAAAY,SAAAvB,MAAH,yBAAA/V,EAAAN,MAAAtG,KAAA8E,YAAA,GAcfykB,EAAaJ,EAAW,KAC1BriB,EAAAC,EAAAC,cAACwiB,GAAA,cAAD,CAAeC,cA7BW,SAAC1a,EAAOkG,GAEpCqU,EAAQ,CACNL,UAAWla,EACXma,SAAUjU,EAEVkU,SAAWpa,GAA0B,IAAjBA,EAAM5L,OAEZ,aAAV4L,GAEEoa,EAHF,QAsBiDO,aAAW,GAChE5iB,EAAAC,EAAAC,cAAC2iB,GAAD,CAAQtD,kBANQ,WAClBiD,EAAQ,CAAEL,YAAWC,WAAUC,UAAU,OAMvCriB,EAAAC,EAAAC,cAAC4iB,GAAD,CAASrb,QAAQ,cACjBzH,EAAAC,EAAAC,cAAC6iB,GAAD,MAEA/iB,EAAAC,EAAAC,cAAC8iB,GAAD,MACAhjB,EAAAC,EAAAC,cAAC+iB,GAAD,MAEAjjB,EAAAC,EAAAC,cAACwiB,GAAA,cAAD,MACA1iB,EAAAC,EAAAC,cAACgjB,GAAD,MACAljB,EAAAC,EAAAC,cAACijB,GAAD,OAIAC,GAAQ,EACZ,IACEA,EAAQhB,EAASiB,kBAAkBC,QAAQC,QAAQ,kBAAkBnnB,QAAQ,aAAe,EAE9F,MAAOe,IAEP,MAAO,CACLglB,YACAC,WACAgB,QACAI,QAjCc,kBAAMnS,QAAKmS,UACxBtM,KAAK,SAAA/I,GAAI,OAAIrS,QAAQC,IAAIoS,KACzBsV,MAAM,SAAA5mB,GAAG,OAAIf,QAAQC,IAAIc,MAgC1Bkf,kBACA2H,YAAa,kBAAMlB,EAAQN,KAC3BG,WACAI,eAMExD,gMACa,IAAAhmB,EAAAC,KACPgmB,EAAYhmB,KAAK+O,MAAjBiX,QACFyE,EAAQxqB,OAAAuV,EAAA,EAAAvV,CAAA,GACTD,KAAK0O,MADI,CAEZsX,UACAE,qBAAsB,kBAAMnmB,EAAK2qB,YAAY,mBAC7CzE,aAAc,kBAAMlmB,EAAK2qB,YAAY,WACrCtE,kBAAmBpmB,KAAKomB,kBACxBE,aAActmB,KAAK2qB,SAErB,OAAO7jB,EAAAC,EAAAC,cAAC4jB,GAAeH,UAXNI,WAefxD,gMACa,IAAAyD,EAAA9qB,KACP+qB,EAAS/qB,KAAK0O,MAAdqc,KACR,GAAIA,GAAQA,EAAKC,SAAS3D,GACxB,OAAO,KAELrnB,KAAKirB,4BACPjrB,KAAKsnB,aAAetnB,KAAK0O,MAAMwc,aAAa5D,cAE9CtnB,KAAKmrB,aAEL,IAAMV,EAAQxqB,OAAAuV,EAAA,EAAAvV,CAAA,GACTD,KAAK0O,MADI,CAEZ+Y,sBACAC,gBAAiB1nB,KAAKorB,qBACtBhF,kBAAmBpmB,KAAKomB,kBACxBkB,aAActnB,KAAKsnB,aACnBC,kBAAmBvnB,KAAKsnB,aAAanS,IAAI,SAAA2S,GAAK,OAAIuD,QAAKC,IAAIxD,EAAMrV,SACjE+U,wBAAyBxnB,KAAKsnB,aAAanS,IAAI,SAAA2S,GAAK,OAAIuD,QAAKC,IAAIxD,EAAMtV,eACvEyT,aAAcjmB,KAAKurB,OACnBzE,WAAY,kBAAMgE,EAAKJ,YAAY,aAErC,OAAO5jB,EAAAC,EAAAC,cAACwkB,GAAef,UAtBNgB,WA0Bf5E,gMACa,IAAA6E,EAAA1rB,KACTyqB,EAAQxqB,OAAAuV,EAAA,EAAAvV,CAAA,GACTD,KAAK0O,MADI,CAEZoY,WAAY,kBAAM4E,EAAKhB,YAAY,WACnCtE,kBAAmBpmB,KAAKomB,kBACxBW,cAAe/mB,KAAK2rB,UAEtB,OAAO7kB,EAAAC,EAAAC,cAAC4kB,GAAsBnB,UARNoB,kBAYtBrD,gMACa,IAAAsD,EAAA9rB,KACTyqB,EAAQxqB,OAAAuV,EAAA,EAAAvV,CAAA,GACTD,KAAK0O,MADI,CAEZoY,WAAY,kBAAMgF,EAAKpB,YAAY,WACnCtE,kBAAmBpmB,KAAKomB,kBACxBW,cAAe/mB,KAAK2rB,QACpBlD,aAAczoB,KAAK+rB,SAErB,OAAOjlB,EAAAC,EAAAC,cAACglB,GAAsBvB,UATNwB,kBAatBjF,gMAEF,IACQE,EADKlnB,KAAK0O,MAAMwa,SACYgD,eAA5BhF,mBACFC,EAAenhB,MAAMmmB,QAAQjF,GAC/BA,EAAmB/R,IAAI,SAAAiS,GAAS,OAAIiE,QAAKC,IAAyBlE,EA8D7DgF,MAAM,KAAKjX,IAAI,SAAAkX,GAAI,OAAIA,EAAKC,OAAO,GAAGC,cAAgBF,EAAKG,OAAO,GAAGC,gBAAeC,KAAK,QA7D9F,GAEEjC,EAAQxqB,OAAAuV,EAAA,EAAAvV,CAAA,GACTD,KAAK0O,MADI,CAEZ0X,kBAAmBpmB,KAAKomB,kBACxBc,qBACAC,eACAF,OAAQjnB,KAAKinB,SAEf,OAAOngB,EAAAC,EAAAC,cAAC2lB,GAA2BlC,UAfNmC,uBAmB3Bte,gMAEF,OAAOxH,EAAAC,EAAAC,cAAC6lB,GAAgB7sB,KAAK0O,cAFXoe,YA8BhBlE,gMACa,IAAAmE,EAAA/sB,KACTyqB,EAAQxqB,OAAAuV,EAAA,EAAAvV,CAAA,GACTD,KAAK0O,MADI,CAEZoY,WAAY,kBAAMiG,EAAKrC,YAAY,WACnCtE,kBAAmBpmB,KAAKomB,kBACxBW,cAAe/mB,KAAK2rB,QACpBlD,aAAczoB,KAAKgtB,KACnBnE,aAAc7oB,KAAKitB,OACnBnE,eAAgB9oB,KAAKgtB,OAEvB,OAAOlmB,EAAAC,EAAAC,cAACkmB,GAAuBzC,UAXN0C,mBCpNtB,IAAMC,GAAiB,WAAM,IAAA5c,EACRC,mBAAS,CACjC4c,SAAU,KACVC,SAAU,KACVC,iBAAkB,KAClBC,QAAS,KACTC,SAAU,KACVC,UAAW,KACXC,MAAO,KACPC,UAAWnrB,KAAKic,QATgBhO,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAC3BzB,EAD2B2B,EAAA,GACpB6D,EADoB7D,EAAA,GAW5Bmd,EAAaliB,mBACbmiB,EAAaniB,mBACnBkiB,EAAW/hB,SAAU,EAErB,IAAMiiB,EAAU,SAAAliB,GACVgiB,EAAW/hB,SACbyI,EAAS,CACP8Y,SAAUxhB,EAAMoT,OAAOoO,SACvBC,SAAUzhB,EAAMoT,OAAOqO,SACvBC,iBAAkB1hB,EAAMoT,OAAOsO,iBAC/BC,QAAS3hB,EAAMoT,OAAOuO,QACtBC,SAAU5hB,EAAMoT,OAAOwO,SACvBC,UAAW7hB,EAAMoT,OAAOyO,UACxBC,MAAO9hB,EAAMoT,OAAO0O,MACpBC,UAAW/hB,EAAM+hB,aAevB,OAVA1hB,oBAAU,WAIR,OAHA8hB,UAAUC,YAAYC,mBAAmBH,GACzCD,EAAWhiB,QAAUkiB,UAAUC,YAAYE,cAAcJ,GAElD,WACLF,EAAW/hB,SAAU,EACrBkiB,UAAUC,YAAYG,WAAWN,EAAWhiB,WAE7C,CAACkiB,UAAUC,cAEPlf,GAgCF,IAAMsf,GAAQ,WACnB,MAAO,oBAAoBC,KAAK9S,OAAOwS,UAAUO,WAAaP,UAAUQ,QAAUhT,OAAOiT,OAAS,0BCnE9FhiB,GAAYC,aAAW,SAAAC,GAAK,MAAK,CACrCC,KAAM,GAGN8hB,QAAS,GAGTC,eAAgB,CACdjhB,QAAS,QAEXL,KAAM,CACJR,OAAQ,GACRtC,MAAO,IAETJ,MAAO,CACLkB,WAAYsB,EAAMjC,QAAQI,KAAKH,QAC/B+E,MAAO/C,EAAMjC,QAAQC,QAAQikB,aAC7Bjf,OAAM,aAAAvN,OAAeuK,EAAMjC,QAAQC,QAAQikB,cAC3CC,UAAS,WAAAzsB,OAAauK,EAAMjC,QAAQC,QAAQC,MAC5CkkB,UAAW,4BACXtf,QAAS7C,EAAM8C,QAAQ,EAAG,GAC1BlF,MAAO,QAETwkB,0BAA2B,CACzBC,KAAM,CACJH,UAAS,aAAAzsB,OAAeuK,EAAMjC,QAAQC,QAAQC,OAEhDqkB,MAAO,CACLJ,UAAS,aAAAzsB,OAAeuK,EAAMjC,QAAQC,QAAQC,OAEhDskB,OAAQ,CACNL,UAAS,2BAGbM,YAAa,CACXpf,SAAU,EACVqf,YAAaziB,EAAM8C,QAAQ,IAE7B4f,QAAS,CACP3hB,QAAS,QAEXP,OAAQ,CACN4C,SAAU,MAyCCuf,GArCO,SAAA1oB,GAAkC,IAA/B8K,EAA+B9K,EAA/B8K,KAAME,EAAyBhL,EAAzBgL,QAAS2d,EAAgB3oB,EAAhB2oB,UAChCzhB,EAAUrB,KAEhB,OACE3F,EAAAC,EAAAC,cAACwoB,GAAA,EAAD,CACEC,aAAc,CACZC,SAAU,SACVC,WAAY,UAEdje,KAAMA,EAENE,QAASA,GAET9K,EAAAC,EAAAC,cAAC4oB,GAAA,EAAD,CAAO3hB,UAAWH,EAAQ3D,MAAO0lB,UAAW,IAC1C/oB,EAAAC,EAAAC,cAAA,OAAKvG,GAAG,kBAAkBwN,UAAWH,EAAQ6gB,gBAC3C7nB,EAAAC,EAAAC,cAACmH,GAAD,CAASF,UAAWH,EAAQT,OAC5BvG,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQqhB,aACtBroB,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,QAAQqB,MAAM,WAAlC,oBACA5I,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,QAAQqB,MAAM,UAAUogB,WAAS,GAArD,6FACAhpB,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQuhB,SACtBvoB,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQ5B,MAAM,YAAYrB,QAAQ,YAAYkD,QAASK,GAAvD,aACA9K,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQX,SACxBrG,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQ5B,MAAM,UAAUrB,QAAQ,YAAYkD,QAASge,GAArD,iBCLCQ,GA7DU,SAACC,EAAaC,GAAmB,IAAAzf,EACpBC,mBAAS,MADWC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GACjD0f,EADiDxf,EAAA,GACjCyf,EADiCzf,EAAA,GAGlD0f,EAAqB,SAAAnsB,GAEzBA,EAAEosB,iBAEFF,EAAUlsB,IAINqsB,EAAgBC,kBAAQ,WAC5B,OAAKP,GAAgBE,EACdppB,EAAAC,EAAAC,cAACwpB,GAAD,CAAe9e,MAAI,EAACE,QAASqe,EAAgBV,UAAWkB,IADnB,MAE3C,CAACT,EAAaE,IAiBjB,SAASO,IAEPP,EAAeQ,SAEfR,EAAeS,WACZ3S,KAAK,SAAC4S,GACwB,aAAzBA,EAAaC,SACfjuB,QAAQC,IAAI,iCACZotB,MAGArtB,QAAQC,IAAI,kCACZotB,KAEFE,EAAU,QAUhB,OAvCAjkB,oBAAU,WAUR,OANImiB,MAtB0B,eAAgB7S,OAAOwS,WAAexS,OAAOwS,UAAU8C,YAuBnFluB,QAAQC,IAAI,gDAId2Y,OAAOpP,iBAAiB,sBAAuBgkB,GACxC,WACL5U,OAAOnP,oBAAoB,sBAAuB+jB,KAEnD,IA0BI,CACLE,gBACAG,gBAAiBH,EAAgBG,EAAkB,OCjCxCM,GAhCG,WAAM,IAAAvgB,EACIC,mBAAS,MADbC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GACfzB,EADe2B,EAAA,GACR6D,EADQ7D,EAAA,GAGhB0B,EAAW,SAACnO,GAChB,GAAIuX,OAAOwS,UAAUgD,OACnBpuB,QAAQC,IAAI,SAAUoB,GACtBsQ,EAAS,UAEN,CACH3R,QAAQC,IAAI,UAAWoB,GACvB,IAAMgtB,EAAUxuB,KAAKic,MACrBnK,EAAS0c,KAeb,OAXA/kB,oBAAU,WAKR,OAJAkG,IACAoJ,OAAOpP,iBAAiB,SAAUgG,GAClCoJ,OAAOpP,iBAAiB,UAAWgG,GAE5B,WACLoJ,OAAOnP,oBAAoB,SAAU+F,GACrCoJ,OAAOnP,oBAAoB,UAAW+F,KAEvC,IAEI,CACL8e,OAAkB,OAAVniB,EACRoiB,aAAcpiB,aCrBZqiB,GAAW,SAACriB,GAAU,IAAAsiB,EACkD7V,OAApE8V,EADkBD,EAClBC,YAAaC,EADKF,EACLE,WAAYC,EADPH,EACOG,YADPC,EAAAJ,EACoBK,OAAUnnB,EAD9BknB,EAC8BlnB,MAAOsC,EADrC4kB,EACqC5kB,OACzD8kB,EAA6C,IAAnC,CAAC,GAAI,KAAKzuB,QAAQouB,GAAqB,WAAa,YAC9DM,EAASvD,KACTwD,EJiEe,WACrB,IAAM9qB,EAAKyU,OAAOwS,UAAUO,WAAaP,UAAUQ,QAAUhT,OAAOiT,OAAS,GAC7E,MAAO,2TACJH,KAAKvnB,IACR,4hDACGunB,KAAKvnB,EAAEylB,OAAO,EAAG,IItEHsF,GACXC,EAAa,CAAExnB,MAAOgnB,EAAY1kB,OAAQ2kB,GAC1CQ,EAAa,CAAEznB,QAAOsC,UAkC5B,OA9BIkC,GAAiE,UAAxDyM,OAAOrP,SAAS8lB,cAAcC,QAAQzF,gBACjD7pB,QAAQC,IAAI,qBACZkvB,EAAWllB,OAASkC,EAAMgjB,WAAWllB,QAmBnB,CAClBilB,QAASD,EACTxD,MAAOuD,EACPN,YAAaK,EACbI,aACAC,eA8CWG,GAvCO,SAACC,GAAiB,IAAA5hB,EACZC,mBAAS2gB,MADG1gB,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAC/BzB,EAD+B2B,EAAA,GACxB6D,EADwB7D,EAAA,GAqBhC2hB,EAAwBC,sBAAYjtB,aAlBrB,SAACpB,GAChBA,IACFA,EAAEosB,iBACFpsB,EAAEsuB,mBAEJ,IAAM3P,EAAWwO,GAASriB,GAC1BnM,QAAQC,IAAI,eAAgB+f,GAC5BrO,EAASqO,IAWsD,KAAM,IAevE,OAZA4P,0BAAgB,WAKd,OAJAH,IACA7W,OAAOpP,iBAAiB,SAAUimB,GAG3B,WACL7W,OAAOnP,oBAAoB,SAAUgmB,KAIzC,IAEOtjB,gCClFI0jB,GAEQ,oBAFRA,GAGgB,4BAHhBA,GAIM,kBAJNA,GAMM,kBANNA,GAOO,mBAPPA,GAQQ,oBARRA,GAUK,iBAVLA,GAWQ,oBAXRA,GAYe,2BAZfA,GAcY,wBAdZA,GAeS,qBAfTA,GAiBF,UAQIC,GACC,SAACC,EAAWjS,GAAZ,MAAwB,CAAErf,KAAMoxB,GAA2Bxd,KAAM,CAAE0d,YAAWjS,YAD/EgS,GAEE,iBAAO,CAAErxB,KAAMoxB,KAFjBC,GAGI,SAAC5Y,EAAU8Y,GAAX,MAA6B,CAAEvxB,KAAMoxB,GAAmCxd,KAAM,CAAE6E,WAAU8Y,kBAH9FF,GAKJ,SAACG,EAAUC,GAAX,MAAwB,CAAEzxB,KAAMoxB,GAAiBxd,KAAM,CAAE4d,WAAUC,aAL/DJ,GAOO,SAACK,GAAD,MAAe,CAAE1xB,KAAMoxB,GAA+Bxd,KAAM8d,IAPnEL,GAQQ,SAACM,GAAD,MAAW,CAAE3xB,KAAMoxB,GAA4Bxd,KAAM+d,IAR7DN,GAUE,iBAAO,CAAErxB,KAAMoxB,KAVjBC,GAWG,SAACO,GAAD,MAAmB,CAAE5xB,KAAMoxB,GAA0Bxd,KAAMge,IAX9DP,GAYI,iBAAO,CAAErxB,KAAMoxB,KAZnBC,GAcA,SAACQ,GAAD,MAAgB,CAAE7xB,KAAMoxB,GAAwBxd,KAAMie,IAdtDR,GAgBS,iBAAO,CAAErxB,KAAMoxB,KAhBxBC,GAiBS,SAACS,GAAD,MAAkB,CAAE9xB,KAAMoxB,GAAkCxd,KAAMke,IC9CpFC,GAAU,CACd,CACEC,KAAM5oB,GAAKsN,aAAaC,KAExB+a,SAAU,CAGRtF,SAAU,kBACVC,WAAY,mBACZ4F,KAAM,MCRNC,GAAW,CACfC,QAAS,GACT1nB,QAAS,CACP2M,OAAQhO,GAAKwM,cAAcC,OCJzBuc,GAAY,CAChB1e,MAAO,GACP2e,aAAc,eCDVC,GAAe,CACnBC,WAAYvF,KACZwF,SAAS,EACTC,cAAc,GCJVC,GAAc,CAClBC,mBAAmB,EACnBjB,SAAU,MCGGkB,8BAAgB,CAAE9e,ILSlB,WAA6B,IAA5BpG,EAA4BjK,UAAA3B,OAAA,QAAA4B,IAAAD,UAAA,GAAAA,UAAA,GAApBsuB,GAASc,EAAWpvB,UAAA3B,OAAA,EAAA2B,UAAA,QAAAC,EAClC1D,EAAe6yB,EAAf7yB,KAAM4T,EAASif,EAATjf,KAEd,OAAQ5T,GACN,KAAKoxB,GAEH,OAD0B1jB,EAAM5L,OAAS,EAAI,CAAC,CAAC4L,EAAM5L,OAAS,IAAM,GAGtE,KAAKsvB,GACH,OAAO1jB,EAAM1L,MAAM,GAAI,GAEzB,KAAKovB,GACH,SAAArwB,OAAAnC,OAAAia,GAAA,EAAAja,CAAW8O,GAAX,CAAkBkG,IACpB,QACE,OAAOlG,IKvByBtE,KJQvB,WAA8B,IAA7BsE,EAA6BjK,UAAA3B,OAAA,QAAA4B,IAAAD,UAAA,GAAAA,UAAA,GAArByuB,GAAUW,EAAWpvB,UAAA3B,OAAA,EAAA2B,UAAA,QAAAC,EACnC1D,EAAe6yB,EAAf7yB,KAAM4T,EAASif,EAATjf,KACNue,EAAqBzkB,EAArBykB,QAAS1nB,EAAYiD,EAAZjD,QAEjB,OAAQzK,GACN,KAAKoxB,GACH,IAAM0B,EAAel0B,OAAAia,GAAA,EAAAja,CAAOuzB,GACtBY,EAAkBD,EAAgBhxB,OAAS,EAAIgxB,EAAgBE,MAAQd,GAASznB,QACtF,OAAO7L,OAAAuV,EAAA,EAAAvV,CAAA,GACF8O,EADL,CAEEjD,QAASsoB,EACTZ,QAASW,IAGb,KAAK1B,GAAL,IACU6B,EAA+BxoB,EAA/BwoB,aAAc1B,EAAiB9mB,EAAjB8mB,aACtB,OAAO3yB,OAAAuV,EAAA,EAAAvV,CAAA,GACF8O,EADL,CAEEykB,UACA1nB,QAAQ7L,OAAAuV,EAAA,EAAAvV,CAAA,GACH6L,EADE,CAELwoB,aAAcA,GAAgB,KAC9B1B,aAAc0B,GAAgB1B,EAAeA,EAAe,SAIlE,KAAKH,GAAL,IACUE,EAAsB1d,EAAtB0d,UACF4B,EADwBtf,EAAXyL,QACS,GAStB8T,EAFwB,IAJZ,CAChB/pB,GAAKwM,cAAcM,UACnB9M,GAAKwM,cAAcO,kBACnB/M,GAAKwM,cAAcQ,oBACnBvU,QAAQ4I,EAAQ2M,QAEU,GAAArW,OAAAnC,OAAAia,GAAA,EAAAja,CAAOuzB,GAAP,CAAgB1nB,IAAW0nB,EACvD,OAAOvzB,OAAAuV,EAAA,EAAAvV,CAAA,GACF8O,EADL,CAEEykB,QAASgB,EACT1oB,QAAQ7L,OAAAuV,EAAA,EAAAvV,CAAA,GACH6L,EADE,CAEL2M,OAAQka,GACL4B,KAIT,QACE,OAAOxlB,IIzD+BsG,SHA7B,WAA+B,IAA9BtG,EAA8BjK,UAAA3B,OAAA,QAAA4B,IAAAD,UAAA,GAAAA,UAAA,GAAtB2uB,GAAWS,EAAWpvB,UAAA3B,OAAA,EAAA2B,UAAA,QAAAC,EACpC1D,EAAe6yB,EAAf7yB,KAAM4T,EAASif,EAATjf,KACNF,EAAwBhG,EAAxBgG,MAAO2e,EAAiB3kB,EAAjB2kB,aAEf,OAAQryB,GAGN,KAAKoxB,GACH,OAAKiB,EAOIzzB,OAAAuV,EAAA,EAAAvV,CAAA,GACF8O,EADL,CAEEgG,MAAK,GAAA3S,OAAAnC,OAAAia,GAAA,EAAAja,CAAM8U,GAAN,CAAaE,MARbhV,OAAAuV,EAAA,EAAAvV,CAAA,GACF8O,EADL,CAEE2kB,aAAcze,IAUpB,KAAKwd,GACH,GAAqB,IAAjB1d,EAAM5R,OACR,OAAOlD,OAAAuV,EAAA,EAAAvV,CAAA,GACF8O,EADL,CAEE2kB,aAAc,OAIhB,IAAMe,EAAQx0B,OAAAia,GAAA,EAAAja,CAAO8U,GACf2f,EAAYD,EAASJ,MAC3B,OAAOp0B,OAAAuV,EAAA,EAAAvV,CAAA,GACF8O,EADL,CAEEgG,MAAO0f,EACPf,aAAcgB,IAIpB,KAAKjC,GACH,OAAOxyB,OAAAuV,EAAA,EAAAvV,CAAA,GACF8O,EADL,CAEE2kB,aAAazzB,OAAAuV,EAAA,EAAAvV,CAAA,GAAMyzB,EAAiBze,KAExC,QACE,OAAOlG,IG5CyC4lB,MFCvC,WAAkC,IAAjC5lB,EAAiCjK,UAAA3B,OAAA,QAAA4B,IAAAD,UAAA,GAAAA,UAAA,GAAzB6uB,GAAcO,EAAWpvB,UAAA3B,OAAA,EAAA2B,UAAA,QAAAC,EACvC1D,EAAe6yB,EAAf7yB,KAAM4T,EAASif,EAATjf,KAEd,OAAQ5T,GACN,KAAKoxB,GAAL,IACUI,EAAsB5d,EAAtB4d,SAAUC,EAAY7d,EAAZ6d,QAClB,OAAO7yB,OAAAuV,EAAA,EAAAvV,CAAA,GAAK8O,EAAZ9O,OAAA20B,GAAA,EAAA30B,CAAA,GAAoB4yB,EAAWC,IAEjC,QACE,OAAO/jB,IEVgD8lB,QDA7D,WAAgD,IAAhC9lB,EAAgCjK,UAAA3B,OAAA,QAAA4B,IAAAD,UAAA,GAAAA,UAAA,GAAxBivB,GAAaG,EAAWpvB,UAAA3B,OAAA,EAAA2B,UAAA,QAAAC,EACtC1D,EAAe6yB,EAAf7yB,KAAM4T,EAASif,EAATjf,KAEd,OAAQ5T,GACN,KAAKoxB,GACH,OAAOxyB,OAAAuV,EAAA,EAAAvV,CAAA,GACF8O,EADL,CAEEgkB,SAAU9d,IAGd,KAAKwd,GACH,OAAOxyB,OAAAuV,EAAA,EAAAvV,CAAA,GACF8O,EADL,CAEEilB,kBAAmB/e,IAGvB,QACE,OAAOlG,gBEdP+lB,GAAgB,CACpB1zB,IAAK,OACLwiB,QAASzD,IAGL4U,GAAmBC,aAAeF,GAAeG,IA4CxCC,GAAA,WACb,IAdyBC,EAcnBpgB,EAbQqgB,uBACZL,GACAI,EACAE,mBACEC,2BACEC,QASN,MAAO,CACLxgB,QACAygB,UAAWC,aAAa1gB,KCvCb2gB,GAZW,SAAAC,GAAa,OAAI,SAACjnB,GAAU,IAAAknB,EACvBV,KAArBngB,EAD4C6gB,EAC5C7gB,MAAOygB,EADqCI,EACrCJ,UAEf,OACE1uB,EAAAC,EAAAC,cAAC6uB,GAAA,EAAD,CAAU9gB,MAAOA,GACfjO,EAAAC,EAAAC,cAAC8uB,GAAA,EAAD,CAAa9P,QAASlf,EAAAC,EAAAC,cAAC6lB,GAAD,MAAa2I,UAAWA,GAC5C1uB,EAAAC,EAAAC,cAAC2uB,EAAkBjnB,sCCSrBjC,GAAYC,aAlBJ,SAAAC,GAAK,MAAK,CACtBC,KAAM,CACJvB,WAAY,QACZqE,MAAO/C,EAAMjC,QAAQC,QAAQikB,aAC7Bpf,QAA4B,EAAnB7C,EAAM8C,QAAQ,IAEzBlB,QAAS,GAGTwnB,QAAS,CACProB,QAAS,QAEXP,OAAQ,CACN4C,SAAU,GAEZimB,aAAc,MA6BVC,GAxBwB,SAAArvB,GAAmC,IAAhCqH,EAAgCrH,EAAhCqH,UAAWnD,EAAqBlE,EAArBkE,KAAMorB,EAAetvB,EAAfsvB,SAC1CpoB,EAAUrB,KAChB,IAAK3B,EAAM,OAAO,KAClB,IAAMyD,EAAO,cAAAnM,OAAiB0I,GAC9B,OACEhE,EAAAC,EAAAC,cAAA,OAAKiH,UAAWkoB,KAAWroB,EAAQlB,KAAMqB,IACvCnH,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQkoB,cACtBlvB,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQioB,SACtBjvB,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYsB,MAAM,WAAWnB,GAC7BzH,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQX,SACxBrG,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYsB,MAAM,WAAWwmB,EAA7B,MAEFpvB,EAAAC,EAAAC,cAACovB,GAAA,EAAD,CAAgB1mB,MAAM,YAAYrB,QAAQ,cAAciE,MAAO4jB,OAaxDD,MAEFI,GAA6B,SAAArhB,GAAwB,IAArBlK,EAAqBkK,EAArBlK,KAAMorB,EAAelhB,EAAfkhB,SAE3CpoB,EAAUwoB,KAChB,OACExvB,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,MACtB9F,EAAAC,EAAAC,cAACkH,GAAA,EAAD,MADF,IAEEpH,EAAAC,EAAAC,cAAC4oB,GAAA,EAAD,CAAO3hB,UAAWH,EAAQ3D,OACxBrD,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,MAApB,+BAIFvH,EAAAC,EAAAC,cAACivB,GAAD,CAAenrB,KAAMA,EAAMorB,SAAUA,MAoBrCI,GAAmB5pB,aAXJ,SAAAC,GAAK,MAAK,CAC7BC,KAAM,CACJC,OAAQ,OACRa,QAAS,OACTC,cAAe,UAEjBxD,MAAO,CACL4F,SAAU,MAMdsmB,GAA2BE,YAAcN,GAAcM,YAChD,2FC7DQ,SAAA5Z,EAAyB+W,EAAc8C,EAAsBC,EAAsBC,GAAnF,IAAAC,EAAAC,EAAAv2B,EAAA,OAAAoc,EAAA1V,EAAAsW,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cACb5a,QAAQC,IAAI,0BAA2B6wB,GAGnCiD,EAAW,IAAIE,KAEnB52B,OAAOiB,KAAKwyB,EAAa7T,QAAQiX,QAAQxV,QAAQ,SAAAyV,GAC/Cn0B,QAAQC,IAAR,sBAAAT,OAAkC20B,EAAlC,MAAA30B,OAA+CsxB,EAAa7T,QAAQiX,OAAOC,GAAUC,UAAU,EAAG,MAClGL,EAASM,OAAOF,EAAUrD,EAAa7T,QAAQiX,OAAOC,MAR3CzZ,EAAAE,KAAA,EAUMyC,GAASK,QAAQoT,EAAapxB,aAVpC,cAUPs0B,EAVOtZ,EAAAM,KAWb+Y,EAASM,OAAO,OAAQL,GAElBv2B,EAAS,CACb0jB,QAAS,CACPmT,eAAgB,uBAElBC,iBAAkB,SAAAC,GAAiB,IACzBC,EAAkBD,EAAlBC,OAAQC,EAAUF,EAAVE,MAEhB10B,QAAQC,IAAI,0BAA2Bw0B,EAAQC,EAAOC,KAAKC,MAAM,IAAMH,EAASC,IAChFd,EAAqB,CAAEN,SAAUqB,KAAKC,MAAM,IAAMH,EAASC,OAI/D10B,QAAQC,IAAI,qBAAsB,CAAE8zB,WAAUt2B,WAzBjCid,EAAAE,KAAA,GA2BPia,KAAMC,KACVhE,EAAa7T,QAAQ8X,IACrBhB,EACAt2B,GACAkqB,MAAM,SAAA5mB,GACNf,QAAQsB,MAAM,mBACdtB,QAAQsB,MAAMP,GACdf,QAAQC,IAAIc,EAAIqM,OAChB0mB,EAAchD,KAnCH,eAAApW,EAAA4F,GAqCbtgB,QArCa0a,EAAAE,KAAA,GAqCqDyC,GAAS/e,OArC9D,eAAAoc,EAAAsa,GAAAta,EAAAM,KAAAN,EAAA4F,GAqCLrgB,IArCKiM,KAAAwO,EAAA4F,GAqCD,+CArCC5F,EAAAsa,IAAAta,EAAAE,KAAA,GAsCPyC,GAAS4X,WAAWnE,EAAapxB,aAtC1B,eAAAgb,EAAAwa,GAuCbl1B,QAvCa0a,EAAAE,KAAA,GAuCwCyC,GAAS/e,OAvCjD,QAAAoc,EAAAya,GAAAza,EAAAM,KAAAN,EAAAwa,GAuCLj1B,IAvCKiM,KAAAwO,EAAAwa,GAuCD,kCAvCCxa,EAAAya,IAwCbtB,IAxCa,yBAAAnZ,EAAAY,SAAAvB,6BAtBf8a,KAAMO,aAAaC,QAAQC,IACzB,SAAAD,GAEE,OADAr1B,QAAQC,IAAI,6BAA8Bo1B,GACnCA,GAET,SAAAt0B,GAEE,OADAf,QAAQC,IAAI,mCAAoCc,GACzCud,QAAQiX,OAAOx0B,KAI1B8zB,KAAMO,aAAaI,SAASF,IAC1B,SAAAE,GAEE,OADAx1B,QAAQC,IAAI,qBAAsBu1B,GAC3BA,GAET,SAAAz0B,GAEE,OADAf,QAAQC,IAAI,oCAAqCc,GAC1Cud,QAAQiX,OAAOx0B,KCf1B,IA+DM00B,GAvB0BnkB,YAAQrK,GAAqB,CAC3DyuB,KAAM,SAAAtjB,GAAA,IAAGkc,EAAHlc,EAAGkc,OAAQqH,EAAXvjB,EAAWujB,MAAX,OAAwBrH,IAAWqH,GACzC7pB,MAAO,SAAA6P,GAAwB,IAArBtJ,EAAqBsJ,EAArBtJ,KAAMZ,EAAekK,EAAflK,SAad,OAZIY,EAAK/Q,OAAOtB,QAAQsB,MAAM+Q,EAAK/Q,OACnCtB,QAAQC,IAAI,oBAAqB,CAAEoS,SAI9BA,EAAK+Q,SACR3R,EAASmkB,OAATv4B,OAAAuV,EAAA,EAAAvV,CAAA,GACKoU,EAASkkB,MADd,CAEEhV,MAAOlP,EAASkkB,MAAMhV,MAAQ,EAC9B1D,QAAS5K,EAAKwjB,iBAGX,CACLxjB,SAGJyjB,QAAS,SAAAC,GAAA,IAAGJ,EAAHI,EAAGJ,MAAH,MAAgB,CACvB1jB,UAAW,CAAEiF,SAAUye,EAAMze,SAAU8e,QAASL,EAAM93B,GAAIoc,IAAK0b,EAAM1b,QAGhDgc,CAAwB,kBAAM,OAmBxC3jB,gBAdS,SAACnG,EAAOL,GAE9B,MAAO,CAAEglB,aADgB3kB,EAAMsG,SAAvBqe,eAIiB,SAAAoF,GAAQ,MAAK,CACtCrC,qBAAsB,WACpBqC,EAASpG,OAEX8D,qBAAsB,SAACrD,GACrB2F,EAASpG,GAA6BS,OAI3Bje,CAlFO,SAAAtO,GAKhB,IAJJ8sB,EAII9sB,EAJJ8sB,aACA+C,EAGI7vB,EAHJ6vB,qBACAD,EAEI5vB,EAFJ4vB,qBACG9nB,EACCzO,OAAAqV,EAAA,EAAArV,CAAA2G,EAAA,gEACEmyB,EAAeptB,mBADjB6E,EAEsBC,qBAFtBC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAEG+nB,EAFH7nB,EAAA,GAEUsoB,EAFVtoB,EAAA,GAGIwgB,EAAW+H,qBAAWztB,IAAtB0lB,OACR6H,EAAajtB,QAAU4nB,EAAeA,EAAa7T,QAAU,KAE7D,IAAMqZ,EAAQ3I,kBAAQ,kBAAMzpB,EAAAC,EAAAC,cAACqxB,GAAD,CAAkBG,OAAQhC,EAAsB+B,MAAOA,KAAW,CAACA,IAW/F,OATArsB,oBAAU,WACR6sB,EAAajtB,QAAUitB,EAAajtB,WAAa4nB,EAE7CxC,GAAUwC,IAAiBqF,EAAajtB,SDGjC,SAAfqS,EAAAC,EAAAC,EAAA8a,GAAAC,GAAA9yB,MAAAtG,KAAA8E,WCDMu0B,CAAS3F,EAAc8C,EAAsBC,EAAsBuC,IAEpE,CAACD,EAAajtB,UAEZ4nB,EAEH5sB,EAAAC,EAAAC,cAACF,EAAAC,EAAMwF,SAAP,KACG2sB,EACDpyB,EAAAC,EAAAC,cAACsyB,GAADr5B,OAAAyV,OAAA,CAAe5K,KAAM,kBAAmBorB,SAAUxC,EAAawC,UAAY,GAAOxnB,KAJ5D,OCrBb6qB,GAAA,CAEbC,MAAO,CACLxuB,OAAQ,CACNyuB,aAAc,CAAC,KACfC,WAAY,CAAC,KACbC,aAAc,CAAC,KACfC,aAAc,CAAC,MAEjB73B,MAAO,CACL83B,aAAc,CAAC,KACfH,WAAY,CAAC,KACbC,aAAc,CAAC,KACfC,aAAc,CAAC,OAInBE,QAAS,CACP/3B,MAAO,CACL23B,WAAY,CAAC,KACbC,aAAc,CAAC,KACfC,aAAc,CAAC,MAEjBG,cAAe,CACbL,WAAY,CAAC,MAEfM,YAAa,CACXN,WAAY,CAAC,OAKjBzd,KAAM,CACJjR,OAAQ,CACNyuB,aAAc,CAAC,KACfQ,WAAY,CAAC,KACbC,aAAc,CAAC,KACfC,aAAc,CAAC,MAEjBJ,cAAe,CACbL,WAAY,CAAC,MAEfM,YAAa,CACXN,WAAY,CAAC,KACbC,aAAc,CAAC,WAEjB53B,MAAO,CACL23B,WAAY,CAAC,KACbD,aAAc,CAAC,KACfS,aAAc,CAAC,KACfC,aAAc,CAAC,QCtDf9d,GAAenI,YAAQrB,GAAc,CACzCnE,MAAO,SAAA9H,GAA0B,IAAvBuN,EAAuBvN,EAAvBuN,OAAQE,EAAezN,EAAfyN,SAChB,MAAO,CACL+lB,qBAAoB,eAAAC,EAAAp6B,OAAAuc,EAAA,EAAAvc,CAAAwc,EAAA1V,EAAA2V,KAAE,SAAAC,IAAA,IAAA9H,EAAAsI,EAAAC,EAAA,OAAAX,EAAA1V,EAAAsW,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAGd3I,EAAY,CAChBpU,GAAI4T,EAASigB,cAETnX,EAAqB,CACzBtK,aAAcwB,EAASigB,cAPLhX,EAAAE,KAAA,EASUG,GAAoB,CAAE9I,YAAWsI,sBAAsBtK,IATjE,cASduK,EATcE,EAAAM,KAAAN,EAAAO,OAAA,SAWb1J,EAAO,CACZU,YACAsI,qBACArI,OAAQgJ,OACPE,KAAK,SAAA/I,GAIN,OAFArS,QAAQC,IAAI,8BAA+B,CAAEoS,OAAMmI,oBACnDa,GAAmBb,GACZnI,KAnBW,wBAAAqI,EAAAY,SAAAvB,MAAF,yBAAA0d,EAAA/zB,MAAAtG,KAAA8E,YAAA,OA0BpBgZ,GAAc,SAAC5X,EAASoY,GAAV,OAAiB,SAACvJ,EAADC,GAAqB,IAAXC,EAAWD,EAAXC,KAE7CrS,QAAQC,IAAI,oCAAqC,CAAEoS,SACnDmG,GAAiBrG,EAAOE,EAAKpC,cAAc,GAC3C8H,GAAgB5F,EAAO,CAAEtU,GAAIwU,EAAKpC,eAAgB,GAClDwI,GAAWtG,EAAO,CAAEtU,GAAIwU,EAAKpC,cAAgB,MAAM,GAE/CyL,GAAIA,EAAGrJ,EAAKzB,aAAaxI,OAAOvK,MAGvB65B,GAAA,CACbje,gBACAyB,gBCvCWzB,GAAenI,YAAQnB,GAAc,CAChDrE,MAAO,SAAA9H,GAA0B,IAAvBuN,EAAuBvN,EAAvBuN,OAAQE,EAAezN,EAAfyN,SAChB,MAAO,CACLkmB,qBAAoB,eAAAC,EAAAv6B,OAAAuc,EAAA,EAAAvc,CAAAwc,EAAA1V,EAAA2V,KAAE,SAAAC,EAAO3R,EAAQyvB,GAAf,IAAA3d,EAAArc,EAAAsc,EAAAC,EAAAC,EAAAC,EAAArI,EAAAsI,EAAAC,EAAA,OAAAX,EAAA1V,EAAAsW,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAAAV,EACgCzI,EAAS4H,KAArDxb,EADYqc,EACZrc,GAAIsc,EADQD,EACRC,SAAUC,EADFF,EACEE,gBAAiBC,EADnBH,EACmBG,SACjCC,EAAgB,CAAEzc,KAAIsc,WAAUC,kBAAiBC,WAAUvC,WAAY,eAEvE7F,EAAY,CAChB7J,OAAQwO,KAAEgB,KAAKigB,EAAaxnB,KAExBkK,EAAqBO,GAAyB,CAAER,gBAAelS,SAAQyvB,gBAPzDnd,EAAAE,KAAA,EAQUG,GAAoB,CAAE9I,YAAWsI,sBAAsBpK,IARjE,cAQdqK,EARcE,EAAAM,KAAAN,EAAAO,OAAA,SAUb1J,EAAO,CACZU,YAEAsI,qBACArI,OAAQgJ,OACPE,KAAK,SAAA/I,GAIN,OAFArS,QAAQC,IAAI,8BAA+BoS,GAC3CgJ,GAAmBb,GACZnI,KAnBW,wBAAAqI,EAAAY,SAAAvB,MAAF,gBAAAwB,EAAAC,GAAA,OAAAoc,EAAAl0B,MAAAtG,KAAA8E,YAAA,OA0BpBgZ,GAAc,SAAC5X,EAASoY,GAAV,OAAiB,SAACvJ,EAADC,GAAqB,IAAXC,EAAWD,EAAXC,KAE7CmE,GAAqBrE,EAAOE,EAAKlC,cACjC4H,GAAgB5F,EAAOE,EAAKlC,cAC5BsI,GAAWtG,EAAOE,EAAKzB,aAAaxI,OAAQiK,EAAKylB,cAAc1vB,OAAO+O,OAAO,MAGzE2D,GAA2B,SAAAa,GAAA,IAAGrB,EAAHqB,EAAGrB,cAAelS,EAAlBuT,EAAkBvT,OAAQyvB,EAA1Blc,EAA0Bkc,YAA1B,MAA6C,CAC5E1nB,aAAa9S,OAAAuV,EAAA,EAAAvV,CAAA,GACR+K,EACAyvB,EAFO,CAGV7b,YAAa1B,EACb4B,UAAW5B,EAAczc,GACzBia,WAAY,aAIDigB,GAAA,CACbte,gBACAyB,gBClDIzB,GAAenI,YAAQvB,GAAa,CACxCjE,MAAO,SAAA9H,GAA0B,IAAvBuN,EAAuBvN,EAAvBuN,OAAQE,EAAezN,EAAfyN,SAChB,MAAO,CACLumB,oBAAmB,eAAAC,EAAA56B,OAAAuc,EAAA,EAAAvc,CAAAwc,EAAA1V,EAAA2V,KAAE,SAAAC,EAAOic,GAAP,IAAA/jB,EAAAsI,EAAAC,EAAA,OAAAX,EAAA1V,EAAAsW,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAGb3I,EAAY,CAChBiF,SAAUzF,EAASrJ,OAAOvK,GAC1Bm4B,WAEIzb,EAAqB,CACzBxK,YAAaimB,GARItb,EAAAE,KAAA,EAUWG,GAAoB,CAAE9I,YAAWsI,sBAAsBxK,IAVlE,cAUbyK,EAVaE,EAAAM,KAAAN,EAAAO,OAAA,SAYZ1J,EAAO,CACZU,YACAsI,qBACArI,OAAQgJ,GAAY,CAAE9S,OAAQqJ,EAASrJ,WACtCgT,KAAK,SAAA/I,GAIN,OAFArS,QAAQC,IAAI,6BAA8BoS,GAC1CgJ,GAAmBb,GACZnI,KApBU,wBAAAqI,EAAAY,SAAAvB,MAAF,gBAAAwB,GAAA,OAAA0c,EAAAv0B,MAAAtG,KAAA8E,YAAA,OA2BnBgZ,GAAc,SAAC5X,EAASoY,GAAV,OAAiB,SAACvJ,EAADC,GAAqB,IAAXC,EAAWD,EAAXC,KAE7C8F,GAAqBhG,EAAO,KAAM,CAAEtU,GAAIwU,EAAKtC,cAAe,GAC5D0I,GAAWtG,EAAO7O,EAAQ8E,OAAQ,CAAEvK,GAAIwU,EAAKtC,YAAamH,SAAU5T,EAAQ8E,OAAO8O,WAAY,KAGlFghB,GAAA,CACbze,gBACAyB,gBCpCIzB,GAAenI,YAAQb,GAAa,CACxC3E,MAAO,SAAA9H,GAA0B,IAAvBuN,EAAuBvN,EAAvBuN,OAAQE,EAAezN,EAAfyN,SAChB,MAAO,CACL0mB,oBAAmB,eAAAC,EAAA/6B,OAAAuc,EAAA,EAAAvc,CAAAwc,EAAA1V,EAAA2V,KAAE,SAAAC,EAAO3R,EAAQ7I,EAAU0a,GAAzB,IAAAoe,EAAAne,EAAArc,EAAAsc,EAAAC,EAAAC,EAAAC,EAAArI,EAAAsI,EAAAC,EAAA,OAAAX,EAAA1V,EAAAsW,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,eAGbyd,EAAgBzhB,KAAEC,UAAUtX,IACf2X,UAAYzF,EAASigB,eACtC2G,EAAcnhB,SAAWzF,EAASigB,cALjBxX,EAOiCzI,EAAS4H,KAArDxb,EAPWqc,EAOXrc,GAAIsc,EAPOD,EAOPC,SAAUC,EAPHF,EAOGE,gBAAiBC,EAPpBH,EAOoBG,SACjCC,EAAgB,CAAEzc,KAAIsc,WAAUC,kBAAiBC,WAAUvC,WAAY,eACvE7F,EAAY,CAChB9S,MAAOyX,KAAEgB,KAAKygB,EAAe1nB,IAC7BsJ,OAEIM,EAAqBO,GAAyB,CAAER,gBAAelS,SAAQ7I,WAAU0a,QAbpES,EAAAE,KAAA,EAcWG,GAAoB,CAAE9I,YAAWsI,sBAAsB9J,IAdlE,cAcb+J,EAdaE,EAAAM,KAAAN,EAAAO,OAAA,SAgBZ1J,EAAO,CACZU,YACAsI,qBACArI,OAAQgJ,GAAY,CAAE9S,aACrBgT,KAAK,SAAA/I,GAIN,OAFArS,QAAQC,IAAI,6BAA8BoS,GAC1CgJ,GAAmBb,GACZnI,KAxBU,yBAAAqI,EAAAY,SAAAvB,MAAF,gBAAAwB,EAAAC,EAAAC,GAAA,OAAA2c,EAAA10B,MAAAtG,KAAA8E,YAAA,OA+BnBgZ,GAAc,SAAC5X,EAASoY,GAAV,OAAiB,SAACvJ,EAADC,GAAqB,IAAXC,EAAWD,EAAXC,KAE7CrS,QAAQC,IAAI,cAAe,CAAEqD,UAAS+O,SACtC2E,GAA0B7E,EAAOE,EAAK5B,YAAYtR,OAClDgZ,GAAqBhG,EAAO7O,EAAQ8E,OAAQiK,EAAK5B,YAAYtR,OAC7DsZ,GAAWtG,EAAO7O,EAAQ8E,OAAQiK,EAAK5B,YAAYtR,SAG/C2b,GAA2B,SAAAa,GAAA,IAAGrB,EAAHqB,EAAGrB,cAAelS,EAAlBuT,EAAkBvT,OAAQ7I,EAA1Boc,EAA0Bpc,SAA1Boc,EAAoC1B,IAApC,MAA+C,CAC9ExJ,YAAa,CACXtR,MAAO,CACLtB,GAAI0B,EAAS1B,GACbU,KAAMgB,EAAShB,MAAQ,KACvB2Y,SAAU9O,EAAOvK,GACjBge,UAAWhc,KAAKic,MAAM9J,WACtB+J,YAAazB,EACb0B,YAAa1B,EACb2B,UAAW3B,EAAczc,GACzBqe,UAAW5B,EAAczc,GACzB6B,YAAaH,EAASG,YACtByc,UAAWtc,KAAKic,MAAM9J,WACtBoK,gBAAiBhU,EAAO2T,YAAYle,GACpC8B,QAASJ,EAASI,QAClB0c,OAAQ9c,EAAS8c,QAAU,KAC3B3e,KAAM6B,EAAS7B,MAAQ,GACvB4e,MAAO,CACLC,KAAM,KACNC,MAAO,KACPC,KAAM,KACNC,MAAO,KACPC,OAAQ,KACR7E,WAAY,SAEdA,WAAY,SAEdmF,QAAS,KACTnF,WAAY,cAIDwgB,GAAA,CACb7e,gBACAyB,gBC5EIzB,GAAenI,YAAQhB,GAAa,CACxCxE,MAAO,SAAA9H,GAA0B,IAAvBuN,EAAuBvN,EAAvBuN,OAAQE,EAAezN,EAAfyN,SAChB,MAAO,CACL8mB,oBAAmB,eAAAC,EAAAn7B,OAAAuc,EAAA,EAAAvc,CAAAwc,EAAA1V,EAAA2V,KAAE,SAAAC,EAAO5a,EAAOs5B,GAAd,IAAAC,EAAAxe,EAAArc,EAAAsc,EAAAC,EAAAC,EAAApI,EAAAsI,EAAAC,EAAA,OAAAX,EAAA1V,EAAAsW,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAGb8d,EAAiB9hB,KAAEgB,KAAK6gB,EAAYjoB,KACvB9S,MAAQg7B,EAAeh7B,KAAK6C,OAAS,IACtDm4B,EAAeh7B,KAAOg7B,EAAeh7B,KAAK6U,IAAI,SAAAomB,GAC5C,IAAMC,EAAOhiB,KAAEgB,KAAK+gB,EAAG,CAAE,QAAS,SAAU,WAE5C,OADIC,EAAKvc,SAAQuc,EAAKvc,OAASzF,KAAEgB,KAAKghB,EAAKvc,OAAQ,CAAE,IAAK,OACnDuc,KARQ1e,EAYiCzI,EAAS4H,KAArDxb,EAZWqc,EAYXrc,GAAIsc,EAZOD,EAYPC,SAAUC,EAZHF,EAYGE,gBAAiBC,EAZpBH,EAYoBG,SAEjCpI,EAAY,CAChB9S,MAAOu5B,GAEHne,EAAqBO,GAAyB,CAAER,cAJhC,CAAEzc,KAAIsc,WAAUC,kBAAiBC,WAAUvC,WAAY,eAIR3Y,QAAOs5B,eAjBzD/d,EAAAE,KAAA,EAkBWG,GAAoB,CAAE9I,YAAWsI,sBAAsBjK,IAlBlE,cAkBbkK,EAlBaE,EAAAM,KAAAN,EAAAO,OAAA,SAoBZ1J,EAAO,CACZU,YACAsI,qBACArI,OAAQgJ,GAAY,CAAE/b,YACrBic,KAAK,SAAA/I,GAIN,OAFArS,QAAQC,IAAI,6BAA8BoS,GAC1CgJ,GAAmBb,GACZnI,KA5BU,yBAAAqI,EAAAY,SAAAvB,MAAF,gBAAAwB,EAAAC,GAAA,OAAAgd,EAAA90B,MAAAtG,KAAA8E,YAAA,OAmCnBgZ,GAAc,SAAC5X,EAASoY,GAAV,OAAiB,SAACvJ,EAADC,GAAqB,IAAXC,EAAWD,EAAXC,KAE7C2E,GAA0B7E,EAAD9U,OAAAuV,EAAA,EAAAvV,CAAA,GAAaiG,EAAQnE,MAAUkT,EAAK/B,cAC7D6H,GAAqBhG,EAAO,KAAR9U,OAAAuV,EAAA,EAAAvV,CAAA,GAAmBiG,EAAQnE,MAAUkT,EAAK/B,cAC9DmI,GAAWtG,EAAO,KAAR9U,OAAAuV,EAAA,EAAAvV,CAAA,GAAmBiG,EAAQnE,MAAUkT,EAAK/B,cAEhDoL,GAAIA,EAAGrJ,EAAKzB,aAAaxI,OAAOvK,MAGhCid,GAA2B,SAAAa,GAAA,IAAGrB,EAAHqB,EAAGrB,cAAenb,EAAlBwc,EAAkBxc,MAAOs5B,EAAzB9c,EAAyB8c,WAAzB,MAA2C,CAC1EnoB,YAAYjT,OAAAuV,EAAA,EAAAvV,CAAA,GACP8B,EACAs5B,EAFM,CAGTzc,YAAa1B,EACb4B,UAAW5B,EAAczc,GACzBia,WAAY,YAID+gB,GAAA,CACbpf,gBACAyB,gBC7DIzB,GAAenI,YAAQP,GAAa,CACxCjF,MAAO,SAAA9H,GAA0B,IAAvBuN,EAAuBvN,EAAvBuN,OAAQE,EAAezN,EAAfyN,SAChB,MAAO,CACLqnB,oBAAmB,eAAAC,EAAA17B,OAAAuc,EAAA,EAAAvc,CAAAwc,EAAA1V,EAAA2V,KAAE,SAAAC,IAAA,IAAA9H,EAAAsI,EAAAC,EAAA,OAAAX,EAAA1V,EAAAsW,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAGb3I,EAAY,CAChBiF,SAAUzF,EAASigB,cAEfnX,EAAqB,CACzBxJ,YAAaU,EAASigB,cAPLhX,EAAAE,KAAA,EASWG,GAAoB,CAAE9I,YAAWsI,sBAAsBxJ,IATlE,cASbyJ,EATaE,EAAAM,KAAAN,EAAAO,OAAA,SAWZ1J,EAAO,CACZU,YACAsI,qBACArI,OAAQgJ,OACPE,KAAK,SAAA/I,GAIN,OAFArS,QAAQC,IAAI,6BAA8BoS,GAC1CgJ,GAAmBb,GACZnI,KAnBU,wBAAAqI,EAAAY,SAAAvB,MAAF,yBAAAgf,EAAAr1B,MAAAtG,KAAA8E,YAAA,OA0BnBgZ,GAAc,SAAC5X,EAASoY,GAAV,OAAiB,SAACvJ,EAADC,GAAqB,IAAXC,EAAWD,EAAXC,KAE7C+G,GAAYjH,EAAOE,EAAKtB,eAGXioB,GAAA,CACbvf,gBACAyB,gBCpCIzB,GAAenI,YAAQL,GAAe,CAC1CnF,MAAO,SAAA9H,GAA0B,IAAvBuN,EAAuBvN,EAAvBuN,OAAQE,EAAezN,EAAfyN,SAChB,MAAO,CACLwnB,sBAAqB,eAAAC,EAAA77B,OAAAuc,EAAA,EAAAvc,CAAAwc,EAAA1V,EAAA2V,KAAE,SAAAC,IAAA,IAAA9H,EAAAsI,EAAAC,EAAA,OAAAX,EAAA1V,EAAAsW,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAGf3I,EAAY,CAChBiF,SAAUzF,EAASigB,cAEfnX,EAAqB,CACzBtJ,cAAeQ,EAASigB,cAPLhX,EAAAE,KAAA,EASSG,GAAoB,CAAE9I,YAAWsI,sBAAsBtJ,IAThE,cASfuJ,EATeE,EAAAM,KAAAN,EAAAO,OAAA,SAWd1J,EAAO,CACZU,YACAsI,qBACArI,OAAQgJ,OACPE,KAAK,SAAA/I,GAIN,OAFArS,QAAQC,IAAI,+BAAgCoS,GAC5CgJ,GAAmBb,GACZnI,KAnBY,wBAAAqI,EAAAY,SAAAvB,MAAF,yBAAAmf,EAAAx1B,MAAAtG,KAAA8E,YAAA,OA0BrBgZ,GAAc,SAAC5X,EAASoY,GAAV,OAAiB,SAACvJ,EAADC,GAAqB,IAAXC,EAAWD,EAAXC,KAE7C+G,GAAYjH,EAAOE,EAAKpB,eAAe,KAG1BkoB,GAAA,CACb1f,gBACAyB,wPCzCWke,GAAgBv1B,IAAMC,cAAc,ICQ3C+F,GAAYC,aAAW,SAAAC,GAAK,MAAK,CACrCC,KAAM,GAENqvB,MAAO,CACLruB,UAAW,UAEbsuB,QAAS,CACP1sB,QAAS7C,EAAM8C,QAAQ,IAEzB0sB,OAAQ,CACN5xB,MAAO,OACPsC,OAAQ,QAyCGuvB,GArCG,SAAAx1B,GAAuB,IAApBgL,EAAoBhL,EAApBgL,QAASF,EAAW9K,EAAX8K,KACtB5D,EAAUrB,KACRzB,EAAWiuB,qBAAW+C,IAAtBhxB,OAF+BwF,EAGPC,mBAAS,MAHFC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAGhC6rB,EAHgC3rB,EAAA,GAGtB4rB,EAHsB5rB,EAAA,GAIjC6rB,EAAM,CAAEl7B,KAAM,SAAUZ,GAAIuK,EAAOvK,IACnC+7B,EAAYC,UAAUx6B,KAAKC,UAAUq6B,IACrC5E,EAAG,GAAAv1B,OAAMuS,eAAN,aAAAvS,OAAwCo6B,GASjD,OAPAhK,0BAAgB,WACdkK,KAAO9nB,SAAS+iB,EAAK,SAACh0B,EAAKg5B,GACrBh5B,EAAKf,QAAQsB,MAAMP,GAClB24B,EAAYK,MAElB,CAAC3xB,IAGFlE,EAAAC,EAAAC,cAACyK,GAAA,EAAD,CACEC,KAAMA,EACNC,WAAS,EAETC,QAASA,EACT3D,UAAWH,EAAQlB,MAEnB9F,EAAAC,EAAAC,cAAC4oB,GAAA,EAAD,CAAO3hB,UAAWH,EAAQouB,SACxBp1B,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,YAAYsY,UAAU,MAAM1Y,UAAWH,EAAQmuB,OAAQjxB,EAAOyU,MAClF3Y,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQquB,OAAQS,wBAAyB,CAAEC,OAAQR,KAClErxB,EAAOiU,QAAUnY,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYuY,UAAU,MAAM1Y,UAAWH,EAAQmuB,OAA/C,KAAyDjxB,EAAOiU,OAAO,GAAvE,KAA6EjU,EAAOiU,OAAO,GAA3F,SChDXzS,QACb1F,EAAAC,EAAAC,cAACF,EAAAC,EAAMwF,SAAP,KACEzF,EAAAC,EAAAC,cAAA,QAAM5C,EAAE,6DACR0C,EAAAC,EAAAC,cAAA,QAAM81B,EAAE,IAAIC,EAAE,IAAIxyB,MAAM,IAAIsC,OAAO,MACnC/F,EAAAC,EAAAC,cAAA,QAAM81B,EAAE,KAAKC,EAAE,IAAIxyB,MAAM,IAAIsC,OAAO,MACpC/F,EAAAC,EAAAC,cAAA,QAAM81B,EAAE,IAAIC,EAAE,KAAKxyB,MAAM,IAAIsC,OAAO,MACpC/F,EAAAC,EAAAC,cAAA,QAAM81B,EAAE,KAAKC,EAAE,KAAKxyB,MAAM,IAAIsC,OAAO,MACrC/F,EAAAC,EAAAC,cAAA,QAAM81B,EAAE,KAAKC,EAAE,KAAKxyB,MAAM,IAAIsC,OAAO,MACrC/F,EAAAC,EAAAC,cAAA,QAAM81B,EAAE,KAAKC,EAAE,KAAKxyB,MAAM,IAAIsC,OAAO,MACrC/F,EAAAC,EAAAC,cAAA,QAAM81B,EAAE,KAAKC,EAAE,IAAIxyB,MAAM,IAAIsC,OAAO,MACpC/F,EAAAC,EAAAC,cAAA,QAAM81B,EAAE,KAAKC,EAAE,IAAIxyB,MAAM,IAAIsC,OAAO,MACpC/F,EAAAC,EAAAC,cAAA,QAAM81B,EAAE,IAAIC,EAAE,KAAKxyB,MAAM,IAAIsC,OAAO,MACpC/F,EAAAC,EAAAC,cAAA,QAAM81B,EAAE,IAAIC,EAAE,KAAKxyB,MAAM,IAAIsC,OAAO,MACpC/F,EAAAC,EAAAC,cAAA,QAAM81B,EAAE,IAAIC,EAAE,KAAKxyB,MAAM,IAAIsC,OAAO,MACpC/F,EAAAC,EAAAC,cAAA,QAAM81B,EAAE,KAAKC,EAAE,IAAIxyB,MAAM,IAAIsC,OAAO,MACpC/F,EAAAC,EAAAC,cAAA,QAAM81B,EAAE,KAAKC,EAAE,IAAIxyB,MAAM,IAAIsC,OAAO,MACpC/F,EAAAC,EAAAC,cAAA,QAAM81B,EAAE,KAAKC,EAAE,KAAKxyB,MAAM,IAAIsC,OAAO,MACrC/F,EAAAC,EAAAC,cAAA,QAAM81B,EAAE,KAAKC,EAAE,KAAKxyB,MAAM,IAAIsC,OAAO,MACrC/F,EAAAC,EAAAC,cAAA,QAAM81B,EAAE,KAAKC,EAAE,KAAKxyB,MAAM,IAAIsC,OAAO,MACrC/F,EAAAC,EAAAC,cAAA,QAAM81B,EAAE,KAAKC,EAAE,KAAKxyB,MAAM,IAAIsC,OAAO,MACrC/F,EAAAC,EAAAC,cAAA,QAAM81B,EAAE,KAAKC,EAAE,KAAKxyB,MAAM,IAAIsC,OAAO,MACrC/F,EAAAC,EAAAC,cAAA,QAAM81B,EAAE,KAAKC,EAAE,KAAKxyB,MAAM,IAAIsC,OAAO,OACpB,gECZfJ,GAAYC,aAAW,SAAAC,GAC3B,IAAMqwB,EAAWjyB,gBAAK4B,EAAMjC,QAAQG,UAAUoyB,MAAO,IACrD,MAAO,CACLrwB,KAAM,GAENswB,IAAK,CACH7xB,WAAYsB,EAAMjC,QAAQG,UAAUD,KACpC8E,MAAO/C,EAAMjC,QAAQG,UAAU+jB,aAC/BuO,YAAa,CACXzO,QAAS,OACThhB,QAAS,QACTX,SAAU,WACVxC,MAAO,OACPsC,OAAQ,OACR0Y,aAAc,UACdsJ,UAAS,WAAAzsB,OAAa46B,GACtBlO,UAAW,eACXsO,wBAAyB,EACzBC,wBAAyB,WAG7BC,sBAAuB,CACrBtO,KAAM,CACJH,UAAS,aAAAzsB,OAAe46B,IAE1BO,MAAO,CACL1O,UAAS,aAAAzsB,OAAe46B,IAE1B9N,OAAQ,CACNL,UAAS,2BAGb2O,YAAa,GAEbC,cAAe,CACb/vB,QAAS,QAEXgwB,eAAgB,CACd3wB,SAAU,WACV4wB,OAAQ,KACR1wB,KAAM,MACN2wB,gBAAiB,UACjBC,UAAW,qCAEbC,gBAAiB,CACftuB,QAAS7C,EAAM8C,QAAQ,IAEzBsuB,OAAQ,GAIRC,WAAY,CACV3zB,OAAQsC,EAAM8C,QAAQ,OAgKbwuB,GA3JA,SAAAr3B,GAAmE,IAAhEqH,EAAgErH,EAAhEqH,UAAWpH,EAAqDD,EAArDC,SAAUq3B,EAA2Ct3B,EAA3Cs3B,cAAeC,EAA4Bv3B,EAA5Bu3B,eAAgB9P,EAAYznB,EAAZynB,MAAY7d,EACxDC,oBAAS,GAD+CC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GACzEkB,EADyEhB,EAAA,GACnE0tB,EADmE1tB,EAAA,GAAAI,EAExDL,oBAAS,GAF+CM,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAEzEutB,EAFyEttB,EAAA,GAEnEutB,EAFmEvtB,EAAA,GAI1EwtB,EAAW5yB,mBACXmC,EAAUrB,KAEV+xB,EAAU7yB,iBAAO0yB,GACjBI,EAAQ9yB,mBACd6yB,EAAQ1yB,QAAUuyB,EAGlBnyB,oBAAU,kBAAM,WAEdqyB,EAASzyB,QAAU,KACnB0yB,EAAQ1yB,QAAU,OACjB,IAEH,IAaM4yB,EAAS,SAACz6B,GAGHA,EAAE06B,cAfTtQ,GACCoQ,EAAM3yB,UAEXwyB,GAAQ,GACH5sB,GAAS6sB,EAASzyB,UACrByyB,EAASzyB,QAAUzF,WAAW,WACxBm4B,EAAQ1yB,SAASsyB,GAAQ,GAC7BG,EAASzyB,QAAU,MAClB,QAUD8yB,EAAQ,SAAC36B,GACTA,GAAKA,EAAEsuB,kBACTtuB,EAAEsuB,kBACFtuB,EAAEosB,mBAmBN,OACEvpB,EAAAC,EAAAC,cAAA,OAAKiH,UAAWkoB,KAAWroB,EAAQ+wB,cAAe5wB,GAAYD,IAAKywB,GACjE33B,EAAAC,EAAAC,cAAC83B,GAAA,EAAD,CACE7wB,UAAWH,EAAQovB,IACnB6B,YAAaL,EAEbM,aAAcN,EAEdntB,QAAS,SAACtN,GACR26B,EAAM36B,GACNq6B,GAAQ,GACH5sB,IACH9O,QAAQC,IAAI,oBACZq7B,MAGJe,oBAAkB,EAClBC,oBAAkB,EAClBC,eAAa,EACbvY,KAAK,QACLlX,MAAM,YACN0vB,aAAW,OAEVv4B,GAEHC,EAAAC,EAAAC,cAACq4B,GAAA,EAAD,CACExtB,kBAAgB,qBAChBytB,mBAAiB,2BACjB5tB,KAAMA,EACNE,QAAS,kBAAMwsB,GAAQ,KAEvBt3B,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQ4vB,gBACtB52B,EAAAC,EAAAC,cAACu4B,GAAA,EAAD,CACEC,GAAI9tB,EACJ7L,QAAS,IACT45B,eAAa,GAEb34B,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQgwB,iBACtBh3B,EAAAC,EAAAC,cAAC83B,GAAA,EAAD,CACE7wB,UAAWH,EAAQiwB,OACnBkB,oBAAkB,EAClB5wB,QAAQ,WACRuY,KAAK,QACLlX,MAAM,YACN0vB,aAAW,MACX7tB,QAAS,WArDD,IAACtN,EAsDPm6B,GAAQ,GArDtBx7B,QAAQC,IAAI,gBACZu7B,GAAQ,GACRE,GAAQ,GACRH,IACAS,EAAM36B,KAqDM6C,EAAAC,EAAAC,cAAC04B,GAAA34B,EAAD,CAAkB2I,MAAM,UAAUzB,UAAWH,EAAQkwB,aAZvD,aAiBJl3B,EAAAC,EAAAC,cAACu4B,GAAA,EAAD,CACEC,GAAI9tB,EACJ7L,QAAS,IAIT45B,eAAa,GAEb34B,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQgwB,iBACtBh3B,EAAAC,EAAAC,cAAC83B,GAAA,EAAD,CACE7wB,UAAWH,EAAQiwB,OACnBkB,oBAAkB,EAClB5wB,QAAQ,WACRuY,KAAK,QACLlX,MAAM,YACN0vB,aAAW,MACX7tB,QAAS,WAtFF,IAACtN,EAuFNm6B,GAAQ,GAtFtBx7B,QAAQC,IAAI,eACZu7B,GAAQ,GACRE,GAAQ,GACRJ,IACAU,EAAM36B,KAsFM6C,EAAAC,EAAAC,cAAC24B,GAAA54B,EAAD,CAAe2I,MAAM,UAAUzB,UAAWH,EAAQkwB,aAZpD,sECxIC4B,GA/CK,SAAAh5B,GAAsC,IAAnCi5B,EAAmCj5B,EAAnCi5B,SAAUjuB,EAAyBhL,EAAzBgL,QAASkuB,EAAgBl5B,EAAhBk5B,UACxC,OACEh5B,EAAAC,EAAAC,cAAC+4B,GAAA,EAAD,CACEF,SAAUA,EACVnuB,OAAQmuB,EACRjuB,QAASA,GAERkuB,EAAU3qB,IAAI,SAAAH,EAAyDiF,GAAQ,IAA9DpK,EAA8DmF,EAA9DnF,KAAMH,EAAwDsF,EAAxDtF,MAAO5E,EAAiDkK,EAAjDlK,KAAMigB,EAA2C/V,EAA3C+V,KAAM3Z,EAAqC4D,EAArC5D,SAAU8iB,EAA2Blf,EAA3Bkf,OAAQ8L,EAAmBhrB,EAAnBgrB,QACrDnqB,EAAOhG,GAAQ,KACrB,OAAIkb,EAAa,KACbiV,EAAgBl5B,EAAAC,EAAAC,cAACi5B,GAAA,EAAD,CAAS7+B,IAAG,eAAAgB,OAAiB6X,KAE/CnT,EAAAC,EAAAC,cAACk5B,GAAA,EAAD,CACEtwB,QAAM,EACNxO,IAAG,eAAAgB,OAAiB6X,GACpB7I,SAAUA,EACVG,QAAS,WACPK,IACAsiB,MAEDre,GACC/O,EAAAC,EAAAC,cAACm5B,GAAA,EAAD,KACEr5B,EAAAC,EAAAC,cAAC6O,EAAD,CAAMnG,MAAO0B,EAAW,WAAa1B,KAGzC5I,EAAAC,EAAAC,cAACo5B,GAAA,EAAD,CAAcz1B,QAASG,EAAMu1B,uBAAwB,CAAE3wB,8GC7BtD4wB,GACH,GAmBJ7zB,GAAYC,aAhBJ,SAAAC,GAAK,MAAK,CACtBC,KAAM,CACJsD,SAAU,QACVrD,OAAQyzB,GACRC,YAAa5zB,EAAM8C,QAAQ,GAAK,EAChCiW,UAAW/Y,EAAM8C,QAAQ,GAAK,GAEhC+wB,WAAY,CACVj2B,MAAO+1B,GAAkB,EACzBzzB,OAAQyzB,GAAkB,GAE5BG,WAAY,CACVl2B,MAAO+1B,GACPzzB,OAAQyzB,OA0CGI,GArCC,SAAA95B,GAA8C,IAA3C+5B,EAA2C/5B,EAA3C+5B,KAAMC,EAAqCh6B,EAArCg6B,IAAKlxB,EAAgC9I,EAAhC8I,MAAOmxB,EAAyBj6B,EAAzBi6B,SAAanyB,EAAYzO,OAAAqV,EAAA,EAAArV,CAAA2G,EAAA,mCACtDkH,EAAUrB,KACVE,EAAQm0B,eACd,OACEh6B,EAAAC,EAAAC,cAAC+5B,GAAA,EAAD9gC,OAAAyV,OAAA,CACEO,MAAO,CACL5K,WAAYqE,GAAS,KACrBA,MAAOA,EAAK,GAAAtN,OAAMuK,EAAMjC,QAAQs2B,gBAAgBtxB,IAAW,MAE7D+C,MAAOmuB,EAAInuB,MACXwC,KAAM2rB,EAAIngC,GACVogC,SAAUF,EAAO,kBAAME,EAASD,IAAO,KACvCJ,WACE15B,EAAAC,EAAAC,cAACi6B,GAAAl6B,EAAD,CACEkH,UAAWH,EAAQ0yB,WACnBjvB,QAAS,SAAAtN,GACPrB,QAAQC,IAAI,eAEdoT,MAAO,CACLnG,QAAS,GACTJ,MAAOA,EAAK,GAAAtN,OAAMuK,EAAMjC,QAAQs2B,gBAAgBtxB,IAAW,QAIjEzB,UAAWH,EAAQlB,MACf8B,KC7BJjC,GAAYC,aAjBJ,SAAAC,GAAK,MAAK,CACtBC,KAAM,CACJG,SAAU,WACVW,QAAS,QACT6B,SAAU,SACVY,WAAY,WACZgtB,YAAa,CACXzO,QAAS,OACThhB,QAAS,QACTX,SAAU,WACV4wB,OAAQ,EACRpzB,MAAO,OACPsC,OAAQ,IACRxB,WAAU,mDAAAjJ,OAAqDuK,EAAMjC,QAAQW,WAAWlB,MAA9E,eAMV+2B,GAAgB,SAAAt6B,GAAsC,IAAnC6L,EAAmC7L,EAAnC6L,MAAO3H,EAA4BlE,EAA5BkE,KAAM+B,EAAsBjG,EAAtBiG,OAAQ0E,EAAc3K,EAAd2K,QACtCzD,EAAUrB,KAChB,OACE3F,EAAAC,EAAAC,cAAA,OAAKuK,QAASA,GACXkB,GACC3L,EAAAC,EAAAC,cAACm6B,GAAA,EAAD,CAAWlzB,UAAWH,EAAQszB,WAC3B3uB,GAGL3L,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAEEC,QAAQ,QACRqB,MAAM,UACNuG,MAAO,CAAEpJ,UACToB,UAAWkoB,KAAWroB,EAAQlB,OAE7B9B,KAYTo2B,GAAcG,aAAe,CAC3Bx0B,OAAQ,KAGKq0B,UCjDTz0B,GAAYC,aAAW,SAAAC,GAAK,MAAK,CACrCC,KAAM,GAEN00B,aAAc,GAKdC,YAAa,CACXC,UAAW,QACX30B,OAAQ,OACRtC,MAAO,WAgCIk3B,GA5BM,SAAA76B,GAAiD,IAA9CqV,EAA8CrV,EAA9CqV,KAAM+J,EAAwCpf,EAAxCof,QAAS0b,EAA+B96B,EAA/B86B,cAAe72B,EAAgBjE,EAAhBiE,UAC9CiD,EAAUrB,KAEhB,OAAIuZ,IAAY/J,EAAa,aAI3BnV,EAAAC,EAAAC,cAAC26B,GAAA,EAAD,CAAU1zB,UAAWH,EAAQlB,KAAMgD,SAAU8xB,EAAenwB,QAASmwB,GACnE56B,EAAAC,EAAAC,cAAC46B,GAAA,EAAD,CAAgB3zB,UAAWH,EAAQwzB,cACjCx6B,EAAAC,EAAAC,cAAC66B,GAAA,EAAD,KACE/6B,EAAAC,EAAAC,cAAA,OAAK86B,IAAI,UAAU7zB,UAAWH,EAAQyzB,YAAaQ,IAAK9lB,EAAKc,aAGjEjW,EAAAC,EAAAC,cAACo5B,GAAA,EAAD,CACEz1B,QAASsR,EAAKgB,SACdpS,UAAWA,2BCDb4B,GAAYC,aA3BJ,SAAAC,GAAK,MAAK,CACtBC,KAAM,GAGNo1B,KAAM,CACJzyB,SAAU,SACVY,WAAY,WACZ8xB,cAAet1B,EAAM8C,QAAQ,IAE/BwsB,MAAO,CACL5wB,WAAYsB,EAAMjC,QAAQC,QAAQC,KAClC8E,MAAO/C,EAAMjC,QAAQC,QAAQikB,aAC7BsT,UAAW,aACX33B,MAAO,OACPF,OAAQ,EACRqD,QAAS,OACT8B,QAAS7C,EAAM8C,QAAQ,IAEzB0yB,SAAU,CACRpyB,SAAU,GAEZqyB,YAAa,CACX5yB,QAAS,EACT0yB,UAAW,iBAqCAG,GA/BC,SAAAz7B,GAAoC,IAAjC8K,EAAiC9K,EAAjC8K,KAAME,EAA2BhL,EAA3BgL,QAASqqB,EAAkBr1B,EAAlBq1B,MAAO+F,EAAWp7B,EAAXo7B,KACjCl0B,EAAUrB,KAChB,OACE3F,EAAAC,EAAAC,cAACyK,GAAA,EAAD,CACE6wB,OAAO,QACP5wB,KAAMA,EACNC,WAAS,EACTlE,SAAS,KACTmE,QAASA,EACTC,kBAAgB,uBAEhB/K,EAAAC,EAAAC,cAAC8K,GAAA,EAAD,CAAa7D,UAAWH,EAAQmuB,MAAOsG,mBAAiB,GACtDz7B,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWH,EAAQq0B,UAAWlG,GAC1Cn1B,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CAAY9yB,MAAM,UAAUzB,UAAWH,EAAQs0B,YAAa7wB,QAASK,GACnE9K,EAAAC,EAAAC,cAACy7B,GAAA17B,EAAD,CAAW2I,MAAM,cAGrB5I,EAAAC,EAAAC,cAAC+K,GAAA,EAAD,KACEjL,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,QAAQJ,UAAWH,EAAQk0B,MAAOA,yBChCxDU,GACM,WAENj2B,GAAYC,aC5BlB,SAAeC,GAAK,OAAA1M,OAAAuV,EAAA,EAAAvV,CAAA,CAClB2M,KAAM,CACJvC,OAAQsC,EAAM8C,QAAQ,GACtBkzB,gBAAiBh2B,EAAMjC,QAAQW,WAAWlB,MAC1C83B,cAAe,IAGjBna,MAAO,CACL7X,aAActD,EAAM8C,QAAQ,IAE9BmzB,KAAM,CACJpzB,QAAS7C,EAAM8C,QAAQ,IAEzB+d,QAAS,CACP9H,UAAW/Y,EAAM8C,QAAQ,IAE3BmQ,SAAU,GAIVijB,UAAW,CACTF,gBAAiBh2B,EAAMjC,QAAQC,QAAQC,KACvC8E,MAAO/C,EAAMjC,QAAQC,QAAQikB,cAE/BkU,YAAa,CACXpd,UAAW/Y,EAAM8C,QAAQ,GACzBQ,aAActD,EAAM8C,QAAQ,IAE9BszB,KAAM,CACJ14B,OAAQsC,EAAM8C,QAAQ,KAExBgO,OAAQ,CACNjO,QAAS7C,EAAM8C,QAAQ,GACvB8V,aAAc5Y,EAAM8C,QAAQ,KAE3BxP,OAAOiB,KAAK0X,IAAQtX,OAAO,SAACC,EAAKH,GAAN,OAAAnB,OAAAuV,EAAA,EAAAvV,CAAA,GACzBsB,EADyBtB,OAAA20B,GAAA,EAAA30B,CAAA,GAE3BmB,EAAM,CACLuO,OAAM,aAAAvN,OAAewW,GAAOxX,GAAKsO,MAAM,MACvCrE,WAAU,GAAAjJ,OAAKwW,GAAOxX,GAAKsO,MAAM,MACjCA,MAAO/C,EAAMjC,QAAQs2B,gBAAgBpoB,GAAOxX,GAAKsO,MAAM,UAEvD,ODmJSszB,GA/JI,WACjB,IAAMl1B,EAAUrB,KADOw2B,EAEUhK,qBAAW+C,IAApChxB,EAFei4B,EAEfj4B,OAAQlL,EAFOmjC,EAEPnjC,aACVojC,EAAmB,IAAIC,KAAkBrjC,GAHxB0Q,EAIiBC,mBAAS,MAJ1BC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAIhB4yB,EAJgB1yB,EAAA,GAIF2yB,EAJE3yB,EAAA,GAMjB4yB,EAAUt4B,EAAO+O,OAAOzY,OAAO,SAACC,EAADqF,GAanC,OAbsDA,EAAXtG,KACtCghB,QAAQ,SAAAsf,GACX,GAAKr/B,EAAIq/B,EAAIxgC,QAKR,GAAImB,EAAIq/B,EAAIxgC,QAAQwgC,EAAInuB,OAAQ,CACnC,IAAM8wB,EAAWhiC,EAAIq/B,EAAIxgC,QAAQwgC,EAAInuB,OACrClR,EAAIq/B,EAAIxgC,QAAQwgC,EAAInuB,OAApBxS,OAAAuV,EAAA,EAAAvV,CAAA,GAAkCsjC,EAAlC,CAA4CC,MAAOD,EAASC,MAAQ,SAEjEjiC,EAAIq/B,EAAIxgC,QAAQwgC,EAAInuB,OAApBxS,OAAAuV,EAAA,EAAAvV,CAAA,GAAkC2gC,EAAlC,CAAuC4C,MAAO,SARjDjiC,EAAIq/B,EAAIxgC,QAARH,OAAA20B,GAAA,EAAA30B,CAAA,GACG2gC,EAAInuB,MADPxS,OAAAuV,EAAA,EAAAvV,CAAA,GACoB2gC,EADpB,CACyB4C,MAAO,OAS7BjiC,GACN,IAECkiC,EAAW,GACf,IACEA,EAAWz4B,EAAO7J,KAAOlB,OAAOiB,KAAKe,KAAKyB,MAAMsH,EAAO7J,OAAS,GAElE,MAAO8C,GACLrB,QAAQsB,MAAMD,GAGhB,OACE6C,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,MACtB9F,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQga,OACtBhhB,EAAAC,EAAAC,cAACm6B,GAAA,EAAD,CAAWlzB,UAAWH,EAAQszB,WAA9B,eAGAt6B,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,QAAQqB,MAAM,WAC/B1E,EAAOyU,OAGXzU,EAAOgG,MACNlK,EAAAC,EAAAC,cAAC08B,GAAD,CACEjxB,MAAM,cACN3H,KAAME,EAAOgG,KACbO,QAAS,kBAAM8xB,EAAgBX,OAInC57B,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWH,EAAQ0f,QAASnf,QAAQ,aAAhD,kBACAvH,EAAAC,EAAAC,cAACi5B,GAAA,EAAD,MACAn5B,EAAAC,EAAAC,cAAC28B,GAAA,EAAD,CAAM11B,UAAWH,EAAQ80B,KAAMgB,OAAK,GAClC98B,EAAAC,EAAAC,cAAC26B,GAAA,EAAD,CAAU1zB,UAAWkoB,KAAWroB,EAAQ2P,OAAQ3P,EAAQ9C,EAAOyS,UAC7D3W,EAAAC,EAAAC,cAACo5B,GAAA,EAAD,CACE1wB,MAAM,UACN/E,QAAO,aAAAvI,OAAewW,GAAO5N,EAAOyS,QAAQhL,OAC5C5H,UAAW+N,GAAO5N,EAAOyS,QAAQ3E,eAGpC9N,EAAO2T,aACN7X,EAAAC,EAAAC,cAAC68B,GAAD,CACE5nB,KAAMjR,EAAO2T,YACb+iB,cAAe,kBAAM5hC,EAAa4hC,cAAc12B,EAAO2T,YAAY1B,WACnEpS,UAAU,wBAGd/D,EAAAC,EAAAC,cAAC26B,GAAA,EAAD,KACE76B,EAAAC,EAAAC,cAAC46B,GAAA,EAAD,KACE96B,EAAAC,EAAAC,cAAC66B,GAAA,EAAD,CAAQ5zB,UAAWH,EAAQ+0B,WACxB73B,EAAO+O,OAAO5W,SAGnB2D,EAAAC,EAAAC,cAACo5B,GAAA,EAAD,CACEz1B,QAASK,EAAO+O,OAAO5W,OAAS,EAAI,SAAW,QAC/C0H,UAAWG,EAAO+O,OAAO5W,OAAS,GAChC2D,EAAAC,EAAAC,cAAA,YACG3C,aAAW2G,EAAO+O,OAAO,GAAGxX,QAAS,MACtCuE,EAAAC,EAAAC,cAAA,wBAFF,KAE6BF,EAAAC,EAAAC,cAAA,wBAC1B3C,aAAW2G,EAAO+O,OAAO/O,EAAO+O,OAAO5W,OAAS,GAAGZ,QAAS,UAKrEuE,EAAAC,EAAAC,cAAC26B,GAAA,EAAD,KACE76B,EAAAC,EAAAC,cAAC46B,GAAA,EAAD,KACE96B,EAAAC,EAAAC,cAAC66B,GAAA,EAAD,CAAQ5zB,UAAWH,EAAQ8R,UACxB5U,EAAO4U,WAGZ9Y,EAAAC,EAAAC,cAACo5B,GAAA,EAAD,CAAcz1B,QAAQ,oBAExB7D,EAAAC,EAAAC,cAAC26B,GAAA,EAAD,KACE76B,EAAAC,EAAAC,cAACo5B,GAAA,EAAD,KACEt5B,EAAAC,EAAAC,cAACm6B,GAAA,EAAD,CAAWlzB,UAAWH,EAAQszB,WAA9B,mCAGAt6B,EAAAC,EAAAC,cAACi5B,GAAA,EAAD,MACiC,IAAhChgC,OAAOiB,KAAKoiC,GAASngC,QACpB2D,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,WAApB,sCAEDpO,OAAOiB,KAAKoiC,GAASnuB,IAAI,SAAC2uB,EAAQC,GAAT,OACxBj9B,EAAAC,EAAAC,cAAA,OAAK5F,IAAG,aAAAgB,OAAe2hC,GAAQ91B,UAAWH,EAAQg1B,aAChDh8B,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWH,EAAQk2B,WAAY31B,QAAQ,YAAY60B,EAAiB/iC,WAAW2jC,GAAQrxB,OACnG3L,EAAAC,EAAAC,cAACi5B,GAAA,EAAD,MACChgC,OAAOgkC,OAAOX,EAAQQ,IAAS3gC,OAAS,EAErClD,OAAOgkC,OAAOX,EAAQQ,IAAS3uB,IAAI,SAACyrB,EAAK3mB,GAAN,OACjCnT,EAAAC,EAAAC,cAACk9B,GAAD,CACE9iC,IAAG,WAAAgB,OAAa2hC,EAAb,KAAA3hC,OAAqB6X,GACxB2mB,IAAKA,EACLlxB,MAAOwzB,EAAiB/iC,WAAW2jC,GAAQp0B,UAK/C5I,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,WAApB,4CAUbo1B,EAAStgC,OAAS,GAAKlD,OAAOiB,KAAKpB,EAAaqB,MAAMgC,OAAS,GAC9D2D,EAAAC,EAAAC,cAACF,EAAAC,EAAMwF,SAAP,KACEzF,EAAAC,EAAAC,cAACm6B,GAAA,EAAD,CAAWlzB,UAAWH,EAAQszB,WAA9B,YAGAt6B,EAAAC,EAAAC,cAACi5B,GAAA,EAAD,MACAn5B,EAAAC,EAAAC,cAAC28B,GAAA,EAAD,CAAM11B,UAAWH,EAAQ80B,MACtBa,EAAStuB,IAAI,SAAC/T,EAAK6Y,GAAN,OAAcna,EAAaqB,KAAKC,GAC5C0F,EAAAC,EAAAC,cAAC26B,GAAA,EAAD,CAAUvgC,IAAG,WAAAgB,OAAa6X,IACxBnT,EAAAC,EAAAC,cAACo5B,GAAA,EAAD,CACEz1B,QAAS7K,EAAaqB,KAAKC,GAAKqR,MAChC5H,UAAW/K,EAAaqB,KAAKC,GAAK+iC,OAAOn5B,EAAO7J,KAAKC,OAGvD,SAKTgiC,IAAiBV,IAChB57B,EAAAC,EAAAC,cAACo9B,GAAD,CACE1yB,MAAI,EACJS,WAAS,EACTP,QAAS,kBAAMyxB,EAAgB,OAC/BpH,MAAM,cACN+F,KAAMh3B,EAAOgG,8HEjLjBqzB,GAAU,SAACC,EAAIC,EAASC,GAC5B,OAAKF,EAEDC,EACK,CACLh6B,MAAOgtB,KAAK/S,IAAI+f,EAAQh6B,MAAO+5B,EAAGG,aAClC53B,OAAQ0qB,KAAK/S,IAAI+f,EAAQ13B,OAAQy3B,EAAGI,eAI/B,CACLn6B,MAAO+5B,EAAGG,YACV53B,OAAQy3B,EAAGI,cAXCF,GAAeD,GAAW,CAAEh6B,MAAO,EAAGsC,OAAQ,IAiEjD83B,GAjDU,SAAC32B,EAAKu2B,EAASC,GACtC,IAAMI,EAAkBj5B,mBAD8B6E,EAEdC,oBAAS,GAFKC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAE/Cq0B,EAF+Cn0B,EAAA,GAEjCo0B,EAFiCp0B,EAAA,GAItDk0B,EAAgB94B,QAAU+4B,EAJ4B,IAAA/zB,EAKrBL,mBAC/B4zB,GAAQr2B,EAAMA,EAAIlC,QAAU,KAAMy4B,EAASC,IANSzzB,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAK/C8V,EAL+C7V,EAAA,GAKzCg0B,EALyCh0B,EAAA,GAShDi0B,EAAe,WACnB,GAAKJ,EAAgB94B,SAAYkC,EAAIlC,QAArC,CACA,IAAMm5B,EAAUZ,GAAQr2B,EAAIlC,QAASy4B,EAASC,GAC1CS,EAAQp4B,SAAW+Z,EAAK/Z,QAAUo4B,EAAQ16B,QAAUqc,EAAKrc,OAE3Dw6B,EAAiBE,KAIf5S,EAAwBC,sBAC5BjtB,aAAS2/B,EAAc,KACvB,IA0BF,OAvBAxS,0BAAgB,WACd,GAAKxkB,EAAIlC,QAAT,CAGA,GAFAk5B,IAE8B,oBAAnBE,eAA+B,CACxC,IAAIC,EAAiB,IAAID,eAAe7S,GAGxC,OAFA8S,EAAeC,QAAQp3B,EAAIlC,SAEpB,WACLq5B,EAAeE,WAAWr3B,EAAIlC,SAC9Bq5B,EAAiB,MAMnB,OAFA3pB,OAAOpP,iBAAiB,SAAUimB,GAE3B,WACL7W,OAAOnP,oBAAoB,SAAUgmB,MAI3C,CAACrkB,EAAIlC,UAEE,CAAE8a,OAAMke,8DClEXxE,GACI,GCaJ7zB,GAAYC,aDVH,SAAAC,GAAK,MAAK,CACvB24B,UAAW,CACTC,OAAQ,UACR71B,MAAO,QACPQ,SAAU,QACV7E,WAAY,UACZwB,OAAQyzB,GACRvzB,SAAU,WACVE,MAAOqzB,GAAkB,EACzBtzB,KAAMszB,GAAkB,GAE1BkF,QAAS,GAKTC,aAAc,CACZ93B,cAAe,cACfV,KAAM,QACNy4B,OAAQpF,GAAkB,GAE5BE,WAAY,CAEVj2B,MAAO+1B,GAAkB,EACzBzzB,OAAQyzB,GAAkB,GAE5BqF,eAAgB,CACdj2B,MAAO,QACPnF,MAAO+1B,GAAkB,EACzBzzB,OAAQyzB,GAAkB,GAE5BG,WAAY,CACVp1B,WAAY,UACZd,MAAO+1B,GACPzzB,OAAQyzB,IAEVsF,eAAgB,CACdv7B,OAAM,MAAAjI,OAAQk+B,GAAkB,EAA1B,SAAAl+B,OAAmCk+B,GAAkB,EAArD,OAIRuF,WAAY,CACVt7B,MAAO,EACPsC,OAAQ,EACRa,QAAS,OACTC,cAAe,MACfZ,SAAU,YAEZ+4B,mBAAoB,CAClBn4B,cAAe,kBCgCJo4B,GArEG,SAAAn/B,GAGZ,IAFJ8I,EAEI9I,EAFJ8I,MAAOixB,EAEH/5B,EAFG+5B,KAAMC,EAETh6B,EAFSg6B,IAAKqE,EAEdr+B,EAFcq+B,QAClBe,EACIp/B,EADJo/B,cAAeC,EACXr/B,EADWq/B,cAAyBC,GACpCt/B,EAD0Bu/B,SAC1Bv/B,EADoCs/B,aAAgBx3B,EACpDzO,OAAAqV,EAAA,EAAArV,CAAA2G,EAAA,2FACEw/B,EAAaxF,EAAIyF,UAAUvJ,EAAImI,EAAQqB,SAAW,EAClDx4B,EAAUrB,KACVE,EAAQm0B,eACRyF,EAAc,SAACtiC,GACnBA,EAAEosB,iBACFpsB,EAAEsuB,mBAaJ,OACEzrB,EAAAC,EAAAC,cAACw/B,GAAAz/B,EAAD,CACEqK,UAAWuvB,EACX8F,OAAQ,CAAEx5B,KAAM,GAAID,IAAK,GAAI04B,MAAOT,EAAQqB,SAAW,GAAI3I,OAAQsH,EAAQyB,UAAY,IACvF35B,SAAU,CAAE+vB,EAAG8D,EAAIyF,UAAUvJ,EAAGC,EAAG6D,EAAIyF,UAAUtJ,GACjD4J,OAfe,SAAC1iC,EAAGgR,GACrBsxB,EAAYtiC,GACZ+hC,EAAc/wB,EAAM2rB,IAclBgG,OAZmB,SAAC3iC,EAAGgR,GACzBsxB,EAAYtiC,GACZgiC,EAAchxB,EAAM2rB,IAWlBrvB,QAASg1B,GAETz/B,EAAAC,EAAAC,cAAA,OAAKiH,UAAWkoB,KAAWroB,EAAQ+3B,WAAYO,GAAct4B,EAAQg4B,qBACnEh/B,EAAAC,EAAAC,cAAC+5B,GAAA,EAAD9gC,OAAAyV,OAAA,CACEO,MAAO,CACL5K,WAAYqE,EAAK,GAAAtN,OAAMsN,EAAN,cAA0B,KAC3CA,MAAOA,EAAK,GAAAtN,OAAMuK,EAAMjC,QAAQs2B,gBAAgBtxB,GAApC,cAAyD,MAEvEA,MAAOixB,EAAO,YAAc,UAC5BluB,MAAOmuB,EAAInuB,MACXwC,KAAM2rB,EAAIngC,GACV8Q,QAASg1B,EACT1F,SAAUF,EAAOuF,EAAYtF,GAAO,KACpCJ,WAAYG,EAAO75B,EAAAC,EAAAC,cAACi6B,GAAAl6B,EAAD,CAAYkH,UAAWkoB,KAAWroB,EAAQ0yB,WAAY4F,GAAct4B,EAAQ83B,kBAAsB9+B,EAAAC,EAAAC,cAAA,YACrHiH,UAAWkoB,KACTroB,EAAQw3B,UACRc,GAAct4B,EAAQ23B,aACtB9E,GAAQ7yB,EAAQ03B,UAEd92B,EAhBN,CAiBEm4B,OAAQ//B,EAAAC,EAAAC,cAAC66B,GAAA,EAAD,CAAQ5zB,UAAWkoB,KAAWroB,EAAQ2yB,WAAYE,GAAQ7yB,EAAQ03B,UACxE1+B,EAAAC,EAAAC,cAAC8/B,GAAA//B,EAAD,CAAYkH,UAAWkoB,KAAWroB,EAAQ63B,eAAgBhF,GAAQ7yB,EAAQ03B,iDCrDhF/4B,GAAYC,aCbH,SAAAC,GAAK,MAAK,CACvBC,KAAM,CACJrC,MAAO,QAETw8B,iBAAkB,CAChBv3B,QAAO,GAAApN,OAAKuK,EAAM8C,QAAQ,GAAnB,OAAArN,OAA8C,EAAnBuK,EAAM8C,QAAQ,GAAzC,OAETu3B,YAAa,CACX92B,SAAU,IAEZsC,YAAa,CACXzF,SAAU,WACVE,KAAM,EACNiD,SAAU,IAEZ+2B,MAAO,CACLv5B,QAAS,OACT8B,QAAS,GAEX03B,eAAgB,CACdx5B,QAAS,OACTy5B,SAAU,OACV/5B,KAAM,EACNg6B,WAAY,SACZ73B,SAAU,UAEZpF,MAAO,CACL4C,SAAU,WACVG,OAAQ,IACRwY,UAAW/Y,EAAM8C,QAAQ,GACzBxC,KAAM,EACNy4B,MAAO,MDwCI2B,GAxDK,SAAAzgC,GAA6B,IAA1B0gC,EAA0B1gC,EAA1B0gC,UAAWl1B,EAAexL,EAAfwL,SAC1BtE,EAAUrB,KACVisB,EAAU4O,EAAUrD,OAAO9uB,IAAI,SAAAoyB,GAAE,MAAK,CAAE90B,MAAO80B,EAAG90B,MAAOH,MAAOi1B,EAAG9mC,MAEzE,OADAmC,QAAQC,IAAI,cAAeykC,GAEzBxgC,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,OACpB06B,EAAUE,gBACV1gC,EAAAC,EAAAC,cAACygC,GAAA,EAAD,CACE/O,QAASA,EACT5qB,QAASA,EACT45B,WAAY,CACVC,WACAC,QACAC,oBACAC,UACAC,eACAC,mBAEF11B,MAAO,KAEP21B,mBAAiB,EACjBC,aAAa,EACb91B,SAAUA,EACVI,YAAa80B,EAAU70B,MACvB01B,cAAY,IAGdb,EAAUE,gBACV1gC,EAAAC,EAAAC,cAACohC,GAAArhC,EAAD,CACE2xB,QAASA,EACT5qB,QAASA,EACT45B,WAAY,CACVC,WACAC,QACAC,oBACAC,UACAC,eACAC,mBAEF11B,MAAO,KACP41B,aAAa,EAEbD,mBAAiB,EACjB71B,SAAUA,EACVI,YAAa80B,EAAU70B,MACvB01B,cAAY,MAatB,SAASR,GAASj5B,GAChB,OACE5H,EAAAC,EAAAC,cAACiL,GAAA,EAADhS,OAAAyV,OAAA,CACE/D,WAAS,EACT02B,WAAY,CACVC,kBACAhgB,WAAWroB,OAAAuV,EAAA,EAAAvV,CAAA,CACTgO,UAAWS,EAAM65B,YAAYz6B,QAAQm5B,MACrCuB,SAAU95B,EAAM+5B,SAChB5hC,SAAU6H,EAAM7H,UACb6H,EAAMg6B,cAGTh6B,EAAM65B,YAAYI,iBAK5B,IAAMd,GAAmB,SAAA7yB,GAAA,IAAG0zB,EAAH1zB,EAAG0zB,WAAYH,EAAfvzB,EAAeuzB,YAAa1hC,EAA5BmO,EAA4BnO,SAA5B,OACvBC,EAAAC,EAAAC,cAACoH,GAAA,EAADnO,OAAAyV,OAAA,CACEhG,MAAM,gBACNzB,UAAWs6B,EAAYz6B,QAAQi5B,kBAC3B2B,GAEH7hC,IAIC+gC,GAAO,SAAArpB,GAAA,IAAGgqB,EAAHhqB,EAAGgqB,YAAaG,EAAhBnqB,EAAgBmqB,WAAY7hC,EAA5B0X,EAA4B1X,SAA5B,OACXC,EAAAC,EAAAC,cAAC4oB,GAAA,EAAD3vB,OAAAyV,OAAA,CAAOkzB,QAAM,EAAC36B,UAAWs6B,EAAYz6B,QAAQ3D,OAAWu+B,GACrD7hC,IAICyhC,GAAiB,SAAA3P,GAAA,IAAG6P,EAAH7P,EAAG6P,SAAa95B,EAAhBzO,OAAAqV,EAAA,EAAArV,CAAA04B,EAAA,qBAA4B7xB,EAAAC,EAAAC,cAAA,MAAA/G,OAAAyV,OAAA,CAAK1H,IAAKw6B,GAAc95B,KAErEq5B,GAAc,SAACr5B,GAAD,OAClB5H,EAAAC,EAAAC,cAACoH,GAAA,EAADnO,OAAAyV,OAAA,CACEhG,MAAM,gBACNzB,UAAWS,EAAM65B,YAAYz6B,QAAQ0E,aACjC9D,EAAMg6B,YAETh6B,EAAM7H,WAILihC,GAAS,SAAAe,GAAA,IAAGJ,EAAHI,EAAGJ,SAAUK,EAAbD,EAAaC,UAAWC,EAAxBF,EAAwBE,WAAYL,EAApCG,EAAoCH,WAAY7hC,EAAhDgiC,EAAgDhiC,SAAhD,OACbC,EAAAC,EAAAC,cAACk5B,GAAA,EAADjgC,OAAAyV,OAAA,CACEszB,UAAWP,EACXQ,SAAUH,EACVniB,UAAU,MACV1Q,MAAO,CAAEizB,WAAYH,EAAa,IAAM,MACpCL,GAEH7hC,IAICmhC,GAAiB,SAAAmB,GAAA,IAAGZ,EAAHY,EAAGZ,YAAa1hC,EAAhBsiC,EAAgBtiC,SAAhB,OACrBC,EAAAC,EAAAC,cAAA,OAAKiH,UAAWs6B,EAAYz6B,QAAQo5B,gBAAiBrgC,IEtHjD4F,GAAYC,aCdH,SAAAC,GAAK,MAAK,CACvBC,KAAM,CACJ2C,SAAU,WAEZ65B,OAAQ,CACN55B,QAA4B,EAAnB7C,EAAM8C,QAAQ,IAEzB45B,SAAU,CACR17B,cAAe,UAEjB27B,QAAS,CACPla,YAAgC,EAAnBziB,EAAM8C,QAAQ,GAC3B85B,aAAiC,EAAnB58B,EAAM8C,QAAQ,GAC5BwyB,cAAkC,EAAnBt1B,EAAM8C,QAAQ,IAE/B2yB,YAAa,CACXr1B,SAAU,WACV24B,MAAO/4B,EAAM8C,QAAQ,GACrBzC,IAAKL,EAAM8C,QAAQ,GACnBC,MAAO/C,EAAMjC,QAAQ8+B,KAAK,SDuCfC,GA1CM,SAAA7iC,GAAuD,IAApDqY,EAAoDrY,EAApDqY,OAAQvN,EAA4C9K,EAA5C8K,KAAM5R,EAAsC8G,EAAtC9G,aAAcqmC,EAAwBv/B,EAAxBu/B,SAAUv0B,EAAchL,EAAdgL,QACtD9D,EAAUrB,KACVi9B,EAAS5pC,EAAaQ,KAAKO,OAAO,SAAA06B,GAAC,OAAIA,EAAEz6B,UAC/C,OAAKme,EAEHnY,EAAAC,EAAAC,cAACyK,GAAA,EAAD,CACEC,KAAMA,EACN4wB,OAAO,QACPqH,YAAU,EACV77B,QAAS,CAAE87B,iBAAkB97B,EAAQlB,MACrCgF,QAAS,kBAAMA,KACfC,kBAAgB,uBAEhB/K,EAAAC,EAAAC,cAAC8K,GAAA,EAAD,CAAarR,GAAG,sBAAsBwN,UAAWH,EAAQs7B,QAAzD,WAEEtiC,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CAAYv0B,UAAWH,EAAQs0B,YAAa7wB,QAASK,GACnD9K,EAAAC,EAAAC,cAACy7B,GAAA17B,EAAD,QAGJD,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQw7B,SACrBI,EAAOvmC,OAAS,GACf2D,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,WAApB,8CAGDq7B,EAAOv0B,IAAI,SAAC00B,EAAS5vB,GAAV,OACVnT,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQu7B,SAAUjoC,IAAG,YAAAgB,OAAc6X,IACjDnT,EAAAC,EAAAC,cAAC8iC,GAAD,CAAaxC,UAAWuC,EAASz3B,SAAU+zB,EAASlnB,EAAQ4qB,UAvBlD,MEuCPE,GAvDb,SAAAA,EAAajqC,EAAcQ,GAAM,IAAAP,EAAAC,KAAAC,OAAA0O,GAAA,EAAA1O,CAAAD,KAAA+pC,GAAA/pC,KAKjCgqC,YAAc,SAAC5pC,EAAQ6pC,GACrB,OAAOlqC,EAAKD,aAAaK,WAAWC,GAAQ6jC,OACzC1jC,KAAK,SAAAC,GAAE,OAAIA,EAAGC,KAAOwpC,KAPOjqC,KAWjCkqC,UAAY,WACV,IAAMC,EAAWpqC,EAAKD,aAAac,gBAAgBuU,IAAI,SAAA3U,GAAE,OAAIA,EAAGC,KAChE,OAAOV,EAAKO,KAAKO,OAAO,SAAA+/B,GAAG,OAAIuJ,EAASjnC,QAAQ09B,EAAIxgC,SAAW,GAAKwgC,EAAI3hB,QAAU2hB,EAAI3hB,OAAO6d,KAb9D98B,KAgBjCoqC,aAAe,WACb,IAAMC,EAActqC,EAAKD,aAAaiB,mBAAmBoU,IAAI,SAAA3U,GAAE,OAAIA,EAAGC,KACtE,OAAOV,EAAKO,KAAKO,OAAO,SAAA+/B,GAAG,OAAIyJ,EAAYnnC,QAAQ09B,EAAIxgC,SAAW,KAlBnCJ,KAqBjCsqC,gBAAkB,SAAC73B,EAAOrS,GAAR,MAChB,CAAEqS,QAAOrS,WAtBsBJ,KAyBjCuqC,qBAAuB,SAAC9pC,EAAIL,GAAL,OAAAH,OAAAuV,EAAA,EAAAvV,CAAA,GAClBF,EAAKiqC,YAAY5pC,EAAQK,GADP,CAErBL,YA3B+BJ,KA8BjCwqC,kBAAoB,SAAC/3B,EAAOrS,EAAQ6e,GAAhB,MAA4B,CAC9CxM,QACArS,SACA6e,WAjC+Bjf,KAoCjCyqC,uBAAyB,SAAChqC,EAAIL,EAAQ6e,GAAb,OAAAhf,OAAAuV,EAAA,EAAAvV,CAAA,GACpBF,EAAKiqC,YAAY5pC,EAAQK,GADL,CAEvBL,SACA6e,YAvC+Bjf,KA6CjC0qC,aAAe,SAACC,GAAD,OAAgB5qC,EAAKmqC,YAAY/0B,IAAI,SAAAyrB,GAAG,OAAA3gC,OAAAuV,EAAA,EAAAvV,CAAA,GAClD2gC,EADkD,CAErDgK,MAAO7qC,EAAKD,aAAaY,gBAAgBkgC,EAAIxgC,QAC7CimC,UAAW,CACTvJ,EAAG8D,EAAI3hB,OAAO6d,EAAI6N,EAClB5N,EAAG6D,EAAI3hB,OAAO8d,EAAI4N,QAjDpB3qC,KAAKM,KAAOA,EACZN,KAAKF,aAAe,IAAID,KAAaC,IC+F1B+qC,GA/FG,SAAC9oC,EAAOkjC,EAAS7yB,EAAU0yB,GAAoB,IACvDhlC,EAAiBm5B,qBAAW+C,IAA5Bl8B,aADuD0Q,EAK3BC,oBAAS,GALkBC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAKxDs6B,EALwDp6B,EAAA,GAK5Cq6B,EAL4Cr6B,EAAA,GAAAI,EAMvBL,mBAAS,MANcM,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAMxDk6B,EANwDj6B,EAAA,GAM1Ck6B,EAN0Cl6B,EAAA,GAQzDm6B,EAAW,IAAInB,GAAKjqC,EAAciC,EAAMzB,MAExC6lC,EAAW,SAAClnB,EAAQ4qB,GAAT,OAAqB,SAAAjjC,GAAiC,IAA9B0L,EAA8B1L,EAA9B0L,MACnC64B,EADiEvkC,EAAvBwkC,UAE1CF,EAASV,kBAAkBl4B,EAAOu3B,EAAQppC,GAAIwe,GAC9CisB,EAAST,uBAAuBn4B,EAAOu3B,EAAQppC,GAAIwe,GAEvDgsB,EAAgB,MAChB74B,EAASnS,OAAAuV,EAAA,EAAAvV,CAAA,GAAK8B,EAAN,CAAazB,KAAI,GAAA8B,OAAAnC,OAAAia,GAAA,EAAAja,CAAM8B,EAAMzB,MAAZ,CAAkB6qC,SAyBvCE,EAAoB,SAAAr2B,EAAW4rB,GAAQ,IAAhB9D,EAAgB9nB,EAAhB8nB,EAAGC,EAAa/nB,EAAb+nB,EAa9B,OAZgBh7B,EAAMzB,KAAK6U,IAAI,SAAAm2B,GAC7B,GAAIA,EAAO7qC,KAAOmgC,EAAIngC,GAAI,OAAO6qC,EAE/B,IAAIC,EAAOC,SAAS1O,EAAImI,EAAQ0F,WAAY,IACxCc,EAAOD,SAASzO,EAAIkI,EAAQ0F,WAAY,IAE5C,OAAO1qC,OAAAuV,EAAA,EAAAvV,CAAA,GACFqrC,EADL,CAEErsB,OAAQ,CAAE6d,EAAGyO,EAAMxO,EAAG0O,QAkC9B,MAAO,CACLtF,WACAD,YAnEkB,SAACtF,GAAD,OAAS,WAC3B,IAAMtgC,EAAOyB,EAAMzB,KAAKO,OAAO,SAAAyqC,GAAM,OAAIA,EAAO7qC,KAAOmgC,EAAIngC,KAC3D2R,EAASnS,OAAAuV,EAAA,EAAAvV,CAAA,GACJ8B,EADG,CAENzB,YAgEForC,gBA1DsB,SAACznC,GAClB+mC,IAEHlG,GAAgB,GAChBmG,EAAgB,CACdnO,EAAG0O,SAASvnC,EAAE0nC,OAASnwB,OAAO+V,WAAa0T,EAAQqB,UAAY,EAAIrB,EAAQ0F,WAAY,IACvF5N,EAAGyO,SAASvnC,EAAE2nC,OAASpwB,OAAOgW,YAAcyT,EAAQyB,WAAa,EAAIzB,EAAQ0F,WAAY,QAqD7F3E,cAtBoB,SAAC/mB,EAAQ2hB,GAC7ByK,EAAkBpsB,EAAQ2hB,GAC1BmK,GAAc,IAqBd9E,cAhCoB,SAAChnB,EAAQ2hB,GAC7B,IAAMtgC,EAAO+qC,EAAkBpsB,EAAQ2hB,GACvCmK,GAAc,GACd34B,EAASnS,OAAAuV,EAAA,EAAAvV,CAAA,GACJ8B,EADG,CAENzB,WA4BFurC,WApBiB,kBACjB/kC,EAAAC,EAAAC,cAAC8kC,GAAD,CACEp6B,MAAOo5B,GAAciB,QAAQf,GAC7B/rB,OAAQ+rB,EACRlrC,aAAcA,EACdqmC,SAAUA,EACVv0B,QAAS,WACPq5B,EAAgB,MAEhBnG,GAAgB,OAYpB4F,aAAcQ,EAASR,+CCvFrBj+B,GAAYC,aAAW,SAAAC,GAAK,MAAK,CACrCC,KAAM,CACJC,OAAQ,OACR2C,QAAS7C,EAAM8C,QAAQ,GACvB/B,QAAS,OACTC,cAAe,SACf4B,SAAU,SACVO,QAAS,GACTlC,UAAW,SACX8B,MAAO/C,EAAMjC,QAAQs2B,gBAAgBr0B,EAAMjC,QAAQI,KAAKH,SACxDU,WAAYsB,EAAMjC,QAAQI,KAAKH,SAEjCwC,OAAQ,CACN4C,SAAU,GAEZF,KAAM,CACJtF,MAAO,OACP6C,KAAM,UACN0C,QAAS,IAEXk8B,iBAAkB,CAChB3hC,OAAQ,UAEVM,QAAS,CACPiD,UAAW,SACXrD,MAAO,QAETM,UAAW,CACTuC,KAAM,UACN7C,MAAO,WAyBI0hC,GArBG,SAAArlC,GAAsC,IAAnCof,EAAmCpf,EAAnCof,QAAS/X,EAA0BrH,EAA1BqH,UAAcS,EAAYzO,OAAAqV,EAAA,EAAArV,CAAA2G,EAAA,yBAChDkH,EAAUrB,KAChB,OACE3F,EAAAC,EAAAC,cAAA,MAAA/G,OAAAyV,OAAA,CAAKzH,UAAWkoB,KAAWroB,EAAQlB,KAAMqB,IAAgBS,GACvD5H,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQX,SACvB6Y,EACGlf,EAAAC,EAAAC,cAACklC,GAAA,EAAD,CAAkBx8B,MAAM,UAAUzB,UAAWH,EAAQk+B,mBACrDllC,EAAAC,EAAAC,cAACmlC,GAAAplC,EAAD,CAAiBkH,UAAWH,EAAQ+B,KAAMH,MAAM,YAEpD5I,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWH,EAAQnD,QAAS+E,MAAM,WAC3CsW,EAAU,UAAY,mBAEzBlf,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQX,WChDxBV,GAAYC,aAAW,SAAAC,GAAK,MAAK,CACrCC,KAAM,CACJG,SAAU,WACVW,QAAS,QACTb,OAAQ,OACRtC,MAAO,QAET6hC,IAAK,CACH1+B,QAAS,QACTb,OAAQ,OACRtC,MAAO,QAET8hC,UAAW,CACT3+B,QAAS,WAwEE4+B,GApES,SAAA1lC,GAA+F,IAA5FqH,EAA4FrH,EAA5FqH,UAAWs+B,EAAiF3lC,EAAjF2lC,aAAcC,EAAmE5lC,EAAnE4lC,aAAc7pC,EAAqDiE,EAArDjE,QAASZ,EAA4C6E,EAA5C7E,MAAO0qC,EAAqC7lC,EAArC6lC,OAAQC,EAA6B9lC,EAA7B8lC,MAAOz2B,EAAsBrP,EAAtBqP,MAAUvH,EAAYzO,OAAAqV,EAAA,EAAArV,CAAA2G,EAAA,wFAC/GkH,EAAUrB,KADqG+D,EAEvFC,qBAFuFC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAE9Gm8B,EAF8Gj8B,EAAA,GAErGk8B,EAFqGl8B,EAAA,GAG/Gm8B,EAAYlhC,mBAHmGmF,EAKrFL,mBAAS,GAL4EM,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAK9Gg8B,EAL8G/7B,EAAA,GAKpGg8B,EALoGh8B,EAAA,GAAAuR,EAMzF7R,oBAAS,GANgF8R,EAAAtiB,OAAA0Q,GAAA,EAAA1Q,CAAAqiB,EAAA,GAM9G0qB,EAN8GzqB,EAAA,GAMtG0qB,EANsG1qB,EAAA,GAQrHrW,oBAAU,YACHvJ,GAAWZ,GAASwqC,GACvBA,EAAaxqC,EAAO,CAAC,QAAS,WAAWic,KAAK,SAAC/I,GACzC43B,EAAU/gC,SAAS8gC,EAAW33B,KAEjCsV,MAAM,WACDsiB,EAAU/gC,SAASmhC,GAAU,MAGtC,CAAClrC,IAGJ,IAAMmrC,EAAWvqC,GAAYgqC,GAAWA,EAAQG,GAEhD,OACEhmC,EAAAC,EAAAC,cAACF,EAAAC,EAAMwF,SAAP,MACK5J,KAAagqC,GAAWK,IACzBlmC,EAAAC,EAAAC,cAACmmC,GAADltC,OAAAyV,OAAA,CAAWzH,UAAWA,EAAW+X,SAAUgnB,GAAYt+B,IAEzD5H,EAAAC,EAAAC,cAAA,OAAKgH,IAAK6+B,EAAW52B,MAAO,CAAEpJ,OAAQ,EAAGtC,MAAO,KAC/C2iC,GACCpmC,EAAAC,EAAAC,cAAA,MAAA/G,OAAAyV,OAAA,CACE1H,IAAKy+B,EACLx+B,UAAWkoB,KAAWloB,EAAW++B,EAASl/B,EAAQu+B,UAAYv+B,EAAQs+B,KACtEtK,IAAK0K,EAAaM,GAClB72B,MAAKhW,OAAAuV,EAAA,EAAAvV,CAAA,GACAgW,EADA,CAEHurB,UAAWkL,EAAQ,QAAU,YAE/BU,QAAS,YACFzqC,GAAWgqC,EAAQG,EAAW,IACjClqC,QAAQsB,MAAM,oCAAqC4oC,GAEnDC,EAAYD,EAAW,IAGvBG,GAAU,IAIdlL,IAAKmL,GACDx+B,MC3DRjC,GAAYC,aCZH,SAAAC,GAAK,MAAK,CACvBC,KAAM,CAEJc,QAAS,QACTX,SAAU,WACVxC,MAAO,OACPsC,OAAQ,OACRxB,WAAY,QACZkE,SAAU,UAEZhC,MAAO,CACLhD,MAAO,OACPsC,OAAQ,QAOV68B,OAAQ,CACN38B,SAAU,WACVC,IAAK,EACLC,KAAM,EAGNJ,OAAQ,OACRtC,MAAO,QAGT6hC,IAAK,CACH1+B,QAAS,SAEX2/B,UAAW,CACT3/B,QAAS,QAEX4/B,YAAa,CACX/iC,MAAO,WD0DIzI,GAhFD,SAAA8E,GAAkF,IAA/E7E,EAA+E6E,EAA/E7E,MAAO+N,EAAwElJ,EAAxEkJ,QAAS6wB,EAA+D/5B,EAA/D+5B,KAAM4M,EAAyD3mC,EAAzD2mC,SAAU5qC,EAA+CiE,EAA/CjE,QAAqByP,GAA0BxL,EAAtC4mC,WAAsC5mC,EAA1BwL,UAAUnE,EAAgBrH,EAAhBqH,UACxEH,EAAUrB,KACVghC,EAAa9hC,mBACb8gC,EAAS9gC,mBAH+E6E,EAIhEC,mBAAS,CAAEk6B,WAAY,IAJyCj6B,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAIvFy0B,EAJuFv0B,EAAA,GAI9Eg9B,EAJ8Eh9B,EAAA,GAKtF5Q,EAAiBm5B,qBAAW+C,IAA5Bl8B,aALsF6tC,EAOzChJ,GAAiB8I,GAPwBG,EAAAD,EAOtF/mB,KAAQ/Z,EAP8E+gC,EAO9E/gC,OAAQtC,EAPsEqjC,EAOtErjC,MAASu6B,EAP6D6I,EAO7D7I,gBAP6D+I,EAUGhD,GAAU9oC,EAAO,CAAE8K,SAAQtC,SAAS6H,EAAU0yB,GAAvI4G,EAVsFmC,EAUtFnC,gBAAiBG,EAVqEgC,EAUrEhC,WAAYnB,EAVyDmD,EAUzDnD,aAAc1E,EAV2C6H,EAU3C7H,cAAeC,EAV4B4H,EAU5B5H,cAAeC,EAVa2H,EAUb3H,YAmBjF,OAJA1T,0BAAgB,WACVia,EAAO3gC,SAdS,WACpBlJ,QAAQC,IAAI,qBADc,IAAAirC,EAEcrB,EAAO3gC,QAAvCiiC,EAFkBD,EAElBC,cAAeC,EAFGF,EAEHE,aAEjBrD,EAAapT,KAAK0W,IACtBphC,EAASkhC,EACTxjC,EAAQyjC,GAKVN,EAAW,CAAEpH,SAFIqE,EAAaqD,EAEPtH,UADLiE,EAAaoD,EACGC,eAAcD,gBAAepD,eAG3CuD,IACnB,CAAC3jC,EAAOsC,IAGT/F,EAAAC,EAAAC,cAAA,OAAKiH,UAAWkoB,KAAWroB,EAAQlB,KAAMqB,GACvCgI,MAAO,CAAEnG,QAAqB,OAAZA,EAAmBA,EAAU,GAC/C9B,IAAKy/B,GAEL3mC,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQP,MACtB0I,MAAO,CACLpJ,OAAQo4B,EAAUA,EAAQyB,UAAY,EACtCn8B,MAAO06B,EAAUA,EAAQqB,SAAW,GAEtC/0B,QAASm6B,GAEP6B,GAAY5M,EAEV75B,EAAAC,EAAAC,cAAA,OAAKiH,UAAWA,GACZy8B,EAAazF,EAAQ0F,YAAYx1B,IAAI,SAACyrB,EAAK3mB,GAAN,OACrCnT,EAAAC,EAAAC,cAACmnC,GAADluC,OAAAyV,OAAA,CACEtU,IAAG,SAAAgB,OAAW6X,GACdvK,MAAOkxB,EAAIlxB,OACP,CAAEixB,OAAMsE,UAASrE,MAAKoF,gBAAeC,gBAAeC,oBAG5D,KAENp/B,EAAAC,EAAAC,cAAConC,GAAD,CACEngC,UAAWH,EAAQugC,SACnB7B,aAAc,CAAC,QAAS,SAAU,SAClCzqC,MAAOA,EACP0qC,OAAQA,EACR9pC,QAASA,EACT4pC,aAAczsC,EAAaysC,aAC3Bt2B,MAAO,CAAEpJ,OAAQo4B,EAAQyB,UAAWn8B,MAAO06B,EAAQqB,aAItD3F,GAAQ75B,EAAAC,EAAAC,cAAC6kC,EAAD,QE5DTp/B,GAAYC,aCnBH,SAAAC,GAAK,MAAK,CACvBC,KAAM,CACJG,SAAU,YAEZQ,MAAO,CACLR,SAAU,YAEZuhC,aAAc,CACZhhC,UAAW,IACXT,OAAQ,KAEV0hC,YAAa,CACX/+B,QAAS7C,EAAM8C,QAAQ,GACvBpE,WAAYsB,EAAMjC,QAAQC,QAAQ6jC,KAClC9+B,MAAO/C,EAAMjC,QAAQC,QAAQikB,aAC7BhhB,UAAW,UAEb6gC,cAAe,GAKfC,WAAY,CACVh/B,MAAO,QACPxC,OAAQ,GACRH,SAAU,WACV8wB,UAAW,mBACX5wB,KAAM,EACND,IAAK,OAEP2hC,cAAe,CACbj/B,MAAO,QACPxC,OAAQ,GACRH,SAAU,WACV8wB,UAAW,mBACX6H,MAAO,EACP14B,IAAK,OAEP4hC,UAAW,CACTl/B,MAAO,6BAETm/B,gBAAiB,CACfn/B,MAAO,6BAETo/B,KAAM,CACJzkC,OAAQ,aDxBN0kC,GAAY,SAAAnoC,GAA6C,IAA1CmT,EAA0CnT,EAA1CmT,OAAQ6Y,EAAkChsB,EAAlCgsB,aAAcoc,EAAoBpoC,EAApBooC,cACnClhC,EAAUrB,KACVE,EAAQm0B,eACRmO,EAAiBrc,GAAe7Y,EAAOpZ,UAAU,SAAAuuC,GAAC,OAAIA,EAAEzuC,KAAOmyB,KAAqB,EAH7BpiB,EAIvBC,mBAASw+B,GAAkB,EAAIA,EAAiB,GAJzBv+B,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAItD2+B,EAJsDz+B,EAAA,GAIzC0+B,EAJyC1+B,EAAA,GAAAI,EAK7BL,oBAAS,GALoBM,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAKtDy8B,EALsDx8B,EAAA,GAK5Cs+B,EAL4Ct+B,EAAA,GAMvDu+B,EAAWv1B,EAAO5W,OAAS,EAE3BosC,EAAYtvC,OAAAia,GAAA,EAAAja,CAAO8Z,GACzBw1B,EAAaC,KAAK,SAACzoC,EAAG0oC,GAAJ,OAAUjE,SAASiE,EAAEltC,QAAS,IAAMipC,SAASzkC,EAAExE,QAAS,MAK1E,OACEuE,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,MACtB9F,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQP,OACtBzG,EAAAC,EAAAC,cAAC0oC,GAAA3oC,EAAD,CACE4oC,KAA0B,QAApBhjC,EAAM+S,UAAsB,YAAc,IAChDkwB,MAAOT,EACPU,cAAe,SAACC,GAAD,OAASV,EAAeU,IACvCC,mBAAiB,GAEhBR,EAAap6B,IAAI,SAACpT,EAAOkY,GAAR,OAChBnT,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQwgC,aAAcltC,IAAG,gBAAAgB,OAAkB6X,GAAO1I,QAAS,kBAAMy9B,EAAcO,EAAaJ,GAAa1uC,MACvHqG,EAAAC,EAAAC,cAACgpC,GAAD,CAAOjuC,MAAOA,EAAOkM,UAAWH,EAAQ/L,MAAOwrC,SAAUA,QAI/DzmC,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CAAY5b,KAAK,QAAQ3Y,UAAWH,EAAQ4gC,WAAYn9B,QAjB3C,kBAAM69B,EAAeD,GAAe,EAAII,EAAapsC,OAAS,EAAIgsC,EAAc,IAiBhBz/B,MAAM,UAAU0B,SAA0B,IAAhB+9B,GAChF,QAApBxiC,EAAM+S,UAAsB5Y,EAAAC,EAAAC,cAACipC,GAAAlpC,EAAD,MAAyBD,EAAAC,EAAAC,cAACkpC,GAAAnpC,EAAD,OAExDD,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CAAY5b,KAAK,QAAQ3Y,UAAWH,EAAQ6gC,cAAep9B,QArB3C,kBAAM69B,EAAeD,GAAeI,EAAapsC,OAAS,EAAIgsC,EAAc,IAqBTz/B,MAAM,UAAU0B,SAAU+9B,IAAgBp1B,EAAO5W,OAAS,GACtH,QAApBwJ,EAAM+S,UAAsB5Y,EAAAC,EAAAC,cAACkpC,GAAAnpC,EAAD,MAAwBD,EAAAC,EAAAC,cAACipC,GAAAlpC,EAAD,OAEvDD,EAAAC,EAAAC,cAACmpC,GAAA,EAAD,CACElU,MAAOqT,EAAW,QAAH,UAAAltC,OAAuB+sC,EAAc,EAArC,KAAA/sC,OAA0CmtC,EAAapsC,OAAvD,KACfitC,SAAUb,EAAapsC,OAAS,GAC9B2D,EAAAC,EAAAC,cAAA,YAAO3C,aAAWkrC,EAAaJ,GAAa5sC,UAE9C8tC,WACEvpC,EAAAC,EAAAC,cAACF,EAAAC,EAAMwF,SAAP,KACEzF,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CAAYv0B,UAAWH,EAAQ8gC,UAAWr9B,QAAS,kBAAM89B,GAAa9B,KACpEzmC,EAAAC,EAAAC,cAACspC,GAAA,EAAD,CAAO5gC,MAAO69B,EAAW,UAAY,YAAagD,aAAchB,EAAaJ,GAAa7uC,KAAOivC,EAAaJ,GAAa7uC,KAAKO,OAAO,SAAA+/B,GAAG,OAAIA,EAAI3hB,SAAQ9b,OAAS,MACjK2D,EAAAC,EAAAC,cAACwpC,GAAAzpC,EAAD,aAOVuoC,GACFxoC,EAAAC,EAAAC,cAACypC,GAAA,EAAD,CACEC,MAAOnB,EAAapsC,OACpB4J,SAAS,SACT4jC,WAAYxB,EACZrhC,QAAS,CACPlB,KAAMkB,EAAQ2gC,cACdK,KAAMhhC,EAAQghC,UAoBxBC,GAAU1N,aAAe,CACvBmM,WAAY,IACZoD,cAAc,EACdC,OAAQ,IAGK9B,0EE1FTtiC,GAAYC,aAHJ,SAAAC,GAAK,MAAK,KA2CTmkC,GAtCM,SAAAlqC,GAAyC,IAAtCq1B,EAAsCr1B,EAAtCq1B,MAAO1tB,EAA+B3H,EAA/B2H,QAASwiC,EAAsBnqC,EAAtBmqC,UAAWr/B,EAAW9K,EAAX8K,KAC3C5D,EAAUrB,KAChB,OACE3F,EAAAC,EAAAC,cAACyK,GAAA,EAAD,CACExD,UAAWH,EAAQlB,KACnBokC,sBAAoB,EACpBt/B,KAAMA,EACNu/B,sBAAoB,EACpBt/B,WAAS,EACTlE,SAAS,KACToE,kBAAgB,6BAEhB/K,EAAAC,EAAAC,cAAC8K,GAAA,EAAD,CAAarR,GAAG,6BAA6Bw7B,GAC7Cn1B,EAAAC,EAAAC,cAAC+K,GAAA,EAAD,KACEjL,EAAAC,EAAAC,cAACoH,GAAA,EAAD,KACGG,IAILzH,EAAAC,EAAAC,cAAC0L,GAAA,EAAD,KACE5L,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQC,QAAS,kBAAMw/B,GAAU,IAAQrhC,MAAM,WAA/C,MAGA5I,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQC,QAAS,kBAAMw/B,GAAU,IAAOrhC,MAAM,WAA9C,UClBFjD,GAAYC,aCrBH,SAAAC,GAAK,MAAK,CACvBC,KAAM,GAGNskC,KAAM,GAGNC,OAAQ,CACNpkC,SAAU,WACVG,OAAQ,GACRF,IAAKL,EAAM8C,QAAQ,GACnBxC,KAAMN,EAAM8C,QAAQ,GACpBK,QAAS,IAEXshC,cAAe,CACb/lC,WAAYsB,EAAMjC,QAAQC,QAAQ6jC,KAClC1+B,QAAS,IAIXuhC,eAAgB,CACdC,QAAS,CACPxhC,QAAS,KAGbyhC,aAAc,CACZ/hC,QAAO,GAAApN,OAAKuK,EAAM8C,QAAQ,GAAnB,gBACP6hC,QAAS,CACPxhC,QAAS,IAGbs8B,IAAK,GAGLoF,gBAAiB,CACf7O,gBAAiB1pB,KAAI,MAEvBw4B,SAAU,MDdNC,GAAY,SAAA9qC,GAA6D,IAA1DmT,EAA0DnT,EAA1DmT,OAAQ43B,EAAkD/qC,EAAlD+qC,QAASC,EAAyChrC,EAAzCgrC,YAAa/Q,EAA4Bj6B,EAA5Bi6B,SAAUgR,EAAkBjrC,EAAlBirC,YAAkBrhC,EACzCC,oBAAS,GADgCC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GACtEshC,EADsEphC,EAAA,GAC1DqhC,EAD0DrhC,EAAA,GAEvE5C,EAAUrB,KAF6DqE,EAGnCL,mBAAS,IAH0BM,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAGtEkhC,EAHsEjhC,EAAA,GAGvDkhC,EAHuDlhC,EAAA,GAAAuR,EAIrD7R,mBAAS,IAJ4C8R,EAAAtiB,OAAA0Q,GAAA,EAAA1Q,CAAAqiB,EAAA,GAItE4vB,EAJsE3vB,EAAA,GAIhE4vB,EAJgE5vB,EAAA,GAAA6vB,EAKnC3hC,oBAAS,GAL0B4hC,EAAApyC,OAAA0Q,GAAA,EAAA1Q,CAAAmyC,EAAA,GAKtEE,EALsED,EAAA,GAKvDE,EALuDF,EAAA,GAAApP,EAOhDhK,qBAAW+C,IAAhCl8B,EAPqEmjC,EAOrEnjC,aAAc0yC,EAPuDvP,EAOvDuP,GAUhBC,EAAwB,WAC5BV,GAAc,GACdE,EAAiB,KASbS,EAAiB,SAACjyC,GAEtB,GADcuxC,EAAc9uC,QAAQzC,GACxB,EAAGwxC,EAAgB,GAAA7vC,OAAAnC,OAAAia,GAAA,EAAAja,CAAK+xC,GAAL,CAAoBvxC,SAC9C,CACH,IAAMkyC,EAAYX,EAAcnxC,OAAO,SAAA+xC,GAAK,OAAIA,IAAUnyC,IACjC,IAArBkyC,EAAUxvC,QAAcsvC,IAC5BR,EAAiBU,KAIrBzmC,oBAAU,WACR6N,EAAOuH,QAAP,eAAAtM,EAAA/U,OAAAuc,EAAA,EAAAvc,CAAAwc,EAAA1V,EAAA2V,KAAe,SAAAC,EAAM3C,GAAN,OAAAyC,EAAA1V,EAAAsW,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAAAF,EAAA4F,GACbivB,EADa70B,EAAAsa,GAAApiB,EAAA,EAAA8H,EAAAwa,GAAA,GAAAxa,EAAAya,GACAma,EADA50B,EAAAu1B,GAAAje,GAAA,EAAAtX,EAAAw1B,GAAA,GAAAx1B,EAAAy1B,GACO/4B,EAAGvZ,GADV6c,EAAAE,KAAA,EACqB1d,EAAaysC,aAAavyB,EAAI,SADnD,OAAAsD,EAAA01B,GAAA11B,EAAAM,KAAAN,EAAA21B,IAAA,EAAA31B,EAAAu1B,IAAAv1B,EAAAw1B,GAAAx1B,EAAAy1B,GAAAz1B,EAAA01B,IAAA11B,EAAA41B,IAAA,EAAA51B,EAAAsa,IAAAta,EAAAwa,GAAAxa,EAAAya,GAAAza,EAAA21B,KAAA,EAAA31B,EAAA4F,IAAA5F,EAAA41B,IAAA,yBAAA51B,EAAAY,SAAAvB,MAAf,gBAAAwB,GAAA,OAAAnJ,EAAA1O,MAAAtG,KAAA8E,YAAA,KAGC,CAACiV,IAEJ,IASMw1B,EAAYtvC,OAAAia,GAAA,EAAAja,CAAO8Z,GAGzB,OAFAw1B,EAAaC,KAAK,SAACzoC,EAAG0oC,GAAJ,OAAUjE,SAASiE,EAAEltC,QAAS,IAAMipC,SAASzkC,EAAExE,QAAS,MAGxEuE,EAAAC,EAAAC,cAAA,WACEF,EAAAC,EAAAC,cAACmsC,GAAA,EAAD,CAAUC,KAAMzB,EAAS0B,WAAY,IAAKplC,UAAWH,EAAQlB,MAC1D2iC,EAAap6B,IAAI,SAACpT,EAAOkY,GACxB,IAAMgvB,EAAW+I,EAAc9uC,QAAQnB,EAAMtB,KAAO,EAE9C6yC,EAAYd,EAAGe,QAAQ,SAAUxxC,EAAO,SAE9C,OACE+E,EAAAC,EAAAC,cAACwsC,GAAA,EAAD,CACEpyC,IAAG,WAAAgB,OAAa6X,GAChB1I,QAAS,SAACtN,GAAD,OAAOqvC,GAvBL,SAACrvC,EAAGlC,GACzBkC,EAAEosB,iBACFpsB,EAAEsuB,kBAEEuf,EAAYY,EAAe3wC,EAAMtB,IAEhCoxC,EAAY9vC,EAAMtB,IAiBgBgzC,CAAexvC,EAAGlC,IAC/CkM,UAAWkoB,KACTroB,EAAQojC,KACRY,IAAewB,GAAaxlC,EAAQsjC,cACpCU,GAAcwB,IAAcrK,GAAYn7B,EAAQujC,eAChDS,GAAc7I,GAAYn7B,EAAQyjC,eAGpCzqC,EAAAC,EAAAC,cAAConC,GAAD,CACErsC,MAAOA,EACPyqC,aAAc,CAAC,SAAU,QAAS,SAClCE,OAAK,EACLH,aAAczsC,EAAaysC,aAC3Bt+B,UAAWH,EAAQs+B,MAGpBkH,GAAa1B,GACZ9qC,EAAAC,EAAAC,cAAC83B,GAAA,EAAD,CAAKlY,KAAK,QAAQwY,aAAW,MAAMnxB,UAAWH,EAAQqjC,OAAQ5/B,QAAS,SAACtN,GAAD,OA3ExD,SAACA,EAAGxD,GAC/BwD,EAAEosB,iBACFpsB,EAAEsuB,kBAEFwf,GAAc,GACdW,EAAejyC,GAsE2EizC,CAAqBzvC,EAAGlC,EAAMtB,MACxGqxC,GAAe7I,EAAyBniC,EAAAC,EAAAC,cAAC2sC,GAAA5sC,EAAD,MAAdD,EAAAC,EAAAC,cAAC4sC,GAAA7sC,EAAD,OAGhCD,EAAAC,EAAAC,cAACmpC,GAAA,EAAD,CACElU,MAAOn1B,EAAAC,EAAAC,cAAA,YAAO3C,aAAWtC,EAAMQ,gBAMzCuE,EAAAC,EAAAC,cAACwoB,GAAA,EAAD,CACE9d,KAAMogC,EACN+B,iBAAkB,KAClBC,aAAc,CACZxU,mBAAoB,0BACpBrxB,UAAWH,EAAQ0jC,iBAErBjjC,QAASzH,EAAAC,EAAAC,cAAA,QAAMvG,GAAG,2BACfuxC,EAAc7uC,QAAU4W,EAAO5W,OAAS,8DAAxC,GAAAf,OAA4G4vC,EAAc7uC,OAA1H,qBAEH+wB,OAAQptB,EAAAC,EAAAC,cAAA,WACNF,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQ5B,MAAM,UAAU0B,SAAU4gC,EAAc7uC,QAAU4W,EAAO5W,OAAQyjB,KAAK,QAAQrV,QAAS,kBAAMghC,GAAiB,KAAtH,UAGAzrC,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQ5B,MAAM,UAAUkX,KAAK,QAAQrV,QAAS,kBAAMkhC,MAApD,WAKFxkC,UAAWH,EAAQ2jC,WAGrB3qC,EAAAC,EAAAC,cAAC+sC,GAAD,CACEriC,KAAM4gC,EACNvB,UAjGkB,SAACiD,GACvBzB,GAAiB,IACI,IAAjByB,GAAyBhC,EAAc7uC,OAAS4W,EAAO5W,QAAQ09B,EAASmR,GAC5ES,KA+FIxW,MAAK,UAAA75B,OAAY4vC,EAAc7uC,OAA1B,WACLoL,QAAQ,oDAehBmjC,GAAUrQ,aAAe,CACvBuQ,aAAa,EACbD,QAAS,GAGID,UErKAuC,GAAA,SAAAtnC,GAAK,MAAK,CACvBC,KAAM,CACJc,QAAS,OACTb,OAAQ,OACRc,cAAe,SACf4B,SAAU,UAEZ2kC,OAAQ,CACNnkC,SAAU,GAEZxC,MAAO,CACLR,SAAU,WACVgD,SAAU,EACVokC,UAAW,SACXC,6BAA8B,SAEhCC,QAAS,CACP3uB,UAAW/Y,EAAM8C,QAAQ,IAE3B6kC,QAAS,CACPvnC,SAAU,WACVF,OAAQ,OACRtC,MAAO,OACPyC,IAAK,EACLC,KAAM,GAERsnC,aAAc,CACZxkC,SAAU,EACVykC,aAAc,WACdrkC,WAAY,SACZZ,SAAU,UAEZ0uB,OAAQ,CACNlxB,SAAU,WACV4wB,OAAQhxB,EAAM8C,QAAQ,GACtBi2B,MAAO/4B,EAAM8C,QAAQ,GAIrBvC,OAAQ,KAEVunC,KAAM,CACJ1kC,SAAU,GAEZ2kC,SAAU,CACRvN,SAAU,SAEVtJ,UAAW,iBAEb8W,SAAU,CACRjnC,QAAS,OACT8B,QAAS7C,EAAM8C,QAAQ,IAEzBmlC,WAAY,GAIZC,iBAAkB,CAChB9nC,SAAU,WACVgD,SAAU,EACVR,SAAU,SACV3B,UAAW,SACXF,QAAS,OACTb,OAAQ,OACRc,cAAe,UAEjBmnC,gBAAiB,CACflnC,UAAW,SACXqC,aAActD,EAAM8C,QAAQ,IAE9BslC,gBAAiB,CACfjlC,QAAS,IAEX0C,YAAa,GAGb0jB,SAAU,CACRxmB,MAAO/C,EAAMjC,QAAQ8+B,KAAK,QCnCxB/8B,GAAYC,aAAWuJ,IA0Ld++B,GAxLI,SAAApuC,GAMb,IALJquC,EAKIruC,EALJquC,iBAAkB7iC,EAKdxL,EALcwL,SAClB8iC,EAIItuC,EAJJsuC,aAAcC,EAIVvuC,EAJUuuC,eAAgBC,EAI1BxuC,EAJ0BwuC,YAC9BC,EAGIzuC,EAHJyuC,eAAgBC,EAGZ1uC,EAHY0uC,aAAczD,EAG1BjrC,EAH0BirC,YAAa0D,EAGvC3uC,EAHuC2uC,WAC3CC,EAEI5uC,EAFJ4uC,QAASC,EAEL7uC,EAFK6uC,UAAW7iB,EAEhBhsB,EAFgBgsB,aAAc8iB,EAE9B9uC,EAF8B8uC,YAClCx5B,EACItV,EADJsV,SAAUy5B,EACN/uC,EADM+uC,MAEJ7nC,EAAUrB,KADZ+D,EAE8BC,qBAF9BC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAEGolC,EAFHllC,EAAA,GAEcmlC,EAFdnlC,EAAA,GAAAI,EAGwBL,oBAAS,GAHjCM,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAGGglC,EAHH/kC,EAAA,GAGWglC,EAHXhlC,EAAA,GAAAuR,EAIsC7R,oBAAS,GAJ/C8R,EAAAtiB,OAAA0Q,GAAA,EAAA1Q,CAAAqiB,EAAA,GAIGgwB,EAJH/vB,EAAA,GAIkBgwB,EAJlBhwB,EAAA,GAAA6vB,EAKkC3hC,mBAAS,GAL3C4hC,EAAApyC,OAAA0Q,GAAA,EAAA1Q,CAAAmyC,EAAA,GAKG4D,EALH3D,EAAA,GAKgB4D,EALhB5D,EAAA,GAAApP,EAM0BhK,qBAAW+C,IAAjChxB,EANJi4B,EAMIj4B,OAAQwnC,EANZvP,EAMYuP,GAAInkB,EANhB4U,EAMgB5U,MAOd0E,EAAW,CAAEO,KAAM,IACrBtoB,GAAUA,EAAOiU,QAAmC,IAAzBjU,EAAOiU,OAAO9b,SAC3C4vB,EAASrF,UAAY1iB,EAAOiU,OAAO,GACnC8T,EAAStF,SAAWziB,EAAOiU,OAAO,IAGpC,IAAMi3B,EAAM,CACVphC,OAAQ09B,EAAGe,QAAQ,SAAUvoC,EAAQ,SAAU,KAC/CmrC,OAAQ3D,EAAGe,QAAQ,SAAUvoC,EAAQ,SAAU,KAC/CorC,WAAY5D,EAAGe,QAAQ,SAAUvoC,EAAQ,SAAU,CAAC,YAEhDqrC,EAAa/D,GAAiBwD,EAEpC,OACEhvC,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,MACtB9F,EAAAC,EAAAC,cAACkH,GAAA,EAAD,MACApH,EAAAC,EAAAC,cAACsvC,GAAA,EAAD,CAAQvpC,SAAS,SAASkB,UAAWH,EAAQomC,QAC3CptC,EAAAC,EAAAC,cAACyf,GAAA,EAAD,CAASC,gBAAc,GACrB5f,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CAAYv0B,UAAWH,EAAQ8mC,WAAYllC,MAAM,UAAU6B,QAASgkC,EAAYnW,aAAW,QACzFt4B,EAAAC,EAAAC,cAACuvC,GAAAxvC,EAAD,OAEFD,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,YAAYqB,MAAM,UAAUzB,UAAWH,EAAQymC,cAChEvpC,EAAOyU,MAAQ,UAMlB3Y,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CACEgU,gBAAc,OACd9mC,MAAM,UACN6B,QAAS,SAAA1F,GAAK,OAAIgqC,EAAahqC,EAAM8yB,iBAErC73B,EAAAC,EAAAC,cAACyvC,GAAA1vC,EAAD,OAGFD,EAAAC,EAAAC,cAAC0vC,GAAD,CAAa7W,SAAU+V,EAAWhkC,QAAS,kBAAMikC,EAAa,OAAO/V,UAAW,CAC9E,CACEh1B,KAAM,cACN+E,KAAM8mC,KACN5rB,MAAO2qB,EACPxhB,OAAQwhB,GAEV,CACE5qC,KAAM,eACN+E,KAAM+mC,KACN7rB,MAAOyqB,GAAWG,GAASz5B,EAC3BgY,OAAQshB,GAEV,CACE1qC,KAAM,iBACN+E,KAAM+mC,KACN7rB,MAAO0qB,GAAaE,IAAUz5B,EAC9BgY,OAAQuhB,GAEV,CACE3qC,KAAM,iBACN+E,KAAMgnC,GACN3iB,OAAQ,kBAAM6hB,GAAU,KAE1B,CACEjrC,KAAM,kBACN+E,KAAMinC,KACN/rB,MAAOkqB,EACP/gB,OAAQ+gB,GAEV,CAAEjV,SAAS,GACX,CACEl1B,KAAM,cACN+E,KAAMknC,KACNhsB,MAAOmqB,IAAiBgB,EAAIphC,OAC5Bof,OAAQghB,GAEV,CACEpqC,KAAM,gBACN+E,KAAMmnC,KACNjsB,MAAOwnB,IAAqB2D,EAAIC,OAChCzmC,MAAO,QACPwkB,OAAQ,kBAAMqe,GAAiB,SAIrCzrC,EAAAC,EAAAC,cAACiwC,GAAA,EAAD,CAAM5oC,QAAQ,YACZiE,MAAO0jC,EACP5jC,SAAU,SAACnO,EAAGqO,GAAJ,OAAc2jC,EAAe3jC,KAEvCxL,EAAAC,EAAAC,cAACkwC,GAAA,EAAD,CAAKzkC,MAAM,WAEX3L,EAAAC,EAAAC,cAACkwC,GAAA,EAAD,CAAKzkC,MAAM,aAIf3L,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQP,OACL,IAAhByoC,GACClvC,EAAAC,EAAAC,cAACF,EAAAC,EAAMwF,SAAP,KACGvB,EAAO+O,QAAU/O,EAAO+O,OAAO5W,OAAS,GACvC2D,EAAAC,EAAAC,cAACmwC,GAAD,CACEp9B,OAAQ/O,EAAO+O,OACf6Y,aAAcA,EACdoc,cAAe6C,IAGnB/qC,EAAAC,EAAAC,cAACowC,GAAD,CAAYhlC,SAAUA,KAGzBpH,EAAO+O,QAA0B,IAAhBi8B,GAChBlvC,EAAAC,EAAAC,cAACqwC,GAAD,CACEt9B,OAAQ/O,EAAO+O,OACf83B,YAAaA,EACbhR,SAAUsU,KAeC,IAAhBa,GAAqBE,EAAIE,YACxBtvC,EAAAC,EAAAC,cAACswC,GAAD,CACEjpB,MAAOA,EACPpgB,UAAWH,EAAQmwB,OACnB7sB,UAAWilC,EACXnY,cAAekX,EACfjX,eAAgBmX,GAEhBxuC,EAAAC,EAAAC,cAAC24B,GAAA54B,EAAD,OAGJD,EAAAC,EAAAC,cAACuwC,GAAD,CAAW7lC,KAAMokC,EAAQlkC,QAAS,kBAAMmkC,GAAU,MAClDjvC,EAAAC,EAAAC,cAAC+sC,GAAD,CACEriC,KAAM4gC,EACNvB,UA/IkB,SAACiD,GACvBzB,GAAiB,IACI,IAAjByB,GAAuBqB,EAAerqC,EAAOvK,KA8I7Cw7B,MAAM,gBACN1tB,QAAQ,mLC9KV9B,GAAYC,aAzBJ,SAAAC,GAAK,MAAK,CACtBC,KAAM,CACJrC,MAAO,EACPsC,OAAQ,EACRK,OAAQ,GAEVsqC,OAAQ,CACNjtC,MAAO,GACPsC,OAAQ,GACRE,SAAU,WACVC,IAAK,MACLC,KAAM,MACNW,UAAW,SACXgwB,gBAAiB,UACjBC,UAAW,qCAEb4Z,eAAgB,CACd1qC,SAAU,WACVC,IAAK,MACLC,KAAM,MACNW,UAAW,SACXgwB,gBAAiB,UACjBC,UAAW,wCA8CA6Z,GAzCI,SAAA9wC,GAA8BA,EAA3BmG,SAA2B,IAAjB4qC,EAAiB/wC,EAAjB+wC,WACxB7pC,EAAUrB,KAKVmrC,EAJW,GAICD,EAAWE,eAAe,GACtCC,EALW,GAKAH,EAAWE,eAAe,GAC3C,OACE/wC,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,MAEtB9F,EAAAC,EAAAC,cAAA,OACEiP,MAAO,CAAEpJ,OAAQ+qC,EAAWrtC,MAAOutC,GACnC7pC,UAAWH,EAAQ2pC,eACnBM,QAAQ,MACRC,QAAQ,kBAERlxC,EAAAC,EAAAC,cAAA,UAAQixC,GAAG,KAAKC,GAAG,KAAKC,EAAG,GACzBC,OAAO,UACPC,YAAY,MACZC,YAAY,IACZC,KAAK,aAITzxC,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQ0pC,OAAQO,QAAQ,MAAMC,QAAQ,gBACpDlxC,EAAAC,EAAAC,cAAA,UAAQixC,GAAG,IAAIC,GAAG,IAAIC,EAAE,IACtBC,OAAO,UACPE,YAAY,IACZC,KAAK,qCCtBT9rC,GAAYC,aA/BJ,SAAAC,GAAK,MAAK,CACtBC,KAAM,CACJM,OAAQ,GACRH,SAAU,YAEZyrC,aAAc,CACZ7oC,OAAQ,YACRtE,WAAYsB,EAAMjC,QAAQI,KAAKH,QAC/B+E,MAAO/C,EAAMjC,QAAQC,QAAQikB,aAC7BrkB,MAAO,GACPsC,OAAQ,IAEV4rC,gBAAiB,CACf9oC,OAAQ,YACRtE,WAAYsB,EAAMjC,QAAQC,QAAQC,KAClC8E,MAAO/C,EAAMjC,QAAQC,QAAQikB,aAC7BlJ,UAAW,EACXzV,aAAc,GAEhByoC,cAAe,GAGfC,eAAgB,CACdttC,WAAY,QACZqE,MAAO,SAET+tB,cAAe,CACb/vB,QAAS,WAMPkrC,GAAe,SAAAhyC,GAA4D,IAAzDiyC,EAAyDjyC,EAAzDiyC,eAAgBC,EAAyClyC,EAAzCkyC,UAAWC,EAA8BnyC,EAA9BmyC,UAAWC,EAAmBpyC,EAAnBoyC,aAAmBxoC,EACvDC,oBAAS,GAD8CC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GACxEkB,EADwEhB,EAAA,GAClE0tB,EADkE1tB,EAAA,GAEzE5C,EAAUrB,KACVE,EAAQm0B,eACRmY,EAAiB,SAACh1C,EAAG8K,GACzBnM,QAAQC,IAAI,iBAAkBoB,EAAG8K,GACjC9K,EAAEosB,iBACFpsB,EAAEsuB,kBACF6L,EAAQrvB,IAGV,IAAKgqC,IAAc/yC,MAAMmmB,QAAQ4sB,IAAcA,EAAU51C,OAAS,IAAM41C,EAAUD,GAAY,OAAO,KAErG,IACM/iC,EADegjC,EAAUD,GACC/iC,WAEhC,OACEjP,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,KAAMqJ,MAAO,CACnCjJ,IAAK6rC,EAAe7rC,IAAM6rC,EAAe7rC,IAAML,EAAM8C,QAAQ,GAC7Di2B,MAAOmT,EAAenT,MAAQmT,EAAenT,MAAQ/4B,EAAM8C,QAAQ,KAElEspC,EAAU51C,OAAS,GAClB2D,EAAAC,EAAAC,cAACkyC,GAAA,EAAD,CACEC,UAAU,oBACVlrC,UAAWH,EAAQsrC,UACnBtrC,QAAS,CACPovB,IAAKpvB,EAAQ0qC,aACb/a,cAAe3vB,EAAQ2vB,eAEzB5tB,KAAM/I,EAAAC,EAAAC,cAAC+O,EAAD,CAAY9H,UAAWH,EAAQ+B,OAErC0B,QAAS,SAACtN,GAAD,OAAOg1C,EAAeh1C,GAAIyN,IACnCE,QAAS,SAAC3N,GAAD,OAAOg1C,EAAeh1C,GAAG,IAIlCyN,KAAMA,EACNgO,UAAU,QAGTq5B,EAAU5jC,IAAI,SAAAH,EAAgCiF,GAAhC,IAAGpE,EAAHb,EAAGa,KAAkBD,GAArBZ,EAASe,WAATf,EAAqBY,SAArB,OACb9O,EAAAC,EAAAC,cAACqyC,GAAA,EAAD,CACEj4C,IAAG,cAAAgB,OAAgB6X,GAEnBpK,KAAM/I,EAAAC,EAAAC,cAAC6O,EAAD,CAAM5H,UAAWH,EAAQ4qC,gBAC/BY,iBAAiB,SACjBC,YAAa,CACXzrC,QAAS,CACPlB,KAAMkB,EAAQ2qC,kBAGlBe,eAAgB,CACdC,QAAS3rC,EAAQ6qC,gBAEnBe,aAAc9jC,EACd+jC,aAAW,EACXpoC,QAAS,WACPynC,EAAa/+B,GACbmkB,GAAQ,WAkBxBwa,GAAavX,aAAe,CAC1BwX,eAAgB,IAGHD,UC5FTnsC,GAAYC,aArBJ,SAAAC,GAAK,MAAK,CACtBC,KAAM,CACJ+C,OAAQ,YACRtE,WAAYsB,EAAMjC,QAAQ8+B,KAAK,KAC/B95B,MAAO,QACPnF,MAAO,GACPsC,OAAQ,GACRK,OAAQ,GACRH,SAAU,eAwCC6sC,GAzBU,SAAAhzC,GAA2C,IAAxC2K,EAAwC3K,EAAxC2K,QAASsnC,EAA+BjyC,EAA/BiyC,eAAgBznC,EAAexK,EAAfwK,SAC7CtD,EAAUrB,KACVE,EAAQm0B,eACd,OACEh6B,EAAAC,EAAAC,cAAC83B,GAAA,EAAD,CACE1tB,SAAUA,EACV6E,MAAO,CACLjJ,IAAK,IAAM6rC,EAAe7rC,IAAM6rC,EAAe7rC,IAAML,EAAM8C,QAAQ,IACnEi2B,MAAOmT,EAAenT,MAAQmT,EAAenT,MAAQ/4B,EAAM8C,QAAQ,IAErE2vB,aAAW,aACXnxB,UAAWH,EAAQlB,KACnB2E,QAASA,GAETzK,EAAAC,EAAAC,cAAC8/B,GAAA//B,EAAD,QCzBA8yC,kBAAU,SAACnrC,GAAU,IAkCrBorC,EA/BFC,EAgBErrC,EAhBFqrC,OACAlzC,EAeE6H,EAfF7H,SACAkyC,EAcErqC,EAdFqqC,UACAF,EAaEnqC,EAbFmqC,eACUmB,EAYRtrC,EAZFqkB,SACA0T,EAWE/3B,EAXF+3B,OACAwT,EAUEvrC,EAVFurC,aACAC,EASExrC,EATFwrC,QACAC,EAQEzrC,EARFyrC,UACkBC,EAOhB1rC,EAPF2rC,iBACmBC,EAMjB5rC,EANF6rC,kBACiBC,EAKf9rC,EALF+rC,gBACAC,EAIEhsC,EAJFgsC,YACAC,EAGEjsC,EAHFisC,eACAC,EAEElsC,EAFFksC,aACGC,EAlBoB56C,OAAAqV,EAAA,EAAArV,CAmBrByO,EAnBqB,oNAqBnBosC,EAAkBnvC,iBAAO,MACzBovC,EAAYpvC,iBAAO,MACnBqvC,EAAsBrvC,iBAAO,MAE3Bib,EAAS+d,GAAiBmW,GAA1Bl0B,KAzBiBpW,EA2BSC,mBAAS0pC,GA3BlBzpC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GA2BlBsoC,EA3BkBpoC,EAAA,GA2BPsoC,EA3BOtoC,EAAA,GAAAI,EA8BOL,mBAASxQ,OAAAuV,EAAA,EAAAvV,CAAA,GAAKg7C,GAAoBjB,IA9BzCjpC,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GA8BlBiiB,EA9BkBhiB,EAAA,GA8BRmqC,EA9BQnqC,EAAA,GAAAuR,EA+BqB7R,oBAAS,GA/B9B8R,EAAAtiB,OAAA0Q,GAAA,EAAA1Q,CAAAqiB,EAAA,GA+BlB64B,EA/BkB54B,EAAA,GA+BD64B,EA/BC74B,EAAA,GAAA6vB,EAgCW3hC,mBAAS,MAhCpB4hC,EAAApyC,OAAA0Q,GAAA,EAAA1Q,CAAAmyC,EAAA,GAgClBuF,EAhCkBtF,EAAA,GAgCNgJ,EAhCMhJ,EAAA,GAqCnBiJ,GAFNxB,EAAa1sB,MAEiBK,UAAYqsB,EAAWpsB,UAEjD5mB,EAAAC,EAAAC,cAACu0C,GAAA,EAAD,CACEn6C,IAAI,QACJ6M,UAAU,cACVutC,aAAa,EACb/tB,SAAUqsB,EAAWrsB,SACrBC,UAAWosB,EAAWpsB,UACtBzX,MAAO,CAAE/I,OAAQ,IACjBpG,EAAAC,EAAAC,cAACy0C,GAAD,CAAY1uC,SAAU+sC,EAAYnC,WAAYA,KAE9C,KAGNpnB,kBAAQ,WACN,MAAK3J,GAAQA,EAAKrc,MAAQ,IAAMqc,EAAK/Z,OAAS,IAA9C,CACIksC,EAAU51C,QAAU21C,GAAWE,EAAamB,GAChD,IACE,IAAMxC,EAAa+D,aAAkB3oB,GAErCsoB,EAAc1D,GAEhB,MAAO1zC,GACLrB,QAAQC,IAAI,QAASkwB,GACrBnwB,QAAQsB,MAAMD,MAEf,CAAC8uB,EAASO,KAAM1M,IAEnB,IAwBMyzB,EAAmB,SAACsB,GACxB,IAAMC,EAAW37C,OAAAuV,EAAA,EAAAvV,CAAA,GAAQ07C,GAErBlV,GAAUwT,IACR2B,EAAYluB,UAAY+Y,EAAO,GAAImV,EAAYluB,UAAY+Y,EAAO,GAC7DmV,EAAYluB,UAAY+Y,EAAO,KAAImV,EAAYluB,UAAY+Y,EAAO,IAEvEmV,EAAYnuB,SAAWgZ,EAAO,GAAImV,EAAYnuB,SAAWgZ,EAAO,GAC3DmV,EAAYnuB,SAAWgZ,EAAO,KAAImV,EAAYnuB,SAAWgZ,EAAO,KAEvEyT,IACF0B,EAAYnuB,SAAWsF,EAAStF,SAChCmuB,EAAYluB,UAAYqF,EAASrF,WAK9BytB,GAAuD,oBAA7Bf,GAC7BA,EAAyB,CACvBrnB,SAAU6oB,EACVh1B,OACA+wB,aACAxiC,IAAK4lC,EAAUjvC,SAAWivC,EAAUjvC,QAAQ+vC,WAGhDX,EAAYU,IAsDd,OAPArrB,kBA5CyB,WAEvB,MAAKkW,IAAW7f,GAAQA,EAAKrc,MAAQ,IAAMqc,EAAK/Z,OAAS,IAAMsuC,GAA/D,CAF6B,IAAAW,EAAA77C,OAAA0Q,GAAA,EAAA1Q,CAIYwmC,EAJZ,GAItBsV,EAJsBD,EAAA,GAIdE,EAJcF,EAAA,GAING,EAJMH,EAAA,GAIEI,EAJFJ,EAAA,GAK7B,IAAI,IAAAK,EAEoC,IAAIC,KAAJn8C,OAAAuV,EAAA,EAAAvV,CAAA,GAA6B2mB,EAASmM,IAAYspB,UACtF,CAAE,CAACN,EAAQC,GAAS,CAACC,EAAQC,IAC7B,CAAE1sC,QAAS,GAAI8sC,OAAQ,CAAC,EAAG,KAFrB5uB,EAFNyuB,EAEMzuB,UAAWD,EAFjB0uB,EAEiB1uB,SAAU6F,EAF3B6oB,EAE2B7oB,KAO7B4nB,EAAYj7C,OAAAuV,EAAA,EAAAvV,CAAA,GAAK8yB,EAAN,CAAgBrF,YAAWD,WAAU6F,UAElD,MAAOrvB,GAELrB,QAAQsB,MAAMD,MA0BQ,CAAC2iB,EAAM6f,IAEjCv6B,oBAAU,WACRgvC,EAAYj7C,OAAAuV,EAAA,EAAAvV,CAAA,GAAK8yB,EAAainB,KAE9B,CAACA,IAGDlzC,EAAAC,EAAAC,cAAA,OAAKiH,UAAWkoB,KAAW,eAAgBznB,EAAMT,WAAYD,IAAK8sC,GAC/Dl0B,EAAK/Z,OAAS,GAAK+Z,EAAKrc,MAAQ,GAC/BzD,EAAAC,EAAAC,cAACu0C,GAAA,EAADt7C,OAAAyV,OAAA,GACMqd,EACCioB,EAAoBlvC,SAAW4uC,EAFtC,CAGE1sC,IAAK,SAAAmH,GACH4lC,EAAUjvC,QAAUqJ,GAEtBtI,OAAQ+Z,EAAK/Z,OACbtC,MAAOqc,EAAKrc,MACZgyC,SAAUzD,EAAYC,EAAU51C,OAAS41C,EAAUD,GAAW7iC,MAAQ8iC,EAAU,GAAG9iC,MACnFumC,OAAQ7B,EACRJ,kBA1CsB,WAE5Ba,GAAmB,GACsB,oBAA9Bd,GAA0CA,KAwC/CG,gBArCoB,WAE1BW,GAAmB,GACnBJ,EAAoBlvC,QAAU,KAC1B0uC,GAAyBA,IACW,oBAA7BJ,GACTA,EAAyB,CACvBrnB,WACAnM,OACA+wB,aACAxiC,IAAK4lC,EAAUjvC,SAAWivC,EAAUjvC,QAAQ+vC,YA4B1CY,SAAUvC,EACVG,iBAAkBA,EAClBqC,qBAAsBnmC,GAAUC,aAC5BqkC,GAGFh0C,GAAYb,MAAMmmB,QAAQtlB,GACtBA,EAASsO,IAAI,SAACwnC,EAAG1iC,GAAJ,OAAY0iC,EAAIl2C,IAAMm2C,aACnCC,GAAYF,EAAG5pB,EAAUnM,EAAK/Z,OAAQ+Z,EAAKrc,MAAOotC,GAClD,CAAEv2C,IAAG,YAAAgB,OAAc6X,KACjB,OACF4iC,GAAYh2C,EAAUksB,EAAUnM,EAAK/Z,OAAQ+Z,EAAKrc,MAAOotC,GAG7DiD,GACA9zC,EAAAC,EAAAC,cAAC81C,GAAD,CACEjE,eAAgBA,EAChBC,UAAWA,EACXC,UAAWA,EACXC,aAAcA,KAIftqC,EAAMquC,iBACPj2C,EAAAC,EAAAC,cAACu0C,GAAA,EAAD,CACElB,iBAAkB,SAAAtnB,GAAQ,OAAIsnB,EAAiBp6C,OAAAuV,EAAA,EAAAvV,CAAA,GAAK8yB,EAAanM,KACjEo2B,UAA+B,KAApBtuC,EAAMuuC,YAA6C,KAArBvuC,EAAMwuC,WAC/CC,aAAoC,KAAtBzuC,EAAM0uC,cAA+C,KAArB1uC,EAAM2uC,aAGvDtD,IAAWG,GACVpzC,EAAAC,EAAAC,cAACF,EAAAC,EAAMwF,SAAP,KACG+uC,EACDx0C,EAAAC,EAAAC,cAACs2C,GAAD,CAAkBlsC,UAAW0oC,IAAeA,EAAWrsB,SAAUorB,eAAgBA,EAAgBtnC,QAvJ7F,WACTuoC,EAAWrsB,UAAaqsB,EAAWpsB,YAExCstB,EAAoBlvC,QAAU,CAC5ByxC,mBAFqB,IAGrBC,uBAAwB,IAAIC,KAC5BC,iBAAkBC,MAGpBt3C,WAAW,WACL20C,EAAoBlvC,UAASkvC,EAAoBlvC,QAAU,OAR1C,KAUvBovC,EAAYj7C,OAAAuV,EAAA,EAAAvV,CAAA,GACP8yB,EADM,CAETtF,SAAUqsB,EAAWrsB,SACrBC,UAAWosB,EAAWpsB,UACtB4F,KAAMP,EAASO,KAAO,GAAKP,EAASO,KAAO,eA+KjDumB,GAAQxY,aAAe,CACrBwX,eAAgB,GAChB+B,cAAc,EACdT,UAAW,EACXpB,UAAWxiC,GAAUE,OACrBwjC,cAAc,GAGDJ,UAEToB,GAAkB,CACtBxtB,SAAU,WACVC,WAAY,YACZkwB,QAAS,EACTC,MAAO,EACPvqB,KAAM,IAGR,SAASupB,GAAaiB,EAAO/qB,EAAUlmB,EAAQtC,EAAOotC,GACpD,MAAwB,oBAAVmG,EACVA,EAAM/qB,EAAUlmB,EAAQtC,EAAOotC,GAC/BmG,ECpSN,IAyDMrxC,GAAYC,aAzDJ,SAAAC,GAAK,MAAK,CACtBC,KAAM,CACJ8C,MAAO/C,EAAMjC,QAAQC,QAAQC,KAC7BmC,SAAU,WACVC,IAAK,MACLC,KAAM,MACNW,UAAW,SACXgwB,gBAAiB,UACjBC,UAAW,oCACX3wB,OAAQ,GAEV6wC,WAAY,CACV7wC,OAAQ,IAEVsqC,OAAQ,CACNtqC,OAAQ,GACR3C,MAAO,GACPsC,OAAQ,GACRE,SAAU,WACVC,IAAK,MACLC,KAAM,MACNW,UAAW,SACXgwB,gBAAiB,UACjBC,UAAW,qCAEbmgB,IAAK,CACH5F,OAAQzrC,EAAMjC,QAAQG,UAAU+jB,aAChC0pB,YAAa,IACbC,KAAM5rC,EAAMjC,QAAQG,UAAUD,MAEhCqzC,mBAAoB,CAClBlxC,SAAU,WACVE,KAAM,MAGNC,OAAQ,IAEVuS,KAAM,CACJ/P,MAAO,QACPw5B,WAAY,OACZgV,WAAU,sEAIVhxC,OAAQ,GACRH,SAAU,YAGZoxC,WAAY,CACVzuC,MAAO/C,EAAMjC,QAAQG,UAAU2jC,KAC/B0P,WAAU,wFA0CCE,GAjCA,SAAAx3C,GAAmB,IAAhB8Y,EAAgB9Y,EAAhB8Y,UACV5R,EAAUrB,KAChB,OACE3F,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,MACtB9F,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQ0pC,OAAQO,QAAQ,MAAMC,QAAQ,gBACpDlxC,EAAAC,EAAAC,cAAA,UAAQixC,GAAG,IAAIC,GAAG,IAAIC,EAAE,IAAIlqC,UAAWH,EAAQkwC,OAEhDt+B,GAAaA,GAAa,EACzB5Y,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQmwC,oBACtBn3C,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQuwC,OACtBtG,QAAQ,MACRxtC,MAAM,MACNsC,OAAO,MACPmrC,QAAQ,iBACR/hC,MAAO,CAAE4nB,UAAS,6CAAAz7B,OAA+Csd,EAA/C,UAClB5Y,EAAAC,EAAAC,cAAA,QAAM5C,EAAE,mGACNm0C,KAAK,UACLF,YAAY,QACZC,YAAY,MACZgG,cAAc,MACdlG,OAAO,cAIX,OCzEJmG,GAAgB,SAAC7vC,GAAU,IAE7BmqC,EAMEnqC,EANFmqC,eACA9lB,EAKErkB,EALFqkB,SACAlsB,EAIE6H,EAJF7H,SACAkyC,EAGErqC,EAHFqqC,UACA4B,EAEEjsC,EAFFisC,eACGE,EAP0B56C,OAAAqV,EAAA,EAAArV,CAQ3ByO,EAR2B,uEAUzB8vC,EAAS7yC,iBAAO,MAChBovC,EAAYpvC,mBACVib,EAAS+d,GAAiB6Z,EAAQ,CAAEj0C,MAAO,IAAKsC,OAAQ,KAAxD+Z,KAZuBpW,EAcGC,mBAAS,GAdZC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAcxBsoC,EAdwBpoC,EAAA,GAcbsoC,EAdatoC,EAAA,GAAAI,EAeKL,mBAAS,MAfdM,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAexB6mC,EAfwB5mC,EAAA,GAeZsqC,EAfYtqC,EAAA,GAiBzB0tC,EAAmB,WACvB,MAAK73B,GAAQA,EAAKrc,MAAQ,IAAMqc,EAAK/Z,OAAS,IAC9C,IACE,IAAM8qC,EAAa+D,aAAkB3oB,GAErCsoB,EAAc1D,GAEhB,MAAO1zC,GAELrB,QAAQsB,MAAMD,KAOlB,OAHK0zC,GAAY8G,IACjBluB,kBAAQkuB,EAAkB,CAAC73B,IAGzB9f,EAAAC,EAAAC,cAAA,OAAKiH,UAAWkoB,KAAW,UAAWznB,EAAMT,WAAYD,IAAKwwC,EAAQvoC,MAAO,CAAEpJ,OAAQ,OAAQtC,MAAO,SACnGzD,EAAAC,EAAAC,cAACu0C,GAAA,EAADt7C,OAAAyV,OAAA,GACMqd,EADN,CAEElmB,OAAQ+Z,EAAK/Z,OACbtC,MAAOqc,EAAKrc,MACZgyC,SAAUxD,EAAUD,GAAW7iC,MAC/BumC,OAAQ7B,EACR+B,qBAAsBnmC,GAAUC,aAC5BqkC,EAPN,CAQE7sC,IAAK,SAAAmH,GACH4lC,EAAUjvC,QAAUqJ,KAGpB4jC,GAAaA,EAAU51C,OAAS,EAChC2D,EAAAC,EAAAC,cAAC81C,GAAD,CACEjE,eAAgBA,EAChBC,UAAWA,EACXC,UAAWA,EACXC,aAAcA,IAEd,KAEFnyC,GAAYb,MAAMmmB,QAAQtlB,GACtBA,EAASsO,IAAI,SAAAwnC,GAAC,OAAIE,GAAYF,EAAG5B,EAAWn0B,EAAK/Z,OAAQ+Z,EAAKrc,MAAOotC,KACrEkF,GAAYh2C,EAAUk0C,EAAWn0B,EAAK/Z,OAAQ+Z,EAAKrc,MAAOotC,MAOxE,SAASkF,GAAaiB,EAAO/C,EAAWluC,EAAQtC,EAAOotC,GAErD,MAAwB,oBAAVmG,EACVA,EAFa,GAEGjxC,EAAQtC,EAAOotC,GAC/BmG,EAgCNS,GAAcld,aAAe,CAC3BwX,eAAgB,GAChB+B,cAAc,EAMdT,UAAW,EACXpB,UAAWxiC,GAAUE,QAGR8nC,UC3EAG,GAzCA,SAAA93C,GAAiF,IAA9E+3C,EAA8E/3C,EAA9E+3C,UAAWC,EAAmEh4C,EAAnEg4C,SAAUnxB,EAAyD7mB,EAAzD6mB,SAAUC,EAA+C9mB,EAA/C8mB,UAAWtb,EAAoCxL,EAApCwL,SAAUsN,EAA0B9Y,EAA1B8Y,UAAchR,EAAYzO,OAAAqV,EAAA,EAAArV,CAAA2G,EAAA,wEACxFi4C,EAAMF,EAAYJ,GAAgB1E,GAElCiF,EAAWH,EAAY,GAAK,CAChCvB,aAAa,EACbC,YAAY,EACZtD,OAAQ6E,EACR1E,SAAU0E,EACVvE,iBAAkBjoC,GAGpB,OACEtL,EAAAC,EAAAC,cAAC63C,EAAD5+C,OAAAyV,OAAA,GACMopC,EACApwC,GAEH+e,GAAYC,EACX5mB,EAAAC,EAAAC,cAACu0C,GAAA,EAAD,CACEttC,UAAW,eACXwf,SAAUA,EACVC,UAAWA,GAEX5mB,EAAAC,EAAAC,cAAC+3C,GAAD,CAAKr/B,UAAWA,KAGhB5Y,EAAAC,EAAAC,cAAC+3C,GAAD,CAAKr/B,UAAWA,iBCiBpBjT,GAAYC,aAvCJ,SAAAC,GAAK,MAAK,CACtBC,KAAM,GAGNoyC,WAAY,CACVtxC,QAAS,OACTC,cAAe,SACf6B,QAAS,GAEXyvC,WAAY,CACVlvC,SAAU,GAEZmvC,cAAe,CACb1vC,QAAS,QAEX2vC,OAAQ,GAGRC,WAAY,GAGZpd,KAAM,CACJzyB,SAAU,SACVY,WAAY,WACZ8xB,cAAet1B,EAAM8C,QAAQ,IAE/BwsB,MAAO,CACL5wB,WAAYsB,EAAMjC,QAAQC,QAAQC,KAClC8E,MAAO/C,EAAMjC,QAAQC,QAAQikB,aAC7BvkB,OAAQ,EACRmF,QAAS7C,EAAM8C,QAAQ,IAEzB2yB,YAAa,CACXr1B,SAAU,WACV24B,MAAO/4B,EAAM8C,QAAQ,GACrBzC,IAAKL,EAAM8C,QAAQ,GACnBC,MAAO/C,EAAMjC,QAAQ8+B,KAAK,SAwEf6V,GAnEM,SAAAz4C,GAAiG,IAA9F8K,EAA8F9K,EAA9F8K,KAAM4tC,EAAwF14C,EAAxF04C,KAAMC,EAAkF34C,EAAlF24C,SAAUtjB,EAAwEr1B,EAAxEq1B,MAAiBujB,EAAuD54C,EAAjE6mB,SAA8BgyB,EAAmC74C,EAA9C8mB,UAAgCgyB,EAAc94C,EAAzB8Y,UACrF5R,EAAUrB,KADoG+D,EAEvEC,mBAAS,CAAEid,UAAW+xB,EAAUhyB,SAAU+xB,IAF6B9uC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAAA6Y,EAAA3Y,EAAA,GAE3Ggd,EAF2GrE,EAE3GqE,UAAWD,EAFgGpE,EAEhGoE,SAAYkyB,EAFoFjvC,EAAA,GAAAI,EAGnFL,mBAASivC,GAH0E3uC,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAG7G4O,EAH6G3O,EAAA,GAGlG6uC,EAHkG7uC,EAAA,GAK9GipC,EAAezpB,kBAAQ,iBAAO,CAClC+C,KAAM,GACN7F,SAAU+xB,EACV9xB,UAAW+xB,IACT,CAACD,EAASC,IAId,OACE34C,EAAAC,EAAAC,cAACyK,GAAA,EAAD,CACE6wB,OAAO,QACP5wB,KAAMA,EACNC,WAAS,EACTg4B,YAAU,EACV/3B,QAAS2tC,GAETz4C,EAAAC,EAAAC,cAAC8K,GAAA,EAAD,CAAa7D,UAAWH,EAAQmuB,MAAOsG,mBAAiB,GACtDz7B,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYsB,MAAM,WAAWusB,IAE/Bn1B,EAAAC,EAAAC,cAAC+K,GAAA,EAAD,CAAe9D,UAAWH,EAAQkxC,YAChCl4C,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQmxC,YACtBn4C,EAAAC,EAAAC,cAAC64C,GAAD,CACEjB,UAAQ,EACR3wC,UAAWH,EAAQqH,IACnBuK,UAAWA,EAAY,EAAIA,EAAY,KACvCqT,SAAUinB,EACV5nC,SApBQ,SAAA4C,GAAA,IAAA8qC,EAAA9qC,EAAG+d,SAAYrF,EAAfoyB,EAAepyB,UAAWD,EAA1BqyB,EAA0BryB,SAA1B,OAA2CkyB,EAAU,CAAEjyB,YAAWD,iBAuB9E3mB,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQoxC,eACtBp4C,EAAAC,EAAAC,cAACm6B,GAAA,EAAD,CAAWlzB,UAAWH,EAAQiyC,cAA9B,aAAuDrgC,GAAa,EAAI,GAAK,SAC7E5Y,EAAAC,EAAAC,cAACg5C,GAAA,EAAD,CACElyC,QAAS,CACPlB,KAAMkB,EAAQsxC,YAEhB9sC,MAAOoN,IAAc,EACrBuuB,KAAM,EACNzpB,IAAK,IACLy7B,KAAM,EACN7tC,SAAU,SAACnO,EAAGqO,GAAJ,OAAcstC,EAAYttC,QAI1CxL,EAAAC,EAAAC,cAAC0L,GAAA,EAAD,KACE5L,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQC,QAASguC,GAAjB,UACAz4C,EAAAC,EAAAC,cAAA,OAAKiP,MAAO,CAAElG,SAAU,KACxBjJ,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQC,QAAS,kBAAM+tC,EAAK,CAAE5xB,YAAWD,WAAU/N,gBAAnD,SC/DFjT,GAAYC,aA/BJ,SAAAC,GAAK,MAAK,CACtBC,KAAM,GAGNo1B,KAAM,GAINke,SAAU,CACR/vC,WAAY,WACZX,QAAS7C,EAAM8C,QAAQ,GACvBE,OAAM,aAAAvN,OAAeuK,EAAMjC,QAAQ8+B,KAAK,MACxCn+B,WAAYsB,EAAMjC,QAAQ8+B,KAAK,MAEjCwV,WAAY,CACVzvC,SAAU,UAEZ0sB,MAAO,CACL5wB,WAAYsB,EAAMjC,QAAQC,QAAQC,KAClC8E,MAAO/C,EAAMjC,QAAQC,QAAQikB,aAC7BsT,UAAW,aACX33B,MAAO,OACPF,OAAQ,EACRqD,QAAS,OACT8B,QAAS7C,EAAM8C,QAAQ,IAEzB2yB,YAAa,CACX5yB,QAAS,EACT0yB,UAAW,iBAmDAie,GA9CK,SAAAv5C,GAA4C,IAAzC8K,EAAyC9K,EAAzC8K,KAAM4tC,EAAmC14C,EAAnC04C,KAAMrjB,EAA6Br1B,EAA7Bq1B,MAAO+F,EAAsBp7B,EAAtBo7B,KAAM7vB,EAAgBvL,EAAhBuL,UACxCrE,EAAUrB,KAD8C+D,EAEpCC,mBAASuxB,GAAQ,IAFmBtxB,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAEvD8B,EAFuD5B,EAAA,GAEhD0vC,EAFgD1vC,EAAA,GAG9D,OACE5J,EAAAC,EAAAC,cAACyK,GAAA,EAAD,CACE6wB,OAAO,QACP5wB,KAAMA,EACNC,WAAS,EACTlE,SAAS,KACTmE,QAAS,kBAAM0tC,EAAKhtC,KAEpBxL,EAAAC,EAAAC,cAAC8K,GAAA,EAAD,CAAa7D,UAAWH,EAAQmuB,OAC7BA,GAEHn1B,EAAAC,EAAAC,cAAC+K,GAAA,EAAD,CAAe9D,UAAWH,EAAQkxC,YAChCl4C,EAAAC,EAAAC,cAACiL,GAAA,EAAD,CACEhE,UAAWH,EAAQk0B,KACnB7vB,UAAWA,EACXmW,WAAY,CACVra,UAAWH,EAAQoyC,UAErBhuC,WAAS,EACTP,WAAS,EACT0uC,KAAM,EACN9tC,QAAS,EACTH,SAAU,SAAAnO,GAAC,OAAIm8C,EAASn8C,EAAEoO,OAAOC,QACjCguC,aAActe,KAGlBl7B,EAAAC,EAAAC,cAAC0L,GAAA,EAAD,KACE5L,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQC,QAAS,kBAAM+tC,EAAKtd,KAA5B,UACAl7B,EAAAC,EAAAC,cAAA,OAAKiP,MAAO,CAAElG,SAAU,KACxBjJ,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQC,QAAS,kBAAM+tC,EAAKhtC,KAA5B,SCzDFowB,GACK,YADLA,GAEM,WAGNj2B,GAAYC,aCzBH,SAAAC,GAAK,MAAK,CACvBC,KAAM,GAGNW,MAAO,CACLG,QAAS,OACTC,cAAe,UAGjBw0B,SAAU,CACR92B,WAAYsB,EAAMjC,QAAQC,QAAQC,KAClC8E,MAAO/C,EAAMjC,QAAQC,QAAQikB,cAE/BnR,OAAQ,CACN/P,QAAS,OACTC,cAAe,UAEjB4yC,YAAa,CACXl2C,OAAQsC,EAAM8C,QAAQ,EAAG,IAG3BglC,KAAM,CACJ1kC,SAAU,GAEZ+X,MAAO,CACL/X,SAAU,EACVE,aAAiC,EAAnBtD,EAAM8C,QAAQ,IAE9B0vC,OAAQ,CACN/vB,YAAaziB,EAAM8C,QAAQ,GAC3B85B,aAAc58B,EAAM8C,QAAQ,IAE9B8W,UAAW,CACTi6B,WAAY7zC,EAAM8C,QAAQ,GAC1B8wB,YAAa5zB,EAAM8C,QAAQ,GAC3BlF,MAAO,QAET62B,UAAW,CACT1zB,QAAS,QACTgY,UAAW/Y,EAAM8C,QAAQ,GACzBQ,aAActD,EAAM8C,QAAQ,IAE9BswC,aAAc,CACZryC,QAAS,QACTgY,UAAW/Y,EAAM8C,QAAQ,GACzBQ,aAActD,EAAM8C,QAAQ,IAE9BgxC,aAAc,CACZ1wC,SAAU,EACVlD,OAAQ,QACRS,UAAW,SAEb2xC,WAAY,CACVlvC,SAAU,EACVrC,QAAS,OACTC,cAAe,SACfs0B,cAAkC,EAAnBt1B,EAAM8C,QAAQ,IAE/B69B,YAAa,CACXjjC,OAAQsC,EAAM8C,QAAQ,GACtBjC,SAAU,KAEZkzC,MAAO,CACLhzC,QAAS,OACTy5B,SAAU,WDiFCwZ,GAnHS,SAAA/5C,GAAiC,IAA9BoE,EAA8BpE,EAA9BoE,OAAQ41C,EAAsBh6C,EAAtBg6C,MAAOxuC,EAAexL,EAAfwL,SAClCtE,EAAUrB,KADuC+D,EAEfC,mBAAS,MAFMC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAEhD4yB,EAFgD1yB,EAAA,GAElC2yB,EAFkC3yB,EAAA,GAIjDqiB,EAAW,CAAEO,KAAM,KACpBstB,EAAMnzB,UAAYziB,EAAOiU,OAAO,MAAQ2hC,EAAMlzB,WAAa1iB,EAAOiU,OAAO,MAC5E8T,EAASrF,UAAYkzB,EAAMlzB,WAAa1iB,EAAOiU,OAAO,GACtD8T,EAAStF,SAAWmzB,EAAMnzB,UAAYziB,EAAOiU,OAAO,IAGtD,IAAMxB,EAASmjC,EAAMnjC,QAAUzS,EAAOyS,QAAU,UAEhD,OACE3W,EAAAC,EAAAC,cAAA,WACEF,EAAAC,EAAAC,cAACiL,GAAA,EAAD,CACEQ,MAAM,cACNd,WAAS,EACTa,YAAY,aACZvE,UAAWH,EAAQga,MACnBxV,MAAOsuC,EAAMnhC,MAAQzU,EAAOyU,MAAQ,GACpCrN,SAAU,SAAAnO,GAAC,OAAImO,EAASnS,OAAAuV,EAAA,EAAAvV,CAAA,GAAK2gD,EAAN,CAAanhC,KAAMxb,EAAEoO,OAAOC,YAErDxL,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQmxC,WAAY1tC,QAAS,kBAAM8xB,EAAgBX,MACjE57B,EAAAC,EAAAC,cAACm6B,GAAA,EAAD,CAAWlzB,UAAWH,EAAQiyC,cAA9B,YACAj5C,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQ2yC,cACtB35C,EAAAC,EAAAC,cAAC64C,GAAD,CACElB,WAAS,EACT1wC,UAAWH,EAAQqH,IACnBuK,UAAWkhC,EAAMlhC,WAAa1U,EAAO0U,UACrCqT,SAAUA,MAIhBjsB,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQga,OACtBhhB,EAAAC,EAAAC,cAACm6B,GAAA,EAAD,sBACAr6B,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQ2P,QACtB3W,EAAAC,EAAAC,cAAC65C,GAAA,EAAD,CACE5yC,UAAWH,EAAQyyC,YACnBO,QACEh6C,EAAAC,EAAAC,cAAC+5C,GAAA,EAAD,CACEC,QAAS,CAAC,OAAQ,UAAU99C,QAAQua,IAAW,EAC/CrL,SAAU,SAACnO,GACTmO,EAASnS,OAAAuV,EAAA,EAAAvV,CAAA,GAAK2gD,EAAN,CAAanjC,OAAQxZ,EAAEoO,OAAO2uC,QAAU,SAAW,cAE7D1uC,MAAO,WAGXG,MAAO3L,EAAAC,EAAAC,cAAA,WACLF,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,QAAQsY,UAAU,OAAO/N,GAAOM,OAAOzG,OAC3D3L,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,UAAUqB,MAAM,gBAAgBiX,UAAU,OAAO/N,GAAOM,OAAOJ,gBAIvFhS,EAAAC,EAAAC,cAAC65C,GAAA,EAAD,CACE5yC,UAAWH,EAAQyyC,YACnBnvC,SAAU,CAAC,WAAWlO,QAAQua,IAAW,EACzCqjC,QACEh6C,EAAAC,EAAAC,cAAC+5C,GAAA,EAAD,CACEC,QAAS,CAAC,QAAQ99C,QAAQua,IAAW,EACrCrL,SAAU,SAACnO,GAAD,OAAOmO,EAASnS,OAAAuV,EAAA,EAAAvV,CAAA,GAAK2gD,EAAN,CAAanjC,OAAQxZ,EAAEoO,OAAO2uC,QAAU,OAAS,aAC1E1uC,MAAO,SAGXG,MAAO3L,EAAAC,EAAAC,cAAA,WACLF,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,QAAQsY,UAAU,OAAO/N,GAAOC,KAAKpG,OACzD3L,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,UAAUqB,MAAM,gBAAgBiX,UAAU,OAAO/N,GAAOC,KAAKC,kBAMzFhS,EAAAC,EAAAC,cAAC08B,GAAD,CACEnyB,QAAS,kBAAM8xB,EAAgBX,KAC/Bz0B,UAAWH,EAAQga,MACnBrV,MAAM,cACN3H,KAAM81C,EAAM5vC,MAAQhG,EAAOgG,OAE5BoyB,IAAiBV,IAChB57B,EAAAC,EAAAC,cAACi6C,GAAD,CACEvvC,MAAI,EACJuqB,MAAM,8BACNxO,SAAUmzB,EAAMnzB,UAAYziB,EAAOiU,OAAO,GAC1CyO,UAAWkzB,EAAMlzB,WAAa1iB,EAAOiU,OAAO,GAC5CS,UAAWkhC,EAAMlhC,WAAa1U,EAAO0U,UACrC4/B,KAAM,SAACrqC,GACL7C,EAASnS,OAAAuV,EAAA,EAAAvV,CAAA,GAAK2gD,EAAU3rC,IACxBouB,EAAgB,OAElBkc,SAAU,kBAAMlc,EAAgB,SAGnCD,IAAiBV,IAChB57B,EAAAC,EAAAC,cAACk6C,GAAD,CACExvC,MAAI,EACJuqB,MAAM,cACN+F,KAAM4e,EAAM5vC,MAAQhG,EAAOgG,KAC3BmB,WAAS,EACTmtC,KAAM,SAAC6B,GACL/uC,EAASnS,OAAAuV,EAAA,EAAAvV,CAAA,GAAK2gD,EAAN,CAAa5vC,KAAMmwC,KAC3B9d,EAAgB,OAElBkc,SAAU,kBAAMlc,EAAgB,WEhHpC52B,GAAYC,aCnBH,SAAAC,GAAK,MAAK,CACvBC,KAAM,GAGNW,MAAO,CACLG,QAAS,OACTC,cAAe,UAGjBw0B,SAAU,CACR92B,WAAYsB,EAAMjC,QAAQC,QAAQC,KAClC8E,MAAO/C,EAAMjC,QAAQC,QAAQikB,cAE/B6lB,KAAM,CACJ1kC,SAAU,GAEZ+X,MAAO,CACL/X,SAAU,EACVE,aAActD,EAAM8C,QAAQ,IAE9B0vC,OAAQ,CACN/vB,YAAaziB,EAAM8C,QAAQ,GAC3B85B,aAAc58B,EAAM8C,QAAQ,IAE9B8W,UAAW,CACTi6B,WAAY7zC,EAAM8C,QAAQ,GAC1B8wB,YAAa5zB,EAAM8C,QAAQ,GAC3BlF,MAAO,QAET62B,UAAW,CACT1zB,QAAS,QACTgY,UAAW/Y,EAAM8C,QAAQ,GACzBQ,aAActD,EAAM8C,QAAQ,IAE9BswC,aAAc,CACZryC,QAAS,QACTgY,UAAW/Y,EAAM8C,QAAQ,GACzBQ,aAActD,EAAM8C,QAAQ,IAE9BgxC,aAAc,CACZ1wC,SAAU,GAEZkvC,WAAY,CACVlvC,SAAU,EACVrC,QAAS,OACTC,cAAe,SACfs0B,cAAet1B,EAAM8C,QAAQ,IAE/B69B,YAAa,CACXjjC,OAAQsC,EAAM8C,QAAQ,GACtBjC,SAAU,KAEZkzC,MAAO,CACLhzC,QAAS,OACTy5B,SAAU,WDcCia,GA/CI,SAAAx6C,GAAwB,IAArB04C,EAAqB14C,EAArB04C,KAAMC,EAAe34C,EAAf24C,SACpBzxC,EAAUrB,KACRzB,EAAWiuB,qBAAW+C,IAAtBhxB,OAFiCwF,EAGfC,mBAAS,IAHMC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAGlCowC,EAHkClwC,EAAA,GAG3B2wC,EAH2B3wC,EAAA,GAKzC,OACE5J,EAAAC,EAAAC,cAACyK,GAAA,EAAD,CACE6wB,OAAO,QACPr0B,UAAWH,EAAQlB,KACnB+8B,YAAU,EACVj4B,MAAI,EACJE,QAAS2tC,GAETz4C,EAAAC,EAAAC,cAACkH,GAAA,EAAD,MACApH,EAAAC,EAAAC,cAAC8K,GAAA,EAAD,CAAaywB,mBAAiB,EAACt0B,UAAWH,EAAQq0B,UAChDr7B,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,YAAYqB,MAAM,UAAUzB,UAAWH,EAAQ2mC,MAAnE,wBAIF3tC,EAAAC,EAAAC,cAAC+K,GAAA,EAAD,CAAe9D,UAAWH,EAAQP,OAChCzG,EAAAC,EAAAC,cAACs6C,GAAD,CACEt2C,OAAQA,EACR41C,MAAOA,EACPxuC,SAAUivC,KAGdv6C,EAAAC,EAAAC,cAAC0L,GAAA,EAAD,KACE5L,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQrD,UAAWH,EAAQ8mC,WAAYllC,MAAM,UAAU6B,QAAS,kBAAM8vC,EAAS,KAAKjiB,aAAW,QAA/F,SAGAt4B,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQrD,UAAWH,EAAQ8mC,WAAYllC,MAAM,UAAU6B,QAASguC,EAAUngB,aAAW,QAArF,UAGAt4B,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQrD,UAAWH,EAAQ8mC,WAAYllC,MAAM,UAAU6B,QAAS,kBAAM+tC,EAAKr/C,OAAAuV,EAAA,EAAAvV,CAAA,CAAEQ,GAAIuK,EAAOvK,IAAOmgD,KAAUxhB,aAAW,QAApH,mDE1BF3yB,GAAYC,aC5BH,SAAAC,GAAK,MAAK,CACvBC,KAAM,CAEJC,OAAQ,OACRa,QAAS,OACTC,cAAe,UAEjB4zC,UAAW,CACT10C,OAAQ,QAEV20C,eAAgB,CACdzxC,SAAU,GAEZ4kC,SAAU,CACRnlC,QAAS7C,EAAM8C,QAAQ,EAAG,GAC1B5C,OAAQ,kBAEV4hC,cAAe,CACb1+B,SAAU,EACV1E,WAAYsB,EAAMjC,QAAQ8+B,KAAK,KAC/B95B,MAAO/C,EAAMjC,QAAQs2B,gBAAgBr0B,EAAMjC,QAAQ8+B,KAAK,OAE1DiY,MAAO,CACLz0C,IAAK,EACLE,OAAQ,EACR4C,QAAS,EACT/C,SAAU,WACVW,QAAS,QACT6B,SAAU,SACVhF,MAAO,OACPsC,OAAQ,OACRS,UAAW,KAEbo0C,UAAW,CACTr2C,WAAY,SAEds2C,WAAY,CACVjyC,MAAO,SAETkyC,OAAQ,CACN10C,OAAQ,EACR4C,QAAS,GAEX+xC,KAAM,CACJ/xC,QAAS,EACT5C,OAAQ,GAEV40C,aAAc,GAGdC,WAAY,CACVryC,MAAO,QACPxC,OAAQ,GACRH,SAAU,WACV24B,MAAO/4B,EAAM8C,QAAQ,GACrBkuB,OAAQhxB,EAAM8C,QAAQ,GACtBK,QAAS,IAEXkyC,QAAS,CAEPzhB,YAAa5zB,EAAM8C,QAAQ,GAC3BS,SAAU,GACVrD,OAAQF,EAAM8C,QAAQ,GACtBD,QAAS7C,EAAM8C,QAAQ,KAEzB61B,UAAW,CACTv4B,SAAU,WACVmD,SAAUvD,EAAM8C,QAAQ,GACxB5C,OAAQF,EAAM8C,QAAQ,IAExBi/B,WAAY,CACVh/B,MAAO,QACPxC,OAAQ,GACRH,SAAU,WACV8wB,UAAW,mBACX5wB,KAAM,EACND,IAAK,OAEP2hC,cAAe,CACbj/B,MAAO,QACPxC,OAAQ,GACRH,SAAU,WACV8wB,UAAW,mBACX6H,MAAO,EACP14B,IAAK,UDtDHi1C,GAAY,SAAAr7C,GAAsC,IAAnC24C,EAAmC34C,EAAnC24C,SAAUxlC,EAAyBnT,EAAzBmT,OAAQyzB,EAAiB5mC,EAAjB4mC,WAC/B1/B,EAAUrB,KACVE,EAAQm0B,eAFwCohB,EAG2BC,GAAWpoC,EAAO5W,OAAQqqC,GAAnGmD,EAH8CuR,EAG9CvR,WAAYyR,EAHkCF,EAGlCE,SAAUC,EAHwBH,EAGxBG,cAAev7B,EAHSo7B,EAGTp7B,WAAYw7B,EAHHJ,EAGGI,OAAQC,EAHXL,EAGWK,MAAOC,EAHlBN,EAGkBM,KAHlBhyC,EAIlBC,oBAAS,GAJSC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAI/CiyC,EAJ+C/xC,EAAA,GAInCgyC,EAJmChyC,EAAA,GAMhD+8B,EAAa9hC,iBAAO,MAN4BiiC,EAOlBjJ,GAAiB8I,GAA7C7mB,KAAQ/Z,EAPsC+gC,EAOtC/gC,OAAQtC,EAP8BqjC,EAO9BrjC,MAExB,OACEzD,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,MACtB9F,EAAAC,EAAAC,cAACkH,GAAA,EAAD,MACApH,EAAAC,EAAAC,cAAA,OAAKgH,IAAKy/B,EAAYx/B,UAAWH,EAAQ0zC,gBACtCznC,EAAO5E,IAAI,SAACssC,EAAOxnC,GAAR,OACVnT,EAAAC,EAAAC,cAACwsC,GAAA,EAAD,CACEpyC,IAAG,SAAAgB,OAAW6X,GACdhM,UAAWkoB,KACTroB,EAAQ2zC,MACR9Q,IAAe12B,GAAOnM,EAAQ8zC,OAC9BQ,IAAanoC,GAAOnM,EAAQ+zC,MAE9BtwC,QAAS,kBAAMmxC,GAAeD,IAC9BxsC,MAAO,CACLpJ,SACAtC,QACAijC,WAAY7gC,EAAM+tC,YAAYn3C,OAAO,CAAC,WAAY,CAAEo/C,SAAU,IAAQnV,MAGxE1mC,EAAAC,EAAAC,cAACgpC,GAAD,CAAOjuC,MAAO0/C,EAAOxzC,UAAWH,EAAQ/L,MAAOwrC,SAAUkV,IACzD37C,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWH,EAAQi0C,YAA/B,SACOU,EAAa,MAAQ,OAC1B37C,EAAAC,EAAAC,cAACspC,GAAA,EAAD,CAAO5gC,MAAM,YAAY6gC,aAAcx2B,EAAO42B,GAAYrwC,KAAKO,OAAO,SAAA+/B,GAAG,OAAIA,EAAI3hB,SAAQ9b,QACvF2D,EAAAC,EAAAC,cAACwpC,GAAAzpC,EAAD,CAAW2I,MAAM,cAIrB5I,EAAAC,EAAAC,cAACmpC,GAAA,EAAD,CACEliC,UAAWH,EAAQ6mC,SACnBiO,cAAc,MACd3mB,MACEn1B,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYsB,MAAM,UAAUrB,QAAQ,WAClCvH,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CAAYv0B,UAAWH,EAAQ6zC,WAAYpwC,QAAS,SAACtN,GAAD,OAAOs7C,MACzDz4C,EAAAC,EAAAC,cAACuvC,GAAAxvC,EAAD,OAED1C,aAAWo9C,EAAMl/C,UAGtB6tC,SAAUtpC,EAAAC,EAAAC,cAAA,UAAKs7C,EAAS,SAAW,QACnCjS,WAAYiS,EACVx7C,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CAAYv0B,UAAWH,EAAQ6zC,WAAYpwC,QAAS,SAACtN,GACnDA,EAAEosB,iBACFpsB,EAAEsuB,kBACFiwB,MAEA17C,EAAAC,EAAAC,cAAC67C,GAAA97C,EAAD,OAGFD,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CAAYv0B,UAAWH,EAAQ6zC,WAAYpwC,QAAS,SAACtN,GACnDA,EAAEosB,iBACFpsB,EAAEsuB,kBACFgwB,MAEAz7C,EAAAC,EAAAC,cAAC87C,GAAA/7C,EAAD,YAMVD,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CAAY5b,KAAK,QAAQ3Y,UAAWH,EAAQ4gC,WAAYn9B,QAASuV,EAAYpX,MAAM,WAC5D,QAApB/C,EAAM+S,UAAsB5Y,EAAAC,EAAAC,cAACipC,GAAAlpC,EAAD,MAAyBD,EAAAC,EAAAC,cAACkpC,GAAAnpC,EAAD,OAExDD,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CAAY5b,KAAK,QAAQ3Y,UAAWH,EAAQ6gC,cAAep9B,QAAS8wC,EAAe3yC,MAAM,WAClE,QAApB/C,EAAM+S,UAAsB5Y,EAAAC,EAAAC,cAACkpC,GAAAnpC,EAAD,MAAwBD,EAAAC,EAAAC,cAACipC,GAAAlpC,EAAD,QAIzDD,EAAAC,EAAAC,cAACypC,GAAA,EAAD,CACEC,MAAO32B,EAAO5W,OACd4J,SAAS,SACT4jC,WAAYA,EACZ7iC,QAAS,CACPlB,KAAMkB,EAAQ2gC,cACdiT,UAAW5zC,EAAQ4zC,WAErBqB,WACEj8C,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQ5B,MAAM,UAAUkX,KAAK,QAAQrV,QAAS8wC,EAAejxC,SAAUu/B,IAAe52B,EAAO5W,OAAS,GAAtG,OAEuB,QAApBwJ,EAAM+S,UAAsB5Y,EAAAC,EAAAC,cAACkpC,GAAAnpC,EAAD,MAAwBD,EAAAC,EAAAC,cAACipC,GAAAlpC,EAAD,OAGzDi8C,WACEl8C,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQ5B,MAAM,UAAUkX,KAAK,QAAQrV,QAASuV,EAAY1V,SAAyB,IAAfu/B,GAC7C,QAApBhkC,EAAM+S,UAAsB5Y,EAAAC,EAAAC,cAACipC,GAAAlpC,EAAD,MAAyBD,EAAAC,EAAAC,cAACkpC,GAAAnpC,EAAD,MADxD,YAmBVk7C,GAAU5gB,aAAe,CACvBmM,WAAY,IACZoD,cAAc,EACdC,OAAQ,IAGKoR,UAKTE,GAAa,SAAC78C,EAAK29C,GAAa,IAAAnyC,EACAL,mBAAS,GADTM,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAC7B6/B,EAD6B5/B,EAAA,GACjBmyC,EADiBnyC,EAAA,GAAAuR,EAER7R,oBAAS,GAFD8R,EAAAtiB,OAAA0Q,GAAA,EAAA1Q,CAAAqiB,EAAA,GAE7BggC,EAF6B//B,EAAA,GAErB4gC,EAFqB5gC,EAAA,GAAA6vB,EAGJ3hC,mBAAS,GAHL4hC,EAAApyC,OAAA0Q,GAAA,EAAA1Q,CAAAmyC,EAAA,GAG7BgQ,EAH6B/P,EAAA,GAGnB+Q,EAHmB/Q,EAAA,GAI9B9T,EAAW5yB,mBA+BX03C,EAAc,WAClB9kB,EAASzyB,QAAU0P,OAAO8nC,YAIxB,kBAAMJ,EAAc,SAAAK,GAElB,OADAH,EAAYG,GACJA,EAAU,GAAKj+C,EAAO,EAAIi+C,EAAU,KAE5CN,IAGAO,EAAe,WACfjlB,EAASzyB,SAAS0P,OAAOioC,cAAcllB,EAASzyB,UAUtD,OAPAI,oBAAU,WAER,OADAm3C,IACO,WACLG,MAED,IAEI,CAAE7S,aAAYyR,WAAUC,cApDT,WACpBe,EAAYzS,GACeuS,EAAvBvS,EAAa,GAAKrrC,EAAmB,EACtBqrC,EAAa,GAC3B2R,IACHkB,IACAH,MA8C0Cv8B,WA3C3B,WACjBs8B,EAAYzS,GACYuS,EAApBvS,EAAa,EAAI,EAAiBrrC,EAAM,EACzBqrC,EAAa,GAC3B2R,IACHkB,IACAH,MAqCsDH,gBAAeZ,SAAQC,MAjCnE,WACZiB,IACAL,GAAU,IA+B4EX,KA7B3E,WACXW,GAAU,GACVK,IACAH,4BEvKE52C,GAAYC,aAJJ,SAAAC,GAAK,MAAK,KA4CT+2C,GAtCO,SAAA98C,GAAyC,IAAtCq1B,EAAsCr1B,EAAtCq1B,MAAO1tB,EAA+B3H,EAA/B2H,QAASwiC,EAAsBnqC,EAAtBmqC,UAAWr/B,EAAW9K,EAAX8K,KAC5C5D,EAAUrB,KAChB,OACE3F,EAAAC,EAAAC,cAACyK,GAAA,EAAD,CACExD,UAAWH,EAAQlB,KACnBokC,sBAAoB,EACpBr/B,WAAS,EACTD,KAAMA,EACNu/B,sBAAoB,EACpBxjC,SAAS,KACToE,kBAAgB,6BAEhB/K,EAAAC,EAAAC,cAAC8K,GAAA,EAAD,CAAarR,GAAG,6BAA6Bw7B,GAC7Cn1B,EAAAC,EAAAC,cAAC+K,GAAA,EAAD,KACEjL,EAAAC,EAAAC,cAACoH,GAAA,EAAD,KACGG,IAILzH,EAAAC,EAAAC,cAAC0L,GAAA,EAAD,KACE5L,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQC,QAAS,kBAAMw/B,GAAU,IAAQrhC,MAAM,WAA/C,MAGA5I,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQC,QAAS,kBAAMw/B,GAAU,IAAOrhC,MAAM,aAA9C,UCzCOi0C,GAAA,SAAAh3C,GAAK,MAAK,CACvBC,KAAM,CACJrC,MAAO,QAETu3C,aAAc,GAEdxU,YAAa,GAGbsW,cAAe,CACbh2C,UAAW,SAEbm5B,iBAAkB,CAChBv3B,QAAS7C,EAAM8C,QAAQ,EAAG,IAE5Bu3B,YAAa,CACX92B,SAAU,IAEZsC,YAAa,CACXzF,SAAU,WACVE,KAAM,EACNiD,SAAU,IAEZ+2B,MAAO,CACLv5B,QAAS,OACT8B,QAAS,GAEX03B,eAAgB,CACdx5B,QAAS,OACTy5B,SAAU,OACV/5B,KAAM,EACNg6B,WAAY,SACZ73B,SAAU,UAEZpF,MAAO,CACL4C,SAAU,WACVG,OAAQ,EACRwY,UAAW/Y,EAAM8C,QAAQ,GACzBxC,KAAM,EACNy4B,MAAO,KC9BLj5B,GAAYC,aAAWuJ,IA+Bd4tC,GA3BI,SAAAj9C,GAA2C,IAAxCtG,EAAwCsG,EAAxCtG,KAAagnC,GAA2B1gC,EAAlC6L,MAAkC7L,EAA3B0gC,WAAWr5B,EAAgBrH,EAAhBqH,UACtCH,EAAUrB,KAEVq3C,EAAYxjD,EAAKO,OAAO,SAAA+/B,GAAG,OAAIA,EAAIxgC,SAAWknC,EAAU7mC,KAAOmgC,EAAI3hB,SAEzE,OACEnY,EAAAC,EAAAC,cAAA,OAAKiH,UAAWkoB,KAAWroB,EAAQlB,KAAMqB,IACvCnH,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,WAAWJ,UAAWH,EAAQi2C,YAC/Czc,EAAU70B,OAEb3L,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQg0C,cACrBgC,EAAU3uC,IAAI,SAACyrB,EAAK3mB,GAAN,OACbnT,EAAAC,EAAAC,cAACk9B,GAAD,CAAStD,IAAKA,EAAKx/B,IAAG,UAAAgB,OAAY6X,GAAOvK,MAAO43B,EAAU53B,aCA9DjD,GAAYC,aAfJ,SAAAC,GAAK,MAAK,CACtBC,KAAM,GAENo3C,SAAU,GAEV1W,YAAa,CACX/iC,MAAO,QAET05C,SAAU,CACR9zC,WAAY,YAEdyzC,cAAe,CACbh2C,UAAW,YAsCAs2C,GAjCK,SAAAt9C,GAMd,IALJ6L,EAKI7L,EALJ6L,MACAH,EAII1L,EAJJ0L,MACA6xC,EAGIv9C,EAHJu9C,KACA/xC,EAEIxL,EAFJwL,SACAnE,EACIrH,EADJqH,UAEMH,EAAUrB,KAChB,OACE3F,EAAAC,EAAAC,cAAA,OAAKiH,UAAWkoB,KAAWroB,EAAQlB,KAAMqB,IACvCnH,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,WAAWJ,UAAWH,EAAQi2C,YAC/CtxC,GAEH3L,EAAAC,EAAAC,cAACiL,GAAA,EAAD,CACE5Q,KAAK,iBACLsQ,WAAS,EACTW,MAAO/N,aAAsB+N,GAC7BrE,UAAWH,EAAQyY,UACnBnU,SAAU,SAACnO,GAAD,OAAOmO,EAAS5N,aAAsBP,EAAEoO,OAAOC,WAE1D6xC,GAAQr9C,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,UAAUJ,UAAWH,EAAQq2C,MAAOA,KCjCjE13C,GAAYC,aAAWuJ,IAsJd4tC,GAjJI,SAAAj9C,GAGb,IAFJtG,EAEIsG,EAFJtG,KAAM8R,EAEFxL,EAFEwL,SACN+xC,EACIv9C,EADJu9C,KAAM7c,EACF1gC,EADE0gC,UAAWr5B,EACbrH,EADaqH,UAEXH,EAAUrB,KAEV23C,EAAiB,SAACC,EAADrvC,GAAkD,IAAnCkf,EAAmClf,EAAnCkf,OAAQowB,EAA2BtvC,EAA3BsvC,aAAcC,EAAavvC,EAAbuvC,OAE1D,OAAQrwB,GACN,IAAK,QACH9hB,EAAS,IACT,MACF,IAAK,eAEHA,EAAS9R,EAAKO,OAAO,SAAAivC,GAAG,OAAIA,EAAIrvC,KAAO6jD,EAAahyC,SACpD,MACF,IAAK,gBACH,IAAMkyC,EAAMvkD,OAAAuV,EAAA,EAAAvV,CAAA,GACPqnC,EAAUrD,OAAO1jC,KAAK,SAAAkkD,GAAG,OAAIA,EAAIhkD,KAAO8jD,EAAOjyC,QADxC,CAEVlS,OAAQknC,EAAU7mC,KAEpB2R,EAAQ,GAAAhQ,OAAAnC,OAAAia,GAAA,EAAAja,CAAKK,GAAL,CAAWkkD,KACnB,MACF,IAAK,gBACH,IACME,EAAe,CACnBjyC,MAFe4xC,EAAW9jD,KAAK,SAAAokD,GAAC,OAAIA,EAAEvZ,YAAW94B,MAGjDlS,OAAQknC,EAAU7mC,IAEpB2R,EAAQ,GAAAhQ,OAAAnC,OAAAia,GAAA,EAAAja,CAAKK,GAAL,CAAWokD,OAsCnBZ,EAAYxjD,EAAKO,OAAO,SAAA+/B,GAAG,OAAIA,EAAIxgC,SAAWknC,EAAU7mC,KAAOmgC,EAAI3hB,SAEnE2lC,EAAgBd,EAAU3uC,IAAI,SAAA26B,GAAG,MAAK,CAAEr9B,MAAOq9B,EAAIr9B,MAAOH,MAAOw9B,EAAIrvC,MAIrEokD,EAAgBvd,EAAUrD,OAC7BpjC,OAAO,SAAAivC,GAAG,OAAkD,IAA9CgU,EAAU3uC,IAAI,SAAAomB,GAAC,OAAIA,EAAE96B,KAAIyC,QAAQ4sC,EAAIrvC,MACnD0U,IAAI,SAAA26B,GAAG,MAAK,CAAEr9B,MAAOq9B,EAAIr9B,MAAOH,MAAOw9B,EAAIrvC,MAI9C,OACEqG,EAAAC,EAAAC,cAAA,OAAKiH,UAAWkoB,KAAWroB,EAAQlB,KAAMqB,IACvCnH,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,WAAWJ,UAAWH,EAAQi2C,YAC/Czc,EAAU70B,QAEX60B,EAAUE,gBACV1gC,EAAAC,EAAAC,cAACygC,GAAA,EAAD,CACE/O,QAASmsB,EACT/2C,QAASA,EACTg7B,WAAS,EACTpB,WAAY,CACVC,WACAC,QAEAC,oBACAC,UACAC,eAEAC,mBAEF8c,eAAa,EACbxyC,MAAOsyC,EACP1c,aAAa,EACb91B,SAAUgyC,EACV5xC,YAAY,cACZuyC,SAAO,EACP5c,cAAY,IAGdb,EAAUE,gBACV1gC,EAAAC,EAAAC,cAACohC,GAAArhC,EAAD,CACE2xB,QAASmsB,EACT/2C,QAASA,EACTg7B,WAAS,EACTgc,eAAa,EACbpd,WAAY,CACVC,WACAC,QAEAC,oBACAC,UACAC,eAEAC,mBAEF11B,MAAOsyC,EACP1c,aAAa,EACb91B,SAAUgyC,EACV5xC,YAAY,cACZuyC,SAAO,EACP5c,cAAY,IAGfgc,GAAQr9C,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,UAAUJ,UAAWH,EAAQq2C,MAAOA,KAevE,SAASxc,GAASj5B,GAEhB,OACE5H,EAAAC,EAAAC,cAACiL,GAAA,EAADhS,OAAAyV,OAAA,CACE/D,WAAS,EACT02B,WAAY,CACVC,kBACAhgB,WAAY,CACVra,UAAWS,EAAM65B,YAAYz6B,QAAQm5B,MACrCuB,SAAU95B,EAAM+5B,SAChB5hC,SAAU6H,EAAM7H,SAEhBk4B,YAAa,SAAC96B,GACZyK,EAAMg6B,WAAW3J,YAAY96B,IAE/B+gD,WAAY,SAAC/gD,GACXyK,EAAMg6B,WAAWsc,WAAW/gD,OAM9ByK,EAAM65B,YAAYI,iBAK5B,IAAMd,GAAmB,SAAAgB,GAAA,IAAGH,EAAHG,EAAGH,WAAYH,EAAfM,EAAeN,YAAa1hC,EAA5BgiC,EAA4BhiC,SAA5B,OACvBC,EAAAC,EAAAC,cAACoH,GAAA,EAADnO,OAAAyV,OAAA,CACEhG,MAAM,gBACNzB,UAAWs6B,EAAYz6B,QAAQi5B,kBAC3B2B,GAEH7hC,IAIC+gC,GAAO,SAAAuB,GAAA,IAAGZ,EAAHY,EAAGZ,YAAaG,EAAhBS,EAAgBT,WAAY7hC,EAA5BsiC,EAA4BtiC,SAA5B,OACXC,EAAAC,EAAAC,cAAC4oB,GAAA,EAAD3vB,OAAAyV,OAAA,CAAOkzB,QAAM,EAAC36B,UAAWs6B,EAAYz6B,QAAQ3D,OAAWu+B,GACrD7hC,IAKCyhC,GAAiB,SAAA2c,GAAA,IAAGzc,EAAHyc,EAAGzc,SAAa95B,EAAhBzO,OAAAqV,EAAA,EAAArV,CAAAglD,EAAA,qBAA4Bn+C,EAAAC,EAAAC,cAAA,MAAA/G,OAAAyV,OAAA,CAAK1H,IAAKw6B,GAAc95B,KAErEq5B,GAAc,SAACr5B,GAAD,OAClB5H,EAAAC,EAAAC,cAACoH,GAAA,EAADnO,OAAAyV,OAAA,CACEhG,MAAM,gBACNzB,UAAWS,EAAM65B,YAAYz6B,QAAQ0E,aACjC9D,EAAMg6B,YAETh6B,EAAM7H,WAILihC,GAAS,SAAAod,GAAA,IAAGzc,EAAHyc,EAAGzc,SAAUK,EAAboc,EAAapc,UAAWC,EAAxBmc,EAAwBnc,WAAYL,EAApCwc,EAAoCxc,WAAY7hC,EAAhDq+C,EAAgDr+C,SAAhD,OACbC,EAAAC,EAAAC,cAACk5B,GAAA,EAADjgC,OAAAyV,OAAA,CACEszB,UAAWP,EACXQ,SAAUH,EACVniB,UAAU,MACV1Q,MAAO,CAAEizB,WAAYH,EAAa,IAAM,MACpCL,GAEH7hC,IAICmhC,GAAiB,SAAAmd,GAAA,IAAG5c,EAAH4c,EAAG5c,YAAa1hC,EAAhBs+C,EAAgBt+C,SAAhB,OACrBC,EAAAC,EAAAC,cAAA,OAAKiH,UAAWs6B,EAAYz6B,QAAQo5B,gBAAiBrgC,ICpMjD4F,GAAYC,aAvBJ,SAAAC,GAAK,MAAK,CACtBC,KAAM,GAENoyC,WAAY,CAGV7K,UAAW,oBACXlS,cAAe,KAGjBhG,MAAO,CACL1xB,MAAO,OACPF,OAAQ,EACRqD,QAAS,OACT8B,QAAS7C,EAAM8C,QAAQ,IAEzB0yB,SAAU,CACRpyB,SAAU,GAEZqyB,YAAa,CACX1yB,MAAO/C,EAAMjC,QAAQ8+B,KAAK,SAiDf4b,GA5CC,SAAAx+C,GAAsD,IAAnD8K,EAAmD9K,EAAnD8K,KAAMuqB,EAA6Cr1B,EAA7Cq1B,MAAOqjB,EAAsC14C,EAAtC04C,KAAMC,EAAgC34C,EAAhC24C,SAAUj/C,EAAsBsG,EAAtBtG,KAAMgnC,EAAgB1gC,EAAhB0gC,UAC9Cx5B,EAAUrB,KADoD+D,EAE1CC,mBAASnQ,GAFiCoQ,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAE7D8B,EAF6D5B,EAAA,GAEtD0vC,EAFsD1vC,EAAA,GAGpE,OACE5J,EAAAC,EAAAC,cAACyK,GAAA,EAAD,CACExD,UAAWH,EAAQlB,KACnB01B,OAAO,OACPqH,YAAU,EACVj4B,KAAMA,EACNE,QAAS,kBAAM0tC,EAAKhtC,KAEpBxL,EAAAC,EAAAC,cAAC8K,GAAA,EAAD,CAAa7D,UAAWH,EAAQmuB,MAAOsG,mBAAiB,GACtDz7B,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWH,EAAQq0B,UAAWlG,GAC1Cn1B,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CAAYv0B,UAAWH,EAAQs0B,YAAa7wB,QAASguC,GACnDz4C,EAAAC,EAAAC,cAACy7B,GAAA17B,EAAD,QAGJD,EAAAC,EAAAC,cAAC+K,GAAA,EAAD,CAAe9D,UAAWH,EAAQkxC,YAChCl4C,EAAAC,EAAAC,cAACq+C,GAAD,CACEp3C,UAAWH,EAAQga,MACnBxnB,KAAMgS,EACNg1B,UAAWA,EACXl1B,SAAUguC,KAGdt5C,EAAAC,EAAAC,cAAC0L,GAAA,EAAD,KACE5L,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQC,QAASguC,GAAjB,UACAz4C,EAAAC,EAAAC,cAAA,OAAKiP,MAAO,CAAElG,SAAU,KACxBjJ,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQC,QAAS,kBAAM6uC,EAAS9/C,KAAhC,SACAwG,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQC,QAAS,kBAAM+tC,EAAKhtC,KAA5B,SClDF7F,GAAYC,aAbJ,SAAAC,GAAK,MAAK,CACtBC,KAAM,GACNo3C,SAAU,GACV1W,YAAa,CACX/iC,MAAO,QAET05C,SAAU,CACR9zC,WAAY,YAEdyzC,cAAe,CACbh2C,UAAW,YA2BA03C,GAtBE,SAAA1+C,GAIX,IAHJ6L,EAGI7L,EAHJ6L,MACAH,EAEI1L,EAFJ0L,MACArE,EACIrH,EADJqH,UAEMH,EAAUrB,KAChB,OACE3F,EAAAC,EAAAC,cAAA,OAAKiH,UAAWkoB,KAAWroB,EAAQlB,KAAMqB,IACvCnH,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,WAAWJ,UAAWH,EAAQi2C,YAC/CtxC,GAEH3L,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,QAAQJ,UAAWH,EAAQq2C,MAAO7xC,EAAQjO,aAAWiO,GAAS,MCYlF7F,GAAYC,aAtBJ,SAAAC,GAAK,MAAK,CACtBC,KAAM,CACJC,OAAQ,MACRtC,MAAO,OAETg7C,kBAAmB,CACjB73C,QAAS,OACT8B,QAAS,GAEXg2C,YAAa,CACX9/B,UAAW/Y,EAAM8C,QAAQ,IAE3B0yB,SAAU,CACRpyB,SAAU,EACV01C,WAAY94C,EAAM8C,QAAQ,GAC1BwyB,cAAet1B,EAAM8C,QAAQ,GAC7B2f,YAAaziB,EAAM8C,QAAQ,IAE7BqY,MAAO,CACL7X,aAActD,EAAM8C,QAAQ,OAK1BizB,GACM,WADNA,GAEM,WAFNA,GAIK,MAsIIgjB,GAlIG,SAAA9+C,GAAyC,IAAtC++C,EAAsC/+C,EAAtC++C,QAAS5jD,EAA6B6E,EAA7B7E,MAAO6+C,EAAsBh6C,EAAtBg6C,MAAOxuC,EAAexL,EAAfwL,SACpCtE,EAAUrB,KACR3M,EAAiBm5B,qBAAW+C,IAA5Bl8B,aAFiD0Q,EAGQC,mBAAS,IAHjBC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAAA6Y,EAAA3Y,EAAA,GAGhD0yB,EAHgD/Z,EAGhD+Z,aAAcwiB,EAHkCv8B,EAGlCu8B,oBAAuBviB,EAHW3yB,EAAA,GAKnDm1C,EAAU,IAAIC,GAAShmD,EAAc8gD,EAAMtgD,MAAQyB,EAAMzB,MAE3DmjC,EAAW,GACf,IACEA,EAAW1hC,EAAMZ,KAAOlB,OAAOiB,KAAKe,KAAKyB,MAAM3B,EAAMZ,OAAS,GAEhE,MAAO8C,GACLrB,QAAQsB,MAAMD,GAEhB,OACE6C,EAAAC,EAAAC,cAAA,WACGjF,EAAM4c,aACL7X,EAAAC,EAAAC,cAACF,EAAAC,EAAMwF,SAAP,KACEzF,EAAAC,EAAAC,cAAC68B,GAAD,CACE5nB,KAAMla,EAAM4c,YACZ+iB,cAAe,kBAAM5hC,EAAa4hC,cAAc3/B,EAAM4c,YAAY1B,WAClEpS,UAAU,wBAEZ/D,EAAAC,EAAAC,cAACi5B,GAAA,EAAD,OAGH0lB,EACC7+C,EAAAC,EAAAC,cAAC++C,GAAD,CACE93C,UAAWH,EAAQga,MACnBrV,MAAM,iBACNH,MAAOsuC,EAAMr+C,SAAWR,EAAMQ,QAC9B6P,SAAU,SAAA7P,GAAO,OAAI6P,EAAS,CAAE7P,aAChCojD,QAASA,IAIT7+C,EAAAC,EAAAC,cAACg/C,GAAD,CACEvzC,MAAM,iBACNH,MAAOsuC,EAAMr+C,SAAWR,EAAMQ,WAIlCojD,GAAW5jD,EAAMiP,OACjBlK,EAAAC,EAAAC,cAAC08B,GAAD,CACEjxB,MAAM,aACN3H,KAAM81C,EAAM5vC,MAAQjP,EAAMiP,KAC1BO,QAAS,WACM8xB,EAATsiB,EAAyB,CAAEviB,aAAcV,IACxB,CAAEU,aAAcV,QAI3C57B,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,YAAYJ,UAAWH,EAAQ03C,aAAnD,iBACA1+C,EAAAC,EAAAC,cAACi5B,GAAA,EAAD,MACC4lB,EAAQ/lD,aAAaiB,mBAAmBoU,IAAI,SAAC3U,EAAIyZ,GAAL,OAC3CnT,EAAAC,EAAAC,cAAA,OACE5F,IAAG,WAAAgB,OAAa6X,GAChB1I,QAAS,kBAAMo0C,EAAUtiB,EAAgB,CAAED,aAAcV,GAAiBkjB,oBAAqBplD,IAAQ,OAEvGsG,EAAAC,EAAAC,cAACi/C,GAAD,CACEh4C,UAAWH,EAAQga,MACnBrV,MAAOjS,EAAGiS,MACVnS,KAAMsgD,EAAMtgD,MAAQyB,EAAMzB,KAC1BgnC,UAAW9mC,OAKhBijC,EAAStgC,OAAS,GAAKlD,OAAOiB,KAAKpB,EAAaqB,MAAMgC,OAAS,GAC9D2D,EAAAC,EAAAC,cAACF,EAAAC,EAAMwF,SAAP,KACEzF,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWH,EAAQ0f,SAA/B,YACA1mB,EAAAC,EAAAC,cAACi5B,GAAA,EAAD,MACAn5B,EAAAC,EAAAC,cAAC28B,GAAA,EAAD,CAAM11B,UAAWH,EAAQ80B,MACtBa,EAAStuB,IAAI,SAAC/T,EAAK6Y,GAAN,OAAcna,EAAaqB,KAAKC,GAC5C0F,EAAAC,EAAAC,cAAC26B,GAAA,EAAD,CAAUvgC,IAAG,WAAAgB,OAAa6X,IACxBnT,EAAAC,EAAAC,cAACo5B,GAAA,EAAD,CACEz1B,QAAS7K,EAAaqB,KAAKC,GAAKqR,MAChC5H,UAAW/K,EAAaqB,KAAKC,GAAK+iC,OAAOpiC,EAAMZ,KAAKC,OAGtD,SAKTgiC,GAAgBA,IAAiBV,IAChC57B,EAAAC,EAAAC,cAACk6C,GAAD,CACExvC,MAAI,EACJS,WAAS,EACTmtC,KAAM,SAAAtuC,GACJoB,EAAS,CAAEpB,SACXqyB,EAAgB,KAElBpH,MAAM,kBACN+F,KAAM4e,EAAM5vC,MAAQjP,EAAMiP,OAG7BoyB,GAAgBA,IAAiBV,IAChC57B,EAAAC,EAAAC,cAACo9B,GAAD,CACE1yB,MAAI,EACJS,WAAS,EACTP,QAAS,kBAAMyxB,EAAgB,KAC/BpH,MAAM,aACN+F,KAAM4e,EAAM5vC,MAAQjP,EAAMiP,OAG7BoyB,GAAgBA,IAAiBV,IAChC57B,EAAAC,EAAAC,cAACk/C,GAAD,CACEx0C,MAAI,EACJuqB,MAAK,cAAA75B,OAAgBwjD,EAAoBnzC,OACzC6sC,KAAM,SAAAh/C,GACJ+iC,EAAgB,IAChBjxB,EAAS,CAAE9R,UAEbi/C,SAAU,kBAAMlc,EAAgB,KAChC/iC,KAAMsgD,EAAMtgD,MAAQyB,EAAMzB,KAC1BgnC,UAAWse,MCtIfn5C,GAAYC,aAnBJ,SAAAC,GAAK,MAAK,CACtBC,KAAM,CACJC,OAAQ,MACRtC,MAAO,OAETg7C,kBAAmB,CACjB73C,QAAS,OACT8B,QAAS,GAEX2yB,SAAU,CACRpyB,SAAU,EACV01C,WAAY94C,EAAM8C,QAAQ,GAC1BwyB,cAAet1B,EAAM8C,QAAQ,GAC7B2f,YAAaziB,EAAM8C,QAAQ,IAE7BqY,MAAO,CACL7X,aAActD,EAAM8C,QAAQ,OAK1BizB,GAKI,SAqFKgjB,GAlFG,SAAA9+C,GAA8C,IAA3C++C,EAA2C/+C,EAA3C++C,QAAS5jD,EAAkC6E,EAAlC7E,MAAOw9C,EAA2B34C,EAA3B24C,SAAUD,EAAiB14C,EAAjB04C,KAAM5tC,EAAW9K,EAAX8K,KAC7C5D,EAAUrB,KAD8C+D,EAEtBC,mBAAS,MAFaC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAEvD4yB,EAFuD1yB,EAAA,GAEzC2yB,EAFyC3yB,EAAA,GAAAI,EAGpCL,mBAAS,IAH2BM,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAGvD8vC,EAHuD7vC,EAAA,GAGhDswC,EAHgDtwC,EAAA,GAKxDo1C,EAAQvF,GAAS3gD,OAAOiB,KAAK0/C,GAAOz9C,OAAS,EAEnD,OACE2D,EAAAC,EAAAC,cAACyK,GAAA,EAAD,CACEk4B,YAAU,EACV/3B,QAAS,WACHu0C,EAAO9iB,EAAgBX,IACtB6c,KAEP1tC,kBAAgB,0BAChBH,KAAMA,GAEN5K,EAAAC,EAAAC,cAAC8K,GAAA,EAAD,CAAaywB,mBAAiB,EAACt0B,UAAWH,EAAQy3C,mBAChDz+C,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,KAAKJ,UAAWH,EAAQq0B,UAA5C,oBAGAr7B,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CAAYjxB,QAASguC,GACnBz4C,EAAAC,EAAAC,cAACy7B,GAAA17B,EAAD,QAGJD,EAAAC,EAAAC,cAAC+K,GAAA,EAAD,KACEjL,EAAAC,EAAAC,cAACo/C,GAAD,CACErkD,MAAOA,EACP6+C,MAAOA,EACPxuC,SAAU,SAAAi0C,GAAQ,OAAIhF,EAASphD,OAAAuV,EAAA,EAAAvV,CAAA,GAAK2gD,EAAUyF,KAC9CV,QAASA,KAIb7+C,EAAAC,EAAAC,cAAC0L,GAAA,EAAD,MACIizC,GACA7+C,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQC,QAASguC,EAAU7vC,MAAM,WAAjC,MAIDi2C,IAAYQ,GACXr/C,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQC,QAASguC,EAAU7vC,MAAM,WAAjC,QAIDi2C,GAAWQ,GACVr/C,EAAAC,EAAAC,cAACF,EAAAC,EAAMwF,SAAP,KACEzF,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQC,QAAS,kBAAM8xB,EAAgBX,KAAiBhzB,MAAM,WAA9D,UAGA5I,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQC,QAAS,kBAAM8vC,EAAS,KAAK3xC,MAAM,WAA3C,SAGA5I,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQC,QAAS,kBAAM+tC,EAAKsB,IAAQlxC,MAAM,WAA1C,QAML0zB,GAAgBA,IAAiBV,IAChC57B,EAAAC,EAAAC,cAACs/C,GAAD,CACE50C,MAAI,EACJuqB,MAAM,wBACN1tB,QAAQ,kDACRwiC,UAAW,SAAAplB,GACT0X,EAAgB,MACZ1X,GAAS4zB,SCpFnB9yC,GAAYC,aC7BH,SAAAC,GAAK,MAAK,CACvBC,KAAM,CACJc,QAAS,OACTb,OAAQ,OACRc,cAAe,SACf4B,SAAU,UAEZ2kC,OAAQ,CACNnkC,SAAU,GAEZw2C,WAAY,CACV72C,MAAO/C,EAAMjC,QAAQG,UAAU+jB,aAC/BvjB,WAAYsB,EAAMjC,QAAQG,UAAUD,MAEtC6pC,KAAM,CACJ1kC,SAAU,GAEZu+B,aAAc,CACZzhC,OAAQ,QAEVU,MAAO,CACLH,KAAM,MACNL,SAAU,YAEZsnC,QAAS,CACP3uB,UAAW/Y,EAAM8C,QAAQ,IAE3B+2C,QAAS,CACPz5C,SAAU,WACVG,OAAQ,GACRywB,OAAQ,GACR1wB,KAAM,MACN6C,QAAS,GACT+tB,UAAW,oBAEb4Q,cAAe,CACbpjC,WAAY,QAEdyjC,KAAM,CACJzkC,OAAQ,UAEV2zC,IAAK,CACHruC,OAAQ,uBAEV+xC,UAAW,CACTr2C,WAAYsB,EAAMjC,QAAQG,UAAUD,MAmBtC67C,aAAc,CACZ/2C,MAAO/C,EAAMjC,QAAQC,QAAQC,KAC7BkF,QAAS,MDnCP42C,GACK,EADLA,GAEM,EAFNA,GAGM,EAHNA,GAIM,EAJNA,GAKS,EA6LAC,GA1LO,SAAA//C,GAAkE,IAA/DmT,EAA+DnT,EAA/DmT,OAAQ6sC,EAAuDhgD,EAAvDggD,YAAarR,EAA0C3uC,EAA1C2uC,WAAYsR,EAA8BjgD,EAA9BigD,cAAe1kD,EAAeyE,EAAfzE,SACjE2L,EAAUrB,KACVE,EAAQm0B,eAFwEmC,EAGjDhK,qBAAW+C,IAAxChxB,EAH8Ei4B,EAG9Ej4B,OAAQlL,EAHsEmjC,EAGtEnjC,aAAc0yC,EAHwDvP,EAGxDuP,GACxBjD,EAAYtvC,OAAAia,GAAA,EAAAja,CAAO8Z,GACzBw1B,EAAaC,KAAK,SAACzoC,EAAG0oC,GAAJ,OAAUjE,SAASiE,EAAEltC,QAAS,IAAMipC,SAASzkC,EAAExE,QAAS,MALY,IAAAiO,EAMhDC,mBAASm2C,EAAcrX,EAAa5uC,UAAU,SAAAuuC,GAAC,OAAIA,EAAEzuC,KAAOmmD,IAAe,GAN3Bl2C,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAM/E2+B,EAN+Ez+B,EAAA,GAMlE0+B,EANkE1+B,EAAA,GAShF3O,EAAQgY,EAAOo1B,GATiEr+B,EAU5DL,mBAAStO,EAAWJ,EAAQ,IAVgCgP,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAU/E8vC,EAV+E7vC,EAAA,GAUxEswC,EAVwEtwC,EAAA,GAAAuR,EAW9D7R,mBAAS,CAC/B3E,QAAS3J,EAAWukD,GAAqBA,GACzC7E,KAAM,OAb8Et/B,EAAAtiB,OAAA0Q,GAAA,EAAA1Q,CAAAqiB,EAAA,GAW/E+Q,EAX+E9Q,EAAA,GAWzEukC,EAXyEvkC,EAAA,GAgBhFwkC,EAAY,IAAIhd,GAAKjqC,EAAc8gD,EAAMtgD,MAAQyB,EAAMzB,MAEvD0mD,EAAa,SAACC,GAClBH,EAAQ,CAAEh7C,QAASm7C,EAASpF,KAAMxuB,EAAKvnB,WAGnCo7C,EAAe,WACnBF,EAAWN,IACXG,EAAc9kD,EAAD9B,OAAAuV,EAAA,EAAAvV,CAAA,CAAUQ,GAAIsB,EAAMtB,IAAOmgD,KAqBpC1K,EAAM,CACVphC,OAAQ09B,EAAGe,QAAQ,SAAUvoC,EAAQ,WAC7BwnC,EAAGe,QAAQ,SAAUxxC,EAAO,UAGtC,OACE+E,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,MACtB9F,EAAAC,EAAAC,cAACkH,GAAA,EAAD,MADF,IAEEpH,EAAAC,EAAAC,cAACsvC,GAAA,EAAD,CAAQvpC,SAAS,SAASkB,UAAWkoB,KAAWroB,EAAQomC,OAAQ7gB,EAAKvnB,UAAY46C,GAAiB54C,EAAQy4C,WAAa,OACrHz/C,EAAAC,EAAAC,cAACyf,GAAA,EAAD,CAASC,gBAAc,GACpB2M,EAAKvnB,UAAY46C,IAChB5/C,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CACEv0B,UAAWH,EAAQ8mC,WACnBllC,MAAM,UACN0vB,aAAW,OACX7tB,QAAS,kBAAMgkC,MAEfzuC,EAAAC,EAAAC,cAACuvC,GAAAxvC,EAAD,OAGJD,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQ2mC,MACtB3tC,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,YAAYqB,MAAM,WACnCvN,EAAW,WAAH,eAAAC,OAA+B+sC,EAAc,EAA7C,KAAA/sC,OAAkD2X,EAAO5W,OAAzD,MAEX2D,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,YAAYqB,MAAM,WACnCrL,aAAWtC,EAAMQ,QAAS,SAI7B8wB,EAAKvnB,UAAY46C,IACnB5/C,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQ5B,MAAM,UAAU6B,QA3CR,WACtBy1C,EAAWN,IACXrF,EAASt/C,KAyCH,UAKEsxB,EAAKvnB,UAAY46C,IACnB5/C,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQ5B,MAAM,UAAU6B,QAAS21C,GAAjC,QAIE7zB,EAAKvnB,UAAY46C,IACnB5/C,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQ5B,MAAM,UAAU6B,QA3DN,WACxBs1C,EAAc9kD,EAAD9B,OAAAuV,EAAA,EAAAvV,CAAA,CAAUQ,GAAIsB,EAAMtB,IAAOmgD,IACxCrL,MAyDM,QAKEW,EAAIphC,QAAUue,EAAKvnB,UAAY46C,IACjC5/C,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQ5B,MAAM,UAAU6B,QAAS,kBAAMy1C,EAAWN,MAAlD,QAKGrzB,EAAKvnB,UAAY46C,IAAmBrzB,EAAKvnB,UAAY46C,IACxD5/C,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CAAY9yB,MAAM,UAChBzB,UAAWkoB,KAAWroB,EAAQ8gC,UAAWvb,EAAKvnB,UAAY46C,IAAmB54C,EAAQ24C,cACrFl1C,QAAS,kBAAMy1C,EAAW3zB,EAAKvnB,UAAY46C,GAAkBA,GAAiBA,MAE9E5/C,EAAAC,EAAAC,cAACspC,GAAA,EAAD,CAAOriC,UAAWH,EAAQzD,OAAQkmC,aAAcwW,EAAU7c,YAAY/mC,OAAQuM,MAAM,WAClF5I,EAAAC,EAAAC,cAACwpC,GAAAzpC,EAAD,CAAW2I,MAAM,cAKlB2jB,EAAKvnB,UAAY46C,IAAmBrzB,EAAKvnB,UAAY46C,IACxD5/C,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CAAY9yB,MAAM,UAChBzB,UAAWkoB,KAAWroB,EAAQq5C,WAAY9zB,EAAKvnB,UAAY46C,IAAmB54C,EAAQ24C,cACtFl1C,QAAS,kBAAMy1C,EAAW3zB,EAAKvnB,UAAY46C,GAAkBA,GAAiBA,MAE9E5/C,EAAAC,EAAAC,cAACogD,GAAArgD,EAAD,SAMND,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQP,MAAOgE,QAlFhB,SAACtN,GACdovB,EAAKvnB,UAAY46C,KACnBziD,EAAEosB,iBACFpsB,EAAEsuB,kBACFy0B,EAAWN,OA+ET5/C,EAAAC,EAAAC,cAAC0oC,GAAA3oC,EAAD,CACE4oC,KAA0B,QAApBhjC,EAAM+S,UAAsB,YAAc,IAChDkwB,MAAOT,EACPkY,eAAgB,CAAEx6C,OAAQ,QAC1BoJ,MAAO,CAAEpJ,OAAQ,QACjBuE,SAAUiiB,EAAKvnB,UAAY46C,GAC3B7W,cAAe,SAACC,GAAD,OAASV,EAAeU,IACvCC,mBAAiB,GAEhBR,EAAap6B,IAAI,SAACmyC,EAAUrtC,GAAX,OAChBnT,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQwgC,aAAcltC,IAAG,gBAAAgB,OAAkB6X,IACzDnT,EAAAC,EAAAC,cAACgpC,GAAD,CACEzC,SAAUla,EAAKvnB,UAAY46C,GAC3B3kD,MAAK9B,OAAAuV,EAAA,EAAAvV,CAAA,GAAOqnD,EAAa1G,GACzBjgB,KAAMuV,EAAIphC,SAAWue,EAAKvnB,UAAY46C,IAAmBrzB,EAAKvnB,UAAY46C,IAC1Et0C,SAAUivC,EACV6F,aAAcA,QAMrB7zB,EAAKvnB,UAAY46C,IAChB5/C,EAAAC,EAAAC,cAACypC,GAAA,EAAD,CACEC,MAAOnB,EAAapsC,OACpB4J,SAAS,SACT4jC,WAAYxB,EACZrhC,QAAS,CACPlB,KAAMkB,EAAQ2gC,cACdK,KAAMhhC,EAAQghC,KACdkP,IAAKlwC,EAAQkwC,IACb0D,UAAW5zC,EAAQ4zC,cAK3B56C,EAAAC,EAAAC,cAACugD,GAAD,CACE71C,KAAM2hB,EAAKvnB,UAAY46C,GACvB3kD,MAAOA,EACP4jD,QAASzP,EAAIphC,OACbwqC,KAAM,SAAC+G,GACLQ,EAAc9kD,EAAD9B,OAAAuV,EAAA,EAAAvV,CAAA,CAAUQ,GAAIsB,EAAMtB,IAAO4lD,IACxCW,EAAW3zB,EAAKwuB,OAElBtC,SAAU,kBAAMyH,EAAW3zB,EAAKwuB,UAE/BxuB,EAAKvnB,UAAY46C,IAAmBrzB,EAAKvnB,UAAY46C,KACtD5/C,EAAAC,EAAAC,cAAC+5B,GAAA,EAAD,CACEtuB,MAAM,yBACNlB,QAAS,aACTtD,UAAWH,EAAQ04C,uBEjKvB/5C,GAAYC,aAzCJ,SAAAC,GAAK,MAAK,CACtBC,KAAM,CACJ8C,MAAO,QACPxC,OAAQ,GACRQ,QAAS,OACTC,cAAe,SACfZ,SAAU,WACVF,OAAQ,MACRG,IAAK,MACLC,KAAM,IACN4wB,UAAW,oBAEb2pB,YAAa,CACX95C,QAAS,QACTqC,SAAU,EACVnC,UAAW,SACX4B,QAAS7C,EAAM8C,QAAQ,EAAG,EAAG,EAAG,GAChCyuC,WAAY,gCAEdxuB,SAAU,CACRlgB,QAAS,qBACTjF,MAAO,iBAETk9C,KAAM,CACJl9C,MAAK,gBACLc,WAAYsB,EAAMjC,QAAQC,QAAQ6jC,KAClC3f,UAAW,sBAEb64B,MAAO,CACLn9C,MAAK,gBACLc,WAAYsB,EAAMjC,QAAQC,QAAQC,MAEpC0U,MAAO,CAELjU,WAAYsB,EAAMjC,QAAQC,QAAQC,KAClC+E,OAAM,aAAAvN,OAAeuK,EAAMjC,QAAQC,QAAQ6jC,MAC3CgS,WAAY,kBACZj2C,MAAO,GACPsC,OAAQ,OAKN86C,GAAkB,SAAA/gD,GAAgC,IAA7B05C,EAA6B15C,EAA7B05C,aAAcluC,EAAexL,EAAfwL,SACjCtE,EAAUrB,KADsC+D,EAG1BC,mBAAS6vC,GAHiB5vC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAG/C2uC,EAH+CzuC,EAAA,GAGvCk3C,EAHuCl3C,EAAA,GAWtD,OACE5J,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,MACtB9F,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWH,EAAQ05C,YAAa93C,MAAM,UAAUrB,QAAQ,WAApE,OACAvH,EAAAC,EAAAC,cAACg5C,GAAA,EAAD,CACElyC,QAAS,CACP4hB,SAAU5hB,EAAQ4hB,SAClB+3B,KAAM35C,EAAQ25C,KACdC,MAAO55C,EAAQ45C,MACfpoC,MAAOxR,EAAQwR,OAEjBhN,MAAO6sC,EACPttC,kBAAgB,QAChBO,SAlBe,SAACvG,EAAOyG,GAC3Bs1C,EAAUt1C,GAEVF,EAASE,IAgBLgf,YAAY,aAEdxqB,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWH,EAAQ05C,YAAa93C,MAAM,UAAUrB,QAAQ,WAApE,eAUNs5C,GAAgBtmB,aAAe,CAC7Bif,aAAc,IACdluC,SAAU,cAGGu1C,UCvETl7C,GAAYC,aCpBH,SAAAC,GAAK,MAAK,CACvBC,KAAM,CACJvB,WAAY,oBAEZwB,OAAQ,OACRtC,MAAO,QAETs9C,SAAU,CACR36C,OAAQ,EACRH,SAAU,WACVF,OAAQ,OACRtC,MAAO,QAETu9C,UAAW,CACT56C,OAAQ,EACRH,SAAU,WACVF,OAAQ,OACRtC,MAAO,QAETw9C,WAAY,CACVh7C,SAAU,WACVG,OAAQ,GACR86C,kCAAmC,CACjC/6C,KAAM,OACND,IAAK,OACLH,OAAQ,OACRtC,MAAO,QAET09C,iCAAkC,CAChCh7C,KAAM,OACND,IAAK,OACLH,OAAQ,OACRtC,MAAO,SAIX29C,YAAa,CACX39C,MAAO,OAET49C,uBAAwB,CACtB59C,MAAO,OACPmD,QAAS,OACTgC,MAAO,QACPrE,WAAY,kBACZmE,QAAS7C,EAAM8C,QAAQ,GACvB1C,SAAU,WACVG,OAAQ,EACRF,IAAK,GAEPo7C,QAAS,CACPr4C,SAAU,EACVL,MAAO,QACPwuC,WAAY,cACZtwC,UAAW,SAEby6C,QAAS,CACPt4C,SAAU,EACVL,MAAO,QACPwuC,WAAY,kBD4FDoK,GAhIS,SAAA1hD,GAGlB,IAFJihD,EAEIjhD,EAFJihD,SAAUU,EAEN3hD,EAFM2hD,kBACVxX,EACInqC,EADJmqC,UAAWwO,EACP34C,EADO24C,SAAUiJ,EACjB5hD,EADiB4hD,QAAS7lD,EAC1BiE,EAD0BjE,QAC1BsgC,EAC6BhK,qBAAW+C,IAApChxB,EADJi4B,EACIj4B,OAAQlL,EADZmjC,EACYnjC,aACVia,EAAS/O,GAAUA,EAAO+O,OAAS/O,EAAO+O,OAAS,KACnDjM,EAAUrB,KAEVg8C,EAAcF,EAChBxuC,EAAOxZ,KAAK,SAAA2uC,GAAC,OAAIA,EAAEzuC,KAAO8nD,IAC1BxuC,GAAUA,EAAO5W,OAAS,EAAI4W,EAAO,GAAK,KAP1CvJ,EAS4BC,mBAASg4C,GATrC/3C,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GASGk4C,EATHh4C,EAAA,GASai4C,EATbj4C,EAAA,GAAAI,EAUgCL,oBAAS,GAVzCM,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAUG83C,EAVH73C,EAAA,GAUe83C,EAVf93C,EAAA,GAAAuR,EAWwB7R,mBAAS,KAXjC8R,EAAAtiB,OAAA0Q,GAAA,EAAA1Q,CAAAqiB,EAAA,GAWG68B,EAXH58B,EAAA,GAWWqlC,EAXXrlC,EAAA,GAkBJ,OAAKslC,EAGH/gD,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,MACtB9F,EAAAC,EAAAC,cAACkH,GAAA,EAAD,MACE69B,QAAQ2c,IACR5hD,EAAAC,EAAAC,cAAC8hD,GAAD,CAAiBxI,aAAc,IAAKluC,SAAUw1C,IAGhD9gD,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQ+5C,UACtB/gD,EAAAC,EAAAC,cAAConC,GAAD,CACE5B,aAAc,CAAC,QAAS,SAAU,SAClCv2B,MAAO,CAAEnG,QAASqvC,EAAS,KAC3Bx8C,QAASA,EACTZ,MAAO8lD,KAGT9b,QAAQ2c,IACR5hD,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQg6C,WACtBhhD,EAAAC,EAAAC,cAAConC,GAAD,CACE5B,aAAc,CAAC,QAAS,SAAU,SAClCD,aAAczsC,EAAaysC,aAC3BxqC,MAAO2mD,KAIb5hD,EAAAC,EAAAC,cAACwoB,GAAA,EAAD,CACE9d,MAAI,EACJmiC,iBAAkB,KAClBC,aAAc,CACZxU,mBAAoB,0BACpBrxB,UAAWH,EAAQ0jC,iBAErBjjC,QAASzH,EAAAC,EAAAC,cAAA,QAAMvG,GAAG,2BAAT,oBACTyzB,OAAQptB,EAAAC,EAAAC,cAAA,WACNF,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQ5B,MAAM,UAAUkX,KAAK,QAAQrV,QAASguC,GAA9C,UAGCxT,QAAQyc,IACP1hD,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQ5B,MAAM,UAAUkX,KAAK,QAAQrV,QAASi3C,GAA9C,SAKF1hD,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQ5B,MAAM,UAAUkX,KAAK,QAAQrV,QAASw/B,GAA9C,SAKF9iC,UAAWH,EAAQ2jC,WAGpBzmC,GAAUA,EAAO+O,QAChBjT,EAAAC,EAAAC,cAAC83B,GAAA,EAAD,CACEM,aAAW,UACXnxB,UAAWkoB,KAAWroB,EAAQi6C,WAAYj6C,EAAQi7C,WAClDj7C,QAAS,CACPsD,SAAUtD,EAAQk7C,aAEpB53C,UAAWpG,IAAWA,EAAO+O,QAAmC,IAAzB/O,EAAO+O,OAAO5W,OACrDoO,QAAS,kBAAMs3C,GAAc,KAE7B/hD,EAAAC,EAAAC,cAAC04B,GAAA34B,EAAD,CAAkBkH,UAAWH,EAAQm7C,eAIxCj+C,GAAUA,EAAO+O,QAChBjT,EAAAC,EAAAC,cAACkiD,GAAA,EAAD,CACEC,OAAO,OACPz3C,KAAMk3C,EACN96C,QAAS,CACPs7C,gBAAiBt7C,EAAQo6C,aAE3Bt2C,QAAS,kBAAMi3C,GAAc,IAC7BQ,OAAQ,kBAAMR,GAAc,KAE5B/hD,EAAAC,EAAAC,cAAA,OACEsiD,SAAU,EACVr7C,UAAWH,EAAQy7C,qBACnBC,KAAK,SACLj4C,QAAS,kBAAMs3C,GAAc,IAC7BY,UAAW,kBAAMZ,GAAc,KAE/B/hD,EAAAC,EAAAC,cAACqwC,GAAD,CACEzF,aAAa,EACbD,QAAS,EACT53B,OAAQ/O,EAAO+O,OACf83B,YA5FY,SAACpxC,GACvBkoD,EAAY39C,EAAO+O,OAAOxZ,KAAK,SAAA2uC,GAAC,OAAIA,EAAEzuC,KAAOA,KAC7CooD,GAAc,SAGM,mCEzCXa,GAAY,SAACC,EAAWp/C,EAAOsC,GAAW,IAAA2D,EACfC,oBAAS,GADMC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAC9Co5C,EAD8Cl5C,EAAA,GACjCm5C,EADiCn5C,EAAA,GAAAI,EAEbL,oBAAS,GAFIM,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAE9Cg5C,EAF8C/4C,EAAA,GAEhCg5C,EAFgCh5C,EAAA,GAG/Ci5C,EAASr+C,mBAEfO,oBAAU,WACR89C,EAAOl+C,QAAU,IAAIm+C,GACnB99C,SAAS+9C,eAAe,UACxB/9C,SAASnF,cAAc,WAEzBgjD,EAAOl+C,QAAQq+C,MACbt9C,GAAU2O,OAAO+V,WACjBhnB,GAASiR,OAAOgW,aAEfxT,KAAK,SAAC/I,GACL80C,GAAgB,KAEjBx/B,MAAM,SAACtmB,GACNrB,QAAQsB,MAAMD,GACd4lD,GAAe,MAElB,IAEH39C,oBAAU,WACJ89C,EAAOl+C,SACTk+C,EAAOl+C,QAAQq+C,MAAM5/C,EAAOsC,GACzBmR,KAAK,SAAC/I,GACL80C,GAAgB,KAEjBx/B,MAAM,SAACtmB,GACNrB,QAAQsB,MAAMD,GACd4lD,GAAe,MAGpB,CAACt/C,EAAOsC,IAIXX,oBAAU,kBAAM,WACV89C,EAAOl+C,UACTk+C,EAAOl+C,QAAQs+C,UACfJ,EAAOl+C,QAAU,QAElB,IAgBH,MAAO,CAAE89C,cAAaS,aAdD,WACnB,GAAIL,EAAOl+C,SAAWg+C,EAAc,CAClC,IAAMQ,EAAeN,EAAOl+C,QAAQy+C,iBAAiB,CAAElpD,KAAM,OAAQmpD,QAAS,IAC9Eb,EAAU1pD,OAAAuV,EAAA,EAAAvV,CAAA,GAAKqqD,EAAN,CAAoB7qC,KAAM,aAAc5C,IAAK,WAWtBitC,eAAcW,eAP3B,WACrB,GAAIT,EAAOl+C,SAAWg+C,EAAc,CAClC,IAAMQ,EAAeN,EAAOl+C,QAAQ4+C,gBACpCf,EAAUW,OAOVL,cACJ,SAAAA,EAAaU,EAAeC,GAAgB3qD,OAAA0O,GAAA,EAAA1O,CAAAD,KAAAiqD,GAC1CjqD,KAAK2qD,cAAgBA,EACrB3qD,KAAK4qD,cAAgBA,EAEY,WAA7BpvC,OAAOqvC,SAASC,UAAsD,cAA7BtvC,OAAOqvC,SAASE,UAC3DnoD,QAAQ8W,KAAK,qGAGVsU,UAAUg9B,cAAiBh9B,UAAUi9B,cACxCroD,QAAQ8W,KAAR,6JAIanP,EAAOsC,GACtB,IAAMq+C,EAAc3gD,EAAQsC,EACxBtC,GAASsC,EACX7M,KAAK2qD,cAAcpgD,MAAQ2gD,EAAclrD,KAAK2qD,cAAc99C,OAErDtC,EAAQsC,IACf7M,KAAK2qD,cAAc99C,OAAS7M,KAAK2qD,cAAcpgD,MAAQ2gD,6IAKzD,IACElrD,KAAK2qD,cAAcQ,UAAUC,YAAY,GAAGltC,OAE5Cle,KAAK4qD,cAAgB,KAEvB,MAAO3mD,GACLrB,QAAQsB,MAAMD,2KAILsG,EAAOsC,uGACX,IAAIqU,QAAQ,SAACC,EAASgX,QACiBpzB,IAAxCipB,UAAUg9B,aAAaC,cACrBlrD,EAAK4qD,cAAcQ,YACrBprD,EAAK4qD,cAAcQ,UAAUC,YAAY,GAAGltC,OAC5Cne,EAAK4qD,cAAcQ,UAAY,MAEjCn9B,UAAUg9B,aAAaC,aAAa,CAAEI,OAAO,EAAOC,MAAO,CAAEC,WAAY,cAAehhD,QAAOsC,YAC5FmR,KAAK,SAACwtC,GACD,cAAezrD,EAAK4qD,cACtB5qD,EAAK4qD,cAAcQ,UAAYK,EAI/BzrD,EAAK4qD,cAAc5oB,IAAMvmB,OAAOiwC,IAAIC,gBAAgBF,GAEtDzrD,EAAK4qD,cAAcgB,iBAAmB,SAAC1nD,GACrClE,EAAK4qD,cAAcnI,QAErBziD,EAAK4qD,cAAciB,UAAY,SAAC3nD,GAC9Bkd,OAGHoJ,MAAM,SAAA5mB,GAAG,OAAIw0B,EAAOx0B,MAGvBw0B,EAAO,IAAIv2B,MAAM,mKAMrB,IAAMiqD,EAAa7rD,KAAK2qD,cAAcmB,WAChCC,EAAc/rD,KAAK2qD,cAAcqB,YAEjC9lD,EAAUlG,KAAK4qD,cAAcqB,WAAW,MAM9C,OALAjsD,KAAK4qD,cAAcrgD,MAAQshD,EAC3B7rD,KAAK4qD,cAAc/9C,OAASk/C,EAE5B7lD,EAAQgmD,UAAUlsD,KAAK2qD,cAAe,EAAG,EAAGkB,EAAYE,GAEjD,CAAEA,cAAaF,sDAGP,IAAAM,EACqBnsD,KAAKosD,aAAjCL,EADOI,EACPJ,YAAaF,EADNM,EACMN,WACf52C,EAAO,CAAEA,KAAM,KAAM82C,cAAaF,cACxC,IACE52C,EAAKA,KAAOjV,KAAK4qD,cACdqB,WAAW,MACXI,aACC,EACA,EACAR,EACAE,GACA92C,KAEN,MAAOhR,IAEP,OAAOgR,0CAGQ,IAAA6V,EAAA9qB,KAAAssD,EACqBtsD,KAAKosD,aAAjCP,EADOS,EACPT,WAAYE,EADLO,EACKP,YACpB,OAAO,IAAI7qC,QAAQ,SAACC,EAASgX,GAC3BrN,EAAK8/B,cAAc2B,OAAO,SAACC,GACzBrrC,EAAQ,CAAEqrC,WAAUT,cAAaF,8DAK6B,IAAAjlD,EAAA9B,UAAA3B,OAAA,QAAA4B,IAAAD,UAAA,GAAAA,UAAA,GAA9B,CAAEzD,KAAM,OAAQmpD,QAAS,GAA3CnpD,EAAgDuF,EAAhDvF,KAAMmpD,EAA0C5jD,EAA1C4jD,QAA0CiC,EAC9BzsD,KAAKosD,aAAjCL,EAD0DU,EAC1DV,YAAaF,EAD6CY,EAC7CZ,WAErB,MAAO,CAAElpD,QADO3C,KAAK4qD,cAAc8B,UAAU,SAAWrrD,EAAMmpD,GAC5CuB,cAAaF,aAAYxqD,KAAM,SAAWA,YCvJ1DoL,GAAYC,aCtBH,SAAAC,GAAK,MAAK,CACvBC,KAAM,CACJvB,WAAY,QAEZwB,OAAQ,OACRtC,MAAO,QAEToiD,gBAAiB,CACfj9C,MAAO,QACP3C,SAAU,WACVC,IAAK,MACLC,KAAM,MACN1C,MAAO,MACPszB,UAAW,oCACXjwB,UAAW,UAEbo7C,YAAa,CACXt5C,MAAO,mBACPrE,WAAY,oBACZyE,QAAS,IAEX88C,UAAW,CACT7/C,SAAU,WACVG,OAAQ,GACR86C,kCAAmC,CACjCtiB,MAAO,OACP14B,IAAK,MACL6wB,UAAW,mBACXhxB,OAAQ,OACRtC,MAAO,QAET09C,iCAAkC,CAChCtqB,OAAQ,OACR1wB,KAAM,MACN4wB,UAAW,mBACXhxB,OAAQ,OACRtC,MAAO,SAGXsiD,WAAY,CACVhgD,OAAQ,OACRtC,MAAO,QAETuiD,UAAW,CACT//C,SAAU,WACVG,OAAQ,GACR86C,kCAAmC,CACjCtiB,MAAO,OACP14B,IAAK,OACLH,OAAQ,OACRtC,MAAO,QAET09C,iCAAkC,CAChCviB,MAAO,OACP/H,OAAQ,OACR9wB,OAAQ,OACRtC,MAAO,SAGXwiD,WAAY,CACVlgD,OAAQ,OACRtC,MAAO,QAGT29C,YAAa,CACX39C,MAAO,OAGTw9C,WAAY,CACVh7C,SAAU,WACVG,OAAQ,GACR86C,kCAAmC,CACjC/6C,KAAM,OACND,IAAK,OACLH,OAAQ,OACRtC,MAAO,QAET09C,iCAAkC,CAChCh7C,KAAM,OACND,IAAK,OACLH,OAAQ,OACRtC,MAAO,SAIXyiD,cAAe,CACbjgD,SAAU,WACVG,OAAQ,GACR86C,kCAAmC,CACjCtiB,MAAO,OACP/H,OAAQ,OACR9wB,OAAQ,OACRtC,MAAO,QAET09C,iCAAkC,CAChCh7C,KAAM,OACN0wB,OAAQ,OACR9wB,OAAQ,OACRtC,MAAO,SAGX0iD,eAAgB,CACdpgD,OAAQ,MACRtC,MAAO,OAGTs9C,SAAU,GAGVC,UAAW,CACT/6C,SAAU,WACVG,OAAQ,EACRF,IAAK,EACLC,KAAM,EACNJ,OAAQ,OACRtC,MAAO,QAET+gD,MAAO,CACLv+C,SAAU,WACVG,OAAQ,EACRF,IAAK,EACLC,KAAM,EACNJ,OAAQ,OACRtC,MAAO,WDkDI2iD,GApJI,SAAAtmD,GAAgD,IAA7C24C,EAA6C34C,EAA7C24C,SAAU4N,EAAmCvmD,EAAnCumD,UAAW5E,EAAwB3hD,EAAxB2hD,kBACnCz6C,EAAUrB,KADiD+D,EAErCC,mBAAS,IAF4BC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAE1D2uC,EAF0DzuC,EAAA,GAElDk3C,EAFkDl3C,EAAA,GAAAI,EAGzCL,mBAAS,CAAC,KAAM,OAHyBM,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAG1D8V,EAH0D7V,EAAA,GAGpDq8C,EAHoDr8C,EAAA,GAAAkyB,EAKhChK,qBAAW+C,IAApChxB,EALyDi4B,EAKzDj4B,OAAQlL,EALiDmjC,EAKjDnjC,aAEV2oD,EAAcF,EAChBv9C,EAAO+O,OAAOxZ,KAAK,SAAA2uC,GAAC,OAAIA,EAAEzuC,KAAO8nD,IACjCv9C,GAAUA,EAAO+O,QAAU/O,EAAO+O,OAAO5W,OAAS,EAAI6H,EAAO+O,OAAO,GAAK,KATZuI,EAWjC7R,mBAASg4C,GAXwBlmC,EAAAtiB,OAAA0Q,GAAA,EAAA1Q,CAAAqiB,EAAA,GAW1DomC,EAX0DnmC,EAAA,GAWhDomC,EAXgDpmC,EAAA,GAAA6vB,EAY7B3hC,oBAAS,GAZoB4hC,EAAApyC,OAAA0Q,GAAA,EAAA1Q,CAAAmyC,EAAA,GAY1DwW,EAZ0DvW,EAAA,GAY9CwW,EAZ8CxW,EAAA,GAAAgb,EAab3D,GAClD,SAACz0C,GAAD,OAAUk4C,EAAUl4C,EAAMyzC,EAAWA,EAASjoD,GAAK,OACnDmmB,EAAK,GACLA,EAAK,IAHCgjC,EAbyDyD,EAazDzD,YAAaS,EAb4CgD,EAa5ChD,aAAcP,EAb8BuD,EAa9BvD,aAW7B9kB,EAAe,WACnBooB,EAAQ,CAAC5xC,OAAO+V,WAAY/V,OAAOgW,eAWrC,OARAgB,0BAAgB,WAGd,OAFAwS,IACAxpB,OAAOpP,iBAAiB,SAAU44B,GAC3B,WACLxpB,OAAOnP,oBAAoB,SAAU24B,KAEtC,IAGDl+B,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,MACtB9F,EAAAC,EAAAC,cAACkH,GAAA,EAAD,OACG07C,GAAe7d,QAAQ2c,IACxB5hD,EAAAC,EAAAC,cAAC8hD,GAAD,CAAiBxI,aAAcnB,EAAQ/sC,SAAUw1C,IAGjDgC,GACA9iD,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQ6+C,iBACtB7lD,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,YAAYqB,MAAM,WAAtC,oBACA5I,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,QAAQqB,MAAM,WAAlC,4CAIFq8B,QAAQ2c,IACR5hD,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQg6C,WACtBhhD,EAAAC,EAAAC,cAAConC,GAAD,CACE5B,aAAc,CAAC,QAAS,SAAU,SAClCD,aAAczsC,EAAaysC,aAC3Bt2B,MAAO,CAAEnG,QAASqvC,EAAS,KAC3Bp9C,MAAO2mD,MAIVkB,GACD9iD,EAAAC,EAAAC,cAAA,SACEsmD,UAAQ,EACRC,aAAW,EACXC,OAAK,EACL/sD,GAAG,SACH8J,MAAOiR,OAAO+V,WACd1kB,OAAQ2O,OAAOgW,YACfvjB,UAAWH,EAAQw9C,QAIvBxkD,EAAAC,EAAAC,cAAC83B,GAAA,EAAD,CACEpvB,MAAM,UACN0vB,aAAW,aACXtxB,QAAS,CACPsD,SAAUtD,EAAQk7C,aAEpB53C,SAAUw4C,IAAgBE,EAC1B77C,UAAWkoB,KAAWroB,EAAQ8+C,UAAW9+C,EAAQi7C,WACjDx3C,QAAS84C,GAETvjD,EAAAC,EAAAC,cAACymD,GAAA1mD,EAAD,CAAYkH,UAAWH,EAAQ++C,cAGjC/lD,EAAAC,EAAAC,cAAC83B,GAAA,EAAD,CACEpvB,MAAM,YACN0vB,aAAW,SACX7tB,QAASguC,EACTzxC,QAAS,CACPsD,SAAUtD,EAAQk7C,aAEpB/6C,UAAWkoB,KAAWroB,EAAQg/C,UAAWh/C,EAAQi7C,YAEjDjiD,EAAAC,EAAAC,cAACi6B,GAAAl6B,EAAD,CAAYkH,UAAWH,EAAQi/C,cAGhC/hD,GAAUA,EAAO+O,QAChBjT,EAAAC,EAAAC,cAAC83B,GAAA,EAAD,CACEM,aAAW,UACXnxB,UAAWkoB,KAAWroB,EAAQi6C,WAAYj6C,EAAQi7C,WAClDj7C,QAAS,CACPsD,SAAUtD,EAAQk7C,aAEpB53C,UAAWpG,IAAWA,EAAO+O,QAAmC,IAAzB/O,EAAO+O,OAAO5W,OACrDoO,QAAS,kBAAMs3C,GAAc,KAE7B/hD,EAAAC,EAAAC,cAAC04B,GAAA34B,EAAD,CAAkBkH,UAAWH,EAAQm7C,eAIxCj+C,GAAUA,EAAO+O,QAChBjT,EAAAC,EAAAC,cAACkiD,GAAA,EAAD,CACEC,OAAO,OACPz3C,KAAMk3C,EACN96C,QAAS,CACPs7C,gBAAiBt7C,EAAQo6C,aAE3Bt2C,QAAS,kBAAMi3C,GAAc,IAC7BQ,OAAQ,kBAAMR,GAAc,KAE5B/hD,EAAAC,EAAAC,cAAA,OACEsiD,SAAU,EACVr7C,UAAWH,EAAQy7C,qBACnBC,KAAK,SACLj4C,QAAS,kBAAMs3C,GAAc,IAC7BY,UAAW,kBAAMZ,GAAc,KAE/B/hD,EAAAC,EAAAC,cAACqwC,GAAD,CACEzF,aAAa,EACbD,QAAS,EACT53B,OAAQ/O,EAAO+O,OACf83B,YAjHY,SAACpxC,GACvBkoD,EAAY39C,EAAO+O,OAAOxZ,KAAK,SAAA2uC,GAAC,OAAIA,EAAEzuC,KAAOA,KAC7CooD,GAAc,UE5BZp8C,GAAYC,aClBH,SAAAC,GAAK,MAAK,CACvBC,KAAM,GAGNw0B,UAAW,CACT1xB,MAAO/C,EAAMjC,QAAQI,KAAKD,WAE5Bk1C,aAAc,CACZr6B,UAAW/Y,EAAM8C,QAAQ,GACzBQ,aAActD,EAAM8C,QAAQ,GAC5BC,MAAO/C,EAAMjC,QAAQI,KAAKD,WAE5BsK,IAAK,CACHlF,aAActD,EAAM8C,QAAQ,IAE9BwvC,WAAY,CACVhvC,aAActD,EAAM8C,QAAQ,IAE9BqY,MAAO,CACL7X,aAActD,EAAM8C,QAAQ,OD+DjBi+C,GA9DM,SAAA9mD,GAA4C,IAAzC7E,EAAyC6E,EAAzC7E,MAAO6a,EAAkChW,EAAlCgW,UAAW2iC,EAAuB34C,EAAvB24C,SAAUoO,EAAa/mD,EAAb+mD,OAC5C7/C,EAAUrB,KAD+C+D,EAGzBC,mBAASmM,GAAa,IAHGlM,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAGxDiqB,EAHwD/pB,EAAA,GAG3Ck9C,EAH2Cl9C,EAAA,GAAAI,EAI3BL,mBAAS1O,GAJkBgP,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAIxDuqB,EAJwDtqB,EAAA,GAI5C88C,EAJ4C98C,EAAA,GAM/D,OACEjK,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,MACtB9F,EAAAC,EAAAC,cAACkH,GAAA,EAAD,MADF,IAEEpH,EAAAC,EAAAC,cAACyK,GAAA,EAAD,CACEk4B,YAAU,EACVrH,OAAO,QACP0O,sBAAoB,EACpBC,sBAAoB,EACpBr/B,QAAS2tC,EACT1tC,kBAAgB,0BAChBH,MAAI,GAEJ5K,EAAAC,EAAAC,cAAC8K,GAAA,EAAD,CAAaywB,mBAAiB,EAACt0B,UAAWH,EAAQy3C,mBAChDz+C,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,KAAKJ,UAAWH,EAAQq0B,UAA5C,yBAIFr7B,EAAAC,EAAAC,cAAC+K,GAAA,EAAD,OAEK6K,GACD9V,EAAAC,EAAAC,cAACs6C,GAAD,CACEt2C,OAAQ4R,EACRgkC,MAAOnmB,EACProB,SAAUw7C,IAId9mD,EAAAC,EAAAC,cAACo/C,GAAD,CACErkD,MAAOA,EACP4jD,SAAO,EACP/E,MAAOvlB,EACPjpB,SAAU,SAAC07C,GAAD,OAAaD,EAAc5tD,OAAAuV,EAAA,EAAAvV,CAAA,GAAKo7B,EAAeyyB,QAI7DhnD,EAAAC,EAAAC,cAAC0L,GAAA,EAAD,KACE5L,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQC,QAASguC,EAAU7vC,MAAM,WAAjC,UAGA5I,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQC,QAAS,kBAAMo8C,EAAOlzB,EAAaY,IAAa3rB,MAAM,WAA9D,iCElBKq+C,GA5CM,WAA6E,IAA5E37C,EAA4EtN,UAAA3B,OAAA,QAAA4B,IAAAD,UAAA,GAAAA,UAAA,GAAjE,aAAUkpD,EAAuDlpD,UAAA3B,OAAA,EAAA2B,UAAA,QAAAC,EAAzCkpD,IAAyCnpD,UAAA3B,OAAA,QAAA4B,IAAAD,UAAA,KAAAA,UAAA,GAApBopD,EAAoBppD,UAAA3B,OAAA,QAAA4B,IAAAD,UAAA,IAAAA,UAAA,GAC1F0jC,EAAW78B,mBACXwiD,EAAWxiD,mBAEXyiD,EACJtnD,EAAAC,EAAAC,cAAA,SAAOiP,MAAO,CAAEvI,QAAS,QAAUM,IAAKw6B,EAAUnnC,KAAK,OAAOgtD,OAASH,EAAsB,KAAZ,UAAkBI,QAASN,IAoC9G,OA7BA9hD,oBAAU,WACR,IAAMqiD,EAAe,SAAAC,GAAO,IACnB53B,EADmB32B,OAAAia,GAAA,EAAAja,CACPuoC,EAAS18B,QAAQ2iD,OADV,GAE1B,GAAI73B,EAAM,CACRh0B,QAAQC,IAAI,OAAQ+zB,GACpB,IAAM83B,EAAS,IAAIC,WACnBD,EAAOE,UAAY,WAAM,IACfvtD,EAAqBu1B,EAArBv1B,KAAMoe,EAAemX,EAAfnX,KAAMmH,EAASgQ,EAAThQ,KACpBxU,EAAS,CAAEzP,QAAS+rD,EAAOG,OAAQxtD,OAAMoe,OAAMmH,OAAM/J,IAAKiyC,GAAel4B,MAE3E83B,EAAOK,cAAcn4B,GAEvB4R,EAAS18B,QAAQwG,MAAQ,MAU3B,OAPIk2B,EAAS18B,UACX08B,EAAS18B,QAAQM,iBAAiB,SAAUmiD,GACvCJ,EAASriD,UACRmiD,GAAczlB,EAAS18B,QAAQG,QACnCkiD,EAASriD,SAAU,IAGhB,WACD08B,EAAS18B,SACX08B,EAAS18B,QAAQO,oBAAoB,SAAUkiD,KAGlD,CAAC/lB,EAAS18B,UAEN,CAAEkjD,YAAaZ,EAASa,WAjCZ,WACbzmB,EAAS18B,SAAS08B,EAAS18B,QAAQG,SAgCEu8B,aAKvCsmB,GAAiB,SAACtC,GACtB,OAAQA,EAASnrD,MACf,IAAK,aAEL,IAAK,YACH,MAAO,OACT,IAAK,YACH,MAAO,MACT,QACE,MAAO,QClDPoL,GAAYC,aAAW,SAAAC,GAAK,MAAK,CACrCC,KAAM,CACJC,OAAQ,OACRa,QAAS,OACTC,cAAe,SACfC,UAAW,SACX8B,MAAO/C,EAAMjC,QAAQ8+B,KAAK,KAC1B75B,OAAM,cAAAvN,OAAgBuK,EAAMjC,QAAQ8+B,KAAK,OAE3C35B,KAAM,CACJH,MAAO/C,EAAMjC,QAAQ8+B,KAAK,KAC1Bn/B,OAAQ,OACR+C,KAAM,UACNP,OAAQ,MACRtC,MAAO,OAETqF,OAAQ,CACNvF,OAAQsC,EAAM8C,QAAQ,OAmCXy/C,GA/BW,SAAAtoD,GAA8C,IAA3C0uC,EAA2C1uC,EAA3C0uC,aAAciK,EAA6B34C,EAA7B24C,SAAU4P,EAAmBvoD,EAAnBuoD,aAC7CrhD,EAAUrB,KADsD2iD,EAElCrB,GAAazY,EAAc6Z,GAAvDH,EAF8DI,EAE9DJ,YAAaC,EAFiDG,EAEjDH,WACjBI,EAAc,UACd1Y,EAAY2Y,KAOhB,OALIH,IACFE,EAAc,SACd1Y,EAAY4Y,MAIZzoD,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,MACrBoiD,EACDloD,EAAAC,EAAAC,cAAC2vC,EAAD,CAAW1oC,UAAWH,EAAQ+B,KAAKH,MAAM,UAAU6B,QAAS09C,IAC5DnoD,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQjD,QAAQ,YAAYJ,UAAWH,EAAQ8B,OAAQF,MAAM,UAAU6B,QAAS09C,GAAhF,eACeI,GAEfvoD,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQjD,QAAQ,WAAWJ,UAAWH,EAAQ8B,OAAQF,MAAM,YAAY6B,QAASguC,GAAjF,sBCxBSiQ,GAnBb,SAAAA,EAAa1vD,EAAckL,GAAQ,IAAAjL,EAAAC,KAAAC,OAAA0O,GAAA,EAAA1O,CAAAD,KAAAwvD,GAAAxvD,KAQnCgC,QAAU,WACRjC,EAAKoB,KAAOc,KAAKC,UAAUnC,EAAKM,OAAOY,kBATNjB,KAYnC4c,UAAY,iBAAO,CACjBnc,GAAE,KAAA2B,OAAOC,QACTlB,KAAMc,KAAKC,UAAUnC,EAAKM,OAAOY,iBACjC8Y,OAAQ,KAdR/Z,KAAKK,OAAS,IAAIR,KAAaC,GACnBE,KAAKgL,OAAbA,GAEYhL,KAAK4c,aCMZ6yC,GACH,SADGA,GAEI,eAFJA,GAGC,UAHDA,GAIE,cAJFA,GAKI,gBAgMFC,GA7LE,SAAA9oD,GAAsD,IAAnD+oD,EAAmD/oD,EAAnD+oD,YAAaC,EAAsChpD,EAAtCgpD,SAAUrQ,EAA4B34C,EAA5B24C,SAAUsQ,EAAkBjpD,EAAlBipD,YAAkB5sB,EACpChK,qBAAW+C,IAApCl8B,EAD6DmjC,EAC7DnjC,aAAckL,EAD+Ci4B,EAC/Cj4B,OAChB8kD,EAASnkD,mBAFsD6E,EAK7BC,mBAAS,MALoBC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAK9Du/C,EAL8Dr/C,EAAA,GAKhDs/C,EALgDt/C,EAAA,GAAAI,EAQnCL,mBAASo/C,EAAc,IAAII,GAAYnwD,GAAckL,OAASA,GAR3B+F,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAQ9D8L,EAR8D7L,EAAA,GAQnDm/C,EARmDn/C,EAAA,GAAAuR,EASrC7R,mBAAS,IAAI0/C,KAAWrwD,GAAciC,OATDwgB,EAAAtiB,OAAA0Q,GAAA,EAAA1Q,CAAAqiB,EAAA,GAS9DngB,EAT8DogB,EAAA,GASpD6tC,EAToD7tC,EAAA,GAAA6vB,EAWjC3hC,mBAAS,MAXwB4hC,EAAApyC,OAAA0Q,GAAA,EAAA1Q,CAAAmyC,EAAA,GAW9Die,EAX8Dhe,EAAA,GAWlDie,EAXkDje,EAAA,GAAAke,EAYzC9/C,mBAAS,CAAE3E,QAAS6jD,EAAan8B,QAAS,KAZDg9B,EAAAvwD,OAAA0Q,GAAA,EAAA1Q,CAAAswD,EAAA,GAY9Dl9B,EAZ8Dm9B,EAAA,GAYxDC,EAZwDD,EAAA,GAa/Dl/B,E7FUD,WAAiC,IAAAxgB,EACYL,mBAAS,CAAEigD,UAAU,EAAOC,MAAO,KAAMC,KAAM,KAAMC,MAAO,OADxE9/C,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAC/BggD,EAD+B//C,EAAA,GACZggD,EADYhgD,EAAA,GAGtC,SAASigD,EAAyBnlD,GAChCklD,EAAqB,CACnBL,SAAU7kD,EAAM6kD,SAChBC,MAAO9kD,EAAM8kD,MACbC,KAAM/kD,EAAM+kD,KACZC,MAAOhlD,EAAMglD,QAYjB,OARA3kD,oBAAU,WAGR,OAFAsP,OAAOpP,iBAAiB,oBAAqB4kD,GAAyB,GAE/D,WACLx1C,OAAOnP,oBAAoB,oBAAqB2kD,KAEjD,IAEIF,E6F9BaG,GACdC,EAAM9jC,KACZ0iC,EAAOhkD,QAAUolD,EAEjB,IAAMn3C,GAAU81C,GAAe7kD,GAAUA,EAAO+O,OAAS/O,EAAO+O,OAAS,GAEnEitC,EAAa,SAACmK,GAClBvuD,QAAQC,IAAI,sBAAuBwwB,EAAM89B,GACzCV,EAAY,CACV3kD,QAASqlD,EACT39B,QAAO,GAAApxB,OAAAnC,OAAAia,GAAA,EAAAja,CAAMozB,EAAKG,SAAX,CAAoBH,EAAKvnB,aAiB9BwpC,EAAe,SAACrgC,GACpBrS,QAAQC,IAAI,8BAA+B,CAAEoS,OAAM46C,gBACnDG,EAAgB/6C,GAFa,IAAAm8C,EAIW1uD,aAAQuS,EAAKtS,SAA7CG,EAJqBsuD,EAIrBtuD,KAAMC,EAJequD,EAIfruD,aAAcC,EAJCouD,EAIDpuD,QACxBic,EAASjc,EACPquD,EAAOtuD,GAAgBc,OAAOpB,KAAKic,OACzC,IAAKO,EACH,GAAI6wC,EAAOhkD,SAAWgkD,EAAOhkD,QAAQ2hB,UAAYqiC,EAAOhkD,QAAQ4hB,UAAW,KAAA4jC,EACzCxB,EAAOhkD,QAA/B2hB,EADiE6jC,EACjE7jC,SACRxO,EAAS,CAFgEqyC,EACvD5jC,UACGD,QAIrBxO,EAAS,EAAE,YAAa,YAIxB4wC,GAAaK,EAAajwD,OAAAuV,EAAA,EAAAvV,CAAA,GAAK2c,EAAN,CAAiBqC,YAE9Crc,QAAQC,IAAI,uBAAwB,CAAEoc,SAAQjc,UAASkuD,QAEvD,IAAMK,EAAStxD,OAAAuV,EAAA,EAAAvV,CAAA,GACVkC,EADU,CAEbI,QAAS8uD,EACTpyC,SACAuyC,QAASvvD,KAAKC,UAAU,CACtBY,OACA2uD,QAAS,CACPngC,cACA4/B,WAINd,EAAYmB,GACZ3uD,QAAQC,IAAI,eAAgB0uD,GAC5BvK,EAAWyI,IACX7sD,QAAQC,IAAI,wBAAyB0uD,IA0CnC5qC,EAAY,KAChB,OAAQ0M,EAAKvnB,SACX,KAAK2jD,GACH9oC,EACE7f,EAAAC,EAAAC,cAAC0qD,GAAD,CACE33C,OAAQA,EACRozC,UA7CU,SAACl4C,EAAM08C,GACvB3B,EAAgB/6C,GAChBrS,QAAQC,IAAI,2BAA4B,CAAEoS,SAFT,IAAA28C,EAGPlvD,aAAQuS,EAAKtS,SAA/BG,EAHyB8uD,EAGzB9uD,KAAME,EAHmB4uD,EAGnB5uD,QAERquD,EAAOxtD,OAAOpB,KAAKic,OAGrBO,EAAS,EAAE,YAAa,YAC5B,GAAI6wC,EAAOhkD,SAAWgkD,EAAOhkD,QAAQ2hB,UAAYqiC,EAAOhkD,QAAQ4hB,UAAW,KAAAmkC,EACzC/B,EAAOhkD,QAA/B2hB,EADiEokC,EACjEpkC,SACRxO,EAAS,CAFgE4yC,EACvDnkC,UACGD,QAEdzqB,IACPic,EAASjc,GAGP6sD,GAAaK,EAAajwD,OAAAuV,EAAA,EAAAvV,CAAA,GAAK2c,EAAN,CAAiBqC,YAE9C,IAAMsyC,EAAStxD,OAAAuV,EAAA,EAAAvV,CAAA,GACVkC,EADU,CAEbI,QAAS8uD,EACTpyC,SACAuyC,QAASvvD,KAAKC,UAAU,CACtBY,OACA2uD,QAAS,CACPngC,cACA4/B,WAINd,EAAYmB,GACZ3uD,QAAQC,IAAI,YAAa,CAAE0uD,YAAW30C,UAAU3c,OAAAuV,EAAA,EAAAvV,CAAA,GAAM2c,EAAP,CAAkBqC,aACjEqxC,EAAcqB,GACd3K,EAAWyI,KAYLlQ,SAAUA,IAGd,MACF,KAAKkQ,GACH9oC,EACEA,EAAY7f,EAAAC,EAAAC,cAAC8qD,GAAD,CACVvS,SAAUA,EACV4P,cAAY,EACZ7Z,aAAcA,IAGlB,MACF,KAAKma,GACH9oC,EAAY7f,EAAAC,EAAAC,cAAC8qD,GAAD,CACVvS,SAAUA,EACVjK,aAAcA,IAGhB,MACF,KAAKma,GACH9oC,EACE7f,EAAAC,EAAAC,cAAC+qD,GAAD,CACExJ,kBAAmB8H,EACnBt2C,OAAQA,EACR8tC,SAAU1lD,EACVQ,QAASotD,EAAaptD,QACtBouC,UAAW,kBAAMiW,EAAWyI,KAC5BlQ,SAAUA,EACViJ,QAjIS,WACf,GAAIn1B,EAAKG,QAAQrwB,OAAS,EAAG,CAC3B,IAAM6uD,EAAU/xD,OAAAia,GAAA,EAAAja,CAAOozB,EAAKG,SACtBy+B,EAAUD,EAAW39B,MAC3Bo8B,EAAY,CACV3kD,QAASmmD,EACTz+B,QAASw+B,SAIXzS,OA0HA,MACF,KAAKkQ,GACH9oC,EACE7f,EAAAC,EAAAC,cAACkrD,GAAD,CACEnwD,MAAOI,EACPya,UAAWizC,EAAcjzC,EAAY,KACrC+wC,OA/Cc,SAAClzB,EAAaY,GAAd,OAA6Bu0B,EAASn1B,EAAaY,EAAY00B,IAgD7ExQ,SAAUA,IAGd,MACF,QACE38C,QAAQC,IAAI,qDAAsDwwB,GAClEksB,IAGJ,OAAO54B,wBChIMwrC,cAjEb,SAAAA,EAAaC,EAAS5I,EAAM6I,GAAe,IAAAtyD,EAAAC,KAAAC,OAAA0O,GAAA,EAAA1O,CAAAD,KAAAmyD,GAAAnyD,KAQ3CsyD,SAAW,SAAC/1B,GACV,IAAKA,IAAQA,EAAI5d,cAAgB4d,EAAI5d,YAAYle,GAAI,MAAM,IAAImB,MAAJ,yBAC3D,IACE,OAAO26B,EAAI5d,YAAYle,KAAOV,EAAKqyD,QAAU,MAAQ,MAEvD,MAAOnuD,GACL,MAAO,QAdgCjE,KAkB3CuyD,QAAU,SAACh2B,GACT,IAAKA,IAAQA,EAAI5d,cAAgB4d,EAAI5d,YAAYle,GAAI,MAAM,IAAImB,MAAJ,yBAC3D,IACE,OAAO26B,EAAI5d,YAAYle,KAAOV,EAAKqyD,QAErC,MAAOnuD,GACL,OAAO,IAxBgCjE,KAgC3CuzC,QAAU,SAACrf,EAAQqI,EAAKl7B,EAAMmxD,GAC5B,GAAI,CAAC,SAAU,SAAStvD,QAAQ7B,GAAQ,EAAG,MAAM,IAAIO,MAAJ,+BAAAQ,OAAyCf,IAE1F,IACE,IAAMoxD,EAAS1yD,EAAKuyD,SAAS/1B,GAEvBm2B,EAAO3yD,EAAKyyC,GAAG0D,IAAIn2C,EAAKypD,MAAjB,GAAApnD,OAA0B8xB,GAA1B9xB,OAAmCqwD,IAAUpxD,GACtDsxD,EAAY,KAOhB,MANa,WAATtxD,IACiB,WAAfk7B,EAAI9e,OAAqBk1C,EAAY5yD,EAAKyyC,GAAG0D,IAAIn2C,EAAKypD,MAAjB,GAAApnD,OAA0B8xB,GAA1B9xB,OAAmCqwD,IAAU,iBAC9D,SAAfl2B,EAAI9e,SAAmBk1C,EAAY5yD,EAAKyyC,GAAG0D,IAAIn2C,EAAKypD,MAAjB,GAAApnD,OAA0B8xB,GAA1B9xB,OAAmCqwD,IAAU,iBAIvFD,EACEG,IACOD,EAAKE,WAAWryD,KAAK,SAAA2uC,GAAC,MAAU,MAANA,GAAasjB,EAAMtvD,QAAQgsC,IAAM,OACjEyjB,EAAUC,WAAWryD,KAAK,SAAA2uC,GAAC,MAAU,MAANA,GAAasjB,EAAMtvD,QAAQgsC,IAAM,MAEvDwjB,EAAKE,WAAWryD,KAAK,SAAA2uC,GAAC,MAAU,MAANA,GAAasjB,EAAMtvD,QAAQgsC,IAAM,IAGrEyjB,EAAkBD,EAAKG,SAAWF,EAAUE,QACpCH,EAAKG,QAGrB,MAAO5uD,GAEL,OADArB,QAAQsB,MAAMD,IACP,IA3DTjE,KAAKoyD,QAAUA,EACfpyD,KAAKwpD,KAAOA,EACZxpD,KAAKqyD,cAAgBA,EACrBryD,KAAKwyC,GAAK,IAAIsgB,KAAcT,2DAyB5BzvD,QAAQC,IAAI,gBAAiB,CAAEkwD,IAAK/yD,KAAKoyD,QAAS5I,KAAMxpD,KAAKwpD,gBClB3D/8C,GAAYC,aAAWuJ,IAmCd+8C,GAjCQ,SAAApsD,GAAoB,IAAjB2uC,EAAiB3uC,EAAjB2uC,WAClBznC,EAAUrB,KAEhB,OACE3F,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,MACtB9F,EAAAC,EAAAC,cAACkH,GAAA,EAAD,MACApH,EAAAC,EAAAC,cAACsvC,GAAA,EAAD,CAAQvpC,SAAS,SAASkB,UAAWH,EAAQomC,QAC3CptC,EAAAC,EAAAC,cAACyf,GAAA,EAAD,CAASC,gBAAc,GACrB5f,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CAAYv0B,UAAWH,EAAQ8mC,WAAYllC,MAAM,UAAU6B,QAASgkC,EAAYnW,aAAW,QACzFt4B,EAAAC,EAAAC,cAACuvC,GAAAxvC,EAAD,OAEFD,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,YAAYqB,MAAM,UAAUzB,UAAWH,EAAQymC,cAAnE,YAMJztC,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQ+mC,kBACtB/tC,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQ2mC,OACxB3tC,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWH,EAAQinC,gBAAiB1mC,QAAQ,MAAxD,oBAGAvH,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQ2mC,UCvB1BhoC,GAAYC,aAAWuJ,IAsCdg9C,GApCO,SAAArsD,GAAoB,IAAjB2uC,EAAiB3uC,EAAjB2uC,WACjBznC,EAAUrB,KAEhB,OACE3F,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,MACtB9F,EAAAC,EAAAC,cAACkH,GAAA,EAAD,MACApH,EAAAC,EAAAC,cAACsvC,GAAA,EAAD,CAAQvpC,SAAS,SAASkB,UAAWH,EAAQomC,QAC3CptC,EAAAC,EAAAC,cAACyf,GAAA,EAAD,CAASC,gBAAc,GACrB5f,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CAAYv0B,UAAWH,EAAQ8mC,WAAYllC,MAAM,UAAU6B,QAASgkC,EAAYnW,aAAW,QACzFt4B,EAAAC,EAAAC,cAACuvC,GAAAxvC,EAAD,OAEFD,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,YAAYqB,MAAM,UAAUzB,UAAWH,EAAQymC,cAAnE,YAMJztC,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQ+mC,kBACtB/tC,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQ2mC,OACxB3tC,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQgnC,iBACtBhuC,EAAAC,EAAAC,cAACklC,GAAA,EAAD,CAAkBj+B,UAAWH,EAAQooB,SAAUxmB,MAAM,UAAUkX,KAAM,IAAKssC,UAAW,KAEvFpsD,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWH,EAAQinC,gBAAiB1mC,QAAQ,MAAxD,cAGAvH,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQ2mC,UC5BnBgb,GACE,SADFA,GAEE,aAFFA,GAGD,WAHCA,GAIA,YAJAA,GAMC,cANDA,GAOK,iBAPLA,GAQA,YAEP0D,GAAkB,CAAC1D,GAAmBA,GAAkBA,IAMxD2D,GAAmB,SAAAxsD,GAMnB,IALJysD,EAKIzsD,EALJysD,SAAUroD,EAKNpE,EALMoE,OAAQlL,EAKd8G,EALc9G,aAA2BwzD,EAKzC1sD,EAL4B+oD,YAChC4D,EAII3sD,EAJJ2sD,cAAeC,EAIX5sD,EAJW4sD,gBAAiBC,EAI5B7sD,EAJ4B6sD,cAAe7gC,EAI3ChsB,EAJ2CgsB,aAC/CxgB,EAGIxL,EAHJwL,SAAUR,EAGNhL,EAHMgL,QAASivB,EAGfj6B,EAHei6B,SAAU6yB,EAGzB9sD,EAHyB8sD,YAAaC,EAGtC/sD,EAHsC+sD,cAC1CC,EAEIhtD,EAFJgtD,WAAYC,EAERjtD,EAFQitD,cAAe7tC,EAEvBpf,EAFuBof,QAAS0vB,EAEhC9uC,EAFgC8uC,YACpCF,EACI5uC,EADJ4uC,QAASC,EACL7uC,EADK6uC,UAAWv5B,EAChBtV,EADgBsV,SAAUy5B,EAC1B/uC,EAD0B+uC,MAC1BnlC,EAG4BC,mBAAS,CACvCzF,SACAlL,eACA0yC,GAAIihB,EAAgB,IAAIK,GAAYP,EAAeC,EAAiBC,GAAiB,OANnF/iD,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAGGujD,EAHHrjD,EAAA,GAGgB6D,EAHhB7D,EAAA,GAAAI,EASoBL,mBAAS,CAC/B3E,QAAS,CACP2T,KAAM4zC,GAAY5D,GAClBuE,IAAKphC,EACL+8B,YAAa2D,GAEf9/B,QAAS,KAfPziB,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GASGuiB,EATHtiB,EAAA,GASS+1C,EATT/1C,EAAA,GAkBJ7E,oBAAU,WACRqI,EAAStU,OAAAuV,EAAA,EAAAvV,CAAA,GAAK8zD,EAAN,CAAmB/oD,YAC3B87C,EAAQ,CACNh7C,QAAS,CACP2T,KAAM4zC,GAAY5D,GAClBuE,IAAKphC,EACL+8B,YAAa2D,GAEf9/B,QAAS,MAEV,CAACxoB,IAGJ,IAAM67C,EAAgB,SAAC9kD,EAAOs5B,GAC5B,IAAMze,EAAS3c,OAAAuV,EAAA,EAAAvV,CAAA,GAAQ8zD,EAAY/oD,QACnC4R,EAAU7C,OAAS6C,EAAU7C,OAAO5E,IAAI,SAAA6E,GAAE,OAAIA,EAAGvZ,KAAO46B,EAAW56B,GAArBR,OAAAuV,EAAA,EAAAvV,CAAA,GAA+B+Z,EAAOqhB,GAAerhB,IACnG25C,EAAc5xD,EAAD9B,OAAAuV,EAAA,EAAAvV,CAAA,GAAao7B,EAAb,CAAyBvhB,SAAU8C,EAAUnc,OAGtDwzD,EAAc,eAAAj/C,EAAA/U,OAAAuc,EAAA,EAAAvc,CAAAwc,EAAA1V,EAAA2V,KAAG,SAAAC,EAAOC,EAAWza,EAAU4tD,GAA5B,OAAAtzC,EAAA1V,EAAAsW,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAErB5a,QAAQC,IAAI,yCAA0C,CAAE+Z,YAAWza,WAAU4tD,iBAFxDzyC,EAAAE,KAAA,EAGfo2C,EAAWzxD,EAAU4tD,GAHN,OAKrBx7C,EAAStU,OAAAuV,EAAA,EAAAvV,CAAA,GACJ8zD,EADG,CAEN/oD,OAAO/K,OAAAuV,EAAA,EAAAvV,CAAA,GACF+K,EADC,CAEJ+O,OAAM,GAAA3X,OAAAnC,OAAAia,GAAA,EAAAja,CAAM+K,EAAO+O,QAAb,CAAqB5X,SAG/B6kD,EAAWyI,GAAsBttD,EAAS1B,IAZrB,wBAAA6c,EAAAY,SAAAvB,MAAH,gBAAAwB,EAAAC,EAAAC,GAAA,OAAArJ,EAAA1O,MAAAtG,KAAA8E,YAAA,GA8BdkiD,EAAa,SAACmK,EAAa+C,EAAQC,GACvC,IAAMC,EAAYL,EAAYvhB,GAAGe,QAAQ,SAAUvoC,EAAQ,UACvC,OAAhB+oD,GAAsBniD,KACrBwiD,GAAajB,GAAgBjwD,QAAQiuD,GAAe,EACvDvuD,QAAQsB,MAAM,2BAA4B,CAAET,KAAM4vB,EAAKvnB,QAASuoD,GAAIlD,EAAaiD,cAIjFtN,EAAQ,CACNh7C,QAAS,CACP2T,KAAM0xC,EACN6C,IAAKE,EACLvE,YAAawE,GAEf3gC,QAAO,GAAApxB,OAAAnC,OAAAia,GAAA,EAAAja,CAAMozB,EAAKG,SAAX,CAAoBH,EAAKvnB,aAIhCwoD,EAAW,WAEf,GAAIjhC,EAAKG,QAAQrwB,OAAS,EAAG,CAC3B,IAAM6uD,EAAU/xD,OAAAia,GAAA,EAAAja,CAAOozB,EAAKG,SACtBy+B,EAAUD,EAAW39B,MAC3ByyB,EAAQ,CACNh7C,QAASmmD,EACTz+B,QAASw+B,SAIXpgD,KASA+U,EAAY,KAEhB,GAAIX,EAAS,OAAOlf,EAAAC,EAAAC,cAACutD,GAAD,CAAehf,WAAY3jC,IAC1C,IAAKmiD,EAAY/oD,QAAUqoB,EAAKvnB,QAAQ2T,OAASgwC,GAAiB,OAAO3oD,EAAAC,EAAAC,cAACwtD,GAAD,CAAgBjf,WAAY3jC,IAE1G,OAAQyhB,EAAKvnB,QAAQ2T,MACnB,KAAKgwC,GACH9oC,EACE7f,EAAAC,EAAAC,cAACytD,GAAD,CAEExf,iBAAkB,kBAAM+R,EAAWyI,KACnCr9C,SAAU,WACRxP,QAAQC,IAAI,6BAEdqZ,SAAUA,EACVy5B,MAAOA,EACP/iB,aAAcA,EACduiB,eA7De,SAACuf,GACtB1pD,EAAO+O,OAAOlZ,OAAO,SAAA8zD,GAAE,OAAID,EAAWxxD,QAAQyxD,EAAGl0D,KAAO,IAAG6gB,QAAQ,SAAA4tB,GAAC,OAAI2kB,EAAc3kB,MA6DhFmG,eAAgBxU,EAChB6U,YAAaA,EACbN,YAAa,kBAAM4R,EAAWyI,GAAgB,KAAM,WACpDva,aAAc,kBAAM8R,EAAWyI,KAC/Bna,aAAc,kBAAM0R,EAAWyI,GAAgB,KAAM,YACrD5d,YA3BU,SAACmiB,GACjBhN,EAAWyI,GAAkBuE,IA2BvBze,WAAY3jC,EACZ4jC,QAASA,EACTC,UAAWA,IAGf,MACF,KAAKga,GACH9oC,EACE7f,EAAAC,EAAAC,cAAC4tD,GAAD,CACErV,SAAU,kBAAMyH,EAAWyI,KAC3BnQ,KAAM,SAAC7kB,GACLroB,EAASpH,EAAD/K,OAAAuV,EAAA,EAAAvV,CAAA,GAAcw6B,EAAd,CAA2Bh6B,GAAIuK,EAAOvK,MAC9CumD,EAAWyI,OAIjB,MACF,KAAKA,GACH9oC,EACE7f,EAAAC,EAAAC,cAAC6tD,GAAD,CACE96C,OAAQg6C,EAAY/oD,OAAO+O,OAC3B6sC,YAAavzB,EAAKvnB,QAAQkoD,IAC1Bze,WAAY+e,EACZzN,cAAeA,IAGnB,MACF,KAAK4I,GACH9oC,EACE7f,EAAAC,EAAAC,cAAC6tD,GAAD,CACE96C,OAAQg6C,EAAY/oD,OAAO+O,OAC3B6sC,YAAavzB,EAAKvnB,QAAQkoD,IAC1B7xD,UAAQ,EACRozC,WAAY,kBAAMyR,EAAWyI,KAC7B5I,cAAeA,IAGnB,MACF,KAAK4I,GACH9oC,EACE7f,EAAAC,EAAAC,cAAC8tD,GAAD,CAAW/6C,OAAQg6C,EAAY/oD,OAAO+O,OAAQwlC,SAAU+U,IAE1D,MACF,KAAK7E,GACH9oC,EACE7f,EAAAC,EAAAC,cAAC+tD,GAAD,CACEpF,YAAat8B,EAAKvnB,QAAQ6jD,YAC1B51C,OAAQ/O,EAASA,EAAO+O,OAAS,KACjC61C,SAAUqE,EACV1U,SAAU+U,IAGd,MACF,KAAK7E,GACH9oC,EACE7f,EAAAC,EAAAC,cAAC+tD,GAAD,CACEpF,YAAat8B,EAAKvnB,QAAQ6jD,YAC1BE,aAAW,EACXD,SAAU8D,EACVnU,SAAU+U,IAGd,MACF,QACE1xD,QAAQC,IAAI,4DAA6DkxD,GACzEptC,EAAY,KAGhB,OACE7f,EAAAC,EAAAC,cAACg1B,GAAcg5B,SAAf,CAAwB1iD,MAAOyhD,GAC5BptC,IAiCPysC,GAAiB/xB,aAAe,CAC9BhO,KAAMo8B,IAGO2D,UC5DT6B,GAAuB/gD,YAAQvK,GAAgB,CACnD+E,MAAO,SAAAu2C,GAAc,IAAXhwC,EAAWgwC,EAAXhwC,KACJA,EAAK/Q,OAAOtB,QAAQsB,MAAM+Q,EAAK/Q,OACnCtB,QAAQC,IAAI,oBAAqB,CAAEoS,SACnC,IAAIjK,EAAS,KACb,IACOiK,EAAK+Q,SAAY/Q,EAAK/Q,QAAO8G,EAASiK,EAAKjK,QAElD,MAAO/G,GACLrB,QAAQC,IAAI,yBAA0B,CAAEoS,OAAMhR,MAC9CrB,QAAQsB,MAAMD,GAEhB,MAAO,CACLgR,OACA+Q,QAAS/Q,EAAK+Q,QACdhb,WAGJstB,KAAM,SAAA4sB,GAAA,IAAG5wB,EAAH4wB,EAAG5wB,aAAcu7B,EAAjB3K,EAAiB2K,YAAjB,OAAoCv7B,GAAgBu7B,GAC1Dn3B,QAAS,SAAAysB,GAAA,MAAuB,CAC9BtwC,UAAW,CACTpU,GAFK0kD,EAAG7wB,kBAUR4gC,GAAsB7/B,YAC1B4/B,GACAzhD,GAAa6I,aACbhJ,GAAYgJ,aACZtJ,GAAasJ,aACbnJ,GAAYmJ,aACZxJ,GAAawJ,aACb1J,GAAY0J,aACZuf,GAAMvf,aACN0f,GAAQ1f,aATkBgZ,CAxNN,SAAAzuB,GAQhB,IAPJoE,EAOIpE,EAPJoE,OAAQgb,EAOJpf,EAPIof,QAASvN,EAOb7R,EAPa6R,OAAQ6b,EAOrB1tB,EAPqB0tB,aAAc1B,EAOnChsB,EAPmCgsB,aACvCuiC,EAMIvuD,EANJuuD,oBAAqBC,EAMjBxuD,EANiBwuD,OAAQC,EAMzBzuD,EANyByuD,YAC7B/4C,EAKI1V,EALJ0V,qBAAsBye,EAKlBn0B,EALkBm0B,oBACtBR,EAII3zB,EAJJ2zB,qBAAsBY,EAIlBv0B,EAJkBu0B,oBACtBf,EAGIxzB,EAHJwzB,qBAAsBQ,EAGlBh0B,EAHkBg0B,oBACtBc,EAEI90B,EAFJ80B,oBAAqBG,EAEjBj1B,EAFiBi1B,sBACrB6Z,EACI9uC,EADJ8uC,YACIzS,EAC8EhK,qBAAWztB,IAArFg+C,EADJvmB,EACIumB,KAAM8L,EADVryB,EACUqyB,YAAar5C,EADvBgnB,EACuBhnB,KAAMkN,EAD7B8Z,EAC6B9Z,SAAUkF,EADvC4U,EACuC5U,MAAOqT,EAD9CuB,EAC8CvB,cAAe6K,EAD7DtJ,EAC6DsJ,aAC7DojB,EAAc,SAEdl3C,IAAWhO,GAAKwM,cAAcO,kBACrBm4C,EAAPthC,EAAqBknC,GACNA,GAEZ98C,IAAWhO,GAAKwM,cAAcQ,qBAAoBk4C,EAAc4F,IAGzE,IAAIlC,EAAW5D,GACXh3C,IAAWhO,GAAKwM,cAAcK,SAAQ+7C,EAAW5D,IAGrD,IAAM3vD,EAAe,CACnBqB,KAAM,GACNb,KAAM,CACJ,CACEG,GAAI,eACJgS,MAAO,KACP/C,MAAO4G,GAAU,GACjBxV,SAAS,EACTE,YAAY,EACZwmC,gBAAgB,EAEhBguB,UAAW,kBAAMt0C,QAAQC,QAAQ,CAAC,IAAK,IAAK,OAC5ClB,YACAgkB,OAAQ,KAGZvC,gBACA6K,eACAle,SAGEsnB,GAAQ,EACZ,IACEA,EAAQ15B,EAAKxb,KAAOuK,EAAO2T,YAAYle,GAEzC,MAAOwD,IAGP,OAFArB,QAAQC,IAAI,kBAAmB,CAAEyxB,eAActpB,SAAQgb,UAAS2vB,QAAO15B,SAGrEnV,EAAAC,EAAAC,cAAC+G,GAAA,EAAD,CAAepB,MAAOrB,GAAON,QAC3BlE,EAAAC,EAAAC,cAACyuD,GAAD,CACEpC,SAAUA,EACV1D,YAAaA,EAEbha,MAAOA,EACPz5B,SAAUiN,GAAYlN,GAAQA,EAAKC,UAAYD,EAAKC,SAAShZ,QAAQoxB,IAAiB,EAGtFi/B,cAAepqC,EAAWmsC,EAAY1C,WAAWG,IAAM,KACvDS,gBAAiBhK,EACjBiK,cAAel6B,GACfvT,QAASA,EACThb,OAAQA,EACR4nB,aAAcA,EACd9yB,aAAcA,EAGd8zD,WAAU,eAAA5+C,EAAA/U,OAAAuc,EAAA,EAAAvc,CAAAwc,EAAA1V,EAAA2V,KAAE,SAAAC,EAAOxa,EAAU4tD,GAAjB,OAAAtzC,EAAA1V,EAAAsW,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cACV5a,QAAQC,IAAI,eAAgB,CAAEmI,SAAQ7I,WAAU4tD,iBADtCzyC,EAAAE,KAAA,EAGJyC,GAASQ,QAAQte,EAASG,YAAaytD,GAHnC,cAAAzyC,EAAAO,OAAA,SAIHkd,EAAoB/vB,EAAQ7I,EAAU4tD,EAAalzC,KACvDmB,KAAK,SAAAO,GAAc,IAAXtJ,EAAWsJ,EAAXtJ,KAEDlT,EAAQkT,EAAK5B,YAAYtR,MAC/B,GAAIkT,EAAK5B,YAAYwM,QAAS,CAC5B,IAAMA,EAAU5d,KAAKyB,MAAMuR,EAAK5B,YAAYwM,SAE5Cw1C,EAAY,CACV50D,GAAIsB,EAAMtB,GACV6B,YAAaP,EAAMO,YACnBwX,SAAU/X,EAAM+X,SAChB+F,UACAhD,IAAKkzC,EAAalzC,IAClB0G,MAAO,OAIZgH,MAAM,SAAA5mB,GACLf,QAAQC,IAAI,6BAA8Bc,EAAIqM,OAC9CpN,QAAQsB,MAAMP,MAvBR,wBAAA2Z,EAAAY,SAAAvB,MAAF,gBAAAwB,EAAAC,GAAA,OAAApJ,EAAA1O,MAAAtG,KAAA8E,YAAA,GA0BV6uD,cAAe,SAAC5xD,EAAOs5B,GAAR,OAAuBF,EAAoBp5B,EAAOs5B,GAC9D9Q,MAAM,SAAA5mB,GACLf,QAAQC,IAAI,gCAAiCc,EAAIqM,OACjDpN,QAAQsB,MAAMP,MAGlBkwD,cAAe,SAAC9xD,GAAD,OAAW64B,EAAoB74B,EAAMtB,IACjDud,KAAK,WAAa,QAAAlY,EAAAhB,UAAA3B,OAAT8R,EAAS,IAAAjP,MAAAF,GAAAG,EAAA,EAAAA,EAAAH,EAAAG,IAATgP,EAAShP,GAAAnB,UAAAmB,GACjBrD,QAAQC,IAAI,gCAAiCoS,KAE9CsV,MAAM,SAAA5mB,GACLf,QAAQC,IAAI,gCAAiCc,EAAIqM,OACjDpN,QAAQsB,MAAMP,MAGlByO,SAAU,SAACpH,EAAQyvB,GAAT,OAAyBF,EAAqBvvB,EAAQyvB,GAC7DlQ,MAAM,SAAA5mB,GACLf,QAAQC,IAAI,2BAA4Bc,EAAIqM,OAC5CpN,QAAQsB,MAAMP,MAGlB+vD,YAAW,eAAA/6B,EAAA14B,OAAAuc,EAAA,EAAAvc,CAAAwc,EAAA1V,EAAA2V,KAAE,SAAAyG,EAAOvG,EAAWza,EAAU4tD,GAA5B,OAAAtzC,EAAA1V,EAAAsW,KAAA,SAAAoG,GAAA,cAAAA,EAAAlG,KAAAkG,EAAAjG,MAAA,cACX5a,QAAQC,IAAI,wCAAyC,CAAE+Z,YAAWza,WAAU4tD,iBADjEtsC,EAAAjG,KAAA,EAELyC,GAASQ,QAAQte,EAASG,YAAaytD,GAFlC,cAAAtsC,EAAA5F,OAAA,SAGJvB,EAAqBM,EAAWza,EAAU4tD,EAAalzC,KAC3DmB,KADI,eAAAmrB,EAAAlpC,OAAAuc,EAAA,EAAAvc,CAAAwc,EAAA1V,EAAA2V,KACC,SAAAoH,EAAA+kB,GAAA,IAAA5zB,EAAAlT,EAAA8d,EAAA,OAAApD,EAAA1V,EAAAsW,KAAA,SAAA6G,GAAA,cAAAA,EAAA3G,KAAA2G,EAAA1G,MAAA,QAASvI,EAAT4zB,EAAS5zB,MACJzB,aAAaqM,UAEd9d,EAAQkT,EAAKzB,aAAaxI,OAAO+O,OAAO,GACxC8F,EAAU5d,KAAKyB,MAAMuR,EAAKzB,aAAaqM,SAE7Cw1C,EAAY,CACV50D,GAAIsB,EAAMtB,GACV6B,YAAaP,EAAMO,YACnBwX,SAAU/X,EAAM+X,SAChB+F,UACAhD,IAAKkzC,EAAalzC,IAClB0G,MAAO,KAZP,wBAAAW,EAAAhG,SAAA4F,MADD,gBAAA4xC,GAAA,OAAAvsB,EAAA7iC,MAAAtG,KAAA8E,YAAA,IAiBJylB,MAAM,SAAA5mB,GACLf,QAAQC,IAAI,8BAA+Bc,EAAIqM,OAC/CpN,QAAQsB,MAAMP,MAtBP,wBAAA8f,EAAAvF,SAAAiF,MAAF,gBAAA9E,EAAA8a,EAAAw8B,GAAA,OAAAh9B,EAAAryB,MAAAtG,KAAA8E,YAAA,GAyBX+7B,SAAU,WAER,OADAs0B,IACO/6B,IACJ7P,MAAM,SAAA5mB,GACLf,QAAQC,IAAI,2BAA4Bc,EAAIqM,OAC5CpN,QAAQsB,MAAMP,MAGpBiO,QAASwjD,EACT1f,YAAaA,EACbF,QAASrsB,EAAWuS,EAAsB,KAC1C+Z,UAAWtsB,EAAW0S,EAAwB,UAuGvC3mB,gBAzBS,SAACnG,EAAOL,GAAU,IAAAknD,EACoB7mD,EAAMtE,KAA1DqB,QACR,MAAO,CAAEwoB,aAF+BshC,EACrBthC,aACI1B,aAFiBgjC,EACPhjC,aACIna,OAFGm9C,EACOn9C,SAItB,SAAAqgB,GAAQ,MAAK,CACtCs8B,OAAQ,WACNt8B,EAASpG,OAEXyiC,oBAAqB,WACnBvyD,QAAQC,IAAI,uBACZi2B,EAASpG,GAAqBjoB,GAAKwM,cAAcC,KAAM,CAAEod,aAAc,SAEzE+gC,YAAa,SAACniC,GACZ4F,EAASpG,GAAoBQ,KAE/BnV,mBAAoB,SAACuW,GACnB1xB,QAAQC,IAAI,qBAAsByxB,GAClCwE,EAASpG,GAAqBjoB,GAAKwM,cAAcK,OAAQ,CAAEgd,mBAE7DohB,YAAa,WACX5c,EAASpG,GAAqBjoB,GAAKwM,cAAcE,SAItCjC,CAGbggD,kCCvPaW,GA9BU,SAAC5gD,EAAM6gD,EAAcC,EAAahjC,EAAUijC,EAAWC,EAAc9a,GAAoB,IAAA3qC,EACtEC,mBAAS,IAD6DC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GACzG0lD,EADyGxlD,EAAA,GAC1FylD,EAD0FzlD,EAAA,GAAAI,EAExEL,mBAAS,CAAE2lD,OAAQ,GAAIC,QAAS,KAFwCtlD,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAEzGwlD,EAFyGvlD,EAAA,GAE3FwlD,EAF2FxlD,EAAA,GAAAuR,EAGlF7R,mBAAS,GAHyE8R,EAAAtiB,OAAA0Q,GAAA,EAAA1Q,CAAAqiB,EAAA,GAGzGy1B,EAHyGx1B,EAAA,GAGhGi0C,EAHgGj0C,EAAA,GAM1Gk0C,EAAqBnkC,sBAAYjtB,aAAQpF,OAAAuc,EAAA,EAAAvc,CAAAwc,EAAA1V,EAAA2V,KAAC,SAAAC,IAAA,IAAA+5C,EAAAC,EAAA7xD,UAAA,OAAA2X,EAAA1V,EAAAsW,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAAAF,EAAAE,KAAA,EACpBo5C,GAAUtwD,WAAV,EAAAqwD,GADoB,OACxCD,EADwCp5C,EAAAM,KAE9Cu4C,EAAiBO,GAEjBF,EAAWze,EAAU,GAJyB,wBAAAz6B,EAAAY,SAAAvB,MAK7C,KAAO,IAEJk6C,EAAqBvkC,sBAAYjtB,aAAQpF,OAAAuc,EAAA,EAAAvc,CAAAwc,EAAA1V,EAAA2V,KAAC,SAAAoH,IAAA,IAAAgzC,EAAAC,EAAAjyD,UAAA,OAAA2X,EAAA1V,EAAAsW,KAAA,SAAA6G,GAAA,cAAAA,EAAA3G,KAAA2G,EAAA1G,MAAA,cAAA0G,EAAA1G,KAAA,EACvBw5C,GAAU1wD,WAAV,EAAAywD,GADuB,OACxCD,EADwC5yC,EAAAtG,KAE9C24C,EAAgBO,GAF8B,wBAAA5yC,EAAAhG,SAAA4F,MAG7C,KAAM,IAWT,OARA5X,oBAAU,WACRuqD,EAAmBxhD,EAAM+gD,EAAWjjC,IACnC,CAAC9d,EAAK9R,OAAQ8yD,IAEjB/pD,oBAAU,WACHivC,GAAiB0b,EAAmBX,EAAeJ,EAAcC,IACrE,CAACG,EAAeH,EAAaD,EAAc/d,EAASoD,IAEhD,CAAE8b,sBAAuBX,IAS5BM,GAAa,SAAC3hD,EAAM+gD,EAAWjjC,GAGnC,IAAK9d,EACH,MAAO,GAET,IAAMiiD,EAAOC,KAAM,EAAG,CAAC,KAAM,KAAM,KAAM,OAEnCt5B,EAAY,IAAIue,KAAJn8C,OAAAuV,EAAA,EAAAvV,CAAA,GACb8yB,EADa,CAEhBO,KAAM,KAKFlwB,EAAU6R,EAAKE,IAAI,SAAA+5B,GAEvB,IAAIkoB,EAAe,CAAC,EAAG,GACvB,IACEA,EAAev5B,EAAUw5B,QAAQnoB,EAAEjwB,QAErC,MAAOhb,GACLrB,QAAQsB,MAAMD,GAE+BirC,EAAvCxhB,UAAuCwhB,EAA5BzhB,SATS,IASI6pC,EATJr3D,OAAAqV,EAAA,EAAArV,CASmBivC,EATnB,0BAU5B,MAAO,CACLpS,EAAGs6B,EAAa,GAChBr6B,EAAGq6B,EAAa,GAChBz3C,WAAY23C,EAAW33C,WACvB43C,WAAY,GACZC,QAAStoB,EAAEjwB,OAASw4C,iBAAMvoB,EAAEjwB,OAAHhf,OAAAuV,EAAA,EAAAvV,CAAA,GAAgBq3D,IAAgB,QAI7DJ,EAAKQ,QACLR,EAAKS,KAAKv0D,GAEV,IArCgD,IAAAw0D,EAAA,SAqCvCC,GACP,IAAMC,EAAS9B,EAAYz+B,KAAKwgC,KAAK,GAAKxgC,KAAKygC,IAAI,EAAGH,GAGtDz0D,EAAQke,QAAQ,SAAA4tB,GACd,QAAwBnqC,IAApBmqC,EAAEqoB,WAAWM,GAAkB,KAEzB/6B,EAASoS,EAATpS,EAAGC,EAAMmS,EAANnS,EAGLk7B,EAAYf,EACfgB,OAAO,CACNC,KAAMr7B,EAAIg7B,EACVM,KAAMr7B,EAAI+6B,EACVO,KAAMv7B,EAAIg7B,EACVQ,KAAMv7B,EAAI+6B,IAEXj3D,OAAO,SAAA03D,GAAQ,YAA+BxzD,IAA3BwzD,EAAShB,WAAWM,KAG1CI,EAAU32C,QAAQ,SAAAi3C,GAChB,GAAIA,IAAarpB,EAAG,CAClB,IAAMspB,EAAkC,IAArBP,EAAU90D,OACzB+rC,EAAEsoB,QACFiB,oBAASC,6BAAkBT,EAAU9iD,IAAI,SAAAxQ,GAAC,OAAIA,EAAE6yD,YAEpDgB,EAAWlB,WAAXr3D,OAAAuV,EAAA,EAAAvV,CAAA,GACKu4D,EAAWlB,WADhB,CAEE72D,GAAI+3D,EAAWlB,WAAW72D,IAAMk4D,OAChCn1B,MAAOy0B,EAAU90D,OACjBy1D,kBAAmBX,EAAU32D,OAAO,SAACC,EAADo3B,GAAA,IAAQhZ,EAARgZ,EAAQhZ,WAAR,OAAyBA,EAAape,EAAMoe,EAAape,GAAK,GAClGs3D,OAAQZ,EAAU9iD,IAAI,SAAAxQ,GAAC,OAAIA,EAAE6yD,YAE/BtoB,EAAEqoB,WAAWM,GAAKW,OAGlBD,EAAShB,WAAWM,GAAK,WApC1BA,EAAI,EAAGA,GAAK,GAAIA,IAAKD,EAArBC,GA4CT,OAAOz0D,EAAQ+R,IAAI,SAAAoJ,GAAA,OAAAA,EAAGg5C,cAGxB,SAASP,GAAYd,EAAeJ,EAAcgD,GAGhD,OAAO5C,EAEJr1D,OAAO,SAAAuD,GAAC,QAAMA,EAAE00D,KAEhBx3D,OAAO,SAACC,EAAKg2D,GACZ,IAAMC,EAAUD,EAAWuB,GACrB75C,EAASu4C,EAAQuB,SAASC,YACxBx1B,EAAUg0B,EAAQF,WAAlB9zB,MASR,QAPKsyB,GAAgBA,EAAa3yD,OAAS,GACzC2yD,EAAa,GAAK72C,EAAO,IAAM62C,EAAa,GAAK72C,EAAO,IACxD62C,EAAa,GAAK72C,EAAO,IAAM62C,EAAa,GAAK72C,EAAO,MAEpDukB,EAAQ,EAAGjiC,EAAI80D,QAAQ4C,KAAKzB,GAC3Bj2D,EAAI60D,OAAO6C,KAAKzB,IAEhBj2D,GACN,CACD60D,OAAQ,GACRC,QAAS,KCrJA,ICGA7pD,QACb1F,EAAAC,EAAAC,cAACF,EAAAC,EAAMwF,SAAP,KACEzF,EAAAC,EAAAC,cAAA,QAAM5C,EAAE,mIACR0C,EAAAC,EAAAC,cAAA,QAAM5C,EAAE,sIACR0C,EAAAC,EAAAC,cAAA,QAAM5C,EAAE,qIACR0C,EAAAC,EAAAC,cAAA,QAAM5C,EAAE,0IACR0C,EAAAC,EAAAC,cAAA,QAAM5C,EAAE,wIACR0C,EAAAC,EAAAC,cAAA,QAAM5C,EAAE,0IACS,iBCNrB80D,GAAe1sD,IAAf,CACE1F,EAAAC,EAAAC,cAACF,EAAAC,EAAMwF,SAAP,KACEzF,EAAAC,EAAAC,cAAA,QAAM5C,EAAE,uoCACS,SCoBfqI,GAAYC,aAfJ,SAAAC,GAAK,MAAK,CACtBC,KAAM,GAGNiD,KAAM,CACJhD,OAAQ,GACRtC,MAAO,OACPF,OAAQ,SACRqF,MAAO/C,EAAMjC,QAAQxG,MAAM0G,MAE7BqxB,MAAO,MA6CMk9B,GAtCS,SAAAvyD,GAA6C,IAA1Cq1B,EAA0Cr1B,EAA1Cq1B,MAAO1tB,EAAmC3H,EAAnC2H,QAASqD,EAA0BhL,EAA1BgL,QAASF,EAAiB9K,EAAjB8K,KAAM7B,EAAWjJ,EAAXiJ,KAClD/B,EAAUrB,KACV2sD,EAAWvpD,GAAQwpD,GACzB,OACEvyD,EAAAC,EAAAC,cAACyK,GAAA,EAAD,CACExD,UAAWH,EAAQlB,KACnB+E,WAAS,EACTD,KAAMA,EACN4nD,WAAY,CAAErjD,MAAO,CAAExI,SAAU,SACjCwjC,sBAAoB,EACpBxjC,SAAS,KACToE,kBAAgB,6BAEhB/K,EAAAC,EAAAC,cAAC8K,GAAA,EAAD,CAAarR,GAAG,4BAA4BwN,UAAWH,EAAQmuB,OAAQA,GACvEn1B,EAAAC,EAAAC,cAAC+K,GAAA,EAAD,KACEjL,EAAAC,EAAAC,cAACoyD,EAAD,CAAUnrD,UAAWH,EAAQ+B,OAC7B/I,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYuY,UAAU,OACnBpY,IAILzH,EAAAC,EAAAC,cAAC0L,GAAA,EAAD,KACE5L,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQC,QAASK,EAASlC,MAAM,WAAhC,6FC/BFjD,GAAYC,aAAW,SAAAC,GAAK,MAAK,CACrC4sD,YAAa,CACXhvD,MAAO,IACPmD,QAAS,OACTC,cAAe,SACfd,OAAQ,QAEV2sD,gBAAiB,CACf9pD,MAAO,uBAETm3B,OAAQ,CACNh6B,OAAQF,EAAM8C,QAAQ,GACtBlF,MAAOoC,EAAM8C,QAAQ,GACrBE,OAAM,aAAAvN,OAAeuK,EAAMjC,QAAQC,QAAQC,MAC3CP,OAAQsC,EAAM8C,QAAQ,EAAG,IAE3B8xB,YAAa,CACXh3B,MAAO,QAET4C,OAAQ,CACN4C,SAAU,GAEZ0pD,SAAU,CACRlvD,MAAO,WAyGImvD,GArGI,SAAA9yD,GAA8D,IAA3D8K,EAA2D9K,EAA3D8K,KAAM23C,EAAqDziD,EAArDyiD,OAAQz3C,EAA6ChL,EAA7CgL,QAAS+nD,EAAoC/yD,EAApC+yD,gBAAiBC,EAAmBhzD,EAAnBgzD,aACtD9rD,EAAUrB,KAD+Dw2B,EAEyBhK,qBAAWztB,IAA3G8e,EAFuE2Y,EAEvE3Y,QAASnB,EAF8D8Z,EAE9D9Z,SAAUqB,EAFoDyY,EAEpDzY,YAAavO,EAFuCgnB,EAEvChnB,KAAM49C,EAFiC52B,EAEjC42B,UAAWppC,EAFsBwS,EAEtBxS,gBAAiBqpC,EAFK72B,EAEL62B,mBAAoBzrC,EAFf4U,EAEe5U,MAC9F,OACEvnB,EAAAC,EAAAC,cAACkiD,GAAA,EAAD,CACEx3C,KAAMA,EACNE,QAASA,EACTy3C,OAAQA,GAERviD,EAAAC,EAAAC,cAAA,OACEiH,UAAWH,EAAQyrD,YACnB/P,KAAK,eACLj4C,QAASK,EACT63C,UAAW73C,GAEVqK,GAAQA,EAAKgB,UACZnW,EAAAC,EAAAC,cAAC28B,GAAA,EAAD,KACE78B,EAAAC,EAAAC,cAAC26B,GAAA,EAAD,CAAU1zB,UAAWH,EAAQlB,KAAM2E,QAAS,aAAUmV,gBAAc,GAClE5f,EAAAC,EAAAC,cAAC66B,GAAA,EAAD,CAAQ5zB,UAAWH,EAAQ+4B,QACxB1d,GAAYlN,EACTnV,EAAAC,EAAAC,cAAA,OAAK86B,IAAI,UAAU7zB,UAAWH,EAAQyzB,YAAaQ,IAAK9lB,EAAKc,WAC7DjW,EAAAC,EAAAC,cAAC+yD,GAAAhzD,EAAD,CAAmB2I,MAAM,UAAUzB,UAAWH,EAAQksD,gBAI9DlzD,EAAAC,EAAAC,cAAC26B,GAAA,EAAD,CAAU1zB,UAAWH,EAAQlB,KAAM2E,QAAS,cAC1CzK,EAAAC,EAAAC,cAACo5B,GAAA,EAAD,CACEz1B,QAASsR,EAAKgB,aAMtBnW,EAAAC,EAAAC,cAACi5B,GAAA,EAAD,MACAn5B,EAAAC,EAAAC,cAAC28B,GAAA,EAAD,KACE78B,EAAAC,EAAAC,cAAC26B,GAAA,EAAD,CACE1zB,UAAWogB,EAAQvgB,EAAQ0rD,gBAAkB,KAC7C5pD,QAAM,EACN2B,QAAS8c,EAAQsrC,EAAkBE,GAEnC/yD,EAAAC,EAAAC,cAACm5B,GAAA,EAAD,KACEr5B,EAAAC,EAAAC,cAAC01B,GAAD,OAEF51B,EAAAC,EAAAC,cAACo5B,GAAA,EAAD,CAAcz1B,QAAS,kBAExB8lB,GACC3pB,EAAAC,EAAAC,cAAC26B,GAAA,EAAD,CAAU/xB,QAAM,EAAC2B,QAASkf,GACxB3pB,EAAAC,EAAAC,cAACm5B,GAAA,EAAD,KACEr5B,EAAAC,EAAAC,cAACizD,GAAAlzD,EAAD,OAEFD,EAAAC,EAAAC,cAACo5B,GAAA,EAAD,CAAcz1B,QAAS,mBAAoBE,UAAW,sBAG1D/D,EAAAC,EAAAC,cAAC26B,GAAA,EAAD,CAAU/xB,QAAM,EAAC2B,QAASuoD,GACxBhzD,EAAAC,EAAAC,cAACm5B,GAAA,EAAD,KACEr5B,EAAAC,EAAAC,cAACkzD,GAAAnzD,EAAD,OAEFD,EAAAC,EAAAC,cAACo5B,GAAA,EAAD,CAAcz1B,QAAS,uBAG3B7D,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQX,SACxBrG,EAAAC,EAAAC,cAACi5B,GAAA,EAAD,MACAn5B,EAAAC,EAAAC,cAAC28B,GAAA,EAAD,KACE78B,EAAAC,EAAAC,cAAC26B,GAAA,EAAD,CAAU/xB,QAAM,EAAC2B,QAASqoD,GACxB9yD,EAAAC,EAAAC,cAACm5B,GAAA,EAAD,KACEr5B,EAAAC,EAAAC,cAACogD,GAAArgD,EAAD,OAEFD,EAAAC,EAAAC,cAACo5B,GAAA,EAAD,CAAcz1B,QAAS,WAExBwe,EAEGriB,EAAAC,EAAAC,cAAC26B,GAAA,EAAD,CAAU/xB,QAAM,EAAC2B,QAAS+Y,GACxBxjB,EAAAC,EAAAC,cAACm5B,GAAA,EAAD,KACEr5B,EAAAC,EAAAC,cAACmzD,GAAApzD,EAAD,OAEFD,EAAAC,EAAAC,cAACo5B,GAAA,EAAD,CAAcz1B,QAAS,cAIzB7D,EAAAC,EAAAC,cAAC26B,GAAA,EAAD,CAAU/xB,QAAM,EAAC2B,QAASiZ,GACxB1jB,EAAAC,EAAAC,cAACm5B,GAAA,EAAD,KACEr5B,EAAAC,EAAAC,cAAC+yD,GAAAhzD,EAAD,OAEFD,EAAAC,EAAAC,cAACo5B,GAAA,EAAD,CAAcz1B,QAAS,iDClEjC8B,GAAYC,aAlDJ,SAAAC,GAAK,MAAK,CACtBC,KAAM,GAGNwtD,cAAe,CACb1sD,QAAS,OACTC,cAAe,SACf4B,SAAU,SACV1C,OAAQ,QAEVwtD,cAAe,CACbjtD,KAAM,UACNQ,UAAW,SACX4B,QAAS7C,EAAM8C,QAAQ,EAAG,EAAG,EAAG,IAElCI,KAAM,CACJhD,OAAQ,IACRxC,OAAQ,SACRsF,OAAM,aAAAvN,OAAeuK,EAAMjC,QAAQ8+B,KAAK,MACxCn+B,WAAYsB,EAAMjC,QAAQ8+B,KAAK,KAC/BjkB,aAAc,MAEd+0C,SAAU,CACR/hB,KAAM,oCAGVtc,MAAO,CACLruB,UAAW,UAEb2sD,MAAO,CACLC,UAAW7tD,EAAMjC,QAAQC,QAAQC,MAEnC6vD,MAAO,CACLD,UAAW7tD,EAAMjC,QAAQG,UAAUD,MAErCuC,OAAQ,CACNC,KAAM,OAERstD,WAAY,CACVn6B,YAAa5zB,EAAM8C,QAAQ,IAE7BkrD,WAAY,CACVvtD,KAAM,UACNwtD,UAAW,SACXzmB,UAAW,SACXhkC,WAAY,WACZ8xB,cAAet1B,EAAM8C,QAAQ,OA2FlBorD,GArFE,SAAAj0D,GAAuB,IAApBgL,EAAoBhL,EAApBgL,QAASF,EAAW9K,EAAX8K,KACrB5D,EAAUrB,KAChB,OACE3F,EAAAC,EAAAC,cAACyK,GAAA,EAAD,CACExD,UAAWH,EAAQlB,KACnB+E,WAAS,EACTD,KAAMA,EACN4nD,WAAY,CACVrjD,MAAO,IAQTg7B,sBAAoB,EACpBxjC,SAAS,KACToE,kBAAgB,6BAEhB/K,EAAAC,EAAAC,cAAC+K,GAAA,EAAD,CAAe9D,UAAWH,EAAQssD,eAChCtzD,EAAAC,EAAAC,cAAC8zD,GAAA,EAAD,CAAWrtD,SAAS,MAClB3G,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQusD,eACtBvzD,EAAAC,EAAAC,cAAA,OACEiH,UAAWH,EAAQ+B,KACnBkrD,UAAU,QACV/iB,QAAQ,YACRgjB,cAAY,OACZxR,KAAK,gBAEJl9C,IAEHxF,EAAAC,EAAAC,cAAA,OAAKiP,MAAO,CAAE1L,MAAO,EAAGsC,OAAQ,EAAGE,SAAU,YAAciuD,cAAY,OAAOD,UAAU,SACtFj0D,EAAAC,EAAAC,cAAA,kBAAgBvG,GAAG,mBAAmBw6D,GAAG,IAAIC,GAAG,KAC9Cp0D,EAAAC,EAAAC,cAAA,QAAMs1C,OAAO,KAAKke,UAAU,UAAUvsD,UAAWH,EAAQysD,QACzDzzD,EAAAC,EAAAC,cAAA,QAAMs1C,OAAO,OAAOke,UAAU,UAAUvsD,UAAWH,EAAQ2sD,WAIjE3zD,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQmuB,OACtBn1B,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYuY,UAAU,MAAMtY,QAAQ,MAApC,YAGAvH,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYuY,UAAU,MAAMtY,QAAQ,WAApC,atHtFWsG,UsHsFX,IACkB7N,EAAAC,EAAAC,cAAA,oBAGpBF,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWH,EAAQ6sD,WAAYh0C,UAAU,MAAMtY,QAAQ,YAYnEvH,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQX,SACxBrG,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CACEK,WAAS,EACTwpD,KAAI,UAAA/4D,OtHxGOuS,+BsHyGXjF,MAAM,UACNrB,QAAQ,YAERvH,EAAAC,EAAAC,cAACo0D,GAAAr0D,EAAD,CAAWkH,UAAWH,EAAQ4sD,aANhC,kBAWJ5zD,EAAAC,EAAAC,cAAC0L,GAAA,EAAD,KACE5L,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQC,QAASK,EAASlC,MAAM,WAAhC,YCpEFjD,GAAYC,aAlDJ,SAAAC,GAAK,MAAK,CACtBC,KAAM,CACJc,QAAS,OACT05B,WAAY,SACZ78B,MAAO,OACPiF,QAAS7C,EAAM8C,QAAQ,EAAG,GAC1BkzB,gBAAiBh2B,EAAMjC,QAAQC,QAAQC,KACvC8E,MAAO/C,EAAMjC,QAAQC,QAAQikB,aAC7BysC,aAAY,aAAAj5D,OAAeuK,EAAMjC,QAAQC,SACzCU,WAAU,0BAAAjJ,OAA4BuK,EAAMjC,QAAQG,UAAUD,KAApD,SAAAxI,OAAgEuK,EAAMjC,QAAQC,QAAQC,KAAtF,WAEZ0wD,WAAY,CACVxrD,QAAS,GACTywB,YAAa5zB,EAAM8C,QAAQ,IAE7B8rD,YAAa,CACX54B,gBAAiB,cACjBt3B,WAAY,OACZqE,MAAO/C,EAAMjC,QAAQI,KAAKH,SAG5B6wD,QAAS,CACP9rD,MAAO,uBAETrC,KAAM,CACJmC,QAAS7C,EAAM8C,QAAQ,EAAG,GAC1B5C,OAAQ,GACRtC,MAAO,IAETkxD,gBAAiB,CACfpwD,WAAU,0BAAAjJ,OAA4BuK,EAAMjC,QAAQG,UAAUD,KAApD,SAAAxI,OAAgEuK,EAAMjC,QAAQC,QAAQC,KAAtF,UACV4E,QAAS7C,EAAM8C,QAAQ,GAAK,KAE9BisD,oBAAqB,CACnBhsD,MAAO,QACP7C,OAAQ,GACRtC,MAAO,IAET1D,SAAU,CACRkJ,SAAU,EACVP,QAAS7C,EAAM8C,QAAQ,EAAG,IAE5BksD,SAAU,CACRnsD,QAAS7C,EAAM8C,QAAQ,EAAG,IAE5BmsD,oBAAqB,CACnBvwD,WAAY,QACZmE,QAAS7C,EAAM8C,QAAQ,GAAK,QAK1BizB,GACW,gBADXA,GAEM,WAGNm5B,GAAS,SAAAj1D,GAAiE,IAA9DqH,EAA8DrH,EAA9DqH,UAAWpH,EAAmDD,EAAnDC,SAAUi1D,EAAyCl1D,EAAzCk1D,cAA0BC,GAAen1D,EAA1Bk5B,UAA0Bl5B,EAAfm1D,UACzDjuD,EAAUrB,KAD8D+D,EAE1CC,oBAAS,GAFiCC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAEvE6lC,EAFuE3lC,EAAA,GAE3DG,EAF2DH,EAAA,GAAAI,EAG1CL,oBAAS,GAHiCM,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAGvE83C,EAHuE73C,EAAA,GAG3D83C,EAH2D93C,EAAA,GAAAkyB,EAIjDhK,qBAAWztB,IAAhCquD,EAJsE52B,EAItE42B,UAAWxrC,EAJ2D4U,EAI3D5U,MAEnB,OACEvnB,EAAAC,EAAAC,cAACF,EAAAC,EAAMwF,SAAP,KACEzF,EAAAC,EAAAC,cAACsvC,GAAA,EAAD,CAAQvpC,SAAS,UACfjG,EAAAC,EAAAC,cAACyf,GAAA,EAAD,CAASxY,UAAWkoB,KAAWroB,EAAQlB,KAAMqB,EAAW6tD,EAAgBhuD,EAAQytD,YAAc,MAAO70C,gBAAc,IAC/Gq1C,GACAj1D,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CACEv0B,UAAW6tD,EAAgBhuD,EAAQ2tD,gBAAkB3tD,EAAQT,KAC7DqC,MAAM,UACN6B,QAAS,kBAAMs3C,GAAc,KAE7B/hD,EAAAC,EAAAC,cAACg1D,GAAD,CAAe/tD,UAAW6tD,EAAgBhuD,EAAQ4tD,oBAAsB5tD,EAAQT,QAGpFvG,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQjH,UACrBA,GAEHC,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CACE9yB,MAAM,UACNzB,UAAWkoB,KACT9H,EAAQvgB,EAAQ0tD,QAAU,KAC1BM,EAAgBhuD,EAAQ8tD,oBAAsB9tD,EAAQ6tD,UAExDv8B,aAAW,OACX7tB,QAAS8c,EAAQ,kBAAMxd,EAAc6xB,KAAyBm3B,GAE9D/yD,EAAAC,EAAAC,cAAC01B,GAAD,CAAYhtB,MAAM,eAIxB5I,EAAAC,EAAAC,cAACi1D,GAAD,CACEvqD,KAAMk3C,EACNh3C,QAAS,kBAAMi3C,GAAc,IAC7BQ,OAAQ,kBAAMR,GAAc,IAC5B8Q,gBAAiB,kBAAM9oD,EAAc6xB,KACrCk3B,aAAc,kBAAM/oD,EAAc6xB,OAEpC57B,EAAAC,EAAAC,cAAC+G,GAAA,EAAD,CAAepB,MAAOrB,GAAOJ,QAC1BmjB,GACCvnB,EAAAC,EAAAC,cAACk1D,GAAD,CACExqD,KAAM2kC,IAAe3T,GACrBzG,MAAM,uBACN1tB,QAASzH,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,QAAQsY,UAAU,OAC7C7f,EAAAC,EAAAC,cAAA,8EAAqEF,EAAAC,EAAAC,cAAA,gEAArE,KAEAF,EAAAC,EAAAC,cAAA,oGAEF4K,QAAS,kBAAMf,GAAc,MAGjC/J,EAAAC,EAAAC,cAACm1D,GAAD,CACEzqD,KAAM2kC,IAAe3T,GACrB9wB,QAAS,kBAAMf,GAAc,SAoBxBurD,GAAA,SAAC1tD,GAAD,OAAW5H,EAAAC,EAAAC,cAAC+G,GAAA,EAAD,CAAepB,MAAOrB,GAAOJ,QAAQpE,EAAAC,EAAAC,cAACq1D,GAAW3tD,qCCjJrE4tD,GAAqB5vD,aAAW,SAAAC,GAAK,MAAK,CAC9CC,KAAK3M,OAAA20B,GAAA,EAAA30B,CAAA,CACH8M,SAAU,WACVwY,aAAc5Y,EAAM4vD,MAAMh3C,aAC1Bod,gBAAiB53B,gBAAK4B,EAAMjC,QAAQ8xD,OAAOC,MAAO,IAClDC,UAAW,CACT/5B,gBAAiB53B,gBAAK4B,EAAMjC,QAAQ8xD,OAAOC,MAAO,KAEpDl8B,YAAa5zB,EAAM8C,QAAQ,GAC3B+wC,WAAY,EACZj2C,MAAO,QACNoC,EAAMgwD,YAAYC,GAAG,MAAQ,CAC5Bpc,WAAY7zC,EAAM8C,QAAQ,GAC1BlF,MAAO,SAGXgxD,YAAa,CACX54B,gBAAiB53B,gBAAK4B,EAAMjC,QAAQ8xD,OAAOC,MAAO,IAClDC,UAAW,CACT/5B,gBAAiB53B,gBAAK4B,EAAMjC,QAAQ8xD,OAAOC,MAAO,MAGtDI,UAAW,CACTntD,MAAO,UACPnF,MAAO,QAETuyD,WAAW78D,OAAA20B,GAAA,EAAA30B,CAAA,CACTuP,QAAS7C,EAAM8C,QAAQ,EAAG,EAAG,EAAG,GAChC+9B,WAAY7gC,EAAM+tC,YAAYn3C,OAAO,SACrCgH,MAAO,QACNoC,EAAMgwD,YAAYC,GAAG,MAAQ,CAC5BryD,MAAO,MAGX+wD,WAAY,CACV/wD,MAAOoC,EAAM8C,QAAQ,GACrB5C,OAAQ,OACRE,SAAU,WACVgwD,cAAe,OACfrvD,QAAS,OACT05B,WAAY,SACZ41B,eAAgB,aA8DLC,GAvDY,SAAAr2D,GAA6E,IAA1EsL,EAA0EtL,EAA1EsL,UAAWd,EAA+DxK,EAA/DwK,SAAUgB,EAAqDxL,EAArDwL,SAAUb,EAA2C3K,EAA3C2K,QAAS+uC,EAAkC15C,EAAlC05C,aAAcwb,EAAoBl1D,EAApBk1D,cAC5EtzB,EAAW78B,mBACXmC,EAAUwuD,KAEVY,EAAqB5qC,sBACzBjtB,aAAS+M,EAAU,KACnB,CAACA,IASH,OANAogB,0BAAgB,WACVgW,EAAS18B,UAAYoG,IACvBtP,QAAQC,IAAI,gBACZ2lC,EAAS18B,QAAQqxD,SAElB,CAACjrD,IAEFpL,EAAAC,EAAAC,cAAA,OAAKiH,UAAWkoB,KAAWroB,EAAQlB,KAAMkvD,EAAgBhuD,EAAQytD,YAAc,MAAOhqD,QAASA,GAC7FzK,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQwtD,YACtBx0D,EAAAC,EAAAC,cAACo2D,GAAAr2D,EAAD,OAEFD,EAAAC,EAAAC,cAACq2D,GAAA,EAAD,CACEnrD,WAAYd,GAAYc,EACxBoW,WAAY,CACVg1C,OAAQ,cAKVlrD,SAAU,SAACnO,GAETi5D,EAAmBj5D,EAAEoO,OAAOC,QAE9BE,YAAY,eACZpB,SAAUA,EACVkvC,aAAcA,EAEd9X,SAAUA,EACV16B,QAAS,CACPlB,KAAMkB,EAAQ+uD,UACd51B,MAAOn5B,EAAQgvD,gBCCnBrwD,GAAYC,aApFJ,SAAAC,GAAK,MAAK,CACtBC,KAAM,CACJvC,OAAQ,EACRmF,QAAS7C,EAAM8C,QAAQ,IAEzB8tD,cAAe,CACb7vD,QAAS,OACTnD,MAAO,QAETkqC,KAAM,CAAE1kC,SAAU,GAClBytD,YAAa,CACXhuD,QAAS7C,EAAM8C,QAAQ,GAAK,KAE9BguD,aAAc,CACZ/tD,MAAO,QACPrE,WAAYuN,GAAOM,OAAOxJ,MAAM,MAElCguD,cAAe,CACbhuD,MAAO,QACPrE,WAAYuN,GAAOI,QAAQtJ,MAAM,MAEnCiuD,WAAY,CACVjuD,MAAO,QACPrE,WAAYuN,GAAOC,KAAKnJ,MAAM,MAEhC08B,IAAK,CACHwxB,cAAe,MACfp8B,UAAW,QACX30B,OAAQ,OACRtC,MAAO,QAETO,KAAM,CACJ+B,OAAQ,QACRxC,OAAQ,EACRmF,QAAS7C,EAAM8C,QAAQ,EAAG,GAC1ByyB,UAAW,aACXx0B,QAAS,OACTC,cAAe,UAEjBkwD,OAAQ,CACNhxD,OAAQ,OACRxC,OAAQ,EACRmF,QAAS7C,EAAM8C,QAAQ,EAAG,GAC1ByyB,UAAW,aACXx0B,QAAS,OACTC,cAAe,UAEjBmwD,UAAW,CACTtpB,aAAc,WACdrkC,WAAY,SACZZ,SAAU,UAEZwuD,cAAe,CACbrwD,QAAS,QAEXswD,UAAW,CACT90B,WAAY,OACZ97B,KAAM,YAER6wD,SAAU,GAGVC,UAAW,CACTnuD,SAAU,EACV1E,WAAYsB,EAAMjC,QAAQI,KAAKH,QAC/B4E,SAAU,UAEZ+xB,aAAc,CACZl0B,KAAM,YACN80B,UAAW,aACXr1B,OAAQ,IACR0C,SAAU,SACV7B,QAAS,OACTC,cAAe,UAEjBwwD,eAAgB,CACd/wD,KAAM,WACN80B,UAAW,aACXr1B,OAAQ,GACR0C,SAAU,SACV7B,QAAS,OACTC,cAAe,aAKbywD,GAAiB,SAAAx3D,GAAiF,IAA9EoE,EAA8EpE,EAA9EoE,OAAQgb,EAAsEpf,EAAtEof,QAASzU,EAA6D3K,EAA7D2K,QAAS1K,EAAoDD,EAApDC,SAAUw3D,EAA0Cz3D,EAA1Cy3D,cAAeC,EAA2B13D,EAA3B03D,cAAeC,EAAY33D,EAAZ23D,MACpFzwD,EAAUrB,KAChB,GAAIuZ,IAAYhb,EAAQ,MAAO,aAFuE,IAG9FuhC,EAAiBtT,qBAAWztB,IAA5B+gC,aAEJixB,EAAc5kD,GAAOI,QAAQvG,MAGjC,OAFA+qD,EAAcxyD,EAAOyS,OAAS7E,GAAO5N,EAAOyS,QAAQhL,MAAQmG,GAAOI,QAAQvG,MAGzE3L,EAAAC,EAAAC,cAAC26B,GAAA,EAAD,CAAU1zB,UAAWH,EAAQlB,KAAMgD,QAAM,EAAC+W,UAAU,MAAMD,gBAAc,GACtE5f,EAAAC,EAAAC,cAAA,OAAKiH,UAAWswD,EAAQzwD,EAAQqwD,eAAiBrwD,EAAQwzB,aAAc/vB,QAASA,GAC9EzK,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQowD,WACtBp3D,EAAAC,EAAAC,cAAConC,GAAD,CACErsC,MAAOiJ,EAAOkQ,SACdsxB,aAAc,CAAC,QAAS,SAAU,SAClCD,aAAcA,EACdt+B,UAAWH,EAAQs+B,OAGtBphC,EAAOyS,QACN3W,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWkoB,KAAWroB,EAAQ0vD,YAAa1vD,EAAO,SAAA1L,OAAU4I,EAAOyS,UAC7EpP,QAAQ,UACRsY,UAAU,OAFZ,GAAAvkB,OAIM4I,EAAO2U,YAAc,EAJ3B,YAKI4+C,GAASz3D,EAAAC,EAAAC,cAAA,cAAMw2D,EAAN,OAIjB12D,EAAAC,EAAAC,cAACo5B,GAAA,EAAD,CAAcnyB,UAAWswD,EAAQzwD,EAAQ+vD,OAAS/vD,EAAQhD,KAAMy3B,mBAAiB,EAAChxB,QAASA,GACzFzK,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,QAAQsY,UAAU,MAAM1Y,UAAWH,EAAQgwD,WAC5D9yD,EAAOyU,MAAQuG,GAElBlf,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,QAAQsY,UAAU,OACpC7f,EAAAC,EAAAC,cAAA,6BADF,IACgCgE,EAAO2T,YAAY1B,UAEnDnW,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQ2mC,OACvB4pB,GAAiBv3D,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQiwD,eACxCj3D,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,UAAUJ,UAAWH,EAAQkwD,WAAjD,YACAl3D,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,UAAUJ,UAAWH,EAAQmwD,UAAW55D,aAAW2G,EAAOyT,UAAW,SAE1F6/C,GAAiBx3D,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQiwD,eACxCj3D,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,UAAUJ,UAAWH,EAAQkwD,WAAjD,eACAl3D,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,UAAUJ,UAAWH,EAAQmwD,UAAW55D,aAAW2G,EAAOiQ,OAAO1Y,QAAS,UAIjGsE,IAeP23D,GAAA,6CCtIM/xD,GAAYC,aAdJ,SAAAC,GAAK,MAAK,CACtBC,KAAM,GAGN6xD,aAAc,CACZ7wD,UAAW,UAEb+zC,WAAY,CACVt2C,WAAYsB,EAAMjC,QAAQ8+B,KAAK,MAEjCk1B,eAAgB,CACd9wD,UAAW,aA8CA+wD,GAzCS,SAAA/3D,GAAuE,IAApEg4D,EAAoEh4D,EAApEg4D,YAAahG,EAAuDhyD,EAAvDgyD,kBAAmBiG,EAAoCj4D,EAApCi4D,SAAUC,EAA0Bl4D,EAA1Bk4D,WAC7DhxD,GADuFlH,EAAdgL,QAC/DnF,MAEhB,OADA7J,QAAQC,IAAI,mBAAoB,CAAE+7D,cAAahG,sBAE7C9xD,EAAAC,EAAAC,cAAC28B,GAAA,EAAD,KACE78B,EAAAC,EAAAC,cAAC26B,GAAA,EAAD,CAAU1zB,UAAWH,EAAQlB,MAC3B9F,EAAAC,EAAAC,cAACm5B,GAAA,EAAD,KACEr5B,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQ4wD,gBACtB53D,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CAAYjxB,QAASstD,EAAU5wD,UAAWH,EAAQ6zC,YAChD76C,EAAAC,EAAAC,cAAC+3D,GAAAh4D,EAAD,OAEFD,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,UAAUsY,UAAU,OAAxC,aAGJ7f,EAAAC,EAAAC,cAACo5B,GAAA,EAAD,CACEnyB,UAAWH,EAAQ2wD,aACnBltD,QAASstD,EACTl0D,QAAO,GAAAvI,OAAKw8D,EAAL,iBACP/zD,UAAS,cAAAzI,OAAgBw2D,EAAhB,qBAAAx2D,OAA2E,IAAtBw2D,EAA0B,GAAK,OAE/F9xD,EAAAC,EAAAC,cAACm5B,GAAA,EAAD,KACEr5B,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQ4wD,gBACtB53D,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CAAYjxB,QAASutD,EAAY7wD,UAAWH,EAAQ6zC,YAClD76C,EAAAC,EAAAC,cAACg4D,GAAAj4D,EAAD,OAEFD,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,UAAUsY,UAAU,OAAxC,aCfNla,GAAYC,aA3BJ,SAAAC,GAAK,MAAK,CACtBC,KAAM,GAGNqvB,MAAO,CACL5wB,WAAYsB,EAAMjC,QAAQC,QAAQC,KAClC8E,MAAO/C,EAAMjC,QAAQC,QAAQikB,aAC7BsT,UAAW,aACX33B,MAAO,OACPF,OAAQ,EACRqD,QAAS,OACT8B,QAAS7C,EAAM8C,QAAQ,IAEzB0yB,SAAU,CACRpyB,SAAU,GAEZqyB,YAAa,CACX5yB,QAAS,EACT0yB,UAAW,cAGbU,KAAM,CACJg4B,UAAW,SACXzmB,UAAW,aA6CA8qB,GAvCQ,SAAAr4D,GAAoD,IAAjDq1B,EAAiDr1B,EAAjDq1B,MAAOijC,EAA0Ct4D,EAA1Cs4D,WAAYC,EAA8Bv4D,EAA9Bu4D,SAAUvtD,EAAoBhL,EAApBgL,QAASF,EAAW9K,EAAX8K,KACxD5D,EAAUrB,KAChB,OACE3F,EAAAC,EAAAC,cAACyK,GAAA,EAAD,CACExD,UAAWH,EAAQlB,KACnB+E,WAAS,EACTD,KAAMA,EACNE,QAASA,EACTnE,SAAS,KACToE,kBAAgB,6BAEhB/K,EAAAC,EAAAC,cAAC8K,GAAA,EAAD,CAAa7D,UAAWH,EAAQmuB,MAAOsG,mBAAiB,GACtDz7B,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWH,EAAQq0B,UAAWlG,GAC1Cn1B,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CAAY9yB,MAAM,UAAUzB,UAAWH,EAAQs0B,YAAa7wB,QAASK,GACnE9K,EAAAC,EAAAC,cAACy7B,GAAA17B,EAAD,CAAW2I,MAAM,cAGrB5I,EAAAC,EAAAC,cAAC28B,GAAA,EAAD,CAAM11B,UAAWH,EAAQ80B,KAAMgB,OAAK,EAACw7B,gBAAc,GAChDF,EAAW/pD,IAAI,SAAAnK,GAAM,OACpBlE,EAAAC,EAAAC,cAACw3D,GAAD,CACEp9D,IAAG,SAAAgB,OAAW4I,EAAOvK,IACrBuK,OAAQA,EACRuzD,OAAK,EACLhtD,QAAS,kBAAM4tD,EAASn0D,EAAOvK,YCsBrCgM,GAAYC,aA7EJ,SAAAC,GAAK,MAAK,CACtBC,KAAM,CACJ8C,MAAO/C,EAAMjC,QAAQC,QAAQC,KAC7BL,MAAO,IACPwC,SAAU,WACVC,IAAK,MACLC,KAAM,MACNW,UAAW,SACXgwB,gBAAiB,UACjBC,UAAW,qCAEbkgB,WAAY,CACV7wC,OAAQ,IAEV2C,KAAM,GAINg3B,OAAQ,CACN95B,SAAU,WACV1C,OAAQ,SACRgB,WAAY,QACZqE,MAAO,QACPC,OAAQ,kBACR9C,OAAQ,GACRtC,MAAO,GACP2C,OAAQ,GACRmyD,WAAY,CAAEh0D,WAAYuN,GAAOM,OAAOxJ,OACxC4vD,YAAa,CAAEj0D,WAAYuN,GAAOI,QAAQtJ,OAC1C6vD,SAAU,CAAEl0D,WAAYuN,GAAOC,KAAKnJ,QAEtC8vD,aAAc,CACZn0D,WAAY,UACZqE,MAAO,QACPC,OAAM,kBACN0vD,WAAY,CAAEh0D,WAAY,WAC1Bi0D,YAAa,CAAEj0D,WAAY,WAC3Bk0D,SAAU,CAAEl0D,WAAY,YAE1Bo0D,MAAO,CACLvyD,OAAQ,GACRwC,MAAO/C,EAAMjC,QAAQG,UAAU+jB,aAC/BvjB,WAAYsB,EAAMjC,QAAQG,UAAUD,KACpCizB,UAAW,iCAEb6hC,YAAa,CACXhwD,MAAO/C,EAAMjC,QAAQC,QAAQikB,aAC7BvjB,WAAYsB,EAAMjC,QAAQC,QAAQC,MAEpCqzC,mBAAoB,CAClBlxC,SAAU,WACVC,IAAK,GACLC,KAAM,MAGNC,OAAQ,IAEVuS,KAAM,CACJ/P,MAAO,QACPw5B,WAAY,OACZgV,WAAU,sEAIVhxC,OAAQ,GACRH,SAAU,YAGZoxC,WAAY,CACVzuC,MAAO,QACPwuC,WAAU,wFAoDCE,GA3CA,SAAAx3C,GAA8D,IAA3D6Y,EAA2D7Y,EAA3D6Y,KAAMhC,EAAqD7W,EAArD6W,OAAQlM,EAA6C3K,EAA7C2K,QAASqwC,EAAoCh7C,EAApCg7C,OAAQjiC,EAA4B/Y,EAA5B+Y,WAAYD,EAAgB9Y,EAAhB8Y,UACrD5R,EAAUrB,KAChB,OACE3F,EAAAC,EAAAC,cAAA,OAAKiH,UAAWkoB,KAAWroB,EAAQlB,KAAMg1C,EAAS9zC,EAAQiwC,WAAa,KAAMtgC,IAC3E3W,EAAAC,EAAAC,cAACspC,GAAA,EAAD,CAAOxiC,QAAS,CAAE2xD,MAAOtpC,KAAWroB,EAAQ2xD,MAAO7d,EAAS9zC,EAAQ4xD,YAAc,KAAMjiD,IAAW8yB,aAAc5wB,GAC/G7Y,EAAAC,EAAAC,cAAC66B,GAAA,EAAD,CAAQ5zB,UAAWkoB,KAAWroB,EAAQ+4B,OAAQ+a,EAAS9zC,EAAQ0xD,aAAe,KAAM/hD,GAASlM,QAASA,GACpGzK,EAAAC,EAAAC,cAACymD,GAAA1mD,EAAD,CAAQkH,UAAWH,EAAQ+B,KAAMH,MAAM,cAG1CgQ,GAAaA,GAAa,EACzB5Y,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQmwC,oBACtBn3C,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQuwC,OACtBtG,QAAQ,MACRxtC,MAAM,MACNsC,OAAO,MACPmrC,QAAQ,iBACR/hC,MAAO,CAAE4nB,UAAS,6CAAAz7B,OAA+Csd,EAA/C,UAClB5Y,EAAAC,EAAAC,cAAA,QAAM5C,EAAE,mGACNm0C,KAAK,UACLF,YAAY,QACZC,YAAY,IACZgG,cAAc,MACdlG,OAAO,cAIX,KACJtxC,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,QAAQJ,UAAWkoB,KAAWroB,EAAQ2R,KAAMmiC,EAAS9zC,EAAQqwC,WAAa,OAC3F1+B,0BChGHhT,GAAYC,aAbJ,SAAAC,GAAK,MAAK,CACtBk6B,OAAQ,CACNx7B,WAAYsB,EAAMjC,QAAQ8+B,KAAK,KAC/B75B,OAAM,aAAAvN,OAAeuK,EAAMjC,QAAQ8+B,KAAK,MACxC95B,MAAO/C,EAAMjC,QAAQ8+B,KAAK,MAE5Bg2B,aAAc,CACZn0D,WAAY,UACZsE,OAAM,kBACND,MAAO,QACPxC,OAAQ,OAoBGyyD,GAfC,SAAA/4D,GAAsC,IAAnCg4D,EAAmCh4D,EAAnCg4D,YAAahd,EAAsBh7C,EAAtBg7C,OAAQrwC,EAAc3K,EAAd2K,QAChCzD,EAAUrB,KAChB,OACE3F,EAAAC,EAAAC,cAAC66B,GAAA,EAAD,CAAQtwB,QAASA,EAAStD,UAAWkoB,KAAWroB,EAAQ+4B,OAAQ+a,EAAS9zC,EAAQ0xD,aAAe,OAC7FI,KAAQhB,GAAa/5D,OAAO,SCD7B4H,GAAYC,ab1BH,SAAAC,GAAK,MAAK,CACvBC,KAAM,CACJG,SAAU,WACVF,OAAQ,OACRgzD,iBAAkB,CAChB3yD,OAAQ,GAEV4yD,kBAAmB,CACjB5yD,OAAQ,GAEV6yD,mBAAoB,CAClB7yD,OAAQ,IAGZgwB,IAAK,CACH7xB,WAAYsB,EAAMjC,QAAQG,UAAUD,KACpC8E,MAAO/C,EAAMjC,QAAQG,UAAU+jB,cAEjCoxC,OAAQ,CACNjzD,SAAU,WACVG,OAAQ,IACRF,IAAK,GAEPizD,eAAgB,CACdlzD,SAAU,WACV2C,MAAO/C,EAAMjC,QAAQI,KAAKH,QAC1BmF,QAAS,GACT5C,OAAQ,GACRU,UAAW,SACXZ,IAAK,MACLC,KAAM,MACN4wB,UAAW,qCAEbqiC,WAAY,CACV71D,OAAQsC,EAAM8C,QAAQ,IACtBD,QAAS7C,EAAM8C,QAAQ,IACvBE,OAAQ,YACR4V,aAAc5Y,EAAM8C,QAAQ,GAC5BpE,WAAYsB,EAAMjC,QAAQ8xD,OAAOC,MACjCvsD,SAAU,GACVnD,SAAU,WACVG,OAAQ,GACRywB,OAAQhxB,EAAM8C,QAAQ,GACtBi2B,MAAO/4B,EAAM8C,QAAQ,KAEvB0wD,cAAe,CAEb51D,MAAO,MACPkD,SAAU,IACVP,OAAQ,IACRH,SAAU,WACV4wB,OAAQhxB,EAAM8C,QAAQ,GACtBxC,KAAM,MACN2wB,gBAAiB,SACjBC,UAAW,sCa1BTuiC,GAAc,CAClB9sC,KAAM,EACN7F,SAAU,UACVC,WAAY,YAyUC2yC,GApUC,SAAAz5D,GAIV,IAHJs4D,EAGIt4D,EAHJs4D,WAAYllB,EAGRpzC,EAHQozC,aAAch0B,EAGtBpf,EAHsBof,QAASsO,EAG/B1tB,EAH+B0tB,aAAc2hC,EAG7CrvD,EAH6CqvD,aACjDqK,EAEI15D,EAFJ05D,iBAAkBC,EAEd35D,EAFc25D,kBAAmBC,EAEjC55D,EAFiC45D,cACtBC,GACX75D,EADJ85D,cACI95D,EADW65D,gBACXjwD,GAAA5J,EAD2B+5D,gBAEKlwD,mBAAS,CAC3CsiB,SAAS9yB,OAAAuV,EAAA,EAAAvV,CAAA,GAAMmgE,GAAgBpmB,EAAajnB,UAC5C0T,OAAQuT,EAAavT,OACrBqvB,aAAc,QAJZplD,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GACGowD,EADHlwD,EAAA,GACemwD,EADfnwD,EAAA,GAOE5C,EAAUrB,KACVq0D,EAAan1D,mBARfmF,EAS0CL,oBAAS,GATnDM,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GASGqqC,EATHpqC,EAAA,GASoBqqC,EATpBrqC,EAAA,GAUEgwD,EAAsBp1D,mBAVxB2W,EAYkC7R,mBAAS,GAZ3C8R,EAAAtiB,OAAA0Q,GAAA,EAAA1Q,CAAAqiB,EAAA,GAYGyzC,EAZHxzC,EAAA,GAYgBy+C,EAZhBz+C,EAAA,GAAA6vB,EAaoC3hC,oBAAS,GAb7C4hC,EAAApyC,OAAA0Q,GAAA,EAAA1Q,CAAAmyC,EAAA,GAaG6uB,EAbH5uB,EAAA,GAaiB6uB,EAbjB7uB,EAAA,GAAAke,EAckC9/C,mBAAS,MAd3C+/C,EAAAvwD,OAAA0Q,GAAA,EAAA1Q,CAAAswD,EAAA,GAcG7V,EAdH8V,EAAA,GAcgB2Q,EAdhB3Q,EAAA,GAAA4Q,EAeoC3wD,qBAfpC4wD,EAAAphE,OAAA0Q,GAAA,EAAA1Q,CAAAmhE,EAAA,GAeGE,EAfHD,EAAA,GAeiBE,EAfjBF,EAAA,GAkBIpK,EAA0BpB,GAChCqJ,GAAc,GACd0B,EAAW9K,aACXC,EACA6K,EAAW7tC,SA5BG,GA8BdkjC,EACA9a,GAPM8b,sBAYR/qD,oBAAU,WACR,GAAKooB,GAAiB4qC,IAAcoC,EACpC,IACE,IAAMr4B,EAAWi2B,EAAW3+D,KAAK,SAAA+Z,GAAC,OAAIA,EAAE7Z,KAAO6zB,IAC/C,GAAI2U,GAAYA,EAAShqB,OAAQ,CAC/B,IAAMuiD,EAAYC,kBAAOhK,iBAAMxuB,EAAShqB,QAAS,GAAI,CAAEyiD,MAAO,WACxDj7B,EAASk7B,gBAAKH,GACpBX,EAAc5gE,OAAAuV,EAAA,EAAAvV,CAAA,GAAK2gE,EAAN,CAAkBn6B,aAGnC,MAAOxiC,GACLrB,QAAQsB,MAAMD,KAEf,CAACi7D,IAIJhzD,oBAAU,WACR,GAAKooB,GAAiB2iC,EAAsBb,SAAUkL,EACtD,IACE,IAAMr4B,EAAWguB,EAAsBb,OAAO71D,KAAK,SAAA+Z,GAAC,OAAIA,EAAEg9C,WAAW72D,KAAO6zB,IACxE2U,GAAY83B,EAAoBj1D,SAASy1D,EAAgBt4B,GAE/D,MAAOhlC,GACLrB,QAAQsB,MAAMD,KAEf,CAACgzD,EAAsBb,SAE1B,IAkBMwL,EAAqB,SAACC,GAE1BN,EAAgBM,GAEZA,GAAkC,IAA1BA,EAAKvK,WAAW9zB,MAAa+8B,EAAkBsB,EAAKvK,WAAW72D,IACtE8/D,IAvBS,SAACuB,GAAU,IAAA9sD,EAUrB8rD,EAAWh1D,QAAUg1D,EAAWh1D,QAAU80D,EAAW7tC,SACnDgvC,GAXmB/sD,EAEvBuoC,mBAFuBvoC,EAGvBwoC,uBAHuBxoC,EAIvBgtD,uBAJuBhtD,EAKvBitD,QALuBjtD,EAMvBktD,QANuBltD,EAOvBmtD,SAPuBntD,EAQvBotD,SAGc,CAAErvC,SAXO9yB,OAAAqV,EAAA,EAAArV,CAAA+U,EAAA,sHAYpB8sD,EAEHz7D,WAAW,kBAAMo6D,EAAesB,IAAUD,GAFhCrB,EAAesB,GAY3BM,IAGIxD,EAAW,SAACyD,GAChB,IACE,IAAMC,EAAM7J,6BAAkB4J,EAAOhL,WAAWuB,QAC5CpyB,EAASk7B,gBAAKY,GAElB,GAAI97B,EAAO,KAAOA,EAAO,IAAMA,EAAO,KAAOA,EAAO,GAAI,CACtD,IAAM+7B,EAAcf,kBAAOhK,iBAAM,CAAChxB,EAAO,GAAIA,EAAO,KAAM,GAAI,CAAEi7B,MAAO,WACvEj7B,EAASk7B,gBAAKa,GAGhB,IAAMC,EAAoC,IAAzBh8B,EAAO,GAAKA,EAAO,IAC9Bi8B,EAAoC,IAAzBj8B,EAAO,GAAKA,EAAO,IAC9Bk8B,EAAa,CACjBl8B,EAAO,GAAKg8B,EACZh8B,EAAO,GAAKi8B,EACZj8B,EAAO,GAAKg8B,EACZh8B,EAAO,GAAKi8B,GAGdvB,EAAe,CACb5jB,mBAAoB,IACpBC,uBAAwB,IAAIC,KAC5BC,iBAAkBC,OAEpBkjB,EAAc5gE,OAAAuV,EAAA,EAAAvV,CAAA,GAAK2gE,EAAN,CAAkBn6B,OAAQk8B,KACnCL,EAAOhL,WAAW9zB,MAAQ,GAAGn9B,WAAW,kBAAMu7D,EAAmB,OAAO,KAE9E,MAAO39D,GACLrB,QAAQsB,MAAMD,KA4CZ2+D,EAAgB,SAACrmC,GAEjB+kC,GAAgBA,EAAahK,WAAW72D,KAAO87B,EAAI+6B,WAAW72D,GAChEo+D,EAASyC,IAGTH,EAAe,CACb5jB,mBAAoB,IACpBC,uBAAwB,IAAIqlB,KAC5BnlB,iBAAkBC,OAEpBkjB,EAAc,CACZ9tC,SAAU,CACRrF,UAAW6O,EAAIw8B,SAASC,YAAY,GACpCvrC,SAAU8O,EAAIw8B,SAASC,YAAY,OAIzC4I,EAAmBrlC,IAIfumC,EAAkBvyC,kBAAQ,oBAAAnuB,OAAAnC,OAAAia,GAAA,EAAAja,CAC3Bg3D,EAAsBb,OACtBv1D,OAAO,SAAA07B,GAAG,OAAK4e,GAAoBmmB,GAAgBA,EAAahK,WAAW72D,KAAO87B,EAAI+6B,WAAW72D,KACjG0U,IAAI,SAAAonB,GAAG,OACNz1B,EAAAC,EAAAC,cAACu0C,GAAA,EAAD,CACEttC,UAAW,eACX7M,IAAG,UAAAgB,OAAYm6B,EAAI+6B,WAAW72D,IAC9BgtB,SAAU8O,EAAIw8B,SAASC,YAAY,GACnCtrC,UAAW6O,EAAIw8B,SAASC,YAAY,GACpC+J,WAAY,EACZC,WAAY,IAEZl8D,EAAAC,EAAAC,cAACi8D,GAAD,CAAcxjD,KAAM8c,EAAI+6B,WAAW73C,KACjChC,OAAQ8e,EAAI+6B,WAAW75C,OACvBkC,WAAY4c,EAAI+6B,WAAW33C,WAC3BpO,QAAS,kBAAMqxD,EAAcrmC,IAC7B7c,UAAWq2C,EAAc,IAAMx5B,EAAI+6B,WAAW53C,UAAY6c,EAAI+6B,WAAW53C,UAAY,KACrFkiC,OAAQ0f,GAAgBA,EAAahK,WAAW72D,KAAO87B,EAAI+6B,WAAW72D,SAjBhDR,OAAAia,GAAA,EAAAja,CAqB3Bg3D,EAAsBZ,QACtBx1D,OAAO,SAAA07B,GAAG,OAAK4e,GACdmmB,GACFA,EAAahK,WAAW72D,KAAO87B,EAAI+6B,WAAW72D,IAC9C6gE,EAAahK,WAAW9zB,QAAUjH,EAAI+6B,WAAW9zB,QAEhDruB,IAAI,SAAAonB,GAAG,OACNz1B,EAAAC,EAAAC,cAACu0C,GAAA,EAAD,CACEttC,UAAU,gBACV7M,IAAG,WAAAgB,OAAam6B,EAAI+6B,WAAW72D,IAC/BgtB,SAAU8O,EAAIw8B,SAASC,YAAY,GACnCtrC,UAAW6O,EAAIw8B,SAASC,YAAY,GACpC+J,YAAa,GACbC,WAAY,IAEZl8D,EAAAC,EAAAC,cAACk8D,GAAD,CACEtE,YAAariC,EAAI+6B,WAAW9zB,MAC5B7jB,WAAY4c,EAAI+6B,WAAWsB,kBAC3BrnD,QAAS,kBAAMqxD,EAAcrmC,IAC7BqlB,OACE0f,GACFA,EAAahK,WAAW72D,KAAO87B,EAAI+6B,WAAW72D,IAC9C6gE,EAAahK,WAAW9zB,QAAUjH,EAAI+6B,WAAW9zB,cAKvD,CAACyzB,EAAuBqK,EAAcnmB,IAEpCgoB,EAAqB5yC,kBAAQ,mBAAQ+wC,GACzCx6D,EAAAC,EAAAC,cAAC4oB,GAAA,EAAD,CAAO3hB,UAAWH,EAAQqyD,eACW,IAAlCmB,EAAahK,WAAW9zB,MACrB18B,EAAAC,EAAAC,cAACw3D,GAAD,CACAxzD,OAAQs2D,EAAahK,WACrB+G,eAAa,EACbC,eAAa,EACb/sD,QAAS,kBAAM+uD,EAAiBgB,EAAahK,WAAW72D,OAExDqG,EAAAC,EAAAC,cAACo8D,GAAD,CACAxE,YAAa0C,EAAahK,WAAW9zB,MACrCo1B,kBAAmB0I,EAAahK,WAAWsB,kBAC3CkG,WAAY,kBAAMoC,GAAgB,IAClCtvD,QAAS,kBAAMgwD,EAAmB,OAClC/C,SAAU,kBAAMA,EAASyC,QAI9B,CAACA,IAEJ,OACEx6D,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,KAAMoB,IAAK+yD,GACjCj6D,EAAAC,EAAAC,cAACo1D,GAAD,CAAQN,eAAa,EAAC7tD,UAAWH,EAAQkyD,QACvCl5D,EAAAC,EAAAC,cAACq8D,GAAD,CACEvH,eAAa,EACbvqD,QAASivD,EACTlgB,aAAc,MAGjBt6B,GACClf,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQmyD,gBACtBn5D,EAAAC,EAAAC,cAACklC,GAAA,EAAD,CAAkBtlB,KAAM,GAAIssC,UAAW,EAAGxjD,MAAM,aAKpD5I,EAAAC,EAAAC,cAACs8D,GAADrjE,OAAAyV,OAAA,CACEqkC,QAAM,EAENhnB,SAAU6tC,EAAW7tC,SACrB2nB,YAAaA,EACb3B,UAAWriC,GACXmiC,eAAgB,CAAE7rC,IAAK,IACvBmtC,UAAWzjC,GAAUvT,OAAS,EAAI,EAAI,GArH/B,GA8GT,CASEo3C,kBAAmB,WACjBa,GAAmB,IAErBX,gBAAiB,WACfW,GAAmB,GACnB+lB,EAAe,OAEjB16B,OAAQm6B,EAAWn6B,OACnBw7B,QAAS,GACTC,QAAS,EACT7nB,iBAvKmB,SAAA97B,GAAuB,IAApBwU,EAAoBxU,EAApBwU,SAAU5d,EAAUoJ,EAAVpJ,IACpC2rD,EAAWh1D,QAAUinB,EAarB,IAAMwwC,EAAWhsC,KAAKC,MAAMzE,EAASO,MACrC,IAAK6nB,GAAmBhmC,GAAOA,EAAIquD,UAAW,KAAAC,EACqCtuD,EAAIquD,YADzCE,EAAAD,EACpCE,IAAYC,EADwBF,EAC7BG,IAAkBC,EADWJ,EAChBK,IADgBC,EAAAP,EACDQ,IAAYC,EADXF,EACMH,IAAkBM,EADxBH,EACmBD,IADnBprC,EAESioC,EAAW9K,cAAgB,CAAC8N,EAAQE,EAAQI,EAAQC,GAF7Dt7B,EAAA5oC,OAAA0Q,GAAA,EAAA1Q,CAAA04B,EAAA,GAErCyrC,EAFqCv7B,EAAA,GAE1Bw7B,EAF0Bx7B,EAAA,GAEfy7B,EAFez7B,EAAA,GAEJ07B,EAFI17B,EAAA,GAG5C,GAAI06B,IAAaxN,GACfqO,GAAaR,GAAUS,GAAaP,GACpCQ,GAAaJ,GAAUK,GAAaJ,EACpC,CACA,IAAMrO,EAAe,CACnB8N,GAAUM,EAASN,GAAU,EAC7BE,GAAUK,EAASL,GAAU,EAC7BI,GAAUA,EAASN,GAAU,EAC7BO,GAAUA,EAASL,GAAU,GAE/BjD,EAAc5gE,OAAAuV,EAAA,EAAAvV,CAAA,GAAK2gE,EAAN,CAAkB9K,mBAG/ByN,IAAaxN,GACfiL,EAAeuC,IAwIbiB,cAAe,WACTlD,GAAcM,EAAmB,SAGtCkB,GAEFxB,GAAgBA,EAAahK,WAAW9zB,MAAQ,GAC/C18B,EAAAC,EAAAC,cAACy9D,GAAD,CACE/yD,KAAMuvD,EACNhlC,MAAK,GAAA75B,OAAKk/D,EAAahK,WAAW9zB,MAA7B,WACL5xB,QAAS,kBAAMsvD,GAAgB,IAC/B/B,SAAUmB,EACVpB,WAAYoC,EAAahK,WAAWuB,OAAO1jD,IAAI,SAAA+5B,GAAC,OAAIA,EAAEooB,eAGzD6L,IC3UDuB,GAAgB,GAwDhBC,GAAgBzwD,YAAQ/L,EAAW,CACvCuG,MAAO,SAAAsG,GAAwB,IAArBC,EAAqBD,EAArBC,KAAMZ,EAAeW,EAAfX,SAsBd,OApBKY,EAAK+Q,UAAY/Q,EAAK/Q,OAAS+Q,EAAK9M,WAAa8M,EAAK9M,UAAU0S,gBAAgB1X,OAAS,GAAK8R,EAAK9M,UAAU2S,UAChH7F,EAAK2vD,UAAU,CACb/vD,UAAU5U,OAAAuV,EAAA,EAAAvV,CAAA,GAAMgV,EAAKJ,UAAZ,CAAuBiG,UAAW7F,EAAK9M,UAAU2S,YAE1D+pD,YAAa,SAACtnD,EAADgB,GAA+B,IAAtBumD,EAAsBvmD,EAAtBumD,gBACpB,MAAO,CACL38D,UAAUlI,OAAAuV,EAAA,EAAAvV,CAAA,GACL6kE,EAAgB38D,UADZ,CAEP0S,gBAAe,GAAAzY,OAAAnC,OAAAia,GAAA,EAAAja,CAAOsd,EAAKpV,UAAU0S,iBAAtB5a,OAAAia,GAAA,EAAAja,CAA0C6kE,EAAgB38D,UAAU0S,wBAMpF5F,EAAK+Q,SAAW/Q,EAAK/Q,MAC5BmQ,EAAS0wD,eAAe9vD,GAGxBZ,EAAS0wD,eAAT9kE,OAAAuV,EAAA,EAAAvV,CAAA,GAA6BgV,EAA7B,CAAmC+vD,iBAAiB,KAE/C,MAETtsC,QAAS,CACP7jB,UAAW,CAAE+F,MAAO,QAOlBqqD,GAAgB/wD,YAAQ7L,EAAW,CACvCiwB,KAAM,SAAAK,GAAA,IAAGusC,EAAHvsC,EAAGusC,UAAWh0C,EAAdyH,EAAczH,OAAd,OAA4Bg0C,IAAch0C,GAChDxiB,MAAO,SAAAm6B,GAA0D,IAAvD5zB,EAAuD4zB,EAAvD5zB,KAAuDkwD,EAAAt8B,EAAjDx0B,SAAY+wD,EAAqCD,EAArCC,YAAaC,EAAwBF,EAAxBE,gBAKvC,GAJIpwD,EAAK/Q,QACPtB,QAAQC,IAAI,YAAaoS,EAAK/Q,MAAO+Q,GACrCrS,QAAQsB,MAAM+Q,EAAK/Q,SAEhB+Q,EAAK+Q,SAAW/Q,EAAKqwD,eAAiBrwD,EAAKqwD,cAAczqD,gBAAiB,CAE7E,IAAMzX,EAAU6R,EAAKqwD,cAAczqD,gBAC7B0qD,EAAUH,EAAYj9D,UAAU0S,gBAItC,GAAI5F,EAAKqwD,cAAe,CACtB,IAAIE,EAAqBJ,EAAYj9D,UAAU0S,gBAC/CzX,EAAQke,QAAQ,SAAA6nB,GAAuC,IAApC1uB,EAAoC0uB,EAApC1uB,aAAiBgrD,EAAmBxlE,OAAAqV,EAAA,EAAArV,CAAAkpC,EAAA,kBACrD,GAAqB,YAAjB1uB,EACF7X,QAAQC,IAAI,qCAAsC4iE,EAAahlE,IAC/D+kE,EAAqBD,EAAQ1kE,OAAO,SAAAyZ,GAAC,OAAIA,EAAE7Z,KAAOglE,EAAahlE,SAE5D,CACH,IAAMwZ,EAAMsrD,EAAQ5kE,UAAU,SAAA+kE,GAAE,OAAIA,EAAGjlE,KAAOglE,EAAahlE,KACvDwZ,GAAO,GACTrX,QAAQC,IAAI,qCAAsC4iE,EAAahlE,IAC/D+kE,EAAqBD,EAAQpwD,IAAI,SAACwwD,EAAWC,GAAZ,OAAsBA,IAAU3rD,EAAMwrD,EAAeE,MAGtF/iE,QAAQC,IAAI,kCAAmC4iE,EAAahlE,IAC5D+kE,EAAkB,GAAApjE,OAAAnC,OAAAia,GAAA,EAAAja,CAAOslE,GAAP,CAAgBE,KAGtCL,EAAYP,YAAY,SAAC5vD,EAAMyjB,GAC7B,IAIE,OAHaz4B,OAAAuV,EAAA,EAAAvV,CAAA,GAAQgV,GACb9M,UAAU0S,gBAAkB2qD,EACpCH,IACOpwD,EAET,MAAOhR,GAEL,OADArB,QAAQsB,MAAMD,GACPgR,QAMjB,OAAO,MAETyjB,QAAS,SAAAusB,GAAA,MAAoB,CAC3BpwC,UAAW,CACT+F,MAAO,IACPsqD,UAHKjgB,EAAGigB,eASRW,GAAmBlB,GAAc,kBAAM,OACvCmB,GAAmBb,GAAc,kBAAM,OAiC9B/vD,gBA9BS,SAACnG,EAAOL,GAG9B,MAAO,CAAE4lB,aAF6BvlB,EAAMtE,KAApCqB,QAAWwoB,aAEI0lB,aADFjrC,EAAMoG,IAAI9R,OAAO,GAAGgxB,QAKhB,SAAAyE,GAAQ,MAAK,CACtCitC,SAAU,CACRzF,iBAAkB,SAAChsC,GACjBwE,EAASpG,GAAqBjoB,GAAKwM,cAAcK,OAAQ,CAAEgd,mBAE7DisC,kBAAmB,SAACjsC,GAClBwE,EAASpG,GAAwB4B,KAEnCksC,cAAe,WACb1nC,EAASpG,GAAqBjoB,GAAKwM,cAAcG,OAAQ,CAAE8gD,OAAQ,CAAE8N,IAAKv7D,GAAKkN,YAAYE,SAAU/M,KAAM,QAE7G41D,cAAe,WACb5nC,EAASpG,OAEX+tC,eAAgB,SAACxtC,GACf6F,EAASpG,GAAuBO,KAElC0tC,gBAAiB,WACf7nC,EAASpG,UAKAxd,CA/KU,SAAAtO,GAA8C,IAA3CozC,EAA2CpzC,EAA3CozC,aAAc1lB,EAA6B1tB,EAA7B0tB,aAAcyxC,EAAen/D,EAAfm/D,SAAev1D,EAC/BC,qBAD+BC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAC9D40D,EAD8D10D,EAAA,GACjDq0D,EADiDr0D,EAAA,GAAAI,EAElCL,mBAAS,GAFyBM,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAE9DmlD,EAF8DllD,EAAA,GAEhDylD,EAFgDzlD,EAAA,GAG/Ds0D,EAAkB,kBAAM7O,EAAWP,EAAe,IAClD13B,EAAW5yB,mBAJoD2W,EAKnC7R,mBAAS,MAL0B8R,EAAAtiB,OAAA0Q,GAAA,EAAA1Q,CAAAqiB,EAAA,GAK9D4iD,EAL8D3iD,EAAA,GAKnD0jD,EALmD1jD,EAAA,GAMrEgc,EAASzyB,QAAUo5D,EAGnB,IAAMgB,EAAiB31C,kBAAQ,kBAAMzpB,EAAAC,EAAAC,cAAC6+D,GAAD,CAAkBd,eAAgBA,KAAoB,IACrFoB,EAAkB51C,kBAAQ,kBAAMzpB,EAAAC,EAAAC,cAAC8+D,GAAD,CAAkBZ,UAAWA,EAAWE,YAAaA,EAAaC,gBAAiBA,KAAqB,CAACH,IAkB/I,OAfAh5D,oBAAU,WACR,GAAKk5D,EAKL,OADK7mC,EAASzyB,SAAWs5D,EAAYJ,kBAAiBzmC,EAASzyB,QAAUw3C,YAHzE,WACM/kB,EAASzyB,SAASm6D,EAAapiE,OAAOpB,KAAKic,MAAwB,IAAhBgmD,MAEkD,IAAhBA,KACpF,WACDnmC,EAASzyB,UACXlJ,QAAQC,IAAI,oBACZ4gD,cAAcllB,EAASzyB,SACvByyB,EAASzyB,QAAU,QAGtB,CAACs5D,IAGFt+D,EAAAC,EAAAC,cAACF,EAAAC,EAAMwF,SAAP,KACG25D,EACAC,EACDr/D,EAAAC,EAAAC,cAACo/D,GAADnmE,OAAAyV,OAAA,CACEugD,aAAcA,EACdiJ,WAAYkG,GAAeA,EAAYj9D,UAAYi9D,EAAYj9D,UAAU0S,gBAAkB,GAC3FyZ,aAAcA,EACd0lB,aAAcA,EACdh0B,QAASo/C,GAAeA,EAAYp/C,SAChC+/C,4BCnCNt5D,GAAYC,aAAW,SAAAC,GAAK,MAAK,CACrCC,KAAM,GAGNy5D,WAAY,CACV32D,MAAO/C,EAAMjC,QAAQC,QAAQikB,aAC7BvjB,WAAYsB,EAAMjC,QAAQC,QAAQ6jC,MAEpC3H,OAAQ,CACNx7B,WAAYsB,EAAMjC,QAAQC,QAAQC,MAEpC07D,UAAW,CACT52D,MAAO/C,EAAMjC,QAAQC,QAAQikB,aAC7B2a,aAAc,GAEhBg9B,UAAW,CACT15D,OAAQ,OACRtC,MAAO,OACPi3B,UAAW,YAITglC,GAAoB,SAAA5/D,GAA4E,IAIjFm7B,EAJQ9zB,EAAyErH,EAAzEqH,UAAWI,EAA8DzH,EAA9DyH,QAASoR,EAAqD7Y,EAArD6Y,KAAM3G,EAA+ClS,EAA/CkS,YAAaiE,EAAkCnW,EAAlCmW,SAAUxL,EAAwB3K,EAAxB2K,QAASguC,EAAe34C,EAAf24C,SAC/EzxC,EAAUrB,KACZg6D,EAAU9vB,KAQd,OAAQtoC,GACN,IAAK,MACHo4D,EAAUC,KACV,MACF,IAAK,WACHD,EAAU9vB,KACV,MACF,IAAK,OACH8vB,EAAU1pD,GAdKglB,EAcgBhlB,EAdR,kBACzBjW,EAAAC,EAAAC,cAAC66B,GAAA,EAAD,CAAQ5zB,UAAWH,EAAQ+4B,QACzB//B,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQy4D,UAAWzkC,IAAI,UAAUC,IAAKA,OAYX4kC,KAK/C,OACE7/D,EAAAC,EAAAC,cAAC26B,GAAA,EAAD,CACE1zB,UAAWkoB,KAAWloB,EAAWH,EAAQlB,KAAM2yC,EAAWzxC,EAAQu4D,WAAa,MAC/Ez2D,SAAU2B,EACVA,QAASA,GAETzK,EAAAC,EAAAC,cAAC46B,GAAA,EAAD,KACE96B,EAAAC,EAAAC,cAAC66B,GAAA,EAAD,CAAQ5zB,UAAWH,EAAQ+4B,QACzB//B,EAAAC,EAAAC,cAACy/D,EAAD,CAAS/2D,MAAM,cAGnB5I,EAAAC,EAAAC,cAACo5B,GAAA,EAAD,CAAcmC,mBAAiB,GAC7Bz7B,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,QAAQqB,MAAM,WAAW+P,GAC7C3Y,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,QAAQqB,MAAM,WAAWoJ,IAE9CymC,GACCz4C,EAAAC,EAAAC,cAACm5B,GAAA,EAAD,KACEr5B,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CAAYjxB,QAASguC,EAAUtxC,UAAWH,EAAQw4D,WAChDx/D,EAAAC,EAAAC,cAACi6B,GAAAl6B,EAAD,CAAY2I,MAAM,gBAkB9Bk3D,GAAA,GC1FMn6D,GAAYC,aAAW,SAAAC,GAAK,MAAK,CACrCC,KAAM,CACJC,OAAQ,OACR81B,gBAAiBh2B,EAAMjC,QAAQW,WAAWlB,MAC1C4C,SAAU,WACV6tD,UAAW,SACXzmB,UAAW,SACXpkC,SAAU,GAEZ82D,YAAa,CACXlkC,gBAAiB,WAEnBoS,gBAAiB,CACfnnC,UAAW,SACX4B,QAAS7C,EAAM8C,QAAQ,EAAG,GAC1BC,MAAO/C,EAAMjC,QAAQ8+B,KAAK,MAE5Bs9B,GAAI,CACFnkC,gBAAiB,UACjBnzB,QAAS,MAkCEu3D,GA9Bc,SAAAngE,GAA4D,IAAzDyH,EAAyDzH,EAAzDyH,QAAS2X,EAAgDpf,EAAhDof,QAASghD,EAAuCpgE,EAAvCogE,eAAgBC,EAAuBrgE,EAAvBqgE,iBAC1Dn5D,EAAUrB,KAChB,OAAIuZ,EACKlf,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWH,EAAQinC,gBAAiB1mC,QAAQ,MAAxD,gBAEC24D,GAA4C,IAA1BA,EAAe7jE,OAKzC2D,EAAAC,EAAAC,cAAC28B,GAAA,EAAD,CAAM11B,UAAWH,EAAQlB,MACtBo6D,EAAe7xD,IAAI,SAAC+xD,EAAIjtD,GAAL,OAClBnT,EAAAC,EAAAC,cAAC4/D,GAAD3mE,OAAAyV,OAAA,CACEtU,IAAG,OAAAgB,OAAS6X,GACZ5L,QAASA,EACTkD,QAAS,kBAAM01D,EAAiBC,KAC5BA,OAVHpgE,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWH,EAAQinC,gBAAiB1mC,QAAQ,MAAxD,MAAiEA,EAAjE,aCjCL5B,GAAYC,aAAW,SAAAC,GAAK,MAAK,CACrCC,KAAM,CACJgB,UAAW,SACXiY,UAAW,SACXrW,QAAS7C,EAAM8C,QAAQ,EAAG,OAoBf03D,GAhBK,SAAAvgE,GAA2B,IAAxBqP,EAAwBrP,EAAxBqP,MAAOpG,EAAiBjJ,EAAjBiJ,KAAM/E,EAAWlE,EAAXkE,KAC5BgD,EAAUrB,KAChB,OACE3F,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWH,EAAQlB,KAAMyB,QAAQ,YAAYqB,MAAM,gBAAgBiX,UAAU,MAAM1Q,MAAOA,GACnGpG,EACA/E,ICND2B,GAAYC,aAAW,SAAAC,GAAK,MAAK,CACrCC,KAAM,CACJC,OAAQ,OACRkD,SAAU,EACVrC,QAAS,OACTC,cAAe,SACf4B,SAAU,UAEZ63D,QAAS,CACPr3D,SAAU,GAEZ6yB,KAAM,CACJ7yB,SAAU,EACV4yB,gBAAiBh2B,EAAMjC,QAAQW,WAAWlB,MAC1C4C,SAAU,WACV6tD,UAAW,SACXzmB,UAAW,UAEbY,gBAAiB,CACfnnC,UAAW,SACX4B,QAAS7C,EAAM8C,QAAQ,EAAG,GAC1BC,MAAO/C,EAAMjC,QAAQ8+B,KAAK,MAE5Bq9B,YAAa,CACXlkC,gBAAiB,WAEnBmkC,GAAI,CACFnkC,gBAAiB,UACjBnzB,QAAS,MAuEE63D,GAnEO,SAAAzgE,GAAyF,IAAtFyH,EAAsFzH,EAAtFyH,QAAS2X,EAA6Epf,EAA7Eof,QAASk5C,EAAoEt4D,EAApEs4D,WAAYoI,EAAwD1gE,EAAxD0gE,cAAe/nB,EAAyC34C,EAAzC24C,SAAUgoB,EAA+B3gE,EAA/B2gE,cAAe3C,EAAgBh+D,EAAhBg+D,UACvF92D,EAAUrB,KACV+6D,EAAU77D,mBACV87D,EAAW97D,mBAEX+7D,EAAeriE,aAAS,WAC5B,IAAK2gB,GAAW4+C,GAAa6C,EAAS37D,SAAW07D,EAAQ17D,QAAS,KACxDk3D,EAAcyE,EAAS37D,QAAvBk3D,UADwD2E,EAE5BH,EAAQ17D,QAApC87D,EAFwDD,EAExDC,UAAWljC,EAF6CijC,EAE7CjjC,aAEfs+B,EAA2B,GADVt+B,EAAekjC,KAElChlE,QAAQC,IAAI,SAAU,CAAE6hC,eAAckjC,YAAW5E,cACjD4B,OAGH,KAEH14D,oBAAUw7D,EAAc,CAACxI,IAEzB,IAAIxwC,EAAU,KA4Bd,OA3BI1I,EACF0I,EACE5nB,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWH,EAAQinC,gBAAiB1mC,QAAQ,MAAxD,gBAGK6wD,GAAcA,EAAW/7D,OAAS,GACzCurB,EAAUwwC,EAAW/pD,IAAI,SAACnK,EAAQiP,GAAT,OACvBnT,EAAAC,EAAAC,cAACw3D,GAAD,CACEp9D,IAAG,UAAAgB,OAAY6X,GACfjP,OAAQA,EACRuG,QAAS,kBAAMg2D,EAAcv8D,EAAOvK,KACpC49D,eAAa,EACbC,eAAa,OAGTrF,KACNnyD,EAAAC,EAAAC,cAAA,OAAK5F,IAAI,QAAQ4M,IAAKy5D,GACpB3gE,EAAAC,EAAAC,cAAC6gE,GAAD,CAAa/8D,KAAM85D,EAAY,aAAe,sBAKlDl2C,EACE5nB,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWH,EAAQinC,gBAAiB1mC,QAAQ,MAAxD,mBAKFvH,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,MACtB9F,EAAAC,EAAAC,cAAC4/D,GAAD3mE,OAAAyV,OAAA,CAAmBzH,UAAWH,EAAQs5D,SAAaE,EAAnD,CAAkEj5D,QAASA,EAASkxC,SAAUA,KAC9Fz4C,EAAAC,EAAAC,cAAC28B,GAAA,EAAD,CAAM11B,UAAWH,EAAQ80B,KAAMklC,UAAWhhE,EAAAC,EAAAC,cAAA,WAAQ+gE,SAAUL,EAAcj/B,SAAU++B,GACjF94C,KCzFHjiB,GAAYC,aAAW,SAAAC,GAAK,MAAK,CACrCC,KAAM,CACJmD,SAAU,EACVP,QAAS,MACT9B,QAAS,OACTC,cAAe,SACfmC,QAAS,GACTlC,UAAW,UAEbiC,KAAM,CACJtF,MAAO,OACP6C,KAAM,UACNsC,MAAO/C,EAAMjC,QAAQC,QAAQsyB,MAC7BntB,QAAS,IAEXnF,QAAS,CACPyC,KAAM,UACN7C,MAAO,QAETM,UAAW,CACTuC,KAAM,UACN7C,MAAO,WA8BIy9D,GA1BW,SAAAphE,GAAkC,IAA/BiJ,EAA+BjJ,EAA/BiJ,KAAMlF,EAAyB/D,EAAzB+D,QAASE,EAAgBjE,EAAhBiE,UACpCiD,EAAUrB,KACVw7D,EAAkBp4D,EACxB,OACE/I,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,MACtB9F,EAAAC,EAAAC,cAACihE,EAAD,CAAiBh6D,UAAWH,EAAQ+B,OACnClF,GACC7D,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWH,EAAQnD,QAAS0D,QAAQ,MAC7C1D,GAGJE,GACC/D,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWH,EAAQjD,UAAWwD,QAAQ,MAC/CxD,0BCzBLq9D,GAAOz9D,GAAKkN,YA6BZlL,GAAYC,aA3BJ,SAAAC,GAAK,MAAK,CACtBC,KAAM,CACJC,OAAQ,OACRa,QAAS,OACT6B,SAAU,SACV5B,cAAe,UAEjBw6D,KAAM,GAMNC,YAAa,CACXr4D,SAAU,EACVR,SAAU,SACV7B,QAAS,OACTC,cAAe,UAEjBq4D,IAAK,CACHj2D,SAAU,GAEZ0kC,KAAM,CACJ1kC,SAAU,MAMRs4D,GAAS,SAAAzhE,GAITA,EAHJ2uC,WAGI,IAHQ+yB,EAGR1hE,EAHQ0hE,WAAYC,EAGpB3hE,EAHoB2hE,cAAeC,EAGnC5hE,EAHmC4hE,YAAaC,EAGhD7hE,EAHgD6hE,WACpDC,EAEI9hE,EAFJ8hE,cAAe1B,EAEXpgE,EAFWogE,eAAgB2B,EAE3B/hE,EAF2B+hE,cAAerB,EAE1C1gE,EAF0C0gE,cAC9CthD,EACIpf,EADJof,QAASihD,EACLrgE,EADKqgE,iBAAkB2B,EACvBhiE,EADuBgiE,WAAYrB,EACnC3gE,EADmC2gE,cAAe3C,EAClDh+D,EADkDg+D,UAEhD92D,EAAUrB,KAERykB,EAAWH,KAAXG,OAGRhlB,oBAAU,WACJ86D,IAAmB2B,GAA2C,IAA1B3B,EAAe7jE,QACrD8jE,EAAiBD,EAAe,KAEjC,CAACA,IAEJ,IAAIx0D,EAAc,GAClB,OAAQ81D,GACN,KAAKJ,GAAKtwD,IACRpF,EAAc,CAAE7H,QAAS,aAAcE,UAAW,uBAA0BgF,KAAM62D,MAClF,MACF,KAAKwB,GAAKpwD,KACRtF,EAAc,CAAE7H,QAAS,cAAeE,UAAW,6BAAgCgF,KAAM82D,MACzF,MACF,KAAKuB,GAAKrwD,SACRrF,EAAc,CAAE7H,QAAS,kBAAmBE,UAAW,0BAA6BgF,KAAM8mC,MAO9F,IAAIjoB,EAAU,KA0Cd,OA/BEA,EAVGwC,EASIo2C,GAAiBqB,EAEtB7hE,EAAAC,EAAAC,cAAC6hE,GAAD,CACEx6D,QAASi6D,EACTtiD,QAASA,EACTuhD,cAAeA,EACf3C,UAAWA,EACX1F,WAAYyJ,EACZrB,cAAeA,EACf/nB,SAAU,kBAAM0nB,EAAiB,SAI9BD,EAELlgE,EAAAC,EAAAC,cAAC8hE,GAAD,CACE9iD,QAASA,EACT3X,QAASi6D,EACTtB,eAAgBA,EAChBC,iBAAkBqB,IAAeJ,GAAKrwD,SAAW+wD,EAAa3B,IAI3DuB,EAAYrlE,OAAS,EAE1B2D,EAAAC,EAAAC,cAACoH,GAAA,EAAD,sBAA2B,IAAAhM,OAAIqmE,EAAJ,MAAqB,OAIxC3hE,EAAAC,EAAAC,cAAC+hE,GAAsBv2D,GApC/B1L,EAAAC,EAAAC,cAAC+hE,GAAD,CACEp+D,QAAQ,kBACRE,UAAU,YACVgF,KAAMm5D,OAqCVliE,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,MACtB9F,EAAAC,EAAAC,cAACo1D,GAAD,KACEt1D,EAAAC,EAAAC,cAACq8D,GAAD,CACEjyD,UAAW8f,EAEX9e,SAAUs2D,EACVpoB,aAAcmoB,KAGjBv3C,GACCpqB,EAAAC,EAAAC,cAACiwC,GAAA,EAAD,CACE3kC,MAAOg2D,EACPl3D,UAAW8f,EACX9e,SAAU,SAACnO,EAAG6rC,GAAJ,OAAYy4B,EAAcz4B,IACpCm5B,eAAe,UACfn7D,QAAS,CAAEo7D,cAAep7D,EAAQq6D,MAClCgB,UAAQ,GAERriE,EAAAC,EAAAC,cAACkwC,GAAA,EAAD,CAAKjpC,UAAWH,EAAQk4D,IAAK1zD,MAAO41D,GAAKtwD,IAAKnF,MAAM,SACpD3L,EAAAC,EAAAC,cAACkwC,GAAA,EAAD,CAAKjpC,UAAWH,EAAQk4D,IAAK1zD,MAAO41D,GAAKrwD,SAAUpF,MAAM,WACzD3L,EAAAC,EAAAC,cAACkwC,GAAA,EAAD,CAAKjpC,UAAWH,EAAQk4D,IAAK1zD,MAAO41D,GAAKpwD,KAAMrF,MAAM,WAGzD3L,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQs6D,aACrB15C,KAqBT25C,GAAOhnC,aAAe,CACpBinC,WAAYJ,GAAKkB,KACjBZ,YAAa,IAGAH,UCtFTgB,GAAgBn1D,YAAQpL,GAAW,CACvC4F,MAAO,SAAAsG,GAAc,IAAXC,EAAWD,EAAXC,KACJA,EAAK/Q,OAAOtB,QAAQsB,MAAM+Q,EAAK/Q,OAEnC,IAAI8G,EAAS,KACb,IACOiK,EAAK+Q,SAAY/Q,EAAK/Q,QAAO8G,EAASiK,EAAKjK,QAElD,MAAO/G,GACLrB,QAAQsB,MAAM+Q,GACdrS,QAAQsB,MAAMD,GAOhB,MAAO,CACL+iE,eANqB/xD,EAAK3U,KAAO2U,EAAK3U,KAAK6U,IAAI,SAAAoJ,GAAA,IAAGkB,EAAHlB,EAAGkB,KAAM+jB,EAATjlB,EAASilB,MAAT,MAAsB,CACrE/jB,OACA3G,YAAW,KAAA1W,OAAOohC,EAAQ,GAAKA,EAAgC,GAAxBjM,KAAK+xC,KAAK9lC,EAAQ,IAA9C,2BACP,GAIJxd,QAAS/Q,EAAK+Q,QACdhb,WAIJ0tB,QAAS,SAAAC,GAAA,IAAG8vC,EAAH9vC,EAAG8vC,WAAH,MAAqB,CAC5B5zD,UAAW,CACT+rB,KAAM6nC,GAAcA,EAAWtlE,OAAS,EAAI,GAAKslE,EACjD7tD,MAAO,QAKP2uD,GAAiBr1D,YAAQzK,GAAY,CACzCiF,MAAO,SAAAm6B,GAAc,IAAX5zB,EAAW4zB,EAAX5zB,KACJA,EAAK/Q,OAAOtB,QAAQsB,MAAM+Q,EAAK/Q,OAEnC,IAAI8G,EAAS,KACb,IACOiK,EAAK+Q,SAAY/Q,EAAK/Q,QAAO8G,EAASiK,EAAKjK,QAElD,MAAO/G,GACLrB,QAAQsB,MAAM+Q,GACdrS,QAAQsB,MAAMD,GAUhB,MAAO,CACL+iE,eARqB/xD,EAAKxL,WAAawL,EAAKxL,WAAW0L,IAAI,SAAAg0B,GAAA,IAAGlsB,EAAHksB,EAAGlsB,SAAUF,EAAbosB,EAAapsB,SAAU0B,EAAvB0qB,EAAuB1qB,UAAvB,MAA4C,CACvGgB,KAAMxC,EACNxc,GAF2D0oC,EAAkC1oC,GAG7FqY,YAAW,UAAA1W,OAAYkC,aAAama,IACpC1B,cACI,GAIJiJ,QAAS/Q,EAAK+Q,QACdhb,WAGJstB,KAAM,SAAA2sB,GAAA,IAAGwjB,EAAHxjB,EAAGwjB,WAAH,OAAqBA,GAAcA,EAAWtlE,OAAS,GAC7Du1B,QAAS,SAAAwsB,GAAA,MAAqB,CAC5BrwC,UAAW,CACT20D,UAFKtkB,EAAGujB,WAGR7tD,MAAO,QAKP6uD,GAAcv1D,YAAQ7K,GAAS,CACnCqF,MAAO,SAAAy2C,GAAc,IAAXlwC,EAAWkwC,EAAXlwC,KACJA,EAAK/Q,OAAOtB,QAAQsB,MAAM+Q,EAAK/Q,OAEnC,IAAI8G,EAAS,KACb,IACOiK,EAAK+Q,SAAY/Q,EAAK/Q,QAAO8G,EAASiK,EAAKjK,QAElD,MAAO/G,GACLrB,QAAQsB,MAAM+Q,GACdrS,QAAQsB,MAAMD,GAWhB,MAAO,CACL+iE,eATqB/xD,EAAKy0D,SAAWz0D,EAAKy0D,SAASv0D,IAAI,SAAAw0D,GAAA,IAAGC,EAAHD,EAAGC,UAAH,MAAmD,CAC1GnqD,KADuDkqD,EAAc7+D,KAErEgO,YAFuD6wD,EAAoBE,UAG3ElI,KAHuDgI,EAA+BhI,KAItFmI,OAJuDH,EAAqCG,OAK5FF,eACI,GAIJ5jD,QAAS/Q,EAAK+Q,QACdhb,WAGJstB,KAAM,SAAAyxC,GAAA,IAAGtB,EAAHsB,EAAGtB,WAAH,OAAqBA,GAAcA,EAAWtlE,OAAS,GAC7Du1B,QAAS,SAAAsxC,GAAA,MAAqB,CAC5Bn1D,UAAW,CACTqjD,OAFK8R,EAAGvB,gBAYRwB,GAAgB/1D,YAAQtL,GAAe,CAC3C8F,MAAO,SAAAw7D,GAAc,IAAXj1D,EAAWi1D,EAAXj1D,KACJA,EAAK/Q,OAAOtB,QAAQsB,MAAM+Q,EAAK/Q,OAEnC,IAAI8G,EAAS,KACb,IACOiK,EAAK+Q,SAAY/Q,EAAK/Q,QAAO8G,EAASiK,EAAKjK,QAElD,MAAO/G,GACLrB,QAAQsB,MAAM+Q,GACdrS,QAAQsB,MAAMD,GAIhB,IAAM2gE,GAAY3vD,EAAK+Q,SAAY/Q,EAAKk1D,WAAcl1D,EAAKk1D,UAAUrvD,UAAmB,WACtFlY,QAAQC,IAAI,YAAaoS,GACzBA,EAAK2vD,UAAU,CACb/vD,UAAU5U,OAAAuV,EAAA,EAAAvV,CAAA,GAAMgV,EAAKJ,UAAZ,CAAuBiG,UAAW7F,EAAKk1D,UAAUrvD,YAE1D+pD,YAAa,SAACtnD,EAAD6sD,GAA+B,IAAtBtF,EAAsBsF,EAAtBtF,gBACpB,MAAO,CACLqF,UAAUlqE,OAAAuV,EAAA,EAAAvV,CAAA,GACL6kE,EAAgBqF,UADZ,CAEPtvD,gBAAe,GAAAzY,OAAAnC,OAAAia,GAAA,EAAAja,CAAOsd,EAAK4sD,UAAUtvD,iBAAtB5a,OAAAia,GAAA,EAAAja,CAA0C6kE,EAAgBqF,UAAUtvD,yBATZ,KAoBjF,MAAO,CACL8tD,cALoB1zD,EAAKk1D,WAAal1D,EAAKk1D,UAAUtvD,gBACnD5F,EAAKk1D,UAAUtvD,gBACf,GAIF+pD,YACA5+C,QAAS/Q,EAAK+Q,QACdhb,WAGJstB,KAAM,SAAA+xC,GAAA,OAAAA,EAAG/C,eACT5uC,QAAS,SAAA4xC,GAAA,MAAwB,CAC/Bz1D,UAAW,CACT+rB,IAFK0pC,EAAGhD,cAEW7nD,KACnB7E,MAAO,QAKP2vD,GAAiBr2D,YAAQ3L,EAAY,CACzCmG,MAAO,SAAA87D,GAAc,IAAXv1D,EAAWu1D,EAAXv1D,KACJA,EAAK/Q,OAAOtB,QAAQsB,MAAM+Q,EAAK/Q,OAEnC,IAAI8G,EAAS,KACb,IACOiK,EAAK+Q,SAAY/Q,EAAK/Q,QAAO8G,EAASiK,EAAKjK,QAElD,MAAO/G,GACLrB,QAAQsB,MAAM+Q,GACdrS,QAAQsB,MAAMD,GAIhB,IAAM2gE,GAAY3vD,EAAK+Q,SAAY/Q,EAAK1M,YAAe0M,EAAK1M,WAAWuS,UAAmB,WACxFlY,QAAQC,IAAI,YAAaoS,GACzBA,EAAK2vD,UAAU,CACb/vD,UAAU5U,OAAAuV,EAAA,EAAAvV,CAAA,GAAMgV,EAAKJ,UAAZ,CAAuBiG,UAAW7F,EAAK1M,WAAWuS,YAE3D+pD,YAAa,SAACtnD,EAADktD,GAA+B,IAAtB3F,EAAsB2F,EAAtB3F,gBACpB,MAAO,CACLv8D,WAAWtI,OAAAuV,EAAA,EAAAvV,CAAA,GACN6kE,EAAgBv8D,WADX,CAERsS,gBAAe,GAAAzY,OAAAnC,OAAAia,GAAA,EAAAja,CAAOsd,EAAKhV,WAAWsS,iBAAvB5a,OAAAia,GAAA,EAAAja,CAA2C6kE,EAAgBv8D,WAAWsS,yBATZ,KAoBnF,MAAO,CACL8tD,cALoB1zD,EAAK1M,YAAc0M,EAAK1M,WAAWsS,gBACrD5F,EAAK1M,WAAWsS,gBAChB,GAIF+pD,YACA5+C,QAAS/Q,EAAK+Q,QACdhb,WAGJstB,KAAM,SAAAoyC,GAAA,OAAAA,EAAGpD,eACT5uC,QAAS,SAAAiyC,GAAA,MAAwB,CAC/B91D,UAAW,CACTgK,UAFK8rD,EAAGrD,cAEiB7mE,GACzBma,MAAO,QA0EE1F,gBAtCS,SAACnG,EAAOL,GAAU,IAAAknD,EACc7mD,EAAMtE,KAApDqB,QAAWosD,EADqBtC,EACrBsC,OAAQ5jC,EADashC,EACbthC,aAAc7b,EADDm9C,EACCn9C,OACzC,MAAO,CACLmyD,WAAY1S,EAASA,EAAO8N,IAAM,KAClCwC,YAAatQ,EAASA,EAAOptD,KAAO,KACpCwpB,eACA7b,WAIuB,SAAAqgB,GAAQ,MAAK,CACtCs8B,OAAQ,WACNt8B,EAASpG,OAEX2iC,YAAa,SAACniC,GACZ4F,EAASpG,GAAoBQ,KAE/B23C,aAAc,SAAC/wD,GACbgf,EAASpG,GAAqBjoB,GAAKwM,cAAcK,OAAQ,CAAEgd,aAAcxa,MAG3EgxD,UAAW,SAAAC,GAAsB,IAAnBpJ,EAAmBoJ,EAAnBpJ,KAAMmI,EAAaiB,EAAbjB,OACdrjC,EAASk7B,EACb,IAAKl7B,GAAUqjC,EAAQ,CACrB,IAAMtI,EAAYC,kBAAOhK,iBAAMqS,GAAS,IAAK,CAAEpI,MAAO,WACtDj7B,EAASukC,gBAASxJ,GAGhB/6B,IACF3N,EAASpG,GAAuB,CAC9BW,KAAM5oB,GAAKsN,aAAaC,KACxByuB,OAAQA,KAEV3N,EAASpG,GAAqBjoB,GAAKwM,cAAcE,IAAK,CAAEmd,aAAc,KAAM1B,aAAc,YAKjF1d,CA9VO,SAAAtO,GAEhB,IADJkkE,EACIlkE,EADJkkE,UAAWD,EACPjkE,EADOikE,aAAcD,EACrBhkE,EADqBgkE,WAAYpC,EACjC5hE,EADiC4hE,YAAa5D,EAC9Ch+D,EAD8Cg+D,UAC9Cp0D,EAGgCC,mBAASm6D,GAAcngE,GAAKkN,YAAYC,KAHxElH,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAGG83D,EAHH53D,EAAA,GAGe63D,EAHf73D,EAAA,GAAAI,EAKgCL,mBAAS+3D,GAAe,IALxDz3D,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAKG23D,EALH13D,EAAA,GAKe23D,EALf33D,EAAA,GAAAuR,EAMsC7R,mBAAS,MAN/C8R,EAAAtiB,OAAA0Q,GAAA,EAAA1Q,CAAAqiB,EAAA,GAMGglD,EANH/kD,EAAA,GAMkB0kD,EANlB1kD,EAAA,GAoBA0oD,EAAmB,KACnBC,EAAkB,KAEtB,OAAQ5C,GACN,KAAK79D,GAAKkN,YAAYC,IACpBqzD,EAAmB5B,GACnB6B,EAAkBjB,GAClB,MACF,KAAKx/D,GAAKkN,YAAYE,SACpBozD,EAAmBxB,GAEnB,MACF,KAAKh/D,GAAKkN,YAAYG,KACpBmzD,EAAmB1B,GACnB2B,EAAkBX,GAMtB,IAAMY,EAAiB56C,kBAAQ,kBAAM26C,EACjC71C,YACA41C,EACAC,EAFA71C,CAGAgzC,IACA4C,EAAiB5C,KAAS,CAAC4C,EAAkBC,IAEjD,OAAOpkE,EAAAC,EAAAC,cAACmkE,EAADlrE,OAAAyV,OAAoB,CAAE4yD,aAAYG,aAAYnB,iBAA9C,CACL/xB,WAAY,aACZqzB,WAAYkC,EACZvD,cAAesD,EACf5D,iBAvCgC,SAACmE,GACjCnE,EAAiBmE,IAuCjBxG,UAAWA,EACX2D,cA7CsB,SAAC8C,GACvBpE,EAAiB,MACjBsB,EAAc8C,IA4Cd3C,cAvC6B,SAAC59D,GAC9B49D,EAAc59D,GACdm8D,EAAiB,YCzBfx6D,GAAYC,aAAW,SAAAC,GAAK,MAAK,CACrCC,KAAM,GAEN00B,aAAc,CACZl0B,KAAM,YAGN/C,OAAQsC,EAAM8C,QAAQ,EAAG,EAAG,EAAG,IAEjC8xB,YAAa,CACXq8B,cAAe,UAgCJ0N,GAzBA,SAAA1kE,GAAsC,IAAnCqV,EAAmCrV,EAAnCqV,KAAM+J,EAA6Bpf,EAA7Bof,QAAS0b,EAAoB96B,EAApB86B,cACzB5zB,EAAUrB,KAEhB,OAAIuZ,IAAY/J,EAAa,aAI3BnV,EAAAC,EAAAC,cAAC26B,GAAA,EAAD,CAAU1zB,UAAWH,EAAQlB,KAAM2E,QAASmwB,EAAehb,gBAAc,GACvE5f,EAAAC,EAAAC,cAACm5B,GAAA,EAAD,CAAclyB,UAAWH,EAAQwzB,cAC/Bx6B,EAAAC,EAAAC,cAAA,OAAK86B,IAAI,UAAU7zB,UAAWH,EAAQyzB,YAAaQ,IAAK9lB,EAAKc,YAE/DjW,EAAAC,EAAAC,cAACo5B,GAAA,EAAD,CACEz1B,QAASsR,EAAKgB,SACdpS,UAAS,iBAAAzI,OAAmBiC,aAAW4X,EAAKwC,UAAW,WCxBzDhS,GAAYC,aAAW,SAAAC,GAAK,MAAK,CACrCC,KAAM,CACJvB,WAAYsB,EAAMjC,QAAQW,WAAWlB,MACrCuD,QAAS,OACTC,cAAe,SACfd,OAAQ,QAEV0+D,gBAAiB,CACf77D,MAAO/C,EAAMjC,QAAQC,QAAQE,UAC7BQ,WAAYsB,EAAMjC,QAAQW,WAAW3J,QACrCkM,UAAW,SACX4B,QAAS7C,EAAM8C,QAAQ,EAAG,IAE5B+7D,WAAY,GAGZC,mBAAoB,CAClBphE,OAAQsC,EAAM8C,QAAQ,EAAG,KAE3ByvD,WAAY,CACVryD,OAAQ,OACR+tD,UAAW,SACXzmB,UAAW,UAEbg0B,KAAM,GAGNuD,UAAW,CACTh8D,MAAO/C,EAAMjC,QAAQI,KAAKD,UAC1B+C,UAAW,SACX4B,QAAS7C,EAAM8C,QAAQ,OAIrBk8D,GACM,aADNA,GAEK,UAFLA,GAGE,OA+GOC,GA5GG,SAAAhlE,GAAoE,IAAjEilE,EAAiEjlE,EAAjEilE,SAAUC,EAAuDllE,EAAvDklE,eAAgB9lD,EAAuCpf,EAAvCof,QAAS6kD,EAA8BjkE,EAA9BikE,aAChD/8D,GAD8ElH,EAAhBkkE,UACpDr+D,MADoE+D,EAEhDC,mBAAS,GAFuCC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAE7E83D,EAF6E53D,EAAA,GAEjE63D,EAFiE73D,EAAA,GAAAI,EAGzDL,mBAASk7D,IAHgD56D,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAG7Ei7D,EAH6Eh7D,EAAA,GAGpEi7D,EAHoEj7D,EAAA,GAAAuR,EAItD7R,oBAAS,GAJ6C8R,EAAAtiB,OAAA0Q,GAAA,EAAA1Q,CAAAqiB,EAAA,GAI7E2pD,EAJ6E1pD,EAAA,GAIpE2pD,EAJoE3pD,EAAA,GAM5EtG,EAASgd,qBAAWztB,IAApByQ,KAEFkwD,EAAa,SAACC,GACdA,IAAYL,EAASG,GAAYD,GAChCD,EAAQI,IAGXC,EAAyB,IAAf/D,EAAmBuD,EAAWC,EAG5C,OAFKO,IAASA,EAAU,IAEhBN,GACN,KAAKJ,GACCM,EAASI,EAAQ78B,KAAK,SAACzoC,EAAG0oC,GAAJ,OAAU1oC,EAAEkU,OAAO1Y,QAAUktC,EAAEx0B,OAAO1Y,UAC3D8pE,EAAQ78B,KAAK,SAACzoC,EAAG0oC,GAAJ,OAAUA,EAAEx0B,OAAO1Y,QAAUwE,EAAEkU,OAAO1Y,UACxD,MACF,KAAKopE,GACCM,EAASI,EAAQ78B,KAAK,SAACzoC,EAAG0oC,GAAJ,OAAU1oC,EAAE0X,UAAYgxB,EAAEhxB,YAC/C4tD,EAAQ78B,KAAK,SAACzoC,EAAG0oC,GAAJ,OAAUA,EAAEhxB,UAAY1X,EAAE0X,YAC5C,MACF,KAAKktD,GACCM,EACFI,EAAQ78B,KAAK,SAACzoC,EAAG0oC,GACf,OAAI1oC,EAAE0Y,KAAOgwB,EAAEhwB,MACL,EAEN1Y,EAAE0Y,KAAOgwB,EAAE68B,UACN,EAEF,IAITD,EAAQ78B,KAAK,SAACzoC,EAAG0oC,GACf,OAAIA,EAAEhwB,KAAO1Y,EAAE0Y,MACL,EAENgwB,EAAEhwB,KAAO1Y,EAAE0Y,KACN,EAEF,IAQf,OACE3Y,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,MACtB9F,EAAAC,EAAAC,cAACo1D,GAAD,KACEt1D,EAAAC,EAAAC,cAACoH,GAAA,EAAD,oBAEFtH,EAAAC,EAAAC,cAACulE,GAAD,CAAQtwD,KAAMA,IAEdnV,EAAAC,EAAAC,cAACiwC,GAAA,EAAD,CACE3kC,MAAOg2D,EACPl2D,SAAU,SAACnO,EAAG6rC,GAAJ,OAAYy4B,EAAcz4B,IACpCm5B,eAAe,UACfE,UAAQ,EACRr7D,QAAS,CAAEo7D,cAAep7D,EAAQq6D,OAElCrhE,EAAAC,EAAAC,cAACkwC,GAAA,EAAD,CAAKjpC,UAAWH,EAAQk4D,IAAK1zD,MAAO,EAAGG,MAAM,cAC7C3L,EAAAC,EAAAC,cAACkwC,GAAA,EAAD,CAAKjpC,UAAWH,EAAQk4D,IAAK1zD,MAAO,EAAGG,MAAM,cAE/C3L,EAAAC,EAAAC,cAACi5B,GAAA,EAAD,MACAn5B,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQy9D,iBACtBzkE,EAAAC,EAAAC,cAACwlE,GAAD,CAAgBC,IAAKR,EAASrqB,OAAQmqB,IAAYJ,GAAWp6D,QAAS,kBAAM46D,EAAWR,KAAYl5D,MAAOk5D,KAD5G,IAGE7kE,EAAAC,EAAAC,cAACwlE,GAAD,CAAgBC,IAAKR,EAASrqB,OAAQmqB,IAAYJ,GAAep6D,QAAS,kBAAM46D,EAAWR,KAAgBl5D,MAAOk5D,KAHpH,IAKE7kE,EAAAC,EAAAC,cAACwlE,GAAD,CAAgBC,IAAKR,EAASrqB,OAAQmqB,IAAYJ,GAAcp6D,QAAS,kBAAM46D,EAAWR,KAAel5D,MAAOk5D,MAElH7kE,EAAAC,EAAAC,cAACi5B,GAAA,EAAD,MACAn5B,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQoxD,aACpBl5C,KAAaqmD,GAA8B,IAAnBA,EAAQlpE,SAChC2D,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWH,EAAQ49D,UAAW/kD,UAAU,OAApD,mBAEDX,GACClf,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWH,EAAQ49D,UAAW/kD,UAAU,OAApD,cAED0lD,EAAQl3D,IAAI,SAACnK,EAAQiP,GAAT,OACXnT,EAAAC,EAAAC,cAACw3D,GAAD,CACEp9D,IAAG,iBAAAgB,OAAmB6X,GACtBjP,OAAQA,EACRqzD,eAAa,EACbC,eAAa,EACb/sD,QAAS,kBAAMs5D,EAAa7/D,EAAOvK,YAkBzCisE,GAAkBhgE,aAAW,SAAAC,GAAK,MAAK,CAC3CC,KAAM,CACJvC,OAAQsC,EAAM8C,QAAQ,EAAG,EAAG,EAAG,OAI7Bk9D,GAAiB,SAAA33D,GAAqC,IAAlC4sC,EAAkC5sC,EAAlC4sC,OAAQ6qB,EAA0Bz3D,EAA1By3D,IAAKl7D,EAAqByD,EAArBzD,QAASkB,EAAYuC,EAAZvC,MACxC3E,EAAU4+D,KAEVE,GAAgB,IAARH,EAAe,SAAM,SAEnC,OACE3lE,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CACEsV,KAAK,QACL3Y,UAAWH,EAAQlB,KACnB2E,QAASA,EAET7B,MAAOkyC,EAAS,YAAc,WAE7BnvC,EACD3L,EAAAC,EAAAC,cAAA,QAAMiP,MAAO,CAAEnG,QAAS8xC,EAAS,EAAI,IAClCgrB,KC3JHC,GAAsB34D,YAAQ3L,EAAY,CAC9CmG,MAAO,SAAAsG,GAAwB,IAArBC,EAAqBD,EAArBC,KAAMZ,EAAeW,EAAfX,SAEd,MAAO,CAAEY,KAAKhV,OAAAuV,EAAA,EAAAvV,CAAA,GAAMoU,EAASY,KAAhB,CAAsB63D,QAAS73D,QAI1C83D,GAA2B74D,YAAQzL,EAAgB,CACvDiG,MAAO,SAAA6P,GAAwB,IAArBtJ,EAAqBsJ,EAArBtJ,KAAMZ,EAAekK,EAAflK,SAEd,MAAO,CAAEY,KAAKhV,OAAAuV,EAAA,EAAAvV,CAAA,GAAMoU,EAASY,KAAhB,CAAsB+3D,eAAgB/3D,MAErDqjB,KAAM,SAAAK,GAAoBA,EAAjB1jB,KAAiB,IAAXgH,EAAW0c,EAAX1c,KACb,IACE,OAAOA,EAAKC,SAAS/Y,OAAS,EAEhC,MAAOc,GACL,OAAO,IAGXy0B,QAAS,SAAAmQ,GAAoBA,EAAjB5zB,KACV,MAAO,CACLJ,UAAW,CAAEqqD,WAFYr2B,EAAX5sB,KAEgBC,cAQ9B+wD,GAAe53C,YACnBw3C,GAEAE,GAHmB13C,CAnDE,SAAAzuB,GAAuC,IAApCqO,EAAoCrO,EAApCqO,KAAM41D,EAA8BjkE,EAA9BikE,aAAcC,EAAgBlkE,EAAhBkkE,UACpCgC,EAA4B73D,EAA5B63D,QAASE,EAAmB/3D,EAAnB+3D,eAEXnB,EAAWiB,GAAWA,EAAQvkE,YAAcukE,EAAQvkE,WAAWsS,gBAAkBiyD,EAAQvkE,WAAWsS,gBAAkB,GACtHixD,EAAiBkB,GAAkBA,EAAeE,YAAcF,EAAeE,YAAc,GAG7FlnD,EAAU+lB,QACb+gC,GAAWA,EAAQ9mD,SACnBgnD,GAAkBA,EAAehnD,SAGpC,OAAOlf,EAAAC,EAAAC,cAACmmE,GAAc,CAAEnnD,UAAS6lD,WAAUC,iBAAgBjB,eAAcC,gBA6D5D51D,gBAbS,SAACnG,EAAOL,GAC9B,MAAO,IAGkB,SAAAoqB,GAAQ,MAAK,CACtC+xC,aAAc,SAAC/wD,GACbgf,EAASpG,GAAqBjoB,GAAKwM,cAAcK,OAAQ,CAAEgd,aAAcxa,MAE3EgxD,UAAW,SAAChxD,GACVgf,EAASpG,GAAqBjoB,GAAKwM,cAAcE,IAAK,CAAEmd,aAAcxa,QAI3D5E,CAGb+3D,cCjFIxgE,GAAYC,aAAW,SAAAC,GAAK,MAAK,CACrCC,KAAM,CACJc,QAAS,OACT05B,WAAY,UAEdqN,KAAM,CAAE1kC,SAAU,GAClBjF,KAAM,CACJ8C,UAAW,SACXiY,UAAW,SACXrW,QAAS7C,EAAM8C,QAAQ,EAAG,OAwBf29D,GApBG,SAAAxmE,GAA2B,IAAxBqP,EAAwBrP,EAAxBqP,MAAOpG,EAAiBjJ,EAAjBiJ,KAAM/E,EAAWlE,EAAXkE,KAC1BgD,EAAUrB,KAChB,OACE3F,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,MACtB9F,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQ2mC,OACvB5kC,EACD/I,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWH,EAAQhD,KAAMuD,QAAQ,YAAYqB,MAAM,gBAAgBiX,UAAU,MAAM1Q,MAAOA,GACnGnL,GAEHhE,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQ2mC,SCpBxBhoC,GAAYC,aAAW,SAAAC,GAAK,MAAK,CACrCC,KAAM,CACJgB,UAAW,UAEby/D,YAAa,CACX39D,MAAO/C,EAAMjC,QAAQC,QAAQikB,aAC7Bjf,OAAM,aAAAvN,OAAeuK,EAAMjC,QAAQC,QAAQikB,cAC3CvjB,WAAYsB,EAAMjC,QAAQI,KAAKH,QAC/BN,OAAQ,QAEVijE,UAAW,MA0BEC,GAtBS,SAAA3mE,GAAiB,IAAd2K,EAAc3K,EAAd2K,QACnBzD,EAAUrB,KAChB,OACE3F,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,MACtB9F,EAAAC,EAAAC,cAAC66B,GAAA,EAAD,CAAQ5zB,UAAWH,EAAQu/D,aACzBvmE,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CAAY9yB,MAAM,UAAU6B,QAAS,SAAAtN,GACnCA,EAAEosB,iBACFpsB,EAAEsuB,kBACFhhB,MAEAzK,EAAAC,EAAAC,cAACwmE,GAAAzmE,EAAD,CAAW2I,MAAM,gBCjBrBjD,GAAYC,aAAW,SAAAC,GAAK,MAAK,CACrCC,KAAM,CACJC,OAAQ,OAER2C,QAAS7C,EAAM8C,QAAQ,GAAK,IAE9B6xB,aAAc,CACZ/xB,SAAU,SACV1C,OAAQ,OACRE,SAAU,YAEZ0gE,yBAA0B,CACxB1gE,SAAU,WACV+C,QAAS,GACT6tB,OAAQhxB,EAAM8C,QAAQ,GACtBi2B,MAAO/4B,EAAM8C,QAAQ,IAEvBi+D,eAAgB,CACdriE,WAAY,YACZ6yC,WAAY,qBACZxuC,MAAO,QACP3C,SAAU,WACVq6B,WAAY,SACZ15B,QAAS,OACTV,IAAK,EACLzC,MAAO,OACPg/B,aAAc58B,EAAM8C,QAAQ,IAE9Bo3B,OAAQ,CACNl3B,OAAQ,kBACRtF,OAAQsC,EAAM8C,QAAQ,EAAG,IAE3BwsB,MAAO,CACL7uB,KAAM,UACNmC,SAAU,UAEZo+D,WAAY,CACVn5B,aAAc,WACdrkC,WAAY,SACZZ,SAAU,UAEZ68B,IAAK,GAGL7K,YAAa,CACXh3B,MAAO,WAILqjE,GAEC,QAGDC,GAAW,SAAAjnE,GAAwE,IAArEiF,EAAqEjF,EAArEiF,MAAO+8D,EAA8DhiE,EAA9DgiE,WAAYkF,EAAkDlnE,EAAlDknE,aAAcC,EAAoCnnE,EAApCmnE,eAC3C/iE,GAD+EpE,EAApBonE,cACzCniE,EAAlBb,QAAQjJ,EAAU8J,EAAV9J,MAEV+L,EAAUrB,KACR8/B,EAAiBtT,qBAAWztB,IAA5B+gC,aACR,OACEzlC,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,MACtB9F,EAAAC,EAAAC,cAAC4oB,GAAA,EAAD,CAAO3hB,UAAWH,EAAQwzB,cACxBx6B,EAAAC,EAAAC,cAAConC,GAAD,CACErsC,MAAOA,EACPyqC,aAAc,CAAC,SAAU,QAAS,SAClCE,OAAK,EACLz+B,UAAWH,EAAQs+B,IACnB76B,QAAS,kBAAMu8D,EAAa9iE,EAAOvK,GAAIsB,EAAMtB,KAC7C8rC,aAAcA,IAEhBzlC,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQ4/D,gBACtB5mE,EAAAC,EAAAC,cAAC66B,GAAA,EAAD,CAAQtwB,QAAS,kBAAMw8D,EAAehsE,EAAM4c,YAAY1B,WAAWhP,UAAWH,EAAQ+4B,QACpF//B,EAAAC,EAAAC,cAAA,OAAK86B,IAAI,UAAU7zB,UAAWH,EAAQyzB,YAAaQ,IAAKhgC,EAAM4c,YAAY5B,YAE5EjW,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQmuB,OACtBn1B,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWH,EAAQ6/D,WAAYt/D,QAAQ,QAAQqB,MAAM,WAAW1E,EAAOyU,MACnF3Y,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,QAAQqB,MAAM,WAAW3N,EAAM4c,YAAY1B,SAA/D,IAA0E2wD,GAA1E,YACA9mE,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,UAAUqB,MAAM,WAAWrL,aAAWtC,EAAMgd,aAElEjY,EAAAC,EAAAC,cAACinE,GAAD,CAAiB18D,QAAS,kBAAMq3D,EAAW59D,EAAOvK,GAAIsB,EAAMtB,WAgBvDotE,MC1FTphE,GAAYC,aAAW,SAAAC,GAAK,MAAK,CACrCC,KAAM,CACJc,QAAS,OACTC,cAAe,SACfd,OAAQ,QAEVqhE,cAAe,CACbn+D,SAAU,EACVR,SAAU,UAEZ4+D,MAAO,CACLthE,OAAQ,OACRtC,MAAO,QAET6jE,cAAe,CACbr+D,SAAU,EAEV8tB,UAAW,iBAEb4W,KAAM,CACJ1kC,SAAU,MAkGCs+D,GA9FA,SAAAznE,GAGT,IAFJ0nE,EAEI1nE,EAFJ0nE,OAAQtoD,EAEJpf,EAFIof,QAAS4iD,EAEbhiE,EAFagiE,WAAYkF,EAEzBlnE,EAFyBknE,aAAcC,EAEvCnnE,EAFuCmnE,eAC3CC,EACIpnE,EADJonE,cAA4BpJ,GACxBh+D,EADW2nE,YACX3nE,EADwBg+D,WAAWppD,EACnC5U,EADmC4U,OAEjC1N,EAAUrB,KACV+6D,EAAU77D,mBACRib,EAAS+d,GAAiB6iC,GAA1B5gD,KACAsK,EAAWH,KAAXG,OAwDR,OACEpqB,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,MACtB9F,EAAAC,EAAAC,cAACo1D,GAAD,KACEt1D,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWH,EAAQ2mC,MAA/B,cAEF3tC,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQogE,cAAelgE,IAAKw5D,GAC1C1gE,EAAAC,EAAAC,cAACwnE,GAAA,EAAD,CACE3hE,OAAQ+Z,EAAK/Z,OACbtC,MAAOqc,EAAKrc,MACZ0D,UAAWH,EAAQqgE,MACnBM,SAAUH,EAAOnrE,OAAS,EAC1BurE,UApGQ,IAqGRC,YAlEY,SAAA35D,GAQd,IAEA0Z,EATJkhB,EAOI56B,EAPJ46B,MAGAxuC,GAII4T,EANJ45D,YAMI55D,EALJ65D,UAKI75D,EAJJ5T,KACA0tE,EAGI95D,EAHJ85D,OACA74D,EAEIjB,EAFJiB,MAGM84D,EAAMT,EAAO1+B,GAEnB,GAAIA,EAAQ0+B,EAAOnrE,QAAU4rE,EAC3BrgD,EAAU5nB,EAAAC,EAAAC,cAACgoE,GAAD,CACRnjE,MAAOyiE,EAAO1+B,GACdo+B,cAAeA,EACfF,aAAcA,EACdC,eAAgBA,EAChBnF,WAAYA,SAGX,GAAIh5B,IAAU0+B,EAAOnrE,OAAQ,CAEhC,IAAM8rE,EAAOzzD,GAAwB,IAAdA,EAAO,GAC9BkT,EAAU5nB,EAAAC,EAAAC,cAACkoE,GAAD,CAAWr/D,KAAM/I,EAAAC,EAAAC,cAACklC,GAAA,EAAD,CAAkBtlB,KAAM,GAAIssC,UAAW,EAAGxjD,MAAM,YAAc5E,KAAK,eAE9F,IAAMqkE,EAAcC,KAAgBN,EAAO//D,MAAM64D,UAAY3xD,EAAMjJ,IAE9DkkB,EAGI+9C,EACPvgD,EAAU5nB,EAAAC,EAAAC,cAACkoE,GAAD,CAAWpkE,KAAK,iBAGlBkb,GAAWmpD,GACnBvK,IAPAl2C,EAAU5nB,EAAAC,EAAAC,cAACkoE,GAAD,CAAWr/D,KAAM/I,EAAAC,EAAAC,cAACqK,GAAAtK,EAAD,MAAe+D,KAAK,2BAWnD,OACEhE,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQihE,IAAK3tE,IAAKA,EAAK6U,MAAOA,GAC3CyY,SCpFHg2C,GAAgB,GAyDhB2K,GAAgBn7D,YAAQ3K,GAAW,CACvCmF,MAAO,SAAAsG,GAAc,IAAXC,EAAWD,EAAXC,KACJA,EAAK/Q,OAAOtB,QAAQsB,MAAM+Q,EAAK/Q,OAGnC,IAAIorE,GAAgB,EAChBC,GAAc,EAmDlB,MAAO,CACLt6D,OACAq6D,gBACAC,cACAhB,YAlDkB,WAClBe,GAAgB,EAChB1sE,QAAQC,IAAI,cAAeoS,GACvBA,EAAKqG,SACP1Y,QAAQC,IAAI,qBAAZ5C,OAAAuV,EAAA,EAAAvV,CAAA,GAAuCgV,EAAKJ,UAA5C,CAAuD26D,MAAOv6D,EAAKqG,OAAOE,OAAO,MACjFvG,EAAK2vD,UAAU,CACb/vD,UAAU5U,OAAAuV,EAAA,EAAAvV,CAAA,GAAMgV,EAAKJ,UAAZ,CAAuB26D,MAAOv6D,EAAKqG,OAAOE,OAAO,KAE1DqpD,YAAa,SAACtnD,EAADgB,GAA+B,IAAtBumD,EAAsBvmD,EAAtBumD,gBAGpB,OAFAliE,QAAQC,IAAI,qBAAsB,CAAE0a,OAAMunD,oBAC1CwK,GAAgB,EACT,CACLh0D,OAAOrb,OAAAuV,EAAA,EAAAvV,CAAA,GACF6kE,EAAgBxpD,OADf,CAGJC,KAAI,GAAAnZ,OAAAnC,OAAAia,GAAA,EAAAja,CAAO6kE,EAAgBxpD,OAAOC,MAA9Btb,OAAAia,GAAA,EAAAja,CAAuCsd,EAAKjC,OAAOC,OACvDC,OAAQ,CAAC+B,EAAKjC,OAAOE,OAAO,GAAIspD,EAAgBxpD,OAAOE,OAAO,YAmCxEopD,UA1BgB,WAChB2K,GAAc,EACd3sE,QAAQC,IAAI,YAAaoS,GACrBA,EAAKqG,QACPrG,EAAK2vD,UAAU,CACb/vD,UAAU5U,OAAAuV,EAAA,EAAAvV,CAAA,GAAMgV,EAAKJ,UAAZ,CAAuB46D,IAAKx6D,EAAKqG,OAAOE,OAAO,KAExDqpD,YAAa,SAACtnD,EAADob,GAA+B,IAAtBmsC,EAAsBnsC,EAAtBmsC,gBAEpB,OADAyK,GAAc,EACP,CACLj0D,OAAOrb,OAAAuV,EAAA,EAAAvV,CAAA,GACF6kE,EAAgBxpD,OADf,CAEJC,KAAI,GAAAnZ,OAAAnC,OAAAia,GAAA,EAAAja,CAAOsd,EAAKjC,OAAOC,MAAnBtb,OAAAia,GAAA,EAAAja,CAA4B6kE,EAAgBxpD,OAAOC,OACvDC,OAAQ,CAACspD,EAAgBxpD,OAAOE,OAAO,GAAI+B,EAAKjC,OAAOE,OAAO,WAcxEwK,QAAS/Q,EAAK+Q,UAIlB0S,QAAS,SAAAmQ,KAAGvU,aAAH,MAAuB,CAC9Bzf,UAAW,CACT+F,MA7Ha,OA0JJ1F,gBArBS,SAACnG,EAAOL,GAC9B,MAAO,IAKkB,SAAAoqB,GAAQ,MAAK,CACtC+xC,aAAc,SAAC/wD,EAAU8e,GACvBE,EAASpG,GAAqBjoB,GAAKwM,cAAcK,OAAQ,CAAEgd,aAAcxa,EAAU8Y,aAAcgG,MAEnG82C,WAAY,SAACzyD,GACX6b,EAASpG,GAAqBjoB,GAAKwM,cAAcG,OAAQ,CAAE8gD,OAAQ,CAAE8N,IAAKv7D,GAAKkN,YAAYG,KAAMhN,KAAMmS,OAEzG6tD,UAAW,SAAChxD,EAAU8e,GACpBE,EAASpG,GAAuB,CAC9BW,KAAM5oB,GAAKsN,aAAaC,QAE1B8gB,EAASpG,GAAqBjoB,GAAKwM,cAAcE,IAAK,CAAEmd,aAAcxa,EAAU8Y,aAAcgG,QAInF1jB,CAIbm6D,GA5JkB,SAAAzoE,GAQd,IAPJqO,EAOIrO,EAPJqO,KAAM+Q,EAOFpf,EAPEof,QAAS4+C,EAOXh+D,EAPWg+D,UAAW2J,EAOtB3nE,EAPsB2nE,YAE1Br9C,GAKItqB,EANJ0oE,cAMI1oE,EALJsqB,QAEA25C,GAGIjkE,EAJJ2oE,YAII3oE,EAHJikE,cACAC,EAEIlkE,EAFJkkE,UACA4E,EACI9oE,EADJ8oE,WAEMnxC,EAAW5yB,mBADb6E,EAE8BC,mBAAS,MAFvCC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAEG00D,EAFHx0D,EAAA,GAEcu1D,EAFdv1D,EAAA,GAGJ6tB,EAASzyB,QAAUo5D,EAGnBh5D,oBAAU,WAMR,OADKqyB,EAASzyB,UAASyyB,EAASzyB,QAAUw3C,YAJ1C,YACOt9B,GAAWkL,GAAQq9C,IACpBhwC,EAASzyB,SAASm6D,EAAapiE,OAAOpB,KAAKic,MAAwB,IAAhBgmD,MAEmB,IAAhBA,KACrD,WACDnmC,EAASzyB,UACXlJ,QAAQC,IAAI,oBACZ4gD,cAAcllB,EAASzyB,SACvByyB,EAASzyB,QAAU,QAGtB,IAEH,IAAMwiE,EAASr5D,EAAKqG,QAASrG,EAAKqG,OAAOC,MAAa,GAChDC,EAASvG,EAAKqG,QAASrG,EAAKqG,OAAOE,OAAOrG,IAAI,SAAAwvC,GAAC,OAAInZ,SAASmZ,EAAG,OAAuB,CAAC,KAAM,MAEnG,OACE79C,EAAAC,EAAAC,cAAC2oE,GAAD1vE,OAAAyV,OAAY,CAAE44D,SAAQtoD,UAASxK,SAAQopD,YAAW2J,cAAa1D,gBAA/D,CACEmD,cAAe,aACfF,aAAcjD,EACdkD,eAAgB2B,EAChB9G,WAAYkC,iHC/CHp+D,gBAAW,SAAAC,GAAK,MAAK,CAClCC,KAAM,CACJC,OAAQ,OACRa,QAAS,OACT6B,SAAU,SACV5B,cAAe,UAEjBiiE,aAAc,CACZlgE,MAAO/C,EAAMjC,QAAQ8xD,OAAOC,MAC5Bve,WAAU,eAAA97C,OAAiBuK,EAAMjC,QAAQ8xD,OAAOqT,OAChD9iE,SAAU,WACVyC,QAAS7C,EAAM8C,QAAQ,GACvBzC,IAAK,MACLC,KAAM,MACNW,UAAW,SAEXiwB,UAAW,qCAEbiyC,UAAW,CACT/iE,SAAU,WACVC,IAAK,EACLC,KAAM,EACN1C,MAAO,OACPszB,UAAW,qBAEbkyC,wBAAyB,CACvB7xB,WAAY,OACZxuC,MAAO/C,EAAMjC,QAAQC,QAAQikB,cAE/BohD,SAAU,CACRjjE,SAAU,WACV+C,QAAS,GACTvF,MAAO,MACPsC,OAAQ,MACRG,IAAK,MACLC,KAAM,MAEN4wB,UAAW,qCAEboyC,OAAQ,CACNvgE,MAAO/C,EAAMjC,QAAQxG,MAAM0qB,cAE7BshD,SAAU,GAQVC,QAAS,CACPpjE,SAAU,WACVC,IAAK,EACLC,KAAM,EACNC,QAAS,EACTL,OAAQ,OACRtC,MAAO,QAET6lE,UAAW,CACTh4B,OAAQ,OACRG,KAAM,aAER83B,UAAW,CACT93B,KAAM,OACNH,OAAQ,QAEVk4B,oBAAqB,CACnBl4B,OAAQ,aAEVm4B,gBAAiB,CACfh4B,KAAM,YACNH,OAAQ,aAEVo4B,gBAAiB,CACf1gE,QAAS,GACTyoC,KAAM5rC,EAAMjC,QAAQxG,MAAM0G,KAC1BwtC,OAAQzrC,EAAMjC,QAAQxG,MAAMsqC,MAE9BiiC,qBAAsB,CACpB3gE,QAAS,GACTyoC,KAAM5rC,EAAMjC,QAAQC,QAAQC,KAC5BwtC,OAAQ,aAEVs4B,oBAAqB,GAGrBC,0BAA2B,CACzBtmE,OAAQsC,EAAM8C,QAAQ,IAExBmhE,WAAY,CACVvlE,WAAYsB,EAAMjC,QAAQC,QAAQC,KAClC8E,MAAO/C,EAAMjC,QAAQC,QAAQikB,cAE/BqwB,WAAY,CACV7xC,KAAM,MACNmC,SAAU,SACVxC,SAAU,eCxED25C,GACH,SADGA,GAEF,UAFEA,GAGC,aAHDA,GAKE,cALFA,GAMD,WAiQGmqB,GA9PI,SAAAjqE,GAC2C,IADxC2uC,EACwC3uC,EADxC2uC,WAAYyE,EAC4BpzC,EAD5BozC,aAAc9jB,EACctvB,EADdsvB,SAAU46C,EACIlqE,EADJkqE,UACxDC,EAA4DnqE,EAA5DmqE,gBAAiBxxB,EAA2C34C,EAA3C24C,SAAUyxB,EAAiCpqE,EAAjCoqE,SAAUC,EAAuBrqE,EAAvBqqE,iBAC/BnjE,EAAUrB,KACVykE,EAAgBvlE,mBAFsC6E,EAGhCC,mBAAS,MAHuBC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAGrDi2B,EAHqD/1B,EAAA,GAG7CygE,EAH6CzgE,EAAA,GAAAI,EAI3BL,mBAAS,MAJkBM,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAIrDsgE,EAJqDrgE,EAAA,GAI1CmqC,EAJ0CnqC,EAAA,GAAAuR,EAKpC7R,mBAAS,MAL2B8R,EAAAtiB,OAAA0Q,GAAA,EAAA1Q,CAAAqiB,EAAA,GAKrD+uD,EALqD9uD,EAAA,GAK/C+uD,EAL+C/uD,EAAA,GAOtD0tD,EAASoB,EAAO5mE,GAAKoM,QAAQG,eAC7Bu6D,EAAiB,SAAC9xD,GACtB,OAAKqxD,EACO36C,KAAWroB,EAAQ2R,GAAO3R,EAAO,GAAA1L,OAAIqd,GAAJrd,OAAW0uE,IAAcb,EAASniE,EAAO,GAAA1L,OAAIqd,EAAJ,WAAoB,MADnF3R,EAAQ2R,IAI3B+xD,EAAcl/C,sBAAYjtB,aAAS,SAACu2C,EAAajE,EAAY85B,GAAa,IAEtE/jD,EAAwBkuB,EAAxBluB,UAAWD,EAAamuB,EAAbnuB,SACbikD,EAAU/5B,EACZpgB,KAAKo6C,IAAKh6B,EAAWi6B,eAAe,GAAKH,EAAW95B,EAAWi6B,eAAe,GAAKH,EAA1E,KACT,EAEEI,EAAMJ,EAAW,EAAK95B,EAAWm6B,gBAAgB,GACjDC,EAAMN,EAAW,EAAK95B,EAAWm6B,gBAAgB,GACjDE,EAAY,CAChBtkD,EAAYmkD,EACZpkD,EAAWskD,EACXrkD,EAAYmkD,EACZpkD,EAAWskD,GAETL,IAAYL,GAAMC,EAAQI,GAC1BM,IAAcvrC,GAAQ0qC,EAAUa,GACpC92B,EAAYU,IACX,KAAM,IAELq2B,EAAQ,KACRC,EAAe,aACfC,EAAe,KAEnB,OAAQrB,GACN,KAAKpqB,GACHurB,EAAQhC,EAAS,KAAOnpE,EAAAC,EAAAC,cAACorE,GAAA,EAAD,CACtBnkE,UAAWH,EAAQmkE,MACnB3yC,mBAAiB,kBACjB/wB,QAAS,sEACT2lB,OAAQ,CACNptB,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CACElQ,IAAI,UACJsO,MAAM,UACN0B,SAAUigE,EAAO5mE,GAAKoM,QAAQG,eAC9BzF,QAAS,kBAAMw/D,EAAgBtqC,EAAQ2qC,KAJzC,qBAUJ,MACF,KAAK1qB,GACHurB,EAAQnrE,EAAAC,EAAAC,cAACorE,GAAA,EAAD,CACNnkE,UAAWH,EAAQmkE,MACnB3yC,mBAAiB,kBACjB/wB,QAAS,iBACT2lB,OAAQ,CACNptB,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQlQ,IAAI,UAAUsO,MAAM,UAAU6B,QAASguC,GAA/C,aAGJ,MACF,KAAKmH,GACHurB,EAAQnrE,EAAAC,EAAAC,cAACorE,GAAA,EAAD,CACNnkE,UAAWH,EAAQmkE,MACnB3yC,mBAAiB,kBACjB/wB,QAAS,uCACT2lB,OAAQ,CACNptB,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CAAQlQ,IAAI,UAAUsO,MAAM,YAAY6B,QAASy/D,GAAjD,0BAGJ,MACF,KAAKtqB,GACHurB,EAAQnrE,EAAAC,EAAAC,cAACorE,GAAA,EAAD,CACNnkE,UAAWH,EAAQmkE,MACnB3yC,mBAAiB,kBACjB/wB,QAAS,sDAEX,MACF,KAAKm4C,GACHurB,EAAQnrE,EAAAC,EAAAC,cAACorE,GAAA,EAAD,CACNnkE,UAAWH,EAAQ8iE,WACnBtxC,mBAAiB,kBACjB/wB,QAAS,kBAEX2jE,EAAejB,EACfkB,EAAe,IAMnB,IAAME,EAAWvB,IAAcpqB,GAE/B,OACE5/C,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,MACtB9F,EAAAC,EAAAC,cAACkH,GAAA,EAAD,MADF,IAEEpH,EAAAC,EAAAC,cAACsvC,GAAA,EAAD,CAAQvpC,SAAS,SAASkB,UAAWH,EAAQomC,QAC3CptC,EAAAC,EAAAC,cAACyf,GAAA,EAAD,CAASC,gBAAc,GACrB5f,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CAAYv0B,UAAWH,EAAQ8mC,WAAYllC,MAAM,UAAU6B,QAASgkC,EAAYnW,aAAW,QACzFt4B,EAAAC,EAAAC,cAACuvC,GAAAxvC,EAAD,OAEFD,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,YAAYqB,MAAM,UAAUzB,UAAWH,EAAQymC,cAAnE,0BAKJztC,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQmxC,WAAYjxC,IAAKkjE,GACvCpqE,EAAAC,EAAAC,cAACs8D,GAAD,CACEvmB,iBAAe,EACfhD,OAAQs4B,EACR51B,QAAS41B,EACTh1B,YAAY,EACZH,WAAYm1B,EACZC,iBAAiB,EACjBr1B,UAAWo1B,EACXj1B,aAAa,EACbrqB,SAAUinB,GAET,SAACjnB,EAAUlmB,EAAQtC,EAAOotC,GACzB,IAAM85B,EAAqC,GAA1Bl6C,KAAK0W,IAAIphC,EAAQtC,GAC5BgoE,EAAY,CAAE1lE,OAAQ4kE,EAAUlnE,MAAOknE,GACvCe,EAAa,CACjB11C,EAAIvyB,EAAQ,EAAMknE,EAAW,EAC7B10C,EAAIlwB,EAAS,EAAM4kE,EAAW,GAG1BgB,EAAgBv8C,EAASw8C,UAAYx8C,EAASy8C,YAAcz8C,EAAS08C,gBACvE,CACA18C,EAASw8C,SAAS,GAAKx8C,EAASy8C,WAAW,GAAKz8C,EAAS08C,gBAAgB,GACzE18C,EAASw8C,SAAS,GAAKx8C,EAASy8C,WAAW,GAAKz8C,EAAS08C,gBAAgB,IACvE,CAAC,EAAG,GAKV,OAHyB,IAArBH,EAAc,KAAUA,EAAc,GAAK,GAC/CjB,EAAYz+C,EAAU4kB,EAAY85B,GAGhC3qE,EAAAC,EAAAC,cAAA,OAAKiP,MAAO,CAAEpJ,SAAQtC,UACpBzD,EAAAC,EAAAC,cAAA,OAAKiH,UAAWsjE,EAAe,gBAAiBt7D,MAAOs8D,GACpDzB,IAAcpqB,IACb5/C,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWkoB,KAAWroB,EAAQgiE,UAAWG,EAASniE,EAAQmiE,OAAS,MAAOvgE,MAAM,UAAUrB,QAAQ,KAAKsY,UAAU,OAC1Hi5C,KAAQyR,GAAMxsE,OAAO,OADxB,WAIAisE,IAAcpqB,KAAsBupB,GACpCnpE,EAAAC,EAAAC,cAAC6rE,GAAA9rE,EAAD,CAAwBkH,UAAWH,EAAQkiE,SAAUtgE,MAAM,UAAU6B,QAAS,kBAAMw/D,EAAgBtqC,EAAQ2qC,MAE7GN,IAAcpqB,IAAqBupB,EAChCnpE,EAAAC,EAAAC,cAAA,WACAF,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYsB,MAAM,UAAUrB,QAAQ,QAAQsY,UAAU,OAAtD,KACOlc,GAAKoM,QAAQG,eADpB,WAGAlQ,EAAAC,EAAAC,cAACqK,GAAAtK,EAAD,CAAWkH,UAAWH,EAAQkiE,SAAUtgE,MAAM,YAC9C5I,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYsB,MAAM,UAAUrB,QAAQ,QAAQsY,UAAU,OAAtD,oCAIA,KAEHmqD,IAAcpqB,IACb5/C,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQ4iE,qBACtB5pE,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAU,YAAYyB,MAAM,UAAUrB,QAAQ,MAA1D,kBAGAvH,EAAAC,EAAAC,cAACklC,GAAA,EAAD,CACEj+B,UAAWH,EAAQ6iE,0BACnBtiE,QAAQ,cACRuY,KAAiB,GAAX6qD,EACNve,UAAsB,KAAXue,EACXn/D,MAAOilB,KAAKC,MAAM,IAAMi7C,EAAc,GAAKA,EAAc,IACzD/iE,MAAM,YAEPwmB,EAASw8C,UAAY5rE,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYsB,MAAM,UAAUrB,QAAQ,QAAQsY,UAAU,OAAtD,cACRuP,EAASw8C,SAAS,GADV,OACkBx8C,EAASw8C,SAAS,IAEzDx8C,EAASy8C,YAAc7rE,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYsB,MAAM,UAAUrB,QAAQ,QAAQsY,UAAU,OAAtD,WACbuP,EAASy8C,WAAW,GADP,OACez8C,EAASy8C,WAAW,IAE1Dz8C,EAAS08C,iBAAmB9rE,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYsB,MAAM,UAAUrB,QAAQ,QAAQsY,UAAU,OAAtD,kBACXuP,EAAS08C,gBAAgB,GADd,OACsB18C,EAAS08C,gBAAgB,KAI/E9B,IAAcpqB,IACb5/C,EAAAC,EAAAC,cAAA,WACEF,EAAAC,EAAAC,cAAC8rE,GAAA/rE,EAAD,CAAUkH,UAAWH,EAAQkiE,SAAUtgE,MAAM,aAGhDohE,IAAcpqB,IACb5/C,EAAAC,EAAAC,cAAA,WACEF,EAAAC,EAAAC,cAAC+rE,GAAAhsE,EAAD,CAAmBkH,UAAWH,EAAQkiE,SAAUtgE,MAAM,cAI5D5I,EAAAC,EAAAC,cAAA,OAAKgsE,MAAM,6BAA6B/8D,MAAO,CAAEpJ,SAAQtC,UACvDzD,EAAAC,EAAAC,cAAA,YACEF,EAAAC,EAAAC,cAAA,QAAMvG,GAAG,WAAW2D,EAAE,uBAAuBm0C,KAAK,QAAQH,OAAO,UAEnEtxC,EAAAC,EAAAC,cAAA,KAAGisE,SAAS,UAAUhlE,UAAWsjE,EAAe,cAC9CzqE,EAAAC,EAAAC,cAAA,QAAM5C,EAAC,yCAAAhC,OACWmI,EADX,IACoB,EADpB,OAAAnI,OAC2BmI,EAD3B,KAAAnI,OACoCyK,EADpC,OACiD,EADjD,KAAAzK,OACsDyK,EADtD,uCAAAzK,OAEMowE,EAAW11C,EAFjB,KAAA16B,OAEsBowE,EAAWz1C,EAFjC,sCAAA36B,OAGMmI,EAAQioE,EAAW11C,EAHzB,KAAA16B,OAG8BowE,EAAWz1C,EAHzC,qCAAA36B,OAIMmI,EAAQioE,EAAW11C,EAJzB,KAAA16B,OAI8ByK,EAAS2lE,EAAWz1C,EAJlD,sCAAA36B,OAKMowE,EAAW11C,EALjB,KAAA16B,OAKsByK,EAAS2lE,EAAWz1C,EAL1C,wCAQTj2B,EAAAC,EAAAC,cAAA,KAAGisE,SAAS,UAAUhlE,UAAWsjE,EAAe,cAC9CzqE,EAAAC,EAAAC,cAAA,QAAM5C,EAAC,oCAAAhC,OACMowE,EAAW11C,EADjB,KAAA16B,OACsBowE,EAAWz1C,EADjC,sCAAA36B,OAEMmI,EAAQioE,EAAW11C,EAFzB,KAAA16B,OAE8BowE,EAAWz1C,EAFzC,qCAAA36B,OAGMmI,EAAQioE,EAAW11C,EAHzB,KAAA16B,OAG8ByK,EAAS2lE,EAAWz1C,EAHlD,sCAAA36B,OAIMowE,EAAW11C,EAJjB,KAAA16B,OAIsByK,EAAS2lE,EAAWz1C,EAJ1C,4CAYlBk1C,GACCnrE,EAAAC,EAAAC,cAACwoB,GAAA,EAAD,CACEC,aAAc,CAAEC,SAAU,SAAUC,WAAY,UAChDje,MAAI,EACJE,QAASsgE,EACTr+B,iBAAkBs+B,GAEjBF,MC7FPiB,GAAgBh/D,YAAQlL,GAAiB,CAC7C0F,MAAO,SAAAsG,GAAwB,IAArBC,EAAqBD,EAArBC,KAAMZ,EAAeW,EAAfX,SACVY,EAAK/Q,OAAOtB,QAAQsB,MAAM+Q,EAAK/Q,OACnCtB,QAAQC,IAAI,+BAAgC,CAAEoS,OAAMZ,aACpD,KAEOY,EAAK+Q,UAAY/Q,EAAK/Q,OAAS+Q,EAAKk+D,mBAAqBl+D,EAAKk+D,kBAAkBt4D,gBAAgB1X,OAAS,GAAK8R,EAAKk+D,kBAAkBr4D,WACxIzG,EAAS++D,aAAa,CAAEC,IAAK,GAAIrtD,SAAS,IAE1C/Q,EAAK2vD,UAAU,CACb/vD,UAAU5U,OAAAuV,EAAA,EAAAvV,CAAA,GAAMgV,EAAKJ,UAAZ,CAAuBiG,UAAW7F,EAAKk+D,kBAAkBr4D,YAElE+pD,YAAa,SAACtnD,EAADgB,GAA+B,IAAtBumD,EAAsBvmD,EAAtBumD,gBAEpB,MAAO,CACLqO,kBAAkBlzE,OAAAuV,EAAA,EAAAvV,CAAA,GACb6kE,EAAgBqO,kBADJ,CAEft4D,gBAAe,GAAAzY,OAAAnC,OAAAia,GAAA,EAAAja,CAAOsd,EAAK41D,kBAAkBt4D,iBAA9B5a,OAAAia,GAAA,EAAAja,CAAkD6kE,EAAgBqO,kBAAkBt4D,yBAMpG5F,EAAK+Q,SAAW/Q,EAAK/Q,MAE5BmQ,EAAS++D,aAAa,CAAEC,IAAK,GAAIrtD,SAAS,KAG1CpjB,QAAQC,IAAI,mCACRoS,GAAQA,EAAKk+D,mBACf9+D,EAAS++D,aAAa,CAAEC,IAAKp+D,EAAKk+D,kBAAkBt4D,gBAAgB1F,IAAI,SAAAmF,GAAC,OAAIA,EAAE7Z,KAAKulB,SAAS,KAInG,MAAO/hB,GACLrB,QAAQsB,MAAM+Q,GACdrS,QAAQsB,MAAMD,GAEhB,MAAO,CACLgR,OACA+Q,QAAS/Q,EAAK+Q,UAGlBsS,KAAM,SAAAK,GAAA,OAAAA,EAAG8N,QACT/N,QAAS,SAAAmQ,GAAA,MAAiB,CACxBh0B,UAAW,CACT4xB,OAFKoC,EAAGpC,OAGR7rB,MAAO,SAkDP04D,GAzCuBp/D,YAAQvK,GAAgB,CACnD2uB,KAAM,SAAA6Q,GAAA,OAAAA,EAAG1oC,IACTiO,MAAO,SAAAu2C,GAAwB,IAArBhwC,EAAqBgwC,EAArBhwC,KAAMZ,EAAe4wC,EAAf5wC,SACVY,EAAK/Q,OAAOtB,QAAQsB,MAAM+Q,EAAK/Q,OAEnC,IAAI8G,EAAS,KACb,IACE,IAAKiK,EAAK+Q,UAAY/Q,EAAK/Q,MAAO,CAChC8G,EAASiK,EAAKjK,OAEd,IAAMknC,EAAO,GACbA,EAAK+mB,KAAKjuD,EAAO2T,YAAY5B,UAC7Bm1B,EAAK+mB,KAAKjuD,EAAO4T,YAAY7B,UAC7B/R,EAAO+O,OAAOuH,QAAQ,SAAAtH,GACpBk4B,EAAK+mB,KAAKj/C,EAAG2E,YAAY5B,UACzBm1B,EAAK+mB,KAAKj/C,EAAG4E,YAAY7B,UAEzBtS,GAAKoM,QAAQC,kBACV3B,IAAI,SAAAyR,GAAI,OAAIsrB,EAAK+mB,KAAL,GAAA72D,OAAa4X,EAAGkF,MAAMC,MAAtB/c,OAA6B4X,EAAGkF,MAAM0H,SAGvDvS,EAASmkB,OAATv4B,OAAAia,GAAA,EAAAja,CAAoB,IAAImc,IAAI81B,MAGhC,MAAOjuC,GACLrB,QAAQC,IAAI,2CAA4C,CAAEoS,OAAMhR,MAChErB,QAAQsB,MAAMD,GAEhB,MAAO,CACLgR,OACA+Q,QAAS/Q,EAAK+Q,QACdhb,WAGJ0tB,QAAS,SAAAwsB,GAAA,MAAa,CACpBrwC,UAAW,CACTpU,GAFKykD,EAAGzkD,OAOaw0D,CAAqB,kBAAM,OAChDse,GAAWL,GAAc,kBAAM,OAuBtBh+D,gBAlBS,SAACnG,EAAOL,GAC9B,IAAM8kE,EAAkBzkE,EAAMoG,IAAI9R,OAAO,GAAGgxB,MADJo/C,EAEA1kE,EAAM8lB,QAC9C,MAAO,CAAE2+C,kBAAiBx/C,kBAHcy/C,EAEhCz/C,kBACqCjB,SAHL0gD,EAEb1gD,WAIF,SAAA+F,GAAQ,MAAK,CACtCyc,WAAY,WACVzc,EAASpG,OAEXghD,oBAAqB,SAAC1gD,GACpB8F,EAASpG,GAA4BM,KAEvC2gD,mBAAoB,SAAC5gD,GACnB+F,EAASpG,GAA2BK,OAIzB7d,CA1RW,SAAAtO,GAGpB,IAFJ2uC,EAEI3uC,EAFJ2uC,WACAi+B,EACI5sE,EADJ4sE,gBAAiBx/C,EACbptB,EADaotB,kBAAmBjB,EAChCnsB,EADgCmsB,SAAU2gD,EAC1C9sE,EAD0C8sE,oBAAqBC,EAC/D/sE,EAD+D+sE,mBAC/DnjE,EAC8BC,mBAASsiB,GAAYiB,EAAoB0yB,GAAgBA,IADvFh2C,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GACGsgE,EADHpgE,EAAA,GACckjE,EADdljE,EAAA,GAEEmjE,EAAaloE,mBACXulB,EAAW+H,qBAAWztB,IAAtB0lB,OAHJpgB,EAMwBL,mBAAS,MANjCM,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAMG21B,EANH11B,EAAA,GAMWogE,EANXpgE,EAAA,GAAAuR,EAQ8B7R,mBAAS,MARvC8R,EAAAtiB,OAAA0Q,GAAA,EAAA1Q,CAAAqiB,EAAA,GAQGwxD,EARHvxD,EAAA,GAQc6wD,EARd7wD,EAAA,GAAA6vB,EAUwC3hC,mBAAS,MAVjD4hC,EAAApyC,OAAA0Q,GAAA,EAAA1Q,CAAAmyC,EAAA,GAUG2hC,EAVH1hC,EAAA,GAUmB2hC,EAVnB3hC,EAAA,GAAAke,EAWoC9/C,mBAAS,IAX7C+/C,EAAAvwD,OAAA0Q,GAAA,EAAA1Q,CAAAswD,EAAA,GAWG0jB,EAXHzjB,EAAA,GAWiB0jB,EAXjB1jB,EAAA,GAAA4Q,EAa4B3wD,mBAAS,CAAC,EAAG,IAbzC4wD,EAAAphE,OAAA0Q,GAAA,EAAA1Q,CAAAmhE,EAAA,GAaGsR,EAbHrR,EAAA,GAaa8S,EAbb9S,EAAA,GAAA+S,EAcgC3jE,mBAAS,CAAC,EAAG,IAd7C4jE,EAAAp0E,OAAA0Q,GAAA,EAAA1Q,CAAAm0E,EAAA,GAcGzB,EAdH0B,EAAA,GAceC,EAdfD,EAAA,GAAAE,EAe0C9jE,mBAAS,CAAC,EAAG,IAfvD+jE,EAAAv0E,OAAA0Q,GAAA,EAAA1Q,CAAAs0E,EAAA,GAeG3B,EAfH4B,EAAA,GAeoBC,EAfpBD,EAAA,GAkBEE,EAAc/oE,mBACpB+oE,EAAY5oE,QAAU,CAAE4mE,WAAUC,aAAYC,kBAAiBkB,YAAWG,gBAE1E,IAAMU,EAAa,kBAAMR,EAAY,CAACO,EAAY5oE,QAAQ4mE,SAAS,GAAK,EAAGgC,EAAY5oE,QAAQ4mE,SAAS,MAElGkC,EAAoB,WACxBH,EAAmB,CAACC,EAAY5oE,QAAQ8mE,gBAAgB,GAAK,EAAG8B,EAAY5oE,QAAQ8mE,gBAAgB,MAIhGiC,EAAe,SAAC3iC,GACpB,IAHwB5sC,EAGlBwvE,EAAUJ,EAAY5oE,QAAQ6mE,WAC9BoC,EAASL,EAAY5oE,QAAQgoE,UAAUT,IACvC2B,EAAYN,EAAY5oE,QAAQmoE,aACtC,GAAI/hC,EAAM,CACR,IAAI+iC,EAAW,EACf/iC,EAAK/8B,IAAI,SAAAwiB,IACyB,IAA5Bq9C,EAAU9xE,QAAQy0B,KACpBs9C,IACAf,EAAe,GAAA9xE,OAAAnC,OAAAia,GAAA,EAAAja,CAAK+0E,GAAL,CAAgBr9C,KAC/Bk8C,EAAW/nE,QAAQopE,SAAS,kBAAMC,GAAY,MAAOx9C,KAClD3Z,KAAK42D,GAELrqD,MAAMqqD,MAfStvE,EAkBL2vE,EAlBaR,EAAmB,CAACC,EAAY5oE,QAAQ8mE,gBAAgB,GAAI8B,EAAY5oE,QAAQ8mE,gBAAgB,GAAKttE,IAqBjIwvE,GAAWC,EAAOD,EAAQ,MAC5Bd,EAAkBe,EAAOD,EAAQ,GAAK,IACtCR,EAAc,CAACQ,EAAQ,GAAK,EAAGA,EAAQ,OAOrCM,EAAa7kD,kBAAQ,kBAAMW,EAAS4/C,EAAYpqB,IAAgB,CAACx1B,EAAQ4/C,IAEzEuE,EAAiB9kD,kBAAQ,kBAAMzpB,EAAAC,EAAAC,cAACusE,GAAD,CAAU9sC,OAAQA,EAAQ2sC,aAAcA,KAAkB,CAAC3sC,IAC1F6uC,EAAmB/kD,kBAAQ,kBAAMzpB,EAAAC,EAAAC,cAACssE,GAAD,CAAoB7yE,GAAIszE,EAAgBv7C,OAAQq8C,KAAkB,CAACd,IAapGx0B,EAAW,WACfq0B,EAAaltB,IACbyqB,EAAU,MACViC,EAAa,MACbe,EAAY,CAAC,EAAG,IAChBG,EAAc,CAAC,EAAG,IAClBG,EAAmB,CAAC,EAAG,IACvBP,EAAgB,IAChBL,EAAW/nE,QAAQoS,KAAK,CAAEq3D,iBAAiB,IAC3C1B,EAAW/nE,QAAU,KACrB+nE,EAAW/nE,QAAU,IAAI0pE,KAAW,CAAEC,cAAe,KAwCvD,OApCAvpE,oBAAU,WACR2nE,EAAW/nE,QAAU,IAAI0pE,KAAW,CAAEC,cAAe,KACpD,IAGHvpE,oBAAU,WACR,GAAIu6B,EAAQ,CACV,IAAMivC,EA8NL,SAAmBjvC,EAAQkvC,GAGhC,IAFA,IAAMD,EAAQ,GAELpiD,EAAOqiD,EAAU,GAAIriD,GAAQqiD,EAAU,GAAIriD,IAOlD,IANA,IAAMsiD,EAAYC,qBAAUpvC,EAAO,GAAInT,GACjCwiD,EAAaD,qBAAUpvC,EAAO,GAAInT,GAElCyiD,EAAWC,oBAASvvC,EAAO,GAAInT,GAC/B2iD,EAAcD,oBAASvvC,EAAO,GAAInT,GAE/BwJ,EAAI84C,EAAW94C,GAAKg5C,EAAYh5C,IACvC,IAAK,IAAIC,EAAIg5C,EAAUh5C,GAAKk5C,EAAal5C,IAEvC24C,EAAMzc,KAAKid,GAAWvhE,qGAAmC2e,EAAMwJ,EAAGC,IAClE24C,EAAMzc,KAAKid,GAAWvhE,iEAAoC2e,EAAMwJ,EAAGC,IAIzE,OAAO24C,EAhPWS,CAAS1vC,EAAQ,CAAC,EAAGh8B,GAAKoM,QAAQE,yBAC1C5T,EAASuyE,EAAMvyE,OACrB,GAAe,IAAXA,EAAc,OAzEHmC,EA0ELnC,EA1EagxE,EAAY,CAACO,EAAY5oE,QAAQ4mE,SAAS,GAAIgC,EAAY5oE,QAAQ4mE,SAAS,GAAKptE,IA2EvGowE,EAAMp0D,QAAQ,SAAA4vB,GACZ2iC,EAAW/nE,QAAQopE,SAAS,kBAAMC,GAAY,MAAOjkC,KAClDlzB,KAAK22D,GAELpqD,MAAMoqD,KA/EG,IAACrvE,GAkFhB,CAACmhC,IAGJv6B,oBAAU,WAEJ4nE,GAAaA,EAAUT,MAErBS,EAAUT,IAAIlwE,OAAS,GAAG6wE,EAAkBF,EAAUT,IAAI,IAC9DiB,EAAc,CAAC,EAAGR,EAAUT,IAAIlwE,SAChCsxE,EAAmB,CAAC,EAAG,MAExB,CAACX,IAEJ5nE,oBAAU,WACR,IAAMkqE,EAAW,CAAC1D,EAAS,GAAKC,EAAW,GAAKC,EAAgB,GAAIF,EAAS,GAAKC,EAAW,GAAKC,EAAgB,IAC9GwD,EAAS,GAAK,GAAKA,EAAS,KAAOA,EAAS,KAnDhDxC,EAAaltB,IACbgtB,GAAoB,KAmDnB,CAAChB,EAAUC,EAAYC,IAGxB9rE,EAAAC,EAAAC,cAACF,EAAAC,EAAMwF,SAAP,KACG+oE,EACAD,EACDvuE,EAAAC,EAAAC,cAACqvE,GAAD,CACE9gC,WAAY,WACVgK,IACAhK,KAEFw7B,gBAtEU,SAACtqC,EAAQ1T,GACvB6gD,EAAaltB,IACbyqB,EAAU1qC,GACVktC,EAAmB5gD,IAoEfwsB,SAAUA,EACVvF,aAAcjnB,GAAYygD,EAC1Bt9C,SAAU,CAAEw8C,WAAUC,aAAYC,mBAClC9B,UAAWsE,EAEXnE,iBAAkB,WAChB2C,EAAaltB,KAEfsqB,SAAU,WACR4C,EAAaltB,IACbgtB,GAAoB,SAmJ9B,SAASyB,GAAamB,EAAQ3+C,GAC5B,OAAO,IAAIzW,QAAQ,SAACC,EAASgX,GAC3B,IAAIo+C,EAAM,IAAIC,eACdD,EAAI7kE,KAAK4kE,EAAQ3+C,GACjB4+C,EAAIE,OAAS,WACPF,EAAIG,QAAU,KAAOH,EAAIG,OAAS,IAAKv1D,EAAQo1D,EAAIn+C,UAClDD,EAAO,IAAIv2B,MAAM20E,EAAII,cAE5BJ,EAAIK,QAAU,WACZz+C,EAAO,IAAIv2B,MAAM20E,EAAII,cAEvBJ,EAAIvpD,SAID,IAAMkpD,GAAa,SAACv+C,EAAKrE,EAAMwJ,EAAGC,GAEvC,OADepF,EAAG,iBAAAv1B,OAAoBuS,yEACxBkiE,QAAQ,cAAf,GAAAz0E,OAAiCkxB,EAAjC,KAAAlxB,OAAyC06B,EAAzC,KAAA16B,OAA8C26B,8BCpSjDtwB,GAAYC,aAAW,SAAAC,GAAK,MAAK,CACrCC,KAAM,CACJc,QAAS,OACTb,OAAQ,OACRc,cAAe,UAEjBmpE,OAAQ,CACNnnE,OAAQ,gBACRH,QAAS7C,EAAM8C,QAAQ,GACvB1C,SAAU,WACV2C,MAAO,QACPI,QAAS,GACT5C,OAAQ,EACR3C,MAAO,MACPsC,OAAQ,MACRG,IAAK,MACLC,KAAM,MACN2wB,gBAAiB,UACjBC,UAAW,qCAEbk5C,WAAY,CACVhqE,SAAU,WACV2C,MAAO,QACP9B,UAAW,SACXV,OAAQ,EACR3C,MAAO,MACPsC,OAAQ,MACRG,IAAK,MACLC,KAAM,MACN2wB,gBAAiB,UACjBC,UAAW,qCAEbm5C,UAAW,CACTjqE,SAAU,WACVG,OAAQ,GAEVgnC,OAAQ,GAGR3mC,MAAO,CACLiC,QAAS7C,EAAM8C,QAAQ,GACvB5C,OAAQ,OACRkD,SAAU,EACVR,SAAU,UAEZ0nE,SAAU,CACRznE,QAAS7C,EAAM8C,QAAQ,GACvBpF,OAAQsC,EAAM8C,QAAQ,IAExBynE,aAAc,CACZnnE,SAAU,EACVP,QAAS7C,EAAM8C,QAAQ,IAEzB0nE,gBAAiB,CACf5sE,MAAO,MACPF,OAAQ,SACR0C,SAAU,WAEVowB,YAAa,CACXzO,QAAS,IACThhB,QAAS,QACT+3C,WAAY,SAGhB2xB,qBAAsB,CACpB/rE,WAAY,SAEdgsE,SAAU,CACRhsE,WAAY4N,KAAI,KAChBvJ,MAAO,SAET4nE,aAAc,CACZjsE,WAAY0N,KAAM,KAClBrJ,MAAO,SAET6nE,SAAU,GAGVjsB,MAAO,CACLz+C,OAAQ,OACRtC,MAAO,OACPqzD,cAAe,UAqJJ4Z,GAzIE,SAAA5wE,GAAsC,IAAnC2uC,EAAmC3uC,EAAnC2uC,WAAYoU,EAAuB/iD,EAAvB+iD,UAAWt7B,EAAYznB,EAAZynB,MACnCvgB,EAAUrB,KADqC+D,EAEbC,qBAFaC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAE9CinE,EAF8C/mE,EAAA,GAEhCgnE,EAFgChnE,EAAA,GAAAI,EAK/BL,mBAAS,MALsBM,EAAA9Q,OAAA0Q,GAAA,EAAA1Q,CAAA6Q,EAAA,GAK9CnN,EAL8CoN,EAAA,GAKzC4mE,EALyC5mE,EAAA,GAAAuR,EAM7B7R,mBAAS,MANoB8R,EAAAtiB,OAAA0Q,GAAA,EAAA1Q,CAAAqiB,EAAA,GAM9Cs1D,EAN8Cr1D,EAAA,GAMxCs1D,EANwCt1D,EAAA,GAAA8qC,EAOC3D,GAAUguB,EAvG9C,IACC,KAsGX9tB,EAP6CyD,EAO7CzD,YAAaa,EAPgC4C,EAOhC5C,eAAgBX,EAPgBuD,EAOhBvD,aAG/BguB,EAAcxlD,sBAAYjtB,aAASolD,EAAgB,KAAM,CAACX,EAAcF,IAwC9E,OAtCA19C,oBAAU,WACR,IAAM6rE,EAAI,eAAA/iE,EAAA/U,OAAAuc,EAAA,EAAAvc,CAAAwc,EAAA1V,EAAA2V,KAAG,SAAAC,IAAA,IAAAq7D,EAAA/0E,EAAAG,EAAA60E,EAAA,OAAAx7D,EAAA1V,EAAAsW,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cACPw6D,EAAc,KADP16D,EAAAC,KAAA,EAAAD,EAAAE,KAAA,EAGW06D,GAAaT,GAHxB,OAGTO,EAHS16D,EAAAM,KAAAN,EAAAE,KAAA,gBAAAF,EAAAC,KAAA,EAAAD,EAAA4F,GAAA5F,EAAA,SAMT1a,QAAQsB,MAARoZ,EAAA4F,IANS,WAAA5F,EAAAC,KAAA,IAULqsC,GAAgBouB,EAVX,CAAA16D,EAAAE,KAAA,eAU8B,IAAI5b,MAAM,0CAVxC,YAWLo2E,EAXK,CAAA16D,EAAAE,KAAA,YAaDva,EAAW+0E,EAAY/iE,KAAK/R,QADrB,uBAC0CC,OACjDC,EAAU40E,EAAY/iE,KAAK5R,MAAMJ,IACjCg1E,EAAah2E,KAAKyB,MAAMy0E,UAAU/0E,KACxB/B,MAAS42E,EAAWx3E,GAhB7B,CAAA6c,EAAAE,KAAA,eAgBuC,IAAI5b,MAAM,mCAhBjD,QAiBPi2E,EAAQI,GACRN,EAAO,MACP/0E,QAAQC,IAAI,SAAUm1E,GAnBf,QAAA16D,EAAAE,KAAA,iBAAAF,EAAAC,KAAA,GAAAD,EAAAsa,GAAAta,EAAA,UAuBTq6D,EAAO,uBACP/0E,QAAQsB,MAARoZ,EAAAsa,IAxBS,yBAAAta,EAAAY,SAAAvB,EAAA,yBAAH,yBAAA3H,EAAA1O,MAAAtG,KAAA8E,YAAA,IA2BNglD,GAAiBF,GAAgBjmD,GAAQi0E,IACtCH,GAAiBA,EAAaxiE,MAEjC8iE,IACAD,KAHuCA,MAM1C,CAAChuB,EAAc2tB,EAAc9zE,EAAKi0E,IAInC9wE,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,MAGtB9F,EAAAC,EAAAC,cAACkH,GAAA,EAAD,MAHF,IAIEpH,EAAAC,EAAAC,cAACsvC,GAAA,EAAD,CAAQvpC,SAAS,SAASkB,UAAWH,EAAQomC,QAC3CptC,EAAAC,EAAAC,cAACyf,GAAA,EAAD,CAASC,gBAAc,GACrB5f,EAAAC,EAAAC,cAACw7B,GAAA,EAAD,CAAYv0B,UAAWH,EAAQ8mC,WAAYllC,MAAM,UAAU6B,QAASgkC,EAAYnW,aAAW,QACzFt4B,EAAAC,EAAAC,cAACuvC,GAAAxvC,EAAD,OAEFD,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYC,QAAQ,YAAYqB,MAAM,UAAUzB,UAAWH,EAAQymC,cAAnE,qBAKJztC,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQP,OACtBzG,EAAAC,EAAAC,cAAC4oB,GAAA,EAAD,CACE3hB,UAAWkoB,KAAWroB,EAAQqpE,gBAAiBvtB,EAAc97C,EAAQspE,qBAAuB,OAE5FtwE,EAAAC,EAAAC,cAAC01B,GAAD,CAAYzuB,UAAWH,EAAQgpE,SAS/BhwE,EAAAC,EAAAC,cAAA,SACEsmD,UAAQ,EACRC,aAAW,EACXC,OAAK,EACL/sD,GAAG,SACHwN,UAAWH,EAAQw9C,SAGvBxkD,EAAAC,EAAAC,cAAC4oB,GAAA,EAAD,CAAO3hB,UAAWH,EAAQmpE,UACxBnwE,EAAAC,EAAAC,cAACoH,GAAA,EAAD,qFAGJtH,EAAAC,EAAAC,cAACwoB,GAAA,EAAD,CACEC,aAAc,CAAEC,SAAU,SAAUC,WAAY,UAChDje,OAAQ/N,EACRkwC,iBAAkB,IAClBjiC,QAAS,WACP+lE,EAAO,MACPD,EAAgB,QAGlB5wE,EAAAC,EAAAC,cAACorE,GAAA,EAAD,CACEnkE,UAAWH,EAAQupE,SACnB9oE,QAASzH,EAAAC,EAAAC,cAAA,QAAMiH,UAAWH,EAAQypE,UAAW5zE,OAG/C0qB,GACAvnB,EAAAC,EAAAC,cAACwoB,GAAA,EAAD,CACEC,aAAc,CAAEC,SAAU,SAAUC,WAAY,UAChDje,KAAMk4C,GAEN9iD,EAAAC,EAAAC,cAACorE,GAAA,EAAD,CACEnkE,UAAWH,EAAQupE,SACnB9oE,QAASzH,EAAAC,EAAAC,cAAA,QAAMiH,UAAWH,EAAQypE,UAAzB,oDAIfzwE,EAAAC,EAAAC,cAACwoB,GAAA,EAAD,CACEC,aAAc,CAAEC,SAAU,SAAUC,WAAY,UAChDje,OAAQkmE,EACR/jC,iBAAkB,IAClBjiC,QAAS,kBAAM+3C,EAAUiuB,EAAKv2E,KAAMu2E,EAAKn3E,MAEzCqG,EAAAC,EAAAC,cAACorE,GAAA,EAAD,CACEnkE,UAAWH,EAAQwpE,aACnB/oE,QAASzH,EAAAC,EAAAC,cAAA,QAAMiH,UAAWH,EAAQypE,UAAzB,6BAgBbW,GAAe,SAAA35D,GAAuC,IAApCtJ,EAAoCsJ,EAApCtJ,KAAM82C,EAA8BxtC,EAA9BwtC,YAAaF,EAAiBttC,EAAjBstC,WACzC,OAAO,IAAI3qC,QAAQ,SAACC,EAASgX,GAC3B,IAEEhX,EADei3D,KAAKnjE,EAAM42C,EAAYE,IAGxC,MAAO9nD,GACLk0B,EAAOl0B,4BCnQPwI,GAAYC,aAAW,SAAAC,GAAK,MAAK,CACrCC,KAAM,CACJvB,WAAY,QACZqE,MAAO,QACP9B,UAAW,aAyCAyqE,GArCI,WACjB,IAAMvqE,EAAUrB,KADOw2B,EAEUhK,qBAAWztB,IAApC0lB,EAFe+R,EAEf/R,OAAQC,EAFO8R,EAEP9R,aAFO3gB,EAGSC,qBAHTC,EAAAzQ,OAAA0Q,GAAA,EAAA1Q,CAAAuQ,EAAA,GAGhB8nE,EAHgB5nE,EAAA,GAGN6nE,EAHM7nE,EAAA,GAIjB6tB,EAAW5yB,mBAEX6sE,EAAe,WACnB,IAAMpwB,EAAUpjD,KAAOmsB,EAAc,KAAKlsB,UAE1CszE,EAAYnwB,IAERqwB,EAAa,WACbl6C,EAASzyB,UACX23C,cAAcllB,EAASzyB,SACvByyB,EAASzyB,QAAU,OAevB,OAXAI,oBAAU,WAMR,OALIilB,IAAiBoN,EAASzyB,SAC5B0sE,IACAj6C,EAASzyB,QAAUw3C,YAAYk1B,EA/Bf,MAiCRrnD,GAAasnD,IAChB,WACLA,MAED,CAACtnD,IAEAD,EAAe,KAEjBpqB,EAAAC,EAAAC,cAACoH,GAAA,EAAD,CAAYH,UAAWH,EAAQlB,KAAMyB,QAAQ,UAAUsY,UAAU,OAAjE,YACY2xD,EADZ,0FCtBE5xB,GAASgyB,GAAWzhE,cAEpBxK,GAAYC,aAAW,SAAAC,GAAK,MAAK,CACrCC,KAAM,CACJ+rE,UAAS,aAAAv2E,OAAeuK,EAAMjC,QAAQG,UAAUD,OAElDE,KAAM,CACJ0E,QAAS7C,EAAM8C,QAAQ,EAAG,EAAG,IAE/BtF,MAAO,CACL83B,cAAe,IAEjBW,KAAM,CACJ3yB,aAActD,EAAM8C,QAAQ,IAE9Bq4D,UAAW,CACTnlC,gBAAiBh2B,EAAMjC,QAAQW,WAAWlB,OAE5CsqC,KAAM,CACJ1kC,SAAU,GAEZohC,OAAQ,CACNpkC,SAAU,WACV4wB,OAAQ,EACR1wB,KAAM,MACN2wB,gBAAiB,UAEjBC,UAAW,kDACX3wB,OAAQ,KAEVC,OAAQ,CACN5C,MAAO,GACPwF,SAAU,MAIR6oE,GAAY,SAAAhyE,GAA4H,IAAzHqH,EAAyHrH,EAAzHqH,UAAWwK,EAA8G7R,EAA9G6R,OAAQ0Q,EAAsGviB,EAAtGuiB,SAAU0vD,EAA4FjyE,EAA5FiyE,YAAajQ,EAA+EhiE,EAA/EgiE,WAAYpI,EAAmE55D,EAAnE45D,cAAeuN,EAAoDnnE,EAApDmnE,eAAgB7vC,EAAoCt3B,EAApCs3B,cAAeC,EAAqBv3B,EAArBu3B,eACjHrwB,EAAUrB,KACR4hB,EAAU4K,qBAAWztB,IAArB6iB,MACR,OACEvnB,EAAAC,EAAAC,cAACsvC,GAAA,EAAD,CAAQvpC,SAAS,SAASkB,UAAWkoB,KAAWroB,EAAQlB,KAAMqB,IAC5DnH,EAAAC,EAAAC,cAACyf,GAAA,EAAD,KACG0C,GACCriB,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CACEwnE,KAAK,QACL7qE,UAAWH,EAAQ2mC,KACnB/kC,MAAO+I,IAAWiuC,GAAOxvC,KAAO,YAAc,UAC9C3F,QAASsnE,GAET/xE,EAAAC,EAAAC,cAAC+xE,GAAAhyE,EAAD,OAGJD,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CACEwnE,KAAK,QACL7qE,UAAWH,EAAQ2mC,KACnB/kC,MAAO+I,IAAWiuC,GAAOvvC,IAAM,YAAc,UAC7C5F,QAASq3D,GAET9hE,EAAAC,EAAAC,cAACgyE,GAAAjyE,EAAD,OAEDoiB,GACCriB,EAAAC,EAAAC,cAACswC,GAAD,CACEjpB,MAAOA,EACPpgB,UAAWH,EAAQqjC,OACnBjT,cAAeA,EACfC,eAAgBA,GAEhBr3B,EAAAC,EAAAC,cAAC4sC,GAAA7sC,EAAD,OAGJD,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQX,SACxBrG,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CACE5B,MAAO+I,IAAWiuC,GAAOtvC,OAAS,YAAc,UAChDnJ,UAAWH,EAAQ2mC,KACnBljC,QAASivD,GAET15D,EAAAC,EAAAC,cAACiyE,GAAAlyE,EAAD,OAEDoiB,GACCriB,EAAAC,EAAAC,cAACsK,GAAA,EAAD,CACEwnE,KAAK,MACLppE,MAAO+I,IAAWiuC,GAAOrvC,QAAU,YAAc,UACjDpJ,UAAWH,EAAQ2mC,KACnBljC,QAASw8D,GAETjnE,EAAAC,EAAAC,cAACkyE,GAAAnyE,EAAD,UAqBZoyE,GAAA,GC3GMzyB,IDyImBh6C,aAXJ,SAAAC,GAAK,MAAK,CAC7BC,KAAM,CACJC,OAAQ,OACRa,QAAS,OACTC,cAAe,UAEjBxD,MAAO,CACL4F,SAAU,MCrIC2oE,GAAWzhE,eAEpBxK,GAAYC,aAAW,SAAAC,GAAK,MAAK,CACrCysE,UAAW,CACTvsE,OAAQ,OACR0C,SAAU,UAEZ3C,KAAM,CACJC,OAAQ,OACR0C,SAAU,SACV7B,QAAS,OACTC,cAAe,UAEjB0rE,WAAY,CACVjsE,KAAM,OAERksE,cAAe,CACb/pE,SAAU,SACVQ,SAAU,EACVwpE,WAAY,EACZ1sE,OAAQ,QAEV2sE,kBAAmB,CACjBtsE,OAAQ,IACRE,KAAM,UAyGKqsE,GAjGH,SAAA7yE,GAAgG,IAA7F6R,EAA6F7R,EAA7F6R,OAAQihE,EAAqF9yE,EAArF8yE,YAAankC,EAAwE3uC,EAAxE2uC,WAAYokC,EAA4D/yE,EAA5D+yE,aAAcz7C,EAA8Ct3B,EAA9Cs3B,cAAeC,EAA+Bv3B,EAA/Bu3B,eAAgBt3B,EAAeD,EAAfC,SACrFiH,EAAUrB,KAD0Fw2B,EAE3DhK,qBAAWztB,IAAlD2d,EAFkG8Z,EAElG9Z,SAAUlN,EAFwFgnB,EAExFhnB,KAAM8V,EAFkFkR,EAElFlR,WAAYb,EAFsE+R,EAEtE/R,OAEpChlB,oBAAU,YAEHid,GAAY,CAACu9B,GAAOvvC,IAAKuvC,GAAOtvC,OAAQsvC,GAAOpvC,OAAQovC,GAAOnvC,WAAWrU,QAAQuV,GAAU,GAAGkhE,EAAajzB,GAAOvvC,MACtH,CAACsB,IAEJ,IAAImhE,GAAgB,EAChBC,EAAc,GACdC,EAAkBC,GACtB,OAAQthE,GACN,KAAKiuC,GAAOxvC,KACV2iE,EAAc,CAAE3oD,UAChB4oD,EAAkBC,GAClB,MACF,KAAKrzB,GAAOvvC,IACV0iE,EAAc,CAAE3oD,UAChB4oD,EAAkBE,GAClB,MACF,KAAKtzB,GAAOrvC,QACVyiE,EAAkBG,GAClBJ,EAAc,CAAE59D,OAAMiV,UACtB,MACF,KAAKw1B,GAAOtvC,OACV0iE,EAAkBI,GAClB,MACF,KAAKxzB,GAAOpvC,OACVwiE,EAAkBK,GAClBN,EAAc,CAAE59D,OAAMiV,UACtB0oD,GAAgB,EAChB,MACF,KAAKlzB,GAAOlvC,kBACVqiE,EAAc,CAAE59D,OAAMiV,UACtB4oD,EAAkBK,GAClBP,GAAgB,EAChB,MACF,KAAKlzB,GAAOhvC,iBACVoiE,EAAkBjJ,GAClB+I,GAAgB,EAChB,MACF,KAAKlzB,GAAOjvC,mBACVoiE,EAAc,CAAE59D,OAAMiV,UACtB4oD,EAAkBK,GAClBP,GAAgB,EAChB,MACF,KAAKlzB,GAAOnvC,UACVuiE,EAAkBtC,GAClBoC,GAAgB,EAChBC,EAAc,CAAElwB,UAAW+vB,EAAankC,cAM5C,OACEzuC,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQsrE,WACtBtyE,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQlB,KAAMqJ,MAAO,CAAE1L,MAAOwnB,EAAWxnB,MAAOsC,OAAQklB,EAAWllB,SACjF/F,EAAAC,EAAAC,cAACkH,GAAA,EAAD,MADF,IAEEpH,EAAAC,EAAAC,cAACozE,GAAD,CAAYnsE,UAAWH,EAAQurE,aAC/BvyE,EAAAC,EAAAC,cAAA,OAAKiH,UAAWH,EAAQwrE,eACtBxyE,EAAAC,EAAAC,cAAC8yE,EAAoBD,IAErBD,GACA9yE,EAAAC,EAAAC,cAAC+G,GAAA,EAAD,CAAepB,MAAOrB,GAAOH,WAC3BrE,EAAAC,EAAAC,cAACmyE,GAAD,CACEhwD,SAAUA,EACV1Q,OAAQA,EACRogE,YAAa,kBAAMc,EAAajzB,GAAOxvC,OACvC0xD,WAAY,kBAAM+Q,EAAajzB,GAAOvvC,MACtCqpD,cAAe,kBAAMmZ,EAAajzB,GAAOtvC,OAAQ,CAAE8gD,OAAQ,QAC3D6V,eAAgB,kBAAM4L,EAAajzB,GAAOrvC,UAC1C6mB,cAAeA,EACfC,eAAgBA,KAKtBr3B,EAAAC,EAAAC,cAACqzE,GAAD,CAAiBpsE,UAAWH,EAAQ0rE,oBACnC3yE,KCwCMwuB,eAEbK,GACAxgB,aA5DsB,SAACnG,EAAOL,GAE9B,MAAO,CAAE+J,OADU1J,EAAMtE,KAAKqB,QAAtB2M,OACSkc,MAAO5lB,EAAM4lB,QAGL,SAAAmE,GAAQ,MAAK,CACtC6gD,aAAc,SAAChnD,EAAW4B,GACxBuE,EAASpG,GAAqBC,EAAW4B,KAE3C2J,cAAe,WACbpF,EAASpG,GAAqBgmD,GAAWzhE,cAAcO,qBAEzD2mB,eAAgB,WACdrF,EAASpG,GAAqBgmD,GAAWzhE,cAAcQ,sBAEzDqiD,mBAAoB,WAClBhhC,EAASpG,GAAqBgmD,GAAWzhE,cAAcS,oBAEzDuY,eAAgB,WACd6I,EAASpG,GAAgB,WAAW,KAEtC4nD,cAAe,SAACtnD,GACd8F,EAASpG,GAAgB,eAAgBM,KAE3C6mC,UAAW,WACT/gC,EAASpG,GAAqBgmD,GAAWzhE,cAAcM,aAEzDg+B,WAAY,WACVzc,EAASpG,OAEXgP,cAAe,SAACzkB,GACd6b,EAASpG,GAAqBgmD,GAAWzhE,cAAcG,OAAQ,CAC7D8gD,OAAQ,CAAE8N,IAAK0S,GAAW/gE,YAAYG,KAAMhN,KAAMmS,OAGtDy8D,YAAa,SAACr4E,EAAMizB,GAClB,OAAQjzB,GACN,IAAK,SACHy3B,EAASpG,GAAqBgmD,GAAWzhE,cAAcK,OAAQ,CAAEgd,uBApInC,SAAA7e,GAAO,OAAI,SAAA7O,GAE3C,IADJizD,EACIjzD,EADJizD,UAAWn4B,EACP96B,EADO86B,cAAe44C,EACtB1zE,EADsB0zE,cAAexgB,EACrClzD,EADqCkzD,mBAAoB7pC,EACzDrpB,EADyDqpB,eAAgB0E,EACzE/tB,EADyE+tB,MAAUjmB,EACnFzO,OAAAqV,EAAA,EAAArV,CAAA2G,EAAA,6FAAA2zE,EAEoEnxD,GAAkBuL,EAAMb,aAAcwmD,GAAtGpwD,EAFJqwD,EAEIrwD,MAAOf,EAFXoxD,EAEWpxD,SAAUD,EAFrBqxD,EAEqBrxD,SAAUoB,EAF/BiwD,EAE+BjwD,QAASf,EAFxCgxD,EAEwChxD,WAAYiB,EAFpD+vD,EAEoD/vD,YAFpDgwD,EAIuEt4D,KAA3DsB,EAJZg3D,EAIIn5D,OAA4Bo5D,EAJhCD,EAI0Bp4D,KAA6Bs4D,EAJvDF,EAI4Ch4D,UAJ5Cm4D,EAO6B5pD,KAAzBG,EAPJypD,EAOIzpD,OAAQC,EAPZwpD,EAOYxpD,aAPZypD,EAQuC7qD,GAAiB4E,EAAMd,QAAS5D,GAAnEK,EARJsqD,EAQItqD,cAAeG,EARnBmqD,EAQmBnqD,gBACjBoqD,EAAa1oD,KASnB,GALAjmB,oBAAU,YACS,IAAbid,GAAqBwL,EAAMb,aAAcwmD,GAAc,IACrC,IAAbnxD,GAAuBwL,EAAMb,cAAcwmD,GAAc,IACjE,CAACnxD,KAECsxD,EAAY,OAAO3zE,EAAAC,EAAAC,cAAC6lB,GAAD,CAASte,QAASoT,GAAa+4D,KAEvD,GAAiB,OAAbvxD,IAAsBwL,EAAMb,aAAc,OAAOvK,EAGrD,IAAMuxD,EAAU76E,OAAAuV,EAAA,EAAAvV,CAAA,CACdqqB,UACAE,YAAa,WACX8vD,GAAc,GACd9vD,KAEFsvC,qBACAvtB,aAAY,eAAAwuC,EAAA96E,OAAAuc,EAAA,EAAAvc,CAAAwc,EAAA1V,EAAA2V,KAAE,SAAAC,EAAO5a,EAAOyqC,GAAd,IAAAv3B,EAAA,OAAAwH,EAAA1V,EAAAsW,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,UAAAF,EAAAC,KAAA,GAGNxb,EAAMO,YAHA,CAAAgb,EAAAE,KAAA,gBAAAF,EAAAE,KAAA,EAIayC,GAAS/e,OAJtB,YAAAoc,EAAAM,KAKG1a,QAAQnB,EAAMO,cAAgB,GALjC,CAAAgb,EAAAE,KAAA,gBAAAF,EAAAE,KAAA,EAMayC,GAASK,QAAQve,EAAMO,aANpC,cAMA2S,EANAqI,EAAAM,KAAAN,EAAAO,OAAA,SAQC,CAAC5I,EAAKtS,UARP,eAAA2a,EAAAO,OAAA,SAWH2uB,EAAar3B,IAAI,SAAAw/C,GAAE,SAAAvyD,OAAOL,EAAMmd,MAAMC,MAAnB/c,OAA0BL,EAAMmd,MAAMy1C,OAXtD,eAAAr3C,EAAAC,KAAA,GAAAD,EAAA4F,GAAA5F,EAAA,SAAAA,EAAAO,OAAA,SAcH,MAdG,yBAAAP,EAAAY,SAAAvB,EAAA,kBAAF,gBAAAwB,EAAAC,GAAA,OAAA28D,EAAAz0E,MAAAtG,KAAA8E,YAAA,GAiBZ48B,gBACAxQ,SACAC,gBACG0pD,EA3BW,CA4Bd1xD,SAAU4iB,QAAQ5iB,GAClBqgC,KAAOrgC,EAEHe,EACE,QACA,OAHF,UAIJorC,YAAapsC,EACb2wC,YACAppC,oBAGF,OADA7tB,QAAQC,IAAI,QAASquB,EAAQC,GAG3BrqB,EAAAC,EAAAC,cAAC+G,GAAA,EAAD,CAAepB,MAAOrB,GAAOb,MAC3B3D,EAAAC,EAAAC,cAACg0E,EAAA,EAAD,CAAgB35D,OAAQmC,GACtB1c,EAAAC,EAAAC,cAACg0E,EAAA,EAAD,CAAO3hE,MAAOlQ,GAASmvB,MAAOnP,GAC3B,SAAAnU,GAA8B,IAA3BgR,EAA2BhR,EAA3BgR,QAAS9hB,EAAkB8Q,EAAlB9Q,MAAO+Q,EAAWD,EAAXC,KAClB,OAAI+Q,EAAgBlf,EAAAC,EAAAC,cAAC6lB,GAAD,CAASte,QAAQ,cACjCrK,GACFtB,QAAQsB,MAAMA,GAEZilB,IAAU2xD,EAAW7+D,KAAOhH,EAAKgH,MAEnCnV,EAAAC,EAAAC,cAACwE,GAAWwpD,SAAZ,CAAqB1iD,MAAOwoE,GAC1Bh0E,EAAAC,EAAAC,cAACi0E,EAAD,KACEn0E,EAAAC,EAAAC,cAACyO,EAAY/G,EACV4hB,YA6DK,SAAC7a,GAAD,OAAa,SAAC/G,GAAD,OACrC5H,EAAAC,EAAAC,cAACk0E,GAAD,CAAe9rE,SAAU+rE,IACvBr0E,EAAAC,EAAAC,cAACyO,EAAY/G,MASF2mB,CASbokD,IC9KI2B,GAAcrvC,QACW,cAA7BvwB,OAAOqvC,SAASE,UAEe,UAA7BvvC,OAAOqvC,SAASE,UAEhBvvC,OAAOqvC,SAASE,SAASswB,MACvB,2DAuCN,SAASC,GAAiBC,EAAOl7E,GAC/B2tB,UAAUwtD,cACPC,SAASF,GACTv9D,KAAK,SAAA09D,GACJA,EAAaC,cAAgB,WAC3B,IAAMC,EAAmBF,EAAaG,WACd,MAApBD,IAGJA,EAAiBE,cAAgB,WACA,cAA3BF,EAAiB7sE,QACfif,UAAUwtD,cAAcO,YAI1Bn5E,QAAQC,IACN,gHAKExC,GAAUA,EAAO27E,UACnB37E,EAAO27E,SAASN,KAOlB94E,QAAQC,IAAI,sCAGRxC,GAAUA,EAAO47E,WACnB57E,EAAO47E,UAAUP,UAO5BnxD,MAAM,SAAArmB,GACLtB,QAAQsB,MAAM,4CAA6CA,YC3FjEg4E,EAAQ,KAERt5E,QAAQC,IAAI,sBACZs5E,IAASh4C,OAAOr9B,EAAAC,EAAAC,cAACo1E,GAAD,MAAgBjwE,SAAS+9C,eAAe,SDYjD,SAAmB7pD,GACxB,GAA6C,kBAAmB2tB,UAAW,CAGzE,GADkB,IAAIy9B,IAAI92C,eAAwB6G,OAAOqvC,SAASsQ,MACpDkhB,SAAW7gE,OAAOqvC,SAASwxB,OAIvC,OAGF7gE,OAAOpP,iBAAiB,OAAQ,WAC9B,IAAMmvE,EAAK,GAAAn5E,OAAMuS,eAAN,sBAEPymE,IAkEV,SAAkCG,EAAOl7E,GAEvCi8E,MAAMf,GACHv9D,KAAK,SAAAoa,GAEJ,IAAMmkD,EAAcnkD,EAASrU,QAAQuH,IAAI,gBAEnB,MAApB8M,EAASs+C,QACO,MAAf6F,IAA8D,IAAvCA,EAAYr5E,QAAQ,cAG5C8qB,UAAUwtD,cAAcgB,MAAMx+D,KAAK,SAAA09D,GACjCA,EAAae,aAAaz+D,KAAK,WAC7BxC,OAAOqvC,SAAS6xB,aAMpBpB,GAAgBC,EAAOl7E,KAG1BkqB,MAAM,WACL3nB,QAAQC,IACN,mEAxFA85E,CAAwBpB,EAAOl7E,GAI/B2tB,UAAUwtD,cAAcgB,MAAMx+D,KAAK,WACjCpb,QAAQC,IACN,+GAOJy4E,GAAgBC,EAAOl7E,MCpC/Bm7E,GAGAxtD,UAAUwtD,cAAcC,SAAS","file":"static/js/main.ed5da9a2.chunk.js","sourcesContent":["const TYPES = {\n  // Series meta gets appended automatically to the seriees\n  SERIES: 'SERIES',\n  // Same but now only gets appended to the photo\n  PHOTO: 'PHOTO'\n}\nclass SeriesConfig {\n  constructor (seriesConfig) {\n    if (!seriesConfig) throw new Error('No seriesConfig object provided to SeriesConfig class')\n    this.config = seriesConfig\n  }\n\n  getTagType = (typeId) => this.config.tags.find(tt => tt.id === typeId)\n  // getTagTypeIndex = (typeId) => this.config.tags.findIndex(tt => tt.id === typeId)\n  getTagTypeIndex = (typeId) => {\n    // console.log('HERE', typeId)\n    return this.config.tags.findIndex(tt => tt.id === typeId)\n  }\n\n  getXYTagTypes = () => this.config.tags.filter(tt => tt.allowXY)\n  getNonXYTagTypes = () => this.config.tags.filter(tt => tt.allowNonXY)\n\n  getSeriesMeta = () => Object.keys(this.config.meta)\n    .filter(key => this.config.meta[key].type === TYPES.SERIES)\n    .reduce((acc, key) => ({\n      ...acc,\n      [key]: this.config.meta[key].default\n    }), {})\n\n  getPhotoMeta = () => Object.keys(this.config.meta)\n    .filter(key => this.config.meta[key].type === TYPES.PHOTO)\n    .reduce((acc, key) => ({\n      ...acc,\n      [key]: this.config.meta[key].default\n    }), {})\n}\n\nexport default SeriesConfig\n","import { convertJSDatetoTimestamp } from './datelib'\nimport SeriesConfig from './SeriesConfig'\nimport uuidv4 from 'uuid/v4'\nimport exifParser from 'exif-parser'\nimport { isNumeric } from './util'\n\nclass Photo {\n  constructor (seriesConfig, photo) {\n    this.config = new SeriesConfig(seriesConfig)\n    if (photo) this.photo = photo\n    else {\n      this.photo = this.newPhoto()\n    }\n  }\n\n  setMeta = () => {\n    this.meta = JSON.stringify(this.config.getPhotoMeta())\n  }\n\n  newPhoto = () => ({\n    id: `L-${uuidv4()}`,\n    uploadToken: uuidv4(),\n    takenOn: convertJSDatetoTimestamp(new Date()),\n    meta: JSON.stringify(this.config.getPhotoMeta()),\n    tags: []\n  })\n}\n\nexport default Photo\n\nexport const getObjectUrl = async (store, key) => {\n  try {\n    const dbval = await store.getItem(key)\n    const urlVal = window.URL.createObjectURL(dbval)\n    if (urlVal && urlVal.indexOf('data:image') === 0) {\n      return urlVal\n    }\n  }\n  catch (e) {\n    console.error(e)\n  }\n\n  return null\n}\n\nexport const getExif = (dataUrl) => {\n  console.log('onLibraryAdd Buffered')\n\n  let exif = null\n  let exifDateTime = null\n  let exifGPS = null\n  try {\n    const find = 'base64,'\n    const foundIdx = dataUrl.indexOf(find) + find.length\n    const newData = dataUrl.slice(foundIdx)\n    const parser = exifParser.create(Buffer.from(newData, 'base64'))\n    exif = parser.parse()\n    console.log('got EXIF', exif)\n  }\n  catch (err) {\n  // got invalid data, handle error\n    console.log('EXIF ERROR', err)\n  }\n  if (exif && exif.tags) {\n    // Try to parse the DateTime of the original image\n    try {\n      if (exif.tags && exif.tags.DateTimeOriginal && String(exif.tags.DateTimeOriginal)) {\n        exifDateTime = String(exif.tags.DateTimeOriginal)\n      }\n    }\n    catch (err) {\n      console.log('ERROR GETTING TIMESTAMP', { err, exif })\n    }\n    // Try to pull out the GPS info from the image\n    try {\n      if (exif.tags.GPSLatitude && isNumeric(exif.tags.GPSLatitude) && exif.tags.GPSLongitude && isNumeric(exif.tags.GPSLongitude)) {\n        exifGPS = [exif.tags.GPSLongitude, exif.tags.GPSLatitude]\n      }\n    }\n    catch (e) {\n      console.error('GPS Longitude and Latitude could not be determined')\n    }\n  }\n  return { exif, exifDateTime, exifGPS }\n}\n","import moment from 'moment'\n\n/**\n * Takes a UTC unix timestamp integer or string (milliseconds)\n * and a valid moment format string and returns a formatted\n * date string\n * @param {*} utctimestamp\n * @param {*} format\n */\nexport const formatDate = (utctimestamp, format = 'LLLL') => {\n  return moment(utctimestamp, 'x').format(format)\n}\n\nexport const formatDatAgo = (utctimestamp) => {\n  return moment(utctimestamp, 'x').fromNow()\n}\n\n/**\n * Takes a UTC timestamp and returns a moment object in LOCAL mode\n * @param {*} utctimestamp\n */\nexport const parseDate = (utctimestamp) => {\n  return moment(utctimestamp, 'x')\n}\n\n/**\n * This returns the object in LOCAL mode\n * @param {*} jsDate\n */\nexport const convertJSDatetoTimestamp = (jsDate) => {\n  return moment\n    .utc(jsDate)\n    .format('x')\n}\n\n/**\n *\n * @param {*} utctimestamp\n */\nexport function timestampToHTML5Input (utctimestamp) {\n  // // trim the Z and milliseconds + seconds\n  return moment(utctimestamp, 'x').format('YYYY-MM-DDTkk:mm')\n}\n\n/**\n * Returns an integer timestamp\n * @param {*} isoStr\n */\nexport function HTML5InputToTimestamp (isoStr) {\n  return moment(new Date(isoStr), 'YYYY-MM-DDTkk:mm').format('x')\n}\n","import numeral from 'numeral'\n\nexport const isNumeric = num => {\n  try {\n    return !isNaN(parseFloat(num)) && isFinite(num)\n  }\n  catch (e) {\n    return false\n  }\n}\n/**\n * This is a correction to strip === signs off of base64-encoded strings\n * @param {} x\n */\nexport const urlizeb64 = x => x.replace('+', '-').replace('/', '_').replace(/=+$/, '')\n\n/**\n * We need numbers displayed consistently. This is how we do it.\n * @param {*} num\n * @param {*} precision\n */\nexport function formatNum (num, precision) {\n  try {\n    const precstr = precision > 0 ? '.' + Array(precision + 1).join('0') : ''\n    const newprec = isNumeric(num) ? numeral(num).format(`0,0${precstr}`) : num\n    return newprec.replace(/(\\.(0{0,1}[1-9]*))0+$/, '$1')\n  }\n  catch (e) {\n    return num\n  }\n}\n\n/**\n * Magic function to clear mouse selection. Use sparingly.\n */\nexport function clearSelection () {\n  if (document.selection && document.selection.empty) {\n    document.selection.empty()\n  }\n  else if (window.getSelection) {\n    var sel = window.getSelection()\n    sel.removeAllRanges()\n  }\n}\n\nexport function isObjectWithKeys (obj) {\n  return ((typeof obj === 'object') && (obj !== null) && Object.keys(obj).length > 0)\n}\n\n/**\n * Dom node parsing is weird because it may return an array or a single element with no way to know\n * which is which.\n */\nexport function makeDomArray (domnode) {\n  if (!domnode) return []\n  const keys = Object.keys(domnode)\n  // This is not the pattern we expect\n  if (keys.length > 1 || keys.length === 0) throw Error('Expected nester domnode structure.')\n  if (!domnode) return []\n  if (!domnode[keys[0]]) return []\n  return Array.isArray(domnode[keys[0]]) ? domnode[keys[0]] : [domnode[keys[0]]]\n}\n\nexport function capitalizeFirstLetter (string) {\n  return string.charAt(0).toUpperCase() + string.slice(1)\n}\n\n/**\n * Good for comparing two purely numeric arrays\n * @param {*} arr1\n * @param {*} arr2\n */\nexport function numericArrayCompare (arr1, arr2) {\n  if (!Array.isArray(arr1) || !Array.isArray(arr2)) return false\n  if (arr1.length !== arr2.length) return false\n\n  return !arr1.some((el, idx) => el !== arr2[idx])\n}\n\n/**\n * We need a function to add the padding '=' signs back before we decode\n * @param {*} hash\n */\nexport function decodeUnbufferedBase64 (hash) {\n  const missingPadding = hash.length % 4\n  if (missingPadding !== 0) {\n    const newhash = hash + Array(4 - missingPadding).join('=')\n    return Buffer.from(newhash, 'base64').toString()\n  }\n  else {\n    return Buffer.from(hash, 'base64').toString()\n  }\n}\n\nexport function encodeUnbufferedBase64 (str) {\n  return urlizeb64(Buffer.from(str).toString('base64'))\n}\n\n/**\n *\n * @param {*} o\n */\nexport function isObject (o) {\n  return o instanceof Object && o.constructor === Object\n}\n\n/**\n * XML to JSON is a non-trivial exercise. We can make certain assumptions\n * about our incoming file\n * @param {*} data\n */\nexport function arrToObj (data) {\n  for (const key in data) {\n    // Make sure we're looping over legitimate objects\n    if (data.hasOwnProperty(key)) {\n      const keyDat = data[key]\n      if (keyDat._) {\n        keyDat.val = keyDat._\n        delete keyDat._\n      }\n      if (keyDat.$) {\n        keyDat.attr = keyDat.$\n        delete keyDat.$\n      }\n      if (typeof keyDat === 'object') {\n        data[key] = arrToObj(keyDat)\n        // There's a pattern we want to collapse\n        // It puts every single individual value into its own array. Not cool\n        if (Array.isArray(keyDat) && keyDat.length === 1 && typeof keyDat[0] === 'string') {\n          if (isNumeric(keyDat[0])) data[key] = Number(keyDat[0])\n          else data[key] = keyDat[0].replace(/\\\\/g, '/')\n        }\n        else if (Array.isArray(keyDat) && keyDat.length === 1 &&\n        // The second case is when it puts objects into its own array\n          isObject(keyDat[0]) &&\n          Object.keys(keyDat[0]).length === 1) {\n          // xml2js does a weird thing where attributes get put into the following structure\n          // [{ \"_\": \"475945.992587164,5125837.37170763\", \"$\": { \"units\": \"m\"  } }]\n          data[key] = keyDat[0][Object.keys(keyDat[0])[0]]\n        }\n        // Dynamo DB does not like empty strings\n        if (typeof data[key] && data[key].length === 0) {\n          delete data[key]\n        }\n        if (typeof data[key] === 'string' && isNumeric(data[key])) data[key] = Number(data[key])\n      }\n    }\n  }\n  return data\n}\n\n/**\n * Returns a random number between min (inclusive) and max (exclusive)\n */\nexport function getRandomArbitraryInt (min, max) {\n  return parseInt(Math.random() * (max - min) + min, 10)\n}\n\n/**\n * Returns a function, that, as long as it continues to be invoked, will not\n * be triggered. The function will be called after it stops being called for\n * N milliseconds. If `immediate` is passed, trigger the function on the\n * leading edge, instead of the trailing.\n * @param {*} func\n * @param {*} wait\n * @param {*} immediate\n */\nexport function debounce (func, wait, immediate) {\n  let timeout = null\n  return (...innerArgs) => {\n    const context = this\n    // const args = arguments\n    const callNow = immediate && !timeout\n    clearTimeout(timeout)\n\n    timeout = setTimeout(() => {\n      timeout = null\n      if (!immediate) {\n        // console.log('debounce', innerArgs)\n        func.apply(context, innerArgs)\n      }\n    }, wait)\n    if (callNow) {\n      // console.log('debounce', innerArgs)\n      func.apply(context, innerArgs)\n    }\n  }\n};\n\n// var myEfficientFn = debounce(function() {\n// // All the taxing stuff you do\n// }, 250);\n\n// window.addEventListener('resize', myEfficientFn);\n","// https://medium.com/@shalkam/create-react-app-i18n-the-easy-way-b05536c594cb\nimport React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { IntlProvider, addLocaleData } from 'react-intl'\nimport frLocaleData from 'react-intl/locale-data/fr'\n\naddLocaleData(frLocaleData)\n\nexport const IntlContext = React.createContext({})\n\n// the format message hook\nexport const useIntl = () => {\n  const intl = useContext(IntlContext)\n  return intl.formatMessage\n}\n\nexport const IntlWrapper = ({ children }) => (\n  <IntlProvider locale='en'>\n    {children}\n  </IntlProvider>\n)\nIntlWrapper.propTypes = {\n  children: PropTypes.any\n}\n","import gql from 'graphql-tag'\n\nexport const photoSummaryFragment = gql`\nfragment photoSummaryFragment on PhotoSummary {\n  id\n  takenOn\n  seriesCreatedBy\n  updatedOn\n  createdOn\n  seriesId\n  createdUser {\n    ...userSummaryFragment\n  }\n  paths {\n    base\n    thumb\n    medium\n    large\n    __typename\n  }\n  __typename\n}\n`\nexport const photoSummaryKeys = [\n  'id',\n  'takenOn',\n  'seriesCreatedBy',\n  'updatedOn',\n  'createdOn',\n  'seriesId',\n  'createdUser',\n  'paths'\n]\n\nexport const userSummaryFragment = gql`\nfragment userSummaryFragment on UserSummary {\n  id\n  gravatar\n  gravatarProfile\n  username\n  __typename\n}\n`\nexport const userSummaryKeys = [\n  'id',\n  'gravatar',\n  'gravatarProfile',\n  'username'\n]\n\nexport const seriesSummaryFragment = gql`\nfragment seriesSummaryFragment on SeriesSummary {\n  id\n  name\n  access\n  createdUser {\n    ...userSummaryFragment\n  }\n  seriesStatus\n  updatedOn\n  createdOn\n  photoCount\n  coords\n  direction\n  watchers\n  featured {\n    ...photoSummaryFragment\n  }\n  latest {\n    ...photoSummaryFragment\n  }\n  __typename\n}\n${photoSummaryFragment}\n${userSummaryFragment}\n`\nexport const seriesSummaryKeys = [\n  'id',\n  'name',\n  'access',\n  'createdUser',\n  'seriesStatus',\n  'updatedOn',\n  'createdOn',\n  'photoCount',\n  'coords',\n  'direction',\n  'watchers',\n  'featured',\n  'latest'\n]\n\nexport const seriesFragment = gql`\nfragment seriesFragment on Series {\n  id\n  name\n  access\n  note\n  meta\n  watchers\n  seriesStatus\n  createdOn\n  updatedOn\n  createdUser {\n    ...userSummaryFragment\n  }\n  updatedUser {\n    ...userSummaryFragment\n  }\n  coords\n  direction\n  photoCount\n  featured {\n    ...photoSummaryFragment\n  }\n  latest {\n    ...photoSummaryFragment\n  }\n  __typename\n}\n${photoSummaryFragment}\n${userSummaryFragment}\n`\nexport const seriesKeys = [\n  'id',\n  'name',\n  'access',\n  'note',\n  'meta',\n  'watchers',\n  'seriesStatus',\n  'createdOn',\n  'updatedOn',\n  'createdUser',\n  'updatedUser',\n  'coords',\n  'direction',\n  'photoCount',\n  'featured',\n  'latest'\n]\n\nexport const photoFragment = gql`\nfragment photoFragment on Photo {\n  id\n  meta\n  createdOn\n  takenOn\n  updatedOn\n  coords\n  seriesId\n  seriesCreatedBy\n  createdBy\n  updatedBy\n  uploadToken\n  createdUser {\n    ...userSummaryFragment\n  }\n  updatedUser {\n    ...userSummaryFragment\n  }\n  tags {\n    label\n    typeId\n    coords {\n      x\n      y\n      __typename\n    }\n    __typename\n  }\n  paths {\n    base\n    large\n    thumb\n    medium\n    __typename\n  }\n  __typename\n}\n${userSummaryFragment}\n`\nexport const photoKeys = [\n  'id',\n  'meta',\n  'createdOn',\n  'takenOn',\n  'updatedOn',\n  'coords',\n  'seriesId',\n  'seriesCreatedBy',\n  'createdBy',\n  'updatedBy',\n  'uploadToken',\n  'createdUser',\n  'updatedUser',\n  'tags',\n  'paths'\n]\n\nexport const userFragment = gql`\nfragment userFragment on User {\n  id\n  username\n  gravatar\n  watching\n  gravatarProfile\n  meta\n  createdOn\n  updatedOn\n  __typename\n}\n`\nexport const userKeys = [\n  'id',\n  'username',\n  'gravatar',\n  'watching',\n  'gravatarProfile',\n  'meta',\n  'createdOn',\n  'updatedOn'\n]\n","import gql from 'graphql-tag'\nimport {\n  photoSummaryFragment,\n  photoFragment,\n  seriesSummaryFragment,\n  seriesFragment,\n  userFragment\n} from './fragments'\n\nexport const allSeries = gql`\nquery allSeries($limit: Int, $nextToken: String) {\n  allSeries(limit: $limit, nextToken: $nextToken) @connection(key: \"allSeries\"){\n    seriesSummaries {\n      ...seriesSummaryFragment\n    }\n    nextToken\n    __typename\n  }\n}\n${seriesSummaryFragment}\n`\n\nexport const pollQuery = gql`\nquery pollQuery($lastCheck: String!, $limit: Int, $nextToken: String) {\n  changedSeries(lastCheck: $lastCheck, limit: $limit, nextToken: $nextToken) @connection(key: \"changedSeries\"){\n    seriesSummaries {\n      ...seriesSummaryFragment\n    }\n    __typename\n  }\n}\n${seriesSummaryFragment}\n`\n\nexport const userSeries = gql`\nquery userSeries($createdBy: ID) {\n  userSeries(createdBy: $createdBy ) {\n    seriesSummaries {\n      ...seriesSummaryFragment\n    }\n    nextToken\n    __typename\n  }\n}\n${seriesSummaryFragment}\n`\n\nexport const seriesSummaryFromList = gql`\nquery seriesFromList($seriesList: [ID]) {\n  arraySeries(seriesIds: $seriesList) {\n    ...seriesSummaryFragment\n  }\n}\n${seriesSummaryFragment}\n`\n\nexport const seriesFromList = gql`\nquery seriesFromList($seriesList: [ID]) {\n  arraySeries(seriesIds: $seriesList) {\n    ...seriesFragment\n    photos {\n      ...photoFragment\n    }\n  }\n}\n${seriesFragment}\n${photoFragment}\n`\n\nexport const seriesWithTag = gql`\nquery seriesWithTag($tag: String!, $limit: Int, $nextToken: String) {\n  tagSeries(tag: $tag, limit: $limit, nextToken: $nextToken) {\n    seriesSummaries{\n      ...seriesSummaryFragment\n    }\n    nextToken\n    __typename\n  }\n}\n${seriesSummaryFragment}\n`\n\nexport const tagSearch = gql`\nquery tagSearch($limit: Int, $tag: String) {\n  tags(limit: $limit, tag: $tag ){\n    _id\n    name\n    count\n    __typename\n  }\n}\n`\n\nexport const geoSeries = gql`\nquery seriesInGeoBounds($bounds: [Float], $limit: Int, $nextToken: String) {\n  seriesInGeoBounds(bounds: $bounds, limit: $limit, nextToken: $nextToken) {\n    seriesSummaries {\n      ...seriesSummaryFragment\n    }\n    nextToken\n    __typename\n  }\n}\n${seriesSummaryFragment}\n`\n\nexport const geoSeriesIdOnly = gql`\nquery seriesInGeoBoundsIdOnly($bounds: [Float], $limit: Int, $nextToken: String) {\n  seriesInGeoBounds(bounds: $bounds, limit: $limit, nextToken: $nextToken) {\n    seriesSummaries {\n      id\n      name\n    }\n    nextToken\n    __typename\n  }\n}\n`\n\nexport const getUser = gql`\nquery getUser($userId: ID) {\n  user(id: $userId){\n    ...userFragment\n  }\n}\n${userFragment}\n`\n\nexport const geocode = gql`\nquery geocode($search: String!) {\n  geocoder(search: $search) {\n    relevance\n    text\n    placeName\n    bbox\n    center\n    # geoType\n    # context\n    __typename\n  }\n}\n`\nexport const getMyFeed = gql`\nquery myFeed($start: String, $end: String, $limit: Int) {\n  myFeed(start: $start, end: $end, limit: $limit) @connection(key: \"myFeed\"){\n    feed {\n      _id\n      series {\n        ...seriesSummaryFragment\n      }\n      photo {\n        ...photoSummaryFragment\n      }\n      relation\n      __typename\n    }\n    window\n    __typename\n  }\n}\n${seriesSummaryFragment}\n${photoSummaryFragment}\n`\n\nexport const userSearch = gql`\nquery userSearch($searchStr: String!, $limit: Int) {\n  userSearch(searchStr: $searchStr, limit: $limit ){\n    ...userFragment\n  }\n}\n${userFragment}\n`\n\nexport const getWholeSeries = gql`\nquery getWholeSeries($id: ID!) {\n  series(id: $id) {\n    ...seriesFragment\n    photos {\n      ...photoFragment\n    }\n  }\n}\n${seriesFragment}\n${photoFragment}\n`\nexport const getNewS3Credentials = gql`\n  query s3Credentials($seriesId: ID!, $photoId: ID!, $ext: String!)  {\n    s3Credentials(seriesId: $seriesId, photoId: $photoId, ext: $ext)\n  }\n`\n","import { createMuiTheme } from '@material-ui/core/styles'\nimport { fade, lighten } from '@material-ui/core/styles/colorManipulator'\n// import {\n//   cyan, teal, indigo, grey, blueGrey, pink, yellow, deepOrange, red\n// } from '@material-ui/core/colors'\n\n// We need this so that it doesn't freak out abotu old variants\nconst typography = {\n  useNextVariants: true\n}\n\nconst overrides = {\n  // Name of the component ⚛️\n  MuiDialog: {\n    paper: {\n      '@media (max-width:321px)': {\n        margin: 10\n      }\n    },\n    paperFullWidth: {\n      '@media (max-width:321px)': {\n        width: 'calc(100% - 20px)'\n      }\n    }\n  }\n}\n\nconst colors = {\n  jet: '#3a3335', // JET\n  rose: '#d81e5b', // DOGWOOD ROSE\n  redorange: '#f0544f', // RED-ORANGE\n  papayawhip: '#FDF0D5', // PAPAYA WHIP\n  cblue: '#C6D8D3' // COLUMBIA-BLUE\n}\n\nconst home = {\n  palette: {\n    primary: {\n      main: colors.redorange\n    },\n    secondary: {\n      main: colors.rose\n    },\n    text: {\n      primary: colors.jet,\n      secondary: fade(colors.jet, 0.7)\n    }\n  },\n  typography,\n  overrides\n}\n\nconst series = {\n  palette: {\n    primary: {\n      main: lighten(colors.jet, 0.1)\n    },\n    secondary: {\n      main: colors.rose\n    },\n    text: {\n      primary: colors.jet,\n      secondary: fade(colors.jet, 0.7)\n    }\n  },\n  typography,\n  overrides\n\n}\n\nconst topbar = {\n  palette: {\n    primary: {\n      main: colors.redorange\n    },\n    secondary: {\n      main: colors.rose\n    }\n  },\n  typography\n}\n\nconst bottombar = {\n  palette: {\n    primary: {\n      main: colors.papayawhip\n    },\n    secondary: {\n      main: colors.redorange\n    }\n  },\n  typography\n}\n\nconst login = {\n  palette: {\n    primary: {\n      main: colors.redorange\n    },\n    secondary: {\n      main: colors.rose\n    },\n    text: {\n      primary: colors.papayawhip,\n      secondary: fade(colors.papayawhip, 0.7)\n    },\n    background: {\n      default: colors.jet,\n      paper: colors.jet\n    }\n  },\n  typography,\n  overrides\n}\n\nexport default {\n  home: createMuiTheme(home),\n  login: createMuiTheme(login),\n  series: createMuiTheme(series),\n  topbar: createMuiTheme(topbar),\n  bottombar: createMuiTheme(bottombar)\n}\n","import React from 'react'\n\nexport const AppContext = React.createContext({})\n","import { useRef, useEffect } from 'react'\n\nconst useAuthCommon = () => {\n  const containerRef = useRef()\n  const handleKeyPress = (event) => {\n    if (event.key === 'Enter') {\n      if (containerRef.current) {\n        try {\n          const found = containerRef.current.getElementsByClassName('enterAction')\n          if (found && found[0]) found[0].click()\n        }\n        catch (e) {\n          console.error('useAuthCommon::handleKeyPress', e)\n        }\n      }\n    }\n  }\n  useEffect(() => {\n    if (containerRef.current) {\n      try {\n        document.addEventListener('keypress', handleKeyPress, false)\n      }\n      catch (e) {\n        console.error('useAuthCommon::useEffect', e)\n      }\n      return () => document.removeEventListener('keypress', handleKeyPress, false)\n    }\n  }, [])\n\n  return containerRef\n}\n\nexport default useAuthCommon\n","import React from 'react'\nimport createSvgIcon from '@material-ui/icons/utils/createSvgIcon'\n\nexport const RawSVG = <React.Fragment>\n  <path d='M13.685,2.797c-0.44,1.273 0.852,3.525 -1.082,4.966c-1.247,0.93 -2.133,2.247 -2.743,4.167c-3.78,-7.611 2.788,-8.409 3.682,-10.699c0.64,1.255 5.18,2.608 2.89,4.873c1.28,-2.034 -2.359,-1.862 -2.747,-3.307Z' />\n  <path d='M4.921,5.953c0.883,1.017 3.479,1.024 3.76,3.42c0.181,1.545 0.879,2.971 2.238,4.459c-8.482,-0.532 -5.889,-6.619 -7.425,-8.538c1.407,0.073 4.848,-3.183 5.665,-0.066c-1.121,-2.126 -2.792,1.111 -4.238,0.725Z' />\n  <path d='M3.236,15.092c1.323,-0.256 2.627,-2.5 4.842,-1.546c1.428,0.615 3.013,0.724 4.98,0.292c-4.701,7.079 -8.676,1.79 -11.106,2.161c0.766,-1.183 -0.332,-5.791 2.775,-4.94c-2.402,-0.091 -0.433,2.974 -1.491,4.033Z' />\n  <path d='M10.309,21.121c0.439,-1.274 -0.852,-3.525 1.081,-4.967c1.247,-0.929 2.133,-2.246 2.743,-4.167c3.781,7.611 -2.788,8.409 -3.681,10.699c-0.641,-1.255 -5.181,-2.607 -2.891,-4.873c-1.28,2.034 2.359,1.863 2.748,3.308Z' />\n  <path d='M19.066,18.01c-0.883,-1.017 -3.479,-1.024 -3.76,-3.42c-0.182,-1.544 -0.88,-2.971 -2.238,-4.459c8.482,0.532 5.889,6.619 7.425,8.538c-1.407,-0.072 -4.849,3.183 -5.665,0.067c1.121,2.125 2.792,-1.112 4.238,-0.726Z' />\n  <path d='M20.751,8.871c-1.323,0.256 -2.627,2.501 -4.842,1.546c-1.429,-0.615 -3.013,-0.723 -4.98,-0.291c4.701,-7.08 8.676,-1.791 11.106,-2.162c-0.767,1.183 0.332,5.791 -2.775,4.94c2.401,0.092 0.433,-2.974 1.491,-4.033Z' />\n</React.Fragment>\n\nexport default createSvgIcon(RawSVG, 'AppLogo')\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport Typography from '@material-ui/core/Typography'\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport { makeStyles } from '@material-ui/core/styles'\n// import style from './auth.style'\nimport useAuthCommon from './useAuthCommon'\nimport AppLogo from '../../icons/AppLogo'\n\nimport { ThemeProvider } from '@material-ui/styles'\nimport themes from '../../themes'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    height: '100%'\n  },\n  bgSwoosh: {\n    width: '100%',\n    height: '100%',\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    zIndex: 0\n  },\n  spacer: {\n    flex: '1 1 5%'\n  },\n  logo: {\n    flex: '1 1 40%',\n    width: '100%',\n    minHeight: 90\n  },\n  inner: {\n    margin: '0 auto',\n    width: '100%',\n    height: '100%',\n    minWidth: 200,\n    maxWidth: 300,\n    display: 'flex',\n    flexDirection: 'column',\n    textAlign: 'center'\n  }\n}))\n\nconst AuthContainer = ({ children }) => {\n  const containerRef = useAuthCommon()\n  const classes = useStyles()\n  return (\n    <ThemeProvider theme={themes.login}>\n      <div ref={containerRef} className={classes.root}>\n        <CssBaseline />\n        {/* Look for: LoginSwoosh.svg */}\n        {/* <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 500 500' preserveAspectRatio='none' className={classes.bgSwoosh}>\n        <path className={classes.bgSwooshFill} d=' M 0 0 L 500 0 C 500 209.782 489.956 180 250 180 C 10.044 180 0 219.954 0 370 L 0 0 Z ' />\n      </svg> */}\n\n        <div className={classes.inner}>\n          {/* Look for: Logo.svg */}\n          <AppLogo className={classes.logo} />\n\n          <Typography variant='h5'>MorPhoto</Typography>\n          {children}\n          <div className={classes.spacer} />\n        </div>\n      </div>\n    </ThemeProvider>\n  )\n}\n\nAuthContainer.propTypes = {\n  children: PropTypes.any\n}\n\nexport default AuthContainer\n","import React from 'react'\nimport PropTypes from 'prop-types'\n// import MenuIcon from '@material-ui/core/Menu'\n// import { makeStyles } from '@material-ui/core/styles'\n// import style from './auth.style'\nimport AuthContainer from './AuthContainer'\nimport { Typography } from '@material-ui/core'\n\n// const useStyles = makeStyles(style)\n\nconst Loading = ({ message }) => {\n  // const classes = useStyles()\n  return (\n    <AuthContainer>\n      <Typography variant='h3'>Loading...</Typography>\n      {message && <Typography variant='overline'>{message}</Typography>}\n    </AuthContainer>\n  )\n}\n\nLoading.propTypes = {\n  message: PropTypes.string\n}\n\nexport default Loading\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\n/**\n * Note: this was one of the few components we didn't use hooks for\n * mostly because I couldn't find an easy way to do getDerivedStateFromError()\n *\n * We might revise this later\n */\nclass ErrorBoundary extends React.Component {\n  constructor (props) {\n    console.log('ErrorBoundary constructor')\n    super(props)\n    this.state = { hasError: false }\n  }\n\n  static getDerivedStateFromError (error) {\n    // Update state so the next render will show the fallback UI.\n    console.log('ErrorBoundary getDerivedStateFromError')\n    console.error(error)\n    return { hasError: true, error }\n  }\n\n  componentDidCatch (error, info) {\n    console.log('ErrorBoundary componentDidCatch')\n    console.error(error)\n    // You can also log the error to an error reporting service\n    // logErrorToMyService(error, info)\n  }\n\n  render () {\n    const { hasError, error } = this.state\n    const { fallback: FallbackUI } = this.props\n    if (hasError) {\n      console.log('ErrorBoundary hasError')\n      // You can render any custom fallback UI\n      return <FallbackUI error={error} />\n    }\n\n    return this.props.children\n  }\n}\nErrorBoundary.propTypes = {\n  children: PropTypes.any,\n  fallback: PropTypes.any\n}\n\nexport default ErrorBoundary\n","import React, { useState } from 'react'\nimport PropTypes from 'prop-types'\nimport Typography from '@material-ui/core/Typography'\nimport Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogContentText from '@material-ui/core/DialogContentText'\nimport TextField from '@material-ui/core/TextField'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport BugReportIcon from '@material-ui/icons/BugReport'\nimport ErrorIcon from '@material-ui/icons/Error'\nimport { makeStyles } from '@material-ui/core/styles'\n\nexport const SEND_STATES = {\n  UNSENT: 'UNSENT',\n  SENDING: 'SENDING',\n  SENT: 'SENT',\n  ERROR: 'ERROR'\n}\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    height: '100%',\n    overflow: 'hidden',\n    padding: theme.spacing(1),\n    display: 'flex',\n    flexDirection: 'column',\n    textAlign: 'center',\n    color: theme.palette.text.primary,\n    border: `20px solid ${theme.palette.text.secondary}`\n  },\n  button: {\n    // background: theme.palette.success.main,\n    // color: theme.palette.success.contrastText\n  },\n  icon: {\n    opacity: 0.5,\n    margin: 'auto',\n    flex: '0 1 10%',\n    // height: '50%',\n    width: '50%'\n  },\n  text: {\n  },\n  spacer: {\n    flexGrow: 1\n  },\n  stack: {\n    padding: theme.spacing(2),\n    marginBottom: theme.spacing(2),\n    fontSize: '8px',\n    flexGrow: 1,\n    textAlign: 'left',\n    whiteSpace: 'pre-wrap',\n    overflow: 'scroll',\n    color: theme.palette.error.main,\n    fontFamily: 'Consolas, monaco, monospace'\n  }\n}))\n\nconst ErrorScreen = ({ error, sendState, reportError }) => {\n  const classes = useStyles()\n  const [dlgOpen, setDialogOpen] = useState(false)\n  const [note, setNote] = useState('')\n\n  let stackEl = <div className={classes.spacer} />\n  try {\n    if (process.env.NODE_ENV === 'development') {\n      stackEl = (\n        <Typography className={classes.stack}>\n          {error.stack}\n        </Typography>\n      )\n    }\n  }\n  catch (e) {}\n\n  let buttonText = 'Report this bug'\n  let disabled = false\n  let color = 'primary'\n  switch (sendState) {\n    case SEND_STATES.UNSENT:\n      buttonText = 'Report this bug'\n      break\n    case SEND_STATES.SENDING:\n      disabled = true\n      color = 'default'\n      buttonText = 'Sending...'\n      break\n    case SEND_STATES.SENT:\n      color = 'default'\n      disabled = true\n      buttonText = 'Thank you for your feedback'\n      break\n    case SEND_STATES.ERROR:\n      color = 'secondary'\n      disabled = true\n      buttonText = 'ERROR SENDING BUG REPORT'\n      break\n    default:\n      break\n  }\n\n  return (\n    <div className={classes.root}>\n      <CssBaseline />\n      <ErrorIcon className={classes.icon} color='error' />\n      <Typography variant='subtitle1' className={classes.text} color='inherit'>\n        Something went wrong\n      </Typography>\n      {error && error.message && <Typography variant='body1' className={classes.text} color='inherit'>\n        {error.message}\n      </Typography>}\n      <Button\n        className={classes.button}\n        variant='contained'\n        disabled={disabled}\n        color={color}\n        onClick={() => setDialogOpen(true)}\n      >\n        <BugReportIcon />\n        {buttonText}\n      </Button>\n      {stackEl}\n      <Dialog open={dlgOpen} fullWidth onClose={() => setDialogOpen(false)} aria-labelledby='form-dialog-title'>\n        <DialogTitle id='form-dialog-title'>Report a bug</DialogTitle>\n        <DialogContent>\n          <DialogContentText>\n            What were you trying to do when the error happened?\n          </DialogContentText>\n          <TextField\n            autoFocus\n            margin='dense'\n            multiline\n            onChange={(e) => setNote(e.target.value)}\n            rowsMax='6'\n            id='note'\n            placeholder='I tried to X and then Y happened...'\n            label='Note'\n            fullWidth\n          />\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => setDialogOpen(false)} color='primary'>\n            Cancel\n          </Button>\n          <Button onClick={() => {\n            reportError(note)\n            setDialogOpen(false)\n          }} color='primary'>\n            Send\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </div>\n  )\n}\n\nErrorScreen.propTypes = {\n  error: PropTypes.object,\n  sendState: PropTypes.string,\n  reportError: PropTypes.func.isRequired\n}\n\nexport default ErrorScreen\n","import gql from 'graphql-tag'\nimport { photoFragment, seriesFragment } from './fragments'\n\nexport const deletePhoto = gql`\nmutation deletePhoto($seriesId: ID!, $photoId: ID!) {\n  deletePhoto(seriesId: $seriesId, photoId: $photoId)\n}\n`\n\nexport const deleteSeries = gql`\nmutation deleteSeries($id: ID!) {\n  deleteSeries(id: $id)\n\n}\n`\n\nexport const updateSeries = gql`\nmutation updateSeries($series: UpdateSeriesInput!) {\n  updateSeries(series: $series){\n    ...seriesFragment\n  }\n}\n`\nexport const updateSeriesKeys = [\n  'id',\n  'access',\n  'name',\n  'note',\n  'coords',\n  'direction'\n]\n\nexport const updatePhoto = gql`\nmutation updatePhoto($photo: UpdatePhotoInput!) {\n  updatePhoto(photo: $photo){\n    ...photoFragment\n  }\n}\n`\nexport const updatePhotoKeys = [\n  'id',\n  'seriesId',\n  'takenOn',\n  'tags',\n  'note'\n]\n\nexport const createPhoto = gql`\nmutation createPhoto($photo: NewPhotoInput!, $ext: String!) {\n  createPhoto(photo: $photo, ext: $ext) {\n    photo {\n      ...photoFragment\n    }\n    preAuth\n    __typename\n  }\n}\n${photoFragment}\n`\nexport const newPhotoKeys = [\n  'seriesId',\n  'takenOn',\n  'meta',\n  'rawData',\n  'coords',\n  'tags',\n  'note',\n  'uploadToken'\n]\n\nexport const createSeries = gql`\nmutation createSeries($series: NewSeriesInput, $photo: NewPhotoInput!, $ext: String!) {\n  createSeries(series: $series, photo: $photo, ext: $ext) {\n    series {\n      ...seriesFragment\n      photos {\n        ...photoFragment\n      }\n    }\n    preAuth\n    __typename\n  }\n}\n${seriesFragment}\n${photoFragment}\n`\nexport const newSeriesKeys = [\n  'access',\n  'name',\n  'note',\n  'coords',\n  'direction',\n  'meta'\n]\n\nexport const watchSeries = gql`\nmutation watch($seriesId: ID) {\n  watchSeries(seriesId: $seriesId)\n}\n`\n\nexport const unWatchSeries = gql`\nmutation unWatch($seriesId: ID) {\n  unWatchSeries(seriesId: $seriesId)\n}\n`\n\nexport const reportBug = gql`\nmutation reportBug($reportJSON: String!) {\n  reportBug(reportJSON: $reportJSON)\n}\n`\n","import React, { useState } from 'react'\n// import PropTypes from 'prop-types'\nimport { graphql } from 'react-apollo'\nimport { connect } from 'react-redux'\nimport ErrorScreen, { SEND_STATES } from '../components/misc/ErrorScreen'\nimport { reportBug } from '../graphql/mutations'\n\nconst ErrorConnect = (props) => {\n  const [state, setState] = useState(SEND_STATES.UNSENT)\n  const Wrapped = withReportBugMutation(ErrorScreen)\n  return <Wrapped {...props} setState={setState} sendState={state} />\n}\n\nconst withReportBugMutation = graphql(reportBug, {\n  props: ({ mutate, ownProps: { reduxState, error, setState } }) => {\n    console.log('withReportBugMutation props', { mutate, reduxState, error })\n    if (mutate.error) setState(SEND_STATES.ERROR)\n    return {\n      reportError: (note) => {\n        setState(SEND_STATES.SENDING)\n        let reportJSON = ''\n        const errObj = { note, reduxState, error, env: process.env }\n        console.log('withReportBugMutation StartingError', errObj)\n        try {\n          reportJSON = JSON.stringify(errObj)\n        }\n        catch (e) {\n          reportJSON = error.toString()\n        }\n        console.log('withReportBugMutation got through it', reportJSON)\n        return mutate({\n          variables: { reportJSON },\n          update: (store, { data }) => {\n            console.log('withReportBugMutation update', data)\n            setState(SEND_STATES.SENT)\n          }\n        })\n      }\n    }\n  }\n})\n\n/**\n * Map our redux state and functions\n */\nconst mapStateToProps = (state, props) => {\n  const { map, home, uploader, ...other } = state\n  const newMap = map.slice(-5) // only the last 5 map states come through\n\n  return {\n    reduxState: {\n      ...other,\n      map: newMap,\n      home\n    }\n  }\n}\n\nexport default connect(\n  mapStateToProps\n)(ErrorConnect)\n","import Satellite from './Satellite.json'\n// import BasicMap from './BasicMap.json'\nimport TopoMap from './TopoMap.json'\n\nimport {\n  Satellite as SatIcon,\n  SatelliteOutlined,\n  // DirectionsCar,\n  // DirectionsCarOutlined,\n  Terrain,\n  TerrainOutlined\n} from '@material-ui/icons'\n\nexport default [\n  {\n    toolTip: 'Sat',\n    Icon: SatelliteOutlined,\n    ActiveIcon: SatIcon,\n    color: 'green',\n    style: Satellite\n  },\n  {\n    toolTip: 'Topo',\n    Icon: TerrainOutlined,\n    ActiveIcon: Terrain,\n    color: 'blue',\n    style: TopoMap\n  }\n]\n","import MapStyles from './mapStyles'\nimport {\n  green, blue, red\n} from '@material-ui/core/colors'\n\nexport const tagColors = [\n  '#418CF0', '#FCB441', '#E0400A', '#056492', '#BFBFBF', '#1A3B69', '#FFE382', '#129CDD', '#CA6B4B',\n  '#005CDB', '#F3D288', '#506381', '#F1B9A8', '#E0830A', '#7893BE'\n]\n\nexport const mapConfig = {\n  mapBoxToken: process.env.REACT_APP_MAPBOX_TOKEN,\n  styles: MapStyles\n}\n\nlet baseurl = process.env.REACT_APP_BASEURL\nlet basename = process.env.REACT_APP_BASENAME\nlet domain = process.env.REACT_APP_DOMAIN\nif (process.env.NODE_ENV && process.env.NODE_ENV === 'development') {\n  domain = 'localhost'\n  basename = ''\n}\nconsole.log('config: ', baseurl, basename)\n\nexport const version = process.env.REACT_APP_VERSION\nexport const contact = process.env.REACT_APP_CONTACT_EMAIL\n\nexport const home = {\n  Offline: {\n    seriesImgsToCache: ['thumb', 'large'],\n    highestOfflineTileZoom: 12,\n    maxMapTileArea: 25000 // km^2 allowed to download map tiles\n  },\n  AppStateTypes: {\n    FEED: 'feed', // Looking at the Home Feed\n    MAP: 'map', // Looking at the map\n    SEARCH: 'search', // looking at the search\n    PROFILE: 'profile', // Looking at user information\n    SERIES: 'series', // Looking at one particular series\n    QRCAPTURE: 'QRCapture', // Capture a QRCode\n    NEW_SERIES_CAMERA: 'new_series_camera', // Looking at one particular sereis\n    NEW_SERIES_LIBRARY: 'new_series_library', // Looking at one particular sereis\n    OFFLINE_DOWNLOAD: 'offline_download' // Looking at one particular sereis\n  },\n  SEARCH_TABS: {\n    TAG: 'tag',\n    LOCATION: 'location',\n    USER: 'user'\n  },\n  MapModeTypes: {\n    FREE: 'free', //\n    USER: 'user', // filtered to a given user\n    TAG: 'tag' // filtered to a given tag\n  }\n}\n\nexport const federated = {\n  // oauth_config: {\n\n  // },\n  // google_client_id: process.env.REACT_APP_GOOGLE_APP_ID\n}\n\nexport const endpoints = {\n  graphql: process.env.REACT_APP_GRAPHQL\n}\n\nexport const aws = {\n  Auth: {\n    // REQUIRED - Amazon Cognito Identity Pool ID\n    // identityPoolId: process.env.REACT_APP_COGNITO_IDPOOLID, // XX-XXXX-X:XXXXXXXX-XXXX-1234-abcd-1234567890ab\n    // REQUIRED - Amazon Cognito Region\n    region: process.env.REACT_APP_AWS_REGION,\n    // OPTIONAL - Amazon Cognito User Pool ID\n    userPoolId: process.env.REACT_APP_COGNITO_USER_POOL_ID,\n    // OPTIONAL - Amazon Cognito Web Client ID (26-char alphanumeric string)\n    userPoolWebClientId: process.env.REACT_APP_COGNITO_CLIENT_ID,\n    // OPTIONAL - Enforce user authentication prior to accessing AWS resources or not\n    mandatorySignIn: true,\n    // OPTIONAL - Configuration for cookie storage\n    cookieStorage: {\n      // REQUIRED - Cookie domain (only required if cookieStorage is provided)\n      domain: `${domain}`,\n      // OPTIONAL - Cookie path\n      // path: `/${basename}`,\n      // OPTIONAL - Cookie expiration in days\n      expires: 20,\n      // OPTIONAL - Cookie secure flag\n      secure: false\n    }\n\n  }\n\n}\n\nexport const ACCESS = {\n  OPEN: {\n    label: 'Open',\n    description: 'Anyone can see and contribute photos to this series.',\n    color: green\n  },\n  PRIVATE: {\n    label: 'Private',\n    description: 'Can only be seen by you.',\n    color: red\n  },\n  PUBLIC: {\n    label: 'Public',\n    description: 'Anyone can see this series. Only the owner can add photos.',\n    color: blue\n  }\n}\n","import { getWholeSeries, allSeries, userSeries, getMyFeed, getUser } from '../queries'\nimport { seriesKeys, seriesSummaryKeys, photoSummaryKeys } from '../fragments'\nimport _ from 'lodash'\n\n/**********************************************************\n *\n * NOTE:\n *\n * The methods in this file are for modifying the Apollo cache\n * store. This ensures interoperability between queries and\n * helps us rewind and replay mutations after an app reload\n *\n *\n **********************************************************/\n\n/**\n * Update a series in the cached getWholeSeries queries\n *\n * @param {*} store\n * @param {*} photo\n * @param {*} remove\n */\nexport const getWholeSeriesUpdate = (store, series) => {\n  const variables = { id: series.id }\n  const query = getWholeSeries\n  let newData = {\n    series: {}\n  }\n  try {\n    const qVal = store.readQuery({ query, variables })\n    newData = _.cloneDeep(qVal)\n  }\n  catch (e) {\n    console.warn('ERROR: getWholeSeriesUpdate readQuery failed')\n  }\n  try {\n    newData.series = { ...newData.series, ...series }\n    store.writeQuery({ query, variables, data: newData })\n    console.log('updateQueries::getWholeSeriesUpdate DONE')\n  }\n  catch (e) {\n    console.error('ERROR: getWholeSeriesUpdate writeQuery failed')\n  }\n}\n\n/**\n * Add or remove a photo a full getWholeSeries cached query\n *\n * @param {*} store\n * @param {*} photo\n * @param {*} remove\n */\nexport const getWholeSeriesPhotoUpdate = (store, photo, remove = false) => {\n  const variables = { id: photo.seriesId }\n  const query = getWholeSeries\n  try {\n    // This may or may not exist yet\n    const qVal = store.readQuery({ query, variables })\n    const newData = _.cloneDeep(qVal)\n    if (remove) {\n      newData.series.photos = newData.series.photos.filter(ph => ph.id === photo.id)\n    }\n    else {\n      const idx = newData.series.photos.findIndex(ph => ph.id === photo.id)\n      if (idx > -1) {\n        newData.series.photos = [...newData.series.photos]\n        newData.series.photos[idx] = photo\n      }\n      else {\n        newData.series.photos = [...newData.series.photos, photo]\n      }\n    }\n    store.writeQuery({ query, variables, data: newData })\n    console.log('updateQueries::getWholeSeriesPhotoUpdate DONE')\n  }\n  catch (e) {\n    console.error('ERROR: getWholeSeriesPhotoUpdate readQuery or WriteQuery failed  ')\n  }\n}\n\n/**\n * HELPER Function. Help us add and remove one item from\n * any of the allSeries arrays in the cache\n *\n * @param {*} origArr\n * @param {*} series\n * @param {*} remove\n */\nfunction updateSeriesSummaries (origArr, series, remove = false) {\n  let newArr = []\n  if (remove) {\n    newArr = origArr.filter(s => s.id !== series.id)\n  }\n  else {\n    const newAllSeriesEntry = _.pick(series, seriesKeys)\n    newArr = [...origArr, {\n      ...newAllSeriesEntry, seriesStatus: null, __typename: 'SeriesSummary'\n    }]\n  }\n  console.log('updateQueries::updateSeriesSummaries HELPER', newArr)\n  return newArr\n}\n\n/**\n * HELPER Function. Help us add and remove one feedItem from the cached array\n *\n * @param {*} origArr\n * @param {*} series\n * @param {*} photo\n * @param {*} remove\n */\nfunction updateFeedList (origArr, series, photo, remove = false) {\n  let newArr = []\n  if (remove) {\n    // remove the item\n    newArr = origArr.filter(fItem => {\n      if (series && fItem.series.id === series.id) return false\n      else if (photo && fItem.photo.id === photo.id) return false\n      else return true\n    })\n  }\n  else {\n    // Maybe this is just an update\n    const idx = origArr.findIndex(fitem => fitem._id === photo.id)\n\n    const newSeriesSummary = series ? _.pick(series, seriesSummaryKeys) : null\n    newSeriesSummary.__typename = 'SeriesSummary'\n\n    const newPhotoSummary = _.pick(photo, photoSummaryKeys)\n    newPhotoSummary.__typename = 'PhotoSummary'\n\n    // Update the item\n    if (idx > -1) {\n      newArr = [...origArr]\n      newArr[idx].photo = newPhotoSummary\n    }\n    // Insert a new item\n    else {\n      newArr = [...origArr, {\n        _id: newPhotoSummary.id,\n        series: newSeriesSummary,\n        photo: newPhotoSummary,\n        relation: 'OWNED',\n        __typename: 'MyFeedResultItem'\n      }]\n    }\n  }\n  console.log('updateQueries::updateFeedList HELPER', newArr)\n  return newArr\n}\n\n/**\n * Update a changed Series in the allSeries cache\n *\n * @param {*} store\n * @param {*} series\n * @param {*} remove\n */\nexport const allSeriesUpdate = (store, series, remove = false) => {\n  const variables = { limit: 100 }\n  const query = allSeries\n  let newData = {\n    allSeries: {\n      seriesSummaries: [],\n      nextToken: null,\n      __typename: 'PaginatedSeries'\n    }\n  }\n  try {\n    // This may or may not exist yet\n    const qVal = store.readQuery({ query, variables })\n    newData = _.cloneDeep(qVal)\n  }\n  catch (e) {\n    console.warn('ERROR: allSeriesUpdate readQuery failed')\n  }\n\n  try {\n    newData.allSeries.seriesSummaries = updateSeriesSummaries(newData.allSeries.seriesSummaries, series, remove)\n    store.writeQuery({ query, variables, data: newData })\n    console.log('updateQueries::allSeriesUpdate DONE')\n  }\n  catch (e) {\n    console.error('ERROR: allSeriesUpdate writeQuery failed')\n  }\n}\n\n/**\n * Add or remove a photot to the allSeries cached query\n *\n * @param {*} store\n * @param {*} series\n * @param {*} photo\n * @param {*} remove\n */\nexport const allSeriesPhotoUpdate = (store, series, photo, remove = false) => {\n  const query = allSeries\n  try {\n    const qVal = store.readQuery({ query, variables: { limit: 100 } })\n    const newData = _.cloneDeep(qVal)\n\n    newData.allSeries.seriesSummaries = newData.allSeries.seriesSummaries.map(s => {\n      if (s.id !== photo.seriesId) return s\n      else {\n        const newS = _.cloneDeep(s)\n        if (remove && series) {\n          // set a new latest photo\n          if (newS.latest.id === photo.id) {\n            newS.latest = series.photos[series.photos.length - 1]\n          }\n          // set a new featured photo\n          if (newS.featured.id === photo.id) {\n            newS.featured = series.photos[series.photos.length - 1]\n          }\n        }\n        else {\n          // set a new latest photo\n          const photoSummary = _.pick(photo, photoSummaryKeys)\n          photoSummary.__typename = 'PhotoSummary'\n          newS.latest = photoSummary\n        }\n        return newS\n      }\n    })\n    store.writeQuery({ query, data: newData })\n    console.log('updateQueries::allSeriesPhotoUpdate DONE')\n  }\n  catch (e) {\n    console.error('createPhotoMutation:: allSeries read or write ERROR')\n  }\n}\n\n/**\n * Add or remove a series to the user's listing\n *\n * @param {*} store\n * @param {*} series\n * @param {*} remove\n */\nexport const userSeriesUpdate = (store, series, remove = false) => {\n  const query = userSeries\n\n  let newData = {\n    userSeries: {\n      seriesSummaries: [],\n      nextToken: null,\n      __typename: 'PaginatedSeries'\n    }\n  }\n  try {\n    // This may or may not exist yet\n    const qVal = store.readQuery({ query })\n    newData = _.cloneDeep(qVal)\n  }\n  catch (e) {\n    console.warn('ERROR: userSeriesUpdate readQuery failed')\n  }\n\n  try {\n    newData.userSeries.seriesSummaries = updateSeriesSummaries(newData.userSeries.seriesSummaries, series, remove)\n    store.writeQuery({ query, data: newData })\n    console.log('updateQueries::userSeriesUpdate DONE')\n  }\n  catch (e) {\n    console.error('ERROR: userSeriesUpdate writeQuery failed')\n  }\n}\n\n/**\n * Add or remove an item to the cached feed\n * This is really limited because we can't add anything we don't already have in the series cache\n *\n * @param {*} store\n * @param {*} series\n * @param {*} photo\n * @param {*} remove\n */\nexport const feedUpdate = (store, series, photo, remove = false) => {\n  const query = getMyFeed\n\n  let newData = {\n    myFeed: {\n      feed: [],\n      window: null,\n      __typename: 'PaginatedSeries'\n    }\n  }\n  try {\n    // This may or may not exist yet\n    const qVal = store.readQuery({ query })\n    newData = _.cloneDeep(qVal)\n  }\n  catch (e) {\n    console.warn('ERROR: feedUpdate readQuery failed')\n  }\n\n  try {\n    newData.myFeed.feed = updateFeedList(newData.myFeed.feed, series, photo, remove)\n    store.writeQuery({ query, data: newData })\n    console.log('updateQueries::feedUpdate DONE')\n  }\n  catch (e) {\n    console.log('ERROR', { newData })\n    console.error('ERROR: feedUpdate writeQuery failed')\n  }\n}\n\n/**\n * Watch or unwatch the series in the cached getUser query\n * @param {*} store\n * @param {*} seriesId\n * @param {*} remove\n */\nexport const watchUpdate = (store, seriesId, remove = false) => {\n  const query = getUser\n  try {\n    const qVal = store.readQuery({ query })\n    const newData = _.cloneDeep(qVal)\n\n    if (remove) {\n      newData.user.watching = newData.user.watching.filter(sid => sid !== seriesId)\n    }\n    else {\n      newData.user.watching = [...new Set([...newData.user.watching || [], seriesId])]\n    }\n\n    store.writeQuery({ query, data: newData })\n    console.log('updateQueries::watchUpdate DONE', remove ? 'unwatch' : 'watch')\n  }\n  catch (e) {\n    console.error('ERROR: getUser readQuery failed')\n  }\n}\n","// import React, { useContext } from 'react'\n// import PropTypes from 'prop-types'\nimport { graphql } from 'react-apollo'\nimport { getWholeSeriesUpdate, allSeriesUpdate, feedUpdate, userSeriesUpdate } from './updateQueries'\nimport { createSeries, newSeriesKeys, newPhotoKeys } from '../mutations'\nimport { photoSummaryKeys } from '../fragments'\nimport { pushMutationPromise, popMutationPromise } from '../offline'\n\nimport _ from 'lodash'\n\nexport const withMutation = graphql(createSeries, {\n  props: ({ mutate, ownProps }) => {\n    return {\n      createSeriesMutation: async (newSeries, newPhoto, ext) => {\n        const { id, gravatar, gravatarProfile, username } = ownProps.user\n        const meUserSummary = { id, gravatar, gravatarProfile, username, __typename: 'UserSummary' }\n        if (!newSeries.access) newSeries.access = 'PRIVATE'\n\n        const variables = {\n          series: _.pick(newSeries, newSeriesKeys),\n          photo: _.pick(newPhoto, newPhotoKeys),\n          ext\n        }\n        const optimisticResponse = createOptimisticResponse({ meUserSummary, newSeries, newPhoto, ext })\n        const mutationStackId = await pushMutationPromise({ variables, optimisticResponse }, createSeries)\n        console.log('createSeriesMutation:: start', { newSeries, newPhoto, variables, optimisticResponse, ext })\n        return mutate({\n          variables,\n          // refetchQueries: [{ query: getWholeSeries, variables: { id: newSeries.id } }],\n          optimisticResponse,\n          update: updateThunk({}, ownProps.doneCreatingSeries)\n        }).then(data => {\n          // Here's where we take it out of the queue\n          console.log('createSeriesMutation:: done', data)\n          popMutationPromise(mutationStackId)\n          return data\n        })\n      }\n    }\n  }\n})\n\nconst updateThunk = (context, cb) => (store, { data }) => {\n  // We need to write this query from scratch\n  console.log('createSeriesMutation::updateThunk', { data })\n  getWholeSeriesUpdate(store, data.createSeries.series)\n  userSeriesUpdate(store, data.createSeries.series)\n  allSeriesUpdate(store, data.createSeries.series)\n  feedUpdate(store, data.createSeries.series, data.createSeries.series.photos[0])\n\n  if (cb) cb(data.createSeries.series.id)\n}\n\nconst createOptimisticResponse = ({ meUserSummary, newSeries, newPhoto, ext }) => {\n  const photoResponse = {\n    id: newPhoto.id,\n    meta: newPhoto.meta || null,\n    seriesId: newSeries.id,\n    createdOn: Date.now().toString(),\n    createdUser: meUserSummary,\n    updatedUser: meUserSummary,\n    createdBy: meUserSummary.id,\n    updatedBy: meUserSummary.id,\n    uploadToken: newPhoto.uploadToken,\n    updatedOn: Date.now().toString(),\n    seriesCreatedBy: meUserSummary.id, // we can't answer this yet\n    takenOn: newPhoto.takenOn,\n    coords: newPhoto.coords || null,\n    tags: newPhoto.tags || [],\n    paths: {\n      base: null,\n      large: null,\n      orig: null,\n      thumb: null,\n      medium: null,\n      __typename: 'Paths'\n    },\n    __typename: 'Photo'\n  }\n  const photoResponseSummary = _.pick(photoResponse, photoSummaryKeys)\n\n  return {\n    createSeries: {\n      series: {\n        id: newSeries.id,\n        name: newSeries.name,\n        note: newSeries.note || null,\n        access: newSeries.access,\n        meta: newSeries.meta || null,\n        featured: {\n          ...photoResponseSummary,\n          __typename: 'PhotoSummary'\n        },\n        latest: {\n          ...photoResponseSummary,\n          __typename: 'PhotoSummary'\n        },\n        seriesStatus: null,\n        coords: newSeries.coords || null,\n        direction: newSeries.direction || null,\n        photoCount: 1,\n        createdUser: meUserSummary,\n        updatedUser: meUserSummary,\n        createdBy: meUserSummary.id,\n        updatedBy: meUserSummary.id,\n        createdOn: Date.now().toString(),\n        updatedOn: Date.now().toString(),\n        watchers: 0,\n        photos: [photoResponse],\n        __typename: 'Series'\n      },\n      preAuth: null,\n      __typename: 'NewSeries'\n    }\n  }\n}\n\nexport default {\n  withMutation,\n  updateThunk\n}\n","import localforage from 'localforage'\nimport createSeries from './mutations/createSeries'\nimport uuidv4 from 'uuid/v4'\n\nlocalforage.config({\n  storeName: 'MorPhoto', // Should be alphanumeric, with underscores.\n  description: 'image blobs'\n})\n\nexport const imgStore = localforage.createInstance({\n  name: 'imgStore'\n})\nexport const stateStore = localforage.createInstance({\n  name: 'stateStore'\n})\n\nconst OFFLINEMUTATIONS = 'offlineMutations'\n\n// Pull serialized mutations from localst orage\nfunction getPendingPromise () {\n  return stateStore.getItem(OFFLINEMUTATIONS)\n    .then(mutations => {\n      console.log('offline::getPendingPromise', JSON.parse(mutations) || [])\n      return JSON.parse(mutations) || []\n    })\n}\n\n// Store serialized mutations in stateStore\nfunction setPendingPromise (mutations) {\n  console.log('offline::setPendingPromise', mutations)\n  return stateStore.setItem(OFFLINEMUTATIONS, JSON.stringify(mutations))\n}\n\n/**\n * Push a mutation onto the stack\n * @param {*} params {variables, optimisticResponse etc}\n * @param {*} mutation\n * @param {*} context\n */\nexport function pushMutationPromise (params, mutation, context) {\n  const id = uuidv4()\n  return getPendingPromise()\n    .then(mutations => mutations.concat({ id, params, mutation, context }))\n    .then(data => {\n      console.log('offline::pushMutationPromise', data)\n      return data\n    })\n    .then(setPendingPromise)\n    .then(() => id)\n}\n\nexport function popMutationPromise (id) {\n  return getPendingPromise()\n    .then(mutations => mutations.filter(pm => pm.id !== id))\n    .then(data => {\n      console.log('offline::popMutationPromise', data)\n      return data\n    })\n    .then(setPendingPromise)\n}\n\n// Delegate incoming responses to the correct update function\nfunction updateHandler (resp, context) {\n  // IMPORTANT: You need one of these for every custom update function you use!\n  // There's no post-update step at this level so the thunk params are empty\n  console.log('offline::updateHandler', { resp, context })\n  if (resp.data.createSeries) return createSeries.updateThunk(context)\n  else return () => {}\n}\n\n// Return a dummy update function scoped to a request with a specific id\nfunction proxyUpdateForId (id, context) {\n  return (proxy, resp) => {\n    updateHandler(resp, context)(proxy, resp)\n    // If this is the real deal and we're online then clean it up\n    if (!resp.data.__optimistic) return popMutationPromise(id)\n    else return Promise.resolve()\n  }\n}\n\n// Restore pending requests\n// This should be called after a page refresh\nexport function restoreRequests (client) {\n  return getPendingPromise()\n    .then(mutations => mutations.forEach(pendingMutation => {\n      console.log('offline::restoreRequests', mutations, pendingMutation)\n      const { id, params, mutation, context } = pendingMutation\n      params.optimisticResponse.__optimistic = true\n      params.update = proxyUpdateForId(id, context)\n      params.mutation = mutation\n      client.mutate(params)\n    }))\n}\n","import { useState, useEffect } from 'react'\nimport { createHttpLink } from 'apollo-link-http'\nimport { setContext } from 'apollo-link-context'\nimport { RetryLink } from 'apollo-link-retry'\nimport Amplify, { Auth } from 'aws-amplify'\n// import PropTypes from 'prop-types'\nimport { endpoints, aws } from '../config'\nimport { ApolloLink } from 'apollo-link'\nimport { stateStore, restoreRequests } from './offline'\nimport { InMemoryCache, ApolloClient } from 'apollo-boost'\nimport { persistCache } from 'apollo-cache-persist'\n\nAmplify.configure(aws)\n\nconst LOCAL_STORAGE_TOKEN = 'apollo-token'\n\nexport const APOLLOSTATES = {\n  INITIALIZING: 'Initializing',\n  AUTHENTICATING: 'Authenticating',\n  LOADING: 'Loading State',\n  APPLY_MUTATIONS: 'Applying history',\n  ERROR: 'ERROR!',\n  DONE: 'DONE'\n}\n\nfunction useGraphQL () {\n  const [client, setClient] = useState(null)\n  const [done, setDone] = useState(false)\n  const [currState, setCurrState] = useState(APOLLOSTATES.INITIALIZING)\n\n  useEffect(() => {\n    createApolloClient((newClient, newState) => {\n      console.log('createApolloClient::', newState, newClient)\n      setClient(newClient)\n      setDone((client || newClient) && newState === APOLLOSTATES.DONE)\n      setCurrState(newState)\n    })\n  }, [])\n\n  return { client, done, currState }\n}\n\nexport default useGraphQL\n\n/**\n * Helper function to create our Apollo Client object\n * @param {*} tokenFunc\n */\nconst getCurrentToken = async () => {\n  try {\n    const currSession = await Auth.currentSession()\n    return currSession.accessToken.jwtToken\n  }\n  catch (e) {\n    return null\n  }\n}\n\nasync function createApolloClient (onChange) {\n  // Set up our headers for authentication through graphql\n  const cache = new InMemoryCache({\n    // dataIdFromObject: ({ __typename, id }) => __typename && id ? `${__typename}::${id}`\n  })\n\n  try {\n    // See above for additional options, including other storage providers.\n    onChange(null, APOLLOSTATES.LOADING)\n    await persistCache({\n      cache,\n      storage: stateStore\n    })\n  }\n  catch (error) {\n    console.error('Error restoring Apollo cache', error)\n    onChange(null, APOLLOSTATES.ERROR)\n    return\n  }\n\n  // The auth link is just used to decorate our HTTP headers with authentication data\n  const authLink = setContext(async (_, { headers }) => {\n    const token = await getCurrentToken()\n\n    const newHeaders = {\n      ...headers,\n      authorization: token ? `Bearer ${token}` : ''\n    }\n    // on Dev machines, allow us to fake a user. This will ONLY work with a complimentary\n    // Dev graphql endpoint and singin is still required.\n\n    // This was done so we can test what the App looks like from varying perspectives\n    if (token && process.env.NODE_ENV === 'development' && process.env.REACT_APP_FAKE_USER) {\n      newHeaders.auth_user = process.env.REACT_APP_FAKE_USER\n    }\n    return { headers: newHeaders }\n  })\n\n  // HTTP link creates the network connection to our graphql host\n  const httpLink = createHttpLink({ uri: endpoints.graphql })\n  const retry = new RetryLink({\n    attempts: {\n      max: Infinity,\n      retryIf: (error, _operation) => {\n        console.log('GRAPHQL ERRORS', { error, _operation })\n        return true\n      }\n    }\n  })\n  console.log('Creating Apollo Client Client', endpoints.graphql)\n\n  const apolloClient = new ApolloClient({\n    link: ApolloLink.from([retry, authLink, httpLink]),\n    tokenName: LOCAL_STORAGE_TOKEN,\n    addTypename: true,\n    cache,\n    connectToDevTools: process.env.NODE_ENV === 'development'\n  })\n  // Now pause while we restore any mutations\n  onChange(null, APOLLOSTATES.APPLY_MUTATIONS)\n  await restoreRequests(apolloClient)\n  // Now put it all together\n  onChange(apolloClient, APOLLOSTATES.DONE)\n}\n\n// Note: this method comes from isntructions here:\n// https://www.apollographql.com/docs/react/recipes/authentication.html\n// export const withApollo = compose(\n//   lifecycle({\n//     shouldComponentUpdate (nextProps) {\n//       const { authStore: { jwtToken: oldToken } } = nextProps\n//       const { authStore: { jwtToken: newToken } } = this.props\n//       if (newToken === oldToken) {\n//         return true\n//       }\n//       return true\n//     }\n//   }),\n//   withWrapClient\n// )\n","export default theme => ({\n  root: {\n  },\n  spacer: {\n    flexGrow: 1\n  },\n  forgotPassword: {\n    width: '100%',\n    textAlign: 'right'\n  },\n  switch: {\n\n  },\n  switchButton: {\n    flexGrow: 1,\n    '&:last-child': {\n      borderRadius: 0\n    },\n    '&:first-child': {\n      borderRadius: 0\n    }\n  },\n  phoneNumInner: {\n    marginTop: theme.spacing(1),\n    display: 'flex'\n    // border: '1px solid red'\n  },\n  phoneNumDropdown: {\n    margin: theme.spacing(1),\n    minWidth: 120\n  },\n  warnText: {\n    marginTop: theme.spacing(2),\n    fontStyle: 'italic'\n  },\n  noSignin: {\n    margin: theme.spacing(2, 0),\n    padding: theme.spacing(1),\n    textAlign: 'left',\n    border: `1px solid #00000022`,\n    background: `#0000000F`\n  }\n})\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport TextField from '@material-ui/core/TextField'\nimport Button from '@material-ui/core/Button'\nimport Toolbar from '@material-ui/core/Toolbar'\n// import MenuIcon from '@material-ui/core/Menu'\n// import { FederatedButtons } from 'aws-amplify-react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport style from './auth.style'\nimport AuthContainer from './AuthContainer'\nimport { Typography } from '@material-ui/core'\n\nconst useStyles = makeStyles(style)\n\nconst SignIn = ({ loading,\n  handleSignup,\n  federated,\n  handleForgotPassword,\n  handleInputChange,\n  handleBeAnonymous,\n  handleSignIn, ...props }) => {\n  const classes = useStyles()\n  return (\n    <AuthContainer>\n      {/* {props.federated && (\n        <FederatedButtons {...props} />\n      )} */}\n      <TextField\n        id='username'\n        fullWidth\n        key='username'\n        name='username'\n        label='Username'\n        color='inherit'\n        autoFocus\n        className={classes.textField}\n        margin='normal'\n        onChange={handleInputChange}\n      />\n      <TextField\n        fullWidth\n        id='password'\n        label='Password'\n        color='inherit'\n        key='password'\n        name='password'\n        type='password'\n        className={classes.textField}\n        autoComplete='current-password'\n        margin='normal'\n        onChange={handleInputChange}\n      />\n      <Toolbar disableGutters>\n\n        <Button component='button' color='secondary' variant='contained' disabled={loading} onClick={handleSignup}>\n          New Account\n        </Button>\n        <div className={classes.spacer} />\n        <Button\n          className='enterAction'\n          component='button'\n          color='primary'\n          variant='contained'\n          disabled={loading}\n          onClick={handleSignIn}\n        >\n          Sign In\n        </Button>\n      </Toolbar>\n      <Button color='primary' onClick={handleForgotPassword} size='small'>\n      Forgot Password\n      </Button>\n      <div className={classes.noSignin}>\n        <Button fullWidth size='small' variant={'outlined'} onClick={handleBeAnonymous} color='inherit'>\n          Continue without logging in\n        </Button>\n        <Typography variant='caption' className={classes.warnText} color='textSecondary' component='div'>\n          You will not be able to add content and many features will be unavailable.\n        </Typography>\n      </div>\n    </AuthContainer>\n  )\n}\n\nSignIn.propTypes = {\n  loading: PropTypes.bool,\n  federated: PropTypes.object,\n  handleSignup: PropTypes.func.isRequired,\n  handleForgotPassword: PropTypes.func.isRequired,\n  handleInputChange: PropTypes.func.isRequired,\n  handleBeAnonymous: PropTypes.func.isRequired,\n  handleSignIn: PropTypes.func.isRequired\n}\n\nexport default SignIn\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport TextField from '@material-ui/core/TextField'\nimport Button from '@material-ui/core/Button'\nimport Toolbar from '@material-ui/core/Toolbar'\n// import MenuIcon from '@material-ui/core/Menu'\nimport { makeStyles } from '@material-ui/core/styles'\nimport style from './auth.style'\nimport AuthContainer from './AuthContainer'\n\nconst useStyles = makeStyles(style)\n\nconst ConfirmSignIn = ({ handleInputChange, handleBack, handleConfirm }) => {\n  const classes = useStyles()\n  return (\n    <AuthContainer>\n      <TextField\n        id='mfaCode'\n        fullWidth\n        autoFocus\n        label='MFA Code'\n        name='code'\n        className={classes.textField}\n        margin='normal'\n        onChange={handleInputChange}\n      />\n\n      <Toolbar disableGutters>\n        <Button color='secondary' variant='contained' onClick={handleBack}>\n          Back\n        </Button>\n        <div className={classes.spacer} />\n        <Button\n          className='enterAction'\n          color='primary'\n          variant='contained'\n          onClick={handleConfirm}\n        >\n          Confirm\n        </Button>\n      </Toolbar>\n    </AuthContainer>\n  )\n}\n\nConfirmSignIn.propTypes = {\n  handleInputChange: PropTypes.func.isRequired,\n  handleBack: PropTypes.func.isRequired,\n  handleConfirm: PropTypes.func.isRequired\n}\n\nexport default ConfirmSignIn\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport TextField from '@material-ui/core/TextField'\nimport Button from '@material-ui/core/Button'\nimport Typography from '@material-ui/core/Typography'\nimport Toolbar from '@material-ui/core/Toolbar'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport style from './auth.style'\nimport AuthContainer from './AuthContainer'\n\nconst useStyles = makeStyles(style)\n\nconst RequireNewPassword = ({ change, requiredAttributes, placeholders, handleInputChange }) => {\n  const classes = useStyles()\n  return (\n    <AuthContainer>\n      <Typography>A new password is required</Typography>\n      <TextField\n        id='newassword'\n        fullWidth\n        autoFocus\n        label='New Password'\n        className={classes.textField}\n        type='password'\n        autoComplete='new-password'\n        margin='normal'\n        onChange={handleInputChange}\n      />\n      {requiredAttributes\n        .map((attribute, idx) => (\n          <TextField\n            fullWidth\n            key={attribute}\n            name={attribute}\n            className={classes.textField}\n            placeholder={placeholders[idx]}\n            type='text'\n            margin='normal'\n            onChange={handleInputChange}\n          />\n        ))}\n\n      <Toolbar disableGutters>\n\n        <Button color='secondary' variant='contained'>\n          Back\n        </Button>\n        <div className={classes.spacer} />\n        <Button\n          color='primary'\n          variant='contained'\n          onClick={change}\n          className='enterAction'\n        >\n          Change\n        </Button>\n      </Toolbar>\n    </AuthContainer>\n  )\n}\n\nRequireNewPassword.propTypes = {\n  change: PropTypes.func.isRequired,\n  handleInputChange: PropTypes.func.isRequired,\n  requiredAttributes: PropTypes.array,\n  placeholders: PropTypes.array\n}\n\nexport default RequireNewPassword\n","import React, { useState } from 'react'\nimport PropTypes from 'prop-types'\nimport TextField from '@material-ui/core/TextField'\nimport Button from '@material-ui/core/Button'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport FormControl from '@material-ui/core/FormControl'\nimport InputLabel from '@material-ui/core/InputLabel'\nimport Select from '@material-ui/core/Select'\nimport AuthContainer from './AuthContainer'\n\n// import MenuIcon from '@material-ui/core/Menu'\nimport { makeStyles } from '@material-ui/core/styles'\nimport style from './auth.style'\n// import AuthPhoneNum from './AuthPhoneNum'\nconst useStyles = makeStyles(style)\n\nconst SignUp = ({ handleInputChange, signUpFields, signUpFieldLabels, signUpFieldPlaceholders,\n  handleSignup, handleBack, countryDialCodes, defaultDialCode }) => {\n  console.log('SIGNUPPROPS', { defaultDialCode, countryDialCodes, signUpFields, signUpFieldLabels, signUpFieldPlaceholders })\n  const [selectVal, setSelectVal] = useState(defaultDialCode)\n  const classes = useStyles()\n  const handleDialCodeChange = e => {\n    handleInputChange(e)\n    setSelectVal(e.target.value)\n  }\n  return (\n    <AuthContainer>\n      {\n        signUpFields.map((field, idx) => {\n          return field.key !== 'phone_number' ? (\n            <TextField\n              fullWidth\n              autoFocus={signUpFields.findIndex(f => f.key === field.key) === 0}\n              type={field.type}\n              name={field.key}\n              key={field.key}\n              placeholder={signUpFieldPlaceholders[idx]}\n              label={signUpFieldLabels[idx]}\n              className={classes.textField}\n              margin='normal'\n              onChange={handleInputChange}\n            />\n          ) : (\n            <FormControl\n              className={classes.phoneNumDropdown}\n              fullWidth\n              key='phonenum'\n            >\n              <InputLabel htmlFor='dial_code' shrink>\n                {signUpFieldLabels[idx]}\n                {field.required ? '*' : ''}\n              </InputLabel>\n              <div className={classes.phoneNumInner}>\n                <Select\n                  value={selectVal}\n                  onChange={handleDialCodeChange}\n                  inputProps={{\n                    name: 'dial_code',\n                    id: 'dial_code'\n                  }}\n                >\n                  {countryDialCodes.map(dialCode =>\n                    <option key={dialCode} value={dialCode}>\n                      {dialCode}\n                    </option>\n                  )}\n                </Select>\n                <TextField\n                  placeholder={signUpFieldPlaceholders[idx]}\n                  type='tel'\n                  fullWidth\n                  id='phone_line_number'\n                  key='phone_line_number'\n                  name='phone_line_number'\n                  onChange={handleInputChange}\n                />\n              </div>\n            </FormControl>\n          )\n        })\n      }\n      <Toolbar disableGutters>\n        <Button color='secondary' variant='outlined' onClick={handleBack}>\n          Back\n        </Button>\n        <div className={classes.spacer} />\n        <Button\n          className='enterAction'\n          component='button'\n          color='primary'\n          variant='contained'\n          onClick={handleSignup}\n        >\n          Create Account\n        </Button>\n      </Toolbar>\n    </AuthContainer>\n  )\n}\n\nSignUp.propTypes = {\n  handleInputChange: PropTypes.func.isRequired,\n  signUpFields: PropTypes.array.isRequired,\n  signUpFieldLabels: PropTypes.array.isRequired,\n  signUpFieldPlaceholders: PropTypes.array.isRequired,\n  countryDialCodes: PropTypes.array.isRequired,\n  defaultDialCode: PropTypes.string.isRequired,\n  handleSignup: PropTypes.func.isRequired,\n  handleBack: PropTypes.func.isRequired\n}\n\nexport default SignUp\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport TextField from '@material-ui/core/TextField'\nimport Button from '@material-ui/core/Button'\nimport Link from '@material-ui/core/Link'\nimport Toolbar from '@material-ui/core/Toolbar'\n// import MenuIcon from '@material-ui/core/Menu'\nimport { makeStyles } from '@material-ui/core/styles'\nimport style from './auth.style'\nimport AuthContainer from './AuthContainer'\n\nconst useStyles = makeStyles(style)\n\nconst ConfirmSignUp = ({ handleInputChange, handleBack, handleResend, handleConfirm }) => {\n  const classes = useStyles()\n  return (\n    <AuthContainer>\n      <TextField\n        id='username'\n        fullWidth\n        autoFocus\n        name='username'\n        label='Username'\n        className={classes.textField}\n        margin='normal'\n        onChange={handleInputChange}\n      />\n      <TextField\n        id='confirmationCode'\n        fullWidth\n        name='code'\n        label='Confirmation Code'\n        className={classes.textField}\n        margin='normal'\n        onChange={handleInputChange}\n\n      />\n      <Link component='button' variant='body2' className={classes.resendCode} onClick={handleResend}>\n          Resend Code\n      </Link>\n      <Toolbar disableGutters>\n\n        <Button color='secondary' variant='outlined' onClick={handleBack}>\n          Back\n        </Button>\n        <div className={classes.spacer} />\n        <Button\n          color='primary'\n          variant='contained'\n          className='enterAction'\n          onClick={handleConfirm}\n        >\n          Sign In\n        </Button>\n      </Toolbar>\n    </AuthContainer>\n  )\n}\n\nConfirmSignUp.propTypes = {\n  handleInputChange: PropTypes.func.isRequired,\n  handleBack: PropTypes.func.isRequired,\n  handleResend: PropTypes.func.isRequired,\n  handleConfirm: PropTypes.func.isRequired\n}\n\nexport default ConfirmSignUp\n","import React, { useState } from 'react'\nimport PropTypes from 'prop-types'\nimport Link from '@material-ui/core/Link'\nimport TextField from '@material-ui/core/TextField'\nimport Typography from '@material-ui/core/Typography'\nimport Button from '@material-ui/core/Button'\n\nimport Toolbar from '@material-ui/core/Toolbar'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport style from './auth.style'\nimport AuthContainer from './AuthContainer'\n\nconst useStyles = makeStyles(style)\n\nconst ForgotPassword = ({ handleSubmit, handleInputChange, handleSendCode, handleBack }) => {\n  const [sent, setSent] = useState(false)\n  const classes = useStyles()\n  return (\n    <AuthContainer>\n      <Typography>Forgot Password</Typography>\n      {!sent && (\n        <TextField\n          id='username'\n          autoFocus\n          fullWidth\n          label='Username'\n          name='username'\n          className={classes.textField}\n          margin='normal'\n          onChange={handleInputChange}\n        />\n      )}\n      {sent && (\n        <TextField\n          id='changecode'\n          fullWidth\n          autoFocus\n          label='Code'\n          name='code'\n          className={classes.textField}\n          margin='normal'\n          onChange={handleInputChange}\n        />\n      )}\n      {sent && (\n        <TextField\n          id='newpassword'\n          fullWidth\n          label='New Password'\n          className={classes.textField}\n          type='password'\n          name='password'\n          autoComplete='current-password'\n          margin='normal'\n          onChange={handleInputChange}\n        />\n      )}\n      {sent && (\n        <Link component='button' variant='body2' className={classes.resendCode} onClick={handleSendCode}>\n          Resend Code\n        </Link>\n\n      )}\n      <Toolbar disableGutters>\n        <Button\n          color='secondary'\n          variant='outlined'\n          onClick={() => {\n            sent ? setSent(false) : handleBack()\n          }}\n        >\n          Back\n        </Button>\n        <div className={classes.spacer} />\n        {!sent && (\n          <Button\n            color='primary'\n            variant='contained'\n            className='enterAction'\n            onClick={() => {\n              setSent(true)\n              handleSendCode()\n            }}\n          >\n          Send Code\n          </Button>\n        )}\n        {sent && (\n          <Button\n            className='enterAction'\n            color='primary'\n            variant='contained'\n            onClick={handleSubmit}\n          >\n          Submit\n          </Button>\n        )}\n      </Toolbar>\n    </AuthContainer>\n  )\n}\n\nForgotPassword.propTypes = {\n  handleSubmit: PropTypes.func.isRequired,\n  handleInputChange: PropTypes.func.isRequired,\n  handleSendCode: PropTypes.func.isRequired,\n  handleBack: PropTypes.func.isRequired\n}\n\nexport default ForgotPassword\n","import React, { useState } from 'react'\nimport Amplify, { Auth } from 'aws-amplify'\nimport { I18n } from '@aws-amplify/core' // ConsoleLogger as Logger\nimport countryDialCodes from 'aws-amplify-react/dist/Auth/common/country-dial-codes'\nimport {\n  Authenticator,\n  SignIn as SignInOrig,\n  SignUp as SignUpOrig,\n  ConfirmSignIn as ConfirmSignInOrig,\n  ConfirmSignUp as ConfirmSignUpOrig,\n  RequireNewPassword as RequireNewPasswordOrig,\n  Loading as LoadingOrig,\n  VerifyContact as VerifyContactOrig,\n  ForgotPassword as ForgotPasswordOrig\n} from 'aws-amplify-react'\n\nimport CompSignIn from '../components/auth/SignIn'\nimport CompConfirmSignIn from '../components/auth/ConfirmSignIn'\nimport CompRequireNewPassword from '../components/auth/RequireNewPassword'\nimport CompSignUp from '../components/auth/SignUp'\nimport CompLoading from '../components/auth/Loading'\nimport CompConfirmSignUp from '../components/auth/ConfirmSignUp'\n// import CompVerifyContact from '../components/auth/VerifyContact'\nimport CompForgotPassword from '../components/auth/ForgotPassword' // or 'aws-amplify-react-native';\nimport { aws } from '../config'\n\nAmplify.configure(aws)\n\nconst defaultAuthState = { authState: 'init', authData: {}, signedIn: null }\n\nconst useAuthentication = () => {\n  const [{ authState, authData, signedIn }, setAuth] = useState(defaultAuthState)\n\n  // Set up the trinary\n  // if (authState === 'signedIn') signedIn = true\n\n  const handleAuthStateChange = (state, data) => {\n    // console.log('handleAuthStateChange', { state, data })\n    setAuth({\n      authState: state,\n      authData: data,\n      // true = signedIn, false = beAnonymous, null = showLoginScreen\n      signedIn: !state || state.length === 0\n        ? null\n        : state === 'signedIn'\n          ? true\n          : signedIn\n    })\n  }\n\n  const getCurrentToken = async () => {\n    const currSession = await Auth.currentSession()\n    console.log('here', currSession.accessToken)\n    return currSession && currSession.accessToken ? currSession.accessToken : null\n  }\n\n  const signOut = () => Auth.signOut()\n    .then(data => console.log(data))\n    .catch(err => console.log(err))\n\n  const beAnonymous = () => {\n    setAuth({ authState, authData, signedIn: false })\n  }\n\n  const authScreen = signedIn ? null\n    : <Authenticator onStateChange={handleAuthStateChange} hideDefault>\n      <SignIn handleBeAnonymous={beAnonymous} />\n      <Loading message='Loggin in' />\n      <RequireNewPassword />\n      {/* <RequireNewPasswordOrig /> */}\n      <ConfirmSignIn />\n      <ConfirmSignUp />\n      {/* <VerifyContact /> NOT READY */}\n      <VerifyContactOrig />\n      <ForgotPassword />\n      <SignUp />\n      {/* <SignUpOrig /> */}\n    </Authenticator>\n\n  let isGod = false\n  try {\n    isGod = authData.signInUserSession.idToken.payload['cognito:groups'].indexOf('GodUsers') > -1\n  }\n  catch (e) {}\n\n  return {\n    authState,\n    authData,\n    isGod,\n    signOut,\n    getCurrentToken,\n    forceSignIn: () => setAuth(defaultAuthState),\n    signedIn,\n    authScreen\n  }\n}\n\nexport default useAuthentication\n\nclass SignIn extends SignInOrig {\n  showComponent () {\n    const { loading } = this.state\n    const newProps = {\n      ...this.props,\n      loading,\n      handleForgotPassword: () => this.changeState('forgotPassword'),\n      handleSignup: () => this.changeState('signUp'),\n      handleInputChange: this.handleInputChange,\n      handleSignIn: this.signIn\n    }\n    return <CompSignIn {...newProps} />\n  }\n}\n\nclass SignUp extends SignUpOrig {\n  showComponent () {\n    const { hide } = this.props\n    if (hide && hide.includes(SignUp)) {\n      return null\n    }\n    if (this.checkCustomSignUpFields()) {\n      this.signUpFields = this.props.signUpConfig.signUpFields\n    }\n    this.sortFields()\n\n    const newProps = {\n      ...this.props,\n      countryDialCodes,\n      defaultDialCode: this.getDefaultDialCode(),\n      handleInputChange: this.handleInputChange,\n      signUpFields: this.signUpFields,\n      signUpFieldLabels: this.signUpFields.map(field => I18n.get(field.label)),\n      signUpFieldPlaceholders: this.signUpFields.map(field => I18n.get(field.placeholder)),\n      handleSignup: this.signUp,\n      handleBack: () => this.changeState('signIn')\n    }\n    return <CompSignUp {...newProps} />\n  }\n}\n\nclass ConfirmSignIn extends ConfirmSignInOrig {\n  showComponent () {\n    const newProps = {\n      ...this.props,\n      handleBack: () => this.changeState('signIn'),\n      handleInputChange: this.handleInputChange,\n      handleConfirm: this.confirm\n    }\n    return <CompConfirmSignIn {...newProps} />\n  }\n}\n\nclass ConfirmSignUp extends ConfirmSignUpOrig {\n  showComponent () {\n    const newProps = {\n      ...this.props,\n      handleBack: () => this.changeState('signIn'),\n      handleInputChange: this.handleInputChange,\n      handleConfirm: this.confirm,\n      handleResend: this.resend\n    }\n    return <CompConfirmSignUp {...newProps} />\n  }\n}\n\nclass RequireNewPassword extends RequireNewPasswordOrig {\n  showComponent () {\n    const user = this.props.authData\n    const { requiredAttributes } = user.challengeParam\n    const placeholders = Array.isArray(requiredAttributes)\n      ? requiredAttributes.map(attribute => I18n.get(convertToPlaceholder(attribute)))\n      : []\n\n    const newProps = {\n      ...this.props,\n      handleInputChange: this.handleInputChange,\n      requiredAttributes,\n      placeholders,\n      change: this.change\n    }\n    return <CompRequireNewPassword {...newProps} />\n  }\n}\n\nclass Loading extends LoadingOrig {\n  showComponent () {\n    return <CompLoading {...this.props} />\n  }\n}\n// class VerifyContact extends VerifyContactOrig {\n//   showComponent () {\n//     const user = this.props.authData\n//     if (!user) {\n//       verifyLogger.debug('no user for verify')\n//       return null\n//     }\n//     const { unverified } = user\n//     if (!unverified) {\n//       verifyLogger.debug('no unverified on user')\n//       return null\n//     }\n//     const { email, phoneNumber } = unverified\n\n//     const { authData } = this.props\n//     const newProps = {\n//       ...this.props,\n//       handleInputChange: this.handleInputChange,\n//       handleSkip: () => this.changeState('signedIn', authData),\n//       handleVerify: this.verify,\n//       handleSubmit: this.submit\n//     }\n//     return <CompVerifyContact {...newProps} />\n//   }\n// }\nclass ForgotPassword extends ForgotPasswordOrig {\n  showComponent () {\n    const newProps = {\n      ...this.props,\n      handleBack: () => this.changeState('signIn'),\n      handleInputChange: this.handleInputChange,\n      handleConfirm: this.confirm,\n      handleResend: this.send,\n      handleSubmit: this.submit,\n      handleSendCode: this.send\n    }\n    return <CompForgotPassword {...newProps} />\n  }\n}\n\n// const verifyLogger = new Logger('VerifyContact')\n\nfunction convertToPlaceholder (str) {\n  return str.split('_').map(part => part.charAt(0).toUpperCase() + part.substr(1).toLowerCase()).join(' ')\n}\n\n// const eqSpacer = '==============================================================='\n","import { useState, useEffect, useRef } from 'react'\n\nexport const useGeolocation = () => {\n  const [state, setState] = useState({\n    accuracy: null,\n    altitude: null,\n    altitudeAccuracy: null,\n    heading: null,\n    latitude: null,\n    longitude: null,\n    speed: null,\n    timestamp: Date.now()\n  })\n  const mountedRef = useRef()\n  const watchIdRef = useRef()\n  mountedRef.current = true\n\n  const onEvent = event => {\n    if (mountedRef.current) {\n      setState({\n        accuracy: event.coords.accuracy,\n        altitude: event.coords.altitude,\n        altitudeAccuracy: event.coords.altitudeAccuracy,\n        heading: event.coords.heading,\n        latitude: event.coords.latitude,\n        longitude: event.coords.longitude,\n        speed: event.coords.speed,\n        timestamp: event.timestamp\n      })\n    }\n  }\n\n  useEffect(() => {\n    navigator.geolocation.getCurrentPosition(onEvent)\n    watchIdRef.current = navigator.geolocation.watchPosition(onEvent)\n\n    return () => {\n      mountedRef.current = false\n      navigator.geolocation.clearWatch(watchIdRef.current)\n    }\n  }, [navigator.geolocation])\n\n  return state\n}\n\nexport function useDeviceOrientation () {\n  const [deviceOrientation, setDeviceOrientation] = useState({ absolute: false, alpha: null, beta: null, gamma: null })\n\n  function handleDeviceOrientation (event) {\n    setDeviceOrientation({\n      absolute: event.absolute,\n      alpha: event.alpha,\n      beta: event.beta,\n      gamma: event.gamma\n    })\n  }\n\n  useEffect(() => {\n    window.addEventListener('deviceorientation', handleDeviceOrientation, true)\n\n    return () => {\n      window.removeEventListener('deviceorientation', handleDeviceOrientation)\n    }\n  }, [])\n\n  return deviceOrientation\n}\n\nexport function playClickAudio (clickSound) {\n  let audio = new Audio('data:audio/mp3;base64,' + clickSound.base64)\n  audio.play()\n}\n\n// Detects if device is on iOS\nexport const isIos = () => {\n  return /iphone|ipad|ipod/i.test(window.navigator.userAgent || navigator.vendor || window.opera || '')\n}\n\nexport const isPhone = () => {\n  const a = (window.navigator.userAgent || navigator.vendor || window.opera || '')\n  return /(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i\n    .test(a) ||\n  /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i\n    .test(a.substr(0, 4))\n}\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport Snackbar from '@material-ui/core/Snackbar'\nimport Typography from '@material-ui/core/Typography'\nimport Paper from '@material-ui/core/Paper'\nimport AppLogo from '../../icons/AppLogo'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { Button } from '@material-ui/core'\nconst useStyles = makeStyles(theme => ({\n  root: {\n\n  },\n  content: {\n\n  },\n  messageWrapper: {\n    display: 'flex'\n  },\n  logo: {\n    height: 50,\n    width: 50\n  },\n  paper: {\n    background: theme.palette.text.primary,\n    color: theme.palette.primary.contrastText,\n    border: `2px solid ${theme.palette.primary.contrastText}`,\n    boxShadow: `0 0 0 0 ${theme.palette.primary.main}`,\n    animation: '$installPulse 2s infinite',\n    padding: theme.spacing(2, 3),\n    width: '100%'\n  },\n  '@keyframes installPulse': {\n    '0%': {\n      boxShadow: `0 0 0 0px ${theme.palette.primary.main}`\n    },\n    '50%': {\n      boxShadow: `0 0 0 0px ${theme.palette.primary.main}`\n    },\n    '100%': {\n      boxShadow: `0 0 0 20px transparent`\n    }\n  },\n  textWrapper: {\n    flexGrow: 1,\n    paddingLeft: theme.spacing(1)\n  },\n  buttons: {\n    display: 'flex'\n  },\n  spacer: {\n    flexGrow: 1\n  }\n}))\n\nconst InstallPrompt = ({ open, onClose, onInstall }) => {\n  const classes = useStyles()\n\n  return (\n    <Snackbar\n      anchorOrigin={{\n        vertical: 'bottom',\n        horizontal: 'center'\n      }}\n      open={open}\n      // autoHideDuration={6000}\n      onClose={onClose}\n    >\n      <Paper className={classes.paper} elevation={24}>\n        <div id='client-snackbar' className={classes.messageWrapper}>\n          <AppLogo className={classes.logo} />\n          <div className={classes.textWrapper}>\n            <Typography variant='body1' color='inherit'>Install MorPhoto</Typography>\n            <Typography variant='body2' color='inherit' paragraph>This app can be installed and used on your device natively and offline if you would like.</Typography>\n            <div className={classes.buttons}>\n              <Button color='secondary' variant='contained' onClick={onClose}>No thanks</Button>\n              <div className={classes.spacer} />\n              <Button color='primary' variant='contained' onClick={onInstall}>Install</Button>\n            </div>\n          </div>\n        </div>\n      </Paper>\n    </Snackbar>\n  )\n}\n\nInstallPrompt.propTypes = {\n  open: PropTypes.bool,\n  onClose: PropTypes.func.isRequired,\n  onInstall: PropTypes.func.isRequired\n}\n\nexport default InstallPrompt\n","import React, { useEffect, useState, useMemo } from 'react'\nimport { isIos } from './sensors'\nimport InstallPrompt from '../components/misc/InstallPrompt'\n/**\n * Everything below here is about the prompt for installing a PWA\n */\n\n// Detects if device is in standalone mode\nconst isInStandaloneMode = () => ('standalone' in window.navigator) && (window.navigator.standalone)\n\nconst useShowAddToHome = (showInstall, dismissInstall) => {\n  const [deferredPrompt, setPrompt] = useState(null)\n\n  const handleBeforePrompt = e => {\n    // Prevent Chrome 67 and earlier from automatically showing the prompt\n    e.preventDefault()\n    // Stash the event so it can be triggered later.\n    setPrompt(e)\n    // showAddToHomeScreen()\n  }\n\n  const installPrompt = useMemo(() => {\n    if (!showInstall || !deferredPrompt) return null\n    return <InstallPrompt open onClose={dismissInstall} onInstall={addToHomeScreen} />\n  }, [showInstall, deferredPrompt])\n\n  useEffect(() => {\n    // window.orientation [0,90,180, 270]\n    // screen\n    // Checks if should display install popup notification:\n    if (isIos() && !isInStandaloneMode()) {\n      console.log('I AM on IOS and I am NOT in standalone mode.')\n    // this.setState({ showInstallMessage: true })\n    }\n\n    window.addEventListener('beforeinstallprompt', handleBeforePrompt)\n    return () => {\n      window.removeEventListener('beforeinstallprompt', handleBeforePrompt)\n    }\n  }, [])\n\n  function addToHomeScreen () {\n    // Show the prompt\n    deferredPrompt.prompt()\n    // Wait for the user to respond to the prompt\n    deferredPrompt.userChoice\n      .then((choiceResult) => {\n        if (choiceResult.outcome === 'accepted') {\n          console.log('User accepted the A2HS prompt')\n          dismissInstall()\n        }\n        else {\n          console.log('User dismissed the A2HS prompt')\n          dismissInstall()\n        }\n        setPrompt(null)\n      })\n  }\n\n  // function showAddToHomeScreen () {\n  //   const a2hsBtn = document.querySelector('.ad2hs-prompt')\n  //   a2hsBtn.style.display = 'block'\n  //   a2hsBtn.addEventListener('click', addToHomeScreen)\n  // }\n\n  return {\n    installPrompt,\n    addToHomeScreen: installPrompt ? addToHomeScreen : null\n  }\n}\n\nexport default useShowAddToHome\n","import { useEffect, useState } from 'react'\n\nconst useOnline = () => {\n  const [state, setState] = useState(null)\n\n  const onChange = (e) => {\n    if (window.navigator.onLine) {\n      console.log('ONLINE', e)\n      setState(null)\n    }\n    else {\n      console.log('OFFLINE', e)\n      const newDate = Date.now()\n      setState(newDate)\n    }\n  }\n\n  useEffect(() => {\n    onChange()\n    window.addEventListener('online', onChange)\n    window.addEventListener('offline', onChange)\n\n    return () => {\n      window.removeEventListener('online', onChange)\n      window.removeEventListener('offline', onChange)\n    }\n  }, [])\n\n  return {\n    online: state === null,\n    offlineSince: state\n  }\n}\n\nexport default useOnline\n","import { useCallback, useState, useLayoutEffect } from 'react'\nimport { debounce } from './util'\nimport { isIos, isPhone } from './sensors'\n\nconst metaViewports = {\n  sm: 'width=device-width, initial-scale=0.5, maximum-scale=0.5, user-scalable=0, shrink-to-fit=no',\n  lg: 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no'\n}\n\nconst getState = (state) => {\n  const { orientation, innerWidth, innerHeight, screen: { width, height } } = window\n  const wOrient = [90, 270].indexOf(orientation) !== 0 ? 'portrait' : 'landscape'\n  const bIsIos = isIos()\n  const bIsPhone = isPhone()\n  const windowSize = { width: innerWidth, height: innerHeight }\n  const screenSize = { width, height }\n\n  // VirtualKeyboards are the worst because they don't tell you when they're open.\n  // as a result we put the lockheight attribute on inputs so that the window height doesn't change\n  if (state && window.document.activeElement.tagName.toLowerCase() === 'input') {\n    console.log('preserving height')\n    windowSize.height = state.windowSize.height\n  }\n  else {\n    // const minSize = Math.min(windowSize.width, windowSize.height)\n    // const viewport = window.document.querySelector('meta[name=viewport]')\n    // const contentDict = viewport.getAttribute('content').split(', ').reduce((acc, el) => {\n    //   const elsplit = el.split('=')\n    //   return { ...acc, [elsplit[0]]: elsplit[1] }\n    // }, {})\n    // if (minSize < 350 && contentDict['initial-scale'] === '1.0') {\n    //   console.log('ZOOM Making it Small')\n    //   viewport.setAttribute('content', metaViewports.sm)\n    // }\n    // else if (minSize >= 350 && contentDict['initial-scale'] === '0.5') {\n    //   console.log('ZOOM Making it Large')\n    //   viewport.setAttribute('content', metaViewports.lg)\n    // }\n  }\n\n  const returnState = {\n    isPhone: bIsPhone,\n    isIos: bIsIos,\n    orientation: wOrient,\n    windowSize,\n    screenSize\n    // This failed. the only way to handle this is to set it explicitly\n    // isVKeyBdOn: bIsPhone && windowSize.height < screenSize.height\n  }\n  return returnState\n}\n\nconst useResponsive = (mediaQueries) => {\n  const [state, setState] = useState(getState())\n\n  const handleResize = (e) => {\n    if (e) {\n      e.preventDefault()\n      e.stopPropagation()\n    }\n    const newState = getState(state)\n    console.log('handleResize', newState)\n    setState(newState)\n  }\n\n  // const handleFlip = (e) => {\n  //   e.preventDefault()\n  //   e.stopPropagation()\n  //   const newState = getState()\n  //   console.log('handleFlip', newState)\n  //   setState(newState)\n  // }\n\n  const handleResizeDebounced = useCallback(debounce(handleResize, 500), [])\n  // const handleFlipDebounced = useCallback(debounce(handleFlip, 500), [])\n\n  useLayoutEffect(() => {\n    handleResizeDebounced()\n    window.addEventListener('resize', handleResizeDebounced)\n    // window.addEventListener('orientationchange', handleFlipDebounced)\n\n    return () => {\n      window.removeEventListener('resize', handleResizeDebounced)\n      // window.removeEventListener('orientationchange', handleFlipDebounced)\n    }\n  },\n  [])\n\n  return state\n}\n\nexport default useResponsive\n","/**\n * We put our action types at the top to keep them straight\n *\n * This is just a handy enumeration we use everywhere to make sure we're\n * all talking about the same ations\n */\nexport const Actions = {\n\n  HOME_CHANGE_STATE: 'HOME_CHANGE_STATE',\n  HOME_CHANGE_ACTIVE_SERIES: 'HOME_CHANGE_ACTIVE_SERIES',\n  HOME_STATE_BACK: 'HOME_STATE_BACK',\n\n  MAP_HISTORY_POP: 'MAP_HISTORY_POP',\n  MAP_HISTORY_PUSH: 'MAP_HISTORY_PUSH',\n  MAP_HISTORY_CLEAR: 'MAP_HISTORY_CLEAR',\n\n  UPLOADER_START: 'UPLOADER_START',\n  UPLOADER_COMPLETE: 'UPLOADER_COMPLETE',\n  UPLOADER_UPDATE_PROGRESS: 'UPLOADER_UPDATE_PROGRESS',\n\n  OFFLINE_VIEWPORT_SAVE: 'OFFLINE_VIEWPORT_SAVE',\n  OFFLINE_SET_STATUS: 'OFFLINE_SET_STATUS',\n\n  SETFLAG: 'SETFLAG'\n}\n\n/**\n * Now here are the actual action functions we will be dispatching\n * The actions have arguments related to what they do but they action they\n * dispatch consists only of a type and data3\n */\nexport default {\n  setHomeState: (newDomain, params) => ({ type: Actions.HOME_CHANGE_STATE, data: { newDomain, params } }),\n  homeStateBack: () => ({ type: Actions.HOME_STATE_BACK }),\n  setActiveSeries: (seriesId, initialPhoto) => ({ type: Actions.HOME_CHANGE_ACTIVE_SERIES, data: { seriesId, initialPhoto } }),\n\n  setFlag: (flagName, flagVal) => ({ type: Actions.SETFLAG, data: { flagName, flagVal } }),\n\n  setOfflineViewport: (viewport) => ({ type: Actions.OFFLINE_VIEWPORT_SAVE, data: viewport }),\n  setOfflineCompleted: (bVal) => ({ type: Actions.OFFLINE_SET_STATUS, data: bVal }),\n\n  popMapHistory: () => ({ type: Actions.MAP_HISTORY_POP }),\n  pushMapHistory: (viewportSave) => ({ type: Actions.MAP_HISTORY_PUSH, data: viewportSave }),\n  clearMapHistory: () => ({ type: Actions.MAP_HISTORY_CLEAR }),\n\n  queueUpload: (uploadObj) => ({ type: Actions.UPLOADER_START, data: uploadObj }),\n  // startActiveUpload: () => ({ type: Actions.UPLOADER_START }),\n  completeActiveUpload: () => ({ type: Actions.UPLOADER_COMPLETE }),\n  updateUploadProgress: (newProgress) => ({ type: Actions.UPLOADER_UPDATE_PROGRESS, data: newProgress })\n\n}\n","import { Actions } from '../actions'\nimport { home } from '../../config'\nconst mapInit = [\n  {\n    mode: home.MapModeTypes.FREE,\n    // selectedItem: null\n    viewport: {\n      // 'latitude': 49.2707848, // vancouver\n      // 'longitude': -123.0714866,\n      latitude: 36.80191008366581, // Grand Canyon\n      longitude: -111.63999999999784,\n      zoom: 11\n    }\n  }\n]\n\nexport default (state = mapInit, action) => {\n  const { type, data } = action\n\n  switch (type) {\n    case Actions.MAP_HISTORY_CLEAR:\n      const newClearerHistory = state.length > 0 ? [[state.length - 1]] : []\n      return newClearerHistory\n\n    case Actions.MAP_HISTORY_POP:\n      return state.slice(0, -1)\n\n    case Actions.MAP_HISTORY_PUSH:\n      return [...state, data]\n    default:\n      return state\n  }\n}\n","import { Actions } from '../actions'\nimport { home } from '../../config'\n\nconst homeInit = {\n  history: [],\n  current: {\n    domain: home.AppStateTypes.FEED\n    // search: null // { tab, text }\n    // defaultSearchTab:\n    // defaultSearchText:\n    // activeSeries: 'fda17bae-0335-4f0d-9065-dc8d7aa23ed1',\n    // initialPhoto: 'someguid'\n  }\n}\n\nexport default (state = homeInit, action) => {\n  const { type, data } = action\n  const { history, current } = state\n\n  switch (type) {\n    case Actions.HOME_STATE_BACK:\n      const newStateHistory = [...history]\n      const newCurrentState = newStateHistory.length > 0 ? newStateHistory.pop() : homeInit.current\n      return {\n        ...state,\n        current: newCurrentState,\n        history: newStateHistory\n      }\n\n    case Actions.HOME_CHANGE_ACTIVE_SERIES:\n      const { activeSeries, initialPhoto } = current\n      return {\n        ...state,\n        history,\n        current: {\n          ...current,\n          activeSeries: activeSeries || null,\n          initialPhoto: activeSeries && initialPhoto ? initialPhoto : null\n        }\n      }\n\n    case Actions.HOME_CHANGE_STATE:\n      const { newDomain, params } = data\n      const newParams = params || {}\n\n      // We don't save certain states\n      const saveState = [\n        home.AppStateTypes.QRCAPTURE,\n        home.AppStateTypes.NEW_SERIES_CAMERA,\n        home.AppStateTypes.NEW_SERIES_LIBRARY\n      ].indexOf(current.domain) !== 0\n\n      const newHistory = saveState ? [...history, current] : history\n      return {\n        ...state,\n        history: newHistory,\n        current: {\n          ...current,\n          domain: newDomain,\n          ...newParams\n        }\n      }\n\n    default:\n      return state\n  }\n}\n","import { Actions } from '../actions'\n\nconst initState = {\n  store: [],\n  activeUpload: null\n}\n\nexport default (state = initState, action) => {\n  const { type, data } = action\n  const { store, activeUpload } = state\n\n  switch (type) {\n    // Start the uploader\n    // Invoked by the queue function\n    case Actions.UPLOADER_START:\n      if (!activeUpload) {\n        return {\n          ...state,\n          activeUpload: data\n        }\n      }\n      else {\n        return {\n          ...state,\n          store: [...store, data]\n        }\n      }\n    // One upload is complerte. Queue the next one\n    case Actions.UPLOADER_COMPLETE:\n      if (store.length === 0) {\n        return {\n          ...state,\n          activeUpload: null\n        }\n      }\n      else {\n        const newStore = [...store]\n        const newActive = newStore.pop()\n        return {\n          ...state,\n          store: newStore,\n          activeUpload: newActive\n        }\n      }\n    // update the progress of a single upload\n    case Actions.UPLOADER_UPDATE_PROGRESS:\n      return {\n        ...state,\n        activeUpload: { ...activeUpload, ...data }\n      }\n    default:\n      return state\n  }\n}\n","import { Actions } from '../actions'\nimport { isIos } from '../../lib/sensors'\n\nconst defaultFlags = {\n  iOSWarning: isIos(),\n  install: true,\n  useLoggedOut: false\n}\nexport default (state = defaultFlags, action) => {\n  const { type, data } = action\n\n  switch (type) {\n    case Actions.SETFLAG:\n      const { flagName, flagVal } = data\n      return { ...state, [flagName]: flagVal }\n\n    default:\n      return state\n  }\n}\n","import { Actions } from '../actions'\n\nconst offlineInit = {\n  completedDownload: false,\n  viewport: null\n}\n\nexport default (state = offlineInit, action) => {\n  const { type, data } = action\n\n  switch (type) {\n    case Actions.OFFLINE_VIEWPORT_SAVE:\n      return {\n        ...state,\n        viewport: data\n      }\n\n    case Actions.OFFLINE_SET_STATUS:\n      return {\n        ...state,\n        completedDownload: data\n      }\n\n    default:\n      return state\n  }\n}\n","import { combineReducers } from 'redux'\nimport map from './map'\nimport home from './home'\nimport uploader from './uploader'\nimport flags from './flags'\nimport offline from './offline'\n\nexport default combineReducers({ map, home, uploader, flags, offline })\n","import { createStore, applyMiddleware, compose } from 'redux'\nimport thunk from 'redux-thunk'\nimport rootReducer from './reducers'\nimport { persistStore, persistReducer } from 'redux-persist'\nimport { stateStore } from '../graphql/offline'\n// import storage from 'redux-persist/lib/storage' // defaults to localStorage for web\n\n// import api from '../middleware/api'\n// https://github.com/reduxjs/redux/blob/master/examples/real-world/src/middleware/api.js\n\nconst persistConfig = {\n  key: 'root',\n  storage: stateStore\n}\n\nconst persistedReducer = persistReducer(persistConfig, rootReducer)\n\n/**\n * On Dev we want our devTools available\n */\nconst configureStoreDev = preloadedState => {\n  const { devToolsEnhancer } = require('redux-devtools-extension')\n  const { createLogger } = require('redux-logger')\n  const store = createStore(\n    persistedReducer,\n    preloadedState,\n    compose(\n      devToolsEnhancer(),\n      applyMiddleware(\n        thunk,\n        createLogger()\n      )\n    )\n  )\n  if (module.hot) {\n    // Enable Webpack hot module replacement for reducers\n    module.hot.accept('./reducers', () => {\n      store.replaceReducer(rootReducer)\n    })\n  }\n  return store\n}\n\n/**\n * Production gets a simpler more performant store:\n */\nconst configureStoreProd = preloadedState => {\n  const store = createStore(\n    persistedReducer,\n    preloadedState,\n    compose(\n      applyMiddleware(\n        thunk\n      )\n    )\n  )\n  return store\n}\n\nexport default () => {\n  const store = process.env.NODE_ENV === 'production' ? configureStoreProd() : configureStoreDev()\n  return {\n    store,\n    persistor: persistStore(store)\n  }\n}\n","import React from 'react'\nimport { PersistGate } from 'redux-persist/integration/react'\nimport { Provider } from 'react-redux'\nimport storeConfig from './storeConfig'\nimport Loading from '../components/auth/Loading'\n/**\n * In this example, 'store' is the configured Redux store and\n *'persist' is a function that returns a Promise to rehydrate the\n * Redux store using redux-persist\n *\n * FROM: https://medium.com/hexient-labs/redux-store-provider-hoc-3495281905c\n */\nconst withReduxProvider = BaseComponent => (props) => {\n  const { store, persistor } = storeConfig()\n  // console.log('withReduxProvider', { props, store, persistor })\n  return (\n    <Provider store={store}>\n      <PersistGate loading={<Loading />} persistor={persistor}>\n        <BaseComponent {...props} />\n      </PersistGate>\n    </Provider>\n  )\n}\n\nexport default withReduxProvider\n","import React from 'react'\nimport classNames from 'classnames'\nimport PropTypes from 'prop-types'\nimport Paper from '@material-ui/core/Paper'\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport LinearProgress from '@material-ui/core/LinearProgress'\nimport Typography from '@material-ui/core/Typography'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst style = theme => ({\n  root: {\n    background: 'black',\n    color: theme.palette.primary.contrastText,\n    padding: theme.spacing(1) * 2\n  },\n  message: {\n    // width: '100%'\n  },\n  msgText: {\n    display: 'flex'\n  },\n  spacer: {\n    flexGrow: 1\n  },\n  messageInner: {\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst UploadControlUnstyled = ({ className, text, progress }) => {\n  const classes = useStyles()\n  if (!text) return null\n  const message = `Uploading: ${text}`\n  return (\n    <div className={classNames(classes.root, className)}>\n      <div className={classes.messageInner}>\n        <div className={classes.msgText}>\n          <Typography color='inherit'>{message}</Typography>\n          <div className={classes.spacer} />\n          <Typography color='inherit'>{progress}%</Typography>\n        </div>\n        <LinearProgress color='secondary' variant='determinate' value={progress} />\n      </div>\n    </div>\n  )\n}\n\nUploadControlUnstyled.propTypes = {\n  className: PropTypes.string,\n  text: PropTypes.string,\n  progress: PropTypes.number\n}\n\nconst UploadControl = UploadControlUnstyled\nexport default UploadControl\n\nexport const UploadControlCOSMOSWrapper = ({ text, progress }) => {\n  // const [someStateItem, setSomeStateItem] = useState()\n  const classes = useWrapperStyles()\n  return (\n    <div className={classes.root}>\n      <CssBaseline /> {/* You only need this in a root element. Don't put it anywhere else in the dom */}\n      <Paper className={classes.paper}>\n        <Typography variant='h5'>\n          This is a dummy component.\n        </Typography>\n      </Paper>\n      <UploadControl text={text} progress={progress} />\n    </div>\n  )\n}\n\nUploadControlCOSMOSWrapper.propTypes = {\n  text: PropTypes.string,\n  progress: PropTypes.number\n}\nconst wrapperStyle = theme => ({\n  root: {\n    height: '100%',\n    display: 'flex',\n    flexDirection: 'column'\n  },\n  paper: {\n    flexGrow: 1\n  }\n})\n\nconst useWrapperStyles = makeStyles(wrapperStyle)\n\nUploadControlCOSMOSWrapper.displayName = UploadControl.displayName\nexport const UploadControlTest = UploadControlCOSMOSWrapper\n","import axios from 'axios'\nimport FormData from 'form-data'\nimport { imgStore } from '../graphql/offline'\n// import { getExtFromBlob } from '../lib/Photo'\n/**\n * DEbuggers for AXIOS\n */\naxios.interceptors.request.use(\n  request => {\n    console.log('AXIOS:::: Starting Request', request)\n    return request\n  },\n  err => {\n    console.log('AXIOS:::: Starting Request ERROR', err)\n    return Promise.reject(err)\n  }\n)\n\naxios.interceptors.response.use(\n  response => {\n    console.log('AXIOS:::: Response', response)\n    return response\n  },\n  err => {\n    console.log('AXIOS:::: Starting Response ERROR', err)\n    return Promise.reject(err)\n  }\n)\n\nexport default async function doUpload (activeUpload, updateUploadProgress, completeActiveUpload, restartUpload) {\n  console.log('doUpload:: upload start', activeUpload)\n\n  // Initialising the HTML POST form for posting to S3 directly\n  let formData = new FormData()\n  // Take the auth credentials that we got from the backend and add them to our S3 POST\n  Object.keys(activeUpload.preAuth.fields).forEach(fieldkey => {\n    console.log(`doUpload::append:: ${fieldkey}: ${activeUpload.preAuth.fields[fieldkey].substring(0, 50)}`)\n    formData.append(fieldkey, activeUpload.preAuth.fields[fieldkey])\n  })\n  const file = await imgStore.getItem(activeUpload.uploadToken)\n  formData.append('file', file)\n\n  const config = {\n    headers: {\n      'Content-Type': 'multipart/form-data'\n    },\n    onUploadProgress: progressEvent => {\n      const { loaded, total } = progressEvent\n      // Do something with the progress details\n      console.log('doUpload::PROGRESSEVENT', loaded, total, Math.floor(100 * loaded / total))\n      updateUploadProgress({ progress: Math.floor(100 * loaded / total) })\n    }\n  }\n\n  console.log('doUpload::FORMDATA', { formData, config })\n  // Upload file to S3\n  await axios.post(\n    activeUpload.preAuth.url,\n    formData,\n    config\n  ).catch(err => {\n    console.error('doUpload::ERROR')\n    console.error(err)\n    console.log(err.stack)\n    restartUpload(activeUpload)\n  })\n  console.log('doUpload:: upload done. cleaning up imgStore', await imgStore.keys())\n  await imgStore.removeItem(activeUpload.uploadToken)\n  console.log('doUpload:: Cleaned up img store', await imgStore.keys())\n  completeActiveUpload()\n}\n\n// export function dataURLtoFile (dataurl, filename) {\n//   var arr = dataurl.split(','); var mime = arr[0].match(/:(.*?);/)[1]\n\n//   var bstr = atob(arr[1]); var n = bstr.length; var u8arr = new Uint8Array(n)\n//   while (n--) {\n//     u8arr[n] = bstr.charCodeAt(n)\n//   }\n//   return new File([u8arr], filename, { type: mime })\n// }\n","import React, { useRef, useEffect, useContext, useMemo, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { connect } from 'react-redux'\nimport actions from '../redux/actions'\nimport UploadControl from '../components/UploadControl'\nimport s3Upload from '../lib/s3upload'\nimport { getNewS3Credentials } from '../graphql/queries'\nimport { graphql } from 'react-apollo'\nimport { AppContext } from '../contexts'\n\nconst UploadConnect = ({\n  activeUpload,\n  completeActiveUpload,\n  updateUploadProgress,\n  ...props\n}) => {\n  const uploadingRef = useRef()\n  const [qItem, setQItem] = useState()\n  const { online } = useContext(AppContext)\n  uploadingRef.current = activeUpload ? activeUpload.preAuth : null\n\n  const newS3 = useMemo(() => <NewS3Credentials onDone={updateUploadProgress} qItem={qItem} />, [qItem])\n\n  useEffect(() => {\n    uploadingRef.current = uploadingRef.current && !!activeUpload\n\n    if (online && activeUpload && !uploadingRef.current) {\n      // if the upload fails the failed qItem gets set in the state\n      s3Upload(activeUpload, updateUploadProgress, completeActiveUpload, setQItem)\n    }\n  }, [uploadingRef.current])\n\n  if (!activeUpload) return null\n  return (\n    <React.Fragment>\n      {newS3}\n      <UploadControl text={'Uploading thing'} progress={activeUpload.progress || 0} {...props} />\n    </React.Fragment>\n  )\n}\nUploadConnect.propTypes = {\n  // All from redux\n  activeUpload: PropTypes.object,\n  completeActiveUpload: PropTypes.func.isRequired,\n  updateUploadProgress: PropTypes.func.isRequired\n}\n\n/**\n * Here's the graphql HOC that gets an individual series\n */\nconst withGetNewS3Credentials = graphql(getNewS3Credentials, {\n  skip: ({ online, qItem }) => !online || !qItem,\n  props: ({ data, ownProps }) => {\n    if (data.error) console.error(data.error)\n    console.log('getWholeSeries:: ', { data })\n\n    // If we get backa  valid auth code then create a new queue object\n    // and send it back\n    if (!data.loading) {\n      ownProps.onDone({\n        ...ownProps.qItem,\n        retry: ownProps.qItem.retry + 1,\n        preAuth: data.s3Credentials\n      })\n    }\n    return {\n      data\n    }\n  },\n  options: ({ qItem }) => ({\n    variables: { seriesId: qItem.seriesId, photoId: qItem.id, ext: qItem.ext }\n  })\n})\nconst NewS3Credentials = withGetNewS3Credentials(() => null)\n\n/**\n * Map our redux state and functions\n */\nconst mapStateToProps = (state, props) => {\n  const { activeUpload } = state.uploader\n  return { activeUpload }\n}\n\nconst mapDispatchToProps = dispatch => ({\n  completeActiveUpload: () => {\n    dispatch(actions.completeActiveUpload())\n  },\n  updateUploadProgress: (newProgress) => {\n    dispatch(actions.updateUploadProgress(newProgress))\n  }\n})\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(UploadConnect)\n","/**\n * Valid Roles are: admin, user, nonuser\n *\n * Valid Resources are: series, series_public, series_open, photo\n *\n * For more see:\n * https://docs.google.com/spreadsheets/d/1oXsZrsuyOSFs_tufRluSjQiR6OSTObWiGsKDUKb5vLk/edit#gid=0\n *\n * RTFM:\n * https://onury.io/accesscontrol/?content=guide#resources-and-resource-attributes\n */\nexport default {\n  // Admin is god. Be careful who you give this to.\n  admin: {\n    series: {\n      'create:own': ['*'],\n      'read:any': ['*'],\n      'update:any': ['*'],\n      'delete:any': ['*']\n    },\n    photo: {\n      'create:any': ['*'],\n      'read:any': ['*'],\n      'update:any': ['*'],\n      'delete:any': ['*']\n    }\n  },\n  // Logged out users can see public stuff but nothing esle\n  nonuser: {\n    photo: {\n      'read:any': ['*'],\n      'update:any': ['*'],\n      'delete:any': ['*']\n    },\n    series_public: {\n      'read:any': ['*']\n    },\n    series_open: {\n      'read:any': ['*']\n    }\n  },\n  // Users are the key permissions role in V0\n  // Note: we could inherit from user but we keep it explicit for now\n  user: {\n    series: {\n      'create:own': ['*'],\n      'read:own': ['*'],\n      'update:own': ['*'],\n      'delete:own': ['*']\n    },\n    series_public: {\n      'read:any': ['*']\n    },\n    series_open: {\n      'read:any': ['*'],\n      'update:any': ['photos']\n    },\n    photo: {\n      'read:any': ['*'],\n      'create:own': ['*'],\n      'update:own': ['*'],\n      'delete:own': ['*']\n    }\n  }\n}\n","// import React, { useContext } from 'react'\n// import PropTypes from 'prop-types'\nimport { graphql } from 'react-apollo'\nimport { allSeriesUpdate, feedUpdate, userSeriesUpdate } from './updateQueries'\nimport { deleteSeries } from '../mutations'\nimport { pushMutationPromise, popMutationPromise } from '../offline'\n\nconst withMutation = graphql(deleteSeries, {\n  props: ({ mutate, ownProps }) => {\n    return {\n      deleteSeriesMutation: async () => {\n        // When we're not creating a series the seriesId isn't passed in\n        // so we add it now\n        const variables = {\n          id: ownProps.activeSeries\n        }\n        const optimisticResponse = {\n          deleteSeries: ownProps.activeSeries\n        }\n        const mutationStackId = await pushMutationPromise({ variables, optimisticResponse }, deleteSeries)\n\n        return mutate({\n          variables,\n          optimisticResponse,\n          update: updateThunk()\n        }).then(data => {\n          // Here's where we take it out of the queue\n          console.log('deleteSeriesMutation:: done', { data, mutationStackId })\n          popMutationPromise(mutationStackId)\n          return data\n        })\n      }\n    }\n  }\n})\n\nconst updateThunk = (context, cb) => (store, { data }) => {\n  // We need to write this query from scratch\n  console.log('deleteSeriesMutation::updateThunk', { data })\n  userSeriesUpdate(store, data.deleteSeries, true)\n  allSeriesUpdate(store, { id: data.deleteSeries }, true)\n  feedUpdate(store, { id: data.deleteSeries }, null, true)\n\n  if (cb) cb(data.createSeries.series.id)\n}\n\nexport default {\n  withMutation,\n  updateThunk\n}\n","// import React, { useContext } from 'react'\n// import PropTypes from 'prop-types'\nimport { graphql } from 'react-apollo'\nimport { getWholeSeriesUpdate, allSeriesUpdate, feedUpdate } from './updateQueries'\nimport { updateSeries, updateSeriesKeys } from '../mutations'\nimport { pushMutationPromise, popMutationPromise } from '../offline'\n\nimport _ from 'lodash'\n\nexport const withMutation = graphql(updateSeries, {\n  props: ({ mutate, ownProps }) => {\n    return {\n      updateSeriesMutation: async (series, seriesDelta) => {\n        const { id, gravatar, gravatarProfile, username } = ownProps.user\n        const meUserSummary = { id, gravatar, gravatarProfile, username, __typename: 'UserSummary' }\n\n        const variables = {\n          series: _.pick(seriesDelta, updateSeriesKeys)\n        }\n        const optimisticResponse = createOptimisticResponse({ meUserSummary, series, seriesDelta })\n        const mutationStackId = await pushMutationPromise({ variables, optimisticResponse }, updateSeries)\n\n        return mutate({\n          variables,\n          // refetchQueries: [{ query: getWholeSeries, variables: { id: newSeries.id } }],\n          optimisticResponse,\n          update: updateThunk()\n        }).then(data => {\n          // Here's where we take it out of the queue\n          console.log('updateSeriesMutation:: done', data)\n          popMutationPromise(mutationStackId)\n          return data\n        })\n      }\n    }\n  }\n})\n\nconst updateThunk = (context, cb) => (store, { data }) => {\n  // We need to write this query from scratch\n  getWholeSeriesUpdate(store, data.updateSeries)\n  allSeriesUpdate(store, data.updateSeries)\n  feedUpdate(store, data.createSeries.series, data.createdSeries.series.photos[0])\n}\n\nconst createOptimisticResponse = ({ meUserSummary, series, seriesDelta }) => ({\n  updateSeries: {\n    ...series,\n    ...seriesDelta,\n    updatedUser: meUserSummary,\n    updatedBy: meUserSummary.id,\n    __typename: 'Series'\n  }\n})\n\nexport default {\n  withMutation,\n  updateThunk\n}\n","// import React, { useContext } from 'react'\n// import PropTypes from 'prop-types'\nimport { graphql } from 'react-apollo'\nimport { allSeriesPhotoUpdate, feedUpdate } from './updateQueries'\nimport { deletePhoto } from '../mutations'\nimport { pushMutationPromise, popMutationPromise } from '../offline'\n\nconst withMutation = graphql(deletePhoto, {\n  props: ({ mutate, ownProps }) => {\n    return {\n      deletePhotoMutation: async (photoId) => {\n        // When we're not creating a series the seriesId isn't passed in\n        // so we add it now\n        const variables = {\n          seriesId: ownProps.series.id,\n          photoId\n        }\n        const optimisticResponse = {\n          deletePhoto: photoId\n        }\n        const mutationStackId = await pushMutationPromise({ variables, optimisticResponse }, deletePhoto)\n\n        return mutate({\n          variables,\n          optimisticResponse,\n          update: updateThunk({ series: ownProps.series })\n        }).then(data => {\n          // Here's where we take it out of the queue\n          console.log('deletePhotoMutation:: done', data)\n          popMutationPromise(mutationStackId)\n          return data\n        })\n      }\n    }\n  }\n})\n\nconst updateThunk = (context, cb) => (store, { data }) => {\n  // We need to write this query from scratch\n  allSeriesPhotoUpdate(store, null, { id: data.deletePhoto }, true)\n  feedUpdate(store, context.series, { id: data.deletePhoto, seriesId: context.series.seriesId }, true)\n}\n\nexport default {\n  withMutation,\n  updateThunk\n}\n","// import React, { useContext } from 'react'\n// import PropTypes from 'prop-types'\nimport { graphql } from 'react-apollo'\nimport { getWholeSeriesPhotoUpdate, allSeriesPhotoUpdate, feedUpdate } from './updateQueries'\nimport { createPhoto, newPhotoKeys } from '../mutations'\nimport { pushMutationPromise, popMutationPromise } from '../offline'\n\nimport _ from 'lodash'\n\nconst withMutation = graphql(createPhoto, {\n  props: ({ mutate, ownProps }) => {\n    return {\n      createPhotoMutation: async (series, newPhoto, ext) => {\n        // When we're not creating a series the seriesId isn't passed in\n        // so we add it now\n        const newPhotoInput = _.cloneDeep(newPhoto)\n        if (!newPhotoInput.seriesId && ownProps.activeSeries) {\n          newPhotoInput.seriesId = ownProps.activeSeries\n        }\n        const { id, gravatar, gravatarProfile, username } = ownProps.user\n        const meUserSummary = { id, gravatar, gravatarProfile, username, __typename: 'UserSummary' }\n        const variables = {\n          photo: _.pick(newPhotoInput, newPhotoKeys),\n          ext\n        }\n        const optimisticResponse = createOptimisticResponse({ meUserSummary, series, newPhoto, ext })\n        const mutationStackId = await pushMutationPromise({ variables, optimisticResponse }, createPhoto)\n\n        return mutate({\n          variables,\n          optimisticResponse,\n          update: updateThunk({ series })\n        }).then(data => {\n          // Here's where we take it out of the queue\n          console.log('createPhotoMutation:: done', data)\n          popMutationPromise(mutationStackId)\n          return data\n        })\n      }\n    }\n  }\n})\n\nconst updateThunk = (context, cb) => (store, { data }) => {\n  // We need to write this query from scratch\n  console.log('updateThunk', { context, data })\n  getWholeSeriesPhotoUpdate(store, data.createPhoto.photo)\n  allSeriesPhotoUpdate(store, context.series, data.createPhoto.photo)\n  feedUpdate(store, context.series, data.createPhoto.photo)\n}\n\nconst createOptimisticResponse = ({ meUserSummary, series, newPhoto, ext }) => ({\n  createPhoto: {\n    photo: {\n      id: newPhoto.id,\n      meta: newPhoto.meta || null,\n      seriesId: series.id,\n      createdOn: Date.now().toString(),\n      createdUser: meUserSummary,\n      updatedUser: meUserSummary,\n      createdBy: meUserSummary.id,\n      updatedBy: meUserSummary.id,\n      uploadToken: newPhoto.uploadToken,\n      updatedOn: Date.now().toString(),\n      seriesCreatedBy: series.createdUser.id, // we can't answer this yet\n      takenOn: newPhoto.takenOn,\n      coords: newPhoto.coords || null,\n      tags: newPhoto.tags || [],\n      paths: {\n        base: null,\n        large: null,\n        orig: null,\n        thumb: null,\n        medium: null,\n        __typename: 'Paths'\n      },\n      __typename: 'Photo'\n    },\n    preAuth: null,\n    __typename: 'NewPhoto'\n  }\n})\n\nexport default {\n  withMutation,\n  updateThunk\n}\n","// import React, { useContext } from 'react'\n// import PropTypes from 'prop-types'\nimport { graphql } from 'react-apollo'\nimport { getWholeSeriesPhotoUpdate, allSeriesPhotoUpdate, feedUpdate } from './updateQueries'\nimport { updatePhoto, updatePhotoKeys } from '../mutations'\nimport { pushMutationPromise, popMutationPromise } from '../offline'\n\nimport _ from 'lodash'\n\nconst withMutation = graphql(updatePhoto, {\n  props: ({ mutate, ownProps }) => {\n    return {\n      updatePhotoMutation: async (photo, photoDelta) => {\n        // When we're not creating a series the seriesId isn't passed in\n        // so we add it now\n        const newUpdatePhoto = _.pick(photoDelta, updatePhotoKeys)\n        if (newUpdatePhoto.tags && newUpdatePhoto.tags.length > 0) {\n          newUpdatePhoto.tags = newUpdatePhoto.tags.map(t => {\n            const newT = _.pick(t, [ 'label', 'typeId', 'coords' ])\n            if (newT.coords) newT.coords = _.pick(newT.coords, [ 'x', 'y' ])\n            return newT\n          })\n        }\n\n        const { id, gravatar, gravatarProfile, username } = ownProps.user\n        const meUserSummary = { id, gravatar, gravatarProfile, username, __typename: 'UserSummary' }\n        const variables = {\n          photo: newUpdatePhoto\n        }\n        const optimisticResponse = createOptimisticResponse({ meUserSummary, photo, photoDelta })\n        const mutationStackId = await pushMutationPromise({ variables, optimisticResponse }, updatePhoto)\n\n        return mutate({\n          variables,\n          optimisticResponse,\n          update: updateThunk({ photo })\n        }).then(data => {\n          // Here's where we take it out of the queue\n          console.log('updatePhotoMutation:: done', data)\n          popMutationPromise(mutationStackId)\n          return data\n        })\n      }\n    }\n  }\n})\n\nconst updateThunk = (context, cb) => (store, { data }) => {\n  // We need to write this query from scratch\n  getWholeSeriesPhotoUpdate(store, { ...context.photo, ...data.updatePhoto })\n  allSeriesPhotoUpdate(store, null, { ...context.photo, ...data.updatePhoto })\n  feedUpdate(store, null, { ...context.photo, ...data.updatePhoto })\n\n  if (cb) cb(data.createSeries.series.id)\n}\n\nconst createOptimisticResponse = ({ meUserSummary, photo, photoDelta }) => ({\n  updatePhoto: {\n    ...photo,\n    ...photoDelta,\n    updatedUser: meUserSummary,\n    updatedBy: meUserSummary.id,\n    __typename: 'Photo'\n  }\n})\n\nexport default {\n  withMutation,\n  updateThunk\n}\n","// import React, { useContext } from 'react'\n// import PropTypes from 'prop-types'\nimport { graphql } from 'react-apollo'\nimport { watchUpdate } from './updateQueries'\nimport { watchSeries } from '../mutations'\nimport { pushMutationPromise, popMutationPromise } from '../offline'\n\nconst withMutation = graphql(watchSeries, {\n  props: ({ mutate, ownProps }) => {\n    return {\n      watchSeriesMutation: async () => {\n        // When we're not creating a series the seriesId isn't passed in\n        // so we add it now\n        const variables = {\n          seriesId: ownProps.activeSeries\n        }\n        const optimisticResponse = {\n          watchSeries: ownProps.activeSeries\n        }\n        const mutationStackId = await pushMutationPromise({ variables, optimisticResponse }, watchSeries)\n\n        return mutate({\n          variables,\n          optimisticResponse,\n          update: updateThunk()\n        }).then(data => {\n          // Here's where we take it out of the queue\n          console.log('watchSeriesMutation:: done', data)\n          popMutationPromise(mutationStackId)\n          return data\n        })\n      }\n    }\n  }\n})\n\nconst updateThunk = (context, cb) => (store, { data }) => {\n  // We need to write this query from scratch\n  watchUpdate(store, data.watchSeries)\n}\n\nexport default {\n  withMutation,\n  updateThunk\n}\n","// import React, { useContext } from 'react'\n// import PropTypes from 'prop-types'\nimport { graphql } from 'react-apollo'\nimport { watchUpdate } from './updateQueries'\nimport { unWatchSeries } from '../mutations'\nimport { pushMutationPromise, popMutationPromise } from '../offline'\n\nconst withMutation = graphql(unWatchSeries, {\n  props: ({ mutate, ownProps }) => {\n    return {\n      unWatchSeriesMutation: async () => {\n        // When we're not creating a series the seriesId isn't passed in\n        // so we add it now\n        const variables = {\n          seriesId: ownProps.activeSeries\n        }\n        const optimisticResponse = {\n          unWatchSeries: ownProps.activeSeries\n        }\n        const mutationStackId = await pushMutationPromise({ variables, optimisticResponse }, unWatchSeries)\n\n        return mutate({\n          variables,\n          optimisticResponse,\n          update: updateThunk()\n        }).then(data => {\n          // Here's where we take it out of the queue\n          console.log('unWatchSeriesMutation:: done', data)\n          popMutationPromise(mutationStackId)\n          return data\n        })\n      }\n    }\n  }\n})\n\nconst updateThunk = (context, cb) => (store, { data }) => {\n  // We need to write this query from scratch\n  watchUpdate(store, data.unWatchSeries, true)\n}\n\nexport default {\n  withMutation,\n  updateThunk\n}\n","import React from 'react'\n\nexport const SeriesContext = React.createContext({})\n","import React, { useState, useLayoutEffect, useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport Typography from '@material-ui/core/Typography'\nimport Dialog from '@material-ui/core/Dialog'\n// import MenuIcon from '@material-ui/icons/Menu'\nimport QRCode from 'qrcode'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { Paper } from '@material-ui/core'\nimport { SeriesContext } from '../contexts'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n  },\n  title: {\n    textAlign: 'center'\n  },\n  qrPaper: {\n    padding: theme.spacing(2)\n  },\n  qrCode: {\n    width: '100%',\n    height: 400\n  }\n}))\n\nconst QRDisplay = ({ onClose, open }) => {\n  const classes = useStyles()\n  const { series } = useContext(SeriesContext)\n  const [qrCodeEl, setQRCodeEl] = useState(null)\n  const obj = { type: 'series', id: series.id }\n  const encodedId = encodeURI(JSON.stringify(obj))\n  const url = `${process.env.PUBLIC_URL}/?fromqr=${encodedId}`\n\n  useLayoutEffect(() => {\n    QRCode.toString(url, (err, svgStr) => {\n      if (err) console.error(err)\n      else setQRCodeEl(svgStr)\n    })\n  }, [series])\n\n  return (\n    <Dialog\n      open={open}\n      fullWidth\n\n      onClose={onClose}\n      className={classes.root\n      }>\n      <Paper className={classes.qrPaper}>\n        <Typography variant='subtitle1' component='div' className={classes.title}>{series.name}</Typography>\n        <svg className={classes.qrCode} dangerouslySetInnerHTML={{ __html: qrCodeEl }} />\n        {series.coords && <Typography component='div' className={classes.title}>[ {series.coords[0]}, {series.coords[1]} ]</Typography>}\n      </Paper>\n    </Dialog>\n  )\n}\n\nQRDisplay.propTypes = {\n  onClose: PropTypes.func.isRequired,\n  open: PropTypes.bool\n}\n\nexport default QRDisplay\n","import React from 'react'\nimport createSvgIcon from '@material-ui/icons/utils/createSvgIcon'\n\nexport default createSvgIcon(\n  <React.Fragment>\n    <path d='M22,2l0,20l-20,0l0,-20l20,0Zm-2,2l-16,0l0,16l16,0l0,-16Z' />\n    <rect x='5' y='5' width='4' height='4' />\n    <rect x='15' y='5' width='4' height='4' />\n    <rect x='5' y='15' width='4' height='4' />\n    <rect x='10' y='10' width='1' height='5' />\n    <rect x='11' y='10' width='6' height='2' />\n    <rect x='11' y='12' width='2' height='2' />\n    <rect x='13' y='7' width='1' height='2' />\n    <rect x='14' y='9' width='1' height='1' />\n    <rect x='8' y='10' width='1' height='4' />\n    <rect x='7' y='11' width='1' height='3' />\n    <rect x='9' y='11' width='1' height='1' />\n    <rect x='10' y='6' width='2' height='3' />\n    <rect x='12' y='7' width='1' height='1' />\n    <rect x='15' y='14' width='2' height='4' />\n    <rect x='14' y='14' width='1' height='1' />\n    <rect x='17' y='15' width='2' height='2' />\n    <rect x='11' y='16' width='1' height='3' />\n    <rect x='12' y='15' width='2' height='2' />\n    <rect x='10' y='18' width='1' height='1' />\n  </React.Fragment>, 'QRCode')\n","import React, { useState, useRef, useEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\nimport Fab from '@material-ui/core/Fab'\nimport Modal from '@material-ui/core/Modal'\nimport Zoom from '@material-ui/core/Zoom'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\n\n// import useNewImageMenu from '../PhotoSeries/views/controls/useNewImageMenu'\nimport AddCameraIcon from '@material-ui/icons/AddAPhoto'\nimport PhotoLibraryIcon from '@material-ui/icons/PhotoLibrary'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst useStyles = makeStyles(theme => {\n  const pulseCol = fade(theme.palette.secondary.light, 0.4)\n  return {\n    root: {\n    },\n    fab: {\n      background: theme.palette.secondary.main,\n      color: theme.palette.secondary.contrastText,\n      '&::before': {\n        content: '\"  \"',\n        display: 'block',\n        position: 'absolute',\n        width: '100%',\n        height: '100%',\n        borderRadius: 'inherit',\n        boxShadow: `0 0 0 0 ${pulseCol}`,\n        animation: '$fabPulse 4s',\n        animationIterationCount: 5,\n        animationTimingFunction: 'linear'\n      }\n    },\n    '@keyframes fabPulse': {\n      '0%': {\n        boxShadow: `0 0 0 0px ${pulseCol}`\n      },\n      '90%': {\n        boxShadow: `0 0 0 0px ${pulseCol}`\n      },\n      '100%': {\n        boxShadow: `0 0 0 10px transparent`\n      }\n    },\n    directionUp: {\n    },\n    actionsClosed: {\n      display: 'none'\n    },\n    modalContainer: {\n      position: 'absolute',\n      bottom: '0%',\n      left: '50%',\n      transformOrigin: '50% 50%',\n      transform: 'translateY(-50%) translateX(-50%)'\n    },\n    subFabContainer: {\n      padding: theme.spacing(2)\n    },\n    subFab: {\n      // display: 'block',\n      // padding: theme.spacing(4)\n    },\n    subFabIcon: {\n      margin: theme.spacing(1)\n    }\n  }\n})\n\nconst AddFab = ({ className, children, onCameraClick, onLibraryClick, isIos }) => {\n  const [open, setOpen] = useState(false)\n  const [down, setDown] = useState(false)\n\n  const timerRef = useRef()\n  const classes = useStyles()\n  // const theme = useTheme()\n  const downRef = useRef(down)\n  const elRef = useRef()\n  downRef.current = down\n\n  // Make sure to clean up the timer\n  useEffect(() => () => {\n    // clean up the timer if we no longer need it\n    timerRef.current = null\n    downRef.current = null\n  }, [])\n\n  const startTimer = (el) => {\n    if (isIos) return\n    if (!elRef.current) return\n\n    setDown(true)\n    if (!open && !timerRef.current) {\n      timerRef.current = setTimeout(() => {\n        if (downRef.current) setOpen(true)\n        timerRef.current = null\n      }, 300)\n    }\n  }\n\n  const onDown = (e) => {\n    // console.log('onDown', e.currentTarget)\n    // setSeries(series)\n    startTimer(e.currentTarget)\n  }\n\n  const block = (e) => {\n    if (e && e.stopPropagation) {\n      e.stopPropagation()\n      e.preventDefault()\n    }\n  }\n\n  const cameraAction = (e) => {\n    console.log('cameraclick')\n    setOpen(false)\n    setDown(false)\n    onCameraClick()\n    block(e)\n  }\n  const libraryAction = (e) => {\n    console.log('libraryClick')\n    setOpen(false)\n    setDown(false)\n    onLibraryClick()\n    block(e)\n  }\n\n  return (\n    <div className={classNames(classes.rootContainer, className)} ref={elRef}>\n      <Fab\n        className={classes.fab}\n        onMouseDown={onDown}\n        // onMouseUp={onUp}\n        onTouchStart={onDown}\n        // onTouchEnd={onUp}\n        onClick={(e) => {\n          block(e)\n          setDown(false)\n          if (!open) {\n            console.log('cameraclick MAIN')\n            onCameraClick()\n          }\n        }}\n        disableFocusRipple\n        disableTouchRipple\n        disableRipple\n        size='large'\n        color='secondary'\n        aria-label='Add'\n      >\n        {children}\n      </Fab>\n      <Modal\n        aria-labelledby='simple-modal-title'\n        aria-describedby='simple-modal-description'\n        open={open}\n        onClose={() => setOpen(false)}\n      >\n        <div className={classes.modalContainer}>\n          <Zoom\n            in={open}\n            timeout={500}\n            unmountOnExit\n          >\n            <div className={classes.subFabContainer}>\n              <Fab\n                className={classes.subFab}\n                disableFocusRipple\n                variant='extended'\n                size='large'\n                color='secondary'\n                aria-label='Add'\n                onClick={() => {\n                  setOpen(false)\n                  libraryAction()\n                }}\n              >\n                <PhotoLibraryIcon color='inherit' className={classes.subFabIcon} />\n              Library\n              </Fab>\n            </div>\n          </Zoom>\n          <Zoom\n            in={open}\n            timeout={250}\n            // style={{\n            //   transitionDelay: `${open ? 500 : 0}ms`\n            // }}\n            unmountOnExit\n          >\n            <div className={classes.subFabContainer}>\n              <Fab\n                className={classes.subFab}\n                disableFocusRipple\n                variant='extended'\n                size='large'\n                color='secondary'\n                aria-label='Add'\n                onClick={() => {\n                  setOpen(false)\n                  cameraAction()\n                }}\n              >\n                <AddCameraIcon color='inherit' className={classes.subFabIcon} />\n              Camera\n              </Fab>\n            </div>\n          </Zoom>\n        </div>\n      </Modal>\n    </div>\n\n  )\n}\n\nAddFab.propTypes = {\n  className: PropTypes.string,\n  children: PropTypes.any,\n  isIos: PropTypes.bool,\n  onCameraClick: PropTypes.func.isRequired,\n  onLibraryClick: PropTypes.func.isRequired\n}\n\nexport default AddFab\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport Menu from '@material-ui/core/Menu'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport Divider from '@material-ui/core/Divider'\n\n// import { Menu as MenuIcon } from '@material-ui/icons'\n\nconst ContextMenu = ({ anchorEl, onClose, menuItems }) => {\n  return (\n    <Menu\n      anchorEl={anchorEl}\n      open={!!anchorEl}\n      onClose={onClose}\n    >\n      {menuItems.map(({ icon, color, text, hide, disabled, action, divider }, idx) => {\n        const Icon = icon || null\n        if (hide) return null\n        if (divider) return <Divider key={`contextMenu-${idx}`} />\n        return (\n          <MenuItem\n            button\n            key={`contextMenu-${idx}`}\n            disabled={disabled}\n            onClick={() => {\n              onClose()\n              action()\n            }}>\n            {Icon && (\n              <ListItemIcon>\n                <Icon color={disabled ? 'disabled' : color} />\n              </ListItemIcon>\n            )}\n            <ListItemText primary={text} primaryTypographyProps={{ color }} />\n          </MenuItem>\n        )\n      })}\n    </Menu>\n  )\n}\n\nContextMenu.propTypes = {\n  anchorEl: PropTypes.object,\n  onClose: PropTypes.func,\n  menuItems: PropTypes.arrayOf(PropTypes.shape({\n    text: PropTypes.string,\n    icon: PropTypes.any,\n    divider: PropTypes.any,\n    hide: PropTypes.bool,\n    disabled: PropTypes.bool,\n    color: PropTypes.string,\n    action: PropTypes.func\n  }))\n}\n\nexport default ContextMenu\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport Chip from '@material-ui/core/Chip'\nimport CancelIcon from '@material-ui/icons/Cancel'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\n\nexport const tagChips = {\n  height: 20\n}\n\nconst style = theme => ({\n  root: {\n    fontSize: '0.6em',\n    height: tagChips.height,\n    marginRight: theme.spacing(1) / 2,\n    marginTop: theme.spacing(1) / 2\n  },\n  deleteIcon: {\n    width: tagChips.height - 1,\n    height: tagChips.height - 1\n  },\n  chipAvatar: {\n    width: tagChips.height,\n    height: tagChips.height\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst TagChip = ({ edit, tag, color, onDelete, ...props }) => {\n  const classes = useStyles()\n  const theme = useTheme()\n  return (\n    <Chip\n      style={{\n        background: color || null,\n        color: color ? `${theme.palette.getContrastText(color)}` : null\n      }}\n      label={tag.label}\n      data={tag.id}\n      onDelete={edit ? () => onDelete(tag) : null}\n      deleteIcon={(\n        <CancelIcon\n          className={classes.deleteIcon}\n          onClick={e => {\n            console.log('this click')\n          }}\n          style={{\n            opacity: 0.5,\n            color: color ? `${theme.palette.getContrastText(color)}` : null\n          }}\n        />\n      )}\n      className={classes.root}\n      {...props}\n    />\n  )\n}\n\nTagChip.propTypes = {\n  color: PropTypes.string.isRequired,\n  edit: PropTypes.bool,\n  tag: PropTypes.object.isRequired,\n  onDelete: PropTypes.func\n}\n\nexport default TagChip\n","import React from 'react'\nimport classNames from 'classnames'\nimport PropTypes from 'prop-types'\nimport Typography from '@material-ui/core/Typography'\nimport FormLabel from '@material-ui/core/FormLabel'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst style = theme => ({\n  root: {\n    position: 'relative',\n    display: 'block',\n    overflow: 'hidden',\n    whiteSpace: 'pre-line',\n    '&::before': {\n      content: '\"  \"',\n      display: 'block',\n      position: 'absolute',\n      bottom: 0,\n      width: '100%',\n      height: 100,\n      background: `linear-gradient(180deg, rgba(255,255,255,0) 0%, ${theme.palette.background.paper} 100%)`\n    }\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst ShortLongText = ({ label, text, height, onClick }) => {\n  const classes = useStyles()\n  return (\n    <div onClick={onClick}>\n      {label && (\n        <FormLabel className={classes.formLabel}>\n          {label}\n        </FormLabel>\n      )}\n      <Typography\n\n        variant='body1'\n        color='inherit'\n        style={{ height }}\n        className={classNames(classes.root)}\n      >\n        {text}\n      </Typography>\n    </div>\n  )\n}\n\nShortLongText.propTypes = {\n  label: PropTypes.string,\n  text: PropTypes.string,\n  height: PropTypes.number,\n  onClick: PropTypes.func\n}\nShortLongText.defaultProps = {\n  height: 100\n}\n\nexport default ShortLongText\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport ListItemAvatar from '@material-ui/core/ListItemAvatar'\nimport Avatar from '@material-ui/core/Avatar'\n// import MenuIcon from '@material-ui/icons/Menu'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n  },\n  imgContainer: {\n    // flex: '0 0 50px',\n    // alignSelf: 'flex-start',\n    // height: '100%',\n  },\n  gravatarImg: {\n    objectFit: 'cover',\n    height: '100%',\n    width: '100%'\n  }\n}))\n\nconst UserListItem = ({ user, loading, onAvatarClick, secondary }) => {\n  const classes = useStyles()\n\n  if (loading || !user) return 'LOADING...'\n  // console.log('USER', user)\n\n  return (\n    <ListItem className={classes.root} button={!!onAvatarClick} onClick={onAvatarClick}>\n      <ListItemAvatar className={classes.imgContainer}>\n        <Avatar>\n          <img alt='profile' className={classes.gravatarImg} src={user.gravatar} />\n        </Avatar>\n      </ListItemAvatar>\n      <ListItemText\n        primary={user.username}\n        secondary={secondary}\n      />\n    </ListItem>\n  )\n}\n\nUserListItem.propTypes = {\n  user: PropTypes.object,\n  loading: PropTypes.bool,\n  secondary: PropTypes.string,\n  onAvatarClick: PropTypes.func\n}\n\nexport default UserListItem\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport Typography from '@material-ui/core/Typography'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport Dialog from '@material-ui/core/Dialog'\nimport IconButton from '@material-ui/core/IconButton'\nimport DialogTitle from '@material-ui/core/DialogTitle'\n\nimport CloseIcon from '@material-ui/icons/Close'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst style = theme => ({\n  root: {\n\n  },\n  body: {\n    overflow: 'hidden',\n    whiteSpace: 'pre-line',\n    paddingBottom: theme.spacing(1)\n  },\n  title: {\n    background: theme.palette.primary.main,\n    color: theme.palette.primary.contrastText,\n    alignSelf: 'flex-start',\n    width: '100%',\n    margin: 0,\n    display: 'flex',\n    padding: theme.spacing(2)\n  },\n  dlgTitle: {\n    flexGrow: 1\n  },\n  closeButton: {\n    padding: 0,\n    alignSelf: 'flex-start'\n    // color: theme.palette.grey[500]\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst BigText = ({ open, onClose, title, body }) => {\n  const classes = useStyles()\n  return (\n    <Dialog\n      scroll='paper'\n      open={open}\n      fullWidth\n      maxWidth='xl'\n      onClose={onClose}\n      aria-labelledby='simple-dialog-title'\n    >\n      <DialogTitle className={classes.title} disableTypography>\n        <Typography className={classes.dlgTitle}>{title}</Typography>\n        <IconButton color='inherit' className={classes.closeButton} onClick={onClose}>\n          <CloseIcon color='inherit' />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent>\n        <Typography variant='body2' className={classes.body}>{body}</Typography>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nBigText.propTypes = {\n  open: PropTypes.bool,\n  onClose: PropTypes.func,\n  title: PropTypes.string,\n  body: PropTypes.string\n}\n\nexport default BigText\n","import React, { useState, useContext } from 'react'\n// import PropTypes from 'prop-types'\nimport classNames from 'classnames'\nimport Divider from '@material-ui/core/Divider'\nimport List from '@material-ui/core/List'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport ListItemAvatar from '@material-ui/core/ListItemAvatar'\nimport Avatar from '@material-ui/core/Avatar'\nimport Typography from '@material-ui/core/Typography'\nimport FormLabel from '@material-ui/core/FormLabel'\n\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport TagChip from '../tags/TagChip'\nimport style from './SeriesInfo.style'\n\nimport ShortLongText from '../controls/ShortLongText'\nimport UserListItem from '../controls/UserListItem'\nimport BigText from '../dialogs/BigText'\nimport { formatDate } from '../../../../lib/datelib'\nimport { ACCESS } from '../../../../config'\nimport SeriesConfigClass from '../../../../lib/SeriesConfig'\n\nimport { SeriesContext } from '../../contexts'\n\nconst DIALOGS = {\n  NOTEVIEW: 'NOTEVIEW'\n}\nconst useStyles = makeStyles(style)\n\nconst SeriesInfo = () => {\n  const classes = useStyles()\n  const { series, seriesConfig } = useContext(SeriesContext)\n  const seriesConfigInst = new SeriesConfigClass(seriesConfig)\n  const [activeDialog, setActiveDialog] = useState(null)\n\n  const newTags = series.photos.reduce((acc, { tags }) => {\n    tags.forEach(tag => {\n      if (!acc[tag.typeId]) {\n        acc[tag.typeId] = {\n          [tag.label]: { ...tag, count: 1 }\n        }\n      }\n      else if (acc[tag.typeId][tag.label]) {\n        const existing = acc[tag.typeId][tag.label]\n        acc[tag.typeId][tag.label] = { ...existing, count: existing.count + 1 }\n      }\n      else acc[tag.typeId][tag.label] = { ...tag, count: 1 }\n    })\n    return acc\n  }, {})\n\n  let metaKeys = []\n  try {\n    metaKeys = series.meta ? Object.keys(JSON.parse(series.meta)) : []\n  }\n  catch (e) {\n    console.error(e)\n  }\n\n  return (\n    <div className={classes.root}>\n      <div className={classes.field}>\n        <FormLabel className={classes.formLabel}>\n      Series Name\n        </FormLabel>\n        <Typography variant='body1' color='inherit'>\n          {series.name}\n        </Typography>\n      </div>\n      {series.note && (\n        <ShortLongText\n          label='Series Note'\n          text={series.note}\n          onClick={() => setActiveDialog(DIALOGS.NOTEVIEW)}\n        />\n      )}\n\n      <Typography className={classes.heading} variant='subtitle1'>Series Summary</Typography>\n      <Divider />\n      <List className={classes.list} dense>\n        <ListItem className={classNames(classes.access, classes[series.access])}>\n          <ListItemText\n            color='inherit'\n            primary={`Series is ${ACCESS[series.access].label}`}\n            secondary={ACCESS[series.access].description}\n          />\n        </ListItem>\n        {series.createdUser && (\n          <UserListItem\n            user={series.createdUser}\n            onAvatarClick={() => seriesConfig.onAvatarClick(series.createdUser.username)}\n            secondary='created this series'\n          />\n        )}\n        <ListItem>\n          <ListItemAvatar>\n            <Avatar className={classes.numPhotos}>\n              {series.photos.length}\n            </Avatar>\n          </ListItemAvatar>\n          <ListItemText\n            primary={series.photos.length > 1 ? 'Photos' : 'Photo'}\n            secondary={series.photos.length > 0 && (\n              <span>\n                {formatDate(series.photos[0].takenOn, 'LL')}\n                <span>&nbsp;&nbsp;</span>to<span>&nbsp;&nbsp;</span>\n                {formatDate(series.photos[series.photos.length - 1].takenOn, 'LL')}\n              </span>\n            )}\n          />\n        </ListItem>\n        <ListItem>\n          <ListItemAvatar>\n            <Avatar className={classes.watchers}>\n              {series.watchers}\n            </Avatar>\n          </ListItemAvatar>\n          <ListItemText primary='Users Watching' />\n        </ListItem>\n        <ListItem>\n          <ListItemText>\n            <FormLabel className={classes.formLabel}>\n              Tags in use (across all photos)\n            </FormLabel>\n            <Divider />\n            {Object.keys(newTags).length === 0 && (\n              <Typography variant='caption'>No photos in this series have tags</Typography>\n            )}\n            {Object.keys(newTags).map((tagKey, idtk) => (\n              <div key={`tagchipkey${idtk}`} className={classes.tagListItem}>\n                <Typography className={classes.subheading} variant='overline'>{seriesConfigInst.getTagType(tagKey).label}</Typography>\n                <Divider />\n                {Object.values(newTags[tagKey]).length > 0\n                  ? (\n                    Object.values(newTags[tagKey]).map((tag, idx) => (\n                      <TagChip\n                        key={`tagchip-${idtk}-${idx}`}\n                        tag={tag}\n                        color={seriesConfigInst.getTagType(tagKey).color}\n                      />\n                    ))\n                  )\n                  : (\n                    <Typography variant='caption'>No photos in this series have tags</Typography>\n                  )\n                }\n              </div>\n            ))}\n          </ListItemText>\n        </ListItem>\n\n      </List>\n\n      {metaKeys.length > 0 && Object.keys(seriesConfig.meta).length > 0 && (\n        <React.Fragment>\n          <FormLabel className={classes.formLabel}>\n            Metadata\n          </FormLabel>\n          <Divider />\n          <List className={classes.list}>\n            {metaKeys.map((key, idx) => seriesConfig.meta[key] ? (\n              <ListItem key={`metadata${idx}`}>\n                <ListItemText\n                  primary={seriesConfig.meta[key].label}\n                  secondary={seriesConfig.meta[key].render(series.meta[key])}\n                />\n              </ListItem>\n            ) : null\n            )}\n          </List>\n        </React.Fragment>\n      )}\n      {activeDialog === DIALOGS.NOTEVIEW && (\n        <BigText\n          open\n          multiline\n          onClose={() => setActiveDialog(null)}\n          title='Series Note'\n          body={series.note}\n        />\n      )}\n    </div>\n  )\n}\n\nSeriesInfo.propTypes = {\n}\n\nexport default SeriesInfo\n","import { ACCESS } from '../../../../config'\nexport default theme => ({\n  root: {\n    margin: theme.spacing(1),\n    backgroundColor: theme.palette.background.paper,\n    paddingBottom: 60 // a little extra room for the FAB\n\n  },\n  field: {\n    marginBottom: theme.spacing(1)\n  },\n  list: {\n    padding: theme.spacing(1)\n  },\n  heading: {\n    marginTop: theme.spacing(1)\n  },\n  watchers: {\n    // backgroundColor: theme.palette.primary.main,\n    // color: theme.palette.primary.contrastText\n  },\n  numPhotos: {\n    backgroundColor: theme.palette.primary.main,\n    color: theme.palette.primary.contrastText\n  },\n  tagListItem: {\n    marginTop: theme.spacing(1),\n    marginBottom: theme.spacing(2)\n  },\n  chip: {\n    margin: theme.spacing(0.5)\n  },\n  access: {\n    padding: theme.spacing(1),\n    borderRadius: theme.spacing(1)\n  },\n  ...Object.keys(ACCESS).reduce((acc, key) => ({\n    ...acc,\n    [key]: {\n      border: `1px solid ${ACCESS[key].color[500]}`,\n      background: `${ACCESS[key].color[700]}`,\n      color: theme.palette.getContrastText(ACCESS[key].color[700])\n    }\n  }), {})\n})\n","import { useCallback, useState, useLayoutEffect, useRef } from 'react'\nimport { debounce } from './util'\n\nconst getSize = (el, minSize, defaultSize) => {\n  if (!el) return defaultSize || minSize || { width: 0, height: 0 }\n\n  if (minSize) {\n    return {\n      width: Math.max(minSize.width, el.offsetWidth),\n      height: Math.max(minSize.height, el.offsetHeight)\n    }\n  }\n  else {\n    return {\n      width: el.offsetWidth,\n      height: el.offsetHeight\n    }\n  }\n}\n\nconst useComponentSize = (ref, minSize, defaultSize) => {\n  const resizeActiveRef = useRef()\n  const [resizeActive, setResizeActive] = useState(true)\n\n  resizeActiveRef.current = resizeActive\n  const [size, setComponentSize] = useState(\n    getSize(ref ? ref.current : null, minSize, defaultSize)\n  )\n\n  const handleResize = () => {\n    if (!resizeActiveRef.current || !ref.current) return\n    const newSize = getSize(ref.current, minSize, defaultSize)\n    if (newSize.height !== size.height || newSize.width !== size.width) {\n      // console.log('handleResize Called', { newSize, size })\n      setComponentSize(newSize)\n    }\n  }\n\n  const handleResizeDebounced = useCallback(\n    debounce(handleResize, 500),\n    []\n  )\n\n  useLayoutEffect(() => {\n    if (!ref.current) return\n    handleResize()\n\n    if (typeof ResizeObserver === 'function') {\n      let resizeObserver = new ResizeObserver(handleResizeDebounced)\n      resizeObserver.observe(ref.current)\n\n      return () => {\n        resizeObserver.disconnect(ref.current)\n        resizeObserver = null\n      }\n    }\n    else {\n      window.addEventListener('resize', handleResizeDebounced)\n\n      return () => {\n        window.removeEventListener('resize', handleResizeDebounced)\n      }\n    }\n  },\n  [ref.current])\n\n  return { size, setResizeActive }\n}\n\nexport default useComponentSize\n","const tagChips = {\n  height: 20\n}\n\nexport default theme => ({\n  xyTagChip: {\n    cursor: 'pointer',\n    color: 'white',\n    fontSize: '0.6em',\n    background: '#444444',\n    height: tagChips.height,\n    position: 'absolute',\n    left: -tagChips.height / 2,\n    top: -tagChips.height / 2\n  },\n  editing: {\n    // color: 'white',\n    // background: theme.palette.secondary.main\n  },\n  // The tag is flipped on the right side of the screen\n  reversedChip: {\n    flexDirection: 'row-reverse',\n    left: 'unset',\n    right: -tagChips.height / 2\n  },\n  deleteIcon: {\n    // color: 'white',\n    width: tagChips.height - 1,\n    height: tagChips.height - 1\n  },\n  chipAvatarIcon: {\n    color: 'white',\n    width: tagChips.height - 4,\n    height: tagChips.height - 4\n  },\n  chipAvatar: {\n    background: 'inherit',\n    width: tagChips.height,\n    height: tagChips.height\n  },\n  reversedDelete: {\n    margin: `0 -${tagChips.height / 8}px 0 ${tagChips.height / 8}px`\n  },\n  // The chip bucket is the container div for the chip and represents the\n  // Actual XY coordinates. The chip itself is offset to make the\n  chipBucket: {\n    width: 1,\n    height: 1,\n    display: 'flex',\n    flexDirection: 'row',\n    position: 'absolute'\n  },\n  reversedChipBucket: {\n    flexDirection: 'row-reverse'\n  }\n})\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\nimport Draggable from 'react-draggable'\n\nimport Chip from '@material-ui/core/Chip'\nimport Avatar from '@material-ui/core/Avatar'\n\nimport CancelIcon from '@material-ui/icons/Cancel'\nimport MyLocation from '@material-ui/icons/MyLocation'\n\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport style from './XYTagChip.style'\n\nconst useStyles = makeStyles(style)\n\nconst XYTagChip = ({\n  color, edit, tag, newSize,\n  onTagDragOver, onTagDragStop, onNewTag, onTagDelete, ...props\n}) => {\n  const isReversed = tag.relCoords.x > newSize.newWidth / 2\n  const classes = useStyles()\n  const theme = useTheme()\n  const stopBadness = (e) => {\n    e.preventDefault()\n    e.stopPropagation()\n  }\n\n  const handleDrag = (e, data) => {\n    stopBadness(e)\n    onTagDragOver(data, tag)\n  }\n  const handleStopDrag = (e, data) => {\n    stopBadness(e)\n    onTagDragStop(data, tag)\n  }\n\n  // Draggable chip if it is editable\n  return (\n    <Draggable\n      disabled={!edit}\n      bounds={{ left: 10, top: 10, right: newSize.newWidth - 10, bottom: newSize.newHeight - 10 }}\n      position={{ x: tag.relCoords.x, y: tag.relCoords.y }}\n      onDrag={handleDrag}\n      onStop={handleStopDrag}\n      onClick={stopBadness}\n    >\n      <div className={classNames(classes.chipBucket, isReversed && classes.reversedChipBucket)}>\n        <Chip\n          style={{\n            background: color ? `${color}!important` : null,\n            color: color ? `${theme.palette.getContrastText(color)}!important` : null\n          }}\n          color={edit ? 'secondary' : 'default'}\n          label={tag.label}\n          data={tag.id}\n          onClick={stopBadness}\n          onDelete={edit ? onTagDelete(tag) : null}\n          deleteIcon={edit ? <CancelIcon className={classNames(classes.deleteIcon, isReversed && classes.reversedDelete)} /> : <div />}\n          className={classNames(\n            classes.xyTagChip,\n            isReversed && classes.reversedChip,\n            edit && classes.editing\n          )}\n          {...props}\n          avatar={<Avatar className={classNames(classes.chipAvatar, edit && classes.editing)}>\n            <MyLocation className={classNames(classes.chipAvatarIcon, edit && classes.editing)} />\n          </Avatar>}\n        />\n      </div>\n    </Draggable>\n  )\n}\n\nXYTagChip.propTypes = {\n  color: PropTypes.string,\n  edit: PropTypes.bool,\n  tag: PropTypes.object.isRequired,\n  newSize: PropTypes.object,\n  onTagDragOver: PropTypes.func,\n  onTagDragStop: PropTypes.func,\n  onNewTag: PropTypes.func,\n  onTagDelete: PropTypes.func\n}\n\nexport default XYTagChip\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport Paper from '@material-ui/core/Paper'\nimport Typography from '@material-ui/core/Typography'\nimport TextField from '@material-ui/core/TextField'\nimport MenuItem from '@material-ui/core/MenuItem'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport Select from 'react-select'\nimport CreatableSelect from 'react-select/lib/Creatable'\nimport style from './XYTagSelect.style'\n\nconst useStyles = makeStyles(style)\n\nconst XYTagSelect = ({ tagConfig, onChange }) => {\n  const classes = useStyles()\n  const options = tagConfig.values.map(tc => ({ label: tc.label, value: tc.id }))\n  console.log('XYTagSelect', tagConfig)\n  return (\n    <div className={classes.root}>\n      {!tagConfig.allowAdditions && (\n        <Select\n          options={options}\n          classes={classes}\n          components={{\n            Control,\n            Menu,\n            NoOptionsMessage,\n            Option,\n            Placeholder,\n            ValueContainer\n          }}\n          value={null}\n          // onBlur={e => e.preventDefault()}\n          blurInputOnSelect\n          isClearable={false}\n          onChange={onChange}\n          placeholder={tagConfig.label}\n          isSearchable\n        />\n      ) }\n      { tagConfig.allowAdditions && (\n        <CreatableSelect\n          options={options}\n          classes={classes}\n          components={{\n            Control,\n            Menu,\n            NoOptionsMessage,\n            Option,\n            Placeholder,\n            ValueContainer\n          }}\n          value={null}\n          isClearable={false}\n          // onBlur={e => e.preventDefault()}\n          blurInputOnSelect\n          onChange={onChange}\n          placeholder={tagConfig.label}\n          isSearchable\n        />\n      )}\n    </div>\n  )\n}\nXYTagSelect.propTypes = {\n  tagConfig: PropTypes.object.isRequired,\n  onChange: PropTypes.func.isRequired\n}\n\nexport default XYTagSelect\n\nfunction Control (props) {\n  return (\n    <TextField\n      fullWidth\n      InputProps={{\n        inputComponent,\n        inputProps: {\n          className: props.selectProps.classes.input,\n          inputRef: props.innerRef,\n          children: props.children,\n          ...props.innerProps\n        }\n      }}\n      {...props.selectProps.textFieldProps}\n    />\n  )\n}\n\nconst NoOptionsMessage = ({ innerProps, selectProps, children }) => (\n  <Typography\n    color='textSecondary'\n    className={selectProps.classes.noOptionsMessage}\n    {...innerProps}\n  >\n    {children}\n  </Typography>\n)\n\nconst Menu = ({ selectProps, innerProps, children }) => (\n  <Paper square className={selectProps.classes.paper} {...innerProps}>\n    {children}\n  </Paper>\n)\n\nconst inputComponent = ({ inputRef, ...props }) => <div ref={inputRef} {...props} />\n\nconst Placeholder = (props) => (\n  <Typography\n    color='textSecondary'\n    className={props.selectProps.classes.placeholder}\n    {...props.innerProps}\n  >\n    {props.children}\n  </Typography>\n)\n\nconst Option = ({ innerRef, isFocused, isSelected, innerProps, children }) => (\n  <MenuItem\n    buttonRef={innerRef}\n    selected={isFocused}\n    component='div'\n    style={{ fontWeight: isSelected ? 500 : 400 }}\n    {...innerProps}\n  >\n    {children}\n  </MenuItem>\n)\n\nconst ValueContainer = ({ selectProps, children }) => (\n  <div className={selectProps.classes.valueContainer}>{children}</div>\n)\nValueContainer.propTypes = {\n  selectProps: PropTypes.object.isRequired,\n  children: PropTypes.any\n}\n","export default theme => ({\n  root: {\n    width: '100%'\n  },\n  noOptionsMessage: {\n    padding: `${theme.spacing(1)}px ${theme.spacing(1) * 2}px`\n  },\n  singleValue: {\n    fontSize: 16\n  },\n  placeholder: {\n    position: 'absolute',\n    left: 2,\n    fontSize: 16\n  },\n  input: {\n    display: 'flex',\n    padding: 0\n  },\n  valueContainer: {\n    display: 'flex',\n    flexWrap: 'wrap',\n    flex: 1,\n    alignItems: 'center',\n    overflow: 'hidden'\n  },\n  paper: {\n    position: 'absolute',\n    zIndex: 100,\n    marginTop: theme.spacing(1),\n    left: 0,\n    right: 0\n  }\n})\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport Typography from '@material-ui/core/Typography'\nimport IconButton from '@material-ui/core/IconButton'\n\nimport CloseIcon from '@material-ui/icons/Close'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport XYTagSelect from './XYTagSelect'\nimport style from './XYTagChooser.style'\n\nconst useStyles = makeStyles(style)\n\nconst XYTagChooser = ({ coords, open, seriesConfig, onNewTag, onClose }) => {\n  const classes = useStyles()\n  const xyTags = seriesConfig.tags.filter(t => t.allowXY)\n  if (!coords) return null\n  return (\n    <Dialog\n      open={open}\n      scroll='paper'\n      fullScreen\n      classes={{ paperScrollPaper: classes.root }}\n      onClose={() => onClose()}\n      aria-labelledby='simple-dialog-title'\n    >\n      <DialogTitle id='simple-dialog-title' className={classes.header}>\n      New Tag:\n        <IconButton className={classes.closeButton} onClick={onClose}>\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n      <div className={classes.dlgBody}>\n        {xyTags.length > 1 && (\n          <Typography variant='caption'>What kind of tag would you like to create?</Typography>\n        )}\n\n        {xyTags.map((tagType, idx) => (\n          <div className={classes.listItem} key={`tagSelect${idx}`}>\n            <XYTagSelect tagConfig={tagType} onChange={onNewTag(coords, tagType)} />\n          </div>\n        ))}\n      </div>\n    </Dialog>\n  )\n}\n\nXYTagChooser.propTypes = {\n  seriesConfig: PropTypes.object.isRequired,\n  open: PropTypes.bool.isRequired,\n  coords: PropTypes.object,\n  onClose: PropTypes.func.isRequired,\n  onNewTag: PropTypes.func.isRequired\n}\n\nexport default XYTagChooser\n","export default theme => ({\n  root: {\n    overflow: 'visible'\n  },\n  header: {\n    padding: theme.spacing(1) * 2\n  },\n  listItem: {\n    flexDirection: 'column'\n  },\n  dlgBody: {\n    paddingLeft: theme.spacing(1) * 2,\n    paddingRight: theme.spacing(1) * 2,\n    paddingBottom: theme.spacing(1) * 2\n  },\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500]\n  }\n})\n","import SeriesConfig from './SeriesConfig'\n\nclass Tags {\n  constructor (seriesConfig, tags) {\n    this.tags = tags\n    this.seriesConfig = new SeriesConfig(seriesConfig)\n  }\n\n  findTagById = (typeId, tagId) => {\n    return this.seriesConfig.getTagType(typeId).values\n      .find(tt => tt.id === tagId)\n  }\n\n  // Filter the list of tags to those that are XY tags\n  getXYTags = () => {\n    const xyTagIds = this.seriesConfig.getXYTagTypes().map(tt => tt.id)\n    return this.tags.filter(tag => xyTagIds.indexOf(tag.typeId) > -1 && tag.coords && tag.coords.x)\n  }\n\n  getNonXYTags = () => {\n    const NonXYTagIds = this.seriesConfig.getNonXYTagTypes().map(tt => tt.id)\n    return this.tags.filter(tag => NonXYTagIds.indexOf(tag.typeId) > -1)\n  }\n\n  createNewTagObj = (label, typeId) => (\n    { label, typeId }\n  )\n\n  createExistingTagObj = (id, typeId) => ({\n    ...this.findTagById(typeId, id),\n    typeId\n  })\n\n  createNewXYTagObj = (label, typeId, coords) => ({\n    label,\n    typeId,\n    coords\n  })\n\n  createExistingXYTagObj = (id, typeId, coords) => ({\n    ...this.findTagById(typeId, id),\n    typeId,\n    coords\n  })\n\n  // Get tags in a way that's easy to render them\n  // We augment these tags with relative positions\n  // and a group number for coloring.\n  getRelXYTags = (multiplier) => this.getXYTags().map(tag => ({\n    ...tag,\n    group: this.seriesConfig.getTagTypeIndex(tag.typeId),\n    relCoords: {\n      x: tag.coords.x * multiplier,\n      y: tag.coords.y * multiplier\n    }\n  }))\n}\n\nexport default Tags\n","import React, { useState, useContext } from 'react'\nimport { SeriesContext } from '../../contexts'\nimport XYTagChooser from './XYTagChooser'\nimport Tags from '../../../../lib/Tags'\n\nconst useXYTags = (photo, newSize, onChange, setResizeActive) => {\n  const { seriesConfig } = useContext(SeriesContext)\n\n  // we hold the tags in state so that every little drag motion\n  // doesn't cause an updated state until you let go\n  const [isDragging, setIsDragging] = useState(false)\n  const [newTagDialog, setNewTagDialog] = useState(null)\n\n  const tagClass = new Tags(seriesConfig, photo.tags)\n\n  const onNewTag = (coords, tagType) => ({ value, __isNew__: isNew }) => {\n    let addTag = isNew\n      ? tagClass.createNewXYTagObj(value, tagType.id, coords)\n      : tagClass.createExistingXYTagObj(value, tagType.id, coords)\n\n    setNewTagDialog(null)\n    onChange({ ...photo, tags: [...photo.tags, addTag] })\n  }\n\n  const onTagDelete = (tag) => () => {\n    const tags = photo.tags.filter(oldTag => oldTag.id !== tag.id)\n    onChange({\n      ...photo,\n      tags\n    })\n  }\n\n  // When the photo is tapped, send the x,y coords of that tap\n  // to a dialog we will open\n  const onAddTagTrigger = (e) => {\n    if (!newTagDialog) {\n      // Turn off resizing so mobile keyboards don't complete F us.\n      setResizeActive(false)\n      setNewTagDialog({\n        x: parseInt(e.pageX - (window.innerWidth - newSize.newWidth) / 2 * newSize.multiplier, 10),\n        y: parseInt(e.pageY - (window.innerHeight - newSize.newHeight) / 2 * newSize.multiplier, 10)\n      })\n    }\n  }\n\n  // This gets used by the drag AND the stop\n  const updateTagLocation = ({ x, y }, tag) => {\n    const newTags = photo.tags.map(oldTag => {\n      if (oldTag.id !== tag.id) return oldTag\n      else {\n        let newX = parseInt(x / newSize.multiplier, 10)\n        let newY = parseInt(y / newSize.multiplier, 10)\n\n        return {\n          ...oldTag,\n          coords: { x: newX, y: newY }\n        }\n      }\n    })\n    return newTags\n  }\n\n  const onTagDragStop = (coords, tag) => {\n    const tags = updateTagLocation(coords, tag)\n    setIsDragging(false)\n    onChange({\n      ...photo,\n      tags\n    })\n  }\n\n  const onTagDragOver = (coords, tag) => {\n    updateTagLocation(coords, tag)\n    setIsDragging(true)\n  }\n  const TagChooser = () => (\n    <XYTagChooser\n      open={!isDragging && Boolean(newTagDialog)}\n      coords={newTagDialog}\n      seriesConfig={seriesConfig}\n      onNewTag={onNewTag}\n      onClose={() => {\n        setNewTagDialog(null)\n        // Turn on resizing again.\n        setResizeActive(true)\n      }}\n    />\n  )\n\n  return {\n    onNewTag,\n    onTagDelete,\n    onAddTagTrigger,\n    onTagDragOver,\n    onTagDragStop,\n    TagChooser,\n    getRelXYTags: tagClass.getRelXYTags\n  }\n}\n\nexport default useXYTags\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\nimport Typography from '@material-ui/core/Typography'\nimport CircularProgress from '@material-ui/core/CircularProgress'\nimport BrokenImageIcon from '@material-ui/icons/BrokenImage'\n\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    height: '100%',\n    padding: theme.spacing(2),\n    display: 'flex',\n    flexDirection: 'column',\n    overflow: 'hidden',\n    opacity: 0.3,\n    textAlign: 'center',\n    color: theme.palette.getContrastText(theme.palette.text.primary),\n    background: theme.palette.text.primary\n  },\n  spacer: {\n    flexGrow: 1\n  },\n  icon: {\n    width: '100%',\n    flex: '1 1 40%',\n    opacity: 0.5\n  },\n  circularProgress: {\n    margin: '0 auto'\n  },\n  primary: {\n    textAlign: 'center',\n    width: '100%'\n  },\n  secondary: {\n    flex: '1 1 30%',\n    width: '100%'\n  }\n}))\n\nconst BrokenImg = ({ loading, className, ...props }) => {\n  const classes = useStyles()\n  return (\n    <div className={classNames(classes.root, className)} {...props}>\n      <div className={classes.spacer} />\n      {loading\n        ? <CircularProgress color='inherit' className={classes.circularProgress} />\n        : <BrokenImageIcon className={classes.icon} color='inherit' />\n      }\n      <Typography className={classes.primary} color='inherit'>\n        {loading ? 'Loading' : 'Photo not found' }\n      </Typography>\n      <div className={classes.spacer} />\n    </div>\n  )\n}\nBrokenImg.propTypes = {\n  loading: PropTypes.bool,\n  className: PropTypes.string\n}\n\nexport default BrokenImg\n","import React, { useState, useEffect, useRef } from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\nimport { makeStyles } from '@material-ui/core/styles'\nimport BrokenImg from './BrokenImg'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    position: 'relative',\n    display: 'block',\n    height: '100%',\n    width: '100%'\n  },\n  img: {\n    display: 'block',\n    height: '100%',\n    width: '100%'\n  },\n  imgBroken: {\n    display: 'none'\n  }\n}))\n\nexport const RawImage = ({ className, getPhotoUrls, sizePriority, dataUrl, photo, imgRef, cover, style, ...props }) => {\n  const classes = useStyles()\n  const [imgUrls, setImgUrls] = useState()\n  const altImgRef = useRef()\n\n  const [altIndex, setAltIndex] = useState(0)\n  const [broken, setBroken] = useState(false)\n\n  useEffect(() => {\n    if (!dataUrl && photo && getPhotoUrls) {\n      getPhotoUrls(photo, ['large', 'medium']).then((data) => {\n        if (altImgRef.current) setImgUrls(data)\n      })\n        .catch(() => {\n          if (altImgRef.current) setBroken(true)\n        })\n    }\n  }, [photo])\n\n  // If nothing works then show a broken image component\n  const finalURl = dataUrl || (imgUrls && imgUrls[altIndex])\n\n  return (\n    <React.Fragment>\n      {(!dataUrl && (!imgUrls || broken)) && (\n        <BrokenImg className={className} loading={!broken} {...props} />\n      )}\n      <div ref={altImgRef} style={{ height: 0, width: 0 }} />\n      {finalURl && (\n        <img\n          ref={imgRef}\n          className={classNames(className, broken ? classes.imgBroken : classes.img)}\n          alt={sizePriority[altIndex]}\n          style={{\n            ...style,\n            objectFit: cover ? 'cover' : 'contain'\n          }}\n          onError={() => {\n            if (!dataUrl && imgUrls[altIndex + 1]) {\n              console.error('RawImage::Setting Alternate image', altIndex)\n              // Now that uploading works properly retries are dead\n              setAltIndex(altIndex + 1)\n            }\n            else {\n              setBroken(true)\n            }\n          }}\n          // onLoad={onLoad}\n          src={finalURl}\n          {...props}\n        />\n      )}\n    </React.Fragment>\n  )\n}\n\nRawImage.propTypes = {\n  className: PropTypes.string,\n  sizePriority: PropTypes.arrayOf(PropTypes.string),\n  imgRef: PropTypes.any,\n  getPhotoUrls: PropTypes.func,\n  cover: PropTypes.bool,\n  dataUrl: PropTypes.string,\n  // onLoad: PropTypes.func,\n  photo: PropTypes.object,\n  style: PropTypes.object\n}\n\nexport default RawImage\n","import React, { useState, useRef, useContext, useLayoutEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport useComponentSize from '../../../../lib/useComponentSize'\n\nimport { SeriesContext } from '../../contexts'\nimport XYTagChip from '../tags/XYTagChip'\nimport useXYTags from '../tags/useXYTags'\nimport RawImage from './RawImage'\nimport style from './Photo.style'\n\nconst useStyles = makeStyles(style)\n\nconst Photo = ({ photo, opacity, edit, showTags, dataUrl, transition, onChange, className }) => {\n  const classes = useStyles()\n  const refImgWrap = useRef()\n  const imgRef = useRef()\n  const [newSize, setNewSize] = useState({ multiplier: 1 })\n  const { seriesConfig } = useContext(SeriesContext)\n\n  const { size: { height, width }, setResizeActive } = useComponentSize(refImgWrap)\n\n  // All tag-related info is put in its own hook\n  const { onAddTagTrigger, TagChooser, getRelXYTags, onTagDragOver, onTagDragStop, onTagDelete } = useXYTags(photo, { height, width }, onChange, setResizeActive)\n\n  const handleNewSize = () => {\n    console.log('handleImageLoaded')\n    const { naturalHeight, naturalWidth } = imgRef.current\n    // 4 different cases of orientation:\n    const multiplier = Math.min(\n      height / naturalHeight,\n      width / naturalWidth\n    )\n\n    const newWidth = multiplier * naturalWidth\n    const newHeight = multiplier * naturalHeight\n    setNewSize({ newWidth, newHeight, naturalWidth, naturalHeight, multiplier })\n  }\n  useLayoutEffect(() => {\n    if (imgRef.current) handleNewSize()\n  }, [width, height])\n\n  return (\n    <div className={classNames(classes.root, className)}\n      style={{ opacity: opacity !== null ? opacity : 1 }}\n      ref={refImgWrap}\n    >\n      <div className={classes.inner}\n        style={{\n          height: newSize ? newSize.newHeight : 1,\n          width: newSize ? newSize.newWidth : 1\n        }}\n        onClick={onAddTagTrigger}\n      >\n        { showTags || edit\n          ? (\n            <div className={className}>\n              { getRelXYTags(newSize.multiplier).map((tag, idx) => (\n                <XYTagChip\n                  key={`xytag-${idx}`}\n                  color={tag.color}\n                  {...{ edit, newSize, tag, onTagDragOver, onTagDragStop, onTagDelete }} />\n              ))}\n            </div>\n          ) : null\n        }\n        <RawImage\n          className={classes.rawImage}\n          sizePriority={['large', 'medium', 'thumb']}\n          photo={photo}\n          imgRef={imgRef}\n          dataUrl={dataUrl}\n          getPhotoUrls={seriesConfig.getPhotoUrls}\n          style={{ height: newSize.newHeight, width: newSize.newWidth }}\n        />\n\n      </div>\n      {edit && <TagChooser />}\n    </div>\n  )\n}\n\nPhoto.propTypes = {\n  className: PropTypes.string,\n  opacity: PropTypes.number,\n  photo: PropTypes.object.isRequired,\n  dataUrl: PropTypes.string,\n  edit: PropTypes.bool,\n  showTags: PropTypes.bool,\n  transition: PropTypes.string,\n  onChange: PropTypes.func\n}\n\nexport default Photo\n","// import { fade } from '@material-ui/core/styles/colorManipulator'\nexport default theme => ({\n  root: {\n    // maxWidth: 400,\n    display: 'block',\n    position: 'relative',\n    width: '100%',\n    height: '100%',\n    background: 'black',\n    overflow: 'hidden'\n  },\n  inner: {\n    width: '100%',\n    height: '100%'\n    // position: 'absolute',\n    // top: '50%',\n    // left: '50%',\n    // transform: 'translateY(-50%) translateX(-50%)'\n    // // overflow: 'hidden'\n  },\n  xyTags: {\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    // opacity: 0.8,\n    // border: '4px solid red',\n    height: '100%',\n    width: '100%'\n    // background: 'rgba(150, 150, 150, 0.5)'\n  },\n  img: {\n    display: 'block'\n  },\n  brokenImg: {\n    display: 'none'\n  },\n  formControl: {\n    width: '100%'\n  }\n})\n","import React, { useState } from 'react'\nimport PropTypes from 'prop-types'\n\nimport MobileStepper from '@material-ui/core/MobileStepper'\nimport IconButton from '@material-ui/core/IconButton'\nimport GridListTileBar from '@material-ui/core/GridListTileBar'\nimport Badge from '@material-ui/core/Badge'\n\nimport LabelIcon from '@material-ui/icons/Label'\n// import RemoveRedEye from '@material-ui/icons/RemoveRedEye'\nimport KeyboardArrowLeft from '@material-ui/icons/KeyboardArrowLeft'\nimport KeyboardArrowRight from '@material-ui/icons/KeyboardArrowRight'\n\nimport SwipeableViews from 'react-swipeable-views'\nimport Photo from './Photo'\nimport { formatDate } from '../../../../lib/datelib'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport style from './SwipeShow.style'\n\nconst useStyles = makeStyles(style)\n\nconst SwipeShow = ({ photos, initialPhoto, onImageSelect }) => {\n  const classes = useStyles()\n  const theme = useTheme()\n  const initPhotoIndex = initialPhoto ? photos.findIndex(p => p.id === initialPhoto) || 0 : 0\n  const [activePhoto, setActivePhoto] = useState(initPhotoIndex >= 0 ? initPhotoIndex : 0)\n  const [showTags, setShowTags] = useState(false)\n  const singular = photos.length < 2\n\n  const sortedPhotos = [...photos]\n  sortedPhotos.sort((a, b) => parseInt(b.takenOn, 10) - parseInt(a.takenOn, 10))\n\n  const handleForward = () => setActivePhoto(activePhoto >= sortedPhotos.length ? 0 : activePhoto + 1)\n  const handleBack = () => setActivePhoto(activePhoto <= 0 ? sortedPhotos.length - 1 : activePhoto - 1)\n\n  return (\n    <div className={classes.root}>\n      <div className={classes.inner}>\n        <SwipeableViews\n          axis={theme.direction === 'rtl' ? 'x-reverse' : 'x'}\n          index={activePhoto}\n          onChangeIndex={(val) => setActivePhoto(val)}\n          enableMouseEvents\n        >\n          {sortedPhotos.map((photo, idx) => (\n            <div className={classes.photoWrapper} key={`swipeshowpic-${idx}`} onClick={() => onImageSelect(sortedPhotos[activePhoto].id)}>\n              <Photo photo={photo} className={classes.photo} showTags={showTags} />\n            </div>\n          ))}\n        </SwipeableViews>\n        <IconButton size='small' className={classes.manualBack} onClick={handleBack} color='inherit' disabled={activePhoto === 0}>\n          {theme.direction === 'rtl' ? <KeyboardArrowRight /> : <KeyboardArrowLeft />}\n        </IconButton>\n        <IconButton size='small' className={classes.manualForward} onClick={handleForward} color='inherit' disabled={activePhoto === photos.length - 1}>\n          {theme.direction === 'rtl' ? <KeyboardArrowLeft /> : <KeyboardArrowRight />}\n        </IconButton>\n        <GridListTileBar\n          title={singular ? 'Photo' : `Photo (${activePhoto + 1}/${sortedPhotos.length})`}\n          subtitle={sortedPhotos.length > 0 && (\n            <span>{formatDate(sortedPhotos[activePhoto].takenOn)}</span>\n          )}\n          actionIcon={\n            <React.Fragment>\n              <IconButton className={classes.tagButton} onClick={() => setShowTags(!showTags)}>\n                <Badge color={showTags ? 'primary' : 'secondary'} badgeContent={sortedPhotos[activePhoto].tags ? sortedPhotos[activePhoto].tags.filter(tag => tag.coords).length : null}>\n                  <LabelIcon />\n                </Badge>\n              </IconButton>\n            </React.Fragment>\n          }\n        />\n      </div>\n      {!singular &&\n      <MobileStepper\n        steps={sortedPhotos.length}\n        position='static'\n        activeStep={activePhoto}\n        classes={{\n          root: classes.mobileStepper,\n          dots: classes.dots\n        }}\n      />\n      }\n    </div>\n  )\n}\n\nSwipeShow.propTypes = {\n  // This is just the basic shape of the photo object\n  initialPhoto: PropTypes.string,\n  photos: PropTypes.arrayOf(PropTypes.shape({\n    img: PropTypes.string,\n    tags: PropTypes.array,\n    date: PropTypes.date\n  })),\n  transition: PropTypes.number,\n  onImageSelect: PropTypes.func.isRequired\n}\n\nSwipeShow.defaultProps = {\n  transition: 5000,\n  isFullScreen: false,\n  slides: []\n}\n\nexport default SwipeShow\n","export default theme => ({\n  root: {\n    position: 'relative'\n  },\n  inner: {\n    position: 'relative'\n  },\n  photoWrapper: {\n    minHeight: 250,\n    height: 250\n  },\n  dateCaption: {\n    padding: theme.spacing(1),\n    background: theme.palette.primary.dark,\n    color: theme.palette.primary.contrastText,\n    textAlign: 'center'\n  },\n  mobileStepper: {\n    // position: 'absolute',\n    // bottom: theme.spacing(1),\n    // right: theme.spacing(1)\n  },\n  manualBack: {\n    color: 'white',\n    zIndex: 10,\n    position: 'absolute',\n    transform: 'translateY(-50%)',\n    left: 0,\n    top: '50%'\n  },\n  manualForward: {\n    color: 'white',\n    zIndex: 10,\n    position: 'absolute',\n    transform: 'translateY(-50%)',\n    right: 0,\n    top: '50%'\n  },\n  tagButton: {\n    color: 'rgba(255, 255, 255, 0.54)'\n  },\n  slideshowButton: {\n    color: 'rgba(255, 255, 255, 0.54)'\n  },\n  dots: {\n    margin: '0 auto'\n  }\n})\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport Button from '@material-ui/core/Button'\nimport Typography from '@material-ui/core/Typography'\nimport DialogActions from '@material-ui/core/DialogActions'\n\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst style = theme => ({\n\n})\nconst useStyles = makeStyles(style)\n\nconst DeleteDialog = ({ title, message, onConfirm, open }) => {\n  const classes = useStyles()\n  return (\n    <Dialog\n      className={classes.root}\n      disableBackdropClick\n      open={open}\n      disableEscapeKeyDown\n      fullWidth\n      maxWidth='xl'\n      aria-labelledby='confirmation-dialog-title'\n    >\n      <DialogTitle id='confirmation-dialog-title'>{title}</DialogTitle>\n      <DialogContent>\n        <Typography>\n          {message}\n        </Typography>\n\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => onConfirm(false)} color='primary'>\n      No\n        </Button>\n        <Button onClick={() => onConfirm(true)} color='primary'>\n      Yes\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nDeleteDialog.propTypes = {\n  open: PropTypes.bool,\n  title: PropTypes.string.isRequired,\n  message: PropTypes.string.isRequired,\n  onConfirm: PropTypes.func.isRequired\n}\n\nexport default DeleteDialog\n","import React, { useState, useContext, useEffect } from 'react'\nimport classNames from 'classnames'\nimport PropTypes from 'prop-types'\n\nimport GridList from '@material-ui/core/GridList'\nimport GridListTile from '@material-ui/core/GridListTile'\nimport GridListTileBar from '@material-ui/core/GridListTileBar'\nimport Snackbar from '@material-ui/core/Snackbar'\nimport Button from '@material-ui/core/Button'\nimport Fab from '@material-ui/core/Fab'\n\nimport AddIcon from '@material-ui/icons/Add'\nimport RemoveIcon from '@material-ui/icons/Remove'\n\nimport { SeriesContext } from '../../contexts'\nimport RawImage from './RawImage'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport style from './PhotoGrid.style'\nimport DeleteDialog from '../dialogs/DeleteDialog'\nimport { formatDate } from '../../../../lib/datelib'\n\nconst useStyles = makeStyles(style)\n\nconst PhotoGrid = ({ photos, columns, multiSelect, onDelete, onTileClick }) => {\n  const [selectMode, setSelectMode] = useState(false)\n  const classes = useStyles()\n  const [selectedItems, setSelectedItems] = useState([])\n  const [urls, setUrls] = useState({})\n  const [deleteConfirm, setDeleteConfirm] = useState(false)\n\n  const { seriesConfig, ac } = useContext(SeriesContext)\n\n  const handleAddToSelection = (e, id) => {\n    e.preventDefault()\n    e.stopPropagation()\n\n    setSelectMode(true)\n    toggleListItem(id)\n  }\n\n  const handleCancelSelection = () => {\n    setSelectMode(false)\n    setSelectedItems([])\n  }\n\n  const onDeleteConfirm = (confirmation) => {\n    setDeleteConfirm(false)\n    if (confirmation === true && selectedItems.length < photos.length) onDelete(selectedItems)\n    handleCancelSelection()\n  }\n\n  const toggleListItem = (id) => {\n    const index = selectedItems.indexOf(id)\n    if (index < 0) setSelectedItems([...selectedItems, id])\n    else {\n      const remaining = selectedItems.filter(arrId => arrId !== id)\n      if (remaining.length === 0) handleCancelSelection()\n      setSelectedItems(remaining)\n    }\n  }\n\n  useEffect(() => {\n    photos.forEach(async ph => {\n      setUrls({ ...urls, [ph.id]: await seriesConfig.getPhotoUrls(ph, 'thumb') })\n    })\n  }, [photos])\n\n  const handlePhotoTap = (e, photo) => {\n    e.preventDefault()\n    e.stopPropagation()\n    // Select / deselect the item in edit mode\n    if (selectMode) toggleListItem(photo.id)\n    // navigate if tileClick selected\n    else onTileClick(photo.id)\n  }\n\n  const sortedPhotos = [...photos]\n  sortedPhotos.sort((a, b) => parseInt(b.takenOn, 10) - parseInt(a.takenOn, 10))\n\n  return (\n    <div>\n      <GridList cols={columns} cellHeight={200} className={classes.root}>\n        {sortedPhotos.map((photo, idx) => {\n          const selected = selectedItems.indexOf(photo.id) > -1\n\n          const canDelete = ac.canUser('delete', photo, 'photo')\n\n          return (\n            <GridListTile\n              key={`gridTile${idx}`}\n              onClick={(e) => canDelete && handlePhotoTap(e, photo)}\n              className={classNames(\n                classes.tile,\n                selectMode && !canDelete && classes.notDeleteable,\n                selectMode && canDelete && !selected && classes.unSelectedTile,\n                selectMode && selected && classes.selectedTile\n              )}\n            >\n              <RawImage\n                photo={photo}\n                sizePriority={['medium', 'thumb', 'large']}\n                cover\n                getPhotoUrls={seriesConfig.getPhotoUrls}\n                className={classes.img}\n              />\n\n              {canDelete && multiSelect && (\n                <Fab size='small' aria-label='Add' className={classes.addFab} onClick={(e) => handleAddToSelection(e, photo.id)}>\n                  {!selectMode || !selected ? <AddIcon /> : <RemoveIcon />}\n                </Fab>\n              )}\n              <GridListTileBar\n                title={<span>{formatDate(photo.takenOn)}</span>}\n              />\n            </GridListTile>\n          )\n        })}\n      </GridList>\n      <Snackbar\n        open={selectMode}\n        autoHideDuration={null}\n        ContentProps={{\n          'aria-describedby': 'snackbar-fab-message-id',\n          className: classes.snackbarContent\n        }}\n        message={<span id='snackbar-fab-message-id'>\n          {selectedItems.length >= photos.length ? 'You can\\'t delete all the photos. delete the series instead.' : `${selectedItems.length} Photos selected`}\n        </span>}\n        action={<div>\n          <Button color='inherit' disabled={selectedItems.length >= photos.length} size='small' onClick={() => setDeleteConfirm(true)}>\n                Delete\n          </Button>\n          <Button color='inherit' size='small' onClick={() => handleCancelSelection()}>\n                Cancel\n          </Button>\n        </div>\n        }\n        className={classes.snackbar}\n      />\n\n      <DeleteDialog\n        open={deleteConfirm}\n        onConfirm={onDeleteConfirm}\n        title={`Delete ${selectedItems.length} Photos`}\n        message='Are you sure you want to delete these photos?'\n      />\n    </div>\n\n  )\n}\n\nPhotoGrid.propTypes = {\n  photos: PropTypes.array.isRequired,\n  columns: PropTypes.number,\n\n  multiSelect: PropTypes.bool,\n  onDelete: PropTypes.func,\n  onTileClick: PropTypes.func.isRequired\n}\nPhotoGrid.defaultProps = {\n  multiSelect: true,\n  columns: 2\n}\n\nexport default PhotoGrid\n","import { red } from '@material-ui/core/colors'\nexport default theme => ({\n  root: {\n\n  },\n  tile: {\n\n  },\n  addFab: {\n    position: 'absolute',\n    zIndex: 10,\n    top: theme.spacing(1),\n    left: theme.spacing(1),\n    opacity: 0.3\n  },\n  notDeleteable: {\n    background: theme.palette.primary.dark,\n    opacity: 0.1\n    // '& img': {\n    // }\n  },\n  unSelectedTile: {\n    '& img': {\n      opacity: 0.7\n    }\n  },\n  selectedTile: {\n    padding: `${theme.spacing(2)}px!important`,\n    '& img': {\n      opacity: 1\n    }\n  },\n  img: {\n\n  },\n  snackbarContent: {\n    backgroundColor: red[700]\n  },\n  snackbar: {\n  }\n})\n","export default theme => ({\n  root: {\n    display: 'flex',\n    height: '100%',\n    flexDirection: 'column',\n    overflow: 'hidden'\n  },\n  appBar: {\n    flexGrow: 0\n  },\n  inner: {\n    position: 'relative',\n    flexGrow: 1,\n    overflowY: 'scroll',\n    '-webkit-overflow-scrolling': 'touch'\n  },\n  tabMenu: {\n    marginTop: theme.spacing(7)\n  },\n  mapWrap: {\n    position: 'absolute',\n    height: '100%',\n    width: '100%',\n    top: 0,\n    left: 0\n  },\n  toolbarTitle: {\n    flexGrow: 1,\n    textOverflow: 'ellipsis',\n    whiteSpace: 'nowrap',\n    overflow: 'hidden'\n  },\n  AddFab: {\n    position: 'absolute',\n    bottom: theme.spacing(2),\n    right: theme.spacing(2),\n    // left: '50%',\n    // transformOrigin: '0% 50%',\n    // transform: 'translateY(-25%) translateX(-50%)',\n    zIndex: 500\n  },\n  grow: {\n    flexGrow: 1\n  },\n  gridList: {\n    flexWrap: 'nowrap',\n    // Promote the list into his own layer on Chrome. This cost memory but helps keeping high FPS.\n    transform: 'translateZ(0)'\n  },\n  titleBar: {\n    display: 'flex',\n    padding: theme.spacing(1)\n  },\n  menuButton: {\n    // marginLeft: -12,\n    // marginRight: 20\n  },\n  placeholderInner: {\n    position: 'relative',\n    flexGrow: 1,\n    overflow: 'hidden',\n    textAlign: 'center',\n    display: 'flex',\n    height: '100%',\n    flexDirection: 'column'\n  },\n  progressWrapper: {\n    textAlign: 'center',\n    marginBottom: theme.spacing(4)\n  },\n  placeholderText: {\n    opacity: 0.4\n  },\n  placeholder: {\n\n  },\n  progress: {\n    color: theme.palette.grey[300]\n  }\n})\n","import React, { useState, useContext } from 'react'\nimport PropTypes from 'prop-types'\n\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport AppBar from '@material-ui/core/AppBar'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport IconButton from '@material-ui/core/IconButton'\nimport Typography from '@material-ui/core/Typography'\nimport Tabs from '@material-ui/core/Tabs'\nimport Tab from '@material-ui/core/Tab'\n\nimport ArrowBackIcon from '@material-ui/icons/ArrowBack'\n\nimport AddCameraIcon from '@material-ui/icons/AddAPhoto'\nimport MoreIcon from '@material-ui/icons/MoreVert'\n\nimport AddAlertIcon from '@material-ui/icons/AddAlert'\nimport SlideshowIcon from '@material-ui/icons/Slideshow'\nimport EditIcon from '@material-ui/icons/Edit'\n// import PhotoLibraryIcon from '@material-ui/icons/PhotoLibrary'\n// import CameraIcon from '@material-ui/icons/Camera'\nimport DeleteIcon from '@material-ui/icons/Delete'\nimport PlaceIcon from '@material-ui/icons/Place'\nimport QRDisplay from './QRDisplay'\nimport QRCodeIcon from '../../../icons/QRCode'\n\nimport { makeStyles } from '@material-ui/core/styles'\n\n// import MapDot from '../../maps/MapDot'\nimport AddFab from './controls/AddFab'\n\nimport ContextMenu from './controls/ContextMenu'\n\nimport SeriesInfo from './subViews/SeriesInfo'\nimport SwipeShow from './subViews/SwipeShow'\nimport PhotoGrid from './subViews/PhotoGrid'\n\nimport DeleteDialog from './dialogs/DeleteDialog'\n\nimport { SeriesContext } from '../contexts'\n\nimport style from './SeriesView.style'\nconst useStyles = makeStyles(style)\n\nconst SeriesView = ({\n  onSlideshowStart, onChange,\n  onEditSeries, onDeletePhotos, onCameraAdd,\n  onDeleteSeries, onLibraryAdd, onTileClick, onMenuBack,\n  onWatch, onUnWatch, initialPhoto, onFindOnMap,\n  watching, owned\n}) => {\n  const classes = useStyles()\n  const [contextEl, setContextEl] = useState()\n  const [showQR, setShowQR] = useState(false)\n  const [deleteConfirm, setDeleteConfirm] = useState(false)\n  const [listTypeTab, setListTypeTab] = useState(0)\n  const { series, ac, isIos } = useContext(SeriesContext)\n\n  const onDeleteConfirm = (confirmation) => {\n    setDeleteConfirm(false)\n    if (confirmation === true) onDeleteSeries(series.id)\n  }\n\n  const viewport = { zoom: 16 }\n  if (series && series.coords && series.coords.length === 2) {\n    viewport.longitude = series.coords[0]\n    viewport.latitude = series.coords[1]\n  }\n\n  const can = {\n    update: ac.canUser('update', series, 'series', '*'),\n    delete: ac.canUser('delete', series, 'series', '*'),\n    contribute: ac.canUser('update', series, 'series', ['photos'])\n  }\n  const dialogOpen = deleteConfirm || showQR\n\n  return (\n    <div className={classes.root}>\n      <CssBaseline />\n      <AppBar position='static' className={classes.appBar}>\n        <Toolbar disableGutters>\n          <IconButton className={classes.menuButton} color='inherit' onClick={onMenuBack} aria-label='Menu'>\n            <ArrowBackIcon />\n          </IconButton>\n          <Typography variant='subtitle1' color='inherit' className={classes.toolbarTitle}>\n            {series.name || 'Series'}\n          </Typography>\n\n          {/* <IconButton className={classes.menuButton} color='inherit' onClick={onSlideshowStart} aria-label='Menu'>\n            <SlideshowIcon />\n          </IconButton> */}\n          <IconButton\n            aria-haspopup='true'\n            color='inherit'\n            onClick={event => setContextEl(event.currentTarget)}\n          >\n            <MoreIcon />\n          </IconButton>\n\n          <ContextMenu anchorEl={contextEl} onClose={() => setContextEl(null)} menuItems={[\n            {\n              text: 'Find on map',\n              icon: PlaceIcon,\n              hide: !onFindOnMap,\n              action: onFindOnMap\n            },\n            {\n              text: 'Watch Series',\n              icon: AddAlertIcon,\n              hide: !onWatch || owned || watching,\n              action: onWatch\n            },\n            {\n              text: 'Unwatch Series',\n              icon: AddAlertIcon,\n              hide: !onUnWatch || owned || !watching,\n              action: onUnWatch\n            },\n            {\n              text: 'Series QR Code',\n              icon: QRCodeIcon,\n              action: () => setShowQR(true)\n            },\n            {\n              text: 'Start Slideshow',\n              icon: SlideshowIcon,\n              hide: !onSlideshowStart,\n              action: onSlideshowStart\n            },\n            { divider: true },\n            {\n              text: 'Edit Series',\n              icon: EditIcon,\n              hide: !onEditSeries || !can.update,\n              action: onEditSeries\n            },\n            {\n              text: 'Delete Series',\n              icon: DeleteIcon,\n              hide: !setDeleteConfirm || !can.delete,\n              color: 'error',\n              action: () => setDeleteConfirm(true)\n            }\n          ]} />\n        </Toolbar>\n        <Tabs variant='fullWidth'\n          value={listTypeTab}\n          onChange={(e, value) => setListTypeTab(value)}\n        >\n          <Tab label='Series' />\n          {/* <Tab label='Map' /> */}\n          <Tab label='Photos' />\n        </Tabs>\n      </AppBar>\n\n      <div className={classes.inner}>\n        {listTypeTab === 0 && (\n          <React.Fragment>\n            {series.photos && series.photos.length > 0 && (\n              <SwipeShow\n                photos={series.photos}\n                initialPhoto={initialPhoto}\n                onImageSelect={onTileClick}\n              />\n            )}\n            <SeriesInfo onChange={onChange} />\n          </React.Fragment>\n        )}\n        {series.photos && listTypeTab === 1 && (\n          <PhotoGrid\n            photos={series.photos}\n            onTileClick={onTileClick}\n            onDelete={onDeletePhotos}\n          />\n        )}\n      </div>\n\n      {/* {listTypeTab === 1 && (\n        <MapDot\n          showMe\n          longitude={series.longitude}\n          latitude={series.latitude}\n          viewport={viewport}\n          direction={series.direction}\n        />\n      )} */}\n\n      {listTypeTab === 0 && can.contribute && (\n        <AddFab\n          isIos={isIos}\n          className={classes.AddFab}\n          disabled={!dialogOpen}\n          onCameraClick={onCameraAdd}\n          onLibraryClick={onLibraryAdd}\n        >\n          <AddCameraIcon />\n        </AddFab>\n      )}\n      <QRDisplay open={showQR} onClose={() => setShowQR(false)} />\n      <DeleteDialog\n        open={deleteConfirm}\n        onConfirm={onDeleteConfirm}\n        title='Delete Series'\n        message='Are you sure you want to delete this series? The record and all images associated with it will be gone forever.'\n      />\n    </div>\n  )\n}\n\nSeriesView.propTypes = {\n  initialPhoto: PropTypes.string,\n  watching: PropTypes.bool,\n  owned: PropTypes.bool,\n  // Action functions\n  onSlideshowStart: PropTypes.func.isRequired,\n  onChange: PropTypes.func.isRequired,\n  onFindOnMap: PropTypes.func.isRequired,\n  onDeletePhotos: PropTypes.func.isRequired,\n  onDeleteSeries: PropTypes.func.isRequired,\n  onCameraAdd: PropTypes.func.isRequired,\n  onEditSeries: PropTypes.func.isRequired,\n  onLibraryAdd: PropTypes.func.isRequired,\n  onTileClick: PropTypes.func.isRequired,\n  onMenuBack: PropTypes.func.isRequired,\n  onWatch: PropTypes.func,\n  onUnWatch: PropTypes.func\n}\n\nexport default SeriesView\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst style = theme => ({\n  root: {\n    width: 1,\n    height: 1,\n    zIndex: 1\n  },\n  svgDot: {\n    width: 20,\n    height: 20,\n    position: 'absolute',\n    top: '50%',\n    left: '50%',\n    textAlign: 'center',\n    transformOrigin: '50% 50%',\n    transform: 'translateY(-50%) translateX(-50%)'\n  },\n  svgAccuracyDot: {\n    position: 'absolute',\n    top: '50%',\n    left: '50%',\n    textAlign: 'center',\n    transformOrigin: '50% 50%',\n    transform: 'translateY(-50%) translateX(-50%)'\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst MyLocation = ({ position, projection }) => {\n  const classes = useStyles()\n  const accuracy = 20 // assume 20m to start\n  // metersPerPixel [12, 12, 12]\n  // pixelsPerMeter [0: 0.08029229250399847, 1: -0.08029229250399847, 2: 0.08029229250399847]\n  // console.log('POSITION', { position, projection })\n  const accHeight = projection.pixelsPerMeter[0] * (accuracy)\n  const accWidth = projection.pixelsPerMeter[1] * (accuracy)\n  return (\n    <div className={classes.root}>\n      {/* This is the accuracy radius */}\n      <svg\n        style={{ height: accHeight, width: accWidth }}\n        className={classes.svgAccuracyDot}\n        version='1.1'\n        viewBox='0, 0, 100, 100'\n      >\n        <circle cx='50' cy='50' r={49}\n          stroke='#8888FF'\n          fillOpacity='0.4'\n          strokeWidth='1'\n          fill='#AAAAFF'\n        />\n      </svg>\n      {/* This is the dot */}\n      <svg className={classes.svgDot} version='1.1' viewBox='0, 0, 10, 10'>\n        <circle cx='5' cy='5' r='4'\n          stroke='#FFFFFF'\n          strokeWidth='1'\n          fill='#4444FF'\n        />\n      </svg>\n    </div>\n  )\n}\n\nMyLocation.propTypes = {\n  position: PropTypes.object,\n  projection: PropTypes.object\n}\n\nexport default MyLocation\n","import React, { useState } from 'react'\nimport PropTypes from 'prop-types'\nimport SpeedDial from '@material-ui/lab/SpeedDial'\nimport SpeedDialAction from '@material-ui/lab/SpeedDialAction'\n// import MapLayersIcon from '@material-ui/icons/Layers'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\n\nconst style = theme => ({\n  root: {\n    zIndex: 10,\n    position: 'absolute'\n  },\n  speedDialFab: {\n    border: '2px solid',\n    background: theme.palette.text.primary,\n    color: theme.palette.primary.contrastText,\n    width: 40,\n    height: 40\n  },\n  speedDialAction: {\n    border: '2px solid',\n    background: theme.palette.primary.main,\n    color: theme.palette.primary.contrastText,\n    marginTop: 0,\n    marginBottom: 0\n  },\n  speedDialIcon: {\n    // border: '1px solid red'\n  },\n  speedDialLabel: {\n    background: 'black',\n    color: 'white'\n  },\n  actionsClosed: {\n    display: 'none'\n  }\n})\n\nconst useStyles = makeStyles(style)\n\nconst StyleButtons = ({ controlPadding, currStyle, mapStyles, setCurrStyle }) => {\n  const [open, setOpen] = useState(false)\n  const classes = useStyles()\n  const theme = useTheme()\n  const noEventSetOpen = (e, state) => {\n    console.log('noEventSetOpen', e, state)\n    e.preventDefault()\n    e.stopPropagation()\n    setOpen(state)\n  }\n\n  if (!mapStyles || !Array.isArray(mapStyles) || mapStyles.length < 2 || !mapStyles[currStyle]) return null\n\n  const currStyleObj = mapStyles[currStyle]\n  const ActiveIcon = currStyleObj.ActiveIcon\n\n  return (\n    <div className={classes.root} style={{\n      top: controlPadding.top ? controlPadding.top : theme.spacing(2),\n      right: controlPadding.right ? controlPadding.right : theme.spacing(2)\n    }}>\n      {mapStyles.length > 1 && (\n        <SpeedDial\n          ariaLabel='SpeedDial example'\n          className={classes.speedDial}\n          classes={{\n            fab: classes.speedDialFab,\n            actionsClosed: classes.actionsClosed\n          }}\n          icon={<ActiveIcon className={classes.icon} />}\n          // onBlur={(e) => noEventSetOpen(e, false)}\n          onClick={(e) => noEventSetOpen(e, !open)}\n          onClose={(e) => noEventSetOpen(e, false)}\n          // onFocus={(e) => noEventSetOpen(e, true)}\n          // onMouseEnter={(e) => noEventSetOpen(e, true)}\n          // onMouseLeave={(e) => noEventSetOpen(e, false)}\n          open={open}\n          direction='left'\n        >\n\n          {mapStyles.map(({ Icon, ActiveIcon, toolTip }, idx) => (\n            <SpeedDialAction\n              key={`stylebutton${idx}`}\n              // Bit of a hack here. This function isn't quite ready for primetime\n              icon={<Icon className={classes.speedDialIcon} />}\n              tooltipPlacement='bottom'\n              ButtonProps={{\n                classes: {\n                  root: classes.speedDialAction\n                }\n              }}\n              TooltipClasses={{\n                tooltip: classes.speedDialLabel\n              }}\n              tooltipTitle={toolTip}\n              tooltipOpen\n              onClick={() => {\n                setCurrStyle(idx)\n                setOpen(false)\n              }}\n            />\n          ))}\n\n        </SpeedDial>\n      ) }\n    </div>\n  )\n}\n\nStyleButtons.propTypes = {\n  // controlPadding: {top, right, bottom, left}\n  controlPadding: PropTypes.object,\n  currStyle: PropTypes.number,\n  mapStyles: PropTypes.array,\n  setCurrStyle: PropTypes.func\n}\nStyleButtons.defaultProps = {\n  controlPadding: {}\n}\n\nexport default StyleButtons\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport Fab from '@material-ui/core/Fab'\nimport MyLocationIcon from '@material-ui/icons/MyLocation'\n\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\n\nconst style = theme => ({\n  root: {\n    border: '1px solid',\n    background: theme.palette.grey[100],\n    color: 'black',\n    width: 40,\n    height: 40,\n    zIndex: 10,\n    position: 'absolute'\n    // margin: theme.spacing(0.5),\n    // padding: theme.spacing(0.5),\n    // border: '2px solid',\n    // borderRadius: theme.spacing(1),\n    // background: theme.palette.common.white,\n    // fontSize: 20,\n    // position: 'absolute',\n    // bottom: theme.spacing(10),\n    // right: theme.spacing(2)\n  }\n})\n\nconst useStyles = makeStyles(style)\n\nconst MyLocationButton = ({ onClick, controlPadding, disabled }) => {\n  const classes = useStyles()\n  const theme = useTheme()\n  return (\n    <Fab\n      disabled={disabled}\n      style={{\n        top: 56 + (controlPadding.top ? controlPadding.top : theme.spacing(2)),\n        right: controlPadding.right ? controlPadding.right : theme.spacing(2)\n      }}\n      aria-label='myLocation'\n      className={classes.root}\n      onClick={onClick}\n    >\n      <MyLocationIcon />\n    </Fab>\n  )\n}\n\nMyLocationButton.propTypes = {\n  controlPadding: PropTypes.object,\n  onClick: PropTypes.func.isRequired,\n  disabled: PropTypes.bool\n}\n\nexport default MyLocationButton\n","import React, { useState, useRef, useMemo, useEffect } from 'react'\nimport ReactMapGL, { NavigationControl, Marker, FlyToInterpolator } from 'react-map-gl'\nimport PropTypes from 'prop-types'\nimport { easeCubic } from 'd3-ease'\nimport WebMercatorViewport, { getDistanceScales } from 'viewport-mercator-project'\nimport useComponentSize from '../../lib/useComponentSize'\nimport MyLocation from './markers/MyLocation'\nimport { useGeolocation } from '../../lib/sensors'\n// import { debounce } from '../../lib/util'\nimport StyleButtons from './controls/StyleButtons'\nimport MyLocationButton from './controls/MyLocationButton'\nimport { mapConfig } from '../../config'\nimport classNames from 'classnames'\nimport 'mapbox-gl/dist/mapbox-gl.css'\nimport './BaseMap.css'\n\n/**\n * Note that this component technically has state but it is designed to be functionally stateless\n */\nconst BaseMap = (props) => {\n  // pull what we need out of the props\n  const {\n    showMe,\n    children,\n    mapStyles,\n    controlPadding,\n    viewport: initViewport,\n    bounds,\n    lockToBounds,\n    lockPan,\n    initStyle,\n    onViewportChange: incomingOnViewportChange,\n    onTransitionStart: incomingOnTransitionStart,\n    onTransitionEnd: incomingOnTransitionEnd,\n    transitions,\n    onMapDataEvent,\n    stylechooser,\n    ...passthroughProps\n  } = props\n\n  const mapContainerRef = useRef(null)\n  const mapBoxRef = useRef(null)\n  const innerTransitionsRef = useRef(null)\n\n  const { size } = useComponentSize(mapContainerRef)\n\n  const [currStyle, setCurrStyle] = useState(initStyle)\n\n  // This is the truth of the viewport!!\n  const [viewport, setViewport] = useState({ ...defaultViewVals, ...initViewport })\n  const [isTransitioning, setIsTransitioning] = useState(false)\n  const [projection, setProjection] = useState(null)\n\n  let myPosition = {}\n  myPosition = useGeolocation()\n\n  const geoMarker = (myPosition.latitude && myPosition.longitude)\n    ? (\n      <Marker\n        key='myPos'\n        className='myPosMarker'\n        captureDrag={false}\n        latitude={myPosition.latitude}\n        longitude={myPosition.longitude}\n        style={{ zIndex: 1 }}>\n        <MyLocation position={myPosition} projection={projection} />\n      </Marker>\n    ) : null\n\n  // Recalculate the projection if we need to but only when zoom changes\n  useMemo(() => {\n    if (!size || size.width < 10 || size.height < 10) return\n    if (mapStyles.length <= currStyle) setCurrStyle(initStyle)\n    try {\n      const projection = getDistanceScales(viewport)\n      // console.log('recalcProjection', { projection, size })\n      setProjection(projection)\n    }\n    catch (e) {\n      console.log('ERROR', viewport)\n      console.error(e)\n    }\n  }, [viewport.zoom, size])\n\n  const flyToMe = () => {\n    if (!myPosition.latitude || !myPosition.longitude) return\n    const transitionTime = 2000\n    innerTransitionsRef.current = {\n      transitionDuration: transitionTime,\n      transitionInterpolator: new FlyToInterpolator(),\n      transitionEasing: easeCubic\n    }\n    // You get `transitionTime` ms to figure this out. then we just jump\n    setTimeout(() => {\n      if (innerTransitionsRef.current) innerTransitionsRef.current = null\n    }, transitionTime)\n    setViewport({\n      ...viewport,\n      latitude: myPosition.latitude,\n      longitude: myPosition.longitude,\n      zoom: viewport.zoom > 10 ? viewport.zoom : 12\n    })\n  }\n\n  /**\n   * Callback fired when the user changes the viewport object\n   * @param {*} viewport\n   */\n  const onViewportChange = (viewportChange) => {\n    const newViewport = { ...viewportChange }\n    // Here we set/reset the bounds\n    if (bounds && lockToBounds) {\n      if (newViewport.longitude < bounds[0]) newViewport.longitude = bounds[0]\n      else if (newViewport.longitude > bounds[2]) newViewport.longitude = bounds[2]\n\n      if (newViewport.latitude < bounds[1]) newViewport.latitude = bounds[1]\n      else if (newViewport.latitude > bounds[3]) newViewport.latitude = bounds[3]\n    }\n    if (lockPan) {\n      newViewport.latitude = viewport.latitude\n      newViewport.longitude = viewport.longitude\n    }\n\n    // console.log('onViewportChange', newViewport)\n    // Fire the external callback so parent components can track viewport if they need to\n    if (!isTransitioning && typeof incomingOnViewportChange === 'function') {\n      incomingOnViewportChange({\n        viewport: newViewport,\n        size,\n        projection,\n        map: mapBoxRef.current && mapBoxRef.current.getMap()\n      })\n    }\n    setViewport(newViewport)\n  }\n\n  const recalcZoomBounds = () => {\n    // console.log('Should I recalc viewbounds?')\n    if (!bounds || !size || size.width < 10 || size.height < 10 || isTransitioning) return\n    // On the first run we're going to try to center the bounds.\n    const [minlng, minlat, maxlng, maxlat] = bounds\n    try {\n      // console.log('recalcZoomBounds')\n      const { longitude, latitude, zoom } = new WebMercatorViewport({ ...size, ...viewport }).fitBounds(\n        [ [minlng, minlat], [maxlng, maxlat] ],\n        { padding: 40, offset: [0, 0] }\n      )\n      // console.log('Changing Zoom ', bounds, viewport.zoom, zoom, viewport)\n\n      // console.log('recalcZoomBounds')\n      setViewport({ ...viewport, longitude, latitude, zoom })\n    }\n    catch (e) {\n      // Sometimes we don't have a valid bound. Don't make a big deal out of it.\n      console.error(e)\n    }\n  }\n\n  const handleTransitionStart = () => {\n    // console.log('handleTransitionStart (internal)')\n    setIsTransitioning(true)\n    if (typeof incomingOnTransitionStart === 'function') incomingOnTransitionStart()\n  }\n\n  const handleTransitionEnd = () => {\n    // console.log('handleTransitionEnd (internal)')\n    setIsTransitioning(false)\n    innerTransitionsRef.current = null\n    if (incomingOnTransitionEnd) incomingOnTransitionEnd()\n    if (typeof incomingOnViewportChange === 'function') {\n      incomingOnViewportChange({\n        viewport,\n        size,\n        projection,\n        map: mapBoxRef.current && mapBoxRef.current.getMap()\n      })\n    }\n  }\n\n  // RecalcZoombounds should only be done sparingly\n  useMemo(recalcZoomBounds, [size, bounds])\n\n  useEffect(() => {\n    setViewport({ ...viewport, ...initViewport })\n  }\n  , [initViewport])\n\n  return (\n    <div className={classNames('mapContainer', props.className)} ref={mapContainerRef}>\n      {size.height > 0 && size.width > 0 && (\n        <ReactMapGL\n          {...viewport}\n          {...(innerTransitionsRef.current || transitions)}\n          ref={map => {\n            mapBoxRef.current = map\n          }}\n          height={size.height}\n          width={size.width}\n          mapStyle={currStyle < mapStyles.length ? mapStyles[currStyle].style : mapStyles[0].style}\n          onData={onMapDataEvent}\n          onTransitionStart={handleTransitionStart}\n          onTransitionEnd={handleTransitionEnd}\n          dragPan={!lockPan}\n          onViewportChange={onViewportChange}\n          mapboxApiAccessToken={mapConfig.mapBoxToken}\n          {...passthroughProps}\n        >\n          {\n            children && Array.isArray(children)\n              ? children.map((c, idx) => c ? React.cloneElement(\n                handleChild(c, viewport, size.height, size.width, projection),\n                { key: `mapChild-${idx}` }\n              ) : null)\n              : handleChild(children, viewport, size.height, size.width, projection)\n          }\n          {/* Make sure the controls are above everything else */}\n          { stylechooser && (\n            <StyleButtons\n              controlPadding={controlPadding}\n              currStyle={currStyle}\n              mapStyles={mapStyles}\n              setCurrStyle={setCurrStyle}\n            />\n          )}\n          {/* Augment children with some props they need to survive in this harsh world */}\n          { !props.hideNavControls && (\n            <NavigationControl\n              onViewportChange={viewport => onViewportChange({ ...viewport, ...size })}\n              showZoom={!props.touchZoom === false && !props.scrollZoom === false}\n              showCompass={!props.touchRotate === false && !props.dragRotate === false}\n            />\n          )}\n          {showMe && !lockPan && (\n            <React.Fragment>\n              {geoMarker}\n              <MyLocationButton disabled={!myPosition || !myPosition.latitude} controlPadding={controlPadding} onClick={flyToMe} />\n            </React.Fragment>\n          )}\n        </ReactMapGL>\n      )}\n    </div>\n  )\n}\n\nBaseMap.propTypes = {\n  // Anything else we want to add to the map\n  children: PropTypes.any,\n  data: PropTypes.array,\n  // Maybe we want map controls to be padded\n  controlPadding: PropTypes.object,\n\n  showMe: PropTypes.bool,\n\n  // Separate transitions from viewport so we can set them independently\n  transitions: PropTypes.object,\n  initStyle: PropTypes.number,\n\n  // Some switches to make things easier\n  stylechooser: PropTypes.bool,\n  lockPan: PropTypes.bool,\n  lockRotation: PropTypes.bool,\n  lockZoom: PropTypes.bool,\n  lockToBounds: PropTypes.bool,\n  hideNavControls: PropTypes.bool,\n\n  // bounds of the map. may be locked or not [minlng, minlat], [maxlng, maxlat]\n  bounds: PropTypes.array,\n\n  // List of valid styles that will get picker buttons\n  mapStyles: PropTypes.array,\n\n  onMapDataEvent: PropTypes.func,\n  onViewportChange: PropTypes.func\n}\n\nBaseMap.defaultProps = {\n  controlPadding: {},\n  stylechooser: true,\n  initStyle: 0,\n  mapStyles: mapConfig.styles,\n  lockToBounds: false\n}\n\nexport default BaseMap\n\nconst defaultViewVals = {\n  latitude: 49.3050394,\n  longitude: -123.1398254,\n  bearing: 0,\n  pitch: 0,\n  zoom: 12\n}\n\nfunction handleChild (child, viewport, height, width, projection) {\n  return typeof child === 'function'\n    ? child(viewport, height, width, projection)\n    : child\n}\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst style = theme => ({\n  root: {\n    color: theme.palette.primary.main,\n    position: 'absolute',\n    top: '50%',\n    left: '50%',\n    textAlign: 'center',\n    transformOrigin: '50% 50%',\n    transform: 'translateY(-50%) translateX(-50%)',\n    zIndex: 1\n  },\n  rootActive: {\n    zIndex: 60\n  },\n  svgDot: {\n    zIndex: 61,\n    width: 20,\n    height: 20,\n    position: 'absolute',\n    top: '50%',\n    left: '50%',\n    textAlign: 'center',\n    transformOrigin: '50% 50%',\n    transform: 'translateY(-50%) translateX(-50%)'\n  },\n  dot: {\n    stroke: theme.palette.secondary.contrastText,\n    strokeWidth: '1',\n    fill: theme.palette.secondary.main\n  },\n  directionIndicator: {\n    position: 'absolute',\n    left: '50%',\n    // transformOrigin: '50% 50%',\n    // transform: 'translateY(-50%) translateX(-50%)',\n    zIndex: 59\n  },\n  name: {\n    color: 'white',\n    fontWeight: 'bold',\n    textShadow: `\n        0px 0px 4px #000000, \n        0px 0px 4px #000000 \n    `,\n    zIndex: 60,\n    position: 'relative'\n    // textStroke: '1px white'\n  },\n  nameActive: {\n    color: theme.palette.secondary.dark,\n    textShadow: `\n    0px 0px 2px #FFFFFF, \n    0px 0px 2px #FFFFFF,\n    0px 0px 4px #FFFFFF \n`\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst Single = ({ direction }) => {\n  const classes = useStyles()\n  return (\n    <div className={classes.root}>\n      <svg className={classes.svgDot} version='1.1' viewBox='0, 0, 10, 10' >\n        <circle cx='5' cy='5' r='4' className={classes.dot} />\n      </svg>\n      {direction && direction >= 0 ? (\n        <div className={classes.directionIndicator}>\n          <svg className={classes.svgArc}\n            version='1.1'\n            width='100'\n            height='100'\n            viewBox='0, 0, 100, 100'\n            style={{ transform: `translateY(-50%) translateX(-50%) rotateZ(${direction}deg)` }}>\n            <path d='M50,0 C60.946,0.151 72.136,3.514 80.675,10.56 L50,50 L19.325,10.56 C27.938,3.461 39,0.278 50,0 z'\n              fill='#009DC1'\n              fillOpacity='0.444'\n              strokeWidth='0.5'\n              strokeOpacity='0.6'\n              stroke='#FFFFFF'\n            />\n          </svg>\n        </div>\n      ) : null}\n    </div>\n  )\n}\n\nSingle.propTypes = {\n  direction: PropTypes.number\n}\n\nexport default Single\n","import React, { useState, useRef, useMemo } from 'react'\nimport { StaticMap } from 'react-map-gl'\nimport PropTypes from 'prop-types'\nimport { getDistanceScales } from 'viewport-mercator-project'\nimport useComponentSize from '../../lib/useComponentSize'\nimport StyleButtons from './controls/StyleButtons'\nimport { mapConfig } from '../../config'\nimport classNames from 'classnames'\nimport 'mapbox-gl/dist/mapbox-gl.css'\nimport './BaseMap.css'\n\n/**\n * Note that this component technically has state but it is designed to be functionally stateless\n */\nconst BaseStaticMap = (props) => {\n  const {\n    controlPadding,\n    viewport,\n    children,\n    mapStyles,\n    onMapDataEvent,\n    ...passthroughProps\n  } = props\n\n  const mapRef = useRef(null)\n  const mapBoxRef = useRef()\n  const { size } = useComponentSize(mapRef, { width: 100, height: 50 })\n\n  const [currStyle, setCurrStyle] = useState(0)\n  const [projection, setProjection] = useState(null)\n\n  const recalcProjection = () => {\n    if (!size || size.width < 10 || size.height < 10) return\n    try {\n      const projection = getDistanceScales(viewport)\n      // console.log('recalcProjection', { projection, size })\n      setProjection(projection)\n    }\n    catch (e) {\n      // Sometimes we don't have a valid bound. Don't make a big deal out of it.\n      console.error(e)\n    }\n  }\n\n  if (!projection) recalcProjection()\n  useMemo(recalcProjection, [size])\n\n  return (\n    <div className={classNames('BaseMap', props.className)} ref={mapRef} style={{ height: '100%', width: '100%' }}>\n      <StaticMap\n        {...viewport}\n        height={size.height}\n        width={size.width}\n        mapStyle={mapStyles[currStyle].style}\n        onData={onMapDataEvent}\n        mapboxApiAccessToken={mapConfig.mapBoxToken}\n        {...passthroughProps}\n        ref={map => {\n          mapBoxRef.current = map\n        }}\n      >\n        { mapStyles && mapStyles.length > 1 ? (\n          <StyleButtons\n            controlPadding={controlPadding}\n            currStyle={currStyle}\n            mapStyles={mapStyles}\n            setCurrStyle={setCurrStyle}\n          />\n        ) : null }\n        {\n          children && Array.isArray(children)\n            ? children.map(c => handleChild(c, mapBoxRef, size.height, size.width, projection))\n            : handleChild(children, mapBoxRef, size.height, size.width, projection)\n        }\n      </StaticMap>\n    </div>\n  )\n}\n\nfunction handleChild (child, mapBoxRef, height, width, projection) {\n  const viewport = {}\n  return typeof child === 'function'\n    ? child(viewport, height, width, projection)\n    : child\n}\n\nBaseStaticMap.propTypes = {\n  // Anything else we want to add to the map\n  children: PropTypes.any,\n  deckelements: PropTypes.array,\n  data: PropTypes.array,\n  // Maybe we want map controls to be padded\n  controlPadding: PropTypes.object,\n\n  minPitch: PropTypes.number,\n  maxPitch: PropTypes.number,\n  pitch: PropTypes.number,\n\n  // Lock the bounds of a map to a rectangle [minlng, minlat], [maxlng, maxlat]\n  bounds: PropTypes.array,\n  // Lock the possible zoom levels to a range: [minZoom, maxZoom]\n  zoomBounds: PropTypes.array,\n  // InitialBounds of the map.\n  InnerBounds: PropTypes.array,\n\n  // List of valid styles that will get picker buttons\n  mapStyles: PropTypes.array,\n\n  // Just some default props we probably won't set.\n  latitude: PropTypes.number,\n  longitude: PropTypes.number,\n  zoom: PropTypes.number,\n\n  onMapDataEvent: PropTypes.func\n}\nBaseStaticMap.defaultProps = {\n  controlPadding: {},\n  stylechooser: true,\n  // viewport: {\n  //   zoom: 12,\n  //   latitude: 49.3050394,\n  //   longitude: -123.1398254\n  // },\n  initStyle: 0,\n  mapStyles: mapConfig.styles\n}\n\nexport default BaseStaticMap\n","import React from 'react'\nimport PropTypes from 'prop-types'\n// import { makeStyles } from '@material-ui/core/styles'\nimport { Marker } from 'react-map-gl'\nimport BaseMap from './BaseMap'\nimport Dot from './markers/Dot'\nimport BaseStaticMap from './BaseStaticMap'\n// import style from './MapDot.style'\n\n// const useStyles = makeStyles(style)\n\nconst MapDot = ({ staticMap, editable, latitude, longitude, onChange, direction, ...props }) => {\n  const Map = staticMap ? BaseStaticMap : BaseMap\n  // const classes = useStyles()\n  const mapProps = staticMap ? {} : {\n    touchRotate: false,\n    dragRotate: false,\n    showMe: editable,\n    lockPan: !editable,\n    onViewportChange: onChange\n  }\n\n  return (\n    <Map\n      {...mapProps}\n      {...props}\n    >\n      {latitude && longitude ? (\n        <Marker\n          className={'singleMarker'}\n          latitude={latitude}\n          longitude={longitude}\n        >\n          <Dot direction={direction} />\n        </Marker>\n      )\n        : <Dot direction={direction} />\n      }\n\n    </Map>\n  )\n}\n\nMapDot.propTypes = {\n  direction: PropTypes.number,\n  latitude: PropTypes.number,\n  longitude: PropTypes.number,\n  editable: PropTypes.bool,\n  staticMap: PropTypes.bool,\n  onChange: PropTypes.func\n}\n\nexport default MapDot\n","import React, { useState, useMemo } from 'react'\nimport PropTypes from 'prop-types'\nimport Typography from '@material-ui/core/Typography'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport Button from '@material-ui/core/Button'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport FormLabel from '@material-ui/core/FormLabel'\nimport Slider from '@material-ui/lab/Slider'\n\nimport MapDot from '../../../maps/MapDot'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst style = theme => ({\n  root: {\n\n  },\n  dlgContent: {\n    display: 'flex',\n    flexDirection: 'column',\n    padding: 0\n  },\n  mapWrapper: {\n    flexGrow: 1\n  },\n  sliderWrapper: {\n    padding: '20px'\n  },\n  slider: {\n\n  },\n  sliderRoot: {\n\n  },\n  body: {\n    overflow: 'hidden',\n    whiteSpace: 'pre-line',\n    paddingBottom: theme.spacing(1)\n  },\n  title: {\n    background: theme.palette.primary.main,\n    color: theme.palette.primary.contrastText,\n    margin: 0,\n    padding: theme.spacing(2)\n  },\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500]\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst MapDirPicker = ({ open, onOk, onCancel, title, latitude: initLat, longitude: initLong, direction: initDir }) => {\n  const classes = useStyles()\n  const [{ longitude, latitude }, setCoords] = useState({ longitude: initLong, latitude: initLat })\n  const [direction, setRotation] = useState(initDir)\n\n  const initViewport = useMemo(() => ({\n    zoom: 18,\n    latitude: initLat,\n    longitude: initLong\n  }), [initLat, initLong])\n\n  const mapChange = ({ viewport: { longitude, latitude } }) => setCoords({ longitude, latitude })\n\n  return (\n    <Dialog\n      scroll='paper'\n      open={open}\n      fullWidth\n      fullScreen\n      onClose={onCancel}\n    >\n      <DialogTitle className={classes.title} disableTypography>\n        <Typography color='inherit'>{title}</Typography>\n      </DialogTitle>\n      <DialogContent className={classes.dlgContent}>\n        <div className={classes.mapWrapper}>\n          <MapDot\n            editable\n            className={classes.map}\n            direction={direction > 0 ? direction : null}\n            viewport={initViewport}\n            onChange={mapChange}\n          />\n        </div>\n        <div className={classes.sliderWrapper}>\n          <FormLabel className={classes.mapFormLabel}>Direction {direction > -1 ? '' : '(off)'}</FormLabel>\n          <Slider\n            classes={{\n              root: classes.sliderRoot\n            }}\n            value={direction || -1}\n            min={-1}\n            max={360}\n            step={1}\n            onChange={(e, value) => setRotation(value)}\n          />\n        </div>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={onCancel}>Cancel</Button>\n        <div style={{ flexGrow: 1 }} />\n        <Button onClick={() => onOk({ longitude, latitude, direction })}>Ok</Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nMapDirPicker.propTypes = {\n  open: PropTypes.bool,\n  latitude: PropTypes.number,\n  longitude: PropTypes.number,\n  direction: PropTypes.number,\n  onOk: PropTypes.func,\n  onCancel: PropTypes.func,\n  title: PropTypes.string\n}\n\nexport default MapDirPicker\n","import React, { useState } from 'react'\nimport PropTypes from 'prop-types'\n// import Typography from '@material-ui/core/Typography'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport TextField from '@material-ui/core/TextField'\nimport Button from '@material-ui/core/Button'\nimport DialogTitle from '@material-ui/core/DialogTitle'\n\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst style = theme => ({\n  root: {\n\n  },\n  body: {\n    // height: '100%',\n    // overflow: 'hidden'\n  },\n  textArea: {\n    whiteSpace: 'pre-line',\n    padding: theme.spacing(1),\n    border: `1px solid ${theme.palette.grey[200]}`,\n    background: theme.palette.grey[100]\n  },\n  dlgContent: {\n    overflow: 'hidden'\n  },\n  title: {\n    background: theme.palette.primary.main,\n    color: theme.palette.primary.contrastText,\n    alignSelf: 'flex-start',\n    width: '100%',\n    margin: 0,\n    display: 'flex',\n    padding: theme.spacing(2)\n  },\n  closeButton: {\n    padding: 0,\n    alignSelf: 'flex-start'\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst BigTextEdit = ({ open, onOk, title, body, multiline }) => {\n  const classes = useStyles()\n  const [value, setValue] = useState(body || '')\n  return (\n    <Dialog\n      scroll='paper'\n      open={open}\n      fullWidth\n      maxWidth='xl'\n      onClose={() => onOk(value)}\n    >\n      <DialogTitle className={classes.title}>\n        {title}\n      </DialogTitle>\n      <DialogContent className={classes.dlgContent}>\n        <TextField\n          className={classes.body}\n          multiline={multiline}\n          inputProps={{\n            className: classes.textArea\n          }}\n          autoFocus\n          fullWidth\n          rows={6}\n          rowsMax={6}\n          onChange={e => setValue(e.target.value)}\n          defaultValue={body}\n        />\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => onOk(body)}>Cancel</Button>\n        <div style={{ flexGrow: 1 }} />\n        <Button onClick={() => onOk(value)}>Ok</Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nBigTextEdit.propTypes = {\n  open: PropTypes.bool,\n  multiline: PropTypes.bool,\n  onOk: PropTypes.func,\n  title: PropTypes.string,\n  body: PropTypes.string\n}\n\nexport default BigTextEdit\n","\nimport React, { useState } from 'react'\nimport PropTypes from 'prop-types'\n\nimport TextField from '@material-ui/core/TextField'\nimport FormLabel from '@material-ui/core/FormLabel'\nimport Typography from '@material-ui/core/Typography'\nimport FormControlLabel from '@material-ui/core/FormControlLabel'\nimport Switch from '@material-ui/core/Switch'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport MapDot from '../../../maps/MapDot'\n\nimport MapDirPicker from '../dialogs/MapDirPicker'\nimport BigTextEdit from '../dialogs/BigTextEdit'\n\nimport style from './SeriesEditInner.style'\nimport { ACCESS } from '../../../../config'\nimport ShortLongText from '../controls/ShortLongText'\n\nconst DIALOGS = {\n  MAPPICK: 'mapPicker',\n  NOTEEDIT: 'noteEdit'\n}\n\nconst useStyles = makeStyles(style)\n\n/**\n * SeriesEdit appears in two places so we need this to be a bit reusable\n */\nconst SeriesEditInner = ({ series, delta, onChange }) => {\n  const classes = useStyles()\n  const [activeDialog, setActiveDialog] = useState(null)\n\n  const viewport = { zoom: 18 }\n  if ((delta.latitude || series.coords[1]) && (delta.longitude || series.coords[0])) {\n    viewport.longitude = delta.longitude || series.coords[0]\n    viewport.latitude = delta.latitude || series.coords[1]\n  }\n\n  const access = delta.access || series.access || 'PRIVATE'\n  // console.log('ACESS', access)\n  return (\n    <div>\n      <TextField\n        label='Series Name'\n        fullWidth\n        placeholder='New Series'\n        className={classes.field}\n        value={delta.name || series.name || ''}\n        onChange={e => onChange({ ...delta, name: e.target.value })}\n      />\n      <div className={classes.mapWrapper} onClick={() => setActiveDialog(DIALOGS.MAPPICK)}>\n        <FormLabel className={classes.mapFormLabel}>Location</FormLabel>\n        <div className={classes.mapInnerWrap}>\n          <MapDot\n            staticMap\n            className={classes.map}\n            direction={delta.direction || series.direction}\n            viewport={viewport}\n          />\n        </div>\n      </div>\n      <div className={classes.field}>\n        <FormLabel>Series Access</FormLabel>\n        <div className={classes.access}>\n          <FormControlLabel\n            className={classes.accessRadio}\n            control={\n              <Switch\n                checked={['OPEN', 'PUBLIC'].indexOf(access) > -1}\n                onChange={(e) => {\n                  onChange({ ...delta, access: e.target.checked ? 'PUBLIC' : 'PRIVATE' })\n                }}\n                value={'PUBLIC'}\n              />\n            }\n            label={<div>\n              <Typography variant='body2' component='div'>{ACCESS.PUBLIC.label}</Typography>\n              <Typography variant='caption' color='textSecondary' component='div'>{ACCESS.PUBLIC.description}</Typography>\n            </div>}\n\n          />\n          <FormControlLabel\n            className={classes.accessRadio}\n            disabled={['PRIVATE'].indexOf(access) > -1}\n            control={\n              <Switch\n                checked={['OPEN'].indexOf(access) > -1}\n                onChange={(e) => onChange({ ...delta, access: e.target.checked ? 'OPEN' : 'PUBLIC' })}\n                value={'OPEN'}\n              />\n            }\n            label={<div>\n              <Typography variant='body2' component='div'>{ACCESS.OPEN.label}</Typography>\n              <Typography variant='caption' color='textSecondary' component='div'>{ACCESS.OPEN.description}</Typography>\n            </div>}\n          />\n        </div>\n      </div>\n\n      <ShortLongText\n        onClick={() => setActiveDialog(DIALOGS.NOTEEDIT)}\n        className={classes.field}\n        label='Series Note'\n        text={delta.note || series.note}\n      />\n      {activeDialog === DIALOGS.MAPPICK && (\n        <MapDirPicker\n          open\n          title='Series Location & Direction'\n          latitude={delta.latitude || series.coords[1]}\n          longitude={delta.longitude || series.coords[0]}\n          direction={delta.direction || series.direction}\n          onOk={(data) => {\n            onChange({ ...delta, ...data })\n            setActiveDialog(null)\n          }}\n          onCancel={() => setActiveDialog(null)}\n        />\n      )}\n      {activeDialog === DIALOGS.NOTEEDIT && (\n        <BigTextEdit\n          open\n          title='Series Note'\n          body={delta.note || series.note}\n          multiline\n          onOk={(newNote) => {\n            onChange({ ...delta, note: newNote })\n            setActiveDialog(null)\n          }}\n          onCancel={() => setActiveDialog(null)}\n        />\n      )}\n    </div>\n  )\n}\n\nSeriesEditInner.propTypes = {\n  // now some functions\n  series: PropTypes.object.isRequired,\n  delta: PropTypes.object.isRequired,\n  onChange: PropTypes.func.isRequired\n}\n\nexport default SeriesEditInner\n","export default theme => ({\n  root: {\n\n  },\n  inner: {\n    display: 'flex',\n    flexDirection: 'column'\n    // padding: theme.spacing(1)\n  },\n  dlgTitle: {\n    background: theme.palette.primary.main,\n    color: theme.palette.primary.contrastText\n  },\n  access: {\n    display: 'flex',\n    flexDirection: 'column'\n  },\n  accessRadio: {\n    margin: theme.spacing(2, 1)\n    // flex: '1 1 50%'\n  },\n  grow: {\n    flexGrow: 1\n  },\n  field: {\n    flexGrow: 0,\n    marginBottom: theme.spacing(1) * 2\n  },\n  slider: {\n    paddingLeft: theme.spacing(1),\n    paddingRight: theme.spacing(1)\n  },\n  textField: {\n    marginLeft: theme.spacing(1),\n    marginRight: theme.spacing(1),\n    width: '100%'\n  },\n  formLabel: {\n    display: 'block',\n    marginTop: theme.spacing(1),\n    marginBottom: theme.spacing(1)\n  },\n  mapFormLabel: {\n    display: 'block',\n    marginTop: theme.spacing(1),\n    marginBottom: theme.spacing(1)\n  },\n  mapInnerWrap: {\n    flexGrow: 1,\n    height: '200px',\n    minHeight: '200px'\n  },\n  mapWrapper: {\n    flexGrow: 1,\n    display: 'flex',\n    flexDirection: 'column',\n    paddingBottom: theme.spacing(1) * 2\n  },\n  formControl: {\n    margin: theme.spacing(1),\n    minWidth: 120\n  },\n  chips: {\n    display: 'flex',\n    flexWrap: 'wrap'\n  }\n})\n","\nimport React, { useState, useContext } from 'react'\nimport PropTypes from 'prop-types'\n\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport Button from '@material-ui/core/Button'\nimport Typography from '@material-ui/core/Typography'\n\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport { SeriesContext } from '../contexts'\n\nimport style from './SeriesEdit.style'\nimport SeriesEditInner from './subViews/SeriesEditInner'\n\nconst useStyles = makeStyles(style)\n\nconst SeriesEdit = ({ onOk, onCancel }) => {\n  const classes = useStyles()\n  const { series } = useContext(SeriesContext)\n  const [delta, setDelta] = useState({})\n\n  return (\n    <Dialog\n      scroll='paper'\n      className={classes.root}\n      fullScreen\n      open\n      onClose={onCancel}\n    >\n      <CssBaseline />\n      <DialogTitle disableTypography className={classes.dlgTitle}>\n        <Typography variant='subtitle1' color='inherit' className={classes.grow}>\n           Edit Series Details\n        </Typography>\n      </DialogTitle>\n      <DialogContent className={classes.inner}>\n        <SeriesEditInner\n          series={series}\n          delta={delta}\n          onChange={setDelta}\n        />\n      </DialogContent>\n      <DialogActions>\n        <Button className={classes.menuButton} color='inherit' onClick={() => setDelta({})} aria-label='Menu'>\n            Reset\n        </Button>\n        <Button className={classes.menuButton} color='inherit' onClick={onCancel} aria-label='Menu'>\n            Cancel\n        </Button>\n        <Button className={classes.menuButton} color='inherit' onClick={() => onOk({ id: series.id, ...delta })} aria-label='Menu'>\n            Ok\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nSeriesEdit.propTypes = {\n  // now some functions\n  onOk: PropTypes.func.isRequired,\n  onCancel: PropTypes.func.isRequired\n}\n\nexport default SeriesEdit\n","export default theme => ({\n  root: {\n\n  },\n  inner: {\n    display: 'flex',\n    flexDirection: 'column'\n    // padding: theme.spacing(1)\n  },\n  dlgTitle: {\n    background: theme.palette.primary.main,\n    color: theme.palette.primary.contrastText\n  },\n  grow: {\n    flexGrow: 1\n  },\n  field: {\n    flexGrow: 0,\n    marginBottom: theme.spacing(2)\n  },\n  slider: {\n    paddingLeft: theme.spacing(1),\n    paddingRight: theme.spacing(1)\n  },\n  textField: {\n    marginLeft: theme.spacing(1),\n    marginRight: theme.spacing(1),\n    width: '100%'\n  },\n  formLabel: {\n    display: 'block',\n    marginTop: theme.spacing(1),\n    marginBottom: theme.spacing(1)\n  },\n  mapFormLabel: {\n    display: 'block',\n    marginTop: theme.spacing(1),\n    marginBottom: theme.spacing(1)\n  },\n  mapInnerWrap: {\n    flexGrow: 1\n  },\n  mapWrapper: {\n    flexGrow: 1,\n    display: 'flex',\n    flexDirection: 'column',\n    paddingBottom: theme.spacing(2)\n  },\n  formControl: {\n    margin: theme.spacing(1),\n    minWidth: 120\n  },\n  chips: {\n    display: 'flex',\n    flexWrap: 'wrap'\n  }\n})\n","import React, { useState, useEffect, useRef } from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\n\nimport Badge from '@material-ui/core/Badge'\nimport Typography from '@material-ui/core/Typography'\nimport IconButton from '@material-ui/core/IconButton'\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport GridListTile from '@material-ui/core/GridListTile'\nimport GridListTileBar from '@material-ui/core/GridListTileBar'\nimport MobileStepper from '@material-ui/core/MobileStepper'\nimport Button from '@material-ui/core/Button'\n\nimport ArrowBackIcon from '@material-ui/icons/ArrowBack'\nimport LabelIcon from '@material-ui/icons/Label'\nimport PauseIcon from '@material-ui/icons/PauseCircleFilled'\nimport PlayIcon from '@material-ui/icons/PlayCircleFilled'\nimport KeyboardArrowLeft from '@material-ui/icons/KeyboardArrowLeft'\nimport KeyboardArrowRight from '@material-ui/icons/KeyboardArrowRight'\n\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\n\nimport Photo from './subViews/Photo'\nimport { formatDate } from '../../../lib/datelib'\nimport useComponentSize from '../../../lib/useComponentSize'\n\nimport style from './Slideshow.style'\n\nconst useStyles = makeStyles(style)\n\nconst Slideshow = ({ onCancel, photos, transition }) => {\n  const classes = useStyles()\n  const theme = useTheme()\n  const { activeStep, lastStep, handleForward, handleBack, paused, pause, play } = useStepper(photos.length, transition)\n  const [showXYTags, setShowXYTags] = useState(false)\n\n  const refImgWrap = useRef(null)\n  const { size: { height, width } } = useComponentSize(refImgWrap)\n\n  return (\n    <div className={classes.root}>\n      <CssBaseline />\n      <div ref={refImgWrap} className={classes.slideContainer}>\n        {photos.map((slide, idx) => (\n          <GridListTile\n            key={`slide-${idx}`}\n            className={classNames(\n              classes.slide,\n              activeStep === idx && classes.active,\n              lastStep === idx && classes.last\n            )}\n            onClick={() => setShowXYTags(!showXYTags)}\n            style={{\n              height,\n              width,\n              transition: theme.transitions.create(['opacity'], { duration: 1 / 4 * transition })\n            }}\n          >\n            <Photo photo={slide} className={classes.photo} showTags={showXYTags} />\n            <Typography className={classes.labelBadge} >\n            Tags: {showXYTags ? 'On ' : 'Off '}\n              <Badge color='secondary' badgeContent={photos[activeStep].tags.filter(tag => tag.coords).length}>\n                <LabelIcon color='inherit' />\n              </Badge>\n            </Typography>\n\n            <GridListTileBar\n              className={classes.titleBar}\n              titlePosition='top'\n              title={(\n                <Typography color='inherit' variant='caption'>\n                  <IconButton className={classes.iconButton} onClick={(e) => onCancel()}>\n                    <ArrowBackIcon />\n                  </IconButton>\n                  {formatDate(slide.takenOn)}\n                </Typography>\n              )}\n              subtitle={<em>{paused ? 'Paused' : '    '}</em>}\n              actionIcon={paused ? (\n                <IconButton className={classes.iconButton} onClick={(e) => {\n                  e.preventDefault()\n                  e.stopPropagation()\n                  play()\n                }}>\n                  <PlayIcon />\n                </IconButton>\n              ) : (\n                <IconButton className={classes.iconButton} onClick={(e) => {\n                  e.preventDefault()\n                  e.stopPropagation()\n                  pause()\n                }}>\n                  <PauseIcon />\n                </IconButton>\n              )}\n            />\n          </GridListTile>\n        ))}\n        <IconButton size='small' className={classes.manualBack} onClick={handleBack} color='inherit'>\n          {theme.direction === 'rtl' ? <KeyboardArrowRight /> : <KeyboardArrowLeft />}\n        </IconButton>\n        <IconButton size='small' className={classes.manualForward} onClick={handleForward} color='inherit'>\n          {theme.direction === 'rtl' ? <KeyboardArrowLeft /> : <KeyboardArrowRight />}\n        </IconButton>\n      </div>\n\n      <MobileStepper\n        steps={photos.length}\n        position='static'\n        activeStep={activeStep}\n        classes={{\n          root: classes.mobileStepper,\n          dotActive: classes.dotActive\n        }}\n        nextButton={\n          <Button color='inherit' size='small' onClick={handleForward} disabled={activeStep === photos.length - 1}>\n            Next\n            {theme.direction === 'rtl' ? <KeyboardArrowLeft /> : <KeyboardArrowRight />}\n          </Button>\n        }\n        backButton={\n          <Button color='inherit' size='small' onClick={handleBack} disabled={activeStep === 0}>\n            {theme.direction === 'rtl' ? <KeyboardArrowRight /> : <KeyboardArrowLeft />}\n            Back\n          </Button>\n        }\n      />\n    </div>\n  )\n}\n\nSlideshow.propTypes = {\n  // We might want to go full screen\n  isFullScreen: PropTypes.bool,\n  // This is just the basic shape of the photo object\n  photos: PropTypes.array,\n  transition: PropTypes.number,\n  onCancel: PropTypes.func.isRequired\n}\n\nSlideshow.defaultProps = {\n  transition: 5000,\n  isFullScreen: false,\n  slides: []\n}\n\nexport default Slideshow\n\n/**\n * Custom React Hook for all our timer handling\n */\nconst useStepper = (num, interval) => {\n  const [activeStep, setActiveStep] = useState(0)\n  const [paused, setPaused] = useState(false)\n  const [lastStep, setLastStep] = useState(0)\n  const timerRef = useRef()\n\n  const handleForward = () => {\n    setLastStep(activeStep)\n    if (activeStep + 1 >= num) setActiveStep(0)\n    else setActiveStep(activeStep + 1)\n    if (!paused) {\n      destroyTimer()\n      createTimer()\n    }\n  }\n  const handleBack = () => {\n    setLastStep(activeStep)\n    if (activeStep - 1 < 0) setActiveStep(num - 1)\n    else setActiveStep(activeStep - 1)\n    if (!paused) {\n      destroyTimer()\n      createTimer()\n    }\n  }\n\n  const pause = () => {\n    destroyTimer()\n    setPaused(true)\n  }\n  const play = () => {\n    setPaused(false)\n    destroyTimer()\n    createTimer()\n  }\n\n  const createTimer = () => {\n    timerRef.current = window.setInterval(\n      // We need to use the alternate notation for the useState function\n      // because setInterval will only have access to the activeStep it was\n      // initialized with\n      () => setActiveStep(oldStep => {\n        setLastStep(oldStep)\n        return (oldStep + 1 >= num) ? 0 : oldStep + 1\n      })\n      , interval\n    )\n  }\n  const destroyTimer = () => {\n    if (timerRef.current) window.clearInterval(timerRef.current)\n  }\n\n  useEffect(() => {\n    createTimer()\n    return () => {\n      destroyTimer()\n    }\n  }, []) // Pass in empty array to run useEffect only on mount.\n\n  return { activeStep, lastStep, handleForward, handleBack, setActiveStep, paused, pause, play }\n}\n","export default theme => ({\n  root: {\n    // maxWidth: 400,\n    height: '100%',\n    display: 'flex',\n    flexDirection: 'column'\n  },\n  swipeAble: {\n    height: '100%'\n  },\n  slideContainer: {\n    flexGrow: 1\n  },\n  titleBar: {\n    padding: theme.spacing(0, 1),\n    height: '35px!important'\n  },\n  mobileStepper: {\n    flexGrow: 0,\n    background: theme.palette.grey[800],\n    color: theme.palette.getContrastText(theme.palette.grey[800])\n  },\n  slide: {\n    top: 0,\n    zIndex: 0,\n    opacity: 0,\n    position: 'absolute',\n    display: 'block',\n    overflow: 'hidden',\n    width: '100%',\n    height: '100%',\n    minHeight: 300\n  },\n  dotActive: {\n    background: 'white'\n  },\n  iconButton: {\n    color: 'white'\n  },\n  active: {\n    zIndex: 5,\n    opacity: 1\n  },\n  last: {\n    opacity: 1,\n    zIndex: 4\n  },\n  tagContainer: {\n\n  },\n  labelBadge: {\n    color: 'white',\n    zIndex: 10,\n    position: 'absolute',\n    right: theme.spacing(2),\n    bottom: theme.spacing(1),\n    opacity: 0.8\n  },\n  tagChip: {\n    // height: theme.spacing(3),\n    marginRight: theme.spacing(1),\n    fontSize: 10,\n    height: theme.spacing(2),\n    padding: theme.spacing(0.5)\n  },\n  xyTagChip: {\n    position: 'absolute',\n    fontSize: theme.spacing(1),\n    height: theme.spacing(2)\n  },\n  manualBack: {\n    color: 'white',\n    zIndex: 10,\n    position: 'absolute',\n    transform: 'translateY(-50%)',\n    left: 0,\n    top: '50%'\n  },\n  manualForward: {\n    color: 'white',\n    zIndex: 10,\n    position: 'absolute',\n    transform: 'translateY(-50%)',\n    right: 0,\n    top: '50%'\n  }\n})\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport Button from '@material-ui/core/Button'\nimport Typography from '@material-ui/core/Typography'\nimport DialogActions from '@material-ui/core/DialogActions'\n\n// import MenuIcon from '@material-ui/icons/MenuIcon'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst style = theme => ({\n\n})\n\nconst useStyles = makeStyles(style)\n\nconst CancelConfirm = ({ title, message, onConfirm, open }) => {\n  const classes = useStyles()\n  return (\n    <Dialog\n      className={classes.root}\n      disableBackdropClick\n      fullWidth\n      open={open}\n      disableEscapeKeyDown\n      maxWidth='xl'\n      aria-labelledby='confirmation-dialog-title'\n    >\n      <DialogTitle id='confirmation-dialog-title'>{title}</DialogTitle>\n      <DialogContent>\n        <Typography>\n          {message}\n        </Typography>\n\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => onConfirm(false)} color='primary'>\n      No\n        </Button>\n        <Button onClick={() => onConfirm(true)} color='secondary'>\n      Yes\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nCancelConfirm.propTypes = {\n  open: PropTypes.bool,\n  title: PropTypes.string.isRequired,\n  message: PropTypes.string.isRequired,\n  onConfirm: PropTypes.func.isRequired\n}\n\nexport default CancelConfirm\n","export default theme => ({\n  root: {\n    width: '100%'\n  },\n  tagContainer: {\n  },\n  formControl: {\n\n  },\n  actionButtons: {\n    textAlign: 'right'\n  },\n  noOptionsMessage: {\n    padding: theme.spacing(1, 2)\n  },\n  singleValue: {\n    fontSize: 16\n  },\n  placeholder: {\n    position: 'absolute',\n    left: 2,\n    fontSize: 16\n  },\n  input: {\n    display: 'flex',\n    padding: 0\n  },\n  valueContainer: {\n    display: 'flex',\n    flexWrap: 'wrap',\n    flex: 1,\n    alignItems: 'center',\n    overflow: 'hidden'\n  },\n  paper: {\n    position: 'absolute',\n    zIndex: 1,\n    marginTop: theme.spacing(1),\n    left: 0,\n    right: 0\n  }\n\n})\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\nimport Typography from '@material-ui/core/Typography'\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport TagChip from '../tags/TagChip'\nimport style from './TagControl.style'\n\nconst useStyles = makeStyles(style)\n/**\n * Just to be clear: the state here is being stored as []\n */\nconst TagControl = ({ tags, label, tagConfig, className }) => {\n  const classes = useStyles()\n  // Filter to just this tag type\n  const tagValues = tags.filter(tag => tag.typeId === tagConfig.id && !tag.coords)\n\n  return (\n    <div className={classNames(classes.root, className)}>\n      <Typography variant='overline' className={classes.fieldTitle}>\n        {tagConfig.label}\n      </Typography>\n      <div className={classes.tagContainer}>\n        {tagValues.map((tag, idx) => (\n          <TagChip tag={tag} key={`tagchip${idx}`} color={tagConfig.color} />\n        ))}\n      </div>\n\n    </div>\n  )\n}\n\nTagControl.propTypes = {\n  className: PropTypes.string,\n  label: PropTypes.string,\n  tags: PropTypes.array,\n  tagConfig: PropTypes.object\n}\n\nexport default TagControl\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\nimport {\n  TextField,\n  Typography\n} from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { timestampToHTML5Input, HTML5InputToTimestamp } from '../../../../lib/datelib'\n\nconst style = theme => ({\n  root: {\n  },\n  rootEdit: {\n  },\n  formControl: {\n    width: '100%'\n  },\n  textBody: {\n    whiteSpace: 'pre-line'\n  },\n  actionButtons: {\n    textAlign: 'right'\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst DateControl = ({\n  label,\n  value,\n  hint,\n  onChange,\n  className\n}) => {\n  const classes = useStyles()\n  return (\n    <div className={classNames(classes.root, className)}>\n      <Typography variant='overline' className={classes.fieldTitle}>\n        {label}\n      </Typography>\n      <TextField\n        type='datetime-local'\n        fullWidth\n        value={timestampToHTML5Input(value)}\n        className={classes.textField}\n        onChange={(e) => onChange(HTML5InputToTimestamp(e.target.value))}\n      />\n      {hint && <Typography variant='caption' className={classes.hint}>{hint}</Typography>}\n    </div>\n  )\n}\n\nDateControl.propTypes = {\n  className: PropTypes.string,\n  label: PropTypes.string.isRequired,\n  hint: PropTypes.string,\n  value: PropTypes.string, // all timestamps come in as integerstrings\n  onChange: PropTypes.func.isRequired\n}\n\nexport default DateControl\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\nimport Paper from '@material-ui/core/Paper'\nimport TextField from '@material-ui/core/TextField'\nimport Typography from '@material-ui/core/Typography'\nimport MenuItem from '@material-ui/core/MenuItem'\n\nimport Select from 'react-select'\nimport CreatableSelect from 'react-select/lib/Creatable'\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport TagChip from '../tags/TagChip'\nimport style from './TagControl.style'\nconst useStyles = makeStyles(style)\n\n/**\n * Just to be clear: the state here is being stored as []\n */\nconst TagControl = ({\n  tags, onChange,\n  hint, tagConfig, className\n}) => {\n  const classes = useStyles()\n  // console.log('TagControl Rnder', { tags, tagConfig })\n  const onSelectChange = (inputValue, { action, removedValue, option }) => {\n    // If this was the last tag then close the menu\n    switch (action) {\n      case 'clear':\n        onChange([])\n        break\n      case 'remove-value':\n        // Remember we need to potentially remove it from the old AND the new\n        onChange(tags.filter(val => val.id !== removedValue.value))\n        break\n      case 'select-option':\n        const newVal = {\n          ...tagConfig.values.find(tcv => tcv.id === option.value),\n          typeId: tagConfig.id\n        }\n        onChange([...tags, newVal])\n        break\n      case 'create-option':\n        const newLabel = inputValue.find(v => v.__isNew__).value\n        const newCreateVal = {\n          label: newLabel,\n          typeId: tagConfig.id\n        }\n        onChange([...tags, newCreateVal])\n        break\n      default:\n        break\n    }\n  }\n\n  const SingleValue = ({ removeProps, innerProps, data, ...props }) => {\n    // console.log('SingleValue PROPS', { removeProps, innerProps, data, props })\n    return (\n      <TagChip tag={data} onDelete={(e) => {\n        // console.log('EVENT', e)\n        removeProps.onClick()\n      }} color={tagConfig.color} edit />\n    )\n  }\n  SingleValue.propTypes = {\n    removeProps: PropTypes.any,\n    innerProps: PropTypes.any,\n    data: PropTypes.any\n  }\n\n  const MultiValue = ({ removeProps, innerProps, data, ...props }) => {\n    // console.log('MultiValue PROPS', { removeProps, innerProps, data, props })\n    return (\n      <TagChip tag={data} onDelete={(e) => {\n        // console.log('EVENT', e)\n        removeProps.onClick()\n      }} color={tagConfig.color} edit />\n    )\n  }\n  MultiValue.propTypes = {\n    removeProps: PropTypes.any,\n    innerProps: PropTypes.any,\n    data: PropTypes.any\n  }\n\n  // Filter to just this tag type\n  const tagValues = tags.filter(tag => tag.typeId === tagConfig.id && !tag.coords)\n  // Now format it as {label, value: id} for react-select\n  const selectOptions = tagValues.map(val => ({ label: val.label, value: val.id }))\n\n  // Filter out things we haven't chosen yet\n  // Also transform the options into a label/value pair for react-select\n  const remainingTags = tagConfig.values\n    .filter(val => tagValues.map(t => t.id).indexOf(val.id) === -1)\n    .map(val => ({ label: val.label, value: val.id }))\n\n  // console.log('TAG DEBUG', { value, tagValues, tagConfig })\n\n  return (\n    <div className={classNames(classes.root, className)}>\n      <Typography variant='overline' className={classes.fieldTitle}>\n        {tagConfig.label}\n      </Typography>\n      {!tagConfig.allowAdditions && (\n        <Select\n          options={remainingTags}\n          classes={classes}\n          isFocused\n          components={{\n            Control,\n            Menu,\n            //   MultiValue,\n            NoOptionsMessage,\n            Option,\n            Placeholder,\n            //   SingleValue,\n            ValueContainer\n          }}\n          deleteRemoves\n          value={selectOptions}\n          isClearable={false}\n          onChange={onSelectChange}\n          placeholder='Select Tags'\n          isMulti\n          isSearchable\n        />\n      ) }\n      { tagConfig.allowAdditions && (\n        <CreatableSelect\n          options={remainingTags}\n          classes={classes}\n          isFocused\n          deleteRemoves\n          components={{\n            Control,\n            Menu,\n            //   MultiValue,\n            NoOptionsMessage,\n            Option,\n            Placeholder,\n            //   SingleValue,\n            ValueContainer\n          }}\n          value={selectOptions}\n          isClearable={false}\n          onChange={onSelectChange}\n          placeholder='Select Tags'\n          isMulti\n          isSearchable\n        />\n      )}\n      {hint && <Typography variant='caption' className={classes.hint}>{hint}</Typography>}\n    </div>\n  )\n}\n\nTagControl.propTypes = {\n  className: PropTypes.string,\n  hint: PropTypes.string,\n  tags: PropTypes.array,\n  onChange: PropTypes.func.isRequired,\n  tagConfig: PropTypes.object\n}\n\nexport default TagControl\n\nfunction Control (props) {\n  // console.log('CONTROL PROPS', props)\n  return (\n    <TextField\n      fullWidth\n      InputProps={{\n        inputComponent,\n        inputProps: {\n          className: props.selectProps.classes.input,\n          inputRef: props.innerRef,\n          children: props.children,\n          // innerProps: {\n          onMouseDown: (e) => {\n            props.innerProps.onMouseDown(e)\n          },\n          onTouchEnd: (e) => {\n            props.innerProps.onTouchEnd(e)\n          }\n          // }\n          // ...props.innerProps\n        }\n      }}\n      {...props.selectProps.textFieldProps}\n    />\n  )\n}\n\nconst NoOptionsMessage = ({ innerProps, selectProps, children }) => (\n  <Typography\n    color='textSecondary'\n    className={selectProps.classes.noOptionsMessage}\n    {...innerProps}\n  >\n    {children}\n  </Typography>\n)\n\nconst Menu = ({ selectProps, innerProps, children }) => (\n  <Paper square className={selectProps.classes.paper} {...innerProps}>\n    {children}\n    {/* {console.log('MENU PROPS', { selectProps, innerProps, children })} */}\n  </Paper>\n)\n\nconst inputComponent = ({ inputRef, ...props }) => <div ref={inputRef} {...props} />\n\nconst Placeholder = (props) => (\n  <Typography\n    color='textSecondary'\n    className={props.selectProps.classes.placeholder}\n    {...props.innerProps}\n  >\n    {props.children}\n  </Typography>\n)\n\nconst Option = ({ innerRef, isFocused, isSelected, innerProps, children }) => (\n  <MenuItem\n    buttonRef={innerRef}\n    selected={isFocused}\n    component='div'\n    style={{ fontWeight: isSelected ? 500 : 400 }}\n    {...innerProps}\n  >\n    {children}\n  </MenuItem>\n)\n\nconst ValueContainer = ({ selectProps, children }) => (\n  <div className={selectProps.classes.valueContainer}>{children}</div>\n)\nValueContainer.propTypes = {\n  selectProps: PropTypes.any,\n  children: PropTypes.any\n}\n","import React, { useState } from 'react'\nimport PropTypes from 'prop-types'\n// import Typography from '@material-ui/core/Typography'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport Typography from '@material-ui/core/Typography'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport Button from '@material-ui/core/Button'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport IconButton from '@material-ui/core/IconButton'\n\nimport CloseIcon from '@material-ui/icons/Close'\nimport TagControl from '../controls/TagControl'\n\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst style = theme => ({\n  root: {\n  },\n  dlgContent: {\n    // position: 'relative',\n    // maxWidth: '200px',\n    overflowY: 'visible!important',\n    paddingBottom: 300\n    // overflowX: 'hidden'\n  },\n  title: {\n    width: '100%',\n    margin: 0,\n    display: 'flex',\n    padding: theme.spacing(2)\n  },\n  dlgTitle: {\n    flexGrow: 1\n  },\n  closeButton: {\n    color: theme.palette.grey[500]\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst TagEdit = ({ open, title, onOk, onCancel, tags, tagConfig }) => {\n  const classes = useStyles()\n  const [value, setValue] = useState(tags)\n  return (\n    <Dialog\n      className={classes.root}\n      scroll='body'\n      fullScreen\n      open={open}\n      onClose={() => onOk(value)}\n    >\n      <DialogTitle className={classes.title} disableTypography>\n        <Typography className={classes.dlgTitle}>{title}</Typography>\n        <IconButton className={classes.closeButton} onClick={onCancel}>\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent className={classes.dlgContent}>\n        <TagControl\n          className={classes.field}\n          tags={value}\n          tagConfig={tagConfig}\n          onChange={setValue}\n        />\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={onCancel}>Cancel</Button>\n        <div style={{ flexGrow: 1 }} />\n        <Button onClick={() => setValue(tags)}>Reset</Button>\n        <Button onClick={() => onOk(value)}>Ok</Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nTagEdit.propTypes = {\n  open: PropTypes.bool,\n  title: PropTypes.string,\n  onOk: PropTypes.func,\n  onCancel: PropTypes.func,\n  tags: PropTypes.array.isRequired,\n  tagConfig: PropTypes.object.isRequired\n}\n\nexport default TagEdit\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\nimport Typography from '@material-ui/core/Typography'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { formatDate } from '../../../../lib/datelib'\n\nconst style = theme => ({\n  root: { },\n  rootEdit: { },\n  formControl: {\n    width: '100%'\n  },\n  textBody: {\n    whiteSpace: 'pre-line'\n  },\n  actionButtons: {\n    textAlign: 'right'\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst DateView = ({\n  label,\n  value,\n  className\n}) => {\n  const classes = useStyles()\n  return (\n    <div className={classNames(classes.root, className)}>\n      <Typography variant='overline' className={classes.fieldTitle}>\n        {label}\n      </Typography>\n      <Typography variant='body1' className={classes.hint}>{value ? formatDate(value) : ''}</Typography>\n    </div>\n  )\n}\n\nDateView.propTypes = {\n  className: PropTypes.string,\n  label: PropTypes.string.isRequired,\n  value: PropTypes.string\n}\n\nexport default DateView\n","import React, { useContext, useState } from 'react'\nimport PropTypes from 'prop-types'\n\nimport Typography from '@material-ui/core/Typography'\nimport Divider from '@material-ui/core/Divider'\nimport List from '@material-ui/core/List'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemText from '@material-ui/core/ListItemText'\n\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport TagView from '../controls/TagView'\nimport ShortLongText from '../controls/ShortLongText'\nimport DateControl from '../controls/DateControl'\nimport UserListItem from '../controls/UserListItem'\nimport TagClass from '../../../../lib/Tags'\nimport BigTextEdit from '../dialogs/BigTextEdit'\nimport BigText from '../dialogs/BigText'\nimport TagEdit from '../dialogs/TagEdit'\n\nimport { SeriesContext } from '../../contexts'\nimport DateView from '../controls/DateView'\n\nconst style = theme => ({\n  root: {\n    height: '90%',\n    width: '85%'\n  },\n  dlgTitleContainer: {\n    display: 'flex',\n    padding: 0\n  },\n  catTagTitle: {\n    marginTop: theme.spacing(2)\n  },\n  dlgTitle: {\n    flexGrow: 1,\n    paddingTop: theme.spacing(2),\n    paddingBottom: theme.spacing(1),\n    paddingLeft: theme.spacing(3)\n  },\n  field: {\n    marginBottom: theme.spacing(2)\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst DIALOGS = {\n  NOTEEDIT: 'noteEdit',\n  NOTEVIEW: 'noteView',\n  PHOTOTAKEN: 'taken',\n  TAGEDIT: 'tag',\n  CANCEL: 'cancel'\n}\n\nconst PhotoInfo = ({ canEdit, photo, delta, onChange }) => {\n  const classes = useStyles()\n  const { seriesConfig } = useContext(SeriesContext)\n  const [{ activeDialog, activeDialogContext }, setActiveDialog] = useState({})\n\n  const tagInst = new TagClass(seriesConfig, delta.tags || photo.tags)\n\n  let metaKeys = []\n  try {\n    metaKeys = photo.meta ? Object.keys(JSON.parse(photo.meta)) : []\n  }\n  catch (e) {\n    console.error(e)\n  }\n  return (\n    <div>\n      {photo.createdUser && (\n        <React.Fragment>\n          <UserListItem\n            user={photo.createdUser}\n            onAvatarClick={() => seriesConfig.onAvatarClick(photo.createdUser.username)}\n            secondary='uploaded this photo'\n          />\n          <Divider />\n        </React.Fragment>\n      )}\n      {canEdit ? (\n        <DateControl\n          className={classes.field}\n          label='Photo taken on'\n          value={delta.takenOn || photo.takenOn}\n          onChange={takenOn => onChange({ takenOn })}\n          canEdit={canEdit}\n        />\n      )\n        : (\n          <DateView\n            label='Photo taken on'\n            value={delta.takenOn || photo.takenOn}\n          />\n        )}\n\n      {(canEdit || photo.note) && (\n        <ShortLongText\n          label='Photo Note'\n          text={delta.note || photo.note}\n          onClick={() => {\n            if (canEdit) setActiveDialog({ activeDialog: DIALOGS.NOTEEDIT })\n            else setActiveDialog({ activeDialog: DIALOGS.NOTEVIEW })\n          }}\n        />\n      )}\n      <Typography variant='subtitle1' className={classes.catTagTitle}>Category tags</Typography>\n      <Divider />\n      {tagInst.seriesConfig.getNonXYTagTypes().map((tt, idx) => (\n        <div\n          key={`tagtype-${idx}`}\n          onClick={() => canEdit ? setActiveDialog({ activeDialog: DIALOGS.TAGEDIT, activeDialogContext: tt }) : null}\n        >\n          <TagView\n            className={classes.field}\n            label={tt.label}\n            tags={delta.tags || photo.tags}\n            tagConfig={tt}\n          />\n        </div>\n      ))}\n\n      {metaKeys.length > 0 && Object.keys(seriesConfig.meta).length > 0 && (\n        <React.Fragment>\n          <Typography className={classes.heading}>Metadata</Typography>\n          <Divider />\n          <List className={classes.list}>\n            {metaKeys.map((key, idx) => seriesConfig.meta[key] ? (\n              <ListItem key={`metadata${idx}`}>\n                <ListItemText\n                  primary={seriesConfig.meta[key].label}\n                  secondary={seriesConfig.meta[key].render(photo.meta[key])}\n                />\n              </ListItem>\n            ) : null\n            )}\n          </List>\n        </React.Fragment>\n      )}\n      {activeDialog && activeDialog === DIALOGS.NOTEEDIT && (\n        <BigTextEdit\n          open\n          multiline\n          onOk={note => {\n            onChange({ note })\n            setActiveDialog({})\n          }}\n          title='Edit Photo Note'\n          body={delta.note || photo.note}\n        />\n      )}\n      {activeDialog && activeDialog === DIALOGS.NOTEVIEW && (\n        <BigText\n          open\n          multiline\n          onClose={() => setActiveDialog({})}\n          title='Photo Note'\n          body={delta.note || photo.note}\n        />\n      )}\n      {activeDialog && activeDialog === DIALOGS.TAGEDIT && (\n        <TagEdit\n          open\n          title={`Edit Tags: ${activeDialogContext.label}`}\n          onOk={tags => {\n            setActiveDialog({})\n            onChange({ tags })\n          }}\n          onCancel={() => setActiveDialog({})}\n          tags={delta.tags || photo.tags}\n          tagConfig={activeDialogContext}\n        />\n      )}\n    </div>\n  )\n}\n\nPhotoInfo.propTypes = {\n  canEdit: PropTypes.bool,\n  onChange: PropTypes.func.isRequired,\n  photo: PropTypes.object.isRequired,\n  delta: PropTypes.object.isRequired\n}\n\nexport default PhotoInfo\n","import React, { useState } from 'react'\nimport PropTypes from 'prop-types'\n\nimport Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport IconButton from '@material-ui/core/IconButton'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport Typography from '@material-ui/core/Typography'\nimport DialogActions from '@material-ui/core/DialogActions'\n\nimport CloseIcon from '@material-ui/icons/Close'\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport CancelConfirm from '../dialogs/CancelConfirm'\n\nimport PhotoInfoInner from './PhotoInfoInner'\n\nconst style = theme => ({\n  root: {\n    height: '90%',\n    width: '85%'\n  },\n  dlgTitleContainer: {\n    display: 'flex',\n    padding: 0\n  },\n  dlgTitle: {\n    flexGrow: 1,\n    paddingTop: theme.spacing(2),\n    paddingBottom: theme.spacing(1),\n    paddingLeft: theme.spacing(3)\n  },\n  field: {\n    marginBottom: theme.spacing(2)\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst DIALOGS = {\n  NOTEEDIT: 'noteEdit',\n  NOTEVIEW: 'noteView',\n  PHOTOTAKEN: 'taken',\n  TAGEDIT: 'tag',\n  CANCEL: 'cancel'\n}\n\nconst PhotoInfo = ({ canEdit, photo, onCancel, onOk, open }) => {\n  const classes = useStyles()\n  const [activeDialog, setActiveDialog] = useState(null)\n  const [delta, setDelta] = useState({})\n\n  const dirty = delta && Object.keys(delta).length > 0\n\n  return (\n    <Dialog\n      fullScreen\n      onClose={() => {\n        if (dirty) setActiveDialog(DIALOGS.CANCEL)\n        else onCancel()\n      }}\n      aria-labelledby='customized-dialog-title'\n      open={open}\n    >\n      <DialogTitle disableTypography className={classes.dlgTitleContainer}>\n        <Typography variant='h5' className={classes.dlgTitle}>\n          Photo Properties\n        </Typography>\n        <IconButton onClick={onCancel}>\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent>\n        <PhotoInfoInner\n          photo={photo}\n          delta={delta}\n          onChange={newDelta => setDelta({ ...delta, ...newDelta })}\n          canEdit={canEdit}\n        />\n      </DialogContent>\n\n      <DialogActions>\n        {!canEdit && (\n          <Button onClick={onCancel} color='primary'>\n            Ok\n          </Button>\n        )}\n        {canEdit && !dirty && (\n          <Button onClick={onCancel} color='primary'>\n            Back\n          </Button>\n        )}\n        {canEdit && dirty && (\n          <React.Fragment>\n            <Button onClick={() => setActiveDialog(DIALOGS.CANCEL)} color='primary'>\n              Cancel\n            </Button>\n            <Button onClick={() => setDelta({})} color='primary'>\n              Reset\n            </Button>\n            <Button onClick={() => onOk(delta)} color='primary'>\n              Ok\n            </Button>\n          </React.Fragment>\n        )}\n      </DialogActions>\n      {activeDialog && activeDialog === DIALOGS.CANCEL && (\n        <CancelConfirm\n          open\n          title='Lose unsaved changes?'\n          message='You will lose any changes you made to this form'\n          onConfirm={confirm => {\n            setActiveDialog(null)\n            if (confirm) onCancel()\n          }}\n        />\n      )}\n    </Dialog>\n  )\n}\n\nPhotoInfo.propTypes = {\n  canEdit: PropTypes.bool,\n  onCancel: PropTypes.func.isRequired,\n  onOk: PropTypes.func.isRequired,\n  open: PropTypes.bool,\n  photo: PropTypes.object.isRequired\n}\n\nexport default PhotoInfo\n","import React, { useState, useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\n\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport Button from '@material-ui/core/Button'\nimport MobileStepper from '@material-ui/core/MobileStepper'\nimport Typography from '@material-ui/core/Typography'\nimport AppBar from '@material-ui/core/AppBar'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport IconButton from '@material-ui/core/IconButton'\nimport Badge from '@material-ui/core/Badge'\nimport Chip from '@material-ui/core/Chip'\n\nimport ArrowBackIcon from '@material-ui/icons/ArrowBack'\nimport InfoIcon from '@material-ui/icons/Info'\nimport LabelIcon from '@material-ui/icons/Label'\n\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\n\nimport PhotoInfo from './subViews/PhotoInfo'\nimport Photo from './subViews/Photo'\n\nimport { formatDate } from '../../../lib/datelib'\nimport Tags from '../../../lib/Tags'\nimport SwipeableViews from 'react-swipeable-views'\nimport { SeriesContext } from '../contexts'\n\nimport style from './PhotoViewTool.style'\nconst useStyles = makeStyles(style)\n\nconst STATES = {\n  VIEWPIC: 0,\n  SHOWINFO: 1,\n  SHOWTAGS: 2,\n  EDITTAGS: 3,\n  FIRSTAGEDIT: 4\n}\n\nconst PhotoViewTool = ({ photos, initPhotoId, onMenuBack, onUpdatePhoto, newPhoto }) => {\n  const classes = useStyles()\n  const theme = useTheme()\n  const { series, seriesConfig, ac } = useContext(SeriesContext)\n  const sortedPhotos = [...photos]\n  sortedPhotos.sort((a, b) => parseInt(b.takenOn, 10) - parseInt(a.takenOn, 10))\n  const [activePhoto, setActivePhoto] = useState(initPhotoId ? sortedPhotos.findIndex(p => p.id === initPhotoId) : 0)\n  // This is a special copy of the photo so we can play around with the XY tags and undo\n  // if we need to\n  const photo = photos[activePhoto]\n  const [delta, setDelta] = useState(newPhoto ? photo : {})\n  const [mode, setMode] = useState({\n    current: newPhoto ? STATES.FIRSTAGEDIT : STATES.VIEWPIC,\n    last: null\n  })\n\n  const tagsClass = new Tags(seriesConfig, delta.tags || photo.tags)\n\n  const changeMode = (desired) => {\n    setMode({ current: desired, last: mode.current })\n  }\n\n  const onCommitTags = () => {\n    changeMode(STATES.SHOWTAGS)\n    onUpdatePhoto(photo, { id: photo.id, ...delta })\n  }\n\n  const onCommitTagsFirst = () => {\n    onUpdatePhoto(photo, { id: photo.id, ...delta })\n    onMenuBack()\n  }\n\n  const onCancelTagEdit = () => {\n    changeMode(STATES.SHOWTAGS)\n    setDelta(photo)\n  }\n\n  const photoClick = (e) => {\n    if (mode.current === STATES.VIEWPIC) {\n      e.preventDefault()\n      e.stopPropagation()\n      changeMode(STATES.SHOWINFO)\n    }\n  }\n\n  const can = {\n    update: ac.canUser('update', series, 'series') ||\n            ac.canUser('update', photo, 'photo')\n  }\n\n  return (\n    <div className={classes.root}>\n      <CssBaseline /> {/* You only need this in a root element. Don't put it anywhere else in the dom */}\n      <AppBar position='static' className={classNames(classes.appBar, mode.current !== STATES.VIEWPIC ? classes.appBarEdit : null)}>\n        <Toolbar disableGutters>\n          {mode.current !== STATES.FIRSTAGEDIT && (\n            <IconButton\n              className={classes.menuButton}\n              color='inherit'\n              aria-label='Menu'\n              onClick={() => onMenuBack()}\n            >\n              <ArrowBackIcon />\n            </IconButton>\n          )}\n          <div className={classes.grow}>\n            <Typography variant='subtitle2' color='inherit' >\n              {newPhoto ? 'Add Tags' : `Photo View (${activePhoto + 1}/${photos.length})`}\n            </Typography>\n            <Typography variant='subtitle2' color='inherit'>\n              {formatDate(photo.takenOn, 'lll')}\n            </Typography>\n          </div>\n\n          { mode.current === STATES.EDITTAGS &&\n          <Button color='inherit' onClick={onCancelTagEdit}>\n            Cancel\n          </Button>\n          }\n\n          { mode.current === STATES.EDITTAGS &&\n          <Button color='inherit' onClick={onCommitTags}>\n            Save\n          </Button>\n          }\n          { mode.current === STATES.FIRSTAGEDIT &&\n          <Button color='inherit' onClick={onCommitTagsFirst}>\n            Next\n          </Button>\n          }\n\n          { can.update && mode.current === STATES.SHOWTAGS &&\n          <Button color='inherit' onClick={() => changeMode(STATES.EDITTAGS)}>\n            Edit\n          </Button>\n          }\n\n          { (mode.current !== STATES.EDITTAGS && mode.current !== STATES.FIRSTAGEDIT) &&\n          <IconButton color='inherit'\n            className={classNames(classes.tagButton, mode.current === STATES.SHOWTAGS && classes.activeButton)}\n            onClick={() => changeMode(mode.current === STATES.SHOWTAGS ? STATES.VIEWPIC : STATES.SHOWTAGS)}\n          >\n            <Badge className={classes.margin} badgeContent={tagsClass.getXYTags().length} color='primary'>\n              <LabelIcon color='inherit' />\n            </Badge>\n          </IconButton>\n          }\n\n          { (mode.current !== STATES.EDITTAGS && mode.current !== STATES.FIRSTAGEDIT) &&\n          <IconButton color='inherit'\n            className={classNames(classes.infoButton, mode.current === STATES.SHOWINFO && classes.activeButton)}\n            onClick={() => changeMode(mode.current === STATES.SHOWINFO ? STATES.VIEWPIC : STATES.SHOWINFO)}\n          >\n            <InfoIcon />\n          </IconButton>\n          }\n\n        </Toolbar>\n      </AppBar>\n      <div className={classes.inner} onClick={photoClick}>\n        <SwipeableViews\n          axis={theme.direction === 'rtl' ? 'x-reverse' : 'x'}\n          index={activePhoto}\n          containerStyle={{ height: '100%' }}\n          style={{ height: '100%' }}\n          disabled={mode.current !== STATES.VIEWPIC}\n          onChangeIndex={(val) => setActivePhoto(val)}\n          enableMouseEvents\n        >\n          {sortedPhotos.map((photoidx, idx) => (\n            <div className={classes.photoWrapper} key={`swipeshowpic-${idx}`}>\n              <Photo\n                showTags={mode.current === STATES.SHOWTAGS}\n                photo={{ ...photoidx, ...delta }}\n                edit={can.update && (mode.current === STATES.EDITTAGS || mode.current === STATES.FIRSTAGEDIT)}\n                onChange={setDelta}\n                onCommitTags={onCommitTags}\n              />\n            </div>\n          ))}\n        </SwipeableViews>\n\n        {mode.current === STATES.VIEWPIC && (\n          <MobileStepper\n            steps={sortedPhotos.length}\n            position='bottom'\n            activeStep={activePhoto}\n            classes={{\n              root: classes.mobileStepper,\n              dots: classes.dots,\n              dot: classes.dot,\n              dotActive: classes.dotActive\n            }}\n          />\n        )}\n      </div>\n      <PhotoInfo\n        open={mode.current === STATES.SHOWINFO}\n        photo={photo}\n        canEdit={can.update}\n        onOk={(newDelta) => {\n          onUpdatePhoto(photo, { id: photo.id, ...newDelta })\n          changeMode(mode.last)\n        }}\n        onCancel={() => changeMode(mode.last)}\n      />\n      { (mode.current === STATES.EDITTAGS || mode.current === STATES.FIRSTAGEDIT) && (\n        <Chip\n          label='Tap to tag features...'\n          onClick={() => {}}\n          className={classes.tipChip}\n        />\n      )}\n    </div>\n  )\n}\n\nPhotoViewTool.propTypes = {\n  photos: PropTypes.array.isRequired,\n  initPhotoId: PropTypes.string,\n  newPhoto: PropTypes.bool,\n  // Now some action functions\n  onMenuBack: PropTypes.func.isRequired,\n  onUpdatePhoto: PropTypes.func.isRequired\n}\n\nexport default PhotoViewTool\n","export default theme => ({\n  root: {\n    display: 'flex',\n    height: '100%',\n    flexDirection: 'column',\n    overflow: 'hidden'\n  },\n  appBar: {\n    flexGrow: 0\n  },\n  appBarEdit: {\n    color: theme.palette.secondary.contrastText,\n    background: theme.palette.secondary.main\n  },\n  grow: {\n    flexGrow: 1\n  },\n  photoWrapper: {\n    height: '100%'\n  },\n  inner: {\n    flex: '1 1',\n    position: 'relative'\n  },\n  tabMenu: {\n    marginTop: theme.spacing(7)\n  },\n  tipChip: {\n    position: 'absolute',\n    zIndex: 11,\n    bottom: 20,\n    left: '50%',\n    opacity: 0.6,\n    transform: 'translateX(-50%)'\n  },\n  mobileStepper: {\n    background: 'none'\n  },\n  dots: {\n    margin: '0 auto'\n  },\n  dot: {\n    border: '1px solid #FFFFFF77'\n  },\n  dotActive: {\n    background: theme.palette.secondary.main\n  },\n  // tagButton: {\n  //   zIndex: 10,\n  //   color: 'white',\n  //   position: 'absolute',\n  //   fontSize: '2.5rem',\n  //   top: 10,\n  //   left: 10,\n  //   opacity: 0.8\n  // },\n  // infoButton: {\n  //   zIndex: 10,\n  //   color: 'white',\n  //   position: 'absolute',\n  //   top: 10,\n  //   right: 10,\n  //   opacity: 0.8\n  // },\n  activeButton: {\n    color: theme.palette.primary.main,\n    opacity: 1\n  }\n})\n","import React, { useState } from 'react'\nimport PropTypes from 'prop-types'\nimport Typography from '@material-ui/core/Typography'\nimport Slider from '@material-ui/lab/Slider'\n// import { Menu as MenuIcon } from '@material-ui/icons'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst style = theme => ({\n  root: {\n    color: 'white',\n    zIndex: 10,\n    display: 'flex',\n    flexDirection: 'column',\n    position: 'absolute',\n    height: '50%',\n    top: '45%',\n    left: '0',\n    transform: 'translateY(-50%)'\n  },\n  sliderLabel: {\n    display: 'block',\n    flexGrow: 1,\n    textAlign: 'center',\n    padding: theme.spacing(3, 0, 3, 0),\n    textShadow: '0 0 5px black, 0 0 5px black'\n  },\n  vertical: {\n    padding: '0px 31px!important',\n    width: '4px!important'\n  },\n  rail: {\n    width: `4px!important`,\n    background: theme.palette.primary.dark,\n    boxShadow: '0 0 10px 5px black'\n  },\n  track: {\n    width: `4px!important`,\n    background: theme.palette.primary.main\n  },\n  thumb: {\n    // transform: 'translate(50%, -50%)',\n    background: theme.palette.primary.main,\n    border: `1px solid ${theme.palette.primary.dark}`,\n    marginLeft: '-8px !important',\n    width: 20,\n    height: 20\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst PhotoFadeSlider = ({ defaultValue, onChange }) => {\n  const classes = useStyles()\n  // we control the state internally so we get a smooth experience\n  const [slider, setSlider] = useState(defaultValue)\n\n  const onSliderMove = (event, value) => {\n    setSlider(value)\n    // send it back if we need to\n    onChange(value)\n  }\n\n  return (\n    <div className={classes.root}>\n      <Typography className={classes.sliderLabel} color='inherit' variant='caption'>New</Typography>\n      <Slider\n        classes={{\n          vertical: classes.vertical,\n          rail: classes.rail,\n          track: classes.track,\n          thumb: classes.thumb\n        }}\n        value={slider}\n        aria-labelledby='label'\n        onChange={onSliderMove}\n        orientation='vertical'\n      />\n      <Typography className={classes.sliderLabel} color='inherit' variant='caption'>Reference</Typography>\n    </div>\n  )\n}\n\nPhotoFadeSlider.propTypes = {\n  defaultValue: PropTypes.number,\n  onChange: PropTypes.func\n}\n\nPhotoFadeSlider.defaultProps = {\n  defaultValue: 100,\n  onChange: () => {}\n}\n\nexport default PhotoFadeSlider\n","import React, { useState, useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\n\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport Snackbar from '@material-ui/core/Snackbar'\nimport Button from '@material-ui/core/Button'\nimport Fab from '@material-ui/core/Fab'\nimport SwipeableDrawer from '@material-ui/core/SwipeableDrawer'\n\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport RawImage from './subViews/RawImage'\nimport PhotoGrid from './subViews/PhotoGrid'\nimport PhotoFadeSlider from './controls/PhotoFadeSlider'\nimport style from './PhotoReviewTool.style'\n\nimport PhotoLibraryIcon from '@material-ui/icons/PhotoLibrary'\n\nimport { SeriesContext } from '../contexts'\nconst useStyles = makeStyles(style)\n\nconst PhotoReviewTool = ({\n  captured, defaultRefPhotoId,\n  onConfirm, onCancel, onRetry, dataUrl\n}) => {\n  const { series, seriesConfig } = useContext(SeriesContext)\n  const photos = series && series.photos ? series.photos : null\n  const classes = useStyles()\n\n  const newRefPhoto = defaultRefPhotoId\n    ? photos.find(p => p.id === defaultRefPhotoId)\n    : photos && photos.length > 0 ? photos[0] : null\n\n  const [refPhoto, setRefPhoto] = useState(newRefPhoto)\n  const [drawerOpen, setDrawerOpen] = useState(false)\n  const [slider, setSlider] = useState(100)\n\n  const handleTileClick = (id) => {\n    setRefPhoto(series.photos.find(p => p.id === id))\n    setDrawerOpen(false)\n  }\n\n  if (!captured) return 'Loading...'\n\n  return (\n    <div className={classes.root}>\n      <CssBaseline />\n      { Boolean(refPhoto) && (\n        <PhotoFadeSlider defaultValue={100} onChange={setSlider} />\n      )}\n\n      <div className={classes.captured}>\n        <RawImage\n          sizePriority={['large', 'medium', 'thumb']}\n          style={{ opacity: slider / 100 }}\n          dataUrl={dataUrl}\n          photo={captured}\n        />\n      </div>\n      { Boolean(refPhoto) && (\n        <div className={classes.reference} >\n          <RawImage\n            sizePriority={['large', 'medium', 'thumb']}\n            getPhotoUrls={seriesConfig.getPhotoUrls}\n            photo={refPhoto}\n          />\n        </div>\n      )}\n      <Snackbar\n        open\n        autoHideDuration={null}\n        ContentProps={{\n          'aria-describedby': 'snackbar-fab-message-id',\n          className: classes.snackbarContent\n        }}\n        message={<span id='snackbar-fab-message-id'>Keep this photo?</span>}\n        action={<div>\n          <Button color='inherit' size='small' onClick={onCancel}>\n                Cancel\n          </Button>\n          {Boolean(onRetry) && (\n            <Button color='inherit' size='small' onClick={onRetry}>\n          Retry\n            </Button>\n          )}\n\n          <Button color='inherit' size='small' onClick={onConfirm}>\n                Keep\n          </Button>\n        </div>\n        }\n        className={classes.snackbar}\n      />\n\n      {series && series.photos && (\n        <Fab\n          aria-label='library'\n          className={classNames(classes.libraryFab, classes.buttonFab)}\n          classes={{\n            disabled: classes.disabledFab\n          }}\n          disabled={!series || !series.photos || series.photos.length === 0}\n          onClick={() => setDrawerOpen(true)}\n        >\n          <PhotoLibraryIcon className={classes.libraryIcon} />\n        </Fab>\n      )}\n\n      {series && series.photos && (\n        <SwipeableDrawer\n          anchor='left'\n          open={drawerOpen}\n          classes={{\n            paperAnchorLeft: classes.swipeDrawer\n          }}\n          onClose={() => setDrawerOpen(false)}\n          onOpen={() => setDrawerOpen(true)}\n        >\n          <div\n            tabIndex={0}\n            className={classes.swipeDrawerContainer}\n            role='button'\n            onClick={() => setDrawerOpen(false)}\n            onKeyDown={() => setDrawerOpen(false)}\n          >\n            <PhotoGrid\n              multiSelect={false}\n              columns={1}\n              photos={series.photos}\n              onTileClick={handleTileClick}\n            />\n          </div>\n        </SwipeableDrawer>\n      )}\n    </div>\n  )\n}\n\nPhotoReviewTool.propTypes = {\n  defaultRefPhotoId: PropTypes.string,\n  captured: PropTypes.object,\n  dataUrl: PropTypes.string.isRequired,\n  // Now some functions\n  onConfirm: PropTypes.func.isRequired,\n  onCancel: PropTypes.func.isRequired,\n  onRetry: PropTypes.func // only for camera\n\n}\n\nexport default PhotoReviewTool\n","export default theme => ({\n  root: {\n    background: 'rgb(150,150, 150)',\n    // border: '5px solid red',\n    height: '100%',\n    width: '100%'\n  },\n  captured: {\n    zIndex: 3,\n    position: 'absolute',\n    height: '100%',\n    width: '100%'\n  },\n  reference: {\n    zIndex: 2,\n    position: 'absolute',\n    height: '100%',\n    width: '100%'\n  },\n  libraryFab: {\n    position: 'absolute',\n    zIndex: 10,\n    '@media (orientation: landscape)': {\n      left: '15px',\n      top: '15px',\n      height: '15vh',\n      width: '15vh'\n    },\n    '@media (orientation: portrait)': {\n      left: '15px',\n      top: '15px',\n      height: '15vw',\n      width: '15vw'\n    }\n  },\n\n  swipeDrawer: {\n    width: '50%'\n  },\n  referenceTextContainer: {\n    width: '100%',\n    display: 'flex',\n    color: 'white',\n    background: 'rgba(0,0,0,0.5)',\n    padding: theme.spacing(3),\n    position: 'absolute',\n    zIndex: 4,\n    top: 0\n  },\n  newText: {\n    flexGrow: 1,\n    color: 'white',\n    textShadow: '1 1 1 black',\n    textAlign: 'right'\n  },\n  refText: {\n    flexGrow: 1,\n    color: 'white',\n    textShadow: '1 1 1 black'\n  }\n})\n","import { useState, useEffect, useRef } from 'react'\n\nexport const useCamera = (onCapture, width, height) => {\n  const [cameraError, setCameraError] = useState(false)\n  const [cameraOnline, setCameraOnline] = useState(false)\n  const camRef = useRef()\n\n  useEffect(() => {\n    camRef.current = new Webcam(\n      document.getElementById('webcam'),\n      document.createElement('canvas')\n    )\n    camRef.current.setup(\n      height || window.innerWidth, // width\n      width || window.innerHeight // height\n    )\n      .then((data) => {\n        setCameraOnline(true)\n      })\n      .catch((e) => {\n        console.error(e)\n        setCameraError(true)\n      })\n  }, [])\n\n  useEffect(() => {\n    if (camRef.current) {\n      camRef.current.setup(width, height)\n        .then((data) => {\n          setCameraOnline(true)\n        })\n        .catch((e) => {\n          console.error(e)\n          setCameraError(true)\n        })\n    }\n  }, [width, height])\n\n  // Remember to destroy the camera object or the little light stays on\n  // and people get freaked out.\n  useEffect(() => () => {\n    if (camRef.current) {\n      camRef.current.destroy()\n      camRef.current = null\n    }\n  }, [])\n\n  const captureImage = () => {\n    if (camRef.current && cameraOnline) {\n      const capturedData = camRef.current.takeDataURLPhoto({ type: 'jpeg', quality: 1 })\n      onCapture({ ...capturedData, name: 'upload.jpg', ext: 'jpg' })\n    }\n  }\n\n  const captureRawData = () => {\n    if (camRef.current && cameraOnline) {\n      const capturedData = camRef.current.takeImageData()\n      onCapture(capturedData)\n    }\n  }\n\n  return { cameraError, captureImage, cameraOnline, captureRawData }\n}\n\nclass Webcam {\n  constructor (webcamElement, canvasElement) {\n    this.webcamElement = webcamElement\n    this.canvasElement = canvasElement\n\n    if (window.location.protocol !== 'https:' && window.location.hostname !== 'localhost') {\n      console.warn('getUserMedia() must be run from a secure origin: https or localhost.\\nChanging protocol to https.')\n    }\n\n    if (!navigator.mediaDevices && !navigator.getUserMedia) {\n      console.warn(`Your browser doesn't support navigator.mediaDevices.getUserMedia and navigator.getUserMedia.`)\n    }\n  }\n\n  adjustVideoSize (width, height) {\n    const aspectRatio = width / height\n    if (width >= height) {\n      this.webcamElement.width = aspectRatio * this.webcamElement.height\n    }\n    else if (width < height) {\n      this.webcamElement.height = this.webcamElement.width / aspectRatio\n    }\n  }\n\n  async destroy () {\n    try {\n      this.webcamElement.srcObject.getTracks()[0].stop()\n      // this.webcamElement = null\n      this.canvasElement = null\n    }\n    catch (e) {\n      console.error(e)\n    }\n  }\n\n  async setup (width, height) {\n    return new Promise((resolve, reject) => {\n      if (navigator.mediaDevices.getUserMedia !== undefined) {\n        if (this.webcamElement.srcObject) {\n          this.webcamElement.srcObject.getTracks()[0].stop()\n          this.webcamElement.srcObject = null\n        }\n        navigator.mediaDevices.getUserMedia({ audio: false, video: { facingMode: 'environment', width, height } })\n          .then((mediaStream) => {\n            if ('srcObject' in this.webcamElement) {\n              this.webcamElement.srcObject = mediaStream\n            }\n            else {\n              // For older browsers withouth the srcObject.\n              this.webcamElement.src = window.URL.createObjectURL(mediaStream)\n            }\n            this.webcamElement.onloadedmetadata = (e) => {\n              this.webcamElement.play()\n            }\n            this.webcamElement.onplaying = (e) => {\n              resolve()\n            }\n          })\n          .catch(err => reject(err))\n      }\n      else {\n        reject(new Error('Error accessing camera'))\n      }\n    })\n  }\n\n  _drawImage () {\n    const imageWidth = this.webcamElement.videoWidth\n    const imageHeight = this.webcamElement.videoHeight\n\n    const context = this.canvasElement.getContext('2d')\n    this.canvasElement.width = imageWidth\n    this.canvasElement.height = imageHeight\n\n    context.drawImage(this.webcamElement, 0, 0, imageWidth, imageHeight)\n\n    return { imageHeight, imageWidth }\n  }\n\n  takeImageData () {\n    const { imageHeight, imageWidth } = this._drawImage()\n    const data = { data: null, imageHeight, imageWidth }\n    try {\n      data.data = this.canvasElement\n        .getContext('2d')\n        .getImageData(\n          0,\n          0,\n          imageWidth,\n          imageHeight\n        ).data\n    }\n    catch (e) {}\n\n    return data\n  }\n\n  takeBlobPhoto () {\n    const { imageWidth, imageHeight } = this._drawImage()\n    return new Promise((resolve, reject) => {\n      this.canvasElement.toBlob((fileBlob) => {\n        resolve({ fileBlob, imageHeight, imageWidth })\n      })\n    })\n  }\n\n  takeDataURLPhoto ({ type, quality } = { type: 'jpeg', quality: 1 }) {\n    const { imageHeight, imageWidth } = this._drawImage()\n    const dataUrl = this.canvasElement.toDataURL('image/' + type, quality)\n    return { dataUrl, imageHeight, imageWidth, type: 'image/' + type }\n  }\n}\n","import React, { useState, useContext, useLayoutEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\n\nimport Fab from '@material-ui/core/Fab'\nimport SwipeableDrawer from '@material-ui/core/SwipeableDrawer'\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport Typography from '@material-ui/core/Typography'\n\nimport CameraIcon from '@material-ui/icons/Camera'\nimport CancelIcon from '@material-ui/icons/Cancel'\nimport PhotoLibraryIcon from '@material-ui/icons/PhotoLibrary'\n\nimport PhotoFadeSlider from './controls/PhotoFadeSlider'\nimport PhotoGrid from './subViews/PhotoGrid'\nimport RawImage from './subViews/RawImage'\n\nimport { SeriesContext } from '../contexts'\nimport { makeStyles } from '@material-ui/core/styles'\nimport style from './CameraTool.style'\nimport { useCamera } from '../../../lib/useCamera'\n\nconst useStyles = makeStyles(style)\n\n// https://googlechrome.github.io/samples/image-capture/grab-frame-take-photo.html\nconst CameraTool = ({ onCancel, onShutter, defaultRefPhotoId }) => {\n  const classes = useStyles()\n  const [slider, setSlider] = useState(50)\n  const [size, setSize] = useState([null, null])\n\n  const { series, seriesConfig } = useContext(SeriesContext)\n\n  const newRefPhoto = defaultRefPhotoId\n    ? series.photos.find(p => p.id === defaultRefPhotoId)\n    : series && series.photos && series.photos.length > 0 ? series.photos[0] : null\n\n  const [refPhoto, setRefPhoto] = useState(newRefPhoto)\n  const [drawerOpen, setDrawerOpen] = useState(false)\n  const { cameraError, captureImage, cameraOnline } = useCamera(\n    (data) => onShutter(data, refPhoto ? refPhoto.id : null),\n    size[0],\n    size[1]\n  )\n\n  const handleTileClick = (id) => {\n    setRefPhoto(series.photos.find(p => p.id === id))\n    setDrawerOpen(false)\n  }\n\n  const handleResize = () => {\n    setSize([window.innerWidth, window.innerHeight])\n  }\n\n  useLayoutEffect(() => {\n    handleResize()\n    window.addEventListener('resize', handleResize)\n    return () => {\n      window.removeEventListener('resize', handleResize)\n    }\n  }, [])\n\n  return (\n    <div className={classes.root}>\n      <CssBaseline />\n      { !cameraError && Boolean(refPhoto) && (\n        <PhotoFadeSlider defaultValue={slider} onChange={setSlider} />\n      )}\n\n      { cameraError && (\n        <div className={classes.cameraErrorText}>\n          <Typography variant='subtitle1' color='inherit'>No Camera Access</Typography>\n          <Typography variant='body2' color='inherit'>Please enabled access in your settings.</Typography>\n        </div>\n      )}\n\n      { Boolean(refPhoto) && (\n        <div className={classes.reference} >\n          <RawImage\n            sizePriority={['large', 'medium', 'thumb']}\n            getPhotoUrls={seriesConfig.getPhotoUrls}\n            style={{ opacity: slider / 100 }}\n            photo={refPhoto}\n          />\n        </div>\n      )}\n      { !cameraError && (\n        <video\n          autoPlay\n          playsInline\n          muted\n          id='webcam'\n          width={window.innerWidth}\n          height={window.innerHeight}\n          className={classes.video}\n        />\n      )}\n\n      <Fab\n        color='primary'\n        aria-label='Take Photo'\n        classes={{\n          disabled: classes.disabledFab\n        }}\n        disabled={cameraError || !cameraOnline}\n        className={classNames(classes.cameraFab, classes.buttonFab)}\n        onClick={captureImage}\n      >\n        <CameraIcon className={classes.cameraIcon} />\n      </Fab>\n\n      <Fab\n        color='secondary'\n        aria-label='cancel'\n        onClick={onCancel}\n        classes={{\n          disabled: classes.disabledFab\n        }}\n        className={classNames(classes.cancelFab, classes.buttonFab)}\n      >\n        <CancelIcon className={classes.cancelIcon} />\n      </Fab>\n\n      {series && series.photos && (\n        <Fab\n          aria-label='library'\n          className={classNames(classes.libraryFab, classes.buttonFab)}\n          classes={{\n            disabled: classes.disabledFab\n          }}\n          disabled={!series || !series.photos || series.photos.length === 0}\n          onClick={() => setDrawerOpen(true)}\n        >\n          <PhotoLibraryIcon className={classes.libraryIcon} />\n        </Fab>\n      )}\n\n      {series && series.photos && (\n        <SwipeableDrawer\n          anchor='left'\n          open={drawerOpen}\n          classes={{\n            paperAnchorLeft: classes.swipeDrawer\n          }}\n          onClose={() => setDrawerOpen(false)}\n          onOpen={() => setDrawerOpen(true)}\n        >\n          <div\n            tabIndex={0}\n            className={classes.swipeDrawerContainer}\n            role='button'\n            onClick={() => setDrawerOpen(false)}\n            onKeyDown={() => setDrawerOpen(false)}\n          >\n            <PhotoGrid\n              multiSelect={false}\n              columns={1}\n              photos={series.photos}\n              onTileClick={handleTileClick}\n            />\n          </div>\n        </SwipeableDrawer>\n      )}\n\n    </div>\n  )\n}\n\nCameraTool.propTypes = {\n  defaultRefPhotoId: PropTypes.string, // id of the reference photo\n  onCancel: PropTypes.func.isRequired,\n  onShutter: PropTypes.func.isRequired\n}\n\nexport default CameraTool\n","export default theme => ({\n  root: {\n    background: 'black',\n    // border: '5px solid red',\n    height: '100%',\n    width: '100%'\n  },\n  cameraErrorText: {\n    color: 'white',\n    position: 'absolute',\n    top: '50%',\n    left: '50%',\n    width: '90%',\n    transform: 'translateY(-50%) translateX(-50%)',\n    textAlign: 'center'\n  },\n  disabledFab: {\n    color: '#AAAAA!important',\n    background: '#DDDDDD!important',\n    opacity: 0.2\n  },\n  cameraFab: {\n    position: 'absolute',\n    zIndex: 10,\n    '@media (orientation: landscape)': {\n      right: '20px',\n      top: '50%',\n      transform: 'translateY(-50%)',\n      height: '25vh',\n      width: '25vh'\n    },\n    '@media (orientation: portrait)': {\n      bottom: '20px',\n      left: '50%',\n      transform: 'translateX(-50%)',\n      height: '25vw',\n      width: '25vw'\n    }\n  },\n  cameraIcon: {\n    height: '100%',\n    width: '100%'\n  },\n  cancelFab: {\n    position: 'absolute',\n    zIndex: 10,\n    '@media (orientation: landscape)': {\n      right: '15px',\n      top: '15px',\n      height: '15vh',\n      width: '15vh'\n    },\n    '@media (orientation: portrait)': {\n      right: '15px',\n      bottom: '15px',\n      height: '15vw',\n      width: '15vw'\n    }\n  },\n  cancelIcon: {\n    height: '100%',\n    width: '100%'\n  },\n\n  swipeDrawer: {\n    width: '50%'\n  },\n\n  libraryFab: {\n    position: 'absolute',\n    zIndex: 10,\n    '@media (orientation: landscape)': {\n      left: '15px',\n      top: '15px',\n      height: '15vh',\n      width: '15vh'\n    },\n    '@media (orientation: portrait)': {\n      left: '15px',\n      top: '15px',\n      height: '15vw',\n      width: '15vw'\n    }\n  },\n\n  myLocationFab: {\n    position: 'absolute',\n    zIndex: 10,\n    '@media (orientation: landscape)': {\n      right: '15px',\n      bottom: '15px',\n      height: '15vh',\n      width: '15vh'\n    },\n    '@media (orientation: portrait)': {\n      left: '15px',\n      bottom: '15px',\n      height: '15vw',\n      width: '15vw'\n    }\n  },\n  myLocationIcon: {\n    height: '80%',\n    width: '80%'\n  },\n\n  captured: {\n\n  },\n  reference: {\n    position: 'absolute',\n    zIndex: 2,\n    top: 0,\n    left: 0,\n    height: '100%',\n    width: '100%'\n  },\n  video: {\n    position: 'absolute',\n    zIndex: 1,\n    top: 0,\n    left: 0,\n    height: '100%',\n    width: '100%'\n    // '@media (orientation: portrait)': {\n    //   transform: 'rotate(90)'\n    // }\n  }\n})\n","import React, { useState } from 'react'\nimport PropTypes from 'prop-types'\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport Typography from '@material-ui/core/Typography'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport Button from '@material-ui/core/Button'\n\nimport SeriesEditInner from './subViews/SeriesEditInner'\n\n// import { SeriesContext } from '../contexts'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport style from './NewPhotoInfo.style'\nimport PhotoInfoInner from './subViews/PhotoInfoInner'\n\nconst useStyles = makeStyles(style)\n\nconst NewPhotoInfo = ({ photo, newSeries, onCancel, onSave }) => {\n  const classes = useStyles()\n  // const { series } = useContext(SeriesContext)\n  const [seriesDelta, setSeriesDelta] = useState(newSeries || {})\n  const [photoDelta, setPhotoDelta] = useState(photo)\n\n  return (\n    <div className={classes.root}>\n      <CssBaseline /> {/* You only need this in a root element. Don't put it anywhere else in the dom */}\n      <Dialog\n        fullScreen\n        scroll='paper'\n        disableBackdropClick\n        disableEscapeKeyDown\n        onClose={onCancel}\n        aria-labelledby='customized-dialog-title'\n        open\n      >\n        <DialogTitle disableTypography className={classes.dlgTitleContainer}>\n          <Typography variant='h5' className={classes.dlgTitle}>\n          New Photo Properties\n          </Typography>\n        </DialogTitle>\n        <DialogContent>\n\n          {!!newSeries && (\n            <SeriesEditInner\n              series={newSeries}\n              delta={seriesDelta}\n              onChange={setSeriesDelta}\n            />\n          )}\n\n          <PhotoInfoInner\n            photo={photo}\n            canEdit\n            delta={photoDelta}\n            onChange={(newAttr) => setPhotoDelta({ ...photoDelta, ...newAttr })}\n          />\n\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={onCancel} color='primary'>\n            Cancel\n          </Button>\n          <Button onClick={() => onSave(seriesDelta, photoDelta)} color='primary'>\n            Next\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </div>\n  )\n}\n\nNewPhotoInfo.propTypes = {\n  photo: PropTypes.object.isRequired,\n  newSeries: PropTypes.object,\n  // Standard functions\n  onCancel: PropTypes.func.isRequired,\n  onSave: PropTypes.func\n}\n\nexport default NewPhotoInfo\n","export default theme => ({\n  root: {\n\n  },\n  formLabel: {\n    color: theme.palette.text.secondary\n  },\n  mapFormLabel: {\n    marginTop: theme.spacing(2),\n    marginBottom: theme.spacing(1),\n    color: theme.palette.text.secondary\n  },\n  map: {\n    marginBottom: theme.spacing(2)\n  },\n  mapWrapper: {\n    marginBottom: theme.spacing(2)\n  },\n  field: {\n    marginBottom: theme.spacing(2)\n  }\n})\n","import React, { useEffect, useRef } from 'react'\n\n// https://developers.google.com/web/fundamentals/media/capturing-images/\nconst useFileInput = (onChange = () => {}, preferCamera, initialClick = true, anyFile = false) => {\n  const inputRef = useRef()\n  const clickRef = useRef()\n\n  const element = (\n    <input style={{ display: 'none' }} ref={inputRef} type='file' accept={!anyFile ? 'image/*' : null} capture={preferCamera} />\n  )\n\n  const forceClick = () => {\n    if (inputRef.current) inputRef.current.click()\n  }\n\n  useEffect(() => {\n    const handleChange = evt => {\n      const [file] = [...inputRef.current.files]\n      if (file) {\n        console.log('file', file)\n        const reader = new FileReader()\n        reader.onloadend = () => {\n          const { type, name, size } = file\n          onChange({ dataUrl: reader.result, type, name, size, ext: getExtFromFile(file) })\n        }\n        reader.readAsDataURL(file)\n      }\n      inputRef.current.value = null\n    }\n\n    if (inputRef.current) {\n      inputRef.current.addEventListener('change', handleChange)\n      if (!clickRef.current) {\n        if (initialClick) inputRef.current.click()\n        clickRef.current = true\n      }\n    }\n    return () => {\n      if (inputRef.current) {\n        inputRef.current.removeEventListener('change', handleChange)\n      }\n    }\n  }, [inputRef.current])\n\n  return { fileClickEl: element, forceClick, inputRef }\n}\n\nexport default useFileInput\n\nconst getExtFromFile = (fileBlob) => {\n  switch (fileBlob.type) {\n    case 'image/jpeg':\n      return 'jpeg'\n    case 'image/jpg':\n      return 'jpeg'\n    case 'image/png':\n      return 'png'\n    default:\n      return 'jpg'\n  }\n}\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport PhotoLibraryIcon from '@material-ui/icons/PhotoLibrary'\nimport CameraAltIcon from '@material-ui/icons/CameraAlt'\nimport { makeStyles } from '@material-ui/core/styles'\nimport useFileInput from '../../../../lib/useFileInput'\nimport { Button } from '@material-ui/core'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    height: '100%',\n    display: 'flex',\n    flexDirection: 'column',\n    textAlign: 'center',\n    color: theme.palette.grey[600],\n    border: `20px solid ${theme.palette.grey[400]}`\n  },\n  icon: {\n    color: theme.palette.grey[600],\n    margin: 'auto',\n    flex: '1 1 50%',\n    height: '70%',\n    width: '70%'\n  },\n  button: {\n    margin: theme.spacing(2)\n  }\n}))\n\nconst LibraryFilePicker = ({ onLibraryAdd, onCancel, cameraPicker }) => {\n  const classes = useStyles()\n  const { fileClickEl, forceClick } = useFileInput(onLibraryAdd, cameraPicker)\n  let cameraWords = 'Library'\n  let PlaceIcon = PhotoLibraryIcon\n\n  if (cameraPicker) {\n    cameraWords = 'Camera'\n    PlaceIcon = CameraAltIcon\n  }\n\n  return (\n    <div className={classes.root}>\n      {fileClickEl}\n      <PlaceIcon className={classes.icon}color='inherit' onClick={forceClick} />\n      <Button variant='contained' className={classes.button} color='primary' onClick={forceClick}>\n        Import from {cameraWords}\n      </Button>\n      <Button variant='outlined' className={classes.button} color='secondary' onClick={onCancel}>\n        Cancel\n      </Button>\n    </div>\n  )\n}\n\nLibraryFilePicker.propTypes = {\n  onLibraryAdd: PropTypes.func.isRequired,\n  cameraPicker: PropTypes.bool,\n  onCancel: PropTypes.func.isRequired\n}\n\nexport default LibraryFilePicker\n","import SeriesConfig from './SeriesConfig'\nimport uuidv4 from 'uuid/v4'\n\nclass Series {\n  constructor (seriesConfig, series) {\n    this.config = new SeriesConfig(seriesConfig)\n    if (series) this.series = series\n    else {\n      this.series = this.newSeries()\n    }\n  }\n\n  setMeta = () => {\n    this.meta = JSON.stringify(this.config.getSeriesMeta())\n  }\n\n  newSeries = () => ({\n    id: `L-${uuidv4()}`,\n    meta: JSON.stringify(this.config.getSeriesMeta()),\n    photos: []\n  })\n}\n\nexport default Series\n","import React, { useState, useContext, useRef } from 'react'\nimport PropTypes from 'prop-types'\n\nimport PhotoReviewTool from './PhotoReviewTool'\nimport CameraTool from './CameraTool'\nimport NewPhotoInfo from './NewPhotoInfo'\nimport LibraryFilePicker from './controls/LibraryFilePicker'\n\nimport PhotoClass, { getExif } from '../../../lib/Photo'\nimport SeriesClass from '../../../lib/Series'\nimport { useDeviceOrientation, useGeolocation } from '../../../lib/sensors'\n\nimport { SeriesContext } from '../contexts'\n\nexport const MODES = {\n  CAMERA: 'camera',\n  LEGACY_CAMERA: 'legacyCamera',\n  FILEPICKER: 'library',\n  PHOTOREVIEW: 'photoreview',\n  PHOTOINFOEDIT: 'photoinfoedit'\n}\n\nconst NewPhoto = ({ inputMethod, onCreate, onCancel, isNewSeries }) => {\n  const { seriesConfig, series } = useContext(SeriesContext)\n  const geoRef = useRef()\n\n  // This will hold our urlData base64-encoded image\n  const [newPhotoData, setNewPhotoData] = useState(null)\n\n  // Instantiate common-sense empty objects.\n  const [newSeries, setNewSeries] = useState(isNewSeries ? new SeriesClass(seriesConfig).series : series)\n  const [newPhoto, setNewPhoto] = useState(new PhotoClass(seriesConfig).photo)\n\n  const [photoRefId, setPhotoRefId] = useState(null)\n  const [mode, _changeMode] = useState({ current: inputMethod, history: [] })\n  const orientation = useDeviceOrientation()\n  const geo = useGeolocation()\n  geoRef.current = geo\n\n  const photos = !isNewSeries && series && series.photos ? series.photos : []\n\n  const changeMode = (newModeName) => {\n    console.log('NEWPHOTO changeMode', mode, newModeName)\n    _changeMode({\n      current: newModeName,\n      history: [...mode.history, mode.current]\n    })\n  }\n  const lastMode = () => {\n    if (mode.history.length > 0) {\n      const oldHistory = [...mode.history]\n      const oldMode = oldHistory.pop()\n      _changeMode({\n        current: oldMode,\n        history: oldHistory\n      })\n    }\n    else {\n      onCancel()\n    }\n  }\n\n  const onLibraryAdd = (data) => {\n    console.log('onLibraryAdd Debug GOT DATA', { data, isNewSeries })\n    setNewPhotoData(data)\n    // Ok, now try to get the datetime off the EXIF\n    const { exif, exifDateTime, exifGPS } = getExif(data.dataUrl)\n    let coords = exifGPS\n    const date = exifDateTime || String(Date.now())\n    if (!coords) {\n      if (geoRef.current && geoRef.current.latitude && geoRef.current.longitude) {\n        const { latitude, longitude } = geoRef.current\n        coords = [longitude, latitude]\n      }\n      else {\n        // Stanley park as a fallback if we can't get the geo or exif data\n        coords = [-123.1398254, 49.3050394]\n      }\n    }\n\n    if (isNewSeries) setNewSeries({ ...newSeries, coords })\n\n    console.log('LATLONG FOR LIB PICK', { coords, exifGPS, geo })\n\n    const _newPhoto = {\n      ...newPhoto,\n      takenOn: date,\n      coords,\n      rawData: JSON.stringify({\n        exif,\n        sensors: {\n          orientation,\n          geo\n        }\n      })\n    }\n    setNewPhoto(_newPhoto)\n    console.log('onLibraryAdd', _newPhoto)\n    changeMode(MODES.PHOTOREVIEW)\n    console.log('onLibraryAdd FINISHED', _newPhoto)\n  }\n\n  const onShutter = (data, refId) => {\n    setNewPhotoData(data)\n    console.log('onShutter Debug GOT DATA', { data })\n    const { exif, exifGPS } = getExif(data.dataUrl)\n\n    const date = String(Date.now())\n\n    // with the camera we prioritize the geoLocation over EXIF gps data\n    let coords = [-123.1398254, 49.3050394]\n    if (geoRef.current && geoRef.current.latitude && geoRef.current.longitude) {\n      const { latitude, longitude } = geoRef.current\n      coords = [longitude, latitude]\n    }\n    else if (exifGPS) {\n      coords = exifGPS\n    }\n\n    if (isNewSeries) setNewSeries({ ...newSeries, coords })\n\n    const _newPhoto = {\n      ...newPhoto,\n      takenOn: date,\n      coords,\n      rawData: JSON.stringify({\n        exif,\n        sensors: {\n          orientation,\n          geo\n        }\n      })\n    }\n    setNewPhoto(_newPhoto)\n    console.log('onShutter', { _newPhoto, newSeries: { ...newSeries, coords } })\n    setPhotoRefId(refId)\n    changeMode(MODES.PHOTOREVIEW)\n  }\n\n  const onFinalCreate = (seriesDelta, photoDelta) => onCreate(seriesDelta, photoDelta, newPhotoData)\n\n  let component = null\n  switch (mode.current) {\n    case MODES.CAMERA:\n      component = (\n        <CameraTool\n          photos={photos}\n          onShutter={onShutter}\n          onCancel={onCancel}\n        />\n      )\n      break\n    case MODES.LEGACY_CAMERA:\n      component = (\n        component = <LibraryFilePicker\n          onCancel={onCancel}\n          cameraPicker\n          onLibraryAdd={onLibraryAdd}\n        />\n      )\n      break\n    case MODES.FILEPICKER:\n      component = <LibraryFilePicker\n        onCancel={onCancel}\n        onLibraryAdd={onLibraryAdd}\n      />\n      // fileClick() // move this to useEffect to help with click handling\n      break\n    case MODES.PHOTOREVIEW:\n      component = (\n        <PhotoReviewTool\n          defaultRefPhotoId={photoRefId}\n          photos={photos}\n          captured={newPhoto}\n          dataUrl={newPhotoData.dataUrl}\n          onConfirm={() => changeMode(MODES.PHOTOINFOEDIT)}\n          onCancel={onCancel}\n          onRetry={lastMode}\n        />\n      )\n      break\n    case MODES.PHOTOINFOEDIT:\n      component = (\n        <NewPhotoInfo\n          photo={newPhoto}\n          newSeries={isNewSeries ? newSeries : null}\n          onSave={onFinalCreate}\n          onCancel={onCancel}\n        />\n      )\n      break\n    default:\n      console.log('NEWPHOTO: default state. you should NEVER see this', mode)\n      onCancel()\n  }\n\n  return component\n}\n\nNewPhoto.propTypes = {\n  inputMethod: PropTypes.oneOf(['camera', 'library']),\n  onCreate: PropTypes.func.isRequired,\n  onCancel: PropTypes.func.isRequired,\n  isNewSeries: PropTypes.bool,\n  seriesConfig: PropTypes.object,\n  // This might be a new series so we might have\n  // actions to work on that\n  // This will be provided EITHER photos or onSeriesCreate\n  photos: PropTypes.array\n}\n\nexport default NewPhoto\n","import AccessControl from 'accesscontrol'\n\nclass AccessHelper {\n  constructor (userSub, role, permissionObj) {\n    this.userSub = userSub\n    this.role = role\n    this.permissionObj = permissionObj\n    this.ac = new AccessControl(permissionObj)\n  }\n\n  // Return the string 'Own' or the string 'Any'\n  ownOrAny = (obj) => {\n    if (!obj || !obj.createdUser || !obj.createdUser.id) throw new Error(`No Created user found`)\n    try {\n      return obj.createdUser.id === this.userSub ? 'Own' : 'Any'\n    }\n    catch (e) {\n      return 'Any'\n    }\n  }\n\n  isOwner = (obj) => {\n    if (!obj || !obj.createdUser || !obj.createdUser.id) throw new Error(`No Created user found`)\n    try {\n      return obj.createdUser.id === this.userSub\n    }\n    catch (e) {\n      return false\n    }\n  }\n\n  toString () {\n    console.log('AccessHelper:', { sub: this.userSub, role: this.role })\n  }\n\n  canUser = (action, obj, type, attrs) => {\n    if (['series', 'photo'].indexOf(type) < 0) throw new Error(`canUser: type not supported ${type}`)\n\n    try {\n      const ownAny = this.ownOrAny(obj)\n\n      const perm = this.ac.can(this.role)[`${action}${ownAny}`](type)\n      let otherPerm = null\n      if (type === 'series') {\n        if (obj.access === 'PUBLIC') otherPerm = this.ac.can(this.role)[`${action}${ownAny}`]('series_public')\n        else if (obj.access === 'OPEN') otherPerm = this.ac.can(this.role)[`${action}${ownAny}`]('series_open')\n      }\n\n      // Trying to recreate the form `can(role).readAny`\n      if (attrs) {\n        if (otherPerm) {\n          return !!perm.attributes.find(p => p === '*' || attrs.indexOf(p) > -1) ||\n           !!otherPerm.attributes.find(p => p === '*' || attrs.indexOf(p) > -1)\n        }\n        else return !!perm.attributes.find(p => p === '*' || attrs.indexOf(p) > -1)\n      }\n      else {\n        if (otherPerm) return perm.granted || otherPerm.granted\n        else return perm.granted\n      }\n    }\n    catch (e) {\n      console.error(e)\n      return false\n    }\n  }\n}\n\nexport default AccessHelper\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport AppBar from '@material-ui/core/AppBar'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport IconButton from '@material-ui/core/IconButton'\nimport Typography from '@material-ui/core/Typography'\n\nimport ArrowBackIcon from '@material-ui/icons/ArrowBack'\n\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport style from './SeriesView.style'\nconst useStyles = makeStyles(style)\n\nconst SeriesNotFound = ({ onMenuBack }) => {\n  const classes = useStyles()\n\n  return (\n    <div className={classes.root}>\n      <CssBaseline />\n      <AppBar position='static' className={classes.appBar}>\n        <Toolbar disableGutters>\n          <IconButton className={classes.menuButton} color='inherit' onClick={onMenuBack} aria-label='Menu'>\n            <ArrowBackIcon />\n          </IconButton>\n          <Typography variant='subtitle1' color='inherit' className={classes.toolbarTitle}>\n            Series\n          </Typography>\n        </Toolbar>\n      </AppBar>\n\n      <div className={classes.placeholderInner}>\n        <div className={classes.grow} />\n        <Typography className={classes.placeholderText} variant='h3'>\n            Series not found\n        </Typography>\n        <div className={classes.grow} />\n      </div>\n    </div>\n  )\n}\n\nSeriesNotFound.propTypes = {\n  // Action functions\n  onMenuBack: PropTypes.func.isRequired\n}\n\nexport default SeriesNotFound\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport AppBar from '@material-ui/core/AppBar'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport IconButton from '@material-ui/core/IconButton'\nimport Typography from '@material-ui/core/Typography'\nimport CircularProgress from '@material-ui/core/CircularProgress'\n\nimport ArrowBackIcon from '@material-ui/icons/ArrowBack'\n\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport style from './SeriesView.style'\nconst useStyles = makeStyles(style)\n\nconst SeriesLoading = ({ onMenuBack }) => {\n  const classes = useStyles()\n\n  return (\n    <div className={classes.root}>\n      <CssBaseline />\n      <AppBar position='static' className={classes.appBar}>\n        <Toolbar disableGutters>\n          <IconButton className={classes.menuButton} color='inherit' onClick={onMenuBack} aria-label='Menu'>\n            <ArrowBackIcon />\n          </IconButton>\n          <Typography variant='subtitle1' color='inherit' className={classes.toolbarTitle}>\n            Series\n          </Typography>\n        </Toolbar>\n      </AppBar>\n\n      <div className={classes.placeholderInner}>\n        <div className={classes.grow} />\n        <div className={classes.progressWrapper}>\n          <CircularProgress className={classes.progress} color='inherit' size={150} thickness={5} />\n        </div>\n        <Typography className={classes.placeholderText} variant='h4'>\n            Loading...\n        </Typography>\n        <div className={classes.grow} />\n      </div>\n    </div>\n  )\n}\n\nSeriesLoading.propTypes = {\n  // Action functions\n  onMenuBack: PropTypes.func.isRequired\n}\n\nexport default SeriesLoading\n","import React, { useState, useEffect } from 'react'\nimport PropTypes from 'prop-types'\n\nimport SeriesView from './views/SeriesView'\nimport SeriesEdit from './views/SeriesEdit'\nimport Slideshow from './views/Slideshow'\nimport PhotoViewTool from './views/PhotoViewTool'\nimport NewPhoto from './views/NewPhoto'\nimport AccesHelper from '../../lib/AccessHelper'\n\nimport { SeriesContext } from './contexts'\nimport SeriesNotFound from './views/SeriesNotFound'\nimport SeriesLoading from './views/SeriesLoading'\n\nexport const MODES = {\n  SERIES_VIEW: 'series',\n  SERIES_EDIT: 'editseries',\n  NEWPHOTO: 'newphoto',\n  NEWSERIES: 'newseries',\n  REVIEW: 'review',\n  PHOTO_VIEW: 'photoviewer',\n  PHOTO_VIEW_NEW: 'newphotoviewer',\n  SLIDESHOW: 'slideshow'\n}\nconst VIEW_ONLY_MODES = [MODES.SERIES_VIEW, MODES.PHOTO_VIEW, MODES.SLIDESHOW]\nconst VALID_STARTMODES = [MODES.SERIES_VIEW, MODES.NEWPHOTO, MODES.NEWSERIES, MODES.PHOTO_REVIEW, MODES.PHOTO_VIEW]\n\n/**\n * This component ties all the Repeat Photo components together\n */\nconst RepeatablePhotos = ({\n  modeName, series, seriesConfig, inputMethod: inputMethodINIT,\n  currentUserId, currentUserRole, accessControl, initialPhoto,\n  onChange, onClose, onDelete, onNewSeries, onChangePhoto,\n  onNewPhoto, onDeletePhoto, loading, onFindOnMap,\n  onWatch, onUnWatch, watching, owned\n}) => {\n  // Manage view modes separately\n  // This is a pretty normal pattern for context\n  const [seriesState, setState] = useState({\n    series,\n    seriesConfig,\n    ac: accessControl ? new AccesHelper(currentUserId, currentUserRole, accessControl) : null\n  })\n\n  const [mode, setMode] = useState({\n    current: {\n      name: modeName || MODES.SERIES_VIEW,\n      pid: initialPhoto,\n      inputMethod: inputMethodINIT\n    },\n    history: []\n  })\n\n  useEffect(() => {\n    setState({ ...seriesState, series })\n    setMode({\n      current: {\n        name: modeName || MODES.SERIES_VIEW,\n        pid: initialPhoto,\n        inputMethod: inputMethodINIT\n      },\n      history: []\n    })\n  }, [series])\n\n  // When anything changes about a photo\n  const onUpdatePhoto = (photo, photoDelta) => {\n    const newSeries = { ...seriesState.series }\n    newSeries.photos = newSeries.photos.map(ph => ph.id === photoDelta.id ? { ...ph, ...photoDelta } : ph)\n    onChangePhoto(photo, { ...photoDelta, seriesId: newSeries.id })\n  }\n\n  const onApprovePhoto = async (newSeries, newPhoto, newPhotoData) => {\n    // Pass this all back so that graphQl can handle it\n    console.log('RepeatablePhotos: waiting for photo ID', { newSeries, newPhoto, newPhotoData })\n    await onNewPhoto(newPhoto, newPhotoData)\n\n    setState({\n      ...seriesState,\n      series: {\n        ...series,\n        photos: [...series.photos, newPhoto]\n      }\n    })\n    changeMode(MODES.PHOTO_VIEW_NEW, newPhoto.id)\n  }\n\n  // const onCreateSeries = async (newSeries, newPhoto, newPhotoData) => {\n  //   console.log('RepeatablePhotos: waiting for series ID', { newSeries, newPhoto, newPhotoData })\n\n  //   await onNewSeries(newSeries, newPhoto, newPhotoData)\n  //   console.log('RepeatablePhotos done. showing the series')\n  //   changeMode(MODES.SERIES_VIEW)\n  // }\n\n  // When a photo is removed\n  const onDeletePhotos = (photoIdArr) => {\n    series.photos.filter(sp => photoIdArr.indexOf(sp.id) > -1).forEach(p => onDeletePhoto(p))\n  }\n\n  // Here's our modeChanger. My guess it will get a lot more complicated\n  // once the reducers get in and working\n  const changeMode = (newModeName, newPid, newInputMethod) => {\n    const canUpdate = seriesState.ac.canUser('update', series, 'series')\n    if (seriesState === null) onClose()\n    if (!canUpdate && VIEW_ONLY_MODES.indexOf(newModeName) < 0) {\n      console.error('ILLEGAL MODE CHANGE!!!!!', { from: mode.current, to: newModeName, canUpdate })\n    }\n    else {\n      // console.log('CHANGING MODE TO', newModeName)\n      setMode({\n        current: {\n          name: newModeName,\n          pid: newPid,\n          inputMethod: newInputMethod\n        },\n        history: [...mode.history, mode.current]\n      })\n    }\n  }\n  const lastMode = () => {\n    // console.log('REPEATABLEPHOTOS lastMode', mode)\n    if (mode.history.length > 0) {\n      const oldHistory = [...mode.history]\n      const oldMode = oldHistory.pop()\n      setMode({\n        current: oldMode,\n        history: oldHistory\n      })\n    }\n    else {\n      onClose()\n    }\n  }\n\n  // The action to initiate the photo viewer\n  const viewPhoto = (pid) => {\n    changeMode(MODES.PHOTO_VIEW, pid)\n  }\n\n  let component = null\n\n  if (loading) return <SeriesLoading onMenuBack={onClose} />\n  else if (!seriesState.series && mode.current.name !== MODES.NEWSERIES) return <SeriesNotFound onMenuBack={onClose} />\n\n  switch (mode.current.name) {\n    case MODES.SERIES_VIEW:\n      component = (\n        <SeriesView\n          // This one has lots of functionsgit add\n          onSlideshowStart={() => changeMode(MODES.SLIDESHOW)}\n          onChange={() => {\n            console.log('onChange NOT IMPLEMENTED')\n          }}\n          watching={watching}\n          owned={owned}\n          initialPhoto={initialPhoto}\n          onDeletePhotos={onDeletePhotos}\n          onDeleteSeries={onDelete}\n          onFindOnMap={onFindOnMap}\n          onCameraAdd={() => changeMode(MODES.NEWPHOTO, null, 'camera')}\n          onEditSeries={() => changeMode(MODES.SERIES_EDIT)}\n          onLibraryAdd={() => changeMode(MODES.NEWPHOTO, null, 'library')}\n          onTileClick={viewPhoto}\n          onMenuBack={onClose}\n          onWatch={onWatch}\n          onUnWatch={onUnWatch}\n        />\n      )\n      break\n    case MODES.SERIES_EDIT:\n      component = (\n        <SeriesEdit\n          onCancel={() => changeMode(MODES.SERIES_VIEW)}\n          onOk={(seriesDelta) => {\n            onChange(series, { ...seriesDelta, id: series.id })\n            changeMode(MODES.SERIES_VIEW)\n          }}\n        />\n      )\n      break\n    case MODES.PHOTO_VIEW:\n      component = (\n        <PhotoViewTool\n          photos={seriesState.series.photos}\n          initPhotoId={mode.current.pid}\n          onMenuBack={lastMode}\n          onUpdatePhoto={onUpdatePhoto}\n        />\n      )\n      break\n    case MODES.PHOTO_VIEW_NEW:\n      component = (\n        <PhotoViewTool\n          photos={seriesState.series.photos}\n          initPhotoId={mode.current.pid}\n          newPhoto\n          onMenuBack={() => changeMode(MODES.SERIES_VIEW)}\n          onUpdatePhoto={onUpdatePhoto}\n        />\n      )\n      break\n    case MODES.SLIDESHOW:\n      component = (\n        <Slideshow photos={seriesState.series.photos} onCancel={lastMode} />\n      )\n      break\n    case MODES.NEWPHOTO:\n      component = (\n        <NewPhoto\n          inputMethod={mode.current.inputMethod}\n          photos={series ? series.photos : null}\n          onCreate={onApprovePhoto}\n          onCancel={lastMode}\n        />\n      )\n      break\n    case MODES.NEWSERIES:\n      component = (\n        <NewPhoto\n          inputMethod={mode.current.inputMethod}\n          isNewSeries\n          onCreate={onNewSeries}\n          onCancel={lastMode}\n        />\n      )\n      break\n    default:\n      console.log('REPEATABLEPHOTO: default state. you should NEVER see this', seriesState)\n      component = null\n  }\n\n  return (\n    <SeriesContext.Provider value={seriesState}>\n      {component}\n    </SeriesContext.Provider>\n  )\n}\n\nRepeatablePhotos.propTypes = {\n  modeName: PropTypes.oneOf(VALID_STARTMODES),\n  seriesConfig: PropTypes.object.isRequired,\n  watching: PropTypes.bool,\n  owned: PropTypes.bool,\n\n  currentUserId: PropTypes.string,\n  currentUserRole: PropTypes.string,\n  accessControl: PropTypes.object,\n\n  inputMethod: PropTypes.oneOf(['camera', 'library']),\n  series: PropTypes.object,\n  initialPhoto: PropTypes.string,\n  loading: PropTypes.bool,\n\n  // Now some functions to handle actions we might take\n  onChange: PropTypes.func.isRequired,\n  onFindOnMap: PropTypes.func.isRequired,\n  onChangePhoto: PropTypes.func.isRequired,\n  onDeletePhoto: PropTypes.func.isRequired,\n  onNewPhoto: PropTypes.func.isRequired,\n  onNewSeries: PropTypes.func.isRequired,\n  onDelete: PropTypes.func.isRequired,\n  onClose: PropTypes.func.isRequired,\n  onWatch: PropTypes.func,\n  onUnWatch: PropTypes.func\n\n}\nRepeatablePhotos.defaultProps = {\n  mode: MODES.SERIES_VIEW\n}\n\nexport default RepeatablePhotos\n","import React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { home, tagColors } from '../config'\nimport permissions from '../permissions'\nimport { graphql, compose } from 'react-apollo'\nimport { connect } from 'react-redux'\nimport actions from '../redux/actions'\nimport { getWholeSeries } from '../graphql/queries'\nimport createSeries from '../graphql/mutations/createSeries'\nimport deleteSeries from '../graphql/mutations/deleteSeries'\nimport updateSeries from '../graphql/mutations/updateSeries'\nimport deletePhoto from '../graphql/mutations/deletePhoto'\nimport createPhoto from '../graphql/mutations/createPhoto'\nimport updatePhoto from '../graphql/mutations/updatePhoto'\nimport watch from '../graphql/mutations/watch'\nimport unwatch from '../graphql/mutations/unwatch'\nimport RepeatablePhotos, { MODES } from '../components/PhotoSeries'\nimport { AppContext } from '../contexts'\nimport { imgStore } from '../graphql/offline'\n// import { getExtFromBlob } from '../lib/Photo'\n\nimport { ThemeProvider } from '@material-ui/styles'\nimport themes from '../themes'\nimport { MODES as INPUT_MODES } from '../components/PhotoSeries/views/NewPhoto'\n\nconst SeriesConnect = ({\n  series, loading, domain, activeSeries, initialPhoto,\n  onAfterSeriesDelete, onBack, queueUpload,\n  createSeriesMutation, createPhotoMutation,\n  updateSeriesMutation, updatePhotoMutation,\n  deleteSeriesMutation, deletePhotoMutation,\n  watchSeriesMutation, unWatchSeriesMutation,\n  onFindOnMap\n}) => {\n  const { role, currentUser, user, signedIn, isIos, onAvatarClick, getPhotoUrls } = useContext(AppContext)\n  let inputMethod = 'camera'\n  // Hack until we can get good loading object sorted\n  if (domain === home.AppStateTypes.NEW_SERIES_CAMERA) {\n    if (isIos) inputMethod = INPUT_MODES.LEGACY_CAMERA\n    else inputMethod = INPUT_MODES.CAMERA\n  }\n  else if (domain === home.AppStateTypes.NEW_SERIES_LIBRARY) inputMethod = INPUT_MODES.FILEPICKER\n\n  // console.log('SeriesConnect', { series, loading, currentState, activeSeries, role, currentUser })\n  let modeName = MODES.SERIES_VIEW\n  if (domain !== home.AppStateTypes.SERIES) modeName = MODES.NEWSERIES\n\n  // Series config is the object that series needs to know how to process things outside itself (like lookup urls etc.)\n  const seriesConfig = {\n    meta: {},\n    tags: [\n      {\n        id: 'freeBothType',\n        label: null,\n        color: tagColors[0],\n        allowXY: true,\n        allowNonXY: true,\n        allowAdditions: true,\n        // This one returns a promise\n        getValues: () => Promise.resolve(['a', 'b', 'c']),\n        imgStore,\n        values: []\n      }\n    ],\n    onAvatarClick,\n    getPhotoUrls,\n    isIos\n  }\n\n  let owned = false\n  try {\n    owned = user.id === series.createdUser.id\n  }\n  catch (e) {}\n  console.log('[SERIESCONNECT]', { activeSeries, series, loading, owned, user })\n\n  return (\n    <ThemeProvider theme={themes.series}>\n      <RepeatablePhotos\n        modeName={modeName}\n        inputMethod={inputMethod}\n\n        owned={owned}\n        watching={signedIn && user && user.watching && user.watching.indexOf(activeSeries) > -1}\n\n        // Everything we need to determine access\n        currentUserId={signedIn ? currentUser.attributes.sub : null}\n        currentUserRole={role}\n        accessControl={permissions}\n        loading={loading}\n        series={series}\n        initialPhoto={initialPhoto}\n        seriesConfig={seriesConfig}\n\n        // Now some functions to handle actions we might take\n        onNewPhoto={async (newPhoto, newPhotoData) => {\n          console.log('onNewPhoto::', { series, newPhoto, newPhotoData })\n          // Write this blob to the imgStore so we can use it later\n          await imgStore.setItem(newPhoto.uploadToken, newPhotoData)\n          return createPhotoMutation(series, newPhoto, newPhotoData.ext)\n            .then(({ data }) => {\n              // Now we can add this photo to the upload queue\n              const photo = data.createPhoto.photo\n              if (data.createPhoto.preAuth) {\n                const preAuth = JSON.parse(data.createPhoto.preAuth)\n\n                queueUpload({\n                  id: photo.id,\n                  uploadToken: photo.uploadToken,\n                  seriesId: photo.seriesId,\n                  preAuth,\n                  ext: newPhotoData.ext,\n                  retry: 0\n                })\n              }\n            })\n            .catch(err => {\n              console.log('onNewPhoto:: Graphql Error', err.stack)\n              console.error(err)\n            })\n        }}\n        onChangePhoto={(photo, photoDelta) => updatePhotoMutation(photo, photoDelta)\n          .catch(err => {\n            console.log('onChangePhoto:: Graphql Error', err.stack)\n            console.error(err)\n          })\n        }\n        onDeletePhoto={(photo) => deletePhotoMutation(photo.id)\n          .then((...data) => {\n            console.log('onDeletePhoto:: photo deleted', data)\n          })\n          .catch(err => {\n            console.log('onDeletePhoto:: Graphql Error', err.stack)\n            console.error(err)\n          })\n        }\n        onChange={(series, seriesDelta) => updateSeriesMutation(series, seriesDelta)\n          .catch(err => {\n            console.log('onChange:: Graphql Error', err.stack)\n            console.error(err)\n          })\n        }\n        onNewSeries={async (newSeries, newPhoto, newPhotoData) => {\n          console.log('Series.connect:: onNewSeries starting', { newSeries, newPhoto, newPhotoData })\n          await imgStore.setItem(newPhoto.uploadToken, newPhotoData)\n          return createSeriesMutation(newSeries, newPhoto, newPhotoData.ext)\n            .then(async ({ data }) => {\n              if (data.createSeries.preAuth) {\n                // Now we can add this photo to the upload queue\n                const photo = data.createSeries.series.photos[0]\n                const preAuth = JSON.parse(data.createSeries.preAuth)\n\n                queueUpload({\n                  id: photo.id,\n                  uploadToken: photo.uploadToken,\n                  seriesId: photo.seriesId,\n                  preAuth,\n                  ext: newPhotoData.ext,\n                  retry: 0\n                })\n              }\n            })\n            .catch(err => {\n              console.log('onNewSeries:: Graphql Error', err.stack)\n              console.error(err)\n            })\n        }}\n        onDelete={() => {\n          onAfterSeriesDelete() // UI Stuff, just bring us back to the feed\n          return deleteSeriesMutation()\n            .catch(err => {\n              console.log('onDelete:: Graphql Error', err.stack)\n              console.error(err)\n            })\n        }}\n        onClose={onBack}\n        onFindOnMap={onFindOnMap}\n        onWatch={signedIn ? watchSeriesMutation : null}\n        onUnWatch={signedIn ? unWatchSeriesMutation : null}\n      />\n    </ThemeProvider>\n  )\n}\nSeriesConnect.propTypes = {\n  domain: PropTypes.string,\n  activeSeries: PropTypes.string,\n  initialPhoto: PropTypes.string,\n\n  // From Redux\n  onAfterSeriesDelete: PropTypes.func,\n  queueUpload: PropTypes.func,\n  onBack: PropTypes.func,\n\n  // Data from apollo\n  series: PropTypes.object,\n\n  // Functions From Apollo\n  loading: PropTypes.bool,\n  updateSeriesMutation: PropTypes.func,\n  updatePhotoMutation: PropTypes.func,\n  deleteSeriesMutation: PropTypes.func,\n  deletePhotoMutation: PropTypes.func,\n  createSeriesMutation: PropTypes.func,\n  createPhotoMutation: PropTypes.func,\n  watchSeriesMutation: PropTypes.func,\n  unWatchSeriesMutation: PropTypes.func,\n  onFindOnMap: PropTypes.func\n}\n\n/**\n * Here's the graphql HOC that gets an individual series\n */\nconst withGetSelectedQuery = graphql(getWholeSeries, {\n  props: ({ data }) => {\n    if (data.error) console.error(data.error)\n    console.log('getWholeSeries:: ', { data })\n    let series = null\n    try {\n      if (!data.loading && !data.error) series = data.series\n    }\n    catch (e) {\n      console.log('getWholeSeries:: error', { data, e })\n      console.error(e)\n    }\n    return {\n      data,\n      loading: data.loading,\n      series\n    }\n  },\n  skip: ({ activeSeries, isNewSeries }) => !activeSeries || isNewSeries,\n  options: ({ activeSeries }) => ({\n    variables: {\n      id: activeSeries\n    }\n  })\n})\n\n/**\n * Compose all our queries together\n */\nconst connectedWithApollo = compose(\n  withGetSelectedQuery,\n  createSeries.withMutation,\n  createPhoto.withMutation,\n  updateSeries.withMutation,\n  updatePhoto.withMutation,\n  deleteSeries.withMutation,\n  deletePhoto.withMutation,\n  watch.withMutation,\n  unwatch.withMutation\n)(SeriesConnect)\n\n/**\n * Map our redux state and functions\n */\nconst mapStateToProps = (state, props) => {\n  const { current: { activeSeries, initialPhoto, domain } } = state.home\n  return { activeSeries, initialPhoto, domain }\n}\n\nconst mapDispatchToProps = dispatch => ({\n  onBack: () => {\n    dispatch(actions.homeStateBack())\n  },\n  onAfterSeriesDelete: () => {\n    console.log('onAfterSeriesDelete')\n    dispatch(actions.setHomeState(home.AppStateTypes.FEED, { activeSeries: null }))\n  },\n  queueUpload: (uploadObj) => {\n    dispatch(actions.queueUpload(uploadObj))\n  },\n  doneCreatingSeries: (activeSeries) => {\n    console.log('doneCreatingSeries', activeSeries)\n    dispatch(actions.setHomeState(home.AppStateTypes.SERIES, { activeSeries }))\n  },\n  onFindOnMap: () => {\n    dispatch(actions.setHomeState(home.AppStateTypes.MAP))\n  }\n})\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(connectedWithApollo)\n","import { useState, useEffect, useCallback } from 'react'\nimport uuid from 'uuid/v4'\nimport WebMercatorViewport from 'viewport-mercator-project'\nimport rbush from 'rbush'\nimport { point, centroid, featureCollection } from '@turf/turf'\nimport { debounce } from './util'\n\nconst useClusteredData = (data, filterBounds, currentZoom, viewport, sizeScale, queryVersion, isTransitioning) => {\n  const [clusteredData, setClusteredData] = useState([])\n  const [filteredData, setFilteredData] = useState({ single: [], cluster: [] })\n  const [version, setVersion] = useState(0)\n\n  // We promisify and debounce the expensive stuff so it runs outside our render loop\n  const updateDataDebounce = useCallback(debounce(async (...innerArgs) => {\n    const updatedData = await updateData(...innerArgs)\n    setClusteredData(updatedData)\n    // setClusteredData(updatedData)\n    setVersion(version + 1)\n  }, 1000), [])\n\n  const filterDataDebounce = useCallback(debounce(async (...innerArgs) => {\n    const filtered = await filterData(...innerArgs)\n    setFilteredData(filtered)\n  }, 300), [])\n\n  // Here's the really expensive call. Make sure this only runs when the data changes\n  useEffect(() => {\n    updateDataDebounce(data, sizeScale, viewport)\n  }, [data.length, queryVersion])\n\n  useEffect(() => {\n    if (!isTransitioning) filterDataDebounce(clusteredData, filterBounds, currentZoom)\n  }, [clusteredData, currentZoom, filterBounds, version, isTransitioning])\n\n  return { filteredClusteredData: filteredData }\n}\n\nexport default useClusteredData\n\n// Compute icon clusters\n// We use the projected positions instead of longitude and latitude to build\n// the spatial index, because this particular dataset is distributed all over\n// the world, we can't use some fixed deltaLon and deltaLat\nconst updateData = (data, sizeScale, viewport) => {\n  // console.log('----------------------------------UPDATE CLUSTER----------------------------------', { data, sizeScale, viewport })\n\n  if (!data) {\n    return []\n  }\n  const tree = rbush(9, ['.x', '.y', '.x', '.y'])\n\n  const transform = new WebMercatorViewport({\n    ...viewport,\n    zoom: 0\n  })\n\n  // console.log('DATA', data)\n  // The root of this is GeoJSON so that's what we have to build\n  const newData = data.map(p => {\n    // Create some GeoJSON that we can render as a dot\n    let screenCoords = [0, 0]\n    try {\n      screenCoords = transform.project(p.coords)\n    }\n    catch (e) {\n      console.error(e)\n    }\n    const { longitude, latitude, ...properties } = p\n    return {\n      x: screenCoords[0],\n      y: screenCoords[1],\n      photoCount: properties.photoCount,\n      zoomLevels: [],\n      geoJSON: p.coords ? point(p.coords, { ...properties }) : null\n    }\n  })\n\n  tree.clear()\n  tree.load(newData)\n\n  for (let z = 0; z <= 20; z++) {\n    const radius = sizeScale / Math.sqrt(2) / Math.pow(2, z)\n    // const radius = 60 / Math.sqrt(2) / Math.pow(2, z)\n\n    newData.forEach(p => {\n      if (p.zoomLevels[z] === undefined) {\n        // this point does not belong to a cluster\n        const { x, y } = p\n\n        // find all points within radius that do not belong to a cluster\n        const neighbors = tree\n          .search({\n            minX: x - radius,\n            minY: y - radius,\n            maxX: x + radius,\n            maxY: y + radius\n          })\n          .filter(neighbor => neighbor.zoomLevels[z] === undefined)\n\n        // only show the center point at this zoom level\n        neighbors.forEach(neighbor => {\n          if (neighbor === p) {\n            const newGeoJSON = neighbors.length === 1\n              ? p.geoJSON\n              : centroid(featureCollection(neighbors.map(n => n.geoJSON)))\n\n            newGeoJSON.properties = {\n              ...newGeoJSON.properties,\n              id: newGeoJSON.properties.id || uuid(),\n              count: neighbors.length,\n              reducedPhotoCount: neighbors.reduce((acc, { photoCount }) => photoCount ? acc + photoCount : acc, 0),\n              points: neighbors.map(n => n.geoJSON)\n            }\n            p.zoomLevels[z] = newGeoJSON\n          }\n          else {\n            neighbor.zoomLevels[z] = null\n          }\n        })\n      }\n    })\n  }\n\n  // console.log('----------------------------------UPDATE CLUSTER DONE----------------------------------')\n  return newData.map(({ zoomLevels }) => zoomLevels)\n}\n\nfunction filterData (clusteredData, filterBounds, newZ) {\n  // console.log('----------------------------------FILTER CLUSTER----------------------------------', { clusteredData, filterBounds, newZ })\n\n  return clusteredData\n    // Filter out anything not relevant to this zoom level\n    .filter(d => !!d[newZ])\n    // Restructure the object to be a little more JSON-friendly\n    .reduce((acc, zoomLevels) => {\n      const geoJSON = zoomLevels[newZ]\n      const coords = geoJSON.geometry.coordinates\n      const { count } = geoJSON.properties\n\n      if (!filterBounds || filterBounds.length < 4 || (\n        filterBounds[0] < coords[0] && filterBounds[1] < coords[1] &&\n        filterBounds[2] > coords[0] && filterBounds[3] > coords[1]\n      )) {\n        if (count > 1) acc.cluster.push(geoJSON)\n        else acc.single.push(geoJSON)\n      }\n      return acc\n    }, {\n      single: [],\n      cluster: []\n    })\n}\n","export default theme => ({\n  root: {\n    position: 'relative',\n    height: '100%',\n    '& .myPosMarker': {\n      zIndex: 1\n    },\n    '& .singleMarker': {\n      zIndex: 3\n    },\n    '& .clusterMarker': {\n      zIndex: 2\n    }\n  },\n  fab: {\n    background: theme.palette.secondary.main,\n    color: theme.palette.secondary.contrastText\n  },\n  topBar: {\n    position: 'absolute',\n    zIndex: 100,\n    top: 0\n  },\n  loadingWrapper: {\n    position: 'absolute',\n    color: theme.palette.text.primary,\n    opacity: 0.5,\n    zIndex: 90,\n    textAlign: 'center',\n    top: '50%',\n    left: '50%',\n    transform: 'translateY(-50%) translateX(-50%)'\n  },\n  zoomOutFab: {\n    margin: theme.spacing(0.5),\n    padding: theme.spacing(0.5),\n    border: '2px solid',\n    borderRadius: theme.spacing(1),\n    background: theme.palette.common.white,\n    fontSize: 20,\n    position: 'absolute',\n    zIndex: 80,\n    bottom: theme.spacing(2),\n    right: theme.spacing(10)\n  },\n  selectedPopup: {\n    // padding: theme.spacing(0, 1, 0, 1),\n    width: '90%',\n    maxWidth: 400,\n    zIndex: 100,\n    position: 'absolute',\n    bottom: theme.spacing(1),\n    left: '50%',\n    transformOrigin: '0% 50%',\n    transform: 'translateY(0%) translateX(-50%)'\n  }\n})\n","import React from 'react'\nimport createSvgIcon from '@material-ui/icons/utils/createSvgIcon'\n\nexport default createSvgIcon(\n  <React.Fragment>\n    <path d='M16.432,6.104c-2.671,-1.06 -6.842,4.123 -6.572,5.826c-3.78,-7.611 2.788,-8.409 3.682,-10.699c0.64,1.255 5.18,2.608 2.89,4.873Z' />\n    <path d='M9.159,5.228c-2.254,1.782 0.149,7.986 1.76,8.604c-8.482,-0.532 -5.889,-6.619 -7.425,-8.538c1.407,0.073 4.848,-3.183 5.665,-0.066Z' />\n    <path d='M4.727,11.059c0.417,2.844 6.991,3.864 8.331,2.779c-4.701,7.079 -8.676,1.79 -11.106,2.161c0.766,-1.183 -0.332,-5.791 2.775,-4.94Z' />\n    <path d='M7.561,17.813c2.671,1.061 6.842,-4.122 6.572,-5.826c3.781,7.611 -2.788,8.409 -3.681,10.699c-0.641,-1.255 -5.181,-2.607 -2.891,-4.873Z' />\n    <path d='M14.828,18.736c2.254,-1.783 -0.149,-7.987 -1.76,-8.605c8.482,0.532 5.889,6.619 7.425,8.538c-1.407,-0.072 -4.849,3.183 -5.665,0.067Z' />\n    <path d='M19.26,12.904c-0.417,-2.843 -6.991,-3.864 -8.331,-2.778c4.701,-7.08 8.676,-1.791 11.106,-2.162c-0.767,1.183 0.332,5.791 -2.775,4.94Z' />\n  </React.Fragment>, 'AppLogoSimple')\n","// https://commons.wikimedia.org/wiki/File:Apple_logo_black.svg\n\nimport React from 'react'\nimport createSvgIcon from '@material-ui/icons/utils/createSvgIcon'\n\nexport default createSvgIcon(\n  <React.Fragment>\n    <path d='M21.229,18.388c-0.346,0.799 -0.756,1.535 -1.23,2.211c-0.647,0.922 -1.176,1.56 -1.584,1.914c-0.632,0.582 -1.31,0.88 -2.036,0.897c-0.521,0 -1.149,-0.148 -1.88,-0.449c-0.734,-0.299 -1.408,-0.448 -2.025,-0.448c-0.646,0 -1.34,0.149 -2.081,0.448c-0.743,0.301 -1.342,0.457 -1.799,0.473c-0.696,0.03 -1.39,-0.277 -2.082,-0.921c-0.442,-0.385 -0.995,-1.046 -1.657,-1.982c-0.71,-0.999 -1.294,-2.158 -1.752,-3.48c-0.49,-1.427 -0.735,-2.809 -0.735,-4.147c0,-1.533 0.331,-2.855 0.994,-3.963c0.521,-0.89 1.215,-1.591 2.083,-2.107c0.868,-0.515 1.806,-0.778 2.816,-0.794c0.553,0 1.278,0.17 2.179,0.506c0.898,0.338 1.474,0.509 1.727,0.509c0.189,0 0.83,-0.2 1.916,-0.599c1.027,-0.369 1.894,-0.522 2.604,-0.462c1.924,0.155 3.37,0.914 4.331,2.28c-1.721,1.043 -2.572,2.503 -2.555,4.377c0.016,1.459 0.545,2.674 1.585,3.638c0.472,0.447 0.999,0.793 1.584,1.039c-0.127,0.368 -0.261,0.721 -0.403,1.06Zm-4.413,-17.366c0,1.144 -0.418,2.212 -1.251,3.2c-1.005,1.176 -2.221,1.855 -3.54,1.748c-0.017,-0.138 -0.026,-0.282 -0.026,-0.434c0,-1.098 0.478,-2.273 1.327,-3.234c0.423,-0.486 0.962,-0.891 1.616,-1.214c0.652,-0.318 1.269,-0.493 1.85,-0.523c0.016,0.152 0.024,0.305 0.024,0.457l0,0Z' />\n  </React.Fragment>, 'Apple')\n","\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport Button from '@material-ui/core/Button'\nimport Typography from '@material-ui/core/Typography'\nimport DialogActions from '@material-ui/core/DialogActions'\n\nimport AppleIcon from '../../icons/Apple'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst style = theme => ({\n  root: {\n\n  },\n  icon: {\n    height: 50,\n    width: '100%',\n    margin: '0 auto',\n    color: theme.palette.error.main\n  },\n  title: {\n\n  }\n})\n\nconst useStyles = makeStyles(style)\n\nconst FeatureDisabled = ({ title, message, onClose, open, icon }) => {\n  const classes = useStyles()\n  const IconComp = icon || AppleIcon\n  return (\n    <Dialog\n      className={classes.root}\n      fullWidth\n      open={open}\n      PaperProps={{ style: { maxWidth: 'none' } }}\n      disableEscapeKeyDown\n      maxWidth='xl'\n      aria-labelledby='confirmation-dialog-title'\n    >\n      <DialogTitle id='confirmation-dialog-title' className={classes.title}>{title}</DialogTitle>\n      <DialogContent>\n        <IconComp className={classes.icon} />\n        <Typography component='div'>\n          {message}\n        </Typography>\n\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={onClose} color='primary'>\n      Ok\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nFeatureDisabled.propTypes = {\n  open: PropTypes.bool,\n  title: PropTypes.string.isRequired,\n  icon: PropTypes.any,\n  message: PropTypes.any,\n  onClose: PropTypes.func.isRequired\n}\n\nexport default FeatureDisabled\n","import React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { makeStyles } from '@material-ui/core/styles'\nimport SwipeableDrawer from '@material-ui/core/SwipeableDrawer'\nimport Avatar from '@material-ui/core/Avatar'\n\nimport List from '@material-ui/core/List'\nimport Divider from '@material-ui/core/Divider'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport CloudDownload from '@material-ui/icons/CloudDownload'\nimport InfoIcon from '@material-ui/icons/Info'\nimport MobileScreenShare from '@material-ui/icons/MobileScreenShare'\nimport { AppContext } from '../contexts'\n\nimport ExitToAppIcon from '@material-ui/icons/ExitToApp'\n\nimport QRCodeIcon from '../icons/QRCode'\nimport AccountCircleIcon from '@material-ui/icons/AccountCircle'\n\nconst useStyles = makeStyles(theme => ({\n  drawerInner: {\n    width: 250,\n    display: 'flex',\n    flexDirection: 'column',\n    height: '100%'\n  },\n  disableListItem: {\n    color: 'rgba(0, 0, 0, 0.26)'\n  },\n  avatar: {\n    height: theme.spacing(7),\n    width: theme.spacing(7),\n    border: `3px solid ${theme.palette.primary.main}`,\n    margin: theme.spacing(0, 1)\n  },\n  gravatarImg: {\n    width: '100%'\n  },\n  spacer: {\n    flexGrow: 1\n  },\n  fullList: {\n    width: 'auto'\n  }\n}))\n\nconst SideDrawer = ({ open, onOpen, onClose, onDisabledClick, onAboutClick }) => {\n  const classes = useStyles()\n  const { signOut, signedIn, forceSignIn, user, onQRClick, addToHomeScreen, onOfflineMenuClick, isIos } = useContext(AppContext)\n  return (\n    <SwipeableDrawer\n      open={open}\n      onClose={onClose}\n      onOpen={onOpen}\n    >\n      <div\n        className={classes.drawerInner}\n        role='presentation'\n        onClick={onClose}\n        onKeyDown={onClose}\n      >\n        {user && user.username && (\n          <List>\n            <ListItem className={classes.root} onClick={() => {}} disableGutters>\n              <Avatar className={classes.avatar}>\n                {signedIn && user\n                  ? <img alt='profile' className={classes.gravatarImg} src={user.gravatar} />\n                  : <AccountCircleIcon color='inherit' className={classes.loginButton} />\n                }\n              </Avatar>\n            </ListItem>\n            <ListItem className={classes.root} onClick={() => {}}>\n              <ListItemText\n                primary={user.username}\n              />\n            </ListItem>\n          </List>\n\n        )}\n        <Divider />\n        <List>\n          <ListItem\n            className={isIos ? classes.disableListItem : null}\n            button\n            onClick={isIos ? onDisabledClick : onQRClick}\n          >\n            <ListItemIcon>\n              <QRCodeIcon />\n            </ListItemIcon>\n            <ListItemText primary={'Scan QR Code'} />\n          </ListItem>\n          {addToHomeScreen && (\n            <ListItem button onClick={addToHomeScreen}>\n              <ListItemIcon>\n                <MobileScreenShare />\n              </ListItemIcon>\n              <ListItemText primary={'Install this app'} secondary={'It works better!'} />\n            </ListItem>\n          )}\n          <ListItem button onClick={onOfflineMenuClick} >\n            <ListItemIcon>\n              <CloudDownload />\n            </ListItemIcon>\n            <ListItemText primary={'Offline Download'} />\n          </ListItem>\n        </List>\n        <div className={classes.spacer} />\n        <Divider />\n        <List>\n          <ListItem button onClick={onAboutClick}>\n            <ListItemIcon>\n              <InfoIcon />\n            </ListItemIcon>\n            <ListItemText primary={'About'} />\n          </ListItem>\n          {signedIn\n            ? (\n              <ListItem button onClick={signOut}>\n                <ListItemIcon>\n                  <ExitToAppIcon />\n                </ListItemIcon>\n                <ListItemText primary={'Sign Out'} />\n              </ListItem>\n            )\n            : (\n              <ListItem button onClick={forceSignIn}>\n                <ListItemIcon>\n                  <AccountCircleIcon />\n                </ListItemIcon>\n                <ListItemText primary={'Sign In'} />\n              </ListItem>\n            )}\n\n        </List>\n      </div>\n    </SwipeableDrawer>\n  )\n}\n\nSideDrawer.propTypes = {\n  open: PropTypes.bool,\n  onOpen: PropTypes.func,\n  onClose: PropTypes.func,\n  onDisabledClick: PropTypes.func,\n  onAboutClick: PropTypes.func\n}\n\nexport default SideDrawer\n","\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport Dialog from '@material-ui/core/Dialog'\nimport Button from '@material-ui/core/Button'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport Container from '@material-ui/core/Container'\nimport Typography from '@material-ui/core/Typography'\nimport DialogActions from '@material-ui/core/DialogActions'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport EmailIcon from '@material-ui/icons/Email'\nimport { version, contact } from '../config'\nimport { RawSVG } from '../icons/AppLogo'\n\nconst style = theme => ({\n  root: {\n\n  },\n  dialogContent: {\n    display: 'flex',\n    flexDirection: 'column',\n    overflow: 'hidden',\n    height: '100%'\n  },\n  iconContainer: {\n    flex: '1 1 10%',\n    textAlign: 'center',\n    padding: theme.spacing(1, 0, 1, 0)\n  },\n  icon: {\n    height: 200,\n    margin: '0 auto',\n    border: `1px solid ${theme.palette.grey[100]}`,\n    background: theme.palette.grey[100],\n    borderRadius: '50%',\n    // color: theme.palette.error.main,\n    '& path': {\n      fill: 'url(#my-cool-gradient) #447799;'\n    }\n  },\n  title: {\n    textAlign: 'center'\n  },\n  stop1: {\n    stopColor: theme.palette.primary.main\n  },\n  stop2: {\n    stopColor: theme.palette.secondary.main\n  },\n  spacer: {\n    flex: '1 1'\n  },\n  buttonIcon: {\n    marginRight: theme.spacing(1)\n  },\n  scrollText: {\n    flex: '1 1 60%',\n    overflowX: 'hidden',\n    overflowY: 'scroll',\n    whiteSpace: 'pre-line',\n    paddingBottom: theme.spacing(1)\n  }\n})\n\nconst useStyles = makeStyles(style)\n\nconst AboutApp = ({ onClose, open }) => {\n  const classes = useStyles()\n  return (\n    <Dialog\n      className={classes.root}\n      fullWidth\n      open={open}\n      PaperProps={{\n        style: {\n          // margin: '25 10',\n          // maxWidth: 'calc(100% - 20px)',\n          // maxHeight: 'calc(100% - 50px)'\n          // height: '100%',\n          // width: '100%'\n        }\n      }}\n      disableEscapeKeyDown\n      maxWidth='xl'\n      aria-labelledby='confirmation-dialog-title'\n    >\n      <DialogContent className={classes.dialogContent}>\n        <Container maxWidth='xs'>\n          <div className={classes.iconContainer}>\n            <svg\n              className={classes.icon}\n              focusable='false'\n              viewBox='0 0 24 24'\n              aria-hidden='true'\n              role='presentation'\n            >\n              {RawSVG}\n            </svg>\n            <svg style={{ width: 0, height: 0, position: 'absolute' }} aria-hidden='true' focusable='false'>\n              <linearGradient id='my-cool-gradient' x2='1' y2='1'>\n                <stop offset='0%' stopColor='#447799' className={classes.stop1} />\n                <stop offset='100%' stopColor='#112266' className={classes.stop2} />\n              </linearGradient>\n            </svg>\n          </div>\n          <div className={classes.title}>\n            <Typography component='div' variant='h5'>\n          MorPhoto\n            </Typography>\n            <Typography component='div' variant='caption'>\n          Version:  {version} <em>BETA</em>\n            </Typography>\n          </div>\n          <Typography className={classes.scrollText} component='div' variant='caption'>\n            {/* <p>Lorem dolor consectetur consequat excepteur irure tempor. Enim ullamco esse mollit minim\n            labore enim irure consectetur mollit laborum est. Magna nostrud cillum magna aliquip ad\n            pariatur proident cillum. Id irure quis eiusmod id tempor eiusmod aliquip sit anim ex esse\n            qui. Veniam dolore excepteur non ex excepteur amet. Voluptate consectetur adipisicing elit\n            adipisicing labore duis ea id cupidatat ad cupidatat velit.</p>\n          <p>Cupidatat aliqua laborum aliqua pariatur aliquip eu minim tempor. Non cillum anim laboris\n            sunt ullamco enim tempor. Enim nulla elit pariatur anim nostrud sunt adipisicing et officia.\n            Excepteur id est quis aliqua eiusmod sint duis pariatur fugiat adipisicing qui. Laboris\n            irure ex velit ex do non adipisicing do sunt commodo adipisicing. Nulla quis occaecat nisi\n            aliqua. Ut laborum duis ex ad magna.</p> */}\n          </Typography>\n          <div className={classes.spacer} />\n          <Button\n            fullWidth\n            href={`mailto:${contact}`}\n            color='primary'\n            variant='outlined'\n          >\n            <EmailIcon className={classes.buttonIcon} />\n          Get in touch\n          </Button>\n        </Container>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={onClose} color='inherit'>\n          Close\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nAboutApp.propTypes = {\n  open: PropTypes.bool,\n  onClose: PropTypes.func.isRequired\n}\n\nexport default AboutApp\n","import React, { useState, useContext } from 'react'\nimport classNames from 'classnames'\nimport PropTypes from 'prop-types'\n\nimport Toolbar from '@material-ui/core/Toolbar'\nimport AppBar from '@material-ui/core/AppBar'\nimport IconButton from '@material-ui/core/IconButton'\nimport AppLogoSimple from '../icons/AppLogoSimple'\nimport FeatureDisabled from './misc/FeatureDisabled'\nimport { AppContext } from '../contexts'\n\nimport QRCodeIcon from '../icons/QRCode'\nimport SideDrawer from './SideDrawer'\nimport AboutApp from './AboutApp'\n\n// import MenuIcon from '@material-ui/core/Menu'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { ThemeProvider } from '@material-ui/styles'\nimport themes from '../themes'\nimport { Typography } from '@material-ui/core'\n\nconst style = theme => ({\n  root: {\n    display: 'flex',\n    alignItems: 'center',\n    width: '100%',\n    padding: theme.spacing(0, 1),\n    backgroundColor: theme.palette.primary.main,\n    color: theme.palette.primary.contrastText,\n    borderBottom: `2px solid ${theme.palette.primary}`,\n    background: `linear-gradient(90deg, ${theme.palette.secondary.main} 0%, ${theme.palette.primary.main} 100%)`\n  },\n  searchIcon: {\n    opacity: 0.3,\n    marginRight: theme.spacing(1)\n  },\n  transparent: {\n    backgroundColor: 'transparent',\n    background: 'none',\n    color: theme.palette.text.primary\n    // borderBottom: `2px transparent`\n  },\n  iOsIcon: {\n    color: 'rgba(0, 0, 0, 0.26)'\n  },\n  logo: {\n    padding: theme.spacing(0, 0),\n    height: 40,\n    width: 40\n  },\n  transparentLogo: {\n    background: `linear-gradient(90deg, ${theme.palette.secondary.main} 0%, ${theme.palette.primary.main} 100%)`,\n    padding: theme.spacing(0.5, 0.5)\n  },\n  transparentLogoIcon: {\n    color: 'white',\n    height: 35,\n    width: 35\n  },\n  children: {\n    flexGrow: 1,\n    padding: theme.spacing(0, 1)\n  },\n  qrButton: {\n    padding: theme.spacing(0, 0)\n  },\n  qrButtonTransparent: {\n    background: 'white',\n    padding: theme.spacing(0.5, 0.5)\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst DIALOGS = {\n  APPLE_WARNING: 'APPLE_WARNING',\n  ABOUTAPP: 'ABOUTAPP'\n}\n\nconst TopBar = ({ className, children, isTransparent, menuItems, hideLogo }) => {\n  const classes = useStyles()\n  const [dialogOpen, setDialogOpen] = useState(false)\n  const [drawerOpen, setDrawerOpen] = useState(false)\n  const { onQRClick, isIos } = useContext(AppContext)\n\n  return (\n    <React.Fragment>\n      <AppBar position='static'>\n        <Toolbar className={classNames(classes.root, className, isTransparent ? classes.transparent : null)} disableGutters>\n          {!hideLogo && (\n            <IconButton\n              className={isTransparent ? classes.transparentLogo : classes.logo}\n              color='inherit'\n              onClick={() => setDrawerOpen(true)}\n            >\n              <AppLogoSimple className={isTransparent ? classes.transparentLogoIcon : classes.logo} />\n            </IconButton>\n          )}\n          <div className={classes.children}>\n            {children}\n          </div>\n          <IconButton\n            color='inherit'\n            className={classNames(\n              isIos ? classes.iOsIcon : null,\n              isTransparent ? classes.qrButtonTransparent : classes.qrButton\n            )}\n            aria-label='Menu'\n            onClick={isIos ? () => setDialogOpen(DIALOGS.APPLE_WARNING) : onQRClick}\n          >\n            <QRCodeIcon color='inherit' />\n          </IconButton>\n        </Toolbar>\n      </AppBar>\n      <SideDrawer\n        open={drawerOpen}\n        onClose={() => setDrawerOpen(false)}\n        onOpen={() => setDrawerOpen(true)}\n        onDisabledClick={() => setDialogOpen(DIALOGS.APPLE_WARNING)}\n        onAboutClick={() => setDialogOpen(DIALOGS.ABOUTAPP)}\n      />\n      <ThemeProvider theme={themes.topbar}>\n        {isIos && (\n          <FeatureDisabled\n            open={dialogOpen === DIALOGS.APPLE_WARNING}\n            title='iOS Feature Disabled'\n            message={<Typography variant='body2' component='div'>\n              <p>This feature cannot function due to a bug in iOS 12 that prevents <strong>direct\n            camera access from progressive web apps</strong>.</p>\n              <p>There is good evidence iOS 13 has things sorted. ETA from Apple is mid-September 2019.</p>\n            </Typography>}\n            onClose={() => setDialogOpen(false)}\n          />\n        )}\n        <AboutApp\n          open={dialogOpen === DIALOGS.ABOUTAPP}\n          onClose={() => setDialogOpen(false)}\n        />\n      </ThemeProvider>\n    </React.Fragment>\n  )\n}\n\nTopBar.propTypes = {\n  className: PropTypes.string,\n  children: PropTypes.any,\n  isTransparent: PropTypes.bool,\n  hideLogo: PropTypes.bool,\n  menuItems: PropTypes.arrayOf(PropTypes.shape({\n    callback: PropTypes.func,\n    text: PropTypes.string,\n    icon: PropTypes.any,\n    color: PropTypes.string\n  }))\n}\n\nexport default (props) => <ThemeProvider theme={themes.topbar}><TopBar {...props} /></ThemeProvider>\n","import React, { useRef, useLayoutEffect, useCallback } from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\nimport { fade } from '@material-ui/core/styles/colorManipulator'\nimport InputBase from '@material-ui/core/InputBase'\n\nimport SearchIcon from '@material-ui/icons/Search'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { debounce } from '../../lib/util'\n\nconst useSearchBarStyles = makeStyles(theme => ({\n  root: {\n    position: 'relative',\n    borderRadius: theme.shape.borderRadius,\n    backgroundColor: fade(theme.palette.common.white, 0.3),\n    '&:hover': {\n      backgroundColor: fade(theme.palette.common.white, 0.5)\n    },\n    marginRight: theme.spacing(2),\n    marginLeft: 0,\n    width: '100%',\n    [theme.breakpoints.up('sm')]: {\n      marginLeft: theme.spacing(3),\n      width: 'auto'\n    }\n  },\n  transparent: {\n    backgroundColor: fade(theme.palette.common.white, 0.7),\n    '&:hover': {\n      backgroundColor: fade(theme.palette.common.white, 0.9)\n    }\n  },\n  inputRoot: {\n    color: 'inherit',\n    width: '100%'\n  },\n  inputInput: {\n    padding: theme.spacing(1, 1, 1, 4),\n    transition: theme.transitions.create('width'),\n    width: '100%',\n    [theme.breakpoints.up('md')]: {\n      width: 200\n    }\n  },\n  searchIcon: {\n    width: theme.spacing(4),\n    height: '100%',\n    position: 'absolute',\n    pointerEvents: 'none',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center'\n  }\n}))\n\n/**\n *\n */\nexport const SearchInput = ({ autoFocus, disabled, onChange, onClick, defaultValue, isTransparent }) => {\n  const inputRef = useRef()\n  const classes = useSearchBarStyles()\n\n  const debounceSearchText = useCallback(\n    debounce(onChange, 500),\n    [onChange]\n  )\n\n  useLayoutEffect(() => {\n    if (inputRef.current && !autoFocus) {\n      console.log('Setting blur')\n      inputRef.current.blur()\n    }\n  }, [autoFocus])\n  return (\n    <div className={classNames(classes.root, isTransparent ? classes.transparent : null)} onClick={onClick}>\n      <div className={classes.searchIcon}>\n        <SearchIcon />\n      </div>\n      <InputBase\n        autoFocus={!disabled && autoFocus}\n        inputProps={{\n          onBlur: () => {\n            // console.log('onBlur')\n            // inputRef.current.focus()\n          }\n        }}\n        onChange={(e) => {\n          // console.log('onChange', e.target.value)\n          debounceSearchText(e.target.value)\n        }}\n        placeholder='Search…'\n        disabled={disabled}\n        defaultValue={defaultValue}\n\n        inputRef={inputRef}\n        classes={{\n          root: classes.inputRoot,\n          input: classes.inputInput\n        }}\n      />\n    </div>\n  )\n}\n\nSearchInput.propTypes = {\n  autoFocus: PropTypes.bool,\n  isTransparent: PropTypes.bool,\n  disabled: PropTypes.bool,\n  onChange: PropTypes.func,\n  defaultValue: PropTypes.string,\n  onClick: PropTypes.func\n}\n\nexport default SearchInput\n","import React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport List from '@material-ui/core/List'\nimport classNames from 'classnames'\nimport Typography from '@material-ui/core/Typography'\nimport RawImage from '../PhotoSeries/views/subViews/RawImage'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { formatDate } from '../../lib/datelib'\n\nimport { ACCESS } from '../../config'\nimport { AppContext } from '../../contexts'\n\nconst style = theme => ({\n  root: {\n    margin: 0,\n    padding: theme.spacing(1)\n  },\n  chipContainer: {\n    display: 'flex',\n    width: '100%'\n  },\n  grow: { flexGrow: 1 },\n  accessLabel: {\n    padding: theme.spacing(0.5, 0.5)\n  },\n  accessPUBLIC: {\n    color: 'white',\n    background: ACCESS.PUBLIC.color[900]\n  },\n  accessPRIVATE: {\n    color: 'white',\n    background: ACCESS.PRIVATE.color[900]\n  },\n  accessOPEN: {\n    color: 'white',\n    background: ACCESS.OPEN.color[900]\n  },\n  img: {\n    verticalAlign: 'top',\n    objectFit: 'cover',\n    height: '100%',\n    width: '100%'\n  },\n  text: {\n    height: '115px',\n    margin: 0,\n    padding: theme.spacing(0, 1),\n    alignSelf: 'flex-start',\n    display: 'flex',\n    flexDirection: 'column'\n  },\n  textSm: {\n    height: '75px',\n    margin: 0,\n    padding: theme.spacing(0, 1),\n    alignSelf: 'flex-start',\n    display: 'flex',\n    flexDirection: 'column'\n  },\n  titleText: {\n    textOverflow: 'ellipsis',\n    whiteSpace: 'nowrap',\n    overflow: 'hidden'\n  },\n  dateContainer: {\n    display: 'flex'\n  },\n  dateLabel: {\n    fontWeight: 'bold',\n    flex: '1 1 50px'\n  },\n  dateText: {\n\n  },\n  imgFiller: {\n    flexGrow: 1,\n    background: theme.palette.text.primary,\n    overflow: 'hidden'\n  },\n  imgContainer: {\n    flex: '0 0 115px',\n    alignSelf: 'flex-start',\n    height: 115,\n    overflow: 'hidden',\n    display: 'flex',\n    flexDirection: 'column'\n  },\n  imgContainerSm: {\n    flex: '0 0 75px',\n    alignSelf: 'flex-start',\n    height: 75,\n    overflow: 'hidden',\n    display: 'flex',\n    flexDirection: 'column'\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst SeriesListItem = ({ series, loading, onClick, children, showCreatedOn, showLastPhoto, small }) => {\n  const classes = useStyles()\n  if (loading || !series) return 'LOADING...'\n  const { getPhotoUrls } = useContext(AppContext)\n\n  let accessLabel = ACCESS.PRIVATE.label\n  accessLabel = series.access ? ACCESS[series.access].label : ACCESS.PRIVATE.label\n\n  return (\n    <ListItem className={classes.root} button component='div' disableGutters>\n      <div className={small ? classes.imgContainerSm : classes.imgContainer} onClick={onClick}>\n        <div className={classes.imgFiller}>\n          <RawImage\n            photo={series.featured}\n            sizePriority={['thumb', 'medium', 'large']}\n            getPhotoUrls={getPhotoUrls}\n            className={classes.img}\n          />\n        </div>\n        {series.access && (\n          <Typography className={classNames(classes.accessLabel, classes[`access${series.access}`])}\n            variant='caption'\n            component='div'\n          >\n            {`${series.photoCount || 0} Photos`}\n            {!small && <em>({accessLabel})</em>}\n          </Typography>\n        )}\n      </div>\n      <ListItemText className={small ? classes.textSm : classes.text} disableTypography onClick={onClick}>\n        <Typography variant='body1' component='div' className={classes.titleText}>\n          {series.name || loading}\n        </Typography>\n        <Typography variant='body2' component='div'>\n          <strong>Created by:</strong> {series.createdUser.username}\n        </Typography>\n        <div className={classes.grow} />\n        {showCreatedOn && <div className={classes.dateContainer}>\n          <Typography variant='caption' className={classes.dateLabel}>Created:</Typography>\n          <Typography variant='caption' className={classes.dateText}>{formatDate(series.createdOn, 'lll')}</Typography>\n        </div>}\n        {showLastPhoto && <div className={classes.dateContainer}>\n          <Typography variant='caption' className={classes.dateLabel}>Last Photo:</Typography>\n          <Typography variant='caption' className={classes.dateText}>{formatDate(series.latest.takenOn, 'lll')}</Typography>\n        </div>}\n      </ListItemText>\n      {/*  <TinyChip label='Watching' color='secondary' /> */}\n      {children}\n    </ListItem>\n  )\n}\n\nSeriesListItem.propTypes = {\n  series: PropTypes.object,\n  loading: PropTypes.bool,\n  small: PropTypes.bool,\n  showCreatedOn: PropTypes.bool,\n  showLastPhoto: PropTypes.bool,\n  onClick: PropTypes.func,\n  children: PropTypes.array\n}\n\nexport default SeriesListItem\n\n// const useCosmosStyles = makeStyles(theme => ({\n//   root: {\n\n//   }\n// }))\n\nexport const SeriesListItemCosmos = (props) => {\n  // const classes = useCosmosStyles()\n  return (\n    <List disablePadding dense>\n      <SeriesListItem {...props} />\n    </List>\n  )\n}\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport Typography from '@material-ui/core/Typography'\nimport IconButton from '@material-ui/core/IconButton'\nimport List from '@material-ui/core/List'\n\nimport ZoomOutMapIcon from '@material-ui/icons/ZoomOutMap'\nimport ViewListIcon from '@material-ui/icons/ViewList'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\n\nconst style = theme => ({\n  root: {\n\n  },\n  listItemText: {\n    textAlign: 'center'\n  },\n  iconButton: {\n    background: theme.palette.grey[200]\n  },\n  compoundButton: {\n    textAlign: 'center'\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst ClusterSelected = ({ seriesCount, reducedPhotoCount, onZoomTo, onViewList, onClose }) => {\n  const classes = useStyles()\n  console.log('cluster selected', { seriesCount, reducedPhotoCount })\n  return (\n    <List>\n      <ListItem className={classes.root}>\n        <ListItemIcon>\n          <div className={classes.compoundButton}>\n            <IconButton onClick={onZoomTo} className={classes.iconButton}>\n              <ZoomOutMapIcon />\n            </IconButton>\n            <Typography variant='caption' component='div' >Zoom In</Typography>\n          </div>\n        </ListItemIcon>\n        <ListItemText\n          className={classes.listItemText}\n          onClick={onZoomTo}\n          primary={`${seriesCount} Photo series`}\n          secondary={`containing ${reducedPhotoCount} individual photo${reducedPhotoCount === 1 ? '' : 's'}`}\n        />\n        <ListItemIcon>\n          <div className={classes.compoundButton}>\n            <IconButton onClick={onViewList} className={classes.iconButton} >\n              <ViewListIcon />\n            </IconButton>\n            <Typography variant='caption' component='div' >List</Typography>\n          </div>\n        </ListItemIcon>\n      </ListItem>\n    </List>\n  )\n}\n\nClusterSelected.propTypes = {\n  seriesCount: PropTypes.number.isRequired,\n  reducedPhotoCount: PropTypes.number.isRequired,\n  onZoomTo: PropTypes.func.isRequired,\n  onViewList: PropTypes.func.isRequired,\n  onClose: PropTypes.func.isRequired\n}\n\nexport default ClusterSelected\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport Dialog from '@material-ui/core/Dialog'\nimport Typography from '@material-ui/core/Typography'\nimport IconButton from '@material-ui/core/IconButton'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport SeriesListItem from './SeriesListItem'\n\nimport CloseIcon from '@material-ui/icons/Close'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { List } from '@material-ui/core'\n\nconst style = theme => ({\n  root: {\n\n  },\n  title: {\n    background: theme.palette.primary.main,\n    color: theme.palette.primary.contrastText,\n    alignSelf: 'flex-start',\n    width: '100%',\n    margin: 0,\n    display: 'flex',\n    padding: theme.spacing(2)\n  },\n  dlgTitle: {\n    flexGrow: 1\n  },\n  closeButton: {\n    padding: 0,\n    alignSelf: 'flex-start'\n    // color: theme.palette.grey[500]\n  },\n  list: {\n    overflowX: 'hidden',\n    overflowY: 'scroll'\n  }\n})\n\nconst useStyles = makeStyles(style)\n\nconst ViewListDialog = ({ title, seriesList, onSelect, onClose, open }) => {\n  const classes = useStyles()\n  return (\n    <Dialog\n      className={classes.root}\n      fullWidth\n      open={open}\n      onClose={onClose}\n      maxWidth='xl'\n      aria-labelledby='confirmation-dialog-title'\n    >\n      <DialogTitle className={classes.title} disableTypography>\n        <Typography className={classes.dlgTitle}>{title}</Typography>\n        <IconButton color='inherit' className={classes.closeButton} onClick={onClose}>\n          <CloseIcon color='inherit' />\n        </IconButton>\n      </DialogTitle>\n      <List className={classes.list} dense disablePadding>\n        {seriesList.map(series => (\n          <SeriesListItem\n            key={`series${series.id}`}\n            series={series}\n            small\n            onClick={() => onSelect(series.id)}\n          />\n        ))}\n      </List>\n    </Dialog>\n  )\n}\n\nViewListDialog.propTypes = {\n  open: PropTypes.bool,\n  title: PropTypes.string.isRequired,\n  seriesList: PropTypes.array.isRequired,\n  onSelect: PropTypes.func.isRequired,\n  onClose: PropTypes.func.isRequired\n}\n\nexport default ViewListDialog\n","import React from 'react'\nimport classNames from 'classnames'\nimport PropTypes from 'prop-types'\nimport Typography from '@material-ui/core/Typography'\nimport Badge from '@material-ui/core/Badge'\nimport Avatar from '@material-ui/core/Avatar'\nimport Camera from '@material-ui/icons/Camera'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { ACCESS } from '../../../config'\n\nconst style = theme => ({\n  root: {\n    color: theme.palette.primary.main,\n    width: 150,\n    position: 'absolute',\n    top: '50%',\n    left: '50%',\n    textAlign: 'center',\n    transformOrigin: '50% 50%',\n    transform: 'translateY(-50%) translateX(-50%)'\n  },\n  rootActive: {\n    zIndex: 60\n  },\n  icon: {\n    // height: 16,\n    // width: 16\n  },\n  avatar: {\n    position: 'relative',\n    margin: '0 auto',\n    background: 'green',\n    color: 'white',\n    border: '2px solid white',\n    height: 40,\n    width: 40,\n    zIndex: 61,\n    '&.PUBLIC': { background: ACCESS.PUBLIC.color },\n    '&.PRIVATE': { background: ACCESS.PRIVATE.color },\n    '&.OPEN': { background: ACCESS.OPEN.color }\n  },\n  avatarActive: {\n    background: '#FFFF00',\n    color: 'black',\n    border: `2px solid black`,\n    '&.PUBLIC': { background: '#FFFF00' },\n    '&.PRIVATE': { background: '#FFFF00' },\n    '&.OPEN': { background: '#FFFF00' }\n  },\n  badge: {\n    zIndex: 62,\n    color: theme.palette.secondary.contrastText,\n    background: theme.palette.secondary.main,\n    transform: 'scale(1) translate(30%, -30%)'\n  },\n  badgeActive: {\n    color: theme.palette.primary.contrastText,\n    background: theme.palette.primary.main\n  },\n  directionIndicator: {\n    position: 'absolute',\n    top: 20,\n    left: '50%',\n    // transformOrigin: '50% 50%',\n    // transform: 'translateY(-50%) translateX(-50%)',\n    zIndex: 59\n  },\n  name: {\n    color: 'white',\n    fontWeight: 'bold',\n    textShadow: `\n        0px 0px 4px #000000, \n        0px 0px 4px #000000 \n    `,\n    zIndex: 60,\n    position: 'relative'\n    // textStroke: '1px white'\n  },\n  nameActive: {\n    color: 'black',\n    textShadow: `\n    0px 0px 2px #FFFFFF, \n    0px 0px 2px #FFFFFF,\n    0px 0px 4px #FFFFFF \n`\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst Single = ({ name, access, onClick, active, photoCount, direction }) => {\n  const classes = useStyles()\n  return (\n    <div className={classNames(classes.root, active ? classes.rootActive : null, access)}>\n      <Badge classes={{ badge: classNames(classes.badge, active ? classes.badgeActive : null, access) }} badgeContent={photoCount}>\n        <Avatar className={classNames(classes.avatar, active ? classes.avatarActive : null, access)} onClick={onClick}>\n          <Camera className={classes.icon} color='inherit' />\n        </Avatar>\n      </Badge>\n      {direction && direction >= 0 ? (\n        <div className={classes.directionIndicator}>\n          <svg className={classes.svgArc}\n            version='1.1'\n            width='100'\n            height='100'\n            viewBox='0, 0, 100, 100'\n            style={{ transform: `translateY(-50%) translateX(-50%) rotateZ(${direction}deg)` }}>\n            <path d='M50,0 C60.946,0.151 72.136,3.514 80.675,10.56 L50,50 L19.325,10.56 C27.938,3.461 39,0.278 50,0 z'\n              fill='#009DC1'\n              fillOpacity='0.444'\n              strokeWidth='1'\n              strokeOpacity='0.6'\n              stroke='#FFFFFF'\n            />\n          </svg>\n        </div>\n      ) : null}\n      <Typography variant='body1' className={classNames(classes.name, active ? classes.nameActive : null)}>\n        {name}\n      </Typography>\n    </div>\n  )\n}\n\nSingle.propTypes = {\n  access: PropTypes.string,\n  name: PropTypes.string,\n  photoCount: PropTypes.number,\n  onClick: PropTypes.func.isRequired,\n  direction: PropTypes.number,\n  active: PropTypes.bool\n}\n\nexport default Single\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\nimport Avatar from '@material-ui/core/Avatar'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport numeral from 'numeral'\n\nconst style = theme => ({\n  avatar: {\n    background: theme.palette.grey[900],\n    border: `2px solid ${theme.palette.grey[100]}`,\n    color: theme.palette.grey[100]\n  },\n  avatarActive: {\n    background: '#FFFF00',\n    border: `2px solid black`,\n    color: 'black',\n    zIndex: 50\n  }\n})\nconst useStyles = makeStyles(style)\n\nconst Cluster = ({ seriesCount, active, onClick }) => {\n  const classes = useStyles()\n  return (\n    <Avatar onClick={onClick} className={classNames(classes.avatar, active ? classes.avatarActive : null)}>\n      {numeral(seriesCount).format('0,0')}\n    </Avatar>\n  )\n}\n\nCluster.propTypes = {\n  seriesCount: PropTypes.number,\n  onClick: PropTypes.func.isRequired,\n  active: PropTypes.bool\n}\n\nexport default Cluster\n","\nimport React, { useState, useMemo, useRef, useEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport Paper from '@material-ui/core/Paper'\n// import Typography from '@material-ui/core/Typography'\nimport { FlyToInterpolator, LinearInterpolator, Marker } from 'react-map-gl'\nimport { easeCubic } from 'd3-ease'\nimport { CircularProgress } from '@material-ui/core'\nimport MapStyles from '../../mapStyles'\n\nimport BaseMap from './BaseMap'\nimport useClusteredData from '../../lib/useClusteredData'\nimport { bbox, featureCollection, buffer, point } from '@turf/turf'\nimport { makeStyles } from '@material-ui/core/styles'\n// import { debounce } from '../../lib/util'\nimport style from './HomeMap.style'\n\nimport TopBar from '../TopBar'\nimport SearchInput from '../Search/SearchInput'\nimport SeriesListItem from '../misc/SeriesListItem'\nimport ClusterSelected from '../misc/ClusterSelected'\nimport ViewListDialog from '../misc/ViewListDialog'\n\nimport SingleMarker from './markers/Single'\nimport ClusterMarker from './markers/Cluster'\n\nconst useStyles = makeStyles(style)\n\nconst defaultView = {\n  zoom: 4,\n  latitude: 44.629701,\n  longitude: -120.333379\n}\n\nconst SIZESCALE = 80\n\nconst HomeMap = ({\n  seriesList, initViewport, loading, activeSeries, queryVersion,\n  onSeriesNavigate, onSeriesMapSelect, onSearchClick,\n  popMapHistory, pushMapHistory, clearMapHistory\n}) => {\n  const [mapViewObj, setMapViewObj] = useState({\n    viewport: { ...defaultView, ...initViewport.viewport },\n    bounds: initViewport.bounds,\n    filterBounds: null\n  })\n\n  const classes = useStyles()\n  const mapViewRef = useRef()\n  const [isTransitioning, setIsTransitioning] = useState(false)\n  const homeMapContainerRef = useRef()\n\n  const [currentZoom, setCurrentZoom] = useState(0)\n  const [showViewList, setShowViewList] = useState(false)\n  const [transitions, setTransitions] = useState(null)\n  const [selectedItem, setSelectedItem] = useState()\n\n  // This custom hook is heavily debounced\n  const { filteredClusteredData } = useClusteredData(\n    seriesList || [],\n    mapViewObj.filterBounds,\n    currentZoom,\n    mapViewObj.viewport,\n    SIZESCALE,\n    queryVersion,\n    isTransitioning\n  )\n\n  // If we're coming back to the map with something aleady selected then we need to\n  // reselect the series we had before\n  useEffect(() => {\n    if (!activeSeries || !seriesList || selectedItem) return\n    try {\n      const selected = seriesList.find(s => s.id === activeSeries)\n      if (selected && selected.coords) {\n        const bufferPts = buffer(point(selected.coords), 10, { units: 'meters' })\n        const bounds = bbox(bufferPts)\n        setMapViewObj({ ...mapViewObj, bounds })\n      }\n    }\n    catch (e) {\n      console.error(e)\n    }\n  }, [seriesList])\n\n  // When we load data, we should reselect the activeSeries if we need to\n  // Once we have the zoom in place we might need to select an initial series\n  useEffect(() => {\n    if (!activeSeries || !filteredClusteredData.single || selectedItem) return\n    try {\n      const selected = filteredClusteredData.single.find(s => s.properties.id === activeSeries)\n      if (selected && homeMapContainerRef.current) setSelectedItem(selected)\n    }\n    catch (e) {\n      console.error(e)\n    }\n  }, [filteredClusteredData.single])\n\n  const saveMap = (delay) => {\n    const {\n      transitionDuration,\n      transitionInterpolator,\n      transitionInterruption,\n      maxZoom,\n      minZoom,\n      maxPitch,\n      minPitch,\n      ...newView\n    } = mapViewRef.current ? mapViewRef.current : mapViewObj.viewport\n    const saveObj = { viewport: newView }\n    if (!delay) pushMapHistory(saveObj)\n    else {\n      setTimeout(() => pushMapHistory(saveObj), delay)\n    }\n  }\n\n  const updateSelectedItem = (item) => {\n    // regardless, set the map selected Item\n    setSelectedItem(item)\n    // update the global active series if this is a single and not a cluster\n    if (item && item.properties.count === 1) onSeriesMapSelect(item.properties.id)\n    else onSeriesMapSelect()\n    saveMap()\n  }\n\n  const onZoomTo = (object) => {\n    try {\n      const pts = featureCollection(object.properties.points)\n      let bounds = bbox(pts)\n      // If all points have the same BBOX this won't work\n      if (bounds[0] === bounds[2] && bounds[1] === bounds[3]) {\n        const paddedPoint = buffer(point([bounds[0], bounds[1]]), 10, { units: 'meters' })\n        bounds = bbox(paddedPoint)\n      }\n      // buffer a further 10%\n      const lngBuff = (bounds[2] - bounds[0]) * 0.2\n      const latBuff = (bounds[3] - bounds[1]) * 0.2\n      const buffBounds = [\n        bounds[0] - lngBuff,\n        bounds[1] - latBuff,\n        bounds[2] + lngBuff,\n        bounds[3] + latBuff\n      ]\n\n      setTransitions({\n        transitionDuration: 2000,\n        transitionInterpolator: new FlyToInterpolator(),\n        transitionEasing: easeCubic\n      })\n      setMapViewObj({ ...mapViewObj, bounds: buffBounds })\n      if (object.properties.count > 1) setTimeout(() => updateSelectedItem(null), 2000)\n    }\n    catch (e) {\n      console.error(e)\n    }\n  }\n\n  const onViewportChange = ({ viewport, map }) => {\n    mapViewRef.current = viewport\n    // mapViewObj\n    // {\n    //   \"_sw\": {\n    //     \"lng\": -120.40788003760076,\n    //     \"lat\": 44.609051464438835\n    //   },\n    //   \"_ne\": {\n    //     \"lng\": -120.25887796240545,\n    //     \"lat\": 44.65034319161438\n    //   }\n    // minX, minY, maxX, maxY\n    // [W-122.87948116236043, S26.15346805640254, E-82.00799782432676, N47.3795453070757]\n    const viewZoom = Math.floor(viewport.zoom)\n    if (!isTransitioning && map && map.getBounds) {\n      const { _sw: { lng: minLng, lat: minLat }, _ne: { lng: maxLng, lat: maxLat } } = map.getBounds()\n      const [oldMinLng, oldMinLat, oldMaxLng, oldMaxLat] = mapViewObj.filterBounds || [minLng, minLat, maxLng, maxLat]\n      if (viewZoom !== currentZoom ||\n        oldMinLng >= minLng || oldMinLat >= minLat ||\n        oldMaxLng <= maxLng || oldMaxLat <= maxLat\n      ) {\n        const filterBounds = [\n          minLng - (maxLng - minLng) / 2,\n          minLat - (maxLat - minLat) / 2,\n          maxLng + (maxLng - minLng) / 2,\n          maxLat + (maxLat - minLat) / 2\n        ]\n        setMapViewObj({ ...mapViewObj, filterBounds })\n      }\n    }\n    if (viewZoom !== currentZoom) {\n      setCurrentZoom(viewZoom)\n    }\n  }\n  // Debounce this to improve performance\n  // const onViewportChangeDebounced = useCallback(debounce(onViewportChange, 300), [])\n\n  const lock = {}\n\n  const onMarkerClick = (obj) => {\n    // Second click zooms\n    if (selectedItem && selectedItem.properties.id === obj.properties.id) {\n      onZoomTo(selectedItem)\n    }\n    else {\n      setTransitions({\n        transitionDuration: 500,\n        transitionInterpolator: new LinearInterpolator(),\n        transitionEasing: easeCubic\n      })\n      setMapViewObj({\n        viewport: {\n          longitude: obj.geometry.coordinates[0],\n          latitude: obj.geometry.coordinates[1]\n        }\n      })\n    }\n    updateSelectedItem(obj)\n  }\n\n  // This one should be debounced by filteredClusteredData\n  const markersRendered = useMemo(() => ([\n    ...filteredClusteredData.single\n      .filter(obj => !isTransitioning || (selectedItem && selectedItem.properties.id === obj.properties.id))\n      .map(obj => (\n        <Marker\n          className={'singleMarker'}\n          key={`single-${obj.properties.id}`}\n          latitude={obj.geometry.coordinates[1]}\n          longitude={obj.geometry.coordinates[0]}\n          offsetLeft={0}\n          offsetTop={-20}\n        >\n          <SingleMarker name={obj.properties.name}\n            access={obj.properties.access}\n            photoCount={obj.properties.photoCount}\n            onClick={() => onMarkerClick(obj)}\n            direction={currentZoom > 10 && obj.properties.direction ? obj.properties.direction : null}\n            active={selectedItem && selectedItem.properties.id === obj.properties.id}\n          />\n        </Marker>\n      )),\n    ...filteredClusteredData.cluster\n      .filter(obj => !isTransitioning || (\n        selectedItem &&\n      selectedItem.properties.id === obj.properties.id &&\n      selectedItem.properties.count === obj.properties.count\n      ))\n      .map(obj => (\n        <Marker\n          className='clusterMarker'\n          key={`cluster-${obj.properties.id}`}\n          latitude={obj.geometry.coordinates[1]}\n          longitude={obj.geometry.coordinates[0]}\n          offsetLeft={-20}\n          offsetTop={-20}\n        >\n          <ClusterMarker\n            seriesCount={obj.properties.count}\n            photoCount={obj.properties.reducedPhotoCount}\n            onClick={() => onMarkerClick(obj)}\n            active={\n              selectedItem &&\n            selectedItem.properties.id === obj.properties.id &&\n            selectedItem.properties.count === obj.properties.count\n            }\n          />\n        </Marker>\n      ))\n  ]), [filteredClusteredData, selectedItem, isTransitioning])\n\n  const selectedItemRender = useMemo(() => !!selectedItem && (\n    <Paper className={classes.selectedPopup}>\n      {selectedItem.properties.count === 1\n        ? <SeriesListItem\n          series={selectedItem.properties}\n          showCreatedOn\n          showLastPhoto\n          onClick={() => onSeriesNavigate(selectedItem.properties.id)}\n        />\n        : <ClusterSelected\n          seriesCount={selectedItem.properties.count}\n          reducedPhotoCount={selectedItem.properties.reducedPhotoCount}\n          onViewList={() => setShowViewList(true)}\n          onClose={() => updateSelectedItem(null)}\n          onZoomTo={() => onZoomTo(selectedItem)}\n        />\n      }\n    </Paper>\n  ), [selectedItem])\n\n  return (\n    <div className={classes.root} ref={homeMapContainerRef}>\n      <TopBar isTransparent className={classes.topBar}>\n        <SearchInput\n          isTransparent\n          onClick={onSearchClick}\n          defaultValue={''}\n        />\n      </TopBar>\n      {loading && (\n        <div className={classes.loadingWrapper}>\n          <CircularProgress size={80} thickness={7} color='inherit' />\n          {/* <Typography variant='h3' color='inherit'>Loading...</Typography> */}\n        </div>\n      )}\n\n      <BaseMap\n        showMe\n        // This should only change on INIT or transition events\n        viewport={mapViewObj.viewport}\n        transitions={transitions}\n        mapStyles={MapStyles}\n        controlPadding={{ top: 56 }}\n        initStyle={MapStyles.length > 1 ? 1 : 0}\n        {...lock}\n        onTransitionStart={() => {\n          setIsTransitioning(true)\n        }}\n        onTransitionEnd={() => {\n          setIsTransitioning(false)\n          setTransitions(null)\n        }}\n        bounds={mapViewObj.bounds}\n        maxZoom={20}\n        minZoom={1}\n        onViewportChange={onViewportChange}\n        onNativeClick={() => {\n          if (selectedItem) updateSelectedItem(null)\n        }}\n      >\n        {markersRendered}\n      </BaseMap>\n      {selectedItem && selectedItem.properties.count > 1 && (\n        <ViewListDialog\n          open={showViewList}\n          title={`${selectedItem.properties.count} Series`}\n          onClose={() => setShowViewList(false)}\n          onSelect={onSeriesNavigate}\n          seriesList={selectedItem.properties.points.map(p => p.properties)}\n        />\n      )}\n      {selectedItemRender}\n    </div>\n  )\n}\n\nHomeMap.propTypes = {\n  seriesList: PropTypes.array,\n  queryVersion: PropTypes.number,\n  activeSeries: PropTypes.string,\n  initViewport: PropTypes.object,\n  loading: PropTypes.bool,\n  // These all get loaded up through mapFuncs in HomeMap.connect\n  onSearchClick: PropTypes.func,\n  onSeriesNavigate: PropTypes.func,\n  onSeriesMapSelect: PropTypes.func,\n  popMapHistory: PropTypes.func,\n  pushMapHistory: PropTypes.func,\n  clearMapHistory: PropTypes.func\n}\n\nexport default HomeMap\n\n// function getInitialState (initViewport) {\n//   return {\n//     viewport: { ...defaultView, ...initViewport.viewport },\n//     bounds: initViewport.bounds,\n//     filterBounds: null\n//   }\n// }\n","import React, { useEffect, useState, useRef, useMemo } from 'react'\nimport PropTypes from 'prop-types'\nimport { connect } from 'react-redux'\nimport { graphql } from 'react-apollo'\nimport { allSeries, pollQuery } from '../graphql/queries'\nimport actions from '../redux/actions'\nimport { home } from '../config'\nimport HomeMap from '../components/maps/HomeMap'\n\nconst POLL_INTERVAL = 20 // (seconds)\n\n/**\n * The outer component handles the lastCheck variable which, when changed will\n * cause the poll event\n */\nconst HomeMapConnector = ({ initViewport, activeSeries, mapFuncs }) => {\n  const [seriesProps, setSeriesProps] = useState()\n  const [queryVersion, setVersion] = useState(0)\n  const updateIncrement = () => setVersion(queryVersion + 1)\n  const timerRef = useRef()\n  const [lastCheck, setLastCheck] = useState(null)\n  timerRef.current = lastCheck\n\n  // These are expensive queries so we render them memoized to prevent erroneous re-renders\n  const allSeriesQUERY = useMemo(() => <AllSeriesConnect setSeriesProps={setSeriesProps} />, [])\n  const pollSeriesQUERY = useMemo(() => <PollQueryConnect lastCheck={lastCheck} seriesProps={seriesProps} updateIncrement={updateIncrement} />, [lastCheck])\n\n  // Initiate the polling process. We simply update the timestamp every N seconds\n  useEffect(() => {\n    if (!seriesProps) return\n    function ping () {\n      if (timerRef.current) setLastCheck(String(Date.now() - POLL_INTERVAL * 1000))\n    }\n    if (!timerRef.current && seriesProps.readyForPolling) timerRef.current = setInterval(ping, POLL_INTERVAL * 1000)\n    return () => {\n      if (timerRef.current) {\n        console.log('clear poll timer')\n        clearInterval(timerRef.current)\n        timerRef.current = null\n      }\n    }\n  }, [seriesProps])\n\n  return (\n    <React.Fragment>\n      {allSeriesQUERY}\n      {pollSeriesQUERY}\n      <HomeMap\n        queryVersion={queryVersion}\n        seriesList={seriesProps && seriesProps.allSeries ? seriesProps.allSeries.seriesSummaries : []}\n        activeSeries={activeSeries}\n        initViewport={initViewport}\n        loading={seriesProps && seriesProps.loading}\n        {...mapFuncs}\n      />\n    </React.Fragment>\n  )\n}\nHomeMapConnector.propTypes = {\n  activeSeries: PropTypes.string, // from redux\n  initViewport: PropTypes.object, // from redux\n  mapFuncs: PropTypes.object // from redux passed straight through to the map\n\n}\n\nconst withAllSeries = graphql(allSeries, {\n  props: ({ data, ownProps }) => {\n    // If there's more data to load we should go get another batch\n    if (!data.loading && !data.error && data.allSeries && data.allSeries.seriesSummaries.length > 0 && data.allSeries.nextToken) {\n      data.fetchMore({\n        variables: { ...data.variables, nextToken: data.allSeries.nextToken },\n        // How do we mush the new query with the old one\n        updateQuery: (prev, { fetchMoreResult }) => {\n          return {\n            allSeries: {\n              ...fetchMoreResult.allSeries,\n              seriesSummaries: [ ...prev.allSeries.seriesSummaries, ...fetchMoreResult.allSeries.seriesSummaries ]\n            }\n          }\n        }\n      })\n    }\n    else if (data.loading || data.error) {\n      ownProps.setSeriesProps(data)\n    }\n    else {\n      ownProps.setSeriesProps({ ...data, readyForPolling: true })\n    }\n    return null\n  },\n  options: {\n    variables: { limit: 100 }\n  }\n})\n\n/**\n * Here's the graphql HOC that gets an individual series\n */\nconst withPollQuery = graphql(pollQuery, {\n  skip: ({ lastCheck, online }) => !lastCheck || !online,\n  props: ({ data, ownProps: { seriesProps, updateIncrement } }) => {\n    if (data.error) {\n      console.log('POLL FAIL', data.error, data)\n      console.error(data.error)\n    }\n    if (!data.loading && data.changedSeries && data.changedSeries.seriesSummaries) {\n      // console.log('POLLING', { data, seriesProps })\n      const newData = data.changedSeries.seriesSummaries\n      const oldList = seriesProps.allSeries.seriesSummaries\n\n      // If the polling has begun and we have some good polling data back then\n      // Process it and decide if we need to incorporate it\n      if (data.changedSeries) {\n        let newSeriesSummaries = seriesProps.allSeries.seriesSummaries\n        newData.forEach(({ seriesStatus, ...polledSeries }) => {\n          if (seriesStatus === 'deleted') {\n            console.log('Polling found a series to delete: ', polledSeries.id)\n            newSeriesSummaries = oldList.filter(s => s.id !== polledSeries.id)\n          }\n          else {\n            const idx = oldList.findIndex(ds => ds.id === polledSeries.id)\n            if (idx >= 0) {\n              console.log('Polling found a series to Update: ', polledSeries.id)\n              newSeriesSummaries = oldList.map((oldSeries, oldId) => oldId === idx ? polledSeries : oldSeries)\n            }\n            else {\n              console.log('Polling found a series to add: ', polledSeries.id)\n              newSeriesSummaries = [...oldList, polledSeries]\n            }\n          }\n          seriesProps.updateQuery((data, options) => {\n            try {\n              const newData = { ...data }\n              newData.allSeries.seriesSummaries = newSeriesSummaries\n              updateIncrement()\n              return data\n            }\n            catch (e) {\n              console.error(e)\n              return data\n            }\n          })\n        })\n      }\n    }\n    return null\n  },\n  options: ({ lastCheck }) => ({\n    variables: {\n      limit: 100,\n      lastCheck\n    }\n  })\n})\n\n// We're using graphql() HOC because it's convenient but it doesn't need to render anything\nconst AllSeriesConnect = withAllSeries(() => null)\nconst PollQueryConnect = withPollQuery(() => null)\n\n// The only part of the state the main view caes about is teh window\nconst mapStateToProps = (state, props) => {\n  const { current: { activeSeries } } = state.home\n  const initViewport = state.map.slice(-1).pop()\n  return { activeSeries, initViewport }\n}\n\n// There are a few presentational actions the main window can use\nconst mapDispatchToProps = dispatch => ({\n  mapFuncs: {\n    onSeriesNavigate: (activeSeries) => {\n      dispatch(actions.setHomeState(home.AppStateTypes.SERIES, { activeSeries }))\n    },\n    onSeriesMapSelect: (activeSeries) => {\n      dispatch(actions.setActiveSeries(activeSeries))\n    },\n    onSearchClick: () => {\n      dispatch(actions.setHomeState(home.AppStateTypes.SEARCH, { search: { tab: home.SEARCH_TABS.LOCATION, text: '' } }))\n    },\n    popMapHistory: () => {\n      dispatch(actions.popMapHistory())\n    },\n    pushMapHistory: (viewportSave) => {\n      dispatch(actions.pushMapHistory(viewportSave))\n    },\n    clearMapHistory: () => {\n      dispatch(actions.clearMapHistory())\n    }\n  }\n})\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(HomeMapConnector)\n","import React from 'react'\nimport classNames from 'classnames'\nimport PropTypes from 'prop-types'\nimport List from '@material-ui/core/List'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemAvatar from '@material-ui/core/ListItemAvatar'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\nimport IconButton from '@material-ui/core/IconButton'\nimport Avatar from '@material-ui/core/Avatar'\n\nimport PlaceIcon from '@material-ui/icons/Place'\nimport PersonIcon from '@material-ui/icons/Person'\nimport LabelIcon from '@material-ui/icons/Label'\nimport CancelIcon from '@material-ui/icons/Cancel'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport { Typography } from '@material-ui/core'\nconst useStyles = makeStyles(theme => ({\n  root: {\n\n  },\n  chosenItem: {\n    color: theme.palette.primary.contrastText,\n    background: theme.palette.primary.dark\n  },\n  avatar: {\n    background: theme.palette.primary.main\n  },\n  closeIcon: {\n    color: theme.palette.primary.contrastText,\n    paddingRight: 0\n  },\n  avatarImg: {\n    height: '100%',\n    width: '100%',\n    objectFit: 'cover'\n  }\n}))\n\nconst SearchContextItem = ({ className, variant, name, description, gravatar, onClick, onCancel }) => {\n  const classes = useStyles()\n  let TheIcon = PlaceIcon\n\n  const getAvatar = (src) => () => (\n    <Avatar className={classes.avatar}>\n      <img className={classes.avatarImg} alt='profile' src={src} />\n    </Avatar>\n  )\n\n  switch (variant) {\n    case 'tag':\n      TheIcon = LabelIcon\n      break\n    case 'location':\n      TheIcon = PlaceIcon\n      break\n    case 'user':\n      TheIcon = gravatar ? getAvatar(gravatar) : PersonIcon\n      break\n    default:\n      break\n  }\n  return (\n    <ListItem\n      className={classNames(className, classes.root, onCancel ? classes.chosenItem : null)}\n      button={!!onClick}\n      onClick={onClick}\n    >\n      <ListItemAvatar>\n        <Avatar className={classes.avatar}>\n          <TheIcon color='inherit' />\n        </Avatar>\n      </ListItemAvatar>\n      <ListItemText disableTypography>\n        <Typography variant='body1' color='inherit'>{name}</Typography>\n        <Typography variant='body2' color='inherit'>{description}</Typography>\n      </ListItemText>\n      {onCancel && (\n        <ListItemIcon>\n          <IconButton onClick={onCancel} className={classes.closeIcon}>\n            <CancelIcon color='inherit' />\n          </IconButton>\n        </ListItemIcon>\n      )}\n    </ListItem>\n  )\n}\n\nSearchContextItem.propTypes = {\n  variant: PropTypes.oneOf(['tag', 'location', 'user']),\n  onClick: PropTypes.func,\n  gravatar: PropTypes.string,\n  className: PropTypes.string,\n  name: PropTypes.string.isRequired,\n  description: PropTypes.string,\n  onCancel: PropTypes.func\n}\n\nexport default SearchContextItem\n\nexport const SearchContexItemCosmos = () => {\n  return (\n    <List>\n      <SearchContextItem variant='tag' name='SomeTag' description='Some description of what I am' />\n      <SearchContextItem variant='location' name='Some Location' description='Some description of what I am' />\n      <SearchContextItem variant='user' name='User McUserSon' description='Some description of what I am' />\n    </List>\n  )\n}\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport List from '@material-ui/core/List'\nimport Typography from '@material-ui/core/Typography'\n\nimport SearchContextItem from './SearchContextItem'\n// import MenuIcon from '@material-ui/icons/Menu'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    height: '100%',\n    backgroundColor: theme.palette.background.paper,\n    position: 'relative',\n    overflowX: 'hidden',\n    overflowY: 'scroll',\n    flexGrow: 1\n  },\n  listSection: {\n    backgroundColor: 'inherit'\n  },\n  placeholderText: {\n    textAlign: 'center',\n    padding: theme.spacing(3, 1),\n    color: theme.palette.grey[400]\n  },\n  ul: {\n    backgroundColor: 'inherit',\n    padding: 0\n  }\n}))\n\nconst SearchContextResults = ({ variant, loading, contextResults, setContextChoice }) => {\n  const classes = useStyles()\n  if (loading) {\n    return <Typography className={classes.placeholderText} variant='h3'>Searching...</Typography>\n  }\n  else if (!contextResults || contextResults.length === 0) {\n    return <Typography className={classes.placeholderText} variant='h4'>No {variant} results</Typography>\n  }\n\n  return (\n    <List className={classes.root}>\n      {contextResults.map((cr, idx) => (\n        <SearchContextItem\n          key={`scr-${idx}`}\n          variant={variant}\n          onClick={() => setContextChoice(cr)}\n          {...cr}\n        />\n      ))}\n    </List>\n  )\n}\n\nSearchContextResults.propTypes = {\n  variant: PropTypes.oneOf(['tag', 'location', 'user']),\n  loading: PropTypes.bool,\n  contextResults: PropTypes.array.isRequired,\n  setContextChoice: PropTypes.func.isRequired\n}\n\nexport default SearchContextResults\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport Typography from '@material-ui/core/Typography'\n// import MenuIcon from '@material-ui/icons/Menu'\nimport { makeStyles } from '@material-ui/core/styles'\nconst useStyles = makeStyles(theme => ({\n  root: {\n    textAlign: 'center',\n    fontStyle: 'italic',\n    padding: theme.spacing(2, 1)\n  }\n}))\n\nconst SearchEnder = ({ style, icon, text }) => {\n  const classes = useStyles()\n  return (\n    <Typography className={classes.root} variant='subtitle1' color='textSecondary' component='div' style={style}>\n      {icon}\n      {text}\n    </Typography>\n  )\n}\n\nSearchEnder.propTypes = {\n  style: PropTypes.object,\n  icon: PropTypes.any,\n  text: PropTypes.string\n}\n\nexport default SearchEnder\n","import React, { useRef, useEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport List from '@material-ui/core/List'\nimport Typography from '@material-ui/core/Typography'\n\nimport SearchContextItem from './SearchContextItem'\nimport SearchEnder from './SearchEnder'\n// import MenuIcon from '@material-ui/icons/Menu'\nimport { makeStyles } from '@material-ui/core/styles'\nimport SeriesListItem from '../misc/SeriesListItem'\nimport { debounce } from '../../lib/util'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    height: '100%',\n    flexGrow: 1,\n    display: 'flex',\n    flexDirection: 'column',\n    overflow: 'hidden'\n  },\n  ctxItem: {\n    flexGrow: 0\n  },\n  list: {\n    flexGrow: 1,\n    backgroundColor: theme.palette.background.paper,\n    position: 'relative',\n    overflowX: 'hidden',\n    overflowY: 'scroll'\n  },\n  placeholderText: {\n    textAlign: 'center',\n    padding: theme.spacing(3, 1),\n    color: theme.palette.grey[400]\n  },\n  listSection: {\n    backgroundColor: 'inherit'\n  },\n  ul: {\n    backgroundColor: 'inherit',\n    padding: 0\n  }\n}))\n\nconst SearchResults = ({ variant, loading, seriesList, contextChoice, onCancel, onResultClick, fetchMore }) => {\n  const classes = useStyles()\n  const listRef = useRef()\n  const enderRef = useRef()\n\n  const handleScroll = debounce(() => {\n    if (!loading && fetchMore && enderRef.current && listRef.current) {\n      const { offsetTop } = enderRef.current\n      const { scrollTop, offsetHeight } = listRef.current\n      const scrollBottom = offsetHeight + scrollTop\n      if (offsetTop < scrollBottom * 2) {\n        console.log('SCROLL', { offsetHeight, scrollTop, offsetTop })\n        fetchMore()\n      }\n    }\n  }, 500)\n\n  useEffect(handleScroll, [seriesList])\n\n  let content = null\n  if (loading) {\n    content = (\n      <Typography className={classes.placeholderText} variant='h3'>Searching...</Typography>\n    )\n  }\n  else if (seriesList && seriesList.length > 0) {\n    content = seriesList.map((series, idx) => (\n      <SeriesListItem\n        key={`series-${idx}`}\n        series={series}\n        onClick={() => onResultClick(series.id)}\n        showCreatedOn\n        showLastPhoto\n      />\n    ))\n    content.push(\n      <div key='ender' ref={enderRef}>\n        <SearchEnder text={fetchMore ? 'Loading...' : 'No More Results'} />\n      </div>\n    )\n  }\n  else {\n    content = (\n      <Typography className={classes.placeholderText} variant='h4'>No series found</Typography>\n    )\n  }\n\n  return (\n    <div className={classes.root}>\n      <SearchContextItem className={classes.ctxItem} {...contextChoice} variant={variant} onCancel={onCancel} />\n      <List className={classes.list} subheader={<li />} onScroll={handleScroll} innerRef={listRef}>\n        {content}\n      </List>\n    </div>\n  )\n}\n\nSearchResults.propTypes = {\n  variant: PropTypes.oneOf(['tag', 'location', 'user']),\n  seriesList: PropTypes.array.isRequired,\n  loading: PropTypes.bool,\n  contextChoice: PropTypes.object.isRequired,\n  onResultClick: PropTypes.func.isRequired,\n  onCancel: PropTypes.func.isRequired,\n  fetchMore: PropTypes.func\n}\n\nexport default SearchResults\n","import React from 'react'\nimport PropTypes from 'prop-types'\n\nimport Typography from '@material-ui/core/Typography'\n// import MenuIcon from '@material-ui/icons/Menu'\nimport { makeStyles } from '@material-ui/core/styles'\nconst useStyles = makeStyles(theme => ({\n  root: {\n    flexGrow: 1,\n    padding: '10%',\n    display: 'flex',\n    flexDirection: 'column',\n    opacity: 0.3,\n    textAlign: 'center'\n  },\n  icon: {\n    width: '100%',\n    flex: '1 1 40%',\n    color: theme.palette.primary.light,\n    opacity: 0.5\n  },\n  primary: {\n    flex: '1 1 30%',\n    width: '100%'\n  },\n  secondary: {\n    flex: '1 1 30%',\n    width: '100%'\n  }\n}))\n\nconst SearchPlaceholder = ({ icon, primary, secondary }) => {\n  const classes = useStyles()\n  const PlaceholderIcon = icon\n  return (\n    <div className={classes.root}>\n      <PlaceholderIcon className={classes.icon} />\n      {primary && (\n        <Typography className={classes.primary} variant='h3'>\n          {primary}\n        </Typography>\n      )}\n      {secondary && (\n        <Typography className={classes.secondary} variant='h4'>\n          {secondary}\n        </Typography>\n      )}\n    </div>\n  )\n}\n\nSearchPlaceholder.propTypes = {\n  icon: PropTypes.object,\n  primary: PropTypes.string,\n  secondary: PropTypes.string\n}\n\nexport default SearchPlaceholder\n","import React, { useEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport Typography from '@material-ui/core/Typography'\nimport Tabs from '@material-ui/core/Tabs'\nimport Tab from '@material-ui/core/Tab'\n\nimport SearchContextResults from './SearchContextResults'\nimport SearchResults from './SearchResults'\nimport SearchPlaceholder from './SearchPlaceholder'\nimport TopBar from '../TopBar'\nimport SearchInput from './SearchInput'\nimport useOnline from '../../lib/useOnline'\nimport { home } from '../../config'\nimport PortableWifiOffIcon from '@material-ui/icons/PortableWifiOff'\nimport LabelIcon from '@material-ui/icons/Label'\nimport PlaceIcon from '@material-ui/icons/Place'\nimport PersonIcon from '@material-ui/icons/Person'\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst TABS = home.SEARCH_TABS\n\nconst style = theme => ({\n  root: {\n    height: '100%',\n    display: 'flex',\n    overflow: 'hidden',\n    flexDirection: 'column'\n  },\n  tabs: {\n    // backgroundColor: theme.palette.primary.main,\n    // color: theme.palette.primary.contrastText,\n    // background: `linear-gradient(90deg, ${theme.palette.primary.dark} 0%, ${theme.palette.secondary.dark} 100%)`\n\n  },\n  ListWrapper: {\n    flexGrow: 1,\n    overflow: 'hidden',\n    display: 'flex',\n    flexDirection: 'column'\n  },\n  tab: {\n    flexGrow: 1\n  },\n  grow: {\n    flexGrow: 1\n  }\n})\n\nconst useStyles = makeStyles(style)\n\nconst Search = ({\n  onMenuBack, currentTab, setCurrentTab, defaultText, searchText,\n  setSearchText, contextResults, searchResults, contextChoice,\n  loading, setContextChoice, onMapClick, onResultClick, fetchMore\n}) => {\n  const classes = useStyles()\n\n  const { online } = useOnline()\n\n  // If there's only one thing then use it\n  useEffect(() => {\n    if (contextResults && !searchResults && contextResults.length === 1) {\n      setContextChoice(contextResults[0])\n    }\n  }, [contextResults])\n\n  let placeholder = {}\n  switch (currentTab) {\n    case TABS.TAG:\n      placeholder = { primary: 'Tag search', secondary: 'example: \\'beaver...\\'', icon: LabelIcon }\n      break\n    case TABS.USER:\n      placeholder = { primary: 'User search', secondary: 'example: \\'SuperGreg123...\\'', icon: PersonIcon }\n      break\n    case TABS.LOCATION:\n      placeholder = { primary: 'Location Search', secondary: 'example: \\'Vancouver...\\'', icon: PlaceIcon }\n      break\n\n    default:\n      break\n  }\n\n  let content = null\n  if (!online) {\n    content = (\n      <SearchPlaceholder\n        primary='Search Disabled'\n        secondary='(Offline)'\n        icon={PortableWifiOffIcon}\n      />\n    )\n  }\n  else if (contextChoice && searchResults) {\n    content = (\n      <SearchResults\n        variant={currentTab}\n        loading={loading}\n        onResultClick={onResultClick}\n        fetchMore={fetchMore}\n        seriesList={searchResults}\n        contextChoice={contextChoice}\n        onCancel={() => setContextChoice(null)}\n      />\n    )\n  }\n  else if (contextResults) {\n    content = (\n      <SearchContextResults\n        loading={loading}\n        variant={currentTab}\n        contextResults={contextResults}\n        setContextChoice={currentTab === TABS.LOCATION ? onMapClick : setContextChoice}\n      />\n    )\n  }\n  else if (defaultText.length > 0) {\n    content = (\n      <Typography>Searching for {`'${searchText}'` || '...'}</Typography>\n    )\n  }\n  else {\n    content = <SearchPlaceholder {...placeholder} />\n  }\n\n  return (\n    <div className={classes.root}>\n      <TopBar>\n        <SearchInput\n          disabled={!online}\n          // autoFocus\n          onChange={setSearchText}\n          defaultValue={searchText}\n        />\n      </TopBar>\n      {online && (\n        <Tabs\n          value={currentTab}\n          disabled={!online}\n          onChange={(e, val) => setCurrentTab(val)}\n          indicatorColor='primary'\n          classes={{ flexContainer: classes.tabs }}\n          centered\n        >\n          <Tab className={classes.tab} value={TABS.TAG} label='Tags' />\n          <Tab className={classes.tab} value={TABS.LOCATION} label='Places' />\n          <Tab className={classes.tab} value={TABS.USER} label='Users' />\n        </Tabs>\n      )}\n      <div className={classes.ListWrapper} >\n        {content}\n      </div>\n    </div>\n  )\n}\n\nSearch.propTypes = {\n  onMenuBack: PropTypes.func.isRequired,\n  loading: PropTypes.bool,\n  currentTab: PropTypes.string.isRequired,\n  setCurrentTab: PropTypes.func.isRequired,\n  searchText: PropTypes.string.isRequired,\n  setSearchText: PropTypes.func.isRequired,\n  fetchMore: PropTypes.func,\n  contextResults: PropTypes.array,\n  searchResults: PropTypes.array,\n  contextChoice: PropTypes.object,\n  setContextChoice: PropTypes.func.isRequired,\n  onMapClick: PropTypes.func.isRequired,\n  onResultClick: PropTypes.func.isRequired\n}\nSearch.defaultProps = {\n  currentTab: TABS.TAGS,\n  defaultText: ''\n}\n\nexport default Search\n","import React, { useState, useMemo } from 'react'\nimport PropTypes from 'prop-types'\nimport { home } from '../config'\n// import { smallestHash } from 'geotilehash'\nimport { graphql, compose } from 'react-apollo'\nimport { point, bbox as bboxFunc, buffer } from '@turf/turf'\n\nimport { connect } from 'react-redux'\nimport actions from '../redux/actions'\nimport { tagSearch, seriesWithTag, userSearch, userSeries, geocode } from '../graphql/queries'\nimport Search from '../components/Search/Search'\n// import { AppContext } from '../contexts'\n// import { debounce } from '../lib/util'\nimport { formatDatAgo } from '../lib/datelib'\n\nconst SearchConnect = ({\n  jumpToMap, jumpToSeries, defaultTab, defaultText, fetchMore\n}) => {\n  // const { role, user } = useContext(AppContext)\n\n  const [currentTab, setCurrentTab] = useState(defaultTab || home.SEARCH_TABS.TAG)\n  // We separate these because one of them needs to be immediate and the\n  const [searchText, setSearchText] = useState(defaultText || '')\n  const [contextChoice, setContextChoice] = useState(null)\n\n  const handleTabChange = (newTab) => {\n    setContextChoice(null)\n    setCurrentTab(newTab)\n  }\n  const handleContextChoiceChange = (newContextChoice) => {\n    setContextChoice(newContextChoice)\n  }\n  const handleSearchTextChange = (text) => {\n    setSearchText(text)\n    setContextChoice(null)\n  }\n\n  let withContextQuery = null\n  let withSearchQuery = null\n\n  switch (currentTab) {\n    case home.SEARCH_TABS.TAG:\n      withContextQuery = withTagSearch\n      withSearchQuery = withTagSeries\n      break\n    case home.SEARCH_TABS.LOCATION:\n      withContextQuery = withGeoCode\n      // withSearchQuery = withGeoSearch\n      break\n    case home.SEARCH_TABS.USER:\n      withContextQuery = withUserSearch\n      withSearchQuery = withUserSeries\n      break\n    default:\n      break\n  }\n\n  const ComposedSearch = useMemo(() => withSearchQuery\n    ? compose(\n      withContextQuery,\n      withSearchQuery\n    )(Search)\n    : withContextQuery(Search), [withContextQuery, withSearchQuery])\n\n  return <ComposedSearch {...{ currentTab, searchText, contextChoice }}\n    onMenuBack={() => {}}\n    onMapClick={jumpToMap}\n    onResultClick={jumpToSeries}\n    setContextChoice={handleContextChoiceChange}\n    fetchMore={fetchMore}\n    setCurrentTab={handleTabChange}\n    setSearchText={handleSearchTextChange}\n  />\n}\nSearchConnect.propTypes = {\n  searchResults: PropTypes.array,\n  contextResults: PropTypes.array,\n  loading: PropTypes.bool,\n  jumpToMap: PropTypes.func,\n  jumpToSeries: PropTypes.func,\n  fetchMore: PropTypes.func\n}\n/*****************************************************************\n *  PART 1: SEARCH QUERIES\n *****************************************************************/\n\n/**\n * Here's the graphql HOC that gets an individual series\n */\nconst withTagSearch = graphql(tagSearch, {\n  props: ({ data }) => {\n    if (data.error) console.error(data.error)\n    // console.log('withTagSearch', data)\n    let series = null\n    try {\n      if (!data.loading && !data.error) series = data.series\n    }\n    catch (e) {\n      console.error(data)\n      console.error(e)\n    }\n    const contextResults = data.tags ? data.tags.map(({ name, count }) => ({\n      name,\n      description: `~ ${count < 10 ? count : Math.ceil(count / 10) * 10} Photo series tagged`\n    })) : []\n\n    return {\n      contextResults,\n      loading: data.loading,\n      series\n    }\n  },\n  // skip: ({ searchText }) => !searchText || searchText.length < 3,\n  options: ({ searchText }) => ({\n    variables: {\n      tag: !searchText || searchText.length < 3 ? '' : searchText,\n      limit: 10\n    }\n  })\n})\n\nconst withUserSearch = graphql(userSearch, {\n  props: ({ data }) => {\n    if (data.error) console.error(data.error)\n    // console.log('withUserSearch', data)\n    let series = null\n    try {\n      if (!data.loading && !data.error) series = data.series\n    }\n    catch (e) {\n      console.error(data)\n      console.error(e)\n    }\n\n    const contextResults = data.userSearch ? data.userSearch.map(({ username, gravatar, createdOn, id }) => ({\n      name: username,\n      id,\n      description: `Joined ${formatDatAgo(createdOn)}`,\n      gravatar\n    })) : []\n\n    return {\n      contextResults,\n      loading: data.loading,\n      series\n    }\n  },\n  skip: ({ searchText }) => !searchText || searchText.length < 3,\n  options: ({ searchText }) => ({\n    variables: {\n      searchStr: searchText,\n      limit: 10\n    }\n  })\n})\n\nconst withGeoCode = graphql(geocode, {\n  props: ({ data }) => {\n    if (data.error) console.error(data.error)\n    // console.log('withGeoCode', data)\n    let series = null\n    try {\n      if (!data.loading && !data.error) series = data.series\n    }\n    catch (e) {\n      console.error(data)\n      console.error(e)\n    }\n\n    const contextResults = data.geocoder ? data.geocoder.map(({ relevance, text, placeName, bbox, center }) => ({\n      name: text,\n      description: placeName,\n      bbox,\n      center,\n      relevance\n    })) : []\n\n    return {\n      contextResults,\n      loading: data.loading,\n      series\n    }\n  },\n  skip: ({ searchText }) => !searchText || searchText.length < 3,\n  options: ({ searchText }) => ({\n    variables: {\n      search: searchText\n      // limit: 10\n    }\n  })\n})\n\n/*****************************************************************\n * PART 2: SERIES SEARCH QUERIES\n *****************************************************************/\n\nconst withTagSeries = graphql(seriesWithTag, {\n  props: ({ data }) => {\n    if (data.error) console.error(data.error)\n    // console.log('withTagSeries', data)\n    let series = null\n    try {\n      if (!data.loading && !data.error) series = data.series\n    }\n    catch (e) {\n      console.error(data)\n      console.error(e)\n    }\n\n    // A second Thunk function designed to get more elements in the feed history\n    const fetchMore = data.loading || !data.tagSeries || !data.tagSeries.nextToken ? null : () => {\n      console.log('fetchMore', data)\n      data.fetchMore({\n        variables: { ...data.variables, nextToken: data.tagSeries.nextToken },\n        // How do we mush the new query with the old one\n        updateQuery: (prev, { fetchMoreResult }) => {\n          return {\n            tagSeries: {\n              ...fetchMoreResult.tagSeries,\n              seriesSummaries: [ ...prev.tagSeries.seriesSummaries, ...fetchMoreResult.tagSeries.seriesSummaries ]\n            }\n          }\n        }\n      })\n    }\n\n    const searchResults = data.tagSeries && data.tagSeries.seriesSummaries\n      ? data.tagSeries.seriesSummaries\n      : []\n\n    return {\n      searchResults,\n      fetchMore,\n      loading: data.loading,\n      series\n    }\n  },\n  skip: ({ contextChoice }) => !contextChoice,\n  options: ({ contextChoice }) => ({\n    variables: {\n      tag: contextChoice.name,\n      limit: 10\n    }\n  })\n})\n\nconst withUserSeries = graphql(userSeries, {\n  props: ({ data }) => {\n    if (data.error) console.error(data.error)\n    // console.log('withUserSeries', data)\n    let series = null\n    try {\n      if (!data.loading && !data.error) series = data.series\n    }\n    catch (e) {\n      console.error(data)\n      console.error(e)\n    }\n\n    // A second Thunk function designed to get more elements in the feed history\n    const fetchMore = data.loading || !data.userSeries || !data.userSeries.nextToken ? null : () => {\n      console.log('fetchMore', data)\n      data.fetchMore({\n        variables: { ...data.variables, nextToken: data.userSeries.nextToken },\n        // How do we mush the new query with the old one\n        updateQuery: (prev, { fetchMoreResult }) => {\n          return {\n            userSeries: {\n              ...fetchMoreResult.userSeries,\n              seriesSummaries: [ ...prev.userSeries.seriesSummaries, ...fetchMoreResult.userSeries.seriesSummaries ]\n            }\n          }\n        }\n      })\n    }\n\n    const searchResults = data.userSeries && data.userSeries.seriesSummaries\n      ? data.userSeries.seriesSummaries\n      : []\n\n    return {\n      searchResults,\n      fetchMore,\n      loading: data.loading,\n      series\n    }\n  },\n  skip: ({ contextChoice }) => !contextChoice,\n  options: ({ contextChoice }) => ({\n    variables: {\n      createdBy: contextChoice.id,\n      limit: 10\n    }\n  })\n})\n\n// const withGeoSearch = graphql(geoSeries, {\n//   props: ({ data }) => {\n//     if (data.error) console.error(data.error)\n//     // console.log('HERE', data)\n//     let series = null\n//     try {\n//       if (!data.loading && !data.error) series = data.series\n//     }\n//     catch (e) {\n//       console.error(data)\n//       console.error(e)\n//     }\n//     return {\n//       data,\n//       loading: data.loading,\n//       series\n//     }\n//   },\n//   skip: ({ contextChoice }) => !contextChoice,\n//   options: ({ contextChoice }) => ({\n//     variables: {\n//       bounds: contextChoice.bbox\n//       // limit: 10\n//       // nextToken\n//     }\n//   })\n// })\n\n/**\n * Map our redux state and functions\n */\nconst mapStateToProps = (state, props) => {\n  const { current: { search, activeSeries, domain } } = state.home\n  return {\n    defaultTab: search ? search.tab : null,\n    defaultText: search ? search.text : null,\n    activeSeries,\n    domain\n  }\n}\n\nconst mapDispatchToProps = dispatch => ({\n  onBack: () => {\n    dispatch(actions.homeStateBack())\n  },\n  queueUpload: (uploadObj) => {\n    dispatch(actions.queueUpload(uploadObj))\n  },\n  jumpToSeries: (seriesId) => {\n    dispatch(actions.setHomeState(home.AppStateTypes.SERIES, { activeSeries: seriesId }))\n  },\n\n  jumpToMap: ({ bbox, center }) => {\n    let bounds = bbox\n    if (!bounds && center) {\n      const bufferPts = buffer(point(center), 500, { units: 'meters' })\n      bounds = bboxFunc(bufferPts)\n    }\n\n    if (bounds) {\n      dispatch(actions.pushMapHistory({\n        mode: home.MapModeTypes.FREE,\n        bounds: bounds\n      }))\n      dispatch(actions.setHomeState(home.AppStateTypes.MAP, { activeSeries: null, initialPhoto: null }))\n    }\n  }\n})\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(SearchConnect)\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\n// import MenuIcon from '@material-ui/icons/Menu'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { formatDate } from '../../lib/datelib'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n  },\n  imgContainer: {\n    flex: '0 0 100px',\n    // alignSelf: 'flex-start',\n    // height: '100%',\n    margin: theme.spacing(1, 1, 0, 2)\n  },\n  gravatarImg: {\n    verticalAlign: 'top'\n    // objectFit: 'cover',\n    // height: '100%',\n    // width: '100%'\n  }\n}))\n\nconst MeCard = ({ user, loading, onAvatarClick }) => {\n  const classes = useStyles()\n\n  if (loading || !user) return 'LOADING...'\n  // console.log('USER', user)\n\n  return (\n    <ListItem className={classes.root} onClick={onAvatarClick} disableGutters>\n      <ListItemIcon className={classes.imgContainer}>\n        <img alt='profile' className={classes.gravatarImg} src={user.gravatar} />\n      </ListItemIcon>\n      <ListItemText\n        primary={user.username}\n        secondary={`Member since: ${formatDate(user.createdOn, 'LL')}`}\n      />\n    </ListItem>\n  )\n}\n\nMeCard.propTypes = {\n  user: PropTypes.object,\n  loading: PropTypes.bool,\n  onAvatarClick: PropTypes.func\n}\n\nexport default MeCard\n","import React, { useState, useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport Typography from '@material-ui/core/Typography'\nimport Divider from '@material-ui/core/Divider'\nimport Tabs from '@material-ui/core/Tabs'\nimport Tab from '@material-ui/core/Tab'\n\nimport SeriesListItem from '../misc/SeriesListItem'\nimport { makeStyles } from '@material-ui/core/styles'\nimport TopBar from '../TopBar'\nimport MeCard from './MeCard'\nimport { Button } from '@material-ui/core'\n\nimport { AppContext } from '../../contexts'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    background: theme.palette.background.paper,\n    display: 'flex',\n    flexDirection: 'column',\n    height: '100%'\n  },\n  filterContainer: {\n    color: theme.palette.primary.secondary,\n    background: theme.palette.background.default,\n    textAlign: 'center',\n    padding: theme.spacing(1, 1)\n  },\n  filterChip: {\n\n  },\n  seriesListItemWrap: {\n    margin: theme.spacing(1, 0.5)\n  },\n  seriesList: {\n    height: '100%',\n    overflowX: 'hidden',\n    overflowY: 'scroll'\n  },\n  tabs: {\n    // background: theme.palette.background.default\n  },\n  noneFound: {\n    color: theme.palette.text.secondary,\n    textAlign: 'center',\n    padding: theme.spacing(2)\n  }\n}))\n\nconst SORT = {\n  ACTIVITY: 'Last Photo',\n  CREATED: 'Created',\n  NAME: 'Name'\n}\n\nconst MyProfile = ({ mySeries, watchingSeries, loading, jumpToSeries, jumpToMap }) => {\n  const classes = useStyles()\n  const [currentTab, setCurrentTab] = useState(0)\n  const [sortVal, setSort] = useState(SORT.ACTIVITY)\n  const [sortAsc, setSortAsc] = useState(false)\n\n  const { user } = useContext(AppContext)\n\n  const sortSetter = (newSort) => {\n    if (newSort === sortVal) setSortAsc(!sortAsc)\n    else setSort(newSort)\n  }\n\n  let tabFeed = currentTab === 0 ? mySeries : watchingSeries\n  if (!tabFeed) tabFeed = []\n\n  switch (sortVal) {\n    case SORT.ACTIVITY:\n      if (sortAsc) tabFeed.sort((a, b) => a.latest.takenOn - b.latest.takenOn)\n      else tabFeed.sort((a, b) => b.latest.takenOn - a.latest.takenOn)\n      break\n    case SORT.CREATED:\n      if (sortAsc) tabFeed.sort((a, b) => a.createdOn - b.createdOn)\n      else tabFeed.sort((a, b) => b.createdOn - a.createdOn)\n      break\n    case SORT.NAME:\n      if (sortAsc) {\n        tabFeed.sort((a, b) => {\n          if (a.name < b.name) {\n            return -1\n          }\n          if (a.name > b.firstname) {\n            return 1\n          }\n          return 0\n        })\n      }\n      else {\n        tabFeed.sort((a, b) => {\n          if (b.name < a.name) {\n            return -1\n          }\n          if (b.name > a.name) {\n            return 1\n          }\n          return 0\n        })\n      }\n      break\n    default:\n      break\n  }\n\n  return (\n    <div className={classes.root}>\n      <TopBar>\n        <Typography>My Profile</Typography>\n      </TopBar>\n      <MeCard user={user} />\n      {/* <Divider /> */}\n      <Tabs\n        value={currentTab}\n        onChange={(e, val) => setCurrentTab(val)}\n        indicatorColor='primary'\n        centered\n        classes={{ flexContainer: classes.tabs }}\n      >\n        <Tab className={classes.tab} value={0} label='My Series' />\n        <Tab className={classes.tab} value={1} label='Watching' />\n      </Tabs>\n      <Divider />\n      <div className={classes.filterContainer}>\n        <FilterSortItem asc={sortAsc} active={sortVal === SORT.NAME} onClick={() => sortSetter(SORT.NAME)} label={SORT.NAME} />\n        |\n        <FilterSortItem asc={sortAsc} active={sortVal === SORT.ACTIVITY} onClick={() => sortSetter(SORT.ACTIVITY)} label={SORT.ACTIVITY} />\n        |\n        <FilterSortItem asc={sortAsc} active={sortVal === SORT.CREATED} onClick={() => sortSetter(SORT.CREATED)} label={SORT.CREATED} />\n      </div>\n      <Divider />\n      <div className={classes.seriesList}>\n        {!loading && (!tabFeed || tabFeed.length === 0) && (\n          <Typography className={classes.noneFound} component='div'>No Series Found</Typography>\n        )}\n        {loading && (\n          <Typography className={classes.noneFound} component='div'>Loading...</Typography>\n        )}\n        {tabFeed.map((series, idx) => (\n          <SeriesListItem\n            key={`seriesListItem${idx}`}\n            series={series}\n            showCreatedOn\n            showLastPhoto\n            onClick={() => jumpToSeries(series.id)}\n          />\n        ))}\n      </div>\n    </div>\n  )\n}\n\nMyProfile.propTypes = {\n  loading: PropTypes.bool,\n  mySeries: PropTypes.array.isRequired,\n  watchingSeries: PropTypes.array.isRequired,\n  jumpToSeries: PropTypes.func.isRequired,\n  jumpToMap: PropTypes.func.isRequired\n}\n\nexport default MyProfile\n\nconst useFilterStyles = makeStyles(theme => ({\n  root: {\n    margin: theme.spacing(0, 1, 0, 1)\n  }\n}))\n\nconst FilterSortItem = ({ active, asc, onClick, label }) => {\n  const classes = useFilterStyles()\n\n  const arrow = asc === true ? '▲' : '▼'\n\n  return (\n    <Button\n      size='small'\n      className={classes.root}\n      onClick={onClick}\n      // variant='caption'\n      color={active ? 'secondary' : 'inherit'}\n    >\n      {label}\n      <span style={{ opacity: active ? 1 : 0 }}>\n        {arrow}\n      </span>\n    </Button>\n  )\n}\n\nFilterSortItem.propTypes = {\n  active: PropTypes.bool,\n  asc: PropTypes.bool,\n  onClick: PropTypes.func.isRequired,\n  label: PropTypes.string.isRequired\n}\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport { graphql, compose } from 'react-apollo'\nimport actions from '../redux/actions'\nimport { connect } from 'react-redux'\nimport { home } from '../config'\n\nimport { userSeries, seriesFromList } from '../graphql/queries'\nimport MyProfile from '../components/MyProfile/MyProfile'\n\nconst ProfileConnect = ({ data, jumpToSeries, jumpToMap }) => {\n  const { seriesQ, watchedSeriesQ } = data\n\n  const mySeries = seriesQ && seriesQ.userSeries && seriesQ.userSeries.seriesSummaries ? seriesQ.userSeries.seriesSummaries : []\n  const watchingSeries = watchedSeriesQ && watchedSeriesQ.arraySeries ? watchedSeriesQ.arraySeries : []\n  // console.log('ProfileConnect', { mySeries, watchedSeriesQ, watchingSeries })\n\n  const loading = Boolean(\n    (seriesQ && seriesQ.loading) ||\n    (watchedSeriesQ && watchedSeriesQ.loading)\n  )\n\n  return <MyProfile {...{ loading, mySeries, watchingSeries, jumpToSeries, jumpToMap }} />\n}\n\nProfileConnect.propTypes = {\n  data: PropTypes.object, // from graphql\n  jumpToSeries: PropTypes.func, // from redux\n  jumpToMap: PropTypes.func // from redux\n}\n\nconst withuserSeriesQuery = graphql(userSeries, {\n  props: ({ data, ownProps }) => {\n    // console.log('ProfileConnect withuserSeriesQuery', { data, ownProps })\n    return { data: { ...ownProps.data, seriesQ: data } }\n  }\n})\n\nconst withMyWatchedSeriesQuery = graphql(seriesFromList, {\n  props: ({ data, ownProps }) => {\n    // console.log('ProfileConnect withMyWatchedSeriesQuery', { data, ownProps })\n    return { data: { ...ownProps.data, watchedSeriesQ: data } }\n  },\n  skip: ({ data, user }) => {\n    try {\n      return user.watching.length < 1\n    }\n    catch (e) {\n      return true\n    }\n  },\n  options: ({ data, user }) => {\n    return {\n      variables: { seriesList: user.watching }\n    }\n  }\n})\n\n/**\n * Compose all our queries together\n */\nconst queryWrapped = compose(\n  withuserSeriesQuery,\n  // withMyPhotosQuery,\n  withMyWatchedSeriesQuery\n)(ProfileConnect)\n\n/**\n * Map our redux state and functions\n */\nconst mapStateToProps = (state, props) => {\n  return { }\n}\n\nconst mapDispatchToProps = dispatch => ({\n  jumpToSeries: (seriesId) => {\n    dispatch(actions.setHomeState(home.AppStateTypes.SERIES, { activeSeries: seriesId }))\n  },\n  jumpToMap: (seriesId) => {\n    dispatch(actions.setHomeState(home.AppStateTypes.MAP, { activeSeries: seriesId }))\n  }\n})\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(queryWrapped)\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport Typography from '@material-ui/core/Typography'\n// import MenuIcon from '@material-ui/icons/Menu'\nimport { makeStyles } from '@material-ui/core/styles'\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex',\n    alignItems: 'center'\n  },\n  grow: { flexGrow: 1 },\n  text: {\n    textAlign: 'center',\n    fontStyle: 'italic',\n    padding: theme.spacing(2, 1)\n  }\n}))\n\nconst FeedEnder = ({ style, icon, text }) => {\n  const classes = useStyles()\n  return (\n    <div className={classes.root}>\n      <div className={classes.grow} />\n      {icon}\n      <Typography className={classes.text} variant='subtitle1' color='textSecondary' component='div' style={style}>\n        {text}\n      </Typography>\n      <div className={classes.grow} />\n    </div>\n  )\n}\n\nFeedEnder.propTypes = {\n  style: PropTypes.object,\n  icon: PropTypes.any,\n  text: PropTypes.string\n}\n\nexport default FeedEnder\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport Avatar from '@material-ui/core/Avatar'\nimport IconButton from '@material-ui/core/IconButton'\n\nimport PlaceIcon from '@material-ui/icons/Place'\nimport { makeStyles } from '@material-ui/core/styles'\nconst useStyles = makeStyles(theme => ({\n  root: {\n    textAlign: 'center'\n  },\n  placeAvatar: {\n    color: theme.palette.primary.contrastText,\n    border: `2px solid ${theme.palette.primary.contrastText}`,\n    background: theme.palette.text.primary,\n    margin: 'auto'\n  },\n  placeIcon: {\n  }\n}))\n\nconst FindOnMapButton = ({ onClick }) => {\n  const classes = useStyles()\n  return (\n    <div className={classes.root}>\n      <Avatar className={classes.placeAvatar}>\n        <IconButton color='inherit' onClick={e => {\n          e.preventDefault()\n          e.stopPropagation()\n          onClick()\n        }}>\n          <PlaceIcon color='inherit' />\n        </IconButton>\n      </Avatar>\n      {/* <Typography variant='caption' component='div'>MAP</Typography> */}\n    </div>\n  )\n}\n\nFindOnMapButton.propTypes = {\n  onClick: PropTypes.func.isRequired\n}\n\nexport default FindOnMapButton\n","import React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport Paper from '@material-ui/core/Paper'\nimport Typography from '@material-ui/core/Typography'\n// import MenuIcon from '@material-ui/icons/Menu'\nimport { makeStyles } from '@material-ui/core/styles'\nimport FindOnMapButton from '../misc/FindOnMapButton'\nimport RawImage from '../PhotoSeries/views/subViews/RawImage'\n// import StarIcon from '@material-ui/icons/Star'\n// import StarBorderIcon from '@material-ui/icons/StarBorder'\nimport { Avatar } from '@material-ui/core'\nimport { AppContext } from '../../contexts'\nimport { formatDate } from '../../lib/datelib'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    height: '100%',\n    // borderTop: `4px solid ${theme.palette.grey[700]}`\n    padding: theme.spacing(0.5, 1)\n  },\n  imgContainer: {\n    overflow: 'hidden',\n    height: '100%',\n    position: 'relative'\n  },\n  findOnMapButtonContainer: {\n    position: 'absolute',\n    opacity: 0.8,\n    bottom: theme.spacing(1),\n    right: theme.spacing(1)\n  },\n  titleContainer: {\n    background: '#444444AA',\n    textShadow: '1px 1px 10px black',\n    color: 'white',\n    position: 'absolute',\n    alignItems: 'center',\n    display: 'flex',\n    top: 0,\n    width: '100%',\n    paddingRight: theme.spacing(1)\n  },\n  avatar: {\n    border: '1px solid white',\n    margin: theme.spacing(0, 1)\n  },\n  title: {\n    flex: '1 1 50%',\n    overflow: 'hidden'\n  },\n  seriesName: {\n    textOverflow: 'ellipsis',\n    whiteSpace: 'nowrap',\n    overflow: 'hidden'\n  },\n  img: {\n\n  },\n  gravatarImg: {\n    width: '100%'\n  }\n}))\n\nconst EVENT_VERBS = {\n  DELETE: 'Deleted',\n  ADD: 'Added'\n}\n\nconst FeedItem = ({ event, onMapClick, onImageClick, onProfileClick, onSeriesClick }) => {\n  const { series, photo } = event\n  // console.log('EVENT', { series, relation, photo })\n  const classes = useStyles()\n  const { getPhotoUrls } = useContext(AppContext)\n  return (\n    <div className={classes.root}>\n      <Paper className={classes.imgContainer}>\n        <RawImage\n          photo={photo}\n          sizePriority={['medium', 'large', 'thumb']}\n          cover\n          className={classes.img}\n          onClick={() => onImageClick(series.id, photo.id)}\n          getPhotoUrls={getPhotoUrls}\n        />\n        <div className={classes.titleContainer}>\n          <Avatar onClick={() => onProfileClick(photo.createdUser.username)} className={classes.avatar}>\n            <img alt='profile' className={classes.gravatarImg} src={photo.createdUser.gravatar} />\n          </Avatar>\n          <div className={classes.title}>\n            <Typography className={classes.seriesName} variant='body1' color='inherit'>{series.name}</Typography>\n            <Typography variant='body2' color='inherit'>{photo.createdUser.username} {EVENT_VERBS.ADD} a photo</Typography>\n            <Typography variant='caption' color='inherit'>{formatDate(photo.updatedOn)}</Typography>\n          </div>\n          <FindOnMapButton onClick={() => onMapClick(series.id, photo.id)} />\n        </div>\n      </Paper>\n    </div>\n  )\n}\n\nFeedItem.propTypes = {\n  // TODO: THIS IS NOT THE SHAPE WE WANT. NEED TO HASH THIS OUT\n  event: PropTypes.object.isRequired,\n  onSeriesClick: PropTypes.func.isRequired,\n  onImageClick: PropTypes.func.isRequired,\n  onProfileClick: PropTypes.func.isRequired,\n  onMapClick: PropTypes.func.isRequired\n}\n\nexport default FeedItem\n\nexport const FeedItemCosmos = (props) => {\n  return (\n    <div>\n      <FeedItem {...props} />\n      <FeedItem {...props} />\n      <FeedItem {...props} />\n      <FeedItem {...props} />\n      <FeedItem {...props} />\n      <FeedItem {...props} />\n      <FeedItem {...props} />\n      <FeedItem {...props} />\n      <FeedItem {...props} />\n      <FeedItem {...props} />\n      <FeedItem {...props} />\n    </div>\n  )\n}\nFeedItemCosmos.propTypes = {\n  // TODO: THIS IS NOT THE SHAPE WE WANT. NEED TO HASH THIS OUT\n  event: PropTypes.object.isRequired\n}\n","import React, { useRef } from 'react'\nimport PropTypes from 'prop-types'\nimport Typography from '@material-ui/core/Typography'\n\nimport { List } from 'react-virtualized' // InfiniteLoader\nimport useOnline from '../../lib/useOnline'\nimport FeedEnder from './FeedEnder'\n\nimport ErrorIcon from '@material-ui/icons/Error'\nimport { makeStyles } from '@material-ui/core/styles'\nimport FeedItem from './FeedItem'\n\nimport TopBar from '../TopBar'\n\nimport useComponentSize from '../../lib/useComponentSize'\nimport { CircularProgress } from '@material-ui/core'\n\nconst ROWHEIGHT = 300\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex',\n    flexDirection: 'column',\n    height: '100%'\n  },\n  listContainer: {\n    flexGrow: 1,\n    overflow: 'hidden'\n  },\n  vList: {\n    height: '100%',\n    width: '100%'\n  },\n  feedContainer: {\n    flexGrow: 1,\n    // Promote the list into his own layer on Chrome. This cost memory but helps keeping high FPS.\n    transform: 'translateZ(0)'\n  },\n  grow: {\n    flexGrow: 1\n  }\n}))\n\nconst MyFeed = ({\n  events, loading, onMapClick, onImageClick, onProfileClick,\n  onSeriesClick, fetchNewest, fetchMore, window\n}) => {\n  const classes = useStyles()\n  const listRef = useRef()\n  const { size } = useComponentSize(listRef)\n  const { online } = useOnline()\n\n  const rowRenderer = ({\n    index, // Index of row\n    isScrolling, // The List is currently being scrolled\n    isVisible, // This row is visible within the List (eg it is not an overscanned row)\n    key, // Unique key within array of rendered rows\n    parent, // Reference to the parent List (instance)\n    style // Style object to be applied to row (to position it);\n    // This must be passed through to the rendered row element.\n  }) => {\n    const row = events[index]\n    let content\n    if (index < events.length && row) {\n      content = <FeedItem\n        event={events[index]}\n        onSeriesClick={onSeriesClick}\n        onImageClick={onImageClick}\n        onProfileClick={onProfileClick}\n        onMapClick={onMapClick}\n      />\n    }\n    else if (index === events.length) {\n      // content = <div className={classes.placeholder} style={{ width: row.size }} />\n      const wEnd = window && window[0] === 0\n      content = <FeedEnder icon={<CircularProgress size={30} thickness={2} color='inherit' />} text='Loading...' />\n\n      const almostAtEnd = ROWHEIGHT * 4 + parent.state.scrollTop > style.top\n\n      if (!online) {\n        content = <FeedEnder icon={<ErrorIcon />} text='Cannot Refresh Offline' />\n      }\n      else if (wEnd) {\n        content = <FeedEnder text='End of feed' />\n      }\n      // Only if we're online, not loading and visible\n      else if (!loading && almostAtEnd) {\n        fetchMore()\n      }\n    }\n\n    return (\n      <div className={classes.row} key={key} style={style}>\n        {content}\n      </div>\n    )\n  }\n  rowRenderer.propTypes = {\n    index: PropTypes.any,\n    key: PropTypes.any,\n    style: PropTypes.any,\n    isScrolling: PropTypes.any,\n    isVisible: PropTypes.any,\n    parent: PropTypes.any\n  }\n\n  return (\n    <div className={classes.root}>\n      <TopBar>\n        <Typography className={classes.grow}>Home Feed</Typography>\n      </TopBar>\n      <div className={classes.listContainer} ref={listRef}>\n        <List\n          height={size.height}\n          width={size.width}\n          className={classes.vList}\n          rowCount={events.length + 1}\n          rowHeight={ROWHEIGHT}\n          rowRenderer={rowRenderer}\n        />\n      </div>\n    </div>\n  )\n}\n\nMyFeed.propTypes = {\n  events: PropTypes.array.isRequired,\n  loading: PropTypes.bool,\n  window: PropTypes.arrayOf(PropTypes.number),\n  onSeriesClick: PropTypes.func.isRequired,\n  onImageClick: PropTypes.func.isRequired,\n  onProfileClick: PropTypes.func.isRequired,\n  onMapClick: PropTypes.func.isRequired,\n  fetchNewest: PropTypes.func.isRequired,\n  fetchMore: PropTypes.func.isRequired\n}\n\nexport default MyFeed\n","import React, { useRef, useState, useEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport { graphql } from 'react-apollo'\nimport { home } from '../config'\nimport actions from '../redux/actions'\nimport { connect } from 'react-redux'\nimport { getMyFeed } from '../graphql/queries'\nimport MyFeed from '../components/MyFeed/MyFeed'\n\nconst POLL_INTERVAL = 20 // (seconds)\nconst FEED_LIMIT = 5 // (items to load)\n\nconst FeedConnect = ({\n  data, loading, fetchMore, fetchNewest,\n  loadingNewest,\n  online,\n  loadingMore,\n  jumpToSeries,\n  jumpToMap,\n  jumpToUser\n}) => {\n  const timerRef = useRef()\n  const [lastCheck, setLastCheck] = useState(null)\n  timerRef.current = lastCheck\n\n  // Initiate the polling process. We simply update the timestamp every N seconds\n  useEffect(() => {\n    function ping () {\n      if (!loading && online) fetchNewest()\n      if (timerRef.current) setLastCheck(String(Date.now() - POLL_INTERVAL * 1000))\n    }\n    if (!timerRef.current) timerRef.current = setInterval(ping, POLL_INTERVAL * 1000)\n    return () => {\n      if (timerRef.current) {\n        console.log('clear poll timer')\n        clearInterval(timerRef.current)\n        timerRef.current = null\n      }\n    }\n  }, [])\n\n  const events = data.myFeed ? data.myFeed.feed || [] : []\n  const window = data.myFeed ? data.myFeed.window.map(v => parseInt(v, 10)) || [null, null] : [null, null]\n\n  return (\n    <MyFeed {...{ events, loading, window, fetchMore, fetchNewest, jumpToSeries }}\n      onSeriesClick={() => {}}\n      onImageClick={jumpToSeries}\n      onProfileClick={jumpToUser}\n      onMapClick={jumpToMap}\n    />\n  )\n}\n\nFeedConnect.propTypes = {\n  data: PropTypes.object, // from graphql\n  loading: PropTypes.bool, // from graphql\n  loadingNewest: PropTypes.bool, // from graphql\n  loadingMore: PropTypes.bool, // from graphql\n  fetchMore: PropTypes.func,\n  fetchNewest: PropTypes.func,\n  jumpToSeries: PropTypes.func,\n  jumpToMap: PropTypes.func,\n  jumpToUser: PropTypes.func\n}\n\nconst withFeedQuery = graphql(getMyFeed, {\n  props: ({ data }) => {\n    if (data.error) console.error(data.error)\n\n    // TODO: Not sure this will propagate correctly. Test it.\n    let loadingNewest = false\n    let loadingMore = false\n\n    // console.log('withFeedQuery', data)\n\n    // One Thunk function designed for getting everything since the last check\n    const fetchNewest = () => {\n      loadingNewest = true\n      console.log('fetchNewest', data)\n      if (data.myFeed) {\n        console.log('DEBUG fetchNewest1', { ...data.variables, start: data.myFeed.window[1] })\n        data.fetchMore({\n          variables: { ...data.variables, start: data.myFeed.window[1] },\n          // How do we mush the new query with the old one\n          updateQuery: (prev, { fetchMoreResult }) => {\n            console.log('DEBUG fetchNewest2', { prev, fetchMoreResult })\n            loadingNewest = false\n            return {\n              myFeed: {\n                ...fetchMoreResult.myFeed,\n                // put the newest stuff first\n                feed: [ ...fetchMoreResult.myFeed.feed, ...prev.myFeed.feed ],\n                window: [prev.myFeed.window[0], fetchMoreResult.myFeed.window[1]]\n              }\n            }\n          }\n        })\n      }\n    }\n\n    // A second Thunk function designed to get more elements in the feed history\n    const fetchMore = () => {\n      loadingMore = true\n      console.log('fetchMore', data)\n      if (data.myFeed) {\n        data.fetchMore({\n          variables: { ...data.variables, end: data.myFeed.window[0] },\n          // How do we mush the new query with the old one\n          updateQuery: (prev, { fetchMoreResult }) => {\n            loadingMore = false\n            return {\n              myFeed: {\n                ...fetchMoreResult.myFeed,\n                feed: [ ...prev.myFeed.feed, ...fetchMoreResult.myFeed.feed ],\n                window: [fetchMoreResult.myFeed.window[0], prev.myFeed.window[1]]\n              }\n            }\n          }\n        })\n      }\n    }\n\n    return {\n      data,\n      loadingNewest,\n      loadingMore,\n      fetchNewest, // This is the poll we do every n seconds\n      fetchMore, // This is when we scroll to the bottom of the list\n      loading: data.loading\n    }\n  },\n  // skip: ({ activeSeries, isNewSeries }) => !activeSeries || isNewSeries,\n  options: ({ activeSeries }) => ({\n    variables: {\n      limit: FEED_LIMIT\n    }\n  })\n})\n\n/**\n * Map our redux state and functions\n */\nconst mapStateToProps = (state, props) => {\n  return { }\n}\n\n// We're using graphql() HOC because it's convenient but it doesn't need to render anything\n// const FeedQueryConnect = withFeedQuery(() => null)\nconst mapDispatchToProps = dispatch => ({\n  jumpToSeries: (seriesId, photoId) => {\n    dispatch(actions.setHomeState(home.AppStateTypes.SERIES, { activeSeries: seriesId, initialPhoto: photoId }))\n  },\n  jumpToUser: (username) => {\n    dispatch(actions.setHomeState(home.AppStateTypes.SEARCH, { search: { tab: home.SEARCH_TABS.USER, text: username } }))\n  },\n  jumpToMap: (seriesId, photoId) => {\n    dispatch(actions.pushMapHistory({\n      mode: home.MapModeTypes.FREE\n    }))\n    dispatch(actions.setHomeState(home.AppStateTypes.MAP, { activeSeries: seriesId, initialPhoto: photoId }))\n  }\n})\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(\n  withFeedQuery(FeedConnect)\n)\n","import { makeStyles } from '@material-ui/core/styles'\n\nexport default makeStyles(theme => ({\n  root: {\n    height: '100%',\n    display: 'flex',\n    overflow: 'hidden',\n    flexDirection: 'column'\n  },\n  rectContents: {\n    color: theme.palette.common.white,\n    textShadow: `5px 6px 6px ${theme.palette.common.black}`,\n    position: 'absolute',\n    padding: theme.spacing(2),\n    top: '50%',\n    left: '50%',\n    textAlign: 'center',\n    // transformOrigin: '50% 50%'\n    transform: 'translateY(-50%) translateX(-50%)'\n  },\n  areaLabel: {\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    width: '100%',\n    transform: 'translateY(-110%)'\n  },\n  rectContentsDownloading: {\n    textShadow: 'none',\n    color: theme.palette.primary.contrastText\n  },\n  rectIcon: {\n    position: 'absolute',\n    opacity: 0.4,\n    width: '50%',\n    height: '50%',\n    top: '50%',\n    left: '50%',\n    // transformOrigin: '50% 50%'\n    transform: 'translateY(-50%) translateX(-50%)'\n  },\n  tooBig: {\n    color: theme.palette.error.contrastText\n  },\n  tickText: {\n    // position: 'absolute',\n    // textAlign: 'center',\n    // top: '50%',\n    // left: '50%',\n    // // transformOrigin: '50% 50%'\n    // transform: 'translateY(-50%) translateX(-50%)'\n  },\n  svgRect: {\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    zIndex: -1,\n    height: '100%',\n    width: '100%'\n  },\n  svgCutout: {\n    stroke: 'none',\n    fill: '#00000099'\n  },\n  svgBorder: {\n    fill: 'none',\n    stroke: 'none'\n  },\n  svgBorderNavigating: {\n    stroke: '#44444499'\n  },\n  svgBorderLocked: {\n    fill: '#66666666',\n    stroke: '#44444499'\n  },\n  svgBorderTooBig: {\n    opacity: 0.5,\n    fill: theme.palette.error.main,\n    stroke: theme.palette.error.dark\n  },\n  svgBorderDownloading: {\n    opacity: 0.7,\n    fill: theme.palette.primary.main,\n    stroke: '#44444499'\n  },\n  downloadingProgress: {\n\n  },\n  downloadingProgressCircle: {\n    margin: theme.spacing(2)\n  },\n  snackError: {\n    background: theme.palette.primary.main,\n    color: theme.palette.primary.contrastText\n  },\n  mapWrapper: {\n    flex: '1 1',\n    overflow: 'hidden',\n    position: 'relative'\n  }\n}))\n","import React, { useRef, useState, useCallback } from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport Typography from '@material-ui/core/Typography'\nimport Snackbar from '@material-ui/core/Snackbar'\nimport SnackbarContent from '@material-ui/core/SnackbarContent'\nimport AppBar from '@material-ui/core/AppBar'\nimport CircularProgress from '@material-ui/core/CircularProgress'\nimport IconButton from '@material-ui/core/IconButton'\nimport numeral from 'numeral'\n\nimport ArrowBackIcon from '@material-ui/icons/ArrowBack'\nimport CheckCircleOutlineIcon from '@material-ui/icons/CheckCircleOutline'\nimport ErrorIcon from '@material-ui/icons/Error'\nimport LockIcon from '@material-ui/icons/Lock'\nimport SignalWifiOffIcon from '@material-ui/icons/SignalWifiOff'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport { home } from '../../config'\nimport { debounce } from '../../lib/util'\nimport BaseMap from './BaseMap'\n\n// import MenuIcon from '@material-ui/icons/Menu'\nimport useStyles from './OfflineMap.style'\nimport { Button } from '@material-ui/core'\n\nexport const STATES = {\n  LOCKED: 'Locked',\n  OFFLINE: 'Offline',\n  NAVIGATING: 'Navigating',\n  ERROR: 'Error',\n  DOWNLOADING: 'Downloading',\n  CANCELED: 'Canceled'\n}\n\nconst OfflineMap = ({ onMenuBack, initViewport, progress, toolState,\n  onStartDownload, onCancel, onUnlock, onCancelComplete }) => {\n  const classes = useStyles()\n  const mapWrapperRef = useRef()\n  const [bounds, setBounds] = useState(null)\n  const [viewState, setViewport] = useState(null)\n  const [area, setArea] = useState(null)\n\n  const tooBig = area > home.Offline.maxMapTileArea\n  const classWithState = (name) => {\n    if (!toolState) return classes[name]\n    else return classNames(classes[name], classes[`${name}${toolState}`], tooBig ? classes[`${name}TooBig`] : null)\n  }\n\n  const setGeoState = useCallback(debounce((newViewport, projection, rectSide) => {\n    // console.time('setGeoState')\n    const { longitude, latitude } = newViewport\n    const newArea = projection\n      ? Math.abs((projection.metersPerPixel[0] * rectSide * projection.metersPerPixel[1] * rectSide) / (1000 * 1000))\n      : 0\n\n    const dx = (rectSide / 2) * projection.degreesPerPixel[0]\n    const dy = (rectSide / 2) * projection.degreesPerPixel[1]\n    const newBounds = [\n      longitude - dx,\n      latitude - dy,\n      longitude + dx,\n      latitude + dy\n    ]\n    if (newArea !== area) setArea(newArea)\n    if (newBounds !== bounds) setBounds(newBounds)\n    setViewport(newViewport)\n  }, 500), [])\n\n  let snack = null\n  let onSnackClose = () => {}\n  let snackTimeout = null\n\n  switch (toolState) {\n    case STATES.NAVIGATING:\n      snack = tooBig ? null : <SnackbarContent\n        className={classes.snack}\n        aria-describedby='client-snackbar'\n        message={'Place the square around the area you wish to download for later use'}\n        action={[\n          <Button\n            key='action1'\n            color='inherit'\n            disabled={area > home.Offline.maxMapTileArea}\n            onClick={() => onStartDownload(bounds, viewState)}\n          >\n             Start Download\n          </Button>\n        ]}\n      />\n      break\n    case STATES.DOWNLOADING:\n      snack = <SnackbarContent\n        className={classes.snack}\n        aria-describedby='client-snackbar'\n        message={'Downloading...'}\n        action={[\n          <Button key='action1' color='inherit' onClick={onCancel}>Cancel</Button>\n        ]}\n      />\n      break\n    case STATES.LOCKED:\n      snack = <SnackbarContent\n        className={classes.snack}\n        aria-describedby='client-snackbar'\n        message={'This is the area you downloaded last'}\n        action={[\n          <Button key='action1' color='secondary' onClick={onUnlock}>Download a new Area</Button>\n        ]}\n      />\n      break\n    case STATES.OFFLINE:\n      snack = <SnackbarContent\n        className={classes.snack}\n        aria-describedby='client-snackbar'\n        message={'You cannot download content when you are offline.'}\n      />\n      break\n    case STATES.CANCELED:\n      snack = <SnackbarContent\n        className={classes.snackError}\n        aria-describedby='client-snackbar'\n        message={'Cancelling...'}\n      />\n      onSnackClose = onCancelComplete\n      snackTimeout = 2000\n      break\n    default:\n      break\n  }\n\n  const unlocked = toolState === STATES.NAVIGATING\n\n  return (\n    <div className={classes.root}>\n      <CssBaseline /> {/* You only need this in a root element. Don't put it anywhere else in the dom */}\n      <AppBar position='static' className={classes.appBar}>\n        <Toolbar disableGutters>\n          <IconButton className={classes.menuButton} color='inherit' onClick={onMenuBack} aria-label='Menu'>\n            <ArrowBackIcon />\n          </IconButton>\n          <Typography variant='subtitle1' color='inherit' className={classes.toolbarTitle}>\n            Offline data manager\n          </Typography>\n        </Toolbar>\n      </AppBar>\n      <div className={classes.mapWrapper} ref={mapWrapperRef}>\n        <BaseMap\n          hideNavControls\n          showMe={unlocked}\n          dragPan={unlocked}\n          dragRotate={false}\n          scrollZoom={unlocked}\n          doubleClickZoom={false}\n          touchZoom={unlocked}\n          touchRotate={false}\n          viewport={initViewport}\n        >\n          {(viewport, height, width, projection) => {\n            const rectSide = Math.min(height, width) * 0.6\n            const rectStyle = { height: rectSide, width: rectSide }\n            const boxCorners = {\n              x: (width / 2) - (rectSide / 2),\n              y: (height / 2) - (rectSide / 2)\n            }\n\n            const totalProgress = progress.tileTick && progress.seriesTick && progress.seriesPhotoTick\n              ? [\n                progress.tileTick[0] + progress.seriesTick[0] + progress.seriesPhotoTick[0],\n                progress.tileTick[1] + progress.seriesTick[1] + progress.seriesPhotoTick[1]\n              ] : [0, 1]\n            // divide by zero check\n            if (totalProgress[1] === 0) totalProgress[1] = 1\n            setGeoState(viewport, projection, rectSide)\n\n            return (\n              <div style={{ height, width }}>\n                <div className={classWithState('rectContents')} style={rectStyle}>\n                  {toolState !== STATES.DOWNLOADING && (\n                    <Typography className={classNames(classes.areaLabel, tooBig ? classes.tooBig : null)} color='inherit' variant='h5' component='div'>\n                      {numeral(area).format('0,0')} km²\n                    </Typography>\n                  )}\n                  { toolState === STATES.NAVIGATING && !tooBig && (\n                    <CheckCircleOutlineIcon className={classes.rectIcon} color='inherit' onClick={() => onStartDownload(bounds, viewState)} />\n                  )}\n                  {toolState === STATES.NAVIGATING && tooBig\n                    ? <div>\n                      <Typography color='inherit' variant='body1' component='div'>\n                          > {home.Offline.maxMapTileArea} km²\n                      </Typography>\n                      <ErrorIcon className={classes.rectIcon} color='inherit' />\n                      <Typography color='inherit' variant='body2' component='div'>\n                      Window too big. Try zooming in.\n                      </Typography>\n                    </div>\n                    : null\n                  }\n                  {toolState === STATES.DOWNLOADING && (\n                    <div className={classes.downloadingProgress}>\n                      <Typography className='areaLabel' color='inherit' variant='h5'>\n                      Downloading...\n                      </Typography>\n                      <CircularProgress\n                        className={classes.downloadingProgressCircle}\n                        variant='determinate'\n                        size={rectSide * 0.4}\n                        thickness={rectSide * 0.013}\n                        value={Math.floor(100 * totalProgress[0] / totalProgress[1])}\n                        color='inherit'\n                      />\n                      {progress.tileTick && <Typography color='inherit' variant='body1' component='div'>\n                        Map Tiles: {progress.tileTick[0]} of {progress.tileTick[1]}\n                      </Typography>}\n                      {progress.seriesTick && <Typography color='inherit' variant='body1' component='div'>\n                        Series: {progress.seriesTick[0]} of {progress.seriesTick[1]}\n                      </Typography>}\n                      {progress.seriesPhotoTick && <Typography color='inherit' variant='body1' component='div'>\n                        Series Photos: {progress.seriesPhotoTick[0]} of {progress.seriesPhotoTick[1]}\n                      </Typography>}\n                    </div>\n                  )}\n                  {toolState === STATES.LOCKED && (\n                    <div>\n                      <LockIcon className={classes.rectIcon} color='inherit' />\n                    </div>\n                  )}\n                  {toolState === STATES.OFFLINE && (\n                    <div>\n                      <SignalWifiOffIcon className={classes.rectIcon} color='inherit' />\n                    </div>\n                  )}\n                </div>\n                <svg xmlns='http://www.w3.org/2000/svg' style={{ height, width }}>\n                  <defs>\n                    <path id='Triangle' d='M 16,0 L -8,9 v-18 z' fill='black' stroke='none' />\n                  </defs>\n                  <g fillRule='evenodd' className={classWithState('svgCutout')} >\n                    <path d={`\n                            M 0 0 L ${width} ${0} L ${width} ${height}  L ${0} ${height} Z\n                             M ${boxCorners.x} ${boxCorners.y} \n                             L ${width - boxCorners.x} ${boxCorners.y}\n                             L ${width - boxCorners.x} ${height - boxCorners.y} \n                             L ${boxCorners.x} ${height - boxCorners.y} Z\n                             `} />\n                  </g>\n                  <g fillRule='evenodd' className={classWithState('svgBorder')} >\n                    <path d={`\n                             M ${boxCorners.x} ${boxCorners.y} \n                             L ${width - boxCorners.x} ${boxCorners.y}\n                             L ${width - boxCorners.x} ${height - boxCorners.y} \n                             L ${boxCorners.x} ${height - boxCorners.y} Z\n                             `} />\n                  </g>\n                </svg>\n              </div>\n            )\n          }}\n        </BaseMap>\n        {snack && (\n          <Snackbar\n            anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }}\n            open\n            onClose={onSnackClose}\n            autoHideDuration={snackTimeout}\n          >\n            {snack}\n          </Snackbar>\n        )}\n      </div>\n    </div>\n  )\n}\n\nOfflineMap.propTypes = {\n  toolState: PropTypes.oneOf(Object.values(STATES)),\n  onMenuBack: PropTypes.func.isRequired,\n  initViewport: PropTypes.object,\n  progress: PropTypes.shape({\n    tileTick: PropTypes.array,\n    seriesTick: PropTypes.array,\n    seriesPhotoTick: PropTypes.array\n  }),\n  onStartDownload: PropTypes.func.isRequired,\n  onCancel: PropTypes.func.isRequired,\n  onCancelComplete: PropTypes.func.isRequired,\n  onUnlock: PropTypes.func.isRequired\n}\n\nexport default OfflineMap\n","import React, { useState, useContext, useMemo, useRef, useEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport { connect } from 'react-redux'\nimport actions from '../redux/actions'\nimport Bottleneck from 'bottleneck'\nimport { AppContext } from '../contexts'\nimport { home } from '../config'\nimport { graphql } from 'react-apollo'\nimport { getWholeSeries, geoSeriesIdOnly } from '../graphql/queries'\nimport { long2tile, lat2tile } from 'geotilehash'\nimport OfflineMap, { STATES } from '../components/maps/OfflineMap'\n\nconst OfflineMapConnect = ({\n  onMenuBack,\n  lastMapViewport, completedDownload, viewport, setOfflineCompleted, setOfflineViewport\n}) => {\n  const [toolState, setToolState] = useState(viewport && completedDownload ? STATES.LOCKED : STATES.NAVIGATING)\n  const limiterRef = useRef()\n  const { online } = useContext(AppContext)\n\n  // Setting the bounds is what kicks off the whole process\n  const [bounds, setBounds] = useState(null)\n  // Series ids only get set when the geoQuery finishes\n  const [seriesIds, setSeriesIds] = useState(null)\n  // This is the current Series object we are putting through the query\n  const [activeSeriesId, setActiveSeriesId] = useState(null)\n  const [seriesPhotos, setSeriesPhotos] = useState([])\n\n  const [tileTick, setTileTick] = useState([0, 0])\n  const [seriesTick, setSeriesTick] = useState([0, 0])\n  const [seriesPhotoTick, setSeriesPhotoTick] = useState([0, 0])\n\n  // We're dealing in asynchronous so we need a ref to make sure we're usign the current values\n  const tileTickRef = useRef()\n  tileTickRef.current = { tileTick, seriesTick, seriesPhotoTick, seriesIds, seriesPhotos }\n\n  const onTileTick = () => setTileTick([tileTickRef.current.tileTick[0] + 1, tileTickRef.current.tileTick[1]])\n  const onTileAdd = (num) => setTileTick([tileTickRef.current.tileTick[0], tileTickRef.current.tileTick[1] + num])\n  const onSeriesPhotoTick = () => {\n    setSeriesPhotoTick([tileTickRef.current.seriesPhotoTick[0] + 1, tileTickRef.current.seriesPhotoTick[1]])\n  }\n  const onSeriesPhotoAdd = (num) => setSeriesPhotoTick([tileTickRef.current.seriesPhotoTick[0], tileTickRef.current.seriesPhotoTick[1] + num])\n\n  const onSeriesTick = (urls) => {\n    const theTick = tileTickRef.current.seriesTick\n    const theIds = tileTickRef.current.seriesIds.ids\n    const thePhotos = tileTickRef.current.seriesPhotos\n    if (urls) {\n      let addCount = 0\n      urls.map(url => {\n        if (thePhotos.indexOf(url) === -1) {\n          addCount++\n          setSeriesPhotos([...thePhotos, url])\n          limiterRef.current.schedule(() => makeRequest('GET', url))\n            .then(onSeriesPhotoTick)\n          // Maybe we should do something different on errors (but what?)\n            .catch(onSeriesPhotoTick)\n        }\n      })\n      onSeriesPhotoAdd(addCount)\n    }\n    // now kick off the next series\n    if (theTick && theIds[theTick[0]]) {\n      setActiveSeriesId(theIds[theTick[0] + 1])\n      setSeriesTick([theTick[0] + 1, theTick[1]])\n    }\n    else {\n      // We are done the series\n    }\n  }\n\n  const finalState = useMemo(() => online ? toolState : STATES.OFFLINE, [online, toolState])\n\n  const geoSeriesQuery = useMemo(() => <GeoQuery bounds={bounds} setSeriesIds={setSeriesIds} />, [bounds])\n  const wholeSeriesQuery = useMemo(() => <WholeSeriesConnect id={activeSeriesId} onDone={onSeriesTick} />, [activeSeriesId])\n\n  const onStart = (bounds, viewport) => {\n    setToolState(STATES.DOWNLOADING)\n    setBounds(bounds)\n    setOfflineViewport(viewport)\n  }\n\n  const onDone = () => {\n    setToolState(STATES.LOCKED)\n    setOfflineCompleted(true)\n  }\n\n  const onCancel = () => {\n    setToolState(STATES.CANCELED)\n    setBounds(null)\n    setSeriesIds(null)\n    setTileTick([0, 0])\n    setSeriesTick([0, 0])\n    setSeriesPhotoTick([0, 0])\n    setSeriesPhotos([])\n    limiterRef.current.stop({ dropWaitingJobs: true })\n    limiterRef.current = null\n    limiterRef.current = new Bottleneck({ maxConcurrent: 5 })\n  }\n\n  // Initialize the bottleNeck\n  useEffect(() => {\n    limiterRef.current = new Bottleneck({ maxConcurrent: 5 })\n  }, [])\n\n  // This is a little taxing so we keep it async\n  useEffect(() => {\n    if (bounds) {\n      const tiles = getTiles(bounds, [0, home.Offline.highestOfflineTileZoom])\n      const length = tiles.length\n      if (length === 0) return\n      onTileAdd(length)\n      tiles.forEach(tile => {\n        limiterRef.current.schedule(() => makeRequest('GET', tile))\n          .then(onTileTick)\n          // Maybe we should do something different on errors (but what?)\n          .catch(onTileTick)\n      })\n    }\n  }, [bounds])\n\n  // If we see series then kick off that cascade\n  useEffect(() => {\n    // console.log('OfflineMap:: kicking off the series loading', { seriesTick, seriesIds })\n    if (seriesIds && seriesIds.ids) {\n      // Kick off the series loading\n      if (seriesIds.ids.length > 0) setActiveSeriesId(seriesIds.ids[0])\n      setSeriesTick([0, seriesIds.ids.length])\n      setSeriesPhotoTick([0, 0])\n    }\n  }, [seriesIds])\n\n  useEffect(() => {\n    const newTotal = [tileTick[0] + seriesTick[0] + seriesPhotoTick[0], tileTick[1] + seriesTick[1] + seriesPhotoTick[1]]\n    if (newTotal[1] > 0 && newTotal[0] === newTotal[1]) onDone()\n  }, [tileTick, seriesTick, seriesPhotoTick])\n\n  return (\n    <React.Fragment>\n      {wholeSeriesQuery}\n      {geoSeriesQuery}\n      <OfflineMap\n        onMenuBack={() => {\n          onCancel()\n          onMenuBack()\n        }}\n        onStartDownload={onStart}\n        onCancel={onCancel}\n        initViewport={viewport || lastMapViewport}\n        progress={{ tileTick, seriesTick, seriesPhotoTick }}\n        toolState={finalState}\n\n        onCancelComplete={() => {\n          setToolState(STATES.NAVIGATING)\n        }}\n        onUnlock={() => {\n          setToolState(STATES.NAVIGATING)\n          setOfflineCompleted(false)\n        }}\n      />\n    </React.Fragment>\n  )\n}\nOfflineMapConnect.propTypes = {\n  // All from redux\n  onMenuBack: PropTypes.func.isRequired,\n  lastMapViewport: PropTypes.object,\n  completedDownload: PropTypes.bool,\n  viewport: PropTypes.object,\n  setOfflineCompleted: PropTypes.func.isRequired,\n  setOfflineViewport: PropTypes.func.isRequired\n}\n\nconst withGeoSearch = graphql(geoSeriesIdOnly, {\n  props: ({ data, ownProps }) => {\n    if (data.error) console.error(data.error)\n    console.log('OfflineMap::withGeoSearch:: ', { data, ownProps })\n    try {\n      // Fetch until we have everything\n      if (!data.loading && !data.error && data.seriesInGeoBounds && data.seriesInGeoBounds.seriesSummaries.length > 0 && data.seriesInGeoBounds.nextToken) {\n        ownProps.setSeriesIds({ ids: [], loading: true })\n        // console.log('OfflineMap::withGeoSearch::fetchMore', { ...data.variables, nextToken: data.seriesInGeoBounds.nextToken })\n        data.fetchMore({\n          variables: { ...data.variables, nextToken: data.seriesInGeoBounds.nextToken },\n          // How do we mush the new query with the old one\n          updateQuery: (prev, { fetchMoreResult }) => {\n            // console.log('OfflineMap::withGeoSearch::updateQuery', { prev, fetchMoreResult })\n            return {\n              seriesInGeoBounds: {\n                ...fetchMoreResult.seriesInGeoBounds,\n                seriesSummaries: [ ...prev.seriesInGeoBounds.seriesSummaries, ...fetchMoreResult.seriesInGeoBounds.seriesSummaries ]\n              }\n            }\n          }\n        })\n      }\n      else if (data.loading || data.error) {\n        // console.log('OfflineMap::withGeoSearch::loading or errir')\n        ownProps.setSeriesIds({ ids: [], loading: true })\n      }\n      else {\n        console.log('OfflineMap::withGeoSearch::DONE')\n        if (data && data.seriesInGeoBounds) {\n          ownProps.setSeriesIds({ ids: data.seriesInGeoBounds.seriesSummaries.map(s => s.id), loading: false })\n        }\n      }\n    }\n    catch (e) {\n      console.error(data)\n      console.error(e)\n    }\n    return {\n      data,\n      loading: data.loading\n    }\n  },\n  skip: ({ bounds }) => !bounds,\n  options: ({ bounds }) => ({\n    variables: {\n      bounds,\n      limit: 100\n      // nextToken\n    }\n  })\n})\n\n/**\n * Here's the graphql HOC that gets an individual series\n */\nconst withGetSelectedQuery = graphql(getWholeSeries, {\n  skip: ({ id }) => !id,\n  props: ({ data, ownProps }) => {\n    if (data.error) console.error(data.error)\n    // console.log('OfflineMap::withGetSelectedQuery:: ', { data })\n    let series = null\n    try {\n      if (!data.loading && !data.error) {\n        series = data.series\n        // console.log('OfflineMap::withGetSelectedQuery::series', series)\n        const urls = []\n        urls.push(series.createdUser.gravatar)\n        urls.push(series.updatedUser.gravatar)\n        series.photos.forEach(ph => {\n          urls.push(ph.createdUser.gravatar)\n          urls.push(ph.updatedUser.gravatar)\n          // Skip medium for size sake\n          home.Offline.seriesImgsToCache\n            .map(size => urls.push(`${ph.paths.base}${ph.paths[size]}`))\n        })\n        // Remove duplicates and send it back\n        ownProps.onDone([...new Set(urls)])\n      }\n    }\n    catch (e) {\n      console.log('OfflineMap::withGetSelectedQuery:: error', { data, e })\n      console.error(e)\n    }\n    return {\n      data,\n      loading: data.loading,\n      series\n    }\n  },\n  options: ({ id }) => ({\n    variables: {\n      id\n    }\n  })\n})\n// We're using graphql() HOC because it's convenient but it doesn't need to render anything\nconst WholeSeriesConnect = withGetSelectedQuery(() => null)\nconst GeoQuery = withGeoSearch(() => null)\n\n/**\n * Map our redux state and functions\n */\nconst mapStateToProps = (state, props) => {\n  const lastMapViewport = state.map.slice(-1).pop()\n  const { completedDownload, viewport } = state.offline\n  return { lastMapViewport, completedDownload, viewport }\n}\n\nconst mapDispatchToProps = dispatch => ({\n  onMenuBack: () => {\n    dispatch(actions.homeStateBack())\n  },\n  setOfflineCompleted: (bVal) => {\n    dispatch(actions.setOfflineCompleted(bVal))\n  },\n  setOfflineViewport: (viewport) => {\n    dispatch(actions.setOfflineViewport(viewport))\n  }\n})\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(OfflineMapConnect)\n\n/**\n * Promisify our XMLHttpRequests\n * @param {*} method\n * @param {*} url\n */\nfunction makeRequest (method, url) {\n  return new Promise((resolve, reject) => {\n    var xhr = new XMLHttpRequest()\n    xhr.open(method, url)\n    xhr.onload = () => {\n      if (xhr.status >= 200 && xhr.status < 300) resolve(xhr.response)\n      else reject(new Error(xhr.statusText))\n    }\n    xhr.onerror = () => {\n      reject(new Error(xhr.statusText))\n    }\n    xhr.send()\n  })\n}\n\nexport const getTileURL = (url, zoom, x, y) => {\n  const newUrl = url + `?access_token=${process.env.REACT_APP_MAPBOX_TOKEN}`\n  return newUrl.replace('{z}/{x}/{y}', `${zoom}/${x}/${y}`)\n}\n\n/**\n * Loop over all the tiles and zoom levels and build\n * us an array of URLs\n * @param {*} bounds\n * @param {*} right\n */\nexport function getTiles (bounds, zoomRange) {\n  const tiles = []\n\n  for (let zoom = zoomRange[0]; zoom <= zoomRange[1]; zoom++) {\n    const xtileLeft = long2tile(bounds[0], zoom)\n    const xtileRight = long2tile(bounds[2], zoom)\n\n    const ytileTop = lat2tile(bounds[1], zoom)\n    const ytileBottom = lat2tile(bounds[3], zoom)\n\n    for (let x = xtileLeft; x <= xtileRight; x++) {\n      for (let y = ytileTop; y <= ytileBottom; y++) {\n        // Push both tiles\n        tiles.push(getTileURL(process.env.REACT_APP_TILEURL_SAT, zoom, x, y))\n        tiles.push(getTileURL(process.env.REACT_APP_TILEURL_TOPO, zoom, x, y))\n      }\n    }\n  }\n  return tiles\n  // console.log('Starting Coords', { tiles, top, left, bottom, right })\n}\n","import React, { useState, useEffect, useCallback } from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport AppBar from '@material-ui/core/AppBar'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport Snackbar from '@material-ui/core/Snackbar'\nimport SnackbarContent from '@material-ui/core/SnackbarContent'\nimport IconButton from '@material-ui/core/IconButton'\nimport Typography from '@material-ui/core/Typography'\n\n// import RawImg from './subViews/RawImage'\nimport QRcodeIcon from '../../../icons/QRCode'\nimport jsQR from 'jsqr'\nimport { debounce } from '../../../lib/util'\n// import useFileInput from '../../../lib/useFileInput'\nimport {\n  green, red\n} from '@material-ui/core/colors'\n\nimport ArrowBackIcon from '@material-ui/icons/ArrowBack'\nimport Paper from '@material-ui/core/Paper'\n// import MenuIcon from '@material-ui/icons/Menu'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { useCamera } from '../../../lib/useCamera'\n\nconst CAMERAWIDTH = 400\nconst CAMERAHEIGHT = 400\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex',\n    height: '100%',\n    flexDirection: 'column'\n  },\n  qrIcon: {\n    border: '5px solid red',\n    padding: theme.spacing(2),\n    position: 'absolute',\n    color: 'white',\n    opacity: 0.4,\n    zIndex: 2,\n    width: '70%',\n    height: '70%',\n    top: '50%',\n    left: '50%',\n    transformOrigin: '50% 50%',\n    transform: 'translateY(-50%) translateX(-50%)'\n  },\n  backupText: {\n    position: 'absolute',\n    color: 'white',\n    textAlign: 'center',\n    zIndex: 2,\n    width: '70%',\n    height: '70%',\n    top: '50%',\n    left: '50%',\n    transformOrigin: '50% 50%',\n    transform: 'translateY(-50%) translateX(-50%)'\n  },\n  manualImg: {\n    position: 'absolute',\n    zIndex: 1\n  },\n  appBar: {\n\n  },\n  inner: {\n    padding: theme.spacing(2),\n    height: '100%',\n    flexGrow: 1,\n    overflow: 'hidden'\n  },\n  tipPaper: {\n    padding: theme.spacing(2),\n    margin: theme.spacing(2)\n  },\n  docContainer: {\n    flexGrow: 1,\n    padding: theme.spacing(2)\n  },\n  cameraContainer: {\n    width: '80%',\n    margin: '0 auto',\n    position: 'relative',\n    // this is a CSS trick: https://spin.atomicobject.com/2015/07/14/css-responsive-square/\n    '&::before': {\n      content: ' ',\n      display: 'block',\n      paddingTop: '100%'\n    }\n  },\n  cameraContainerError: {\n    background: 'black'\n  },\n  snackErr: {\n    background: red[500],\n    color: 'white'\n  },\n  snackSuccess: {\n    background: green[500],\n    color: 'white'\n  },\n  snackMsg: {\n\n  },\n  video: {\n    height: '100%',\n    width: '100%',\n    verticalAlign: 'top'\n    // display: 'none'\n    // position: 'absolute'\n    // top: 0,\n    // left: 0,\n    // zIndex: 1\n    // '@media (orientation: portrait)': {\n    //   transform: 'rotate(90)'\n    // }\n  }\n}))\n\nconst QRReader = ({ onMenuBack, onCapture, isIos }) => {\n  const classes = useStyles()\n  const [capturedBlob, setCapturedBlob] = useState()\n\n  // This is only used for legacy capture\n  const [err, setErr] = useState(null)\n  const [code, setCode] = useState(null)\n  const { cameraError, captureRawData, cameraOnline } = useCamera(setCapturedBlob, CAMERAWIDTH, CAMERAHEIGHT)\n\n  // limit to 10 frames per second\n  const captureFunc = useCallback(debounce(captureRawData, 100), [cameraOnline, cameraError])\n\n  useEffect(() => {\n    const scan = async () => {\n      let scannedCode = null\n      try {\n        scannedCode = await jsQRFromBlob(capturedBlob)\n      }\n      catch (e) {\n        console.error(e)\n      }\n      try {\n        // If we're capturing images manually then we do this every time\n        if (cameraError && !scannedCode) throw new Error('Captured Image does not have a QR code')\n        if (scannedCode) {\n          const find = '?fromqr='\n          const foundIdx = scannedCode.data.indexOf(find) + find.length\n          const newData = scannedCode.data.slice(foundIdx)\n          const decodedUrl = JSON.parse(decodeURI(newData))\n          if (!decodedUrl.type || !decodedUrl.id) throw new Error('Type or ID missing from QR Code')\n          setCode(decodedUrl)\n          setErr(null)\n          console.log('QRCODE', scannedCode)\n        }\n      }\n      catch (e) {\n        setErr('Not a valid QR Code')\n        console.error(e)\n      }\n    }\n    if (cameraOnline && !cameraError && !err && !code) {\n      if (!capturedBlob || !capturedBlob.data) captureFunc()\n      else {\n        scan()\n        captureFunc()\n      }\n    }\n  }, [cameraOnline, capturedBlob, err, code])\n\n  // console.log(capturedImg)\n  return (\n    <div className={classes.root}>\n      {/* Render the file picker if there is an error */}\n\n      <CssBaseline /> {/* You only need this in a root element. Don't put it anywhere else in the dom */}\n      <AppBar position='static' className={classes.appBar}>\n        <Toolbar disableGutters>\n          <IconButton className={classes.menuButton} color='inherit' onClick={onMenuBack} aria-label='Menu'>\n            <ArrowBackIcon />\n          </IconButton>\n          <Typography variant='subtitle1' color='inherit' className={classes.toolbarTitle}>\n            Capture QR Code\n          </Typography>\n        </Toolbar>\n      </AppBar>\n      <div className={classes.inner}>\n        <Paper\n          className={classNames(classes.cameraContainer, cameraError ? classes.cameraContainerError : null)}\n        >\n          <QRcodeIcon className={classes.qrIcon} />\n          {/* {cameraError && <Typography className={classes.backupText}>Click to capture</Typography>} */}\n          {/* {cameraError && capturedBlob && (\n            <RawImg\n              dataUrl={capturedBlob}\n              className={classes.manualImg}\n              // style={{ maxHeight: 'inherit', objectFit: 'contain' }}\n            />\n          )} */}\n          <video\n            autoPlay\n            playsInline\n            muted\n            id='webcam'\n            className={classes.video}\n          />\n        </Paper>\n        <Paper className={classes.tipPaper}>\n          <Typography>TIP: You can find the QR code for a series in the SHARE tab of that series</Typography>\n        </Paper>\n      </div>\n      <Snackbar\n        anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }}\n        open={!!err}\n        autoHideDuration={2000}\n        onClose={() => {\n          setErr(null)\n          setCapturedBlob(null)\n        }}\n      >\n        <SnackbarContent\n          className={classes.snackErr}\n          message={<span className={classes.snackMsg}>{err}</span>}\n        />\n      </Snackbar>\n      {!isIos && (\n        <Snackbar\n          anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }}\n          open={cameraError}\n        >\n          <SnackbarContent\n            className={classes.snackErr}\n            message={<span className={classes.snackMsg}>Camera Error. Check your device's permissions</span>}\n          />\n        </Snackbar>\n      )}\n      <Snackbar\n        anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }}\n        open={!!code}\n        autoHideDuration={500}\n        onClose={() => onCapture(code.type, code.id)}\n      >\n        <SnackbarContent\n          className={classes.snackSuccess}\n          message={<span className={classes.snackMsg}>Valid QR Code found!</span>}\n        />\n      </Snackbar>\n\n    </div>\n  )\n}\n\nQRReader.propTypes = {\n  onMenuBack: PropTypes.func.isRequired,\n  isIos: PropTypes.bool,\n  onCapture: PropTypes.func.isRequired\n}\n\nexport default QRReader\n\nconst jsQRFromBlob = ({ data, imageHeight, imageWidth }) => {\n  return new Promise((resolve, reject) => {\n    try {\n      const qrCode = jsQR(data, imageWidth, imageHeight)\n      resolve(qrCode)\n    }\n    catch (e) {\n      reject(e)\n    }\n  })\n}\n","import React, { useRef, useEffect, useState, useContext } from 'react'\nimport Typography from '@material-ui/core/Typography'\n// import MenuIcon from '@material-ui/icons/Menu'\nimport { makeStyles } from '@material-ui/core/styles'\nimport moment from 'moment'\nimport { AppContext } from '../../contexts'\n\nconst CHECKINTERVAL = 5000\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    background: 'black',\n    color: 'white',\n    textAlign: 'center'\n  }\n}))\n\nconst OfflineBar = () => {\n  const classes = useStyles()\n  const { online, offlineSince } = useContext(AppContext)\n  const [sinceStr, setSinceStr] = useState()\n  const timerRef = useRef()\n\n  const calcSinceStr = () => {\n    const newText = moment(offlineSince, 'x').fromNow()\n    // console.log('OFFLINE SINCE', since, newText)\n    setSinceStr(newText)\n  }\n  const clearTimer = () => {\n    if (timerRef.current) {\n      clearInterval(timerRef.current)\n      timerRef.current = null\n    }\n  }\n\n  useEffect(() => {\n    if (offlineSince && !timerRef.current) {\n      calcSinceStr()\n      timerRef.current = setInterval(calcSinceStr, CHECKINTERVAL)\n    }\n    else if (!offlineSince)clearTimer()\n    return () => {\n      clearTimer()\n    }\n  }, [offlineSince])\n\n  if (online) return null\n  return (\n    <Typography className={classes.root} variant='caption' component='div'>\n      Offline ({sinceStr})\n    </Typography>\n  )\n}\n\nexport default OfflineBar\n","import React, { useContext } from 'react'\nimport classNames from 'classnames'\nimport PropTypes from 'prop-types'\n\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport AppBar from '@material-ui/core/AppBar'\nimport Paper from '@material-ui/core/Paper'\nimport Typography from '@material-ui/core/Typography'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport Button from '@material-ui/core/Button'\n// import Fab from '@material-ui/core/Fab'\n\nimport HomeIcon from '@material-ui/icons/HomeOutlined'\nimport MapIcon from '@material-ui/icons/MapOutlined'\nimport SearchIcon from '@material-ui/icons/SearchOutlined'\nimport AddIcon from '@material-ui/icons/Add'\nimport PersonOutline from '@material-ui/icons/PersonOutline'\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport AddFab from '../components/PhotoSeries/views/controls/AddFab'\nimport OfflineBar from './misc/OfflineBar'\n\nimport { AppContext } from '../contexts'\n\nimport { home as homeConfig } from '../config'\n\nconst STATES = homeConfig.AppStateTypes\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    borderTop: `2px solid ${theme.palette.secondary.main}`\n  },\n  text: {\n    padding: theme.spacing(2, 2, 0)\n  },\n  paper: {\n    paddingBottom: 50\n  },\n  list: {\n    marginBottom: theme.spacing(2)\n  },\n  subheader: {\n    backgroundColor: theme.palette.background.paper\n  },\n  grow: {\n    flexGrow: 1\n  },\n  addFab: {\n    position: 'absolute',\n    bottom: 0,\n    left: '50%',\n    transformOrigin: '0% 100%',\n    // Promote the list into his own layer on Chrome. This cost memory but helps keeping high FPS.\n    transform: 'translateY(-25%) translateX(-50%) translateZ(0)',\n    zIndex: 200\n  },\n  spacer: {\n    width: 40,\n    flexGrow: 1\n  }\n}))\n\nconst BottomBar = ({ className, domain, signedIn, onHomeClick, onMapClick, onSearchClick, onProfileClick, onCameraClick, onLibraryClick }) => {\n  const classes = useStyles()\n  const { isIos } = useContext(AppContext)\n  return (\n    <AppBar position='static' className={classNames(classes.root, className)}>\n      <Toolbar>\n        {signedIn && (\n          <Button\n            edge='start'\n            className={classes.grow}\n            color={domain === STATES.FEED ? 'secondary' : 'inherit'}\n            onClick={onHomeClick}\n          >\n            <HomeIcon />\n          </Button>\n        )}\n        <Button\n          edge='start'\n          className={classes.grow}\n          color={domain === STATES.MAP ? 'secondary' : 'inherit'}\n          onClick={onMapClick}\n        >\n          <MapIcon />\n        </Button>\n        {signedIn && (\n          <AddFab\n            isIos={isIos}\n            className={classes.addFab}\n            onCameraClick={onCameraClick}\n            onLibraryClick={onLibraryClick}\n          >\n            <AddIcon />\n          </AddFab>\n        )}\n        <div className={classes.spacer} />\n        <Button\n          color={domain === STATES.SEARCH ? 'secondary' : 'inherit'}\n          className={classes.grow}\n          onClick={onSearchClick}\n        >\n          <SearchIcon />\n        </Button>\n        {signedIn && (\n          <Button\n            edge='end'\n            color={domain === STATES.PROFILE ? 'secondary' : 'inherit'}\n            className={classes.grow}\n            onClick={onProfileClick}\n          >\n            <PersonOutline />\n          </Button>\n        )}\n      </Toolbar>\n    </AppBar>\n  )\n}\n\nBottomBar.propTypes = {\n  className: PropTypes.string,\n  domain: PropTypes.string,\n  signedIn: PropTypes.bool,\n  // Here are our button handlers\n  onHomeClick: PropTypes.func.isRequired,\n  onMapClick: PropTypes.func.isRequired,\n  onSearchClick: PropTypes.func.isRequired,\n  onProfileClick: PropTypes.func.isRequired,\n  onCameraClick: PropTypes.func.isRequired,\n  onLibraryClick: PropTypes.func.isRequired\n}\n\nexport default BottomBar\n\nexport const BottomBarCosmosWrapper = (props) => {\n  // const [someStateItem, setSomeStateItem] = useState()\n  const classes = useWrapperStyles()\n  return (\n    <div className={classes.root}>\n      <OfflineBar />\n      <CssBaseline /> {/* You only need this in a root element. Don't put it anywhere else in the dom */}\n      <Paper className={classes.paper}>\n        <Typography variant='h5'>\n          This is a dummy component.\n        </Typography>\n      </Paper>\n      <BottomBar {...props} />\n    </div>\n  )\n}\n\nconst wrapperStyle = theme => ({\n  root: {\n    height: '100%',\n    display: 'flex',\n    flexDirection: 'column'\n  },\n  paper: {\n    flexGrow: 1\n  }\n})\n\nconst useWrapperStyles = makeStyles(wrapperStyle)\n","import React, { useContext, useEffect } from 'react'\nimport PropTypes from 'prop-types'\n\nimport CssBaseline from '@material-ui/core/CssBaseline'\n\nimport UploaderConnect from '../containers/Uploader.connect'\nimport SeriesConnect from '../containers/Series.connect'\nimport MapConnect from '../containers/Map.connect'\nimport SearchConnect from '../containers/Search.connect'\nimport ProfileConnect from '../containers/Profile.connect'\nimport FeedConnect from '../containers/Feed.connect'\nimport OfflineMap from '../containers/OfflineMap.connect'\n\nimport QRReader from './PhotoSeries/views/QRReader'\nimport OfflineBar from './misc/OfflineBar'\nimport BottomBar from './BottomBar'\nimport { AppContext } from '../contexts'\n\nimport { makeStyles } from '@material-ui/core/styles'\nimport { home as homeConfig } from '../config'\n\nimport { ThemeProvider } from '@material-ui/styles'\nimport themes from '../themes'\n// import { DesktopWindowsTwoTone } from '@material-ui/icons'\n\nconst STATES = homeConfig.AppStateTypes\n\nconst useStyles = makeStyles(theme => ({\n  outerRoot: {\n    height: '100%',\n    overflow: 'hidden'\n  },\n  root: {\n    height: '100%',\n    overflow: 'hidden',\n    display: 'flex',\n    flexDirection: 'column'\n  },\n  offlineBar: {\n    flex: '0 0'\n  },\n  activeWrapper: {\n    overflow: 'hidden',\n    flexGrow: 1,\n    flexShrink: 1,\n    height: '100%'\n  },\n  uploaderContainer: {\n    zIndex: 100,\n    flex: '0 0'\n  }\n}))\n\n/**\n * This is the over-arching wrapper for the app. It combines all the\n * same place. Time will tell if that's a good strategy.\n */\nconst App = ({ domain, onQRCapture, onMenuBack, setHomeState, onCameraClick, onLibraryClick, children }) => {\n  const classes = useStyles()\n  const { signedIn, user, windowSize, online } = useContext(AppContext)\n\n  useEffect(() => {\n    // Anonymous Users are only allowed home and search\n    if (!signedIn && [STATES.MAP, STATES.SEARCH, STATES.SERIES, STATES.QRCAPTURE].indexOf(domain) < 0) setHomeState(STATES.MAP)\n  }, [domain])\n\n  let showBottomBar = true\n  let activeProps = {}\n  let ActiveComponent = FeedConnect\n  switch (domain) {\n    case STATES.FEED:\n      activeProps = { online }\n      ActiveComponent = FeedConnect\n      break\n    case STATES.MAP:\n      activeProps = { online }\n      ActiveComponent = MapConnect\n      break\n    case STATES.PROFILE:\n      ActiveComponent = ProfileConnect\n      activeProps = { user, online }\n      break\n    case STATES.SEARCH:\n      ActiveComponent = SearchConnect\n      break\n    case STATES.SERIES:\n      ActiveComponent = SeriesConnect\n      activeProps = { user, online }\n      showBottomBar = false\n      break\n    case STATES.NEW_SERIES_CAMERA:\n      activeProps = { user, online }\n      ActiveComponent = SeriesConnect\n      showBottomBar = false\n      break\n    case STATES.OFFLINE_DOWNLOAD:\n      ActiveComponent = OfflineMap\n      showBottomBar = false\n      break\n    case STATES.NEW_SERIES_LIBRARY:\n      activeProps = { user, online }\n      ActiveComponent = SeriesConnect\n      showBottomBar = false\n      break\n    case STATES.QRCAPTURE:\n      ActiveComponent = QRReader\n      showBottomBar = false\n      activeProps = { onCapture: onQRCapture, onMenuBack }\n      break\n    default:\n      break\n  }\n\n  return (\n    <div className={classes.outerRoot}>\n      <div className={classes.root} style={{ width: windowSize.width, height: windowSize.height }}>\n        <CssBaseline /> {/* You only need this in a root element. Don't put it anywhere else in the dom */}\n        <OfflineBar className={classes.offlineBar} />\n        <div className={classes.activeWrapper}>\n          <ActiveComponent {...activeProps} />\n        </div>\n        { showBottomBar && (\n          <ThemeProvider theme={themes.bottombar}>\n            <BottomBar\n              signedIn={signedIn}\n              domain={domain}\n              onHomeClick={() => setHomeState(STATES.FEED)}\n              onMapClick={() => setHomeState(STATES.MAP)}\n              onSearchClick={() => setHomeState(STATES.SEARCH, { search: null })}\n              onProfileClick={() => setHomeState(STATES.PROFILE)}\n              onCameraClick={onCameraClick}\n              onLibraryClick={onLibraryClick}\n            />\n          </ThemeProvider>\n        )}\n        {/* Uploader is persistent across all views */}\n        <UploaderConnect className={classes.uploaderContainer} />\n        {children}\n      </div>\n    </div>\n  )\n}\n\nApp.propTypes = {\n  // All of this comes in from From Redux\n  domain: PropTypes.string.isRequired,\n  children: PropTypes.any,\n  setHomeState: PropTypes.func.isRequired,\n  onCameraClick: PropTypes.func.isRequired,\n  onLibraryClick: PropTypes.func.isRequired,\n  onQRCapture: PropTypes.func.isRequired,\n  onMenuBack: PropTypes.func.isRequired\n}\n\nexport default App\n","import React, { useEffect } from 'react'\nimport { Query, ApolloProvider, compose } from 'react-apollo'\nimport { IntlWrapper } from '../translations'\nimport { getUser } from '../graphql/queries'\nimport themes from '../themes'\nimport { AppContext } from '../contexts'\nimport Loading from '../components/auth/Loading'\nimport ErrorBoundary from '../lib/ErrorBoundary'\nimport ErrorConnect from './Error.connect'\nimport useGraphQL, { APOLLOSTATES } from '../graphql/useGraphQL'\nimport useAuthentication from '../lib/useAuthentication'\nimport useShowAddToHome from '../lib/useShowAddToHome'\nimport useOnline from '../lib/useOnline'\nimport useResponsive from '../lib/useResponsive'\nimport withReduxProvider from '../redux/withReduxProvider'\nimport { connect } from 'react-redux'\nimport actions from '../redux/actions'\nimport { imgStore } from '../graphql/offline'\nimport { home as homeConfig } from '../config'\n\nimport App from '../components/App'\nimport { ThemeProvider } from '@material-ui/styles'\n\n/**\n * HOC for AppContext and ApolloProvider\n */\nexport const withApolloAuthProvider = Wrapped => ({\n  onQRClick, onAvatarClick, setUseOffline, onOfflineMenuClick, dismissInstall, flags, ...props\n}) => {\n  // console.log('withApolloAuthProvider', props)\n  const { isGod, signedIn, authData, signOut, authScreen, forceSignIn } = useAuthentication(flags.useLoggedOut, setUseOffline)\n\n  const { client: apolloClient, done: apolloDone, currState: apolloState } = useGraphQL()\n\n  // This triggers all the PWA Goodness\n  const { online, offlineSince } = useOnline()\n  const { installPrompt, addToHomeScreen } = useShowAddToHome(flags.install, dismissInstall)\n  const responsive = useResponsive()\n\n  // If the user hasn't decided to be anonymous or sign in yet show them the login screen\n  // console.log('Rendering AppConnect', { flags, responsive, props, signedIn, isGod, authData })\n  useEffect(() => {\n    if (signedIn === true && flags.useLoggedOut) setUseOffline(false)\n    else if (signedIn === false && !flags.useLoggedOut) setUseOffline(true)\n  }, [signedIn])\n\n  if (!apolloDone) return <Loading message={APOLLOSTATES[apolloState]} />\n\n  if (signedIn === null && !flags.useLoggedOut) return authScreen\n\n  // These are the things the rest of the app needs to find:\n  const appContext = {\n    signOut,\n    forceSignIn: () => {\n      setUseOffline(false)\n      forceSignIn()\n    },\n    onOfflineMenuClick,\n    getPhotoUrls: async (photo, sizePriority) => {\n      // console.log('getPhotoUrls::', { photo, size })\n      try {\n        if (photo.uploadToken) {\n          const dbKeys = await imgStore.keys()\n          if (dbKeys.indexOf(photo.uploadToken) > -1) {\n            const data = await imgStore.getItem(photo.uploadToken)\n            // console.log('getPhotoUrls:: Found DB Entry. using dataUrl', data)\n            return [data.dataUrl]\n          }\n        }\n        return sizePriority.map(sp => `${photo.paths.base}${photo.paths[sp]}`)\n      }\n      catch (e) {\n        return null\n      }\n    },\n    onAvatarClick,\n    online,\n    offlineSince,\n    ...responsive,\n    signedIn: Boolean(signedIn),\n    role: !signedIn\n      ? 'nonuser'\n      : isGod\n        ? 'admin'\n        : 'user',\n    currentUser: authData, // TODO: Need this supported by a graphql query\n    onQRClick,\n    addToHomeScreen\n  }\n  console.log('DEBUG', online, offlineSince)\n  return (\n  // We wrap the outside in an error handler\n    <ThemeProvider theme={themes.home}>\n      <ApolloProvider client={apolloClient}>\n        <Query query={getUser} skip={!signedIn}>\n          {({ loading, error, data }) => {\n            if (loading) return <Loading message='UserData' />\n            if (error) {\n              console.error(error)\n            }\n            if (signedIn) appContext.user = data.user\n            return (\n              <AppContext.Provider value={appContext}>\n                <IntlWrapper>\n                  <Wrapped {...props}>\n                    {installPrompt}\n                  </Wrapped>\n                </IntlWrapper>\n              </AppContext.Provider>\n            )\n          }}\n        </Query>\n      </ApolloProvider>\n    </ThemeProvider>\n  )\n}\n\n/**\n * Map our redux state and functions\n */\nconst mapStateToProps = (state, props) => {\n  const { domain } = state.home.current\n  return { domain, flags: state.flags }\n}\n\nconst mapDispatchToProps = dispatch => ({\n  setHomeState: (newDomain, newParams) => {\n    dispatch(actions.setHomeState(newDomain, newParams))\n  },\n  onCameraClick: () => {\n    dispatch(actions.setHomeState(homeConfig.AppStateTypes.NEW_SERIES_CAMERA))\n  },\n  onLibraryClick: () => {\n    dispatch(actions.setHomeState(homeConfig.AppStateTypes.NEW_SERIES_LIBRARY))\n  },\n  onOfflineMenuClick: () => {\n    dispatch(actions.setHomeState(homeConfig.AppStateTypes.OFFLINE_DOWNLOAD))\n  },\n  dismissInstall: () => {\n    dispatch(actions.setFlag('install', false))\n  },\n  setUseOffline: (bVal) => {\n    dispatch(actions.setFlag('useLoggedOut', bVal))\n  },\n  onQRClick: () => {\n    dispatch(actions.setHomeState(homeConfig.AppStateTypes.QRCAPTURE))\n  },\n  onMenuBack: () => {\n    dispatch(actions.homeStateBack())\n  },\n  onAvatarClick: (username) => {\n    dispatch(actions.setHomeState(homeConfig.AppStateTypes.SEARCH, {\n      search: { tab: homeConfig.SEARCH_TABS.USER, text: username }\n    }))\n  },\n  onQRCapture: (type, activeSeries) => {\n    switch (type) {\n      case 'series':\n        dispatch(actions.setHomeState(homeConfig.AppStateTypes.SERIES, { activeSeries }))\n        break\n      default:\n        break\n    }\n  }\n})\n\nconst withErrorBoundary = (Wrapped) => (props) => (\n  <ErrorBoundary fallback={ErrorConnect}>\n    <Wrapped {...props} />\n  </ErrorBoundary>\n)\n\n/**\n * Nearly everything we do depends on who you are as a user so we commit this to state\n */\n\n// The order we compose things here matters a lot\nexport default compose(\n  // ORDER IS CRITICAL HERE\n  withReduxProvider,\n  connect(\n    mapStateToProps,\n    mapDispatchToProps\n  ),\n  withApolloAuthProvider,\n  withErrorBoundary\n)(App)\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n)\n\nexport function register (config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href)\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config)\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          )\n        })\n      }\n      else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config)\n      }\n    })\n  }\n}\n\nfunction registerValidSW (swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing\n        if (installingWorker == null) {\n          return\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              )\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration)\n              }\n            }\n            else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.')\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration)\n              }\n            }\n          }\n        }\n      }\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error)\n    })\n}\n\nfunction checkValidServiceWorker (swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type')\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload()\n          })\n        })\n      }\n      else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config)\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      )\n    })\n}\n\nexport function unregister () {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister()\n    })\n  }\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport AppConnect from './containers/App.connect'\nimport * as serviceWorker from './serviceWorker'\n// Here's our global overrides css\nimport './index.css'\n// This is the font we need\nrequire('typeface-roboto')\n\nconsole.log('Rendering Main App')\nReactDOM.render(<AppConnect />, document.getElementById('root'))\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.register()\n\n// This is our image worker to offline cache maptiles AND series photos\nnavigator.serviceWorker.register('imgCacheWorker.js')\n"],"sourceRoot":""}