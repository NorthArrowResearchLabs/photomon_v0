(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{151:function(e,t,a){"use strict";var n=a(73),r=a(9),o=a(54),i="SERIES",l="PHOTO";t.a=function e(t){var a=this;if(Object(o.a)(this,e),this.getTagType=function(e){return a.config.tags.find(function(t){return t.id===e})},this.getTagTypeIndex=function(e){return a.config.tags.findIndex(function(t){return t.id===e})},this.getXYTagTypes=function(){return a.config.tags.filter(function(e){return e.allowXY})},this.getNonXYTagTypes=function(){return a.config.tags.filter(function(e){return e.allowNonXY})},this.getSeriesMeta=function(){return Object.keys(a.config.meta).filter(function(e){return a.config.meta[e].type===i}).reduce(function(e,t){return Object(r.a)({},e,Object(n.a)({},t,a.config.meta[t].default))},{})},this.getPhotoMeta=function(){return Object.keys(a.config.meta).filter(function(e){return a.config.meta[e].type===l}).reduce(function(e,t){return Object(r.a)({},e,Object(n.a)({},t,a.config.meta[t].default))},{})},!t)throw new Error("No seriesConfig object provided to SeriesConfig class");this.config=t}},263:function(e,t,a){"use strict";(function(e){a.d(t,"b",function(){return m});a(12),a(29);var n=a(54),r=a(51),o=a(151),i=a(116),l=a.n(i),c=a(490),s=a.n(c),u=a(66);t.a=function e(t,a){var i=this;Object(n.a)(this,e),this.setMeta=function(){i.meta=JSON.stringify(i.config.getPhotoMeta())},this.newPhoto=function(){return{id:"L-".concat(l()()),uploadToken:l()(),takenOn:Object(r.b)(new Date),meta:JSON.stringify(i.config.getPhotoMeta()),tags:[]}},this.config=new o.a(t),this.photo=a||this.newPhoto()};var m=function(t){console.log("onLibraryAdd Buffered");var a=null,n=null,r=null;try{var o=t.indexOf("base64,")+"base64,".length,i=t.slice(o);a=s.a.create(e.from(i,"base64")).parse(),console.log("got EXIF",a)}catch(l){console.log("EXIF ERROR",l)}if(a&&a.tags){try{a.tags&&a.tags.DateTimeOriginal&&String(a.tags.DateTimeOriginal)&&(n=String(a.tags.DateTimeOriginal))}catch(l){console.log("ERROR GETTING TIMESTAMP",{err:l,exif:a})}try{a.tags.GPSLatitude&&Object(u.b)(a.tags.GPSLatitude)&&a.tags.GPSLongitude&&Object(u.b)(a.tags.GPSLongitude)&&(r=[a.tags.GPSLongitude,a.tags.GPSLatitude])}catch(c){console.error("GPS Longitude and Latitude could not be determined")}}return{exif:a,exifDateTime:n,exifGPS:r}}}).call(this,a(37).Buffer)},278:function(e,t){},439:function(e,t,a){},463:function(e,t){},467:function(e){e.exports={version:8,name:"TheProductMapboxGL",glyphs:"mapbox://fonts/raychaser/{fontstack}/{range}.pbf",metadata:{"mapbox:autocomposite":!0,"mapbox:type":"default"},sources:{MapBaseLayer:{url:"mapbox://mapbox.satellite",type:"raster",tileSize:256}},layers:[{id:"background",type:"background",paint:{"background-color":"rgb(0,0,0)"},interactive:!1},{id:"MapBaseLayer",type:"raster",source:"MapBaseLayer","source-layer":"MapBaseLayer",interactive:!1,paint:{"raster-opacity":1}}]}},468:function(e){e.exports={version:8,name:"MorPhoto - Topo Layer",metadata:{"mapbox:type":"default","mapbox:origin":"outdoors-v11","mapbox:autocomposite":!0,"mapbox:groups":{1444855786460.0557:{name:"Roads",collapsed:!0},1444934295202.7542:{name:"Admin boundaries",collapsed:!0},1444855799204.86:{name:"Bridges",collapsed:!0},1444855769305.6016:{name:"Tunnels",collapsed:!0}},"mapbox:sdk-support":{js:"0.54.0",android:"6.7.0",ios:"4.7.0"}},center:[-112.9425,37.2686],zoom:14,bearing:0,pitch:0,sources:{composite:{url:"mapbox://mapbox.mapbox-streets-v8,mapbox.mapbox-terrain-v2",type:"vector"}},sprite:"mapbox://sprites/raychaser/cjxjv17d741bz1cs34i567d73/ayuihl2d38ufkjhmu0pwx0cto",glyphs:"mapbox://fonts/raychaser/{fontstack}/{range}.pbf",layers:[{id:"land",type:"background",layout:{},paint:{"background-color":["interpolate",["linear"],["zoom"],11,"hsl(35, 32%, 91%)",13,"hsl(35, 12%, 89%)"]}},{id:"landcover",type:"fill",source:"composite","source-layer":"landcover",maxzoom:12,layout:{},paint:{"fill-color":["match",["get","class"],"snow","hsl(0, 0%, 100%)","hsl(75, 62%, 81%)"],"fill-opacity":["interpolate",["exponential",1.5],["zoom"],2,.3,12,0],"fill-antialias":!1}},{id:"national-park",type:"fill",source:"composite","source-layer":"landuse_overlay",minzoom:5,filter:["==",["get","class"],"national_park"],layout:{},paint:{"fill-color":"hsl(100, 58%, 76%)","fill-opacity":["interpolate",["linear"],["zoom"],5,0,6,.75,10,.35]}},{id:"national_park-tint-band",type:"line",source:"composite","source-layer":"landuse_overlay",minzoom:9,filter:["==",["get","class"],"national_park"],layout:{"line-cap":"round"},paint:{"line-color":"hsl(100, 62%, 74%)","line-width":["interpolate",["exponential",1.4],["zoom"],9,1,14,8],"line-offset":["interpolate",["exponential",1.4],["zoom"],9,0,14,-2.5],"line-opacity":["interpolate",["linear"],["zoom"],9,0,10,.75],"line-blur":3}},{id:"landuse",type:"fill",source:"composite","source-layer":"landuse",minzoom:5,filter:["match",["get","class"],["park","airport","cemetery","glacier","hospital","pitch","sand","school","agriculture","wood","grass","scrub"],!0,!1],layout:{},paint:{"fill-color":["interpolate",["linear"],["zoom"],15,["match",["get","class"],"park",["match",["get","type"],["garden","playground","zoo"],"hsl(100, 59%, 81%)","hsl(100, 58%, 76%)"],"airport","hsl(230, 15%, 86%)","cemetery","hsl(75, 37%, 81%)","glacier","hsl(196, 72%, 93%)","hospital","hsl(340, 37%, 87%)","pitch","hsl(100, 57%, 72%)","sand","hsl(60, 46%, 87%)","school","hsl(50, 47%, 81%)","agriculture","hsl(75, 37%, 81%)",["wood","grass","scrub"],"hsl(75, 41%, 74%)","hsla(0, 0%, 0%, 0)"],16,["match",["get","class"],"park",["match",["get","type"],["garden","playground","zoo"],"hsl(100, 59%, 81%)","hsl(100, 58%, 76%)"],"airport","hsl(230, 29%, 89%)","cemetery","hsl(75, 37%, 81%)","glacier","hsl(196, 72%, 93%)","hospital","hsl(340, 63%, 89%)","pitch","hsl(100, 57%, 72%)","sand","hsl(60, 46%, 87%)","school","hsl(50, 63%, 84%)","agriculture","hsl(75, 37%, 81%)",["wood","grass","scrub"],"hsl(75, 41%, 74%)","hsla(0, 0%, 0%, 0)"]],"fill-opacity":["interpolate",["linear"],["zoom"],5,0,6,["match",["get","class"],["agriculture","wood","grass","scrub"],0,"glacier",.5,1],15,["match",["get","class"],"agriculture",.75,["wood","glacier"],.5,"grass",.4,"scrub",.2,1]]}},{id:"pitch-outline",type:"line",source:"composite","source-layer":"landuse",minzoom:15,filter:["==",["get","class"],"pitch"],layout:{},paint:{"line-color":"hsl(75, 57%, 84%)"}},{id:"waterway-shadow",type:"line",source:"composite","source-layer":"waterway",minzoom:8,layout:{"line-cap":["step",["zoom"],"butt",11,"round"],"line-join":"round"},paint:{"line-color":"hsl(215, 84%, 69%)","line-width":["interpolate",["exponential",1.3],["zoom"],9,["match",["get","class"],["canal","river"],.1,0],20,["match",["get","class"],["canal","river"],8,3]],"line-translate":["interpolate",["exponential",1.2],["zoom"],7,["literal",[0,0]],16,["literal",[-1,-1]]],"line-translate-anchor":"viewport","line-opacity":["interpolate",["linear"],["zoom"],8,0,8.5,1]}},{id:"water-shadow",type:"fill",source:"composite","source-layer":"water",layout:{},paint:{"fill-color":"hsl(215, 84%, 69%)","fill-translate":["interpolate",["exponential",1.2],["zoom"],7,["literal",[0,0]],16,["literal",[-1,-1]]],"fill-translate-anchor":"viewport"}},{id:"waterway",type:"line",source:"composite","source-layer":"waterway",minzoom:8,layout:{"line-cap":["step",["zoom"],"butt",11,"round"],"line-join":"round"},paint:{"line-color":"hsl(205, 87%, 76%)","line-width":["interpolate",["exponential",1.3],["zoom"],9,["match",["get","class"],["canal","river"],.1,0],20,["match",["get","class"],["canal","river"],8,3]],"line-opacity":["interpolate",["linear"],["zoom"],8,0,8.5,1]}},{id:"water",type:"fill",source:"composite","source-layer":"water",layout:{},paint:{"fill-color":"hsl(196, 80%, 70%)"}},{id:"wetland",type:"fill",source:"composite","source-layer":"landuse_overlay",minzoom:5,filter:["match",["get","class"],["wetland","wetland_noveg"],!0,!1],paint:{"fill-color":"hsl(185, 43%, 74%)","fill-opacity":["interpolate",["linear"],["zoom"],10,.25,10.5,.15]}},{id:"wetland-pattern",type:"fill",source:"composite","source-layer":"landuse_overlay",minzoom:5,filter:["match",["get","class"],["wetland","wetland_noveg"],!0,!1],paint:{"fill-color":"hsl(185, 43%, 74%)","fill-opacity":["interpolate",["linear"],["zoom"],10,0,10.5,1],"fill-pattern":"wetland","fill-translate-anchor":"viewport"}},{id:"hillshade",type:"fill",source:"composite","source-layer":"hillshade",maxzoom:16,layout:{},paint:{"fill-color":["match",["get","class"],"shadow","hsl(56, 59%, 22%)","hsl(0, 0%, 100%)"],"fill-opacity":["interpolate",["linear"],["zoom"],14,["match",["get","level"],[67,56],.08,[89,78],.07,.15],16,0],"fill-antialias":!1}},{id:"contour-line",type:"line",source:"composite","source-layer":"contour",minzoom:11,filter:["!=",["get","index"],-1],layout:{},paint:{"line-opacity":["interpolate",["linear"],["zoom"],11,["match",["get","index"],[1,2],.15,.25],12,["match",["get","index"],[1,2],.3,.5]],"line-color":"hsl(100, 100%, 20%)","line-width":["interpolate",["linear"],["zoom"],13,["match",["get","index"],[1,2],.5,.6],16,["match",["get","index"],[1,2],.8,1.2]],"line-offset":["interpolate",["linear"],["zoom"],13,["match",["get","index"],[1,2],1,.6],16,["match",["get","index"],[1,2],1.6,1.2]]}},{id:"land-structure-polygon",type:"fill",source:"composite","source-layer":"structure",minzoom:13,filter:["all",["==",["geometry-type"],"Polygon"],["==",["get","class"],"land"]],layout:{},paint:{"fill-color":"hsl(35, 12%, 89%)"}},{id:"land-structure-line",type:"line",source:"composite","source-layer":"structure",minzoom:13,filter:["all",["==",["geometry-type"],"LineString"],["==",["get","class"],"land"]],layout:{"line-cap":"round"},paint:{"line-width":["interpolate",["exponential",1.99],["zoom"],14,.75,20,40],"line-color":"hsl(35, 12%, 89%)"}},{id:"aeroway-polygon",type:"fill",source:"composite","source-layer":"aeroway",minzoom:11,filter:["all",["==",["geometry-type"],"Polygon"],["match",["get","type"],["runway","taxiway","helipad"],!0,!1]],layout:{},paint:{"fill-color":["interpolate",["linear"],["zoom"],15,"hsl(230, 23%, 82%)",16,"hsl(230, 37%, 84%)"],"fill-opacity":["interpolate",["linear"],["zoom"],11,0,11.5,1]}},{id:"aeroway-line",type:"line",source:"composite","source-layer":"aeroway",minzoom:9,filter:["==",["geometry-type"],"LineString"],layout:{},paint:{"line-color":["interpolate",["linear"],["zoom"],15,"hsl(230, 23%, 82%)",16,"hsl(230, 37%, 84%)"],"line-width":["interpolate",["exponential",1.5],["zoom"],9,["match",["get","type"],"runway",1,"taxiway",.5,.5],18,["match",["get","type"],"runway",80,"taxiway",20,20]]}},{id:"building-outline",type:"line",source:"composite","source-layer":"building",minzoom:15,filter:["all",["!=",["get","type"],"building:part"],["==",["get","underground"],"false"]],layout:{},paint:{"line-color":"hsl(35, 6%, 79%)","line-width":["interpolate",["exponential",1.5],["zoom"],15,.75,20,3],"line-opacity":["interpolate",["linear"],["zoom"],15,0,16,1]}},{id:"building",type:"fill",source:"composite","source-layer":"building",minzoom:15,filter:["all",["!=",["get","type"],"building:part"],["==",["get","underground"],"false"]],layout:{},paint:{"fill-color":["interpolate",["linear"],["zoom"],15,"hsl(35, 11%, 86%)",16,"hsl(35, 8%, 85%)"],"fill-opacity":["interpolate",["linear"],["zoom"],15,0,16,1],"fill-outline-color":"hsl(35, 6%, 79%)"}},{id:"tunnel-street-minor-low",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["step",["zoom"],["match",["get","class"],["street","street_limited","track","primary_link"],!0,!1],14,["match",["get","class"],["street","street_limited","track","primary_link","secondary_link","tertiary_link","service"],!0,!1]],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,["match",["get","class"],["street","street_limited","primary_link"],2,"track",1,.5],18,["match",["get","class"],["street","street_limited","primary_link"],18,12]],"line-color":"hsl(0, 0%, 100%)","line-opacity":["step",["zoom"],1,14,0]}},{id:"tunnel-street-minor-case",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["step",["zoom"],["match",["get","class"],["street","street_limited","track","primary_link"],!0,!1],14,["match",["get","class"],["street","street_limited","track","primary_link","secondary_link","tertiary_link","service"],!0,!1]],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.75,20,2],"line-color":["match",["get","class"],"track","hsl(50, 100%, 40%)","hsl(230, 19%, 75%)"],"line-gap-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,["match",["get","class"],["street","street_limited","primary_link"],2,"track",1,.5],18,["match",["get","class"],["street","street_limited","primary_link"],18,12]],"line-opacity":["step",["zoom"],["match",["get","class"],"track",1,0],14,1],"line-dasharray":[3,3]}},{id:"tunnel-primary-secondary-tertiary-case",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["match",["get","class"],["primary","secondary","tertiary"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],10,["match",["get","class"],"primary",1,["secondary","tertiary"],.75,.75],18,2],"line-color":"hsl(230, 19%, 75%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],5,["match",["get","class"],"primary",.75,["secondary","tertiary"],.1,.1],18,["match",["get","class"],"primary",32,["secondary","tertiary"],26,26]],"line-dasharray":[3,3]}},{id:"tunnel-major-link-case",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["match",["get","class"],["motorway_link","trunk_link"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.75,20,2],"line-color":"hsl(0, 0%, 100%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-dasharray":[3,3]}},{id:"tunnel-motorway-trunk-case",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["match",["get","class"],["motorway","trunk"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],10,1,18,2],"line-color":"hsl(0, 0%, 100%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32],"line-dasharray":[3,3]}},{id:"tunnel-construction",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:14,filter:["all",["==",["get","structure"],"tunnel"],["==",["get","class"],"construction"],["==",["geometry-type"],"LineString"]],layout:{},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,2,18,18],"line-color":"hsl(230, 24%, 87%)","line-dasharray":["step",["zoom"],["literal",[.4,.8]],15,["literal",[.3,.6]],16,["literal",[.2,.3]],17,["literal",[.2,.25]],18,["literal",[.15,.15]]]}},{id:"tunnel-path-smooth-rough",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:12,filter:["all",["==",["get","structure"],"tunnel"],["==",["get","class"],"path"],["step",["zoom"],["match",["get","type"],["bridleway","footway","path","hiking","mountain_bike","trail"],!0,!1],16,["match",["get","type"],["bridleway","footway","path","hiking","mountain_bike","trail","corridor","sidewalk","crossing"],!0,!1]],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],15,1,18,4],"line-color":"hsl(35, 26%, 95%)","line-dasharray":["step",["zoom"],["literal",[4,.4]],15,["literal",[3,.4]],16,["literal",[3,.35]]]}},{id:"tunnel-path-cycleway-piste",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:12,filter:["all",["==",["get","structure"],"tunnel"],["==",["get","class"],"path"],["match",["get","type"],["cycleway","piste"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],15,1,18,4],"line-color":"hsl(35, 26%, 95%)"}},{id:"tunnel-steps",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:14,filter:["all",["==",["get","structure"],"tunnel"],["==",["get","class"],"steps"],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],15,1,16,1.6,18,6],"line-color":"hsl(35, 26%, 95%)","line-dasharray":["step",["zoom"],["literal",[1,0]],15,["literal",[1.75,1]],16,["literal",[1,.75]],17,["literal",[.3,.3]]]}},{id:"tunnel-major-link",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["match",["get","class"],["motorway_link","trunk_link"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-color":["match",["get","class"],"motorway_link","hsl(26, 74%, 81%)","trunk_link","hsl(46, 77%, 78%)","hsl(46, 77%, 78%)"]}},{id:"tunnel-pedestrian",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["==",["get","class"],"pedestrian"],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,.5,18,12],"line-color":"hsl(0, 0%, 100%)","line-dasharray":["step",["zoom"],["literal",[1,0]],15,["literal",[1.5,.4]],16,["literal",[1,.2]]]}},{id:"tunnel-street-minor",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["step",["zoom"],["match",["get","class"],["street","street_limited","track","primary_link"],!0,!1],14,["match",["get","class"],["street","street_limited","track","primary_link","secondary_link","tertiary_link","service"],!0,!1]],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,["match",["get","class"],["street","street_limited","primary_link"],2,"track",1,.5],18,["match",["get","class"],["street","street_limited","primary_link"],18,12]],"line-color":["match",["get","class"],"street_limited","hsl(35, 14%, 93%)","hsl(0, 0%, 100%)"],"line-opacity":["step",["zoom"],["match",["get","class"],"track",1,0],14,1]}},{id:"tunnel-primary-secondary-tertiary",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["match",["get","class"],["primary","secondary","tertiary"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],5,["match",["get","class"],"primary",.75,["secondary","tertiary"],.1,.1],18,["match",["get","class"],"primary",32,["secondary","tertiary"],26,26]],"line-color":"hsl(0, 0%, 100%)"}},{id:"tunnel-oneway-arrow-blue",type:"symbol",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:15,filter:["all",["==",["get","structure"],"tunnel"],["==",["get","oneway"],"true"],["step",["zoom"],["match",["get","class"],["primary","secondary","street","street_limited","tertiary"],!0,!1],16,["match",["get","class"],["primary","secondary","tertiary","street","street_limited","primary_link","secondary_link","tertiary_link","path","pedestrian","service","track"],!0,!1]]],layout:{"symbol-placement":"line","icon-image":["step",["zoom"],"oneway-small",17,["match",["get","class"],["primary","secondary","tertiary","street","street_limited"],"oneway-large","oneway-small"],18,"oneway-large"],"symbol-spacing":200,"icon-rotation-alignment":"map"},paint:{}},{id:"tunnel-motorway-trunk",type:"line",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"tunnel"],["match",["get","class"],["motorway","trunk"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32],"line-color":["match",["get","class"],"motorway","hsl(26, 74%, 81%)","trunk","hsl(46, 77%, 78%)","hsl(46, 77%, 78%)"]}},{id:"tunnel-oneway-arrow-white",type:"symbol",metadata:{"mapbox:group":"1444855769305.6016"},source:"composite","source-layer":"road",minzoom:16,filter:["all",["==",["get","structure"],"tunnel"],["match",["get","class"],["motorway","motorway_link","trunk","trunk_link"],!0,!1],["==",["get","oneway"],"true"]],layout:{"symbol-placement":"line","icon-image":["step",["zoom"],"oneway-white-small",17,"oneway-white-large"],"symbol-spacing":200},paint:{}},{id:"cliff",type:"line",source:"composite","source-layer":"structure",minzoom:15,filter:["==",["get","class"],"cliff"],layout:{"line-cap":"round","line-join":"round"},paint:{"line-opacity":["interpolate",["linear"],["zoom"],15,0,15.25,1],"line-width":10,"line-pattern":"cliff"}},{id:"ferry",type:"line",source:"composite","source-layer":"road",minzoom:8,filter:["==",["get","type"],"ferry"],layout:{"line-join":"round"},paint:{"line-color":["interpolate",["linear"],["zoom"],15,"hsl(205, 73%, 63%)",17,"hsl(230, 73%, 63%)"],"line-width":["interpolate",["exponential",1.5],["zoom"],14,.5,20,1],"line-dasharray":["step",["zoom"],["literal",[1,0]],13,["literal",[12,4]]]}},{id:"ferry-auto",type:"line",source:"composite","source-layer":"road",filter:["==",["get","type"],"ferry_auto"],layout:{"line-join":"round"},paint:{"line-color":["interpolate",["linear"],["zoom"],15,"hsl(205, 73%, 63%)",17,"hsl(230, 73%, 63%)"],"line-width":["interpolate",["exponential",1.5],["zoom"],14,.5,20,1]}},{id:"road-path-bg",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:12,filter:["all",["==",["get","class"],"path"],["step",["zoom"],["!",["match",["get","type"],["steps","sidewalk","crossing"],!0,!1]],16,["!=",["get","type"],"steps"]],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],15,2.5,18,7],"line-color":["match",["get","type"],"piste","hsl(230, 85%, 67%)",["corridor","crossing","sidewalk"],"hsl(230, 17%, 82%)","hsl(50, 100%, 40%)"],"line-opacity":1}},{id:"road-steps-bg",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:14,filter:["all",["==",["get","type"],"steps"],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],15,2.5,18,7],"line-color":"hsl(50, 100%, 40%)","line-opacity":.75}},{id:"road-pedestrian-case",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:12,filter:["all",["==",["get","class"],"pedestrian"],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,2,18,14.5],"line-color":"hsl(230, 24%, 87%)","line-opacity":["step",["zoom"],0,14,1]}},{id:"road-street-low",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:11,filter:["all",["match",["get","class"],["street","street_limited","primary_link"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-color":"hsl(0, 0%, 100%)","line-opacity":["step",["zoom"],1,14,0]}},{id:"road-minor-case",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["step",["zoom"],["==",["get","class"],"track"],14,["match",["get","class"],["track","secondary_link","tertiary_link","service"],!0,!1]],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.75,20,2],"line-color":["match",["get","class"],"track","hsl(50, 100%, 40%)","hsl(230, 24%, 87%)"],"line-gap-width":["interpolate",["exponential",1.5],["zoom"],14,["match",["get","class"],"track",1,.5],18,12],"line-opacity":1}},{id:"road-street-case",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:11,filter:["all",["match",["get","class"],["street","street_limited","primary_link"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.75,20,2],"line-color":"hsl(230, 24%, 87%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-opacity":["step",["zoom"],0,14,1]}},{id:"road-secondary-tertiary-case",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",filter:["all",["match",["get","class"],["secondary","tertiary"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],10,.75,18,2],"line-color":"hsl(230, 24%, 87%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],5,.1,18,26],"line-opacity":["step",["zoom"],0,10,1]}},{id:"road-primary-case",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",filter:["all",["==",["get","class"],"primary"],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],10,1,18,2],"line-color":"hsl(230, 24%, 87%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32],"line-opacity":["step",["zoom"],0,10,1]}},{id:"road-major-link-case",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:10,filter:["all",["match",["get","class"],["motorway_link","trunk_link"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.75,20,2],"line-color":"hsl(0, 0%, 100%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-opacity":["step",["zoom"],0,11,1]}},{id:"road-motorway-trunk-case",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",filter:["all",["match",["get","class"],["motorway","trunk"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],10,1,18,2],"line-color":"hsl(0, 0%, 100%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32],"line-opacity":["step",["zoom"],["match",["get","class"],"motorway",1,0],6,1]}},{id:"road-construction",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:14,filter:["all",["==",["get","class"],"construction"],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,2,18,18],"line-color":"hsl(230, 24%, 87%)","line-dasharray":["step",["zoom"],["literal",[.4,.8]],15,["literal",[.3,.6]],16,["literal",[.2,.3]],17,["literal",[.2,.25]],18,["literal",[.15,.15]]]}},{id:"road-path-smooth",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:12,filter:["all",["==",["get","class"],"path"],["step",["zoom"],["match",["get","type"],["bridleway","footway","path"],!0,!1],16,["match",["get","type"],["bridleway","footway","path","corridor","sidewalk","crossing"],!0,!1]],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],15,1,18,4],"line-color":"hsl(0, 0%, 100%)","line-dasharray":["step",["zoom"],["literal",[4,.4]],15,["literal",[3,.4]],16,["literal",[3,.35]]]}},{id:"road-path-rough",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:12,filter:["all",["==",["get","class"],"path"],["match",["get","type"],["hiking","mountain_bike","trail"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],15,1,18,4],"line-color":"hsl(0, 0%, 100%)","line-dasharray":["step",["zoom"],["literal",[4,.4]],15,["literal",[1.75,.4]],16,["literal",[1,.4]],17,["literal",[1,.35]]]}},{id:"road-path-cycleway-piste",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:12,filter:["all",["==",["get","class"],"path"],["match",["get","type"],["cycleway","piste"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],15,1,18,4],"line-color":"hsl(0, 0%, 100%)"}},{id:"road-steps",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:14,filter:["all",["==",["get","type"],"steps"],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],15,1,16,1.6,18,6],"line-color":"hsl(0, 0%, 100%)","line-dasharray":["step",["zoom"],["literal",[1,0]],15,["literal",[1.75,1]],16,["literal",[1,.75]],17,["literal",[.3,.3]]]}},{id:"road-major-link",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:10,filter:["all",["match",["get","class"],["motorway_link","trunk_link"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-color":["match",["get","class"],"motorway_link","hsl(26, 67%, 70%)","trunk_link","hsl(46, 69%, 68%)","hsl(46, 69%, 68%)"]}},{id:"road-pedestrian",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:12,filter:["all",["==",["get","class"],"pedestrian"],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,.5,18,12],"line-color":"hsl(0, 0%, 100%)","line-dasharray":["step",["zoom"],["literal",[1,0]],15,["literal",[1.5,.4]],16,["literal",[1,.2]]]}},{id:"road-pedestrian-polygon-fill",type:"fill",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:12,filter:["all",["==",["geometry-type"],"Polygon"],["match",["get","class"],["path","pedestrian"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1]],layout:{},paint:{"fill-color":["interpolate",["linear"],["zoom"],16,"hsl(230, 16%, 94%)",16.25,"hsl(230, 50%, 98%)"],"fill-outline-color":"hsl(230, 26%, 88%)"}},{id:"road-pedestrian-polygon-pattern",type:"fill",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:12,filter:["all",["==",["geometry-type"],"Polygon"],["match",["get","class"],["path","pedestrian"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1]],layout:{},paint:{"fill-color":"hsl(0, 0%, 100%)","fill-outline-color":"hsl(35, 10%, 83%)","fill-pattern":"pedestrian-polygon","fill-opacity":["interpolate",["linear"],["zoom"],16,0,16.25,1]}},{id:"road-polygon",type:"fill",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:12,filter:["all",["==",["geometry-type"],"Polygon"],["match",["get","class"],["primary","secondary","tertiary","primary_link","secondary_link","tertiary_link","street","street_limited","track","service"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1]],layout:{},paint:{"fill-color":"hsl(0, 0%, 100%)","fill-outline-color":"#d6d9e6"}},{id:"road-minor",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["step",["zoom"],["==",["get","class"],"track"],14,["match",["get","class"],["track","secondary_link","tertiary_link","service"],!0,!1]],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,["match",["get","class"],"track",1,.5],18,12],"line-color":"hsl(0, 0%, 100%)","line-opacity":1}},{id:"road-street",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:11,filter:["all",["match",["get","class"],["street","street_limited","primary_link"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-color":["match",["get","class"],"street_limited","hsl(35, 14%, 93%)","hsl(0, 0%, 100%)"],"line-opacity":["step",["zoom"],0,14,1]}},{id:"road-secondary-tertiary",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",filter:["all",["match",["get","class"],["secondary","tertiary"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],5,.1,18,26],"line-color":"hsl(0, 0%, 100%)"}},{id:"road-primary",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",filter:["all",["==",["get","class"],"primary"],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32],"line-color":"hsl(0, 0%, 100%)"}},{id:"road-oneway-arrow-blue",type:"symbol",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:15,filter:["all",["==",["get","oneway"],"true"],["step",["zoom"],["match",["get","class"],["primary","secondary","tertiary","street","street_limited"],!0,!1],16,["match",["get","class"],["primary","secondary","tertiary","street","street_limited","primary_link","secondary_link","tertiary_link","path","pedestrian","service","track"],!0,!1]],["match",["get","structure"],["none","ford"],!0,!1]],layout:{"symbol-placement":"line","icon-image":["step",["zoom"],"oneway-small",17,["match",["get","class"],["primary","secondary","tertiary","street","street_limited"],"oneway-large","oneway-small"],18,"oneway-large"],"symbol-spacing":200,"icon-rotation-alignment":"map"},paint:{}},{id:"road-motorway-trunk",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",filter:["all",["match",["get","class"],["motorway","trunk"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32],"line-color":["step",["zoom"],["match",["get","class"],"motorway","hsl(26, 87%, 62%)","trunk","hsl(0, 0%, 100%)","hsl(0, 0%, 100%)"],6,["match",["get","class"],"motorway","hsl(26, 87%, 62%)","trunk","hsl(46, 80%, 60%)","hsl(46, 80%, 60%)"],9,["match",["get","class"],"motorway","hsl(26, 67%, 70%)","trunk","hsl(46, 69%, 68%)","hsl(46, 69%, 68%)"]]}},{id:"road-rail",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["match",["get","class"],["major_rail","minor_rail"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1]],layout:{"line-join":"round"},paint:{"line-color":["interpolate",["linear"],["zoom"],13,"hsl(50, 17%, 82%)",16,"hsl(230, 10%, 74%)"],"line-width":["interpolate",["exponential",1.5],["zoom"],14,.5,20,1]}},{id:"road-rail-tracks",type:"line",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["match",["get","class"],["major_rail","minor_rail"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1]],layout:{"line-join":"round"},paint:{"line-color":["interpolate",["linear"],["zoom"],13,"hsl(50, 17%, 82%)",16,"hsl(230, 10%, 74%)"],"line-width":["interpolate",["exponential",1.5],["zoom"],14,4,20,8],"line-dasharray":[.1,15],"line-opacity":["interpolate",["linear"],["zoom"],13.75,0,14,1]}},{id:"level-crossing",type:"symbol",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:16,filter:["==",["get","class"],"level_crossing"],layout:{"icon-image":"level-crossing","icon-allow-overlap":!0},paint:{}},{id:"road-oneway-arrow-white",type:"symbol",metadata:{"mapbox:group":"1444855786460.0557"},source:"composite","source-layer":"road",minzoom:16,filter:["all",["==",["get","oneway"],"true"],["match",["get","class"],["motorway","trunk","motorway_link","trunk_link"],!0,!1],["match",["get","structure"],["none","ford"],!0,!1]],layout:{"symbol-placement":"line","icon-image":["step",["zoom"],"oneway-white-small",17,"oneway-white-large"],"symbol-spacing":200},paint:{}},{id:"golf-hole-line",type:"line",source:"composite","source-layer":"road",minzoom:16,filter:["==",["get","class"],"golf"],layout:{},paint:{"line-color":"hsl(100, 47%, 58%)"}},{id:"gate-fence-hedge",type:"line",source:"composite","source-layer":"structure",minzoom:16,filter:["match",["get","class"],["gate","fence","hedge"],!0,!1],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["match",["get","class"],"hedge","hsl(100, 59%, 70%)","hsl(46, 17%, 76%)"],"line-width":{base:1,stops:[[16,1],[20,3]]},"line-opacity":["match",["get","class"],"gate",.5,1],"line-dasharray":[1,2,5,2,1,2]}},{id:"bridge-path-bg",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["==",["get","class"],"path"],["!=",["get","type"],"steps"],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],15,2.5,18,7],"line-color":["match",["get","type"],"piste","hsl(230, 85%, 67%)",["corridor","crossing","sidewalk"],"hsl(230, 17%, 82%)","hsl(50, 100%, 40%)"],"line-opacity":["step",["zoom"],0,14,1]}},{id:"bridge-steps-bg",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:14,filter:["all",["==",["get","type"],"steps"],["==",["get","structure"],"bridge"],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],15,2.5,18,7],"line-color":"hsl(50, 100%, 40%)","line-opacity":.75}},{id:"bridge-pedestrian-case",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["==",["get","class"],"pedestrian"],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,2,18,14.5],"line-color":"hsl(230, 24%, 87%)","line-opacity":["step",["zoom"],0,14,1]}},{id:"bridge-street-minor-low",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["step",["zoom"],["match",["get","class"],["street","street_limited","track","primary_link"],!0,!1],14,["match",["get","class"],["street","street_limited","track","primary_link","secondary_link","tertiary_link","service"],!0,!1]],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,["match",["get","class"],["street","street_limited","primary_link"],2,"track",1,.5],18,["match",["get","class"],["street","street_limited","primary_link"],18,12]],"line-color":"hsl(0, 0%, 100%)","line-opacity":["step",["zoom"],1,14,0]}},{id:"bridge-street-minor-case",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["step",["zoom"],["match",["get","class"],["street","street_limited","track","primary_link"],!0,!1],14,["match",["get","class"],["street","street_limited","track","primary_link","secondary_link","tertiary_link","service"],!0,!1]],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.75,20,2],"line-color":["match",["get","class"],"track","hsl(50, 100%, 40%)","hsl(230, 24%, 87%)"],"line-gap-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,["match",["get","class"],["street","street_limited","primary_link"],2,"track",1,.5],18,["match",["get","class"],["street","street_limited","primary_link"],18,12]],"line-opacity":["step",["zoom"],["match",["get","class"],"track",1,0],14,1]}},{id:"bridge-primary-secondary-tertiary-case",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["match",["get","class"],["primary","secondary","tertiary"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],10,["match",["get","class"],"primary",1,["secondary","tertiary"],.75,.75],18,2],"line-color":"hsl(230, 24%, 87%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],5,["match",["get","class"],"primary",.75,["secondary","tertiary"],.1,.1],18,["match",["get","class"],"primary",32,["secondary","tertiary"],26,26]],"line-opacity":["step",["zoom"],0,10,1]}},{id:"bridge-major-link-case",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["match",["get","class"],["motorway_link","trunk_link"],!0,!1],["<=",["get","layer"],1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.75,20,2],"line-color":"hsl(0, 0%, 100%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18]}},{id:"bridge-motorway-trunk-case",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["match",["get","class"],["motorway","trunk"],!0,!1],["<=",["get","layer"],1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],10,1,18,2],"line-color":"hsl(0, 0%, 100%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32]}},{id:"bridge-construction",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:14,filter:["all",["==",["get","structure"],"bridge"],["==",["get","class"],"construction"],["==",["geometry-type"],"LineString"]],layout:{},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,2,18,18],"line-color":"hsl(230, 24%, 87%)","line-dasharray":["step",["zoom"],["literal",[.4,.8]],15,["literal",[.3,.6]],16,["literal",[.2,.3]],17,["literal",[.2,.25]],18,["literal",[.15,.15]]]}},{id:"bridge-path-smooth-rough",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:12,filter:["all",["==",["get","structure"],"bridge"],["==",["get","class"],"path"],["step",["zoom"],["match",["get","type"],["bridleway","footway","path","hiking","mountain_bike","trail"],!0,!1],16,["match",["get","type"],["bridleway","footway","path","hiking","mountain_bike","trail","corridor","sidewalk","crossing"],!0,!1]],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],15,1,18,4],"line-color":"hsl(0, 0%, 100%)","line-dasharray":["step",["zoom"],["literal",[4,.4]],15,["literal",[3,.4]],16,["literal",[3,.35]]]}},{id:"bridge-path-cycleway-piste",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:12,filter:["all",["==",["get","structure"],"bridge"],["==",["get","class"],"path"],["match",["get","type"],["cycleway","piste"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],15,1,18,4],"line-color":"hsl(0, 0%, 100%)"}},{id:"bridge-steps",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:14,filter:["all",["==",["get","type"],"steps"],["==",["get","structure"],"bridge"],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],15,1,16,1.6,18,6],"line-color":"hsl(0, 0%, 100%)","line-dasharray":["step",["zoom"],["literal",[1,0]],15,["literal",[1.75,1]],16,["literal",[1,.75]],17,["literal",[.3,.3]]]}},{id:"bridge-major-link",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["match",["get","class"],["motorway_link","trunk_link"],!0,!1],["<=",["get","layer"],1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-color":["match",["get","class"],"motorway_link","hsl(26, 67%, 70%)","trunk_link","hsl(46, 69%, 68%)","hsl(46, 69%, 68%)"]}},{id:"bridge-pedestrian",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["==",["get","class"],"pedestrian"],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],14,.5,18,12],"line-color":"hsl(0, 0%, 100%)","line-dasharray":["step",["zoom"],["literal",[1,0]],15,["literal",[1.5,.4]],16,["literal",[1,.2]]]}},{id:"bridge-street-minor",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["step",["zoom"],["match",["get","class"],["street","street_limited","track","primary_link"],!0,!1],14,["match",["get","class"],["street","street_limited","track","primary_link","secondary_link","tertiary_link","service"],!0,!1]],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,["match",["get","class"],["street","street_limited","primary_link"],2,"track",1,.5],18,["match",["get","class"],["street","street_limited","primary_link"],18,12]],"line-color":["match",["get","class"],"street_limited","hsl(35, 14%, 93%)","hsl(0, 0%, 100%)"],"line-opacity":["step",["zoom"],0,14,1]}},{id:"bridge-primary-secondary-tertiary",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["match",["get","class"],["primary","secondary","tertiary"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],5,["match",["get","class"],"primary",.75,["secondary","tertiary"],.1,.1],18,["match",["get","class"],"primary",32,["secondary","tertiary"],26,26]],"line-color":"hsl(0, 0%, 100%)"}},{id:"bridge-oneway-arrow-blue",type:"symbol",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:15,filter:["all",["==",["get","structure"],"bridge"],["==",["get","oneway"],"true"],["step",["zoom"],["match",["get","class"],["primary","secondary","tertiary","street","street_limited"],!0,!1],16,["match",["get","class"],["primary","secondary","tertiary","street","street_limited","primary_link","secondary_link","tertiary_link","path","pedestrian","track","service"],!0,!1]]],layout:{"symbol-placement":"line","icon-image":["step",["zoom"],"oneway-small",17,["match",["get","class"],["primary","secondary","tertiary","street","street_limited"],"oneway-large","oneway-small"],18,"oneway-large"],"symbol-spacing":200,"icon-rotation-alignment":"map"},paint:{}},{id:"bridge-motorway-trunk",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["match",["get","class"],["motorway","trunk"],!0,!1],["<=",["get","layer"],1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32],"line-color":["match",["get","class"],"motorway","hsl(26, 67%, 70%)","trunk","hsl(46, 69%, 68%)","hsl(46, 69%, 68%)"]}},{id:"bridge-rail",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["match",["get","class"],["major_rail","minor_rail"],!0,!1]],layout:{"line-join":"round"},paint:{"line-color":["interpolate",["linear"],["zoom"],13,"hsl(50, 17%, 82%)",16,"hsl(230, 10%, 74%)"],"line-width":["interpolate",["exponential",1.5],["zoom"],14,.5,20,1]}},{id:"bridge-rail-tracks",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],["match",["get","class"],["major_rail","minor_rail"],!0,!1]],layout:{"line-join":"round"},paint:{"line-color":["interpolate",["linear"],["zoom"],13,"hsl(50, 17%, 82%)",16,"hsl(230, 10%, 74%)"],"line-width":["interpolate",["exponential",1.5],["zoom"],14,4,20,8],"line-dasharray":[.1,15],"line-opacity":["interpolate",["linear"],["zoom"],13.75,0,14,1]}},{id:"bridge-major-link-2-case",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],[">=",["get","layer"],2],["match",["get","class"],["motorway_link","trunk_link"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.75,20,2],"line-color":"hsl(0, 0%, 100%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18]}},{id:"bridge-motorway-trunk-2-case",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],[">=",["get","layer"],2],["match",["get","class"],["motorway","trunk"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],10,1,18,2],"line-color":"hsl(0, 0%, 100%)","line-gap-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32]}},{id:"bridge-major-link-2",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],[">=",["get","layer"],2],["match",["get","class"],["motorway_link","trunk_link"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],12,.5,14,2,18,18],"line-color":["match",["get","class"],"motorway_link","hsl(26, 67%, 70%)","trunk_link","hsl(46, 69%, 68%)","hsl(46, 69%, 68%)"]}},{id:"bridge-motorway-trunk-2",type:"line",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:13,filter:["all",["==",["get","structure"],"bridge"],[">=",["get","layer"],2],["match",["get","class"],["motorway","trunk"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32],"line-color":["match",["get","class"],"motorway","hsl(26, 67%, 70%)","trunk","hsl(46, 69%, 68%)","hsl(46, 69%, 68%)"]}},{id:"bridge-oneway-arrow-white",type:"symbol",metadata:{"mapbox:group":"1444855799204.86"},source:"composite","source-layer":"road",minzoom:16,filter:["all",["==",["get","structure"],"bridge"],["match",["get","class"],["motorway","trunk","motorway_link","trunk_link"],!0,!1],["==",["get","oneway"],"true"]],layout:{"symbol-placement":"line","icon-image":["step",["zoom"],"oneway-white-small",17,"oneway-white-large"],"symbol-spacing":200},paint:{}},{id:"aerialway-bg",type:"line",source:"composite","source-layer":"road",minzoom:12,filter:["==",["get","class"],"aerialway"],layout:{"line-join":"round"},paint:{"line-color":"hsl(0, 0%, 100%)","line-width":["interpolate",["exponential",1.5],["zoom"],14,2.5,20,3],"line-blur":.5}},{id:"aerialway",type:"line",source:"composite","source-layer":"road",minzoom:12,filter:["==",["get","class"],"aerialway"],layout:{"line-join":"round"},paint:{"line-color":"hsl(230, 4%, 29%)","line-width":["interpolate",["exponential",1.5],["zoom"],14,.5,20,1]}},{id:"admin-1-boundary-bg",type:"line",metadata:{"mapbox:group":"1444934295202.7542"},source:"composite","source-layer":"admin",filter:["all",["==",["get","admin_level"],1],["==",["get","maritime"],"false"],["match",["get","worldview"],["all","US"],!0,!1]],layout:{"line-join":"bevel"},paint:{"line-color":["interpolate",["linear"],["zoom"],8,"hsl(35, 12%, 89%)",16,"hsl(230, 49%, 90%)"],"line-width":["interpolate",["linear"],["zoom"],7,3.75,12,5.5],"line-opacity":["interpolate",["linear"],["zoom"],7,0,8,.75],"line-dasharray":[1,0],"line-translate":[0,0],"line-blur":["interpolate",["linear"],["zoom"],3,0,8,3]}},{id:"admin-0-boundary-bg",type:"line",metadata:{"mapbox:group":"1444934295202.7542"},source:"composite","source-layer":"admin",minzoom:1,filter:["all",["==",["get","admin_level"],0],["==",["get","maritime"],"false"],["match",["get","worldview"],["all","US"],!0,!1]],layout:{},paint:{"line-width":["interpolate",["linear"],["zoom"],3,3.5,10,8],"line-color":["interpolate",["linear"],["zoom"],6,"hsl(35, 12%, 89%)",8,"hsl(230, 49%, 90%)"],"line-opacity":["interpolate",["linear"],["zoom"],3,0,4,.5],"line-translate":[0,0],"line-blur":["interpolate",["linear"],["zoom"],3,0,10,2]}},{id:"admin-1-boundary",type:"line",metadata:{"mapbox:group":"1444934295202.7542"},source:"composite","source-layer":"admin",filter:["all",["==",["get","admin_level"],1],["==",["get","maritime"],"false"],["match",["get","worldview"],["all","US"],!0,!1]],layout:{"line-join":"round","line-cap":"round"},paint:{"line-dasharray":["step",["zoom"],["literal",[2,0]],7,["literal",[2,2,6,2]]],"line-width":["interpolate",["linear"],["zoom"],7,.75,12,1.5],"line-opacity":["interpolate",["linear"],["zoom"],2,0,3,1],"line-color":["interpolate",["linear"],["zoom"],3,"hsl(230, 14%, 77%)",7,"hsl(230, 8%, 62%)"]}},{id:"admin-0-boundary",type:"line",metadata:{"mapbox:group":"1444934295202.7542"},source:"composite","source-layer":"admin",minzoom:1,filter:["all",["==",["get","admin_level"],0],["==",["get","disputed"],"false"],["==",["get","maritime"],"false"],["match",["get","worldview"],["all","US"],!0,!1]],layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"hsl(230, 8%, 51%)","line-width":["interpolate",["linear"],["zoom"],3,.5,10,2]}},{id:"admin-0-boundary-disputed",type:"line",metadata:{"mapbox:group":"1444934295202.7542"},source:"composite","source-layer":"admin",minzoom:1,filter:["all",["==",["get","disputed"],"true"],["==",["get","admin_level"],0],["==",["get","maritime"],"false"],["match",["get","worldview"],["all","US"],!0,!1]],layout:{"line-join":"round"},paint:{"line-dasharray":[1.5,1.5],"line-color":"hsl(230, 8%, 51%)","line-width":["interpolate",["linear"],["zoom"],3,.5,10,2]}},{id:"contour-label",type:"symbol",source:"composite","source-layer":"contour",minzoom:11,filter:["any",["==",["get","index"],10],["==",["get","index"],5]],layout:{"text-field":"{ele} m","symbol-placement":"line","text-pitch-alignment":"viewport","text-max-angle":25,"text-padding":5,"text-font":["DIN Offc Pro Medium","Arial Unicode MS Regular"],"text-size":["interpolate",["linear"],["zoom"],15,9.5,20,12]},paint:{"text-color":"hsl(100, 60%, 28%)","text-halo-width":1,"text-halo-color":"hsla(0, 0%, 100%, 0.5)"}},{id:"building-number-label",type:"symbol",source:"composite","source-layer":"housenum_label",minzoom:17,layout:{"text-field":["get","house_num"],"text-font":["DIN Offc Pro Italic","Arial Unicode MS Regular"],"text-padding":4,"text-max-width":7,"text-size":9.5},paint:{"text-color":"hsl(35, 2%, 69%)","text-halo-color":"hsl(35, 8%, 85%)","text-halo-width":.5}},{id:"road-label",type:"symbol",source:"composite","source-layer":"road",minzoom:10,filter:["step",["zoom"],["match",["get","class"],["motorway","trunk","primary","secondary","tertiary"],!0,!1],12,["match",["get","class"],["motorway","trunk","primary","secondary","tertiary","pedestrian","street","street_limited","track","path","aerialway"],!0,!1],15,["match",["get","class"],"golf",!1,!0]],layout:{"text-size":["interpolate",["linear"],["zoom"],10,["match",["get","class"],["motorway","trunk","primary","secondary","tertiary"],10,["motorway_link","trunk_link","primary_link","secondary_link","tertiary_link","pedestrian","street","street_limited","track","path","aerialway"],9,6.5],18,["match",["get","class"],["motorway","trunk","primary","secondary","tertiary"],16,["motorway_link","trunk_link","primary_link","secondary_link","tertiary_link","pedestrian","street","street_limited","path"],14,13]],"text-max-angle":30,"text-font":["DIN Offc Pro Regular","Arial Unicode MS Regular"],"symbol-placement":"line","text-padding":1,"text-rotation-alignment":"map","text-pitch-alignment":"viewport","text-field":["coalesce",["get","name_en"],["get","name"]],"text-letter-spacing":.01},paint:{"text-color":["match",["get","class"],"ferry","hsl(230, 48%, 44%)","hsl(0, 0%, 0%)"],"text-halo-color":["match",["get","class"],["motorway","trunk"],"hsla(0, 0%, 100%, 0.75)","ferry","hsl(196, 80%, 70%)","hsl(0, 0%, 100%)"],"text-halo-width":1,"text-halo-blur":1}},{id:"road-number-shield",type:"symbol",source:"composite","source-layer":"road",minzoom:6,filter:["all",["has","reflen"],["<=",["get","reflen"],6],["step",["zoom"],["==",["geometry-type"],"Point"],11,[">",["get","len"],5e3],12,[">",["get","len"],2500],13,[">",["get","len"],1e3],14,!0]],layout:{"text-size":9,"icon-image":["concat",["get","shield"],"-",["to-string",["get","reflen"]]],"icon-rotation-alignment":"viewport","text-max-angle":38,"symbol-spacing":["interpolate",["linear"],["zoom"],11,150,14,200],"text-font":["DIN Offc Pro Bold","Arial Unicode MS Bold"],"symbol-placement":["step",["zoom"],"point",11,"line"],"text-rotation-alignment":"viewport","text-field":["get","ref"],"text-letter-spacing":.05},paint:{"text-color":["match",["get","shield_text_color"],"white","hsl(0, 0%, 100%)","black","hsl(230, 21%, 37%)","yellow","hsl(50, 81%, 74%)","orange","hsl(25, 73%, 63%)","blue","hsl(230, 40%, 58%)","hsl(0, 0%, 100%)"]}},{id:"road-exit-shield",type:"symbol",source:"composite","source-layer":"motorway_junction",minzoom:14,filter:["all",["has","reflen"],["<=",["get","reflen"],9]],layout:{"text-field":["get","ref"],"text-size":9,"icon-image":["concat","motorway-exit-",["to-string",["get","reflen"]]],"text-font":["DIN Offc Pro Bold","Arial Unicode MS Bold"]},paint:{"text-color":"hsl(0, 0%, 100%)","text-translate":[0,0]}},{id:"golf-hole-label",type:"symbol",source:"composite","source-layer":"road",minzoom:16,filter:["==",["get","class"],"golf"],layout:{"text-field":["coalesce",["get","name_en"],["get","name"]],"text-font":["DIN Offc Pro Medium","Arial Unicode MS Regular"],"text-size":12},paint:{"text-halo-color":"hsl(0, 0%, 100%)","text-halo-width":.5,"text-halo-blur":.5,"text-color":"hsl(100, 100%, 20%)"}},{id:"waterway-label",type:"symbol",source:"composite","source-layer":"natural_label",minzoom:13,filter:["all",["match",["get","class"],["canal","river","stream"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"text-font":["DIN Offc Pro Italic","Arial Unicode MS Regular"],"text-max-angle":30,"symbol-spacing":["interpolate",["linear",1],["zoom"],15,250,17,400],"text-size":["interpolate",["linear"],["zoom"],13,12,18,16],"symbol-placement":"line","text-pitch-alignment":"viewport","text-field":["coalesce",["get","name_en"],["get","name"]]},paint:{"text-color":"hsl(230, 48%, 44%)"}},{id:"natural-line-label",type:"symbol",source:"composite","source-layer":"natural_label",minzoom:4,filter:["all",["match",["get","class"],["glacier","landform"],!0,!1],["==",["geometry-type"],"LineString"],["<=",["get","filterrank"],4]],layout:{"text-size":["step",["zoom"],["step",["get","sizerank"],18,5,12],17,["step",["get","sizerank"],18,13,12]],"text-max-angle":30,"text-field":["coalesce",["get","name_en"],["get","name"]],"text-font":["DIN Offc Pro Medium","Arial Unicode MS Regular"],"symbol-placement":"line-center","text-pitch-alignment":"viewport"},paint:{"text-halo-width":.5,"text-halo-color":"hsl(0, 0%, 100%)","text-halo-blur":.5,"text-color":["step",["zoom"],["step",["get","sizerank"],"hsl(26, 20%, 42%)",5,"hsl(26, 25%, 32%)"],17,["step",["get","sizerank"],"hsl(26, 20%, 42%)",13,"hsl(26, 25%, 32%)"]]}},{id:"natural-point-label",type:"symbol",source:"composite","source-layer":"natural_label",minzoom:4,filter:["all",["match",["get","class"],["dock","glacier","landform","water_feature","wetland"],!0,!1],["==",["geometry-type"],"Point"],["<=",["get","filterrank"],4]],layout:{"text-size":["step",["zoom"],["step",["get","sizerank"],18,5,12],17,["step",["get","sizerank"],18,13,12]],"icon-image":["step",["zoom"],["concat",["get","maki"],"-11"],15,["concat",["get","maki"],"-15"]],"text-font":["DIN Offc Pro Medium","Arial Unicode MS Regular"],"text-offset":["step",["zoom"],["step",["get","sizerank"],["literal",[0,0]],5,["literal",[0,.75]]],17,["step",["get","sizerank"],["literal",[0,0]],13,["literal",[0,.75]]]],"text-anchor":["step",["zoom"],["step",["get","sizerank"],"center",5,"top"],17,["step",["get","sizerank"],"center",13,"top"]],"text-field":["coalesce",["get","name_en"],["get","name"]]},paint:{"icon-opacity":["step",["zoom"],["step",["get","sizerank"],0,5,1],17,["step",["get","sizerank"],0,13,1]],"text-halo-color":"hsl(0, 0%, 100%)","text-halo-width":.5,"text-halo-blur":.5,"text-color":["step",["zoom"],["step",["get","sizerank"],"hsl(26, 20%, 42%)",5,"hsl(26, 25%, 32%)"],17,["step",["get","sizerank"],"hsl(26, 20%, 42%)",13,"hsl(26, 25%, 32%)"]]}},{id:"water-line-label",type:"symbol",source:"composite","source-layer":"natural_label",filter:["all",["match",["get","class"],["bay","ocean","reservoir","sea","water"],!0,!1],["==",["geometry-type"],"LineString"]],layout:{"text-size":["interpolate",["linear"],["zoom"],7,["step",["get","sizerank"],24,6,18,12,12],10,["step",["get","sizerank"],18,9,12],18,["step",["get","sizerank"],18,9,16]],"text-max-angle":30,"text-letter-spacing":["match",["get","class"],"ocean",.25,["sea","bay"],.15,0],"text-font":["DIN Offc Pro Italic","Arial Unicode MS Regular"],"symbol-placement":"line-center","text-pitch-alignment":"viewport","text-field":["coalesce",["get","name_en"],["get","name"]]},paint:{"text-color":["match",["get","class"],["bay","ocean","sea"],"hsl(205, 84%, 88%)","hsl(230, 48%, 44%)"]}},{id:"water-point-label",type:"symbol",source:"composite","source-layer":"natural_label",filter:["all",["match",["get","class"],["bay","ocean","reservoir","sea","water"],!0,!1],["==",["geometry-type"],"Point"]],layout:{"text-line-height":1.3,"text-size":["interpolate",["linear"],["zoom"],7,["step",["get","sizerank"],24,6,18,12,12],10,["step",["get","sizerank"],18,9,12]],"text-font":["DIN Offc Pro Italic","Arial Unicode MS Regular"],"text-field":["coalesce",["get","name_en"],["get","name"]],"text-letter-spacing":["match",["get","class"],"ocean",.25,["bay","sea"],.15,.01],"text-max-width":["match",["get","class"],"ocean",4,"sea",5,["bay","water"],7,10]},paint:{"text-color":["match",["get","class"],["bay","ocean","sea"],"hsl(205, 84%, 88%)","hsl(230, 48%, 44%)"]}},{id:"poi-label",type:"symbol",source:"composite","source-layer":"poi_label",minzoom:6,filter:["let","densityByClass",["match",["get","class"],["food_and_drink_stores","historic","landmark","medical","motorist"],3,["park_like","sport_and_leisure","visitor_amenities"],4,2],["<=",["get","filterrank"],["case",["<",0,["var","densityByClass"]],["+",["step",["zoom"],0,16,1,17,2],["var","densityByClass"]],["var","densityByClass"]]]],layout:{"text-size":["step",["zoom"],["step",["get","sizerank"],18,5,12],17,["step",["get","sizerank"],18,13,12]],"icon-image":["step",["zoom"],["concat",["get","maki"],"-11"],15,["concat",["get","maki"],"-15"]],"text-font":["DIN Offc Pro Medium","Arial Unicode MS Regular"],"text-offset":["step",["zoom"],["step",["get","sizerank"],["literal",[0,0]],5,["literal",[0,.75]]],17,["step",["get","sizerank"],["literal",[0,0]],13,["literal",[0,.75]]]],"text-anchor":["step",["zoom"],["step",["get","sizerank"],"center",5,"top"],17,["step",["get","sizerank"],"center",13,"top"]],"text-field":["coalesce",["get","name_en"],["get","name"]]},paint:{"icon-opacity":["step",["zoom"],["step",["get","sizerank"],0,5,1],17,["step",["get","sizerank"],0,13,1]],"text-halo-color":"hsl(0, 0%, 100%)","text-halo-width":.5,"text-halo-blur":.5,"text-color":["step",["zoom"],["step",["get","sizerank"],["match",["get","class"],"food_and_drink","hsl(22, 55%, 55%)","park_like","hsl(100, 45%, 37%)","education","hsl(51, 40%, 40%)","medical","hsl(340, 30%, 52%)","hsl(26, 20%, 42%)"],5,["match",["get","class"],"food_and_drink","hsl(22, 85%, 38%)","park_like","hsl(100, 100%, 20%)","education","hsl(51, 100%, 20%)","medical","hsl(340, 39%, 42%)","hsl(26, 25%, 32%)"]],17,["step",["get","sizerank"],["match",["get","class"],"food_and_drink","hsl(22, 55%, 55%)","park_like","hsl(100, 45%, 37%)","education","hsl(51, 40%, 40%)","medical","hsl(340, 30%, 52%)","hsl(26, 20%, 42%)"],13,["match",["get","class"],"food_and_drink","hsl(22, 85%, 38%)","park_like","hsl(100, 100%, 20%)","education","hsl(51, 100%, 20%)","medical","hsl(340, 39%, 42%)","hsl(26, 25%, 32%)"]]]}},{id:"transit-label",type:"symbol",source:"composite","source-layer":"transit_stop_label",minzoom:12,filter:["step",["zoom"],["all",["match",["get","mode"],["rail","metro_rail"],!0,!1],["!=",["get","stop_type"],"entrance"]],15,["all",["match",["get","mode"],["rail","metro_rail","ferry","light_rail"],!0,!1],["!=",["get","stop_type"],"entrance"]],16,["all",["!=",["get","mode"],"bus"],["!=",["get","stop_type"],"entrance"]],17,["!=",["get","stop_type"],"entrance"],19,!0],layout:{"text-size":12,"icon-image":["get","network"],"text-font":["DIN Offc Pro Medium","Arial Unicode MS Regular"],"text-justify":["match",["get","stop_type"],"entrance","left","center"],"text-offset":["match",["get","stop_type"],"entrance",["literal",[1,0]],["literal",[0,.8]]],"text-anchor":["match",["get","stop_type"],"entrance","left","top"],"text-field":["step",["zoom"],"",14,["match",["get","mode"],["rail","metro_rail"],["coalesce",["get","name_en"],["get","name"]],""],16,["match",["get","mode"],["bus","bicycle"],"",["coalesce",["get","name_en"],["get","name"]]],18,["coalesce",["get","name_en"],["get","name"]]],"text-letter-spacing":.01,"text-max-width":["match",["get","stop_type"],"entrance",15,9]},paint:{"text-halo-color":"hsl(0, 0%, 100%)","text-color":["match",["get","network"],"entrance","hsl(230, 48%, 44%)","tokyo-metro","hsl(180, 50%, 30%)","mexico-city-metro","hsl(25, 100%, 40%)",["barcelona-metro","delhi-metro","hong-kong-mtr","milan-metro","osaka-subway"],"hsl(0, 90%, 47%)",["boston-t","washington-metro"],"hsl(0, 0%, 0%)",["chongqing-rail-transit","kiev-metro","singapore-mrt","taipei-metro"],"hsl(140, 90%, 25%)","hsl(230, 48%, 44%)"],"text-halo-blur":.5,"text-halo-width":.5}},{id:"airport-label",type:"symbol",source:"composite","source-layer":"airport_label",minzoom:8,layout:{"text-line-height":1.1,"text-size":["step",["get","sizerank"],18,9,12],"icon-image":["step",["get","sizerank"],["concat",["get","maki"],"-15"],9,["concat",["get","maki"],"-11"]],"text-font":["DIN Offc Pro Medium","Arial Unicode MS Regular"],"text-offset":[0,.75],"text-rotation-alignment":"viewport","text-anchor":"top","text-field":["step",["get","sizerank"],["coalesce",["get","name_en"],["get","name"]],15,["get","ref"]],"text-letter-spacing":.01,"text-max-width":9},paint:{"text-color":"hsl(230, 48%, 44%)","text-halo-color":"hsl(0, 0%, 100%)","text-halo-width":1}},{id:"settlement-subdivision-label",type:"symbol",source:"composite","source-layer":"place_label",minzoom:10,maxzoom:15,filter:["all",["==",["get","class"],"settlement_subdivision"],["<=",["get","filterrank"],4]],layout:{"text-field":["coalesce",["get","name_en"],["get","name"]],"text-transform":"uppercase","text-font":["DIN Offc Pro Regular","Arial Unicode MS Regular"],"text-letter-spacing":["match",["get","type"],"suburb",.15,["quarter","neighborhood"],.1,.1],"text-max-width":7,"text-padding":3,"text-size":["interpolate",["cubic-bezier",.5,0,1,1],["zoom"],11,["match",["get","type"],"suburb",11,["quarter","neighborhood"],10.5,10.5],15,["match",["get","type"],"suburb",17,["quarter","neighborhood"],16,16]]},paint:{"text-halo-color":"hsl(0, 0%, 100%)","text-halo-width":1,"text-color":"hsl(230, 29%, 35%)","text-halo-blur":.5}},{id:"settlement-label",type:"symbol",source:"composite","source-layer":"place_label",maxzoom:15,filter:["all",["<=",["get","filterrank"],3],["==",["get","class"],"settlement"],["step",["zoom"],!0,13,[">=",["get","symbolrank"],11],14,[">=",["get","symbolrank"],13]]],layout:{"text-line-height":1.1,"text-size":["interpolate",["cubic-bezier",.2,0,.9,1],["zoom"],3,["step",["get","symbolrank"],12,9,11,10,10.5,12,9.5,14,8.5,16,6.5,17,4],15,["step",["get","symbolrank"],28,9,26,10,23,11,21,12,20,13,19,15,17]],"icon-image":["case",["==",["get","capital"],2],"border-dot-13",["step",["get","symbolrank"],"dot-11",9,"dot-10",11,"dot-9"]],"text-font":["step",["zoom"],["literal",["DIN Offc Pro Regular","Arial Unicode MS Regular"]],8,["step",["get","symbolrank"],["literal",["DIN Offc Pro Medium","Arial Unicode MS Regular"]],11,["literal",["DIN Offc Pro Regular","Arial Unicode MS Regular"]]],10,["step",["get","symbolrank"],["literal",["DIN Offc Pro Medium","Arial Unicode MS Regular"]],12,["literal",["DIN Offc Pro Regular","Arial Unicode MS Regular"]]],11,["step",["get","symbolrank"],["literal",["DIN Offc Pro Medium","Arial Unicode MS Regular"]],13,["literal",["DIN Offc Pro Regular","Arial Unicode MS Regular"]]],12,["step",["get","symbolrank"],["literal",["DIN Offc Pro Medium","Arial Unicode MS Regular"]],15,["literal",["DIN Offc Pro Regular","Arial Unicode MS Regular"]]],13,["literal",["DIN Offc Pro Medium","Arial Unicode MS Regular"]]],"text-justify":["step",["zoom"],["match",["get","text_anchor"],["bottom","top"],"center",["left","bottom-left","top-left"],"left",["right","bottom-right","top-right"],"right","center"],8,"center"],"text-offset":["step",["zoom"],["match",["get","capital"],2,["match",["get","text_anchor"],"bottom",["literal",[0,-.3]],"bottom-left",["literal",[.3,-.1]],"left",["literal",[.45,.1]],"top-left",["literal",[.3,.1]],"top",["literal",[0,.3]],"top-right",["literal",[-.3,.1]],"right",["literal",[-.45,0]],"bottom-right",["literal",[-.3,-.1]],["literal",[0,-.3]]],["match",["get","text_anchor"],"bottom",["literal",[0,-.25]],"bottom-left",["literal",[.2,-.05]],"left",["literal",[.4,.05]],"top-left",["literal",[.2,.05]],"top",["literal",[0,.25]],"top-right",["literal",[-.2,.05]],"right",["literal",[-.4,.05]],"bottom-right",["literal",[-.2,-.05]],["literal",[0,-.25]]]],8,["literal",[0,0]]],"text-anchor":["step",["zoom"],["get","text_anchor"],8,"center"],"text-field":["coalesce",["get","name_en"],["get","name"]],"text-max-width":7},paint:{"text-color":"hsl(0, 0%, 0%)","text-halo-color":"hsl(0, 0%, 100%)","text-halo-width":1,"icon-opacity":["step",["zoom"],1,8,0],"text-halo-blur":1}},{id:"state-label",type:"symbol",source:"composite","source-layer":"place_label",minzoom:3,maxzoom:9,filter:["==",["get","class"],"state"],layout:{"text-size":["interpolate",["cubic-bezier",.85,.7,.65,1],["zoom"],4,["step",["get","symbolrank"],10,6,9.5,7,9],9,["step",["get","symbolrank"],24,6,18,7,14]],"text-transform":"uppercase","text-font":["DIN Offc Pro Bold","Arial Unicode MS Bold"],"text-field":["step",["zoom"],["step",["get","symbolrank"],["coalesce",["get","name_en"],["get","name"]],5,["coalesce",["get","abbr"],["get","name_en"],["get","name"]]],5,["coalesce",["get","name_en"],["get","name"]]],"text-letter-spacing":.15,"text-max-width":6},paint:{"text-color":"hsl(0, 0%, 0%)","text-halo-color":"hsl(0, 0%, 100%)","text-halo-width":1}},{id:"country-label",type:"symbol",source:"composite","source-layer":"place_label",minzoom:1,maxzoom:10,filter:["==",["get","class"],"country"],layout:{"text-line-height":1.1,"text-size":["interpolate",["cubic-bezier",.2,0,.7,1],["zoom"],1,["step",["get","symbolrank"],11,4,9,5,8],9,["step",["get","symbolrank"],28,4,22,5,21]],"icon-image":"dot-11","text-font":["DIN Offc Pro Medium","Arial Unicode MS Regular"],"text-justify":["step",["zoom"],["match",["get","text_anchor"],["bottom","top"],"center",["left","bottom-left","top-left"],"left",["right","bottom-right","top-right"],"right","center"],7,"center"],"text-offset":["step",["zoom"],["match",["get","text_anchor"],"bottom",["literal",[0,-.25]],"bottom-left",["literal",[.2,-.05]],"left",["literal",[.4,.05]],"top-left",["literal",[.2,.05]],"top",["literal",[0,.25]],"top-right",["literal",[-.2,.05]],"right",["literal",[-.4,.05]],"bottom-right",["literal",[-.2,-.05]],["literal",[0,-.25]]],7,["literal",[0,0]]],"text-anchor":["step",["zoom"],["coalesce",["get","text_anchor"],"center"],7,"center"],"text-field":["coalesce",["get","name_en"],["get","name"]],"text-max-width":6},paint:{"icon-opacity":["step",["zoom"],["case",["has","text_anchor"],1,0],7,0],"text-color":"hsl(0, 0%, 0%)","text-halo-color":["interpolate",["linear"],["zoom"],2,"rgba(255,255,255,0.75)",3,"hsl(0, 0%, 100%)"],"text-halo-width":1.25}}],created:"2019-07-01T04:05:17.166Z",id:"cjxjv17d741bz1cs34i567d73",modified:"2019-07-01T04:05:41.650Z",owner:"raychaser",visibility:"private",draft:!1}},51:function(e,t,a){"use strict";a.d(t,"d",function(){return o}),a.d(t,"c",function(){return i}),a.d(t,"b",function(){return l}),a.d(t,"e",function(){return c}),a.d(t,"a",function(){return s});var n=a(137),r=a.n(n),o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"LLLL";return r()(e,"x").format(t)},i=function(e){return r()(e,"x").fromNow()},l=function(e){return r.a.utc(e).format("x")};function c(e){return r()(e,"x").format("YYYY-MM-DDTkk:mm")}function s(e){return r()(new Date(e),"YYYY-MM-DDTkk:mm").format("x")}},534:function(e,t,a){e.exports=a(948)},548:function(e,t){},554:function(e,t){},66:function(e,t,a){"use strict";(function(e){a.d(t,"b",function(){return n}),a.d(t,"a",function(){return r});a(186);var n=function(e){try{return!isNaN(parseFloat(e))&&isFinite(e)}catch(t){return!1}};function r(e,t,a){var n=this,r=null;return function(){for(var o=arguments.length,i=new Array(o),l=0;l<o;l++)i[l]=arguments[l];var c=n,s=a&&!r;clearTimeout(r),r=setTimeout(function(){r=null,a||e.apply(c,i)},t),s&&e.apply(c,i)}}}).call(this,a(37).Buffer)},944:function(e,t,a){},948:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(26),i=a.n(o),l=a(12),c=a.n(l),s=a(29),u=a(9),m=a(41),d=a(31),p=a(327),g=a(464),h=a.n(g);Object(p.b)(h.a);r.a.createContext({});var f=function(e){var t=e.children;return r.a.createElement(p.a,{locale:"en"},t)},b=a(39),y=a(40),v=a.n(y);function E(){var e=Object(b.a)(["\nfragment userFragment on User {\n  id\n  username\n  gravatar\n  watching\n  gravatarProfile\n  meta\n  createdOn\n  updatedOn\n  __typename\n}\n"]);return E=function(){return e},e}function w(){var e=Object(b.a)(["\nfragment photoFragment on Photo {\n  id\n  meta\n  createdOn\n  takenOn\n  updatedOn\n  coords\n  note\n  seriesId\n  seriesCreatedBy\n  createdBy\n  updatedBy\n  uploadToken\n  createdUser {\n    ...userSummaryFragment\n  }\n  updatedUser {\n    ...userSummaryFragment\n  }\n  tags {\n    label\n    typeId\n    coords {\n      x\n      y\n      __typename\n    }\n    __typename\n  }\n  paths {\n    base\n    large\n    thumb\n    medium\n    __typename\n  }\n  __typename\n}\n","\n"]);return w=function(){return e},e}function x(){var e=Object(b.a)(["\nfragment seriesFragment on Series {\n  id\n  name\n  access\n  note\n  meta\n  watchers\n  seriesStatus\n  createdOn\n  updatedOn\n  createdUser {\n    ...userSummaryFragment\n  }\n  updatedUser {\n    ...userSummaryFragment\n  }\n  coords\n  direction\n  photoCount\n  featured {\n    ...photoSummaryFragment\n  }\n  latest {\n    ...photoSummaryFragment\n  }\n  __typename\n}\n","\n","\n"]);return x=function(){return e},e}function O(){var e=Object(b.a)(["\nfragment seriesSummaryFragment on SeriesSummary {\n  id\n  name\n  access\n  createdUser {\n    ...userSummaryFragment\n  }\n  seriesStatus\n  updatedOn\n  createdOn\n  photoCount\n  coords\n  direction\n  watchers\n  featured {\n    ...photoSummaryFragment\n  }\n  latest {\n    ...photoSummaryFragment\n  }\n  __typename\n}\n","\n","\n"]);return O=function(){return e},e}function k(){var e=Object(b.a)(["\nfragment userSummaryFragment on UserSummary {\n  id\n  gravatar\n  gravatarProfile\n  username\n  __typename\n}\n"]);return k=function(){return e},e}function S(){var e=Object(b.a)(["\nfragment photoSummaryFragment on PhotoSummary {\n  id\n  takenOn\n  seriesCreatedBy\n  updatedOn\n  createdOn\n  seriesId\n  createdUser {\n    ...userSummaryFragment\n  }\n  paths {\n    base\n    thumb\n    medium\n    large\n    __typename\n  }\n  __typename\n}\n"]);return S=function(){return e},e}var j=v()(S()),C=["id","takenOn","seriesCreatedBy","updatedOn","createdOn","seriesId","createdUser","paths"],N=v()(k()),T=v()(O(),j,N),I=["id","name","access","createdUser","seriesStatus","updatedOn","createdOn","photoCount","coords","direction","watchers","featured","latest"],P=v()(x(),j,N),z=["id","name","access","note","meta","watchers","seriesStatus","createdOn","updatedOn","createdUser","updatedUser","coords","direction","photoCount","featured","latest"],A=v()(w(),N),_=v()(E());function R(){var e=Object(b.a)(["\n  query s3Credentials($seriesId: ID!, $photoId: ID!, $ext: String!)  {\n    s3Credentials(seriesId: $seriesId, photoId: $photoId, ext: $ext)\n  }\n"]);return R=function(){return e},e}function M(){var e=Object(b.a)(["\nquery getWholeSeries($id: ID!) {\n  series(id: $id) {\n    ...seriesFragment\n    photos {\n      ...photoFragment\n    }\n  }\n}\n","\n","\n"]);return M=function(){return e},e}function D(){var e=Object(b.a)(["\nquery userSearch($searchStr: String!, $limit: Int) {\n  userSearch(searchStr: $searchStr, limit: $limit ){\n    ...userFragment\n  }\n}\n","\n"]);return D=function(){return e},e}function L(){var e=Object(b.a)(['\nquery myFeed($start: String, $end: String, $limit: Int) {\n  myFeed(start: $start, end: $end, limit: $limit) @connection(key: "myFeed"){\n    feed {\n      _id\n      series {\n        ...seriesSummaryFragment\n      }\n      photo {\n        ...photoSummaryFragment\n      }\n      relation\n      __typename\n    }\n    window\n    __typename\n  }\n}\n',"\n","\n"]);return L=function(){return e},e}function F(){var e=Object(b.a)(["\nquery geocode($search: String!) {\n  geocoder(search: $search) {\n    relevance\n    text\n    placeName\n    bbox\n    center\n    # geoType\n    # context\n    __typename\n  }\n}\n"]);return F=function(){return e},e}function B(){var e=Object(b.a)(["\nquery getUser($userId: ID) {\n  user(id: $userId){\n    ...userFragment\n  }\n}\n","\n"]);return B=function(){return e},e}function U(){var e=Object(b.a)(['\nquery seriesInGeoBoundsIdOnly($bounds: [Float], $limit: Int, $nextToken: String) {\n  seriesInGeoBounds(bounds: $bounds, limit: $limit, nextToken: $nextToken) @connection(key: "seriesInGeoBoundsSHORT", filter: ["bounds"]){\n    seriesSummaries {\n      id\n      name\n    }\n    nextToken\n    __typename\n  }\n}\n']);return U=function(){return e},e}function W(){var e=Object(b.a)(['\nquery seriesInGeoBounds($bounds: [Float], $limit: Int, $nextToken: String) {\n  seriesInGeoBounds(bounds: $bounds, limit: $limit, nextToken: $nextToken) @connection(key: "seriesInGeoBounds", filter: ["bounds"]){\n    seriesSummaries {\n      ...seriesSummaryFragment\n    }\n    nextToken\n    __typename\n  }\n}\n',"\n"]);return W=function(){return e},e}function G(){var e=Object(b.a)(["\nquery tagSearch($limit: Int, $tag: String) {\n  tags(limit: $limit, tag: $tag ){\n    _id\n    name\n    count\n    __typename\n  }\n}\n"]);return G=function(){return e},e}function H(){var e=Object(b.a)(['\nquery seriesWithTag($tag: String!, $limit: Int, $nextToken: String){\n  tagSeries(tag: $tag, limit: $limit, nextToken: $nextToken)  @connection(key: "tagSeries", filter: ["tag"]){\n    seriesSummaries{\n      ...seriesSummaryFragment\n    }\n    nextToken\n    __typename\n  }\n}\n',"\n"]);return H=function(){return e},e}function q(){var e=Object(b.a)(["\nquery seriesFromList($seriesList: [ID]) {\n  arraySeries(seriesIds: $seriesList) {\n    ...seriesFragment\n    photos {\n      ...photoFragment\n    }\n  }\n}\n","\n","\n"]);return q=function(){return e},e}function Q(){var e=Object(b.a)(["\nquery seriesFromList($seriesList: [ID]) {\n  arraySeries(seriesIds: $seriesList) {\n    ...seriesSummaryFragment\n  }\n}\n","\n"]);return Q=function(){return e},e}function Y(){var e=Object(b.a)(["\nquery userSeries($createdBy: ID) {\n  userSeries(createdBy: $createdBy ) {\n    seriesSummaries {\n      ...seriesSummaryFragment\n    }\n    nextToken\n    __typename\n  }\n}\n","\n"]);return Y=function(){return e},e}function $(){var e=Object(b.a)(['\nquery pollQuery($lastCheck: String!, $limit: Int, $nextToken: String) {\n  changedSeries(lastCheck: $lastCheck, limit: $limit, nextToken: $nextToken) @connection(key: "changedSeries"){\n    seriesSummaries {\n      ...seriesSummaryFragment\n    }\n    __typename\n  }\n}\n',"\n"]);return $=function(){return e},e}function V(){var e=Object(b.a)(['\nquery allSeries($limit: Int, $nextToken: String) {\n  allSeries(limit: $limit, nextToken: $nextToken) @connection(key: "allSeries"){\n    seriesSummaries {\n      ...seriesSummaryFragment\n    }\n    nextToken\n    __typename\n  }\n}\n',"\n"]);return V=function(){return e},e}var X=v()(V(),T),Z=v()($(),T),J=v()(Y(),T),K=(v()(Q(),T),v()(q(),P,A)),ee=v()(H(),T),te=v()(G()),ae=(v()(W(),T),v()(U())),ne=v()(B(),_),re=v()(F()),oe=v()(L(),T,j),ie=v()(D(),_),le=v()(M(),P,A),ce=v()(R()),se=a(950),ue=a(108),me={useNextVariants:!0},de={MuiDialog:{paper:{"@media (max-width:321px)":{margin:10}},paperFullWidth:{"@media (max-width:321px)":{width:"calc(100% - 20px)"}}}},pe="#3a3335",ge="#d81e5b",he="#f0544f",fe="#FDF0D5",be={palette:{primary:{main:he},secondary:{main:ge},text:{primary:pe,secondary:Object(ue.fade)(pe,.7)}},typography:me,overrides:de},ye={palette:{primary:{main:Object(ue.lighten)(pe,.1)},secondary:{main:ge},text:{primary:pe,secondary:Object(ue.fade)(pe,.7)}},typography:me,overrides:de},ve={palette:{primary:{main:he},secondary:{main:ge}},typography:me},Ee={palette:{primary:{main:fe},secondary:{main:he}},typography:me},we={palette:{primary:{main:he},secondary:{main:ge},text:{primary:fe,secondary:Object(ue.fade)(fe,.7)},background:{default:pe,paper:pe}},typography:me,overrides:de},xe={home:Object(se.a)(be),login:Object(se.a)(we),series:Object(se.a)(ye),topbar:Object(se.a)(ve),bottombar:Object(se.a)(Ee)},Oe=r.a.createContext({}),ke=a(988),Se=a(987),je=a(985),Ce=function(){var e=Object(n.useRef)(),t=function(t){if("Enter"===t.key&&e.current)try{var a=e.current.getElementsByClassName("enterAction");a&&a[0]&&a[0].click()}catch(n){console.error("useAuthCommon::handleKeyPress",n)}};return Object(n.useEffect)(function(){if(e.current){try{document.addEventListener("keypress",t,!1)}catch(a){console.error("useAuthCommon::useEffect",a)}return function(){return document.removeEventListener("keypress",t,!1)}}},[]),e},Ne=a(22),Te=a.n(Ne),Ie=r.a.createElement(r.a.Fragment,null,r.a.createElement("path",{d:"M13.685,2.797c-0.44,1.273 0.852,3.525 -1.082,4.966c-1.247,0.93 -2.133,2.247 -2.743,4.167c-3.78,-7.611 2.788,-8.409 3.682,-10.699c0.64,1.255 5.18,2.608 2.89,4.873c1.28,-2.034 -2.359,-1.862 -2.747,-3.307Z"}),r.a.createElement("path",{d:"M4.921,5.953c0.883,1.017 3.479,1.024 3.76,3.42c0.181,1.545 0.879,2.971 2.238,4.459c-8.482,-0.532 -5.889,-6.619 -7.425,-8.538c1.407,0.073 4.848,-3.183 5.665,-0.066c-1.121,-2.126 -2.792,1.111 -4.238,0.725Z"}),r.a.createElement("path",{d:"M3.236,15.092c1.323,-0.256 2.627,-2.5 4.842,-1.546c1.428,0.615 3.013,0.724 4.98,0.292c-4.701,7.079 -8.676,1.79 -11.106,2.161c0.766,-1.183 -0.332,-5.791 2.775,-4.94c-2.402,-0.091 -0.433,2.974 -1.491,4.033Z"}),r.a.createElement("path",{d:"M10.309,21.121c0.439,-1.274 -0.852,-3.525 1.081,-4.967c1.247,-0.929 2.133,-2.246 2.743,-4.167c3.781,7.611 -2.788,8.409 -3.681,10.699c-0.641,-1.255 -5.181,-2.607 -2.891,-4.873c-1.28,2.034 2.359,1.863 2.748,3.308Z"}),r.a.createElement("path",{d:"M19.066,18.01c-0.883,-1.017 -3.479,-1.024 -3.76,-3.42c-0.182,-1.544 -0.88,-2.971 -2.238,-4.459c8.482,0.532 5.889,6.619 7.425,8.538c-1.407,-0.072 -4.849,3.183 -5.665,0.067c1.121,2.125 2.792,-1.112 4.238,-0.726Z"}),r.a.createElement("path",{d:"M20.751,8.871c-1.323,0.256 -2.627,2.501 -4.842,1.546c-1.429,-0.615 -3.013,-0.723 -4.98,-0.291c4.701,-7.08 8.676,-1.791 11.106,-2.162c-0.767,1.183 0.332,5.791 -2.775,4.94c2.401,0.092 0.433,-2.974 1.491,-4.033Z"})),Pe=Te()(Ie,"AppLogo"),ze=a(986),Ae=Object(je.a)(function(e){return{root:{height:"100%"},bgSwoosh:{width:"100%",height:"100%",position:"absolute",top:0,left:0,zIndex:0},spacer:{flex:"1 1 5%"},logo:{flex:"1 1 40%",width:"100%",minHeight:90},inner:{margin:"0 auto",width:"100%",height:"100%",minWidth:200,maxWidth:300,display:"flex",flexDirection:"column",textAlign:"center"}}}),_e=function(e){var t=e.children,a=Ce(),n=Ae();return r.a.createElement(ze.a,{theme:xe.login},r.a.createElement("div",{ref:a,className:n.root},r.a.createElement(Se.a,null),r.a.createElement("div",{className:n.inner},r.a.createElement(Pe,{className:n.logo}),r.a.createElement(ke.a,{variant:"h5"},"MorPhoto"),t,r.a.createElement("div",{className:n.spacer}))))},Re=function(e){var t=e.message;return r.a.createElement(_e,null,r.a.createElement(ke.a,{variant:"h3"},"Loading..."),t&&r.a.createElement(ke.a,{variant:"overline"},t))},Me=a(54),De=a(90),Le=a(122),Fe=a(120),Be=a(123),Ue=function(e){function t(e){var a;return Object(Me.a)(this,t),console.log("ErrorBoundary constructor"),(a=Object(Le.a)(this,Object(Fe.a)(t).call(this,e))).state={hasError:!1},a}return Object(Be.a)(t,e),Object(De.a)(t,[{key:"componentDidCatch",value:function(e,t){console.log("ErrorBoundary componentDidCatch"),console.error(e)}},{key:"render",value:function(){var e=this.state,t=e.hasError,a=e.error,n=this.props.fallback;return t?(console.log("ErrorBoundary hasError"),r.a.createElement(n,{error:a})):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return console.log("ErrorBoundary getDerivedStateFromError"),console.error(e),{hasError:!0,error:e}}}]),t}(r.a.Component),We=a(6),Ge=a(62),He=a(989),qe=a(991),Qe=a(995),Ye=a(996),$e=a(997),Ve=a(1037),Xe=a(1004),Ze=a(466),Je=a.n(Ze),Ke=a(184),et=a.n(Ke),tt=a(245),at=a.n(tt),nt="UNSENT",rt="SENDING",ot="SENT",it="ERROR",lt=Object(je.a)(function(e){return{root:{height:"100%",overflow:"hidden",padding:e.spacing(1),display:"flex",flexDirection:"column",textAlign:"center",color:e.palette.text.primary,border:"20px solid ".concat(e.palette.text.secondary)},button:{},icon:{opacity:.5,margin:"auto",flex:"0 1 10%",width:"50%"},text:{},spacer:{flexGrow:1},stack:{padding:e.spacing(2),marginBottom:e.spacing(2),fontSize:"8px",flexGrow:1,textAlign:"left",whiteSpace:"pre-wrap",overflow:"scroll",color:e.palette.error.main,fontFamily:"Consolas, monaco, monospace"}}}),ct=function(e){var t=e.error,a=e.sendState,o=e.reportError,i=lt(),l=Object(n.useState)(!1),c=Object(We.a)(l,2),s=c[0],u=c[1],m=Object(n.useState)(""),d=Object(We.a)(m,2),p=d[0],g=d[1],h=Object(n.useContext)(Oe).resetApp;console.log("ERRORCOJNTEXT",{resetApp:h}),console.log();var f=r.a.createElement("div",{className:i.spacer});var b="Report this bug",y=!1,v="primary";switch(a){case nt:b="Report this bug";break;case rt:y=!0,v="default",b="Sending...";break;case ot:v="default",y=!0,b="Thank you for your feedback";break;case it:v="secondary",y=!0,b="ERROR SENDING BUG REPORT"}return r.a.createElement("div",{className:i.root},r.a.createElement(Se.a,null),r.a.createElement(et.a,{className:i.icon,color:"error"}),r.a.createElement(ke.a,{variant:"subtitle1",className:i.text,color:"inherit"},"Something went wrong"),t&&t.message&&r.a.createElement(ke.a,{variant:"body1",className:i.text,color:"inherit"},t.message),r.a.createElement(He.a,{className:i.button,variant:"contained",disabled:y,color:v,onClick:function(){return u(!0)}},r.a.createElement(Je.a,null),b),f,r.a.createElement(He.a,{className:i.button,variant:"contained",color:"secondary"},r.a.createElement(at.a,null),"RESET APP"),r.a.createElement(ke.a,{variant:"caption",color:"inherit"},"Unfortunately you will lose any data (and Photos) that haven't already been uploaded"),r.a.createElement(qe.a,{open:s,fullScreen:!0,onClose:function(){return u(!1)},"aria-labelledby":"form-dialog-title"},r.a.createElement(Qe.a,{id:"form-dialog-title"},"Report a bug"),r.a.createElement(Ye.a,null,r.a.createElement($e.a,null,"What were you trying to do when the error happened? (optional)"),r.a.createElement(Ve.a,{autoFocus:!0,margin:"dense",multiline:!0,onChange:function(e){return g(e.target.value)},rows:"3",rowsMax:"6",id:"note",placeholder:"I tried to X and then Y happened...",label:"My report",fullWidth:!0})),r.a.createElement(Xe.a,null,r.a.createElement(He.a,{onClick:function(){return u(!1)},color:"primary"},"Cancel"),r.a.createElement(He.a,{onClick:function(){o(p),u(!1)},color:"primary"},"Send"))))};function st(){var e=Object(b.a)(["\nmutation reportBug($reportJSON: String!) {\n  reportBug(reportJSON: $reportJSON)\n}\n"]);return st=function(){return e},e}function ut(){var e=Object(b.a)(["\nmutation unWatch($seriesId: ID) {\n  unWatchSeries(seriesId: $seriesId)\n}\n"]);return ut=function(){return e},e}function mt(){var e=Object(b.a)(["\nmutation watch($seriesId: ID) {\n  watchSeries(seriesId: $seriesId)\n}\n"]);return mt=function(){return e},e}function dt(){var e=Object(b.a)(["\nmutation createSeries($series: NewSeriesInput, $photo: NewPhotoInput!, $ext: String!) {\n  createSeries(series: $series, photo: $photo, ext: $ext) {\n    series {\n      ...seriesFragment\n      photos {\n        ...photoFragment\n      }\n    }\n    preAuth\n    __typename\n  }\n}\n","\n","\n"]);return dt=function(){return e},e}function pt(){var e=Object(b.a)(["\nmutation createPhoto($photo: NewPhotoInput!, $ext: String!) {\n  createPhoto(photo: $photo, ext: $ext) {\n    photo {\n      ...photoFragment\n    }\n    preAuth\n    __typename\n  }\n}\n","\n"]);return pt=function(){return e},e}function gt(){var e=Object(b.a)(["\nmutation updatePhoto($photo: UpdatePhotoInput!) {\n  updatePhoto(photo: $photo){\n    ...photoFragment\n  }\n}\n","\n"]);return gt=function(){return e},e}function ht(){var e=Object(b.a)(["\nmutation updateSeries($series: UpdateSeriesInput!) {\n  updateSeries(series: $series){\n    ...seriesFragment\n  }\n\n}\n","\n"]);return ht=function(){return e},e}function ft(){var e=Object(b.a)(["\nmutation deleteSeries($id: ID!) {\n  deleteSeries(id: $id)\n}\n"]);return ft=function(){return e},e}function bt(){var e=Object(b.a)(["\nmutation deletePhoto($seriesId: ID!, $photoId: ID!) {\n  deletePhoto(seriesId: $seriesId, photoId: $photoId)\n}\n"]);return bt=function(){return e},e}var yt=v()(bt()),vt=v()(ft()),Et=v()(ht(),P),wt=["id","access","name","note","coords","direction"],xt=v()(gt(),A),Ot=["id","seriesId","takenOn","tags","note"],kt=v()(pt(),A),St=["seriesId","takenOn","meta","rawData","coords","tags","note","uploadToken"],jt=v()(dt(),P,A),Ct=["access","name","note","coords","direction","meta"],Nt=v()(mt()),Tt=v()(ut()),It=v()(st()),Pt=Object(d.d)(It,{props:function(e){var t=e.mutate,a=e.ownProps,n=a.reduxState,r=a.error,o=a.setState;return console.log("withReportBugMutation props",{mutate:t,reduxState:n,error:r}),t.error&&o(it),{reportError:function(e){o(rt);var a="",i={note:e,reduxState:n,error:r,env:Object({NODE_ENV:"production",PUBLIC_URL:"/photomon_v0",REACT_APP_MAPBOX_TOKEN:"pk.eyJ1IjoicmF5Y2hhc2VyIiwiYSI6IlFHWHVMSW8ifQ.emd44Ibp4cmT9YXitY1ziw",REACT_APP_GRAPHQL:"https://11w2bia702.execute-api.us-west-2.amazonaws.com/prod",REACT_APP_AWS_REGION:"us-west-2",REACT_APP_COGNITO_IDPOOLID:"us-west-2:ab544d6d-6ea9-430d-8c8f-d895ce172d0f",REACT_APP_COGNITO_USER_POOL_ID:"us-west-2_ninoe7B9g",REACT_APP_COGNITO_CLIENT_ID:"ndtqsua64n6qqp9hef5fh4560",REACT_APP_DOMAIN:"northarrowresearchlabs.github.io",REACT_APP_BASENAME:"photomon_v0",REACT_APP_TILEURL_SAT:"https://api.mapbox.com/v4/mapbox.mapbox-terrain-v2,mapbox.mapbox-streets-v7/{z}/{x}/{y}.vector.pbf",REACT_APP_TILEURL_TOPO:"https://api.mapbox.com/v4/mapbox.satellite/{z}/{x}/{y}@2x.webp",REACT_APP_VERSION:"0.0.436",REACT_APP_CONTACT_EMAIL:"info@northarrowresearch.com"})};console.log("withReportBugMutation StartingError",i);try{a=JSON.stringify(i)}catch(l){a=r.toString()}return console.log("withReportBugMutation got through it",a),t({variables:{reportJSON:a},update:function(e,t){var a=t.data;console.log("withReportBugMutation update",a),o(ot)}})}}}}),zt=Object(Ge.b)(function(e,t){var a=e.map,n=e.home,r=(e.uploader,Object(m.a)(e,["map","home","uploader"])),o=a.slice(-5);return{reduxState:Object(u.a)({},r,{map:o,home:n})}})(function(e){var t=Object(n.useState)(nt),a=Object(We.a)(t,2),o=a[0],i=a[1],l=Pt(ct);return r.a.createElement(l,Object.assign({},e,{setState:i,sendState:o}))}),At=a(519),_t=a(470),Rt=a(471),Mt=a(168),Dt=a.n(Mt),Lt=a(467),Ft=a(468),Bt=a(1005),Ut=a(1006),Wt=a(1007),Gt=a(1008),Ht=[{toolTip:"Sat",Icon:Bt.a,ActiveIcon:Ut.a,color:"green",style:Lt},{toolTip:"Topo",Icon:Wt.a,ActiveIcon:Gt.a,color:"blue",style:Ft}],qt=a(1009),Qt=a(567),Yt=a(1010),$t=["#418CF0","#FCB441","#E0400A","#056492","#BFBFBF","#1A3B69","#FFE382","#129CDD","#CA6B4B","#005CDB","#F3D288","#506381","#F1B9A8","#E0830A","#7893BE"],Vt={mapBoxToken:"pk.eyJ1IjoicmF5Y2hhc2VyIiwiYSI6IlFHWHVMSW8ifQ.emd44Ibp4cmT9YXitY1ziw",styles:Ht},Xt=Object({NODE_ENV:"production",PUBLIC_URL:"/photomon_v0",REACT_APP_MAPBOX_TOKEN:"pk.eyJ1IjoicmF5Y2hhc2VyIiwiYSI6IlFHWHVMSW8ifQ.emd44Ibp4cmT9YXitY1ziw",REACT_APP_GRAPHQL:"https://11w2bia702.execute-api.us-west-2.amazonaws.com/prod",REACT_APP_AWS_REGION:"us-west-2",REACT_APP_COGNITO_IDPOOLID:"us-west-2:ab544d6d-6ea9-430d-8c8f-d895ce172d0f",REACT_APP_COGNITO_USER_POOL_ID:"us-west-2_ninoe7B9g",REACT_APP_COGNITO_CLIENT_ID:"ndtqsua64n6qqp9hef5fh4560",REACT_APP_DOMAIN:"northarrowresearchlabs.github.io",REACT_APP_BASENAME:"photomon_v0",REACT_APP_TILEURL_SAT:"https://api.mapbox.com/v4/mapbox.mapbox-terrain-v2,mapbox.mapbox-streets-v7/{z}/{x}/{y}.vector.pbf",REACT_APP_TILEURL_TOPO:"https://api.mapbox.com/v4/mapbox.satellite/{z}/{x}/{y}@2x.webp",REACT_APP_VERSION:"0.0.436",REACT_APP_CONTACT_EMAIL:"info@northarrowresearch.com"}).REACT_APP_BASEURL;console.log("config: ",Xt,"photomon_v0");var Zt={Offline:{seriesImgsToCache:["thumb","large"],highestOfflineTileZoom:12,maxMapTileArea:25e3},AppStateTypes:{FEED:"feed",MAP:"map",SEARCH:"search",PROFILE:"profile",SERIES:"series",SETTINGS:"settings",QRCAPTURE:"QRCapture",NEW_SERIES_CAMERA:"new_series_camera",NEW_SERIES_LIBRARY:"new_series_library",OFFLINE_DOWNLOAD:"offline_download"},SEARCH_TABS:{TAG:"tag",LOCATION:"location",USER:"user"},MapModeTypes:{FREE:"free",USER:"user",TAG:"tag"}},Jt={graphql:"".concat("https://11w2bia702.execute-api.us-west-2.amazonaws.com/prod","/api"),share:"".concat("https://11w2bia702.execute-api.us-west-2.amazonaws.com/prod","/share")},Kt={Auth:{region:"us-west-2",userPoolId:"us-west-2_ninoe7B9g",userPoolWebClientId:"ndtqsua64n6qqp9hef5fh4560",mandatorySignIn:!0,cookieStorage:{domain:"".concat("northarrowresearchlabs.github.io"),expires:20,secure:!1}}},ea={OPEN:{label:"Open",description:"Anyone can see and contribute photos to this series.",color:qt.a},PRIVATE:{label:"Private",description:"Can only be seen by you.",color:Qt.a},PUBLIC:{label:"Public",description:"Anyone can see this series. Only the owner can add photos.",color:Yt.a}},ta=a(99),aa=a(260),na=a.n(aa),ra=a(17),oa=a(50),ia=a.n(oa);function la(){var e=Object(b.a)(["\n        fragment watchers on SeriesSummary {\n          watchers\n        }\n      "]);return la=function(){return e},e}var ca=function(e,t){var a={id:t.id},n=le,r={series:{}};try{var o=e.readQuery({query:n,variables:a});r=ia.a.cloneDeep(o)}catch(i){console.warn("updateQueries::getWholeSeriesUpdate readQuery failed",{newData:r,series:t}),console.warn("updateQueries::getWholeSeriesUpdate",i)}try{r.series=Object(u.a)({},r.series,t),e.writeQuery({query:n,variables:a,data:r}),console.log("updateQueries::getWholeSeriesUpdate DONE")}catch(i){console.error("updateQueries::getWholeSeriesUpdate writeQuery failed",{newData:r,series:t}),console.warerrorn("updateQueries::getWholeSeriesUpdate",i)}},sa=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n={id:t.seriesId},r=le;try{var o=e.readQuery({query:r,variables:n}),i=ia.a.cloneDeep(o);if(a)i.series.photos=i.series.photos.filter(function(e){return e.id!==t.id});else{var l=i.series.photos.findIndex(function(e){return e.id===t.id});l>-1?(i.series.photos=Object(ra.a)(i.series.photos),i.series.photos[l]=t):i.series.photos=[].concat(Object(ra.a)(i.series.photos),[t])}e.writeQuery({query:r,variables:n,data:i}),console.log("updateQueries::getWholeSeriesPhotoUpdate DONE")}catch(c){console.error("updateQueries::getWholeSeriesPhotoUpdate WriteQuery failed",{photo:t,remove:a}),console.error("updateQueries::getWholeSeriesPhotoUpdate",c)}};function ua(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=[];if(a)n=e.filter(function(e){return e.id!==t.id});else{var r=e.findIndex(function(e){return e.id===t.id}),o=Object(u.a)({},ia.a.pick(t,z),{seriesStatus:null,__typename:"SeriesSummary"});n=r>-1?e.map(function(e){return e.id===t.id?o:e}):[].concat(Object(ra.a)(n),[o])}return console.log("updateQueries::updateSeriesSummaries HELPER",{origArr:e,series:t,newArr:n,remove:a}),n}var ma=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n={limit:100},r=X,o={allSeries:{seriesSummaries:[],nextToken:null,__typename:"PaginatedSeries"}};try{var i=e.readQuery({query:r,variables:n});o=ia.a.cloneDeep(i)}catch(c){if(console.warn("updateQueries::allSeriesUpdate readQuery failed",{series:t,remove:a,newData:o}),console.warn("updateQueries::allSeriesUpdate",c),!t)return;var l=ia.a.pick(t,I);l.__typename="SeriesSummary",o.allSeries.seriesSummaries=[l]}try{o.allSeries.seriesSummaries=ua(o.allSeries.seriesSummaries,t,a),e.writeQuery({query:r,variables:n,data:o}),console.log("updateQueries::allSeriesUpdate DONE")}catch(c){console.error("updateQueries::allSeriesUpdate writeQuery failed",{series:t,remove:a,newData:o}),console.error("updateQueries::allSeriesUpdate",c)}},da=function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=X,o={allSeries:{seriesSummaries:[],nextToken:null,__typename:"PaginatedSeries"}};try{var i=e.readQuery({query:r,variables:{limit:100}});o=ia.a.cloneDeep(i)}catch(c){if(console.warn("updateQueries::allSeriesPhotoUpdate:: allSeries readQuery failed",{series:t,remove:n,photo:a,newData:o}),console.warn("updateQueries::allSeriesPhotoUpdate",c),!t)return;var l=ia.a.pick(t,I);l.__typename="SeriesSummary",o.allSeries.seriesSummaries=[l]}try{o.allSeries.seriesSummaries=o.allSeries.seriesSummaries.map(function(e){if(e.id!==a.seriesId)return e;var r=ia.a.cloneDeep(e),o=t.photos.findIndex(function(e){return e.id===a.id});if(n&&t)r.latest.id===a.id&&(r.latest=t.photos[t.photos.length-1]),r.featured.id===a.id&&(r.featured=t.photos[t.photos.length-1]),r.photoCount-=1;else if(-1===o){var i=ia.a.pick(a,C);i.__typename="PhotoSummary",r.latest=i,r.photoCount+=1}return r}),e.writeQuery({query:r,data:o}),console.log("updateQueries::allSeriesPhotoUpdate DONE")}catch(c){console.error("updateQueries::createPhotoMutation:: allSeries read or write ERROR",{series:t,photo:a,remove:n}),console.error("updateQueries::createPhotoMutation",c)}},pa=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=J,r={userSeries:{seriesSummaries:[],nextToken:null,__typename:"PaginatedSeries"}};try{var o=e.readQuery({query:n});r=ia.a.cloneDeep(o)}catch(i){console.warn("updateQueries::userSeriesUpdate readQuery failed",{series:t,remove:a,newData:r}),console.warn("updateQueries::userSeriesUpdate",i)}try{r.userSeries.seriesSummaries=ua(r.userSeries.seriesSummaries,t,a),e.writeQuery({query:n,data:r}),console.log("updateQueries::userSeriesUpdate DONE")}catch(i){console.error("updateQueries::userSeriesUpdate writeQuery failed",{series:t,remove:a,newData:r}),console.error("updateQueries::userSeriesUpdate",i)}},ga=function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=oe,o={myFeed:{feed:[],window:null,__typename:"PaginatedSeries"}};try{var i=e.readQuery({query:r});o=ia.a.cloneDeep(i)}catch(l){console.warn("updateQueries::feedUpdate readQuery failed",{series:t,photo:a,remove:n,newData:o}),console.warn("updateQueries::feedUpdate",l)}try{o.myFeed.feed=function(e,t,a){var n=[];if(arguments.length>3&&void 0!==arguments[3]&&arguments[3])n=e.filter(function(e){return(!t||e.series.id!==t.id)&&(!a||e.photo.id!==a.id)});else{var r=e.findIndex(function(e){return e._id===a.id}),o=ia.a.pick(t,I);o.__typename="SeriesSummary";var i=ia.a.pick(a,C);i.__typename="PhotoSummary",r>-1?(n=Object(ra.a)(e))[r].photo=i:n=[].concat(Object(ra.a)(e),[{_id:i.id,series:o,photo:i,relation:"OWNED",__typename:"MyFeedResultItem"}])}return console.log("updateQueries::updateFeedList HELPER",{origArr:e,series:t,photo:a,newArr:n}),n}(o.myFeed.feed,t,a,n),e.writeQuery({query:r,data:o}),console.log("updateQueries::feedUpdate DONE")}catch(l){console.error("updateQueries::feedUpdate writeQuery failed",{series:t,photo:a,remove:n,newData:o}),console.error("updateQueries::feedUpdate",l)}},ha=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{var n=e.readFragment({id:t,fragment:T});console.log("updateQueries::watchUpdate watchers",{seriesFrag:n}),e.writeFragment({id:"5",fragment:v()(la()),data:{watchers:n.watchers+(a?-1:1)}})}catch(l){console.error("updateQueries::watchUpdate counter update failed",{seriesId:t,remove:a}),console.error("updateQueries::watchUpdate",l)}var r=ne;try{var o=e.readQuery({query:r}),i=ia.a.cloneDeep(o);i.user.watching=a?i.user.watching.filter(function(e){return e!==t}):Object(ra.a)(new Set([].concat(Object(ra.a)(i.user.watching||[]),[t]))),e.writeQuery({query:r,data:i}),console.log("updateQueries::watchUpdate DONE",a?"unwatch":"watch")}catch(l){console.error("updateQueries::watchUpdate read/write failed",{seriesId:t,remove:a}),console.error("updateQueries::watchUpdate",l)}},fa=Object(d.d)(jt,{props:function(e){var t=e.mutate,a=e.ownProps;return{createSeriesMutation:function(){var e=Object(s.a)(c.a.mark(function e(n,r,o){var i,l,s,u,m,d,p,g,h;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.user,l=i.id,s=i.gravatar,u=i.gravatarProfile,m=i.username,d={id:l,gravatar:s,gravatarProfile:u,username:m,__typename:"UserSummary"},n.access||(n.access="PRIVATE"),p={series:ia.a.pick(n,Ct),photo:ia.a.pick(r,St),ext:o},g=ya({meUserSummary:d,newSeries:n,newPhoto:r,ext:o}),e.next=7,Ca({variables:p,optimisticResponse:g},jt);case 7:return h=e.sent,console.log("createSeriesMutation:: start",{newSeries:n,newPhoto:r,variables:p,optimisticResponse:g,ext:o}),e.abrupt("return",t({variables:p,refetchQueries:[{query:X,variables:{limit:100}},{query:J},{query:oe}],optimisticResponse:g,update:ba({},a.doneCreatingSeries)}).then(function(e){return console.log("createSeriesMutation:: done",e),Na(h),e}));case 10:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}()}}}),ba=function(e,t){return function(e,a){var n=a.data;console.log("createSeriesMutation::updateThunk",{data:n}),ca(e,n.createSeries.series),pa(e,n.createSeries.series),ma(e,n.createSeries.series),ga(e,n.createSeries.series,n.createSeries.series.photos[0]),t&&t(n.createSeries.series.id)}},ya=function(e){var t=e.meUserSummary,a=e.newSeries,n=e.newPhoto,r=(e.ext,{id:n.id,meta:n.meta||null,seriesId:a.id,createdOn:Date.now().toString(),note:n.note||null,createdUser:t,updatedUser:t,createdBy:t.id,updatedBy:t.id,uploadToken:n.uploadToken,updatedOn:Date.now().toString(),seriesCreatedBy:t.id,takenOn:n.takenOn,coords:n.coords||null,tags:n.tags||[],paths:{base:null,large:null,orig:null,thumb:null,medium:null,__typename:"Paths"},__typename:"Photo"}),o=ia.a.pick(r,C);return{createSeries:{series:{id:a.id,name:a.name,note:a.note||null,access:a.access,meta:a.meta||null,featured:Object(u.a)({},o,{__typename:"PhotoSummary"}),latest:Object(u.a)({},o,{__typename:"PhotoSummary"}),seriesStatus:null,coords:a.coords||null,direction:a.direction||null,photoCount:1,createdUser:t,updatedUser:t,createdBy:t.id,updatedBy:t.id,createdOn:Date.now().toString(),updatedOn:Date.now().toString(),watchers:0,photos:[r],__typename:"Series"},preAuth:null,__typename:"NewSeries"}}},va={withMutation:fa,updateThunk:ba},Ea=a(116),wa=a.n(Ea);na.a.config({storeName:"MorPhoto",description:"image blobs"});var xa=na.a.createInstance({name:"imgStore"}),Oa=na.a.createInstance({name:"stateStore"}),ka="offlineMutations";function Sa(){return Oa.getItem(ka).then(function(e){return console.log("offline::getPendingPromise",JSON.parse(e)||[]),JSON.parse(e)||[]})}function ja(e){return console.log("offline::setPendingPromise",e),Oa.setItem(ka,JSON.stringify(e))}function Ca(e,t,a){var n=wa()();return Sa().then(function(r){return r.concat({id:n,params:e,mutation:t,context:a})}).then(function(e){return console.log("offline::pushMutationPromise",e),e}).then(ja).then(function(){return n})}function Na(e){return Sa().then(function(t){return t.filter(function(t){return t.id!==e})}).then(function(e){return console.log("offline::popMutationPromise",e),e}).then(ja)}function Ta(e,t){return function(a,n){return function(e,t){return console.log("offline::updateHandler",{resp:e,context:t}),e.data.createSeries?va.updateThunk(t):function(){}}(n,t)(a,n),n.data.__optimistic?Promise.resolve():Na(e)}}function Ia(e){return Sa().then(function(){var t=Object(s.a)(c.a.mark(function t(a){var n,r,o,i,l,s;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=0;case 1:if(!(n<a.length)){t.next=13;break}return r=a[n],console.log("offline::restoreRequests",a,r),o=r.id,i=r.params,l=r.mutation,s=r.context,i.optimisticResponse.__optimistic=!0,i.update=Ta(o,s),i.mutation=l,t.next=10,e.mutate(i).catch(function(e){console.error("Error replaying mutation",e)});case 10:n++,t.next=1;break;case 13:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())}var Pa=a(1043),za=a(951),Aa=a(469);Dt.a.configure(Kt);var _a="apollo-token",Ra={INITIALIZING:"Initializing",AUTHENTICATING:"Authenticating",LOADING:"Loading State",APPLY_MUTATIONS:"Applying history",ERROR:"ERROR!",DONE:"DONE"};var Ma=function(){var e=Object(n.useState)(null),t=Object(We.a)(e,2),a=t[0],r=t[1],o=Object(n.useState)(!1),i=Object(We.a)(o,2),l=i[0],c=i[1],s=Object(n.useState)(Ra.INITIALIZING),u=Object(We.a)(s,2),m=u[0],d=u[1];return Object(n.useEffect)(function(){!function(e){La.apply(this,arguments)}(function(e,t){console.log("createApolloClient::",t,e),r(e),c((a||e)&&t===Ra.DONE),d(t)})},[]),{client:a,done:l,currState:m}},Da=function(){var e=Object(s.a)(c.a.mark(function e(){var t;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Mt.Auth.currentSession();case 3:return t=e.sent,e.abrupt("return",t.accessToken.jwtToken);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",null);case 10:case"end":return e.stop()}},e,null,[[0,7]])}));return function(){return e.apply(this,arguments)}}();function La(){return(La=Object(s.a)(c.a.mark(function e(t){var a,n,r,o,i;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new Pa.a({}),e.prev=1,t(null,Ra.LOADING),e.next=5,Object(Aa.persistCache)({cache:a,storage:Oa});case 5:e.next=12;break;case 7:return e.prev=7,e.t0=e.catch(1),console.error("Error restoring Apollo cache",e.t0),t(null,Ra.ERROR),e.abrupt("return");case 12:return n=Object(_t.a)(function(){var e=Object(s.a)(c.a.mark(function e(t,a){var n,r,o;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.headers,e.next=3,Da();case 3:return r=e.sent,o=Object(u.a)({},n,{authorization:r?"Bearer ".concat(r):""}),e.abrupt("return",{headers:o});case 7:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}()),r=Object(At.a)({uri:Jt.graphql}),o=new Rt.a({attempts:{max:1/0,retryIf:function(e,t){return console.log("GRAPHQL ERRORS",{error:e,_operation:t}),!0}}}),console.log("Creating Apollo Client Client",Jt.graphql),i=new za.a({link:ta.a.from([o,n,r]),tokenName:_a,addTypename:!0,cache:a,connectToDevTools:!1}),t(null,Ra.APPLY_MUTATIONS),e.next=20,Ia(i);case 20:t(i,Ra.DONE);case 21:case"end":return e.stop()}},e,null,[[1,7]])}))).apply(this,arguments)}var Fa=a(13),Ba=a(240),Ua=a.n(Ba),Wa=a(124),Ga=a(1011),Ha=function(e){return{root:{},spacer:{flexGrow:1},forgotPassword:{width:"100%",textAlign:"right"},switch:{},switchButton:{flexGrow:1,"&:last-child":{borderRadius:0},"&:first-child":{borderRadius:0}},phoneNumInner:{marginTop:e.spacing(1),display:"flex"},phoneNumDropdown:{margin:e.spacing(1),minWidth:120},warnText:{marginTop:e.spacing(2),fontStyle:"italic"},noSignin:{margin:e.spacing(2,0),padding:e.spacing(1),textAlign:"left",border:"1px solid #00000022",background:"#0000000F"}}},qa=Object(je.a)(Ha),Qa=function(e){var t=e.loading,a=e.handleSignup,n=(e.federated,e.handleForgotPassword),o=e.handleInputChange,i=e.handleBeAnonymous,l=e.handleSignIn,c=(Object(m.a)(e,["loading","handleSignup","federated","handleForgotPassword","handleInputChange","handleBeAnonymous","handleSignIn"]),qa());return r.a.createElement(_e,null,r.a.createElement(Ve.a,{id:"username",fullWidth:!0,key:"username",name:"username",label:"Username",color:"inherit",autoFocus:!0,className:c.textField,margin:"normal",onChange:o}),r.a.createElement(Ve.a,{fullWidth:!0,id:"password",label:"Password",color:"inherit",key:"password",name:"password",type:"password",className:c.textField,autoComplete:"current-password",margin:"normal",onChange:o}),r.a.createElement(Ga.a,{disableGutters:!0},r.a.createElement(He.a,{component:"button",color:"secondary",variant:"contained",disabled:t,onClick:a},"New Account"),r.a.createElement("div",{className:c.spacer}),r.a.createElement(He.a,{className:"enterAction",component:"button",color:"primary",variant:"contained",disabled:t,onClick:l},"Sign In")),r.a.createElement(He.a,{color:"primary",onClick:n,size:"small"},"Forgot Password"),r.a.createElement("div",{className:c.noSignin},r.a.createElement(He.a,{fullWidth:!0,size:"small",variant:"outlined",onClick:i,color:"inherit"},"Continue without logging in"),r.a.createElement(ke.a,{variant:"caption",className:c.warnText,color:"textSecondary",component:"div"},"You will not be able to add content and many features will be unavailable.")))},Ya=Object(je.a)(Ha),$a=function(e){var t=e.handleInputChange,a=e.handleBack,n=e.handleConfirm,o=Ya();return r.a.createElement(_e,null,r.a.createElement(Ve.a,{id:"mfaCode",fullWidth:!0,autoFocus:!0,label:"MFA Code",name:"code",className:o.textField,margin:"normal",onChange:t}),r.a.createElement(Ga.a,{disableGutters:!0},r.a.createElement(He.a,{color:"secondary",variant:"contained",onClick:a},"Back"),r.a.createElement("div",{className:o.spacer}),r.a.createElement(He.a,{className:"enterAction",color:"primary",variant:"contained",onClick:n},"Confirm")))},Va=Object(je.a)(Ha),Xa=function(e){var t=e.change,a=e.requiredAttributes,n=e.placeholders,o=e.handleInputChange,i=Va();return r.a.createElement(_e,null,r.a.createElement(ke.a,null,"A new password is required"),r.a.createElement(Ve.a,{id:"newassword",fullWidth:!0,autoFocus:!0,label:"New Password",className:i.textField,type:"password",autoComplete:"new-password",margin:"normal",onChange:o}),a.map(function(e,t){return r.a.createElement(Ve.a,{fullWidth:!0,key:e,name:e,className:i.textField,placeholder:n[t],type:"text",margin:"normal",onChange:o})}),r.a.createElement(Ga.a,{disableGutters:!0},r.a.createElement(He.a,{color:"secondary",variant:"contained"},"Back"),r.a.createElement("div",{className:i.spacer}),r.a.createElement(He.a,{color:"primary",variant:"contained",onClick:t,className:"enterAction"},"Change")))},Za=a(999),Ja=a(1e3),Ka=a(1036),en=Object(je.a)(Ha),tn=function(e){var t=e.handleInputChange,a=e.signUpFields,o=e.signUpFieldLabels,i=e.signUpFieldPlaceholders,l=e.handleSignup,c=e.handleBack,s=e.countryDialCodes,u=e.defaultDialCode;console.log("SIGNUPPROPS",{defaultDialCode:u,countryDialCodes:s,signUpFields:a,signUpFieldLabels:o,signUpFieldPlaceholders:i});var m=Object(n.useState)(u),d=Object(We.a)(m,2),p=d[0],g=d[1],h=en(),f=function(e){t(e),g(e.target.value)};return r.a.createElement(_e,null,a.map(function(e,n){return"phone_number"!==e.key?r.a.createElement(Ve.a,{fullWidth:!0,autoFocus:0===a.findIndex(function(t){return t.key===e.key}),type:e.type,name:e.key,key:e.key,placeholder:i[n],label:o[n],className:h.textField,margin:"normal",onChange:t}):r.a.createElement(Za.a,{className:h.phoneNumDropdown,fullWidth:!0,key:"phonenum"},r.a.createElement(Ja.a,{htmlFor:"dial_code",shrink:!0},o[n],e.required?"*":""),r.a.createElement("div",{className:h.phoneNumInner},r.a.createElement(Ka.a,{value:p,onChange:f,inputProps:{name:"dial_code",id:"dial_code"}},s.map(function(e){return r.a.createElement("option",{key:e,value:e},e)})),r.a.createElement(Ve.a,{placeholder:i[n],type:"tel",fullWidth:!0,id:"phone_line_number",key:"phone_line_number",name:"phone_line_number",onChange:t})))}),r.a.createElement(Ga.a,{disableGutters:!0},r.a.createElement(He.a,{color:"secondary",variant:"outlined",onClick:c},"Back"),r.a.createElement("div",{className:h.spacer}),r.a.createElement(He.a,{className:"enterAction",component:"button",color:"primary",variant:"contained",onClick:l},"Create Account")))},an=a(1012),nn=Object(je.a)(Ha),rn=function(e){var t=e.handleInputChange,a=e.handleBack,n=e.handleResend,o=e.handleConfirm,i=nn();return r.a.createElement(_e,null,r.a.createElement(Ve.a,{id:"username",fullWidth:!0,autoFocus:!0,name:"username",label:"Username",className:i.textField,margin:"normal",onChange:t}),r.a.createElement(Ve.a,{id:"confirmationCode",fullWidth:!0,name:"code",label:"Confirmation Code",className:i.textField,margin:"normal",onChange:t}),r.a.createElement(an.a,{component:"button",variant:"body2",className:i.resendCode,onClick:n},"Resend Code"),r.a.createElement(Ga.a,{disableGutters:!0},r.a.createElement(He.a,{color:"secondary",variant:"outlined",onClick:a},"Back"),r.a.createElement("div",{className:i.spacer}),r.a.createElement(He.a,{color:"primary",variant:"contained",className:"enterAction",onClick:o},"Sign In")))},on=Object(je.a)(Ha),ln=function(e){var t=e.handleSubmit,a=e.handleInputChange,o=e.handleSendCode,i=e.handleBack,l=Object(n.useState)(!1),c=Object(We.a)(l,2),s=c[0],u=c[1],m=on();return r.a.createElement(_e,null,r.a.createElement(ke.a,null,"Forgot Password"),!s&&r.a.createElement(Ve.a,{id:"username",autoFocus:!0,fullWidth:!0,label:"Username",name:"username",className:m.textField,margin:"normal",onChange:a}),s&&r.a.createElement(Ve.a,{id:"changecode",fullWidth:!0,autoFocus:!0,label:"Code",name:"code",className:m.textField,margin:"normal",onChange:a}),s&&r.a.createElement(Ve.a,{id:"newpassword",fullWidth:!0,label:"New Password",className:m.textField,type:"password",name:"password",autoComplete:"current-password",margin:"normal",onChange:a}),s&&r.a.createElement(an.a,{component:"button",variant:"body2",className:m.resendCode,onClick:o},"Resend Code"),r.a.createElement(Ga.a,{disableGutters:!0},r.a.createElement(He.a,{color:"secondary",variant:"outlined",onClick:function(){s?u(!1):i()}},"Back"),r.a.createElement("div",{className:m.spacer}),!s&&r.a.createElement(He.a,{color:"primary",variant:"contained",className:"enterAction",onClick:function(){u(!0),o()}},"Send Code"),s&&r.a.createElement(He.a,{className:"enterAction",color:"primary",variant:"contained",onClick:t},"Submit")))};Dt.a.configure(Kt);var cn={authState:"init",authData:{},signedIn:null},sn=function(){var e=Object(n.useState)(cn),t=Object(We.a)(e,2),a=t[0],o=a.authState,i=a.authData,l=a.signedIn,u=t[1],m=function(){var e=Object(s.a)(c.a.mark(function e(){var t;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Mt.Auth.currentSession();case 2:return t=e.sent,console.log("here",t.accessToken),e.abrupt("return",t&&t.accessToken?t.accessToken:null);case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),d=l?null:r.a.createElement(Wa.Authenticator,{onStateChange:function(e,t){u({authState:e,authData:t,signedIn:e&&0!==e.length?"signedIn"===e||l:null})},hideDefault:!0},r.a.createElement(un,{handleBeAnonymous:function(){u({authState:o,authData:i,signedIn:!1})}}),r.a.createElement(hn,{message:"Loggin in"}),r.a.createElement(gn,null),r.a.createElement(dn,null),r.a.createElement(pn,null),r.a.createElement(Wa.VerifyContact,null),r.a.createElement(fn,null),r.a.createElement(mn,null)),p=!1;try{p=i.signInUserSession.idToken.payload["cognito:groups"].indexOf("GodUsers")>-1}catch(g){}return{authState:o,authData:i,isGod:p,signOut:function(){return Mt.Auth.signOut().then(function(e){return console.log(e)}).catch(function(e){return console.log(e)})},getCurrentToken:m,forceSignIn:function(){return u(cn)},signedIn:l,authScreen:d}},un=function(e){function t(){return Object(Me.a)(this,t),Object(Le.a)(this,Object(Fe.a)(t).apply(this,arguments))}return Object(Be.a)(t,e),Object(De.a)(t,[{key:"showComponent",value:function(){var e=this,t=this.state.loading,a=Object(u.a)({},this.props,{loading:t,handleForgotPassword:function(){return e.changeState("forgotPassword")},handleSignup:function(){return e.changeState("signUp")},handleInputChange:this.handleInputChange,handleSignIn:this.signIn});return r.a.createElement(Qa,a)}}]),t}(Wa.SignIn),mn=function(e){function t(){return Object(Me.a)(this,t),Object(Le.a)(this,Object(Fe.a)(t).apply(this,arguments))}return Object(Be.a)(t,e),Object(De.a)(t,[{key:"showComponent",value:function(){var e=this,a=this.props.hide;if(a&&a.includes(t))return null;this.checkCustomSignUpFields()&&(this.signUpFields=this.props.signUpConfig.signUpFields),this.sortFields();var n=Object(u.a)({},this.props,{countryDialCodes:Ua.a,defaultDialCode:this.getDefaultDialCode(),handleInputChange:this.handleInputChange,signUpFields:this.signUpFields,signUpFieldLabels:this.signUpFields.map(function(e){return Fa.I18n.get(e.label)}),signUpFieldPlaceholders:this.signUpFields.map(function(e){return Fa.I18n.get(e.placeholder)}),handleSignup:this.signUp,handleBack:function(){return e.changeState("signIn")}});return r.a.createElement(tn,n)}}]),t}(Wa.SignUp),dn=function(e){function t(){return Object(Me.a)(this,t),Object(Le.a)(this,Object(Fe.a)(t).apply(this,arguments))}return Object(Be.a)(t,e),Object(De.a)(t,[{key:"showComponent",value:function(){var e=this,t=Object(u.a)({},this.props,{handleBack:function(){return e.changeState("signIn")},handleInputChange:this.handleInputChange,handleConfirm:this.confirm});return r.a.createElement($a,t)}}]),t}(Wa.ConfirmSignIn),pn=function(e){function t(){return Object(Me.a)(this,t),Object(Le.a)(this,Object(Fe.a)(t).apply(this,arguments))}return Object(Be.a)(t,e),Object(De.a)(t,[{key:"showComponent",value:function(){var e=this,t=Object(u.a)({},this.props,{handleBack:function(){return e.changeState("signIn")},handleInputChange:this.handleInputChange,handleConfirm:this.confirm,handleResend:this.resend});return r.a.createElement(rn,t)}}]),t}(Wa.ConfirmSignUp),gn=function(e){function t(){return Object(Me.a)(this,t),Object(Le.a)(this,Object(Fe.a)(t).apply(this,arguments))}return Object(Be.a)(t,e),Object(De.a)(t,[{key:"showComponent",value:function(){var e=this.props.authData.challengeParam.requiredAttributes,t=Array.isArray(e)?e.map(function(e){return Fa.I18n.get(e.split("_").map(function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}).join(" "))}):[],a=Object(u.a)({},this.props,{handleInputChange:this.handleInputChange,requiredAttributes:e,placeholders:t,change:this.change});return r.a.createElement(Xa,a)}}]),t}(Wa.RequireNewPassword),hn=function(e){function t(){return Object(Me.a)(this,t),Object(Le.a)(this,Object(Fe.a)(t).apply(this,arguments))}return Object(Be.a)(t,e),Object(De.a)(t,[{key:"showComponent",value:function(){return r.a.createElement(Re,this.props)}}]),t}(Wa.Loading),fn=function(e){function t(){return Object(Me.a)(this,t),Object(Le.a)(this,Object(Fe.a)(t).apply(this,arguments))}return Object(Be.a)(t,e),Object(De.a)(t,[{key:"showComponent",value:function(){var e=this,t=Object(u.a)({},this.props,{handleBack:function(){return e.changeState("signIn")},handleInputChange:this.handleInputChange,handleConfirm:this.confirm,handleResend:this.send,handleSubmit:this.submit,handleSendCode:this.send});return r.a.createElement(ln,t)}}]),t}(Wa.ForgotPassword);var bn=function(){var e=Object(n.useState)({accuracy:null,altitude:null,altitudeAccuracy:null,heading:null,latitude:null,longitude:null,speed:null,timestamp:Date.now()}),t=Object(We.a)(e,2),a=t[0],r=t[1],o=Object(n.useRef)(),i=Object(n.useRef)();o.current=!0;var l=function(e){o.current&&r({accuracy:e.coords.accuracy,altitude:e.coords.altitude,altitudeAccuracy:e.coords.altitudeAccuracy,heading:e.coords.heading,latitude:e.coords.latitude,longitude:e.coords.longitude,speed:e.coords.speed,timestamp:e.timestamp})};return Object(n.useEffect)(function(){return navigator.geolocation.getCurrentPosition(l),i.current=navigator.geolocation.watchPosition(l),function(){o.current=!1,navigator.geolocation.clearWatch(i.current)}},[navigator.geolocation]),a};var yn=function(){return/iphone|ipad|ipod/i.test(window.navigator.userAgent||navigator.vendor||window.opera||"")},vn=function(){var e=window.navigator.userAgent||navigator.vendor||window.opera||"";return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(e.substr(0,4))},En=a(1045),wn=a(992),xn=Object(je.a)(function(e){return{root:{},content:{},messageWrapper:{display:"flex"},logo:{height:50,width:50},paper:{background:e.palette.text.primary,color:e.palette.primary.contrastText,border:"2px solid ".concat(e.palette.primary.contrastText),boxShadow:"0 0 0 0 ".concat(e.palette.primary.main),animation:"$installPulse 2s infinite",padding:e.spacing(2,3),width:"100%"},"@keyframes installPulse":{"0%":{boxShadow:"0 0 0 0px ".concat(e.palette.primary.main)},"50%":{boxShadow:"0 0 0 0px ".concat(e.palette.primary.main)},"100%":{boxShadow:"0 0 0 20px transparent"}},textWrapper:{flexGrow:1,paddingLeft:e.spacing(1)},buttons:{display:"flex"},spacer:{flexGrow:1}}}),On=function(e){var t=e.open,a=e.onClose,n=e.onInstall,o=xn();return r.a.createElement(En.a,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:t,onClose:a},r.a.createElement(wn.a,{className:o.paper,elevation:24},r.a.createElement("div",{id:"client-snackbar",className:o.messageWrapper},r.a.createElement(Pe,{className:o.logo}),r.a.createElement("div",{className:o.textWrapper},r.a.createElement(ke.a,{variant:"body1",color:"inherit"},"Install MorPhoto"),r.a.createElement(ke.a,{variant:"body2",color:"inherit",paragraph:!0},"This app can be installed and used on your device natively and offline if you would like."),r.a.createElement("div",{className:o.buttons},r.a.createElement(He.a,{color:"secondary",variant:"contained",onClick:a},"No thanks"),r.a.createElement("div",{className:o.spacer}),r.a.createElement(He.a,{color:"primary",variant:"contained",onClick:n},"Install"))))))},kn=function(e,t){var a=Object(n.useState)(null),o=Object(We.a)(a,2),i=o[0],l=o[1],c=function(e){e.preventDefault(),l(e)},s=Object(n.useMemo)(function(){return e&&i?r.a.createElement(On,{open:!0,onClose:t,onInstall:u}):null},[e,i]);function u(){i.prompt(),i.userChoice.then(function(e){"accepted"===e.outcome?(console.log("User accepted the A2HS prompt"),t()):(console.log("User dismissed the A2HS prompt"),t()),l(null)})}return Object(n.useEffect)(function(){return!yn()||"standalone"in window.navigator&&window.navigator.standalone||console.log("I AM on IOS and I am NOT in standalone mode."),window.addEventListener("beforeinstallprompt",c),function(){window.removeEventListener("beforeinstallprompt",c)}},[]),{installPrompt:s,addToHomeScreen:s?u:null}},Sn=function(){var e=Object(n.useState)(null),t=Object(We.a)(e,2),a=t[0],r=t[1],o=function(e){if(window.navigator.onLine)console.log("ONLINE",e),r(null);else{console.log("OFFLINE",e);var t=Date.now();r(t)}};return Object(n.useEffect)(function(){return o(),window.addEventListener("online",o),window.addEventListener("offline",o),function(){window.removeEventListener("online",o),window.removeEventListener("offline",o)}},[]),{online:null===a,offlineSince:a}},jn=a(66),Cn=function(e){var t=window,a=t.orientation,n=t.innerWidth,r=t.innerHeight,o=t.screen,i=o.width,l=o.height,c=0!==[90,270].indexOf(a)?"portrait":"landscape",s={width:n,height:r},u={width:i,height:l};return e&&["input","textarea"].indexOf(window.document.activeElement.tagName.toLowerCase())>-1&&(console.log("preserving height"),s.height=e.windowSize.height),{orientation:c,windowSize:s,screenSize:u}},Nn=function(e){var t=Object(n.useState)(Cn()),a=Object(We.a)(t,2),r=a[0],o=a[1],i=Object(n.useCallback)(Object(jn.a)(function(e){console.log("resizing"),e&&(e.preventDefault(),e.stopPropagation());var t=Cn(r);t.screenSize.height!==r.screenSize.height&&o(t)},500),[]);return Object(n.useLayoutEffect)(function(){return i(),window.addEventListener("resize",i),function(){window.removeEventListener("resize",i)}},[]),r},Tn=a(472),In=a(78),Pn=a(322),zn="HOME_CHANGE_STATE",An="HOME_CHANGE_ACTIVE_SERIES",_n="HOME_STATE_BACK",Rn="MAP_HISTORY_POP",Mn="MAP_HISTORY_PUSH",Dn="MAP_HISTORY_CLEAR",Ln="UPLOADER_START",Fn="UPLOADER_COMPLETE",Bn="UPLOADER_UPDATE_PROGRESS",Un="OFFLINE_VIEWPORT_SAVE",Wn="OFFLINE_SET_STATUS",Gn="SETFLAG",Hn="RESET_ALL_STATE",qn=function(e,t){return{type:zn,data:{newDomain:e,params:t}}},Qn=function(){return{type:_n}},Yn=function(e,t){return{type:An,data:{seriesId:e,initialPhoto:t}}},$n=function(e,t){return{type:Gn,data:{flagName:e,flagVal:t}}},Vn=function(e){return{type:Un,data:e}},Xn=function(e){return{type:Wn,data:e}},Zn=function(){return{type:Rn}},Jn=function(e){return{type:Mn,data:e}},Kn=function(){return{type:Dn}},er=function(){return{type:Hn}},tr=function(e){return{type:Ln,data:e}},ar=function(){return{type:Fn}},nr=function(e){return{type:Bn,data:e}},rr=[{mode:Zt.MapModeTypes.FREE,viewport:{latitude:36.80191008366581,longitude:-111.63999999999784,zoom:11}}],or={history:[],current:{domain:Zt.AppStateTypes.FEED}},ir={store:[],activeUpload:null},lr=a(73),cr={iOSWarning:yn(),install:!0,useLoggedOut:!1},sr={completedDownload:!1,viewport:null},ur=Object(In.combineReducers)({map:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:rr,t=arguments.length>1?arguments[1]:void 0,a=t.type,n=t.data;switch(a){case Dn:return e.length>0?[[e.length-1]]:[];case Rn:return e.slice(0,-1);case Mn:return[].concat(Object(ra.a)(e),[n]).slice(-10);default:return e}},home:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:or,t=arguments.length>1?arguments[1]:void 0,a=t.type,n=t.data,r=e.history,o=e.current;switch(a){case _n:var i=Object(ra.a)(r),l=i.length>0?i.pop():or.current;return Object(u.a)({},e,{current:l,history:i});case An:var c=o.activeSeries,s=o.initialPhoto;return Object(u.a)({},e,{history:r,current:Object(u.a)({},o,{activeSeries:c||null,initialPhoto:c&&s?s:null})});case zn:var m=n.newDomain,d=n.params||{},p=[Zt.AppStateTypes.QRCAPTURE,Zt.AppStateTypes.SETTINGS,Zt.AppStateTypes.OFFLINE_DOWNLOAD,Zt.AppStateTypes.NEW_SERIES_CAMERA,Zt.AppStateTypes.NEW_SERIES_LIBRARY].indexOf(o.domain)>-1,g=o.domain===m,h=p||g?r:[].concat(Object(ra.a)(r),[o]).slice(-10);return Object(u.a)({},e,{history:h,current:Object(u.a)({},o,{domain:m},d)});default:return e}},uploader:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ir,t=arguments.length>1?arguments[1]:void 0,a=t.type,n=t.data,r=e.store,o=e.activeUpload;switch(a){case Ln:return o?Object(u.a)({},e,{store:[].concat(Object(ra.a)(r),[n])}):Object(u.a)({},e,{activeUpload:n});case Fn:if(0===r.length)return Object(u.a)({},e,{activeUpload:null});var i=Object(ra.a)(r),l=i.pop();return Object(u.a)({},e,{store:i,activeUpload:l});case Bn:return Object(u.a)({},e,{activeUpload:Object(u.a)({},o,n)});default:return e}},flags:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:cr,t=arguments.length>1?arguments[1]:void 0,a=t.type,n=t.data;switch(a){case Gn:var r=n.flagName,o=n.flagVal;return Object(u.a)({},e,Object(lr.a)({},r,o));default:return e}},offline:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sr,t=arguments.length>1?arguments[1]:void 0,a=t.type,n=t.data;switch(a){case Un:return Object(u.a)({},e,{viewport:n});case Wn:return Object(u.a)({},e,{completedDownload:n});default:return e}}}),mr=function(e,t){return"RESET_ALL_STATE"===t.type&&(e=void 0),ur(e,t)},dr=a(326),pr={key:"root",storage:Oa},gr=Object(dr.a)(pr,mr),hr=function(){var e,t=Object(In.createStore)(gr,e,Object(In.compose)(Object(In.applyMiddleware)(Pn.a)));return{store:t,persistor:Object(dr.b)(t)}},fr=function(e){return function(t){var a=hr(),n=a.store,o=a.persistor;return r.a.createElement(Ge.a,{store:n},r.a.createElement(Tn.a,{loading:r.a.createElement(Re,null),persistor:o},r.a.createElement(e,t)))}},br=a(14),yr=a.n(br),vr=a(1014),Er=Object(je.a)(function(e){return{root:{background:"black",color:e.palette.primary.contrastText,padding:2*e.spacing(1)},message:{},msgText:{display:"flex"},spacer:{flexGrow:1},messageInner:{}}}),wr=function(e){var t=e.className,a=e.text,n=e.progress,o=Er();if(!a)return null;var i="Uploading: ".concat(a);return r.a.createElement("div",{className:yr()(o.root,t)},r.a.createElement("div",{className:o.messageInner},r.a.createElement("div",{className:o.msgText},r.a.createElement(ke.a,{color:"inherit"},i),r.a.createElement("div",{className:o.spacer}),r.a.createElement(ke.a,{color:"inherit"},n,"%")),r.a.createElement(vr.a,{color:"secondary",variant:"determinate",value:n})))},xr=wr,Or=function(e){var t=e.text,a=e.progress,n=kr();return r.a.createElement("div",{className:n.root},r.a.createElement(Se.a,null)," ",r.a.createElement(wn.a,{className:n.paper},r.a.createElement(ke.a,{variant:"h5"},"This is a dummy component.")),r.a.createElement(wr,{text:t,progress:a}))},kr=Object(je.a)(function(e){return{root:{height:"100%",display:"flex",flexDirection:"column"},paper:{flexGrow:1}}});Or.displayName=wr.displayName;var Sr=a(210),jr=a.n(Sr),Cr=a(473),Nr=a.n(Cr);function Tr(){return(Tr=Object(s.a)(c.a.mark(function e(t,a,n,r){var o,i,l,s;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("doUpload:: upload start",t),o=new Nr.a,Object.keys(t.preAuth.fields).forEach(function(e){console.log("doUpload::append:: ".concat(e,": ").concat(t.preAuth.fields[e].substring(0,50))),o.append(e,t.preAuth.fields[e])}),e.next=5,xa.getItem(t.uploadToken);case 5:return i=e.sent,l=Ir(i.dataUrl,i.name),o.append("file",l),s={headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(e){var t=e.loaded,n=e.total;console.log("doUpload::PROGRESSEVENT",t,n,Math.floor(100*t/n)),a({progress:Math.floor(100*t/n)})}},console.log("doUpload::FORMDATA",{formData:o,config:s}),e.next=12,jr.a.post(t.preAuth.url,o,s).catch(function(e){console.error("doUpload::ERROR"),console.error(e),console.log(e.stack),r(t)});case 12:return e.t0=console,e.next=15,xa.keys();case 15:return e.t1=e.sent,e.t0.log.call(e.t0,"doUpload:: upload done. cleaning up imgStore",e.t1),e.next=19,xa.removeItem(t.uploadToken);case 19:return e.t2=console,e.next=22,xa.keys();case 22:e.t3=e.sent,e.t2.log.call(e.t2,"doUpload:: Cleaned up img store",e.t3),n();case 25:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Ir(e,t){for(var a=e.split(","),n=a[0].match(/:(.*?);/)[1],r=atob(a[1]),o=r.length,i=new Uint8Array(o);o--;)i[o]=r.charCodeAt(o);return new File([i],t,{type:n})}jr.a.interceptors.request.use(function(e){return console.log("AXIOS:::: Starting Request",e),e},function(e){return console.log("AXIOS:::: Starting Request ERROR",e),Promise.reject(e)}),jr.a.interceptors.response.use(function(e){return console.log("AXIOS:::: Response",e),e},function(e){return console.log("AXIOS:::: Starting Response ERROR",e),Promise.reject(e)});var Pr=Object(d.d)(ce,{skip:function(e){var t=e.online,a=e.qItem;return!t||!a},props:function(e){var t=e.data,a=e.ownProps;return t.error&&console.error(t.error),console.log("getWholeSeries:: ",{data:t}),t.loading||a.onDone(Object(u.a)({},a.qItem,{retry:a.qItem.retry+1,preAuth:JSON.parse(t.s3Credentials)})),{data:t}},options:function(e){var t=e.qItem;return{variables:{seriesId:t.seriesId,photoId:t.id,ext:t.ext}}}})(function(){return null}),zr=Object(Ge.b)(function(e,t){return{activeUpload:e.uploader.activeUpload}},function(e){return{completeActiveUpload:function(){e(ar())},updateUploadProgress:function(t){e(nr(t))}}})(function(e){var t=e.activeUpload,a=e.completeActiveUpload,o=e.updateUploadProgress,i=Object(m.a)(e,["activeUpload","completeActiveUpload","updateUploadProgress"]),l=Object(n.useRef)(),c=Object(n.useState)(),s=Object(We.a)(c,2),u=s[0],d=s[1],p=Object(n.useContext)(Oe).online;l.current=t?"".concat(t.id,"__retry").concat(t.retry):null;var g=Object(n.useMemo)(function(){return r.a.createElement(Pr,{onDone:o,qItem:u})},[u]);return Object(n.useEffect)(function(){console.log("UPLOADDEBUG::::",{uploadingRef:l,activeUpload:t,online:p}),p&&t&&l.current&&function(e,t,a,n){Tr.apply(this,arguments)}(t,o,a,d)},[l.current]),t?r.a.createElement(r.a.Fragment,null,g,r.a.createElement(xr,Object.assign({text:"Uploading thing",progress:t.progress||0},i))):null}),Ar={admin:{series:{"create:own":["*"],"read:any":["*"],"update:any":["*"],"delete:any":["*"]},photo:{"create:any":["*"],"read:any":["*"],"update:any":["*"],"delete:any":["*"]}},nonuser:{photo:{"read:any":["*"],"update:any":["*"],"delete:any":["*"]},series_public:{"read:any":["*"]},series_open:{"read:any":["*"]}},user:{series:{"create:own":["*"],"read:own":["*"],"update:own":["*"],"delete:own":["*"]},series_public:{"read:any":["*"]},series_open:{"read:any":["*"],"update:any":["photos"]},photo:{"read:any":["*"],"create:own":["*"],"update:own":["*"],"delete:own":["*"]}}},_r=Object(d.d)(vt,{props:function(e){var t=e.mutate,a=e.ownProps;return{deleteSeriesMutation:function(){var e=Object(s.a)(c.a.mark(function e(){var n,r,o;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={id:a.activeSeries},r={deleteSeries:a.activeSeries},e.next=4,Ca({variables:n,optimisticResponse:r},vt);case 4:return o=e.sent,e.abrupt("return",t({variables:n,refetchQueries:[{query:X,variables:{limit:100}},{query:J},{query:oe}],optimisticResponse:r,update:Rr()}).then(function(e){return console.log("deleteSeriesMutation:: done",{data:e,mutationStackId:o}),Na(o),e}));case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}}}),Rr=function(e,t){return function(e,a){var n=a.data;console.log("deleteSeriesMutation::updateThunk",{data:n}),pa(e,n.deleteSeries,!0),ma(e,{id:n.deleteSeries},!0),ga(e,{id:n.deleteSeries},null,!0),t&&t(n.createSeries.series.id)}},Mr={withMutation:_r,updateThunk:Rr},Dr=Object(d.d)(Et,{props:function(e){var t=e.mutate,a=e.ownProps;return{updateSeriesMutation:function(){var e=Object(s.a)(c.a.mark(function e(n,r){var o,i,l,s,u,m,d,p,g;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=a.user,i=o.id,l=o.gravatar,s=o.gravatarProfile,u=o.username,m={id:i,gravatar:l,gravatarProfile:s,username:u,__typename:"UserSummary"},d={series:ia.a.pick(r,wt)},p=Fr({meUserSummary:m,series:n,seriesDelta:r}),e.next=6,Ca({variables:d,optimisticResponse:p},Et);case 6:return g=e.sent,e.abrupt("return",t({variables:d,optimisticResponse:p,update:Lr({series:n})}).then(function(e){return console.log("updateSeriesMutation:: done",e),Na(g),e}));case 8:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}()}}}),Lr=function(e,t){return function(t,a){var n=a.data;console.log("updateThunk",{context:e,data:n}),ca(t,n.updateSeries),ma(t,n.updateSeries),ga(t,n.updateSeries.series,e.series.photos[0])}},Fr=function(e){var t=e.meUserSummary,a=e.series,n=e.seriesDelta;return{updateSeries:Object(u.a)({},a,n,{updatedUser:t,updatedBy:t.id,__typename:"Series"})}},Br={withMutation:Dr,updateThunk:Lr},Ur=Object(d.d)(yt,{props:function(e){var t=e.mutate,a=e.ownProps;return{deletePhotoMutation:function(){var e=Object(s.a)(c.a.mark(function e(n){var r,o,i;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={seriesId:a.series.id,photoId:n},o={deletePhoto:n},e.next=4,Ca({variables:r,optimisticResponse:o},yt);case 4:return i=e.sent,e.abrupt("return",t({variables:r,optimisticResponse:o,update:Wr({series:a.series})}).then(function(e){return console.log("deletePhotoMutation:: done",e),Na(i),e}));case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}}}),Wr=function(e,t){return function(t,a){var n=a.data;console.log("updateThunk",{context:e,data:n}),da(t,null,{id:n.deletePhoto},!0),sa(t,{id:n.deletePhoto,seriesId:e.series.id},!0),ga(t,e.series,{id:n.deletePhoto,seriesId:e.series.id},!0)}},Gr={withMutation:Ur,updateThunk:Wr},Hr=Object(d.d)(kt,{props:function(e){var t=e.mutate,a=e.ownProps;return{createPhotoMutation:function(){var e=Object(s.a)(c.a.mark(function e(n,r,o){var i,l,s,u,m,d,p,g,h,f;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return!(i=ia.a.cloneDeep(r)).seriesId&&a.activeSeries&&(i.seriesId=a.activeSeries),l=a.user,s=l.id,u=l.gravatar,m=l.gravatarProfile,d=l.username,p={id:s,gravatar:u,gravatarProfile:m,username:d,__typename:"UserSummary"},g={photo:ia.a.pick(i,St),ext:o},h=Qr({meUserSummary:p,series:n,newPhoto:r,ext:o}),e.next=8,Ca({variables:g,optimisticResponse:h},kt);case 8:return f=e.sent,e.abrupt("return",t({variables:g,optimisticResponse:h,update:qr({series:n})}).then(function(e){return console.log("createPhotoMutation:: done",e),Na(f),e}));case 10:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}()}}}),qr=function(e,t){return function(t,a){var n=a.data;console.log("updateThunk",{context:e,data:n}),sa(t,n.createPhoto.photo),da(t,e.series,n.createPhoto.photo),ga(t,e.series,n.createPhoto.photo)}},Qr=function(e){var t=e.meUserSummary,a=e.series,n=e.newPhoto;e.ext;return{createPhoto:{photo:{id:n.id,meta:n.meta||null,seriesId:a.id,note:n.note,createdOn:Date.now().toString(),createdUser:t,updatedUser:t,createdBy:t.id,updatedBy:t.id,uploadToken:n.uploadToken,updatedOn:Date.now().toString(),seriesCreatedBy:a.createdUser.id,takenOn:n.takenOn,coords:n.coords||null,tags:n.tags||[],paths:{base:null,large:null,orig:null,thumb:null,medium:null,__typename:"Paths"},__typename:"Photo"},preAuth:null,__typename:"NewPhoto"}}},Yr={withMutation:Hr,updateThunk:qr},$r=Object(d.d)(xt,{props:function(e){var t=e.mutate,a=e.ownProps;return{updatePhotoMutation:function(){var e=Object(s.a)(c.a.mark(function e(n,r,o){var i,l,s,u,m,d,p,g,h;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(i=ia.a.pick(o,Ot)).tags&&i.tags.length>0&&(i.tags=i.tags.map(function(e){var t=ia.a.pick(e,["label","typeId","coords"]);return t.coords&&(t.coords=ia.a.pick(t.coords,["x","y"])),t})),l=a.user,s=l.id,u=l.gravatar,m=l.gravatarProfile,d=l.username,p={photo:i},g=Xr({meUserSummary:{id:s,gravatar:u,gravatarProfile:m,username:d,__typename:"UserSummary"},newUpdatePhoto:i,photoDelta:o}),e.next=8,Ca({variables:p,optimisticResponse:g},xt);case 8:return h=e.sent,console.log("optimisticresponse",g),e.abrupt("return",t({variables:p,optimisticResponse:g,update:Vr({photo:r,series:n})}).then(function(e){return console.log("updatePhotoMutation:: done",e),Na(h),e}));case 11:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}()}}}),Vr=function(e,t){return function(a,n){var r=n.data;console.log("updateThunk",{context:e,data:r}),sa(a,Object(u.a)({},e.photo,r.updatePhoto)),da(a,e.series,Object(u.a)({},e.photo,r.updatePhoto)),ga(a,e.series,Object(u.a)({},e.photo,r.updatePhoto)),t&&t(r.createSeries.series.id)}},Xr=function(e){var t=e.meUserSummary,a=e.photo,n=e.photoDelta;return{updatePhoto:Object(u.a)({},a,n,{updatedUser:t,updatedBy:t.id,__typename:"Photo"})}},Zr={withMutation:$r,updateThunk:Vr},Jr=Object(d.d)(Nt,{props:function(e){var t=e.mutate,a=e.ownProps;return{watchSeriesMutation:function(){var e=Object(s.a)(c.a.mark(function e(){var n,r,o;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={seriesId:a.activeSeries},r={watchSeries:a.activeSeries},e.next=4,Ca({variables:n,optimisticResponse:r},Nt);case 4:return o=e.sent,e.abrupt("return",t({variables:n,optimisticResponse:r,update:Kr()}).then(function(e){return console.log("watchSeriesMutation:: done",e),Na(o),e}));case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}}}),Kr=function(e,t){return function(e,t){var a=t.data;ha(e,a.watchSeries)}},eo={withMutation:Jr,updateThunk:Kr},to=Object(d.d)(Tt,{props:function(e){var t=e.mutate,a=e.ownProps;return{unWatchSeriesMutation:function(){var e=Object(s.a)(c.a.mark(function e(){var n,r,o;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={seriesId:a.activeSeries},r={unWatchSeries:a.activeSeries},e.next=4,Ca({variables:n,optimisticResponse:r},Tt);case 4:return o=e.sent,e.abrupt("return",t({variables:n,optimisticResponse:r,update:ao()}).then(function(e){return console.log("unWatchSeriesMutation:: done",e),Na(o),e}));case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}}}),ao=function(e,t){return function(e,t){var a=t.data;ha(e,a.unWatchSeries,!0)}},no={withMutation:to,updateThunk:ao},ro=a(1030),oo=a(1023),io=a(1035),lo=a(1031),co=a(72),so=a.n(co),uo=a(248),mo=a.n(uo),po=a(479),go=a.n(po),ho=a(323),fo=a.n(ho),bo=a(481),yo=a.n(bo),vo=a(482),Eo=a.n(vo),wo=a(134),xo=a.n(wo),Oo=a(480),ko=a.n(Oo),So=a(474),jo=a.n(So),Co=Object(je.a)(function(e){return{root:{},title:{background:e.palette.primary.main,color:e.palette.primary.contrastText},qrPaper:{textAlign:"center",padding:e.spacing(0,2)},qrCode:{width:"100%",minHeight:300,maxHeight:400}}}),No=function(e){var t=e.onClose,a=e.open,o=e.series,i=e.photoId,l=Co(),c=Object(n.useState)(null),s=Object(We.a)(c,2),u=s[0],m=s[1],d=function(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2],!e)return null;var a={type:"series",s:e.id,p:t},n=encodeURI(JSON.stringify(a));return{url:"".concat(window.location.origin).concat("/photomon_v0","/?fromqr=").concat(n),ogShare:"".concat(Jt.share,"/").concat(e.id,"/").concat(t||"")}}(o,i),p=d.url,g=d.ogShare;return Object(n.useLayoutEffect)(function(){jo.a.toString(p,function(e,t){e?console.error(e):m(t)})},[o]),Object(n.useLayoutEffect)(function(){if(navigator.share&&a){var e="MorPhoto Series";o.note&&(e=o.note.length>100?o.note.slice(100)+"...":o.note),navigator.share({title:o.name,text:e,url:g}).then(function(){return console.log("Successful share")}).catch(function(e){return console.log("Error sharing",e)})}},[a]),r.a.createElement(qe.a,{open:a,fullWidth:!0,onClose:t,className:l.root},r.a.createElement(Qe.a,{className:l.title},o.name),r.a.createElement(wn.a,{className:l.qrPaper},["OPEN","PUBLIC"].indexOf(o.access)>-1?r.a.createElement("svg",{className:l.qrCode,dangerouslySetInnerHTML:{__html:u}}):r.a.createElement(ke.a,{variant:"",color:"error"},"You cannot share a private series."),r.a.createElement(an.a,{href:p},"Share Link"),o.coords&&r.a.createElement(ke.a,{component:"div",className:l.coords,variant:"overline"},"coords: [ ",o.coords[0],", ",o.coords[1]," ]")))},To=a(1015),Io=a(1040),Po=a(1016),zo=a(149),Ao=a.n(zo),_o=Object(je.a)(function(e){var t=Object(ue.fade)(e.palette.secondary.light,.4);return{root:{},fab:{background:e.palette.secondary.main,color:e.palette.secondary.contrastText,"&::before":{content:'"  "',display:"block",position:"absolute",width:"100%",height:"100%",borderRadius:"inherit",boxShadow:"0 0 0 0 ".concat(t),animation:"$fabPulse 4s",animationIterationCount:5,animationTimingFunction:"linear"}},"@keyframes fabPulse":{"0%":{boxShadow:"0 0 0 0px ".concat(t)},"90%":{boxShadow:"0 0 0 0px ".concat(t)},"100%":{boxShadow:"0 0 0 10px transparent"}},directionUp:{},actionsClosed:{display:"none"},modalContainer:{position:"absolute",bottom:"0%",left:"50%",transformOrigin:"50% 50%",transform:"translateY(-50%) translateX(-50%)"},subFabContainer:{padding:e.spacing(2)},subFab:{},subFabIcon:{margin:e.spacing(1)}}}),Ro=function(e){var t=e.className,a=e.children,o=e.onCameraClick,i=e.onLibraryClick,l=e.isIos,c=Object(n.useState)(!1),s=Object(We.a)(c,2),u=s[0],m=s[1],d=Object(n.useState)(!1),p=Object(We.a)(d,2),g=p[0],h=p[1],f=Object(n.useRef)(),b=_o(),y=Object(n.useRef)(g),v=Object(n.useRef)();y.current=g,Object(n.useEffect)(function(){return function(){f.current=null,y.current=null}},[]);var E=function(e){e.currentTarget,l||v.current&&(h(!0),u||f.current||(f.current=setTimeout(function(){y.current&&m(!0),f.current=null},300)))},w=function(e){e&&e.stopPropagation&&(e.stopPropagation(),e.preventDefault())};return r.a.createElement("div",{className:yr()(b.rootContainer,t),ref:v},r.a.createElement(To.a,{className:b.fab,onMouseDown:E,onTouchStart:E,onClick:function(e){w(e),h(!1),u||(console.log("cameraclick MAIN"),o())},disableFocusRipple:!0,disableTouchRipple:!0,disableRipple:!0,size:"large",color:"secondary","aria-label":"Add"},a),r.a.createElement(Io.a,{"aria-labelledby":"simple-modal-title","aria-describedby":"simple-modal-description",open:u,onClose:function(){return m(!1)}},r.a.createElement("div",{className:b.modalContainer},r.a.createElement(Po.a,{in:u,timeout:500,unmountOnExit:!0},r.a.createElement("div",{className:b.subFabContainer},r.a.createElement(To.a,{className:b.subFab,disableFocusRipple:!0,variant:"extended",size:"large",color:"secondary","aria-label":"Add",onClick:function(){var e;m(!1),console.log("libraryClick"),m(!1),h(!1),i(),w(e)}},r.a.createElement(Ao.a,{color:"inherit",className:b.subFabIcon}),"Library"))),r.a.createElement(Po.a,{in:u,timeout:250,unmountOnExit:!0},r.a.createElement("div",{className:b.subFabContainer},r.a.createElement(To.a,{className:b.subFab,disableFocusRipple:!0,variant:"extended",size:"large",color:"secondary","aria-label":"Add",onClick:function(){var e;m(!1),console.log("cameraclick"),m(!1),h(!1),o(),w(e)}},r.a.createElement(mo.a,{color:"inherit",className:b.subFabIcon}),"Camera"))))))},Mo=a(953),Do=a(1018),Lo=a(1020),Fo=a(1021),Bo=a(1017),Uo=function(e){var t=e.anchorEl,a=e.onClose,n=e.menuItems;return r.a.createElement(Mo.a,{anchorEl:t,open:!!t,onClose:a},n.map(function(e,t){var n=e.icon,o=e.color,i=e.text,l=e.hide,c=e.disabled,s=e.action,u=e.divider,m=n||null;return l?null:u?r.a.createElement(Bo.a,{key:"contextMenu-".concat(t)}):r.a.createElement(Do.a,{button:!0,key:"contextMenu-".concat(t),disabled:c,onClick:function(){a(),s()}},m&&r.a.createElement(Lo.a,null,r.a.createElement(m,{color:c?"disabled":o})),r.a.createElement(Fo.a,{primary:i,primaryTypographyProps:{color:o}}))}))},Wo=a(1003),Go=a(1019),Ho=a(1022),qo=a(795),Qo=a(1001),Yo=a(1044),$o=a(150),Vo=a.n($o),Xo=a(180),Zo=20,Jo=Object(je.a)(function(e){return{root:{fontSize:"0.6em",height:Zo,marginRight:e.spacing(1)/2,marginTop:e.spacing(1)/2},deleteIcon:{width:Zo-1,height:Zo-1},chipAvatar:{width:Zo,height:Zo}}}),Ko=function(e){var t=e.edit,a=e.tag,n=e.color,o=e.onDelete,i=Object(m.a)(e,["edit","tag","color","onDelete"]),l=Jo(),c=Object(Xo.a)();return r.a.createElement(Yo.a,Object.assign({style:{background:n||null,color:n?"".concat(c.palette.getContrastText(n)):null},label:a.label,data:a.id,onDelete:t?function(){return o(a)}:null,deleteIcon:r.a.createElement(Vo.a,{className:l.deleteIcon,onClick:function(e){console.log("this click")},style:{opacity:.5,color:n?"".concat(c.palette.getContrastText(n)):null}}),className:l.root},i))},ei=Object(je.a)(function(e){return{root:{position:"relative",display:"block",overflow:"hidden",whiteSpace:"pre-line","&::before":{content:'"  "',display:"block",position:"absolute",bottom:0,width:"100%",height:100,background:"linear-gradient(180deg, rgba(255,255,255,0) 0%, ".concat(e.palette.background.paper," 100%)")},placeholder:{color:e.palette.text.secondary}}}}),ti=function(e){var t=e.label,a=e.text,n=e.height,o=e.onClick,i=e.placeholder,l=ei();return r.a.createElement("div",{onClick:o},t&&r.a.createElement(Qo.a,{className:l.formLabel},t),!a&&r.a.createElement(ke.a,{component:"div",variant:"caption",color:"inherit",style:{height:n},className:yr()(l.placeholder)},i||"none"),a&&r.a.createElement(ke.a,{component:"div",variant:"body1",color:"inherit",style:{height:n},className:yr()(l.root)},a))};ti.defaultProps={height:100};var ai=ti,ni=Object(je.a)(function(e){return{root:{},imgContainer:{},gravatarImg:{objectFit:"cover",height:"100%",width:"100%"}}}),ri=function(e){var t=e.user,a=e.loading,n=e.onAvatarClick,o=e.secondary,i=ni();return a||!t?"LOADING...":r.a.createElement(Go.a,{className:i.root,button:!!n,onClick:n},r.a.createElement(Ho.a,{className:i.imgContainer},r.a.createElement(qo.a,null,r.a.createElement("img",{alt:"profile",className:i.gravatarImg,src:t.gravatar}))),r.a.createElement(Fo.a,{primary:t.username,secondary:o}))},oi=a(117),ii=a.n(oi),li=Object(je.a)(function(e){return{root:{},body:{overflow:"hidden",whiteSpace:"pre-line",paddingBottom:e.spacing(1)},title:{background:e.palette.primary.main,color:e.palette.primary.contrastText,alignSelf:"flex-start",width:"100%",margin:0,display:"flex",padding:e.spacing(2)},dlgTitle:{flexGrow:1},closeButton:{padding:0,alignSelf:"flex-start"}}}),ci=function(e){var t=e.open,a=e.onClose,n=e.title,o=e.body,i=li();return r.a.createElement(qe.a,{scroll:"paper",open:t,fullWidth:!0,maxWidth:"xl",onClose:a,"aria-labelledby":"simple-dialog-title"},r.a.createElement(Qe.a,{className:i.title,disableTypography:!0},r.a.createElement(ke.a,{className:i.dlgTitle},n),r.a.createElement(oo.a,{color:"inherit",className:i.closeButton,onClick:a},r.a.createElement(ii.a,{color:"inherit"}))),r.a.createElement(Ye.a,null,r.a.createElement(ke.a,{variant:"body2",className:i.body},o)))},si=a(51),ui=a(151),mi=r.a.createContext({}),di="NOTEVIEW",pi=Object(je.a)(function(e){return Object(u.a)({root:{margin:e.spacing(1),backgroundColor:e.palette.background.paper,paddingBottom:60},field:{marginBottom:e.spacing(1)},list:{padding:e.spacing(1)},heading:{marginTop:e.spacing(1)},watchers:{},numPhotos:{backgroundColor:e.palette.primary.main,color:e.palette.primary.contrastText},tagListItem:{marginTop:e.spacing(1),marginBottom:e.spacing(2)},chip:{margin:e.spacing(.5)},access:{padding:e.spacing(1),borderRadius:e.spacing(1)}},Object.keys(ea).reduce(function(t,a){return Object(u.a)({},t,Object(lr.a)({},a,{border:"1px solid ".concat(ea[a].color[500]),background:"".concat(ea[a].color[700]),color:e.palette.getContrastText(ea[a].color[700])}))},{}))}),gi=function(){var e=pi(),t=Object(n.useContext)(mi),a=t.series,o=t.seriesConfig,i=new ui.a(o),l=Object(n.useState)(null),c=Object(We.a)(l,2),s=c[0],m=c[1],d=a.photos.reduce(function(e,t){return t.tags.forEach(function(t){if(e[t.typeId])if(e[t.typeId][t.label]){var a=e[t.typeId][t.label];e[t.typeId][t.label]=Object(u.a)({},a,{count:a.count+1})}else e[t.typeId][t.label]=Object(u.a)({},t,{count:1});else e[t.typeId]=Object(lr.a)({},t.label,Object(u.a)({},t,{count:1}))}),e},{}),p=[];try{p=a.meta?Object.keys(JSON.parse(a.meta)):[]}catch(g){console.error(g)}return r.a.createElement("div",{className:e.root},r.a.createElement("div",{className:e.field},r.a.createElement(Qo.a,{className:e.formLabel},"Series Name"),r.a.createElement(ke.a,{variant:"body1",color:"inherit"},a.name)),a.note&&r.a.createElement(ai,{label:"Series Note",text:a.note,onClick:function(){return m(di)}}),r.a.createElement(ke.a,{className:e.heading,variant:"subtitle1"},"Series Summary"),r.a.createElement(Bo.a,null),r.a.createElement(Wo.a,{className:e.list,dense:!0},r.a.createElement(Go.a,{className:yr()(e.access,e[a.access])},r.a.createElement(Fo.a,{color:"inherit",primary:"Series is ".concat(ea[a.access].label),secondary:ea[a.access].description})),a.createdUser&&r.a.createElement(ri,{user:a.createdUser,onAvatarClick:function(){return o.onAvatarClick(a.createdUser.username)},secondary:"created this series"}),r.a.createElement(Go.a,null,r.a.createElement(Ho.a,null,r.a.createElement(qo.a,{className:e.numPhotos},a.photos.length)),r.a.createElement(Fo.a,{primary:a.photos.length>1?"Photos":"Photo",secondary:a.photos.length>0&&r.a.createElement("span",null,Object(si.d)(a.photos[0].takenOn,"LL"),r.a.createElement("span",null,"\xa0\xa0"),"to",r.a.createElement("span",null,"\xa0\xa0"),Object(si.d)(a.photos[a.photos.length-1].takenOn,"LL"))})),r.a.createElement(Go.a,null,r.a.createElement(Ho.a,null,r.a.createElement(qo.a,{className:e.watchers},a.watchers||"0")),r.a.createElement(Fo.a,{primary:"Users Watching"})),r.a.createElement(Go.a,null,r.a.createElement(Fo.a,null,r.a.createElement(Qo.a,{className:e.formLabel},"Tags in use (across all photos)"),r.a.createElement(Bo.a,null),0===Object.keys(d).length&&r.a.createElement(ke.a,{variant:"caption"},"No photos in this series have tags"),Object.keys(d).map(function(t,a){return r.a.createElement("div",{key:"tagchipkey".concat(a),className:e.tagListItem},r.a.createElement(ke.a,{className:e.subheading,variant:"overline"},i.getTagType(t).label),r.a.createElement(Bo.a,null),Object.values(d[t]).length>0?Object.values(d[t]).map(function(e,n){return r.a.createElement(Ko,{key:"tagchip-".concat(a,"-").concat(n),tag:e,color:i.getTagType(t).color})}):r.a.createElement(ke.a,{variant:"caption"},"No photos in this series have tags"))})))),p.length>0&&Object.keys(o.meta).length>0&&r.a.createElement(r.a.Fragment,null,r.a.createElement(Qo.a,{className:e.formLabel},"Metadata"),r.a.createElement(Bo.a,null),r.a.createElement(Wo.a,{className:e.list},p.map(function(e,t){return o.meta[e]?r.a.createElement(Go.a,{key:"metadata".concat(t)},r.a.createElement(Fo.a,{primary:o.meta[e].label,secondary:o.meta[e].render(a.meta[e])})):null}))),s===di&&r.a.createElement(ci,{open:!0,multiline:!0,onClose:function(){return m(null)},title:"Series Note",body:a.note}))},hi=a(1027),fi=a(1025),bi=a(1026),yi=a(118),vi=a.n(yi),Ei=a(154),wi=a.n(Ei),xi=a(153),Oi=a.n(xi),ki=a(249),Si=a.n(ki),ji=function(e,t,a){return e?t?{width:Math.max(t.width,e.offsetWidth),height:Math.max(t.height,e.offsetHeight)}:{width:e.offsetWidth,height:e.offsetHeight}:a||t||{width:0,height:0}},Ci=function(e,t,a){var r=Object(n.useRef)(),o=Object(n.useState)(!0),i=Object(We.a)(o,2),l=i[0],c=i[1];r.current=l;var s=Object(n.useState)(ji(e?e.current:null,t,a)),u=Object(We.a)(s,2),m=u[0],d=u[1],p=function(){if(r.current&&e.current){var n=ji(e.current,t,a);n.height===m.height&&n.width===m.width||d(n)}},g=Object(n.useCallback)(Object(jn.a)(p,500),[]);return Object(n.useLayoutEffect)(function(){if(e.current){if(p(),"function"===typeof ResizeObserver){var t=new ResizeObserver(g);return t.observe(e.current),function(){t.disconnect(e.current),t=null}}return window.addEventListener("resize",g),function(){window.removeEventListener("resize",g)}}},[e.current]),{size:m,setResizeActive:c}},Ni=a(475),Ti=a.n(Ni),Ii=a(250),Pi=a.n(Ii),zi=20,Ai=Object(je.a)(function(e){return{xyTagChip:{cursor:"pointer",color:"white",fontSize:"0.6em",background:"#444444",height:zi,position:"absolute",left:-zi/2,top:-zi/2},editing:{},reversedChip:{flexDirection:"row-reverse",left:"unset",right:-zi/2},deleteIcon:{width:zi-1,height:zi-1},chipAvatarIcon:{color:"white",width:zi-4,height:zi-4},chipAvatar:{background:"inherit",width:zi,height:zi},reversedDelete:{margin:"0 -".concat(zi/8,"px 0 ").concat(zi/8,"px")},chipBucket:{width:1,height:1,display:"flex",flexDirection:"row",position:"absolute"},reversedChipBucket:{flexDirection:"row-reverse"}}}),_i=function(e){var t=e.color,a=e.edit,n=e.tag,o=e.newSize,i=e.onTagDragOver,l=e.onTagDragStop,c=(e.onNewTag,e.onTagDelete),s=Object(m.a)(e,["color","edit","tag","newSize","onTagDragOver","onTagDragStop","onNewTag","onTagDelete"]),u=n.relCoords.x>o.newWidth/2,d=Ai(),p=Object(Xo.a)(),g=function(e){e.preventDefault(),e.stopPropagation()};return r.a.createElement(Ti.a,{disabled:!a,bounds:{left:10,top:10,right:o.newWidth-10,bottom:o.newHeight-10},position:{x:n.relCoords.x,y:n.relCoords.y},onDrag:function(e,t){g(e),i(t,n)},onStop:function(e,t){g(e),l(t,n)},onClick:g},r.a.createElement("div",{className:yr()(d.chipBucket,u&&d.reversedChipBucket)},r.a.createElement(Yo.a,Object.assign({style:{background:t?"".concat(t,"!important"):null,color:t?"".concat(p.palette.getContrastText(t),"!important"):null},color:a?"secondary":"default",label:n.label,data:n.id,onClick:g,onDelete:a?c(n):null,deleteIcon:a?r.a.createElement(Vo.a,{className:yr()(d.deleteIcon,u&&d.reversedDelete)}):r.a.createElement("div",null),className:yr()(d.xyTagChip,u&&d.reversedChip,a&&d.editing)},s,{avatar:r.a.createElement(qo.a,{className:yr()(d.chipAvatar,a&&d.editing)},r.a.createElement(Pi.a,{className:yr()(d.chipAvatarIcon,a&&d.editing)}))}))))},Ri=a(251),Mi=a(253),Di=a.n(Mi),Li=Object(je.a)(function(e){return{root:{width:"100%"},noOptionsMessage:{padding:"".concat(e.spacing(1),"px ").concat(2*e.spacing(1),"px")},singleValue:{fontSize:16},placeholder:{position:"absolute",left:2,fontSize:16},input:{display:"flex",padding:0},valueContainer:{display:"flex",flexWrap:"wrap",flex:1,alignItems:"center",overflow:"hidden"},paper:{position:"absolute",zIndex:100,marginTop:e.spacing(1),left:0,right:0}}}),Fi=function(e){var t=e.tagConfig,a=e.onChange,n=Li(),o=t.values.map(function(e){return{label:e.label,value:e.id}});return console.log("XYTagSelect",t),r.a.createElement("div",{className:n.root},!t.allowAdditions&&r.a.createElement(Ri.a,{options:o,classes:n,components:{Control:Bi,Menu:Wi,NoOptionsMessage:Ui,Option:qi,Placeholder:Hi,ValueContainer:Qi},value:null,blurInputOnSelect:!0,isClearable:!1,onChange:a,placeholder:t.label,isSearchable:!0}),t.allowAdditions&&r.a.createElement(Di.a,{options:o,classes:n,components:{Control:Bi,Menu:Wi,NoOptionsMessage:Ui,Option:qi,Placeholder:Hi,ValueContainer:Qi},value:null,isClearable:!1,blurInputOnSelect:!0,onChange:a,placeholder:t.label,isSearchable:!0}))};function Bi(e){return r.a.createElement(Ve.a,Object.assign({fullWidth:!0,InputProps:{inputComponent:Gi,inputProps:Object(u.a)({className:e.selectProps.classes.input,inputRef:e.innerRef,children:e.children},e.innerProps)}},e.selectProps.textFieldProps))}var Ui=function(e){var t=e.innerProps,a=e.selectProps,n=e.children;return r.a.createElement(ke.a,Object.assign({color:"textSecondary",className:a.classes.noOptionsMessage},t),n)},Wi=function(e){var t=e.selectProps,a=e.innerProps,n=e.children;return r.a.createElement(wn.a,Object.assign({square:!0,className:t.classes.paper},a),n)},Gi=function(e){var t=e.inputRef,a=Object(m.a)(e,["inputRef"]);return r.a.createElement("div",Object.assign({ref:t},a))},Hi=function(e){return r.a.createElement(ke.a,Object.assign({color:"textSecondary",className:e.selectProps.classes.placeholder},e.innerProps),e.children)},qi=function(e){var t=e.innerRef,a=e.isFocused,n=e.isSelected,o=e.innerProps,i=e.children;return r.a.createElement(Do.a,Object.assign({buttonRef:t,selected:a,component:"div",style:{fontWeight:n?500:400}},o),i)},Qi=function(e){var t=e.selectProps,a=e.children;return r.a.createElement("div",{className:t.classes.valueContainer},a)},Yi=Object(je.a)(function(e){return{root:{overflow:"visible"},header:{padding:2*e.spacing(1)},listItem:{flexDirection:"column"},dlgBody:{paddingLeft:2*e.spacing(1),paddingRight:2*e.spacing(1),paddingBottom:2*e.spacing(1)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}}),$i=function(e){var t=e.coords,a=e.open,n=e.seriesConfig,o=e.onNewTag,i=e.onClose,l=Yi(),c=n.tags.filter(function(e){return e.allowXY});return t?r.a.createElement(qe.a,{open:a,scroll:"paper",fullScreen:!0,classes:{paperScrollPaper:l.root},onClose:function(){return i()},"aria-labelledby":"simple-dialog-title"},r.a.createElement(Qe.a,{id:"simple-dialog-title",className:l.header},"New Tag:",r.a.createElement(oo.a,{className:l.closeButton,onClick:i},r.a.createElement(ii.a,null))),r.a.createElement("div",{className:l.dlgBody},c.length>1&&r.a.createElement(ke.a,{variant:"caption"},"What kind of tag would you like to create?"),c.map(function(e,a){return r.a.createElement("div",{className:l.listItem,key:"tagSelect".concat(a)},r.a.createElement(Fi,{tagConfig:e,onChange:o(t,e)}))}))):null},Vi=function e(t,a){var n=this;Object(Me.a)(this,e),this.findTagById=function(e,t){return n.seriesConfig.getTagType(e).values.find(function(e){return e.id===t})},this.getXYTags=function(){var e=n.seriesConfig.getXYTagTypes().map(function(e){return e.id});return n.tags.filter(function(t){return e.indexOf(t.typeId)>-1&&t.coords&&t.coords.x})},this.getNonXYTags=function(){var e=n.seriesConfig.getNonXYTagTypes().map(function(e){return e.id});return n.tags.filter(function(t){return e.indexOf(t.typeId)>-1})},this.createNewTagObj=function(e,t){return{label:e,typeId:t}},this.createExistingTagObj=function(e,t){return Object(u.a)({},n.findTagById(t,e),{typeId:t})},this.createNewXYTagObj=function(e,t,a){return{label:e,typeId:t,coords:a}},this.createExistingXYTagObj=function(e,t,a){return Object(u.a)({},n.findTagById(t,e),{typeId:t,coords:a})},this.getRelXYTags=function(e){return n.getXYTags().map(function(t){return Object(u.a)({},t,{group:n.seriesConfig.getTagTypeIndex(t.typeId),relCoords:{x:t.coords.x*e,y:t.coords.y*e}})})},this.tags=a,this.seriesConfig=new ui.a(t)},Xi=function(e,t,a,o){var i=Object(n.useContext)(mi).seriesConfig,l=Object(n.useState)(!1),c=Object(We.a)(l,2),s=c[0],m=c[1],d=Object(n.useState)(null),p=Object(We.a)(d,2),g=p[0],h=p[1],f=new Vi(i,e.tags),b=function(t,n){return function(r){var o=r.value,i=r.__isNew__?f.createNewXYTagObj(o,n.id,t):f.createExistingXYTagObj(o,n.id,t);h(null),a(Object(u.a)({},e,{tags:[].concat(Object(ra.a)(e.tags),[i])}))}},y=function(a,n){var r=a.x,o=a.y;return e.tags.map(function(e){if(e.id!==n.id)return e;var a=parseInt(r/t.multiplier,10),i=parseInt(o/t.multiplier,10);return Object(u.a)({},e,{coords:{x:a,y:i}})})};return{onNewTag:b,onTagDelete:function(t){return function(){var n=e.tags.filter(function(e){return e.id!==t.id});a(Object(u.a)({},e,{tags:n}))}},onAddTagTrigger:function(e){g||(o(!1),h({x:parseInt(e.pageX-(window.innerWidth-t.newWidth)/2*t.multiplier,10),y:parseInt(e.pageY-(window.innerHeight-t.newHeight)/2*t.multiplier,10)}))},onTagDragOver:function(e,t){y(e,t),m(!0)},onTagDragStop:function(t,n){var r=y(t,n);m(!1),a(Object(u.a)({},e,{tags:r}))},TagChooser:function(){return r.a.createElement($i,{open:!s&&Boolean(g),coords:g,seriesConfig:i,onNewTag:b,onClose:function(){h(null),o(!0)}})},getRelXYTags:f.getRelXYTags}},Zi=a(1024),Ji=a(477),Ki=a.n(Ji),el=Object(je.a)(function(e){return{root:{height:"100%",padding:e.spacing(2),display:"flex",flexDirection:"column",overflow:"hidden",opacity:.3,textAlign:"center",color:e.palette.getContrastText(e.palette.text.primary),background:e.palette.text.primary},spacer:{flexGrow:1},icon:{width:"100%",flex:"1 1 40%",opacity:.5},circularProgress:{margin:"0 auto"},primary:{textAlign:"center",width:"100%"},secondary:{flex:"1 1 30%",width:"100%"}}}),tl=function(e){var t=e.loading,a=e.className,n=Object(m.a)(e,["loading","className"]),o=el();return r.a.createElement("div",Object.assign({className:yr()(o.root,a)},n),r.a.createElement("div",{className:o.spacer}),t?r.a.createElement(Zi.a,{color:"inherit",className:o.circularProgress}):r.a.createElement(Ki.a,{className:o.icon,color:"inherit"}),r.a.createElement(ke.a,{className:o.primary,color:"inherit"},t?"Loading":"Photo not found"),r.a.createElement("div",{className:o.spacer}))},al=Object(je.a)(function(e){return{root:{position:"relative",display:"block",height:"100%",width:"100%"},img:{display:"block",height:"100%",width:"100%"},imgBroken:{display:"none"}}}),nl=function(e){var t=e.className,a=e.getPhotoUrls,o=e.sizePriority,i=e.dataUrl,l=e.photo,c=e.imgRef,s=e.cover,d=e.style,p=Object(m.a)(e,["className","getPhotoUrls","sizePriority","dataUrl","photo","imgRef","cover","style"]),g=al(),h=Object(n.useState)(),f=Object(We.a)(h,2),b=f[0],y=f[1],v=Object(n.useRef)(),E=Object(n.useState)(0),w=Object(We.a)(E,2),x=w[0],O=w[1],k=Object(n.useState)(!1),S=Object(We.a)(k,2),j=S[0],C=S[1];Object(n.useEffect)(function(){!i&&l&&a&&a(l,["large","medium"]).then(function(e){v.current&&y(e)}).catch(function(){v.current&&C(!0)})},[l]);var N=i||b&&b[x];return r.a.createElement(r.a.Fragment,null,!i&&(!b||j)&&r.a.createElement(tl,Object.assign({className:t,loading:!j},p)),r.a.createElement("div",{ref:v,style:{height:0,width:0}}),N&&r.a.createElement("img",Object.assign({ref:c,className:yr()(t,j?g.imgBroken:g.img),alt:o[x],style:Object(u.a)({},d,{objectFit:s?"cover":"contain"}),onError:function(){!i&&b[x+1]?(console.warn("RawImage::Setting Alternate image",x),O(x+1)):(console.warn("RawImage::Image Fail",{photoId:l.id}),C(!0))},src:N},p)))},rl=Object(je.a)(function(e){return{root:{display:"block",position:"relative",width:"100%",height:"100%",background:"black",overflow:"hidden"},inner:{width:"100%",height:"100%",position:"absolute",top:"50%",left:"50%",transform:"translateY(-50%) translateX(-50%)"},xyTags:{position:"absolute",top:0,left:0,height:"100%",width:"100%"},img:{display:"block"},brokenImg:{display:"none"},formControl:{width:"100%"}}}),ol=function(e){var t=e.photo,a=e.opacity,o=e.edit,i=e.showTags,l=e.dataUrl,c=(e.transition,e.onChange),s=e.className,u=rl(),m=Object(n.useRef)(),d=Object(n.useRef)(),p=Object(n.useState)({multiplier:1}),g=Object(We.a)(p,2),h=g[0],f=g[1],b=Object(n.useContext)(mi).seriesConfig,y=Ci(m),v=y.size,E=v.height,w=v.width,x=y.setResizeActive,O=Xi(t,{height:E,width:w},c,x),k=O.onAddTagTrigger,S=O.TagChooser,j=O.getRelXYTags,C=O.onTagDragOver,N=O.onTagDragStop,T=O.onTagDelete;return Object(n.useLayoutEffect)(function(){d.current&&function(){var e=d.current,t=e.naturalHeight,a=e.naturalWidth,n=Math.min(E/t,w/a);f({newWidth:n*a,newHeight:n*t,naturalWidth:a,naturalHeight:t,multiplier:n})}()},[w,E]),r.a.createElement("div",{className:yr()(u.root,s),style:{opacity:null!==a?a:1},ref:m},r.a.createElement("div",{className:u.inner,style:{height:h?h.newHeight:1,width:h?h.newWidth:1},onClick:k},i||o?r.a.createElement("div",{className:s},j(h.multiplier).map(function(e,t){return r.a.createElement(_i,Object.assign({key:"xytag-".concat(t),color:e.color},{edit:o,newSize:h,tag:e,onTagDragOver:C,onTagDragStop:N,onTagDelete:T}))})):null,r.a.createElement(nl,{className:u.rawImage,sizePriority:["large","medium","thumb"],photo:t,imgRef:d,dataUrl:l,getPhotoUrls:b.getPhotoUrls,style:{height:h.newHeight,width:h.newWidth}})),o&&r.a.createElement(S,null))},il=Object(je.a)(function(e){return{root:{position:"relative"},inner:{position:"relative"},photoWrapper:{minHeight:250,height:250},dateCaption:{padding:e.spacing(1),background:e.palette.primary.dark,color:e.palette.primary.contrastText,textAlign:"center"},mobileStepper:{},manualBack:{color:"white",zIndex:10,position:"absolute",transform:"translateY(-50%)",left:0,top:"50%"},manualForward:{color:"white",zIndex:10,position:"absolute",transform:"translateY(-50%)",right:0,top:"50%"},tagButton:{color:"rgba(255, 255, 255, 0.54)"},slideshowButton:{color:"rgba(255, 255, 255, 0.54)"},dots:{margin:"0 auto"}}}),ll=function(e){var t=e.photos,a=e.onImageSelect,o=e.activePhoto,i=e.setActivePhoto,l=il(),c=Object(Xo.a)(),s=Object(n.useState)(!1),u=Object(We.a)(s,2),m=u[0],d=u[1],p=t.length<2;return r.a.createElement("div",{className:l.root},r.a.createElement("div",{className:l.inner},r.a.createElement(Si.a,{axis:"rtl"===c.direction?"x-reverse":"x",index:o,onChangeIndex:function(e){return i(e)},enableMouseEvents:!0},t.map(function(e,n){return r.a.createElement("div",{className:l.photoWrapper,key:"swipeshowpic-".concat(n),onClick:function(){return a(t[o].id)}},r.a.createElement(ol,{photo:e,className:l.photo,showTags:m}))})),r.a.createElement(oo.a,{size:"small",className:l.manualBack,onClick:function(){return i(o<=0?t.length-1:o-1)},color:"inherit",disabled:0===o},"rtl"===c.direction?r.a.createElement(Oi.a,null):r.a.createElement(wi.a,null)),r.a.createElement(oo.a,{size:"small",className:l.manualForward,onClick:function(){return i(o>=t.length?0:o+1)},color:"inherit",disabled:o===t.length-1},"rtl"===c.direction?r.a.createElement(wi.a,null):r.a.createElement(Oi.a,null)),r.a.createElement(fi.a,{title:p?"Photo":"Photo (".concat(o+1,"/").concat(t.length,")"),subtitle:t.length>0&&r.a.createElement("span",null,Object(si.d)(t[o].takenOn)),actionIcon:r.a.createElement(r.a.Fragment,null,r.a.createElement(oo.a,{className:l.tagButton,onClick:function(){return d(!m)}},r.a.createElement(bi.a,{color:m?"primary":"secondary",badgeContent:t[o].tags?t[o].tags.filter(function(e){return e.coords}).length:null},r.a.createElement(vi.a,null))))})),!p&&r.a.createElement(hi.a,{steps:t.length,position:"static",activeStep:o,classes:{root:l.mobileStepper,dots:l.dots}}))};ll.defaultProps={transition:5e3,isFullScreen:!1,slides:[]};var cl=ll,sl=a(1028),ul=a(1029),ml=a(254),dl=a.n(ml),pl=a(478),gl=a.n(pl),hl=Object(je.a)(function(e){return{}}),fl=function(e){var t=e.title,a=e.message,n=e.onConfirm,o=e.open,i=hl();return r.a.createElement(qe.a,{className:i.root,disableBackdropClick:!0,open:o,disableEscapeKeyDown:!0,fullWidth:!0,maxWidth:"xl","aria-labelledby":"confirmation-dialog-title"},r.a.createElement(Qe.a,{id:"confirmation-dialog-title"},t),r.a.createElement(Ye.a,null,r.a.createElement(ke.a,null,a)),r.a.createElement(Xe.a,null,r.a.createElement(He.a,{onClick:function(){return n(!1)},color:"primary"},"No"),r.a.createElement(He.a,{onClick:function(){return n(!0)},color:"primary"},"Yes")))},bl=Object(je.a)(function(e){return{root:{},tile:{},addFab:{position:"absolute",zIndex:10,top:e.spacing(1),left:e.spacing(1),opacity:.3},notDeleteable:{background:e.palette.primary.dark,opacity:.1},unSelectedTile:{"& img":{opacity:.7}},selectedTile:{padding:"".concat(e.spacing(2),"px!important"),"& img":{opacity:1}},img:{},snackbarContent:{backgroundColor:Qt.a[700]},snackbar:{}}}),yl=function(e){var t=e.photos,a=e.columns,o=e.multiSelect,i=e.onDelete,l=e.onTileClick,m=Object(n.useState)(!1),d=Object(We.a)(m,2),p=d[0],g=d[1],h=bl(),f=Object(n.useState)([]),b=Object(We.a)(f,2),y=b[0],v=b[1],E=Object(n.useState)({}),w=Object(We.a)(E,2),x=w[0],O=w[1],k=Object(n.useState)(!1),S=Object(We.a)(k,2),j=S[0],C=S[1],N=Object(n.useContext)(mi),T=N.seriesConfig,I=N.ac,P=function(){g(!1),v([])},z=function(e){if(y.indexOf(e)<0)v([].concat(Object(ra.a)(y),[e]));else{var t=y.filter(function(t){return t!==e});0===t.length&&P(),v(t)}};Object(n.useEffect)(function(){t.forEach(function(){var e=Object(s.a)(c.a.mark(function e(t){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=O,e.t1=u.a,e.t2={},e.t3=x,e.t4=lr.a,e.t5={},e.t6=t.id,e.next=9,T.getPhotoUrls(t,"thumb");case 9:e.t7=e.sent,e.t8=(0,e.t4)(e.t5,e.t6,e.t7),e.t9=(0,e.t1)(e.t2,e.t3,e.t8),(0,e.t0)(e.t9);case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())},[t]);var A=Object(ra.a)(t);return A.sort(function(e,t){return parseInt(t.takenOn,10)-parseInt(e.takenOn,10)}),r.a.createElement("div",null,r.a.createElement(sl.a,{cols:a,cellHeight:200,className:h.root},A.map(function(e,t){var a=y.indexOf(e.id)>-1,n=I.canUser("delete",e,"photo");return r.a.createElement(ul.a,{key:"gridTile".concat(t),onClick:function(t){return n&&function(e,t){e.preventDefault(),e.stopPropagation(),p?z(t.id):l(t.id)}(t,e)},className:yr()(h.tile,p&&!n&&h.notDeleteable,p&&n&&!a&&h.unSelectedTile,p&&a&&h.selectedTile)},r.a.createElement(nl,{photo:e,sizePriority:["medium","thumb","large"],cover:!0,getPhotoUrls:T.getPhotoUrls,className:h.img}),n&&o&&r.a.createElement(To.a,{size:"small","aria-label":"Add",className:h.addFab,onClick:function(t){return function(e,t){e.preventDefault(),e.stopPropagation(),g(!0),z(t)}(t,e.id)}},p&&a?r.a.createElement(gl.a,null):r.a.createElement(dl.a,null)),r.a.createElement(fi.a,{title:r.a.createElement("span",null,Object(si.d)(e.takenOn))}))})),r.a.createElement(En.a,{open:p,autoHideDuration:null,ContentProps:{"aria-describedby":"snackbar-fab-message-id",className:h.snackbarContent},message:r.a.createElement("span",{id:"snackbar-fab-message-id"},y.length>=t.length?"You can't delete all the photos. delete the series instead.":"".concat(y.length," Photos selected")),action:r.a.createElement("div",null,r.a.createElement(He.a,{color:"inherit",disabled:y.length>=t.length,size:"small",onClick:function(){return C(!0)}},"Delete"),r.a.createElement(He.a,{color:"inherit",size:"small",onClick:function(){return P()}},"Cancel")),className:h.snackbar}),r.a.createElement(fl,{open:j,onConfirm:function(e){C(!1),!0===e&&y.length<t.length&&i(y),P()},title:"Delete ".concat(y.length," Photos"),message:"Are you sure you want to delete these photos?"}))};yl.defaultProps={multiSelect:!0,columns:2};var vl=yl,El=function(e){return{root:{display:"flex",height:"100%",flexDirection:"column",overflow:"hidden"},appBar:{flexGrow:0},inner:{position:"relative",flexGrow:1,overflowY:"scroll","-webkit-overflow-scrolling":"touch"},tabMenu:{marginTop:e.spacing(7)},mapWrap:{position:"absolute",height:"100%",width:"100%",top:0,left:0},toolbarTitle:{flexGrow:1,textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},AddFab:{position:"absolute",bottom:e.spacing(2),right:e.spacing(2),zIndex:500},grow:{flexGrow:1},gridList:{flexWrap:"nowrap",transform:"translateZ(0)"},titleBar:{display:"flex",padding:e.spacing(1)},menuButton:{},placeholderInner:{position:"relative",flexGrow:1,overflow:"hidden",textAlign:"center",display:"flex",height:"100%",flexDirection:"column"},progressWrapper:{textAlign:"center",marginBottom:e.spacing(4)},placeholderText:{opacity:.4},placeholder:{},progress:{color:e.palette.grey[300]}}},wl=Object(je.a)(El),xl=function(e){var t=e.onSlideshowStart,a=e.onChange,o=e.onEditSeries,i=e.onDeletePhotos,l=e.onCameraAdd,c=e.onDeleteSeries,s=e.onLibraryAdd,u=e.onTileClick,m=e.onMenuBack,d=e.onWatch,p=e.onUnWatch,g=e.initialPhoto,h=e.onFindOnMap,f=e.watching,b=e.owned,y=wl(),v=Object(n.useState)(),E=Object(We.a)(v,2),w=E[0],x=E[1],O=Object(n.useState)(!1),k=Object(We.a)(O,2),S=k[0],j=k[1],C=Object(n.useState)(!1),N=Object(We.a)(C,2),T=N[0],I=N[1],P=Object(n.useState)(0),z=Object(We.a)(P,2),A=z[0],_=z[1],R=Object(n.useContext)(mi),M=R.series,D=R.ac,L=R.seriesConfig,F=g&&M.photos.findIndex(function(e){return e.id===g})||0,B=Object(n.useState)(F>=0?F:0),U=Object(We.a)(B,2),W=U[0],G=U[1],H=Object(ra.a)(M.photos);H.sort(function(e,t){return parseInt(t.takenOn,10)-parseInt(e.takenOn,10)});var q={zoom:16};M&&M.coords&&2===M.coords.length&&(q.longitude=M.coords[0],q.latitude=M.coords[1]);var Q={update:D.canUser("update",M,"series","*"),delete:D.canUser("delete",M,"series","*"),contribute:D.canUser("update",M,"series",["photos"])},Y=T||S;return r.a.createElement("div",{className:y.root},r.a.createElement(Se.a,null),r.a.createElement(ro.a,{position:"static",className:y.appBar},r.a.createElement(Ga.a,{disableGutters:!0},r.a.createElement(oo.a,{className:y.menuButton,color:"inherit",onClick:m,"aria-label":"Menu"},r.a.createElement(so.a,null)),r.a.createElement(ke.a,{variant:"subtitle1",color:"inherit",className:y.toolbarTitle},M.name||"Series"),r.a.createElement(oo.a,{"aria-haspopup":"true",color:"inherit",onClick:function(e){return x(e.currentTarget)}},r.a.createElement(go.a,null)),r.a.createElement(Uo,{anchorEl:w,onClose:function(){return x(null)},menuItems:[{text:"Find on map",icon:xo.a,hide:!h,action:h},{text:"Watch Series",icon:fo.a,hide:!d||b||f,action:d},{text:"Unwatch Series",icon:fo.a,hide:!p||b||!f,action:p},{text:"Share series",icon:ko.a,action:function(){return j(!0)}},{text:"Start Slideshow",icon:yo.a,hide:!t,action:t},{divider:!0},{text:"Edit Series",icon:Eo.a,hide:!o||!Q.update,action:o},{text:"Delete Series",icon:at.a,hide:!I||!Q.delete,color:"error",action:function(){return I(!0)}}]})),r.a.createElement(io.a,{variant:"fullWidth",value:A,onChange:function(e,t){return _(t)}},r.a.createElement(lo.a,{label:"Series"}),r.a.createElement(lo.a,{label:"Photos"}))),r.a.createElement("div",{className:y.inner},0===A&&r.a.createElement(r.a.Fragment,null,M.photos&&M.photos.length>0&&r.a.createElement(cl,{photos:H,activePhoto:W,setActivePhoto:G,onImageSelect:u}),r.a.createElement(gi,{onChange:a})),M.photos&&1===A&&r.a.createElement(vl,{photos:M.photos,onTileClick:u,onDelete:i})),0===A&&Q.contribute&&r.a.createElement(Ro,{isIos:L.isIos,className:y.AddFab,disabled:!Y,onCameraClick:l,onLibraryClick:s},r.a.createElement(mo.a,null)),H[W]&&r.a.createElement(No,{open:S,onClose:function(){return j(!1)},series:M,photoId:H[W].id}),r.a.createElement(fl,{open:T,onConfirm:function(e){I(!1),!0===e&&c(M.id)},title:"Delete Series",message:"Are you sure you want to delete this series? The record and all images associated with it will be gone forever."}))},Ol=a(1032),kl=a(1049),Sl=a(91),jl=a(212),Cl=a(316),Nl=a(952),Tl=Object(je.a)(function(e){return{root:{width:1,height:1,zIndex:1},svgDot:{width:20,height:20,position:"absolute",top:"50%",left:"50%",textAlign:"center",transformOrigin:"50% 50%",transform:"translateY(-50%) translateX(-50%)"},svgAccuracyDot:{position:"absolute",top:"50%",left:"50%",textAlign:"center",transformOrigin:"50% 50%",transform:"translateY(-50%) translateX(-50%)"}}}),Il=function(e){e.position;var t=e.projection,a=Tl(),n=20*t.pixelsPerMeter[0],o=20*t.pixelsPerMeter[1];return r.a.createElement("div",{className:a.root},r.a.createElement("svg",{style:{height:n,width:o},className:a.svgAccuracyDot,version:"1.1",viewBox:"0, 0, 100, 100"},r.a.createElement("circle",{cx:"50",cy:"50",r:49,stroke:"#8888FF",fillOpacity:"0.4",strokeWidth:"1",fill:"#AAAAFF"})),r.a.createElement("svg",{className:a.svgDot,version:"1.1",viewBox:"0, 0, 10, 10"},r.a.createElement("circle",{cx:"5",cy:"5",r:"4",stroke:"#FFFFFF",strokeWidth:"1",fill:"#4444FF"})))},Pl=a(1047),zl=a(1041),Al=Object(je.a)(function(e){return{root:{zIndex:10,position:"absolute"},speedDialFab:{border:"2px solid",background:e.palette.text.primary,color:e.palette.primary.contrastText,width:40,height:40},speedDialAction:{border:"2px solid",background:e.palette.primary.main,color:e.palette.primary.contrastText,marginTop:0,marginBottom:0},speedDialIcon:{},speedDialLabel:{background:"black",color:"white"},actionsClosed:{display:"none"}}}),_l=function(e){var t=e.controlPadding,a=e.currStyle,o=e.mapStyles,i=e.setCurrStyle,l=Object(n.useState)(!1),c=Object(We.a)(l,2),s=c[0],u=c[1],m=Al(),d=Object(Xo.a)(),p=function(e,t){console.log("noEventSetOpen",e,t),e.preventDefault(),e.stopPropagation(),u(t)};if(!o||!Array.isArray(o)||o.length<2||!o[a])return null;var g=o[a].ActiveIcon;return r.a.createElement("div",{className:m.root,style:{top:t.top?t.top:d.spacing(2),right:t.right?t.right:d.spacing(2)}},o.length>1&&r.a.createElement(Pl.a,{ariaLabel:"SpeedDial example",className:m.speedDial,classes:{fab:m.speedDialFab,actionsClosed:m.actionsClosed},icon:r.a.createElement(g,{className:m.icon}),onClick:function(e){return p(e,!s)},onClose:function(e){return p(e,!1)},open:s,direction:"left"},o.map(function(e,t){var a=e.Icon,n=(e.ActiveIcon,e.toolTip);return r.a.createElement(zl.a,{key:"stylebutton".concat(t),icon:r.a.createElement(a,{className:m.speedDialIcon}),tooltipPlacement:"bottom",ButtonProps:{classes:{root:m.speedDialAction}},TooltipClasses:{tooltip:m.speedDialLabel},tooltipTitle:n,tooltipOpen:!0,onClick:function(){i(t),u(!1)}})})))};_l.defaultProps={controlPadding:{}};var Rl=_l,Ml=Object(je.a)(function(e){return{root:{border:"1px solid",background:e.palette.grey[100],color:"black",width:40,height:40,zIndex:10,position:"absolute"}}}),Dl=function(e){var t=e.onClick,a=e.controlPadding,n=e.disabled,o=Ml(),i=Object(Xo.a)();return r.a.createElement(To.a,{disabled:n,style:{top:56+(a.top?a.top:i.spacing(2)),right:a.right?a.right:i.spacing(2)},"aria-label":"myLocation",className:o.root,onClick:t},r.a.createElement(Pi.a,null))},Ll=(a(438),a(439),function(e){var t,a=e.showMe,o=e.children,i=e.mapStyles,l=e.controlPadding,c=e.viewport,s=e.bounds,d=e.lockToBounds,p=e.lockPan,g=e.initStyle,h=e.onViewportChange,f=e.onTransitionStart,b=e.onTransitionEnd,y=e.transitions,v=e.onMapDataEvent,E=e.stylechooser,w=Object(m.a)(e,["showMe","children","mapStyles","controlPadding","viewport","bounds","lockToBounds","lockPan","initStyle","onViewportChange","onTransitionStart","onTransitionEnd","transitions","onMapDataEvent","stylechooser"]),x=Object(n.useRef)(null),O=Object(n.useRef)(null),k=Object(n.useRef)(null),S=Ci(x).size,j=Object(n.useState)(g),C=Object(We.a)(j,2),N=C[0],T=C[1],I=Object(n.useState)(Object(u.a)({},Bl,c)),P=Object(We.a)(I,2),z=P[0],A=P[1],_=Object(n.useState)(!1),R=Object(We.a)(_,2),M=R[0],D=R[1],L=Object(n.useState)(null),F=Object(We.a)(L,2),B=F[0],U=F[1],W=(t=bn()).latitude&&t.longitude?r.a.createElement(Sl.c,{key:"myPos",className:"myPosMarker",captureDrag:!1,latitude:t.latitude,longitude:t.longitude,style:{zIndex:1}},r.a.createElement(Il,{position:t,projection:B})):null;Object(n.useMemo)(function(){if(!(!S||S.width<10||S.height<10)){i.length<=N&&T(g);try{var e=Object(Cl.a)(z);U(e)}catch(t){console.log("ERROR",z),console.error(t)}}},[z.zoom,S]);var G=function(e){var t=Object(u.a)({},e);s&&d&&(t.longitude<s[0]?t.longitude=s[0]:t.longitude>s[2]&&(t.longitude=s[2]),t.latitude<s[1]?t.latitude=s[1]:t.latitude>s[3]&&(t.latitude=s[3])),p&&(t.latitude=z.latitude,t.longitude=z.longitude),M||"function"!==typeof h||h({viewport:t,size:S,projection:B,map:O.current&&O.current.getMap()}),A(t)};return Object(n.useMemo)(function(){if(!(!s||!S||S.width<10||S.height<10||M)){var e=Object(We.a)(s,4),t=e[0],a=e[1],n=e[2],r=e[3];try{var o=new Nl.a(Object(u.a)({},S,z)).fitBounds([[t,a],[n,r]],{padding:40,offset:[0,0]}),i=o.longitude,l=o.latitude,c=o.zoom;A(Object(u.a)({},z,{longitude:i,latitude:l,zoom:c}))}catch(m){console.error(m)}}},[S,s]),Object(n.useEffect)(function(){A(Object(u.a)({},z,c))},[c]),r.a.createElement("div",{className:yr()("mapContainer",e.className),ref:x},S.height>0&&S.width>0&&r.a.createElement(Sl.f,Object.assign({},z,k.current||y,{ref:function(e){O.current=e},height:S.height,width:S.width,mapStyle:N<i.length?i[N].style:i[0].style,onData:v,onTransitionStart:function(){D(!0),"function"===typeof f&&f()},onTransitionEnd:function(){D(!1),k.current=null,b&&b(),"function"===typeof h&&h({viewport:z,size:S,projection:B,map:O.current&&O.current.getMap()})},dragPan:!p,onViewportChange:G,mapboxApiAccessToken:Vt.mapBoxToken},w),o&&Array.isArray(o)?o.map(function(e,t){return e?r.a.cloneElement(Ul(e,z,S.height,S.width,B),{key:"mapChild-".concat(t)}):null}):Ul(o,z,S.height,S.width,B),E&&r.a.createElement(Rl,{controlPadding:l,currStyle:N,mapStyles:i,setCurrStyle:T}),!e.hideNavControls&&r.a.createElement(Sl.d,{onViewportChange:function(e){return G(Object(u.a)({},e,S))},showZoom:!1===!e.touchZoom&&!1===!e.scrollZoom,showCompass:!1===!e.touchRotate&&!1===!e.dragRotate}),a&&!p&&r.a.createElement(r.a.Fragment,null,W,r.a.createElement(Dl,{disabled:!t||!t.latitude,controlPadding:l,onClick:function(){t.latitude&&t.longitude&&(k.current={transitionDuration:2e3,transitionInterpolator:new Sl.a,transitionEasing:jl.a},setTimeout(function(){k.current&&(k.current=null)},2e3),A(Object(u.a)({},z,{latitude:t.latitude,longitude:t.longitude,zoom:z.zoom>10?z.zoom:12})))}}))))});Ll.defaultProps={controlPadding:{},stylechooser:!0,initStyle:0,mapStyles:Vt.styles,lockToBounds:!1};var Fl=Ll,Bl={latitude:49.3050394,longitude:-123.1398254,bearing:0,pitch:0,zoom:12};function Ul(e,t,a,n,r){return"function"===typeof e?e(t,a,n,r):e}var Wl=Object(je.a)(function(e){return{root:{color:e.palette.primary.main,position:"absolute",top:"50%",left:"50%",textAlign:"center",transformOrigin:"50% 50%",transform:"translateY(-50%) translateX(-50%)",zIndex:1},rootActive:{zIndex:60},svgDot:{zIndex:61,width:20,height:20,position:"absolute",top:"50%",left:"50%",textAlign:"center",transformOrigin:"50% 50%",transform:"translateY(-50%) translateX(-50%)"},dot:{stroke:e.palette.secondary.contrastText,strokeWidth:"1",fill:e.palette.secondary.main},directionIndicator:{position:"absolute",left:"50%",zIndex:59},name:{color:"white",fontWeight:"bold",textShadow:"\n        0px 0px 4px #000000, \n        0px 0px 4px #000000 \n    ",zIndex:60,position:"relative"},nameActive:{color:e.palette.secondary.dark,textShadow:"\n    0px 0px 2px #FFFFFF, \n    0px 0px 2px #FFFFFF,\n    0px 0px 4px #FFFFFF \n"}}}),Gl=function(e){var t=e.direction,a=Wl();return r.a.createElement("div",{className:a.root},r.a.createElement("svg",{className:a.svgDot,version:"1.1",viewBox:"0, 0, 10, 10"},r.a.createElement("circle",{cx:"5",cy:"5",r:"4",className:a.dot})),t&&t>=0?r.a.createElement("div",{className:a.directionIndicator},r.a.createElement("svg",{className:a.svgArc,version:"1.1",width:"100",height:"100",viewBox:"0, 0, 100, 100",style:{transform:"translateY(-50%) translateX(-50%) rotateZ(".concat(t,"deg)")}},r.a.createElement("path",{d:"M50,0 C60.946,0.151 72.136,3.514 80.675,10.56 L50,50 L19.325,10.56 C27.938,3.461 39,0.278 50,0 z",fill:"#009DC1",fillOpacity:"0.444",strokeWidth:"0.5",strokeOpacity:"0.6",stroke:"#FFFFFF"}))):null)},Hl=function(e){var t=e.controlPadding,a=e.viewport,o=e.children,i=e.mapStyles,l=e.onMapDataEvent,c=Object(m.a)(e,["controlPadding","viewport","children","mapStyles","onMapDataEvent"]),s=Object(n.useRef)(null),u=Object(n.useRef)(),d=Ci(s,{width:100,height:50}).size,p=Object(n.useState)(0),g=Object(We.a)(p,2),h=g[0],f=g[1],b=Object(n.useState)(null),y=Object(We.a)(b,2),v=y[0],E=y[1],w=function(){if(!(!d||d.width<10||d.height<10))try{var e=Object(Cl.a)(a);E(e)}catch(t){console.error(t)}};return v||w(),Object(n.useMemo)(w,[d]),r.a.createElement("div",{className:yr()("BaseMap",e.className),ref:s,style:{height:"100%",width:"100%"}},r.a.createElement(Sl.e,Object.assign({},a,{height:d.height,width:d.width,mapStyle:i[h].style,onData:l,mapboxApiAccessToken:Vt.mapBoxToken},c,{ref:function(e){u.current=e}}),i&&i.length>1?r.a.createElement(Rl,{controlPadding:t,currStyle:h,mapStyles:i,setCurrStyle:f}):null,o&&Array.isArray(o)?o.map(function(e){return ql(e,u,d.height,d.width,v)}):ql(o,u,d.height,d.width,v)))};function ql(e,t,a,n,r){return"function"===typeof e?e({},a,n,r):e}Hl.defaultProps={controlPadding:{},stylechooser:!0,initStyle:0,mapStyles:Vt.styles};var Ql=Hl,Yl=function(e){var t=e.staticMap,a=e.editable,n=e.latitude,o=e.longitude,i=e.onChange,l=e.direction,c=Object(m.a)(e,["staticMap","editable","latitude","longitude","onChange","direction"]),s=t?Ql:Fl,u=t?{}:{touchRotate:!1,dragRotate:!1,showMe:a,lockPan:!a,onViewportChange:i};return r.a.createElement(s,Object.assign({},u,c),n&&o?r.a.createElement(Sl.c,{className:"singleMarker",latitude:n,longitude:o},r.a.createElement(Gl,{direction:l})):r.a.createElement(Gl,{direction:l}))},$l=a(1048),Vl=Object(je.a)(function(e){return{root:{},dlgContent:{display:"flex",flexDirection:"column",padding:0},mapWrapper:{flexGrow:1},sliderWrapper:{padding:"20px"},slider:{},sliderRoot:{},body:{overflow:"hidden",whiteSpace:"pre-line",paddingBottom:e.spacing(1)},title:{background:e.palette.primary.main,color:e.palette.primary.contrastText,margin:0,padding:e.spacing(2)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}}),Xl=function(e){var t=e.open,a=e.onOk,o=e.onCancel,i=e.title,l=e.latitude,c=e.longitude,s=e.direction,u=Vl(),m=Object(n.useState)({longitude:c,latitude:l}),d=Object(We.a)(m,2),p=d[0],g=p.longitude,h=p.latitude,f=d[1],b=Object(n.useState)(s),y=Object(We.a)(b,2),v=y[0],E=y[1],w=Object(n.useMemo)(function(){return{zoom:18,latitude:l,longitude:c}},[l,c]);return r.a.createElement(qe.a,{scroll:"paper",open:t,fullWidth:!0,fullScreen:!0,onClose:o},r.a.createElement(Qe.a,{className:u.title,disableTypography:!0},r.a.createElement(ke.a,{color:"inherit"},i)),r.a.createElement(Ye.a,{className:u.dlgContent},r.a.createElement("div",{className:u.mapWrapper},r.a.createElement(Yl,{editable:!0,className:u.map,direction:v>0?v:null,viewport:w,onChange:function(e){var t=e.viewport,a=t.longitude,n=t.latitude;return f({longitude:a,latitude:n})}})),r.a.createElement("div",{className:u.sliderWrapper},r.a.createElement(Qo.a,{className:u.mapFormLabel},"Direction ",v>-1?"":"(off)"),r.a.createElement($l.a,{classes:{root:u.sliderRoot},value:v||-1,min:-1,max:360,step:1,onChange:function(e,t){return E(t)}}))),r.a.createElement(Xe.a,null,r.a.createElement(He.a,{onClick:o},"Cancel"),r.a.createElement("div",{style:{flexGrow:1}}),r.a.createElement(He.a,{onClick:function(){return a({longitude:g,latitude:h,direction:v})}},"Ok")))},Zl=Object(je.a)(function(e){return{root:{},body:{},textArea:{whiteSpace:"pre-line",padding:e.spacing(1),border:"1px solid ".concat(e.palette.grey[200]),background:e.palette.grey[100]},dlgContent:{overflow:"hidden"},title:{background:e.palette.primary.main,color:e.palette.primary.contrastText,alignSelf:"flex-start",width:"100%",margin:0,display:"flex",padding:e.spacing(2)},closeButton:{padding:0,alignSelf:"flex-start"}}}),Jl=function(e){var t=e.open,a=e.onOk,o=e.title,i=e.body,l=e.multiline,c=Zl(),s=Object(n.useState)(i||""),u=Object(We.a)(s,2),m=u[0],d=u[1];return r.a.createElement(qe.a,{scroll:"paper",open:t,fullWidth:!0,maxWidth:"xl",onClose:function(){return a(m)}},r.a.createElement(Qe.a,{className:c.title},o),r.a.createElement(Ye.a,{className:c.dlgContent},r.a.createElement(Ve.a,{className:c.body,multiline:l,inputProps:{className:c.textArea},autoFocus:!0,fullWidth:!0,rows:6,rowsMax:6,onChange:function(e){return d(e.target.value)},defaultValue:i})),r.a.createElement(Xe.a,null,r.a.createElement(He.a,{onClick:function(){return a(i)}},"Cancel"),r.a.createElement("div",{style:{flexGrow:1}}),r.a.createElement(He.a,{onClick:function(){return a(m)}},"Ok")))},Kl="mapPicker",ec="noteEdit",tc=Object(je.a)(function(e){return{root:{},inner:{display:"flex",flexDirection:"column"},dlgTitle:{background:e.palette.primary.main,color:e.palette.primary.contrastText},access:{display:"flex",flexDirection:"column"},accessRadio:{margin:e.spacing(2,1)},grow:{flexGrow:1},field:{flexGrow:0,marginBottom:2*e.spacing(1)},slider:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},textField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),width:"100%"},formLabel:{display:"block",marginTop:e.spacing(1),marginBottom:e.spacing(1)},mapFormLabel:{display:"block",marginTop:e.spacing(1),marginBottom:e.spacing(1)},mapInnerWrap:{flexGrow:1,height:"200px",minHeight:"200px"},mapWrapper:{flexGrow:1,display:"flex",flexDirection:"column",paddingBottom:2*e.spacing(1)},formControl:{margin:e.spacing(1),minWidth:120},chips:{display:"flex",flexWrap:"wrap"}}}),ac=function(e){var t=e.series,a=e.delta,o=e.onChange,i=tc(),l=Object(n.useState)(null),c=Object(We.a)(l,2),s=c[0],m=c[1],d={zoom:18};(a.latitude||t.coords[1])&&(a.longitude||t.coords[0])&&(d.longitude=a.longitude||t.coords[0],d.latitude=a.latitude||t.coords[1]);var p=a.access||t.access||"PRIVATE",g="string"===typeof a.name?a.name:t.name||"",h="string"===typeof a.note?a.note:t.note||"",f=!g||g.length<3;return r.a.createElement("div",null,r.a.createElement(Ve.a,{label:"Series Name ".concat(f?"(Required)":""),fullWidth:!0,error:f,placeholder:"New Series",className:i.field,value:g,onChange:function(e){return o(Object(u.a)({},a,{name:e.target.value}))}}),r.a.createElement("div",{className:i.mapWrapper,onClick:function(){return m(Kl)}},r.a.createElement(Qo.a,{className:i.mapFormLabel},"Location"),r.a.createElement("div",{className:i.mapInnerWrap},r.a.createElement(Yl,{staticMap:!0,className:i.map,direction:a.direction||t.direction,viewport:d}))),r.a.createElement("div",{className:i.field},r.a.createElement(Qo.a,null,"Series Access"),r.a.createElement("div",{className:i.access},r.a.createElement(Ol.a,{className:i.accessRadio,control:r.a.createElement(kl.a,{checked:["OPEN","PUBLIC"].indexOf(p)>-1,onChange:function(e){o(Object(u.a)({},a,{access:e.target.checked?"PUBLIC":"PRIVATE"}))},value:"PUBLIC"}),label:r.a.createElement("div",null,r.a.createElement(ke.a,{variant:"body2",component:"div"},ea.PUBLIC.label),r.a.createElement(ke.a,{variant:"caption",color:"textSecondary",component:"div"},ea.PUBLIC.description))}),r.a.createElement(Ol.a,{className:i.accessRadio,disabled:["PRIVATE"].indexOf(p)>-1,control:r.a.createElement(kl.a,{checked:["OPEN"].indexOf(p)>-1,onChange:function(e){return o(Object(u.a)({},a,{access:e.target.checked?"OPEN":"PUBLIC"}))},value:"OPEN"}),label:r.a.createElement("div",null,r.a.createElement(ke.a,{variant:"body2",component:"div"},ea.OPEN.label),r.a.createElement(ke.a,{variant:"caption",color:"textSecondary",component:"div"},ea.OPEN.description))}))),r.a.createElement(ai,{onClick:function(){return m(ec)},className:i.field,label:"Series Note",placeholder:"Click to edit",text:h}),s===Kl&&r.a.createElement(Xl,{open:!0,title:"Series Location & Direction",latitude:a.latitude||t.coords[1],longitude:a.longitude||t.coords[0],direction:a.direction||t.direction,onOk:function(e){o(Object(u.a)({},a,e)),m(null)},onCancel:function(){return m(null)}}),s===ec&&r.a.createElement(Jl,{open:!0,title:"Series Note",body:h,multiline:!0,onOk:function(e){o(Object(u.a)({},a,{note:e})),m(null)},onCancel:function(){return m(null)}}))},nc=Object(je.a)(function(e){return{root:{},inner:{display:"flex",flexDirection:"column"},dlgTitle:{background:e.palette.primary.main,color:e.palette.primary.contrastText},grow:{flexGrow:1},field:{flexGrow:0,marginBottom:e.spacing(2)},slider:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},textField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),width:"100%"},formLabel:{display:"block",marginTop:e.spacing(1),marginBottom:e.spacing(1)},mapFormLabel:{display:"block",marginTop:e.spacing(1),marginBottom:e.spacing(1)},mapInnerWrap:{flexGrow:1},mapWrapper:{flexGrow:1,display:"flex",flexDirection:"column",paddingBottom:e.spacing(2)},formControl:{margin:e.spacing(1),minWidth:120},chips:{display:"flex",flexWrap:"wrap"}}}),rc=function(e){var t=e.onOk,a=e.onCancel,o=nc(),i=Object(n.useContext)(mi).series,l=Object(n.useState)({}),c=Object(We.a)(l,2),s=c[0],m=c[1];return r.a.createElement(qe.a,{scroll:"paper",className:o.root,fullScreen:!0,open:!0,onClose:a},r.a.createElement(Se.a,null),r.a.createElement(Qe.a,{disableTypography:!0,className:o.dlgTitle},r.a.createElement(ke.a,{variant:"subtitle1",color:"inherit",className:o.grow},"Edit Series Details")),r.a.createElement(Ye.a,{className:o.inner},r.a.createElement(ac,{series:i,delta:s,onChange:m})),r.a.createElement(Xe.a,null,r.a.createElement(He.a,{className:o.menuButton,color:"inherit",onClick:function(){return m({})},"aria-label":"Menu"},"Reset"),r.a.createElement(He.a,{className:o.menuButton,color:"inherit",onClick:a,"aria-label":"Menu"},"Cancel"),r.a.createElement(He.a,{className:o.menuButton,color:"inherit",onClick:function(){return t(Object(u.a)({id:i.id},s))},"aria-label":"Menu"},"Ok")))},oc=a(488),ic=a.n(oc),lc=a(487),cc=a.n(lc),sc=Object(je.a)(function(e){return{root:{height:"100%",display:"flex",flexDirection:"column"},swipeAble:{height:"100%"},slideContainer:{flexGrow:1},titleBar:{padding:e.spacing(0,1),height:"35px!important"},mobileStepper:{flexGrow:0,background:e.palette.grey[800],color:e.palette.getContrastText(e.palette.grey[800])},slide:{top:0,zIndex:0,opacity:0,position:"absolute",display:"block",overflow:"hidden",width:"100%",height:"100%",minHeight:300},dotActive:{background:"white"},iconButton:{color:"white"},active:{zIndex:5,opacity:1},last:{opacity:1,zIndex:4},tagContainer:{},labelBadge:{color:"white",zIndex:10,position:"absolute",right:e.spacing(2),bottom:e.spacing(1),opacity:.8},tagChip:{marginRight:e.spacing(1),fontSize:10,height:e.spacing(2),padding:e.spacing(.5)},xyTagChip:{position:"absolute",fontSize:e.spacing(1),height:e.spacing(2)},manualBack:{color:"white",zIndex:10,position:"absolute",transform:"translateY(-50%)",left:0,top:"50%"},manualForward:{color:"white",zIndex:10,position:"absolute",transform:"translateY(-50%)",right:0,top:"50%"}}}),uc=function(e){var t=e.onCancel,a=e.photos,o=e.transition,i=sc(),l=Object(Xo.a)(),c=dc(a.length,o),s=c.activeStep,u=c.lastStep,m=c.handleForward,d=c.handleBack,p=c.paused,g=c.pause,h=c.play,f=Object(n.useState)(!1),b=Object(We.a)(f,2),y=b[0],v=b[1],E=Object(n.useRef)(null),w=Ci(E).size,x=w.height,O=w.width;return r.a.createElement("div",{className:i.root},r.a.createElement(Se.a,null),r.a.createElement("div",{ref:E,className:i.slideContainer},a.map(function(e,n){return r.a.createElement(ul.a,{key:"slide-".concat(n),className:yr()(i.slide,s===n&&i.active,u===n&&i.last),onClick:function(){return v(!y)},style:{height:x,width:O,transition:l.transitions.create(["opacity"],{duration:.25*o})}},r.a.createElement(ol,{photo:e,className:i.photo,showTags:y}),r.a.createElement(ke.a,{className:i.labelBadge},"Tags: ",y?"On ":"Off ",r.a.createElement(bi.a,{color:"secondary",badgeContent:a[s].tags.filter(function(e){return e.coords}).length},r.a.createElement(vi.a,{color:"inherit"}))),r.a.createElement(fi.a,{className:i.titleBar,titlePosition:"top",title:r.a.createElement(ke.a,{color:"inherit",variant:"caption"},r.a.createElement(oo.a,{className:i.iconButton,onClick:function(e){return t()}},r.a.createElement(so.a,null)),Object(si.d)(e.takenOn)),subtitle:r.a.createElement("em",null,p?"Paused":"    "),actionIcon:p?r.a.createElement(oo.a,{className:i.iconButton,onClick:function(e){e.preventDefault(),e.stopPropagation(),h()}},r.a.createElement(cc.a,null)):r.a.createElement(oo.a,{className:i.iconButton,onClick:function(e){e.preventDefault(),e.stopPropagation(),g()}},r.a.createElement(ic.a,null))}))}),r.a.createElement(oo.a,{size:"small",className:i.manualBack,onClick:d,color:"inherit"},"rtl"===l.direction?r.a.createElement(Oi.a,null):r.a.createElement(wi.a,null)),r.a.createElement(oo.a,{size:"small",className:i.manualForward,onClick:m,color:"inherit"},"rtl"===l.direction?r.a.createElement(wi.a,null):r.a.createElement(Oi.a,null))),r.a.createElement(hi.a,{steps:a.length,position:"static",activeStep:s,classes:{root:i.mobileStepper,dotActive:i.dotActive},nextButton:r.a.createElement(He.a,{color:"inherit",size:"small",onClick:m,disabled:s===a.length-1},"Next","rtl"===l.direction?r.a.createElement(wi.a,null):r.a.createElement(Oi.a,null)),backButton:r.a.createElement(He.a,{color:"inherit",size:"small",onClick:d,disabled:0===s},"rtl"===l.direction?r.a.createElement(Oi.a,null):r.a.createElement(wi.a,null),"Back")}))};uc.defaultProps={transition:5e3,isFullScreen:!1,slides:[]};var mc=uc,dc=function(e,t){var a=Object(n.useState)(0),r=Object(We.a)(a,2),o=r[0],i=r[1],l=Object(n.useState)(!1),c=Object(We.a)(l,2),s=c[0],u=c[1],m=Object(n.useState)(0),d=Object(We.a)(m,2),p=d[0],g=d[1],h=Object(n.useRef)(),f=function(){h.current=window.setInterval(function(){return i(function(t){return g(t),t+1>=e?0:t+1})},t)},b=function(){h.current&&window.clearInterval(h.current)};return Object(n.useEffect)(function(){return f(),function(){b()}},[]),{activeStep:o,lastStep:p,handleForward:function(){g(o),i(o+1>=e?0:o+1),s||(b(),f())},handleBack:function(){g(o),i(o-1<0?e-1:o-1),s||(b(),f())},setActiveStep:i,paused:s,pause:function(){b(),u(!0)},play:function(){u(!1),b(),f()}}},pc=a(255),gc=a.n(pc),hc=Object(je.a)(function(e){return{}}),fc=function(e){var t=e.title,a=e.message,n=e.onConfirm,o=e.open,i=hc();return r.a.createElement(qe.a,{className:i.root,disableBackdropClick:!0,fullWidth:!0,open:o,disableEscapeKeyDown:!0,maxWidth:"xl","aria-labelledby":"confirmation-dialog-title"},r.a.createElement(Qe.a,{id:"confirmation-dialog-title"},t),r.a.createElement(Ye.a,null,r.a.createElement(ke.a,null,a)),r.a.createElement(Xe.a,null,r.a.createElement(He.a,{onClick:function(){return n(!1)},color:"primary"},"No"),r.a.createElement(He.a,{onClick:function(){return n(!0)},color:"secondary"},"Yes")))},bc=function(e){return{root:{width:"100%"},tagContainer:{},formControl:{},actionButtons:{textAlign:"right"},noOptionsMessage:{padding:e.spacing(1,2)},singleValue:{fontSize:16},placeholder:{position:"absolute",left:2,fontSize:16},input:{display:"flex",padding:0},valueContainer:{display:"flex",flexWrap:"wrap",flex:1,alignItems:"center",overflow:"hidden"},paper:{position:"absolute",zIndex:1,marginTop:e.spacing(1),left:0,right:0}}},yc=Object(je.a)(bc),vc=function(e){var t=e.tags,a=(e.label,e.tagConfig),n=e.className,o=yc(),i=t.filter(function(e){return e.typeId===a.id&&!e.coords});return r.a.createElement("div",{className:yr()(o.root,n)},r.a.createElement(ke.a,{variant:"overline",className:o.fieldTitle},a.label),r.a.createElement("div",{className:o.tagContainer},i.map(function(e,t){return r.a.createElement(Ko,{tag:e,key:"tagchip".concat(t),color:a.color})})))},Ec=Object(je.a)(function(e){return{root:{},rootEdit:{},formControl:{width:"100%"},textBody:{whiteSpace:"pre-line"},actionButtons:{textAlign:"right"}}}),wc=function(e){var t=e.label,a=e.value,n=e.hint,o=e.onChange,i=e.className,l=Ec();return r.a.createElement("div",{className:yr()(l.root,i)},r.a.createElement(ke.a,{variant:"overline",className:l.fieldTitle},t),r.a.createElement(Ve.a,{type:"datetime-local",fullWidth:!0,value:Object(si.e)(a),className:l.textField,onChange:function(e){return o(Object(si.a)(e.target.value))}}),n&&r.a.createElement(ke.a,{variant:"caption",className:l.hint},n))},xc=Object(je.a)(bc),Oc=function(e){var t=e.tags,a=e.onChange,n=e.hint,o=e.tagConfig,i=e.className,l=xc(),c=function(e,n){var r=n.action,i=n.removedValue,l=n.option;switch(r){case"clear":a([]);break;case"remove-value":a(t.filter(function(e){return e.id!==i.value}));break;case"select-option":var c=Object(u.a)({},o.values.find(function(e){return e.id===l.value}),{typeId:o.id});a([].concat(Object(ra.a)(t),[c]));break;case"create-option":var s={label:e.find(function(e){return e.__isNew__}).value,typeId:o.id};a([].concat(Object(ra.a)(t),[s]))}},s=t.filter(function(e){return e.typeId===o.id&&!e.coords}),m=s.map(function(e){return{label:e.label,value:e.id}}),d=o.values.filter(function(e){return-1===s.map(function(e){return e.id}).indexOf(e.id)}).map(function(e){return{label:e.label,value:e.id}});return r.a.createElement("div",{className:yr()(l.root,i)},r.a.createElement(ke.a,{variant:"overline",className:l.fieldTitle},o.label),!o.allowAdditions&&r.a.createElement(Ri.a,{options:d,classes:l,isFocused:!0,components:{Control:kc,Menu:jc,NoOptionsMessage:Sc,Option:Tc,Placeholder:Nc,ValueContainer:Ic},deleteRemoves:!0,value:m,isClearable:!1,onChange:c,placeholder:"Select Tags",isMulti:!0,isSearchable:!0}),o.allowAdditions&&r.a.createElement(Di.a,{options:d,classes:l,isFocused:!0,deleteRemoves:!0,components:{Control:kc,Menu:jc,NoOptionsMessage:Sc,Option:Tc,Placeholder:Nc,ValueContainer:Ic},value:m,isClearable:!1,onChange:c,placeholder:"Select Tags",isMulti:!0,isSearchable:!0}),n&&r.a.createElement(ke.a,{variant:"caption",className:l.hint},n))};function kc(e){return r.a.createElement(Ve.a,Object.assign({fullWidth:!0,InputProps:{inputComponent:Cc,inputProps:{className:e.selectProps.classes.input,inputRef:e.innerRef,children:e.children,onMouseDown:function(t){e.innerProps.onMouseDown(t)},onTouchEnd:function(t){e.innerProps.onTouchEnd(t)}}}},e.selectProps.textFieldProps))}var Sc=function(e){var t=e.innerProps,a=e.selectProps,n=e.children;return r.a.createElement(ke.a,Object.assign({color:"textSecondary",className:a.classes.noOptionsMessage},t),n)},jc=function(e){var t=e.selectProps,a=e.innerProps,n=e.children;return r.a.createElement(wn.a,Object.assign({square:!0,className:t.classes.paper},a),n)},Cc=function(e){var t=e.inputRef,a=Object(m.a)(e,["inputRef"]);return r.a.createElement("div",Object.assign({ref:t},a))},Nc=function(e){return r.a.createElement(ke.a,Object.assign({color:"textSecondary",className:e.selectProps.classes.placeholder},e.innerProps),e.children)},Tc=function(e){var t=e.innerRef,a=e.isFocused,n=e.isSelected,o=e.innerProps,i=e.children;return r.a.createElement(Do.a,Object.assign({buttonRef:t,selected:a,component:"div",style:{fontWeight:n?500:400}},o),i)},Ic=function(e){var t=e.selectProps,a=e.children;return r.a.createElement("div",{className:t.classes.valueContainer},a)},Pc=Object(je.a)(function(e){return{root:{},dlgContent:{overflowY:"visible!important",paddingBottom:300},title:{width:"100%",margin:0,display:"flex",padding:e.spacing(2)},dlgTitle:{flexGrow:1},closeButton:{color:e.palette.grey[500]}}}),zc=function(e){var t=e.open,a=e.title,o=e.onOk,i=e.onCancel,l=e.tags,c=e.tagConfig,s=Pc(),u=Object(n.useState)(l),m=Object(We.a)(u,2),d=m[0],p=m[1];return r.a.createElement(qe.a,{className:s.root,scroll:"body",fullScreen:!0,open:t,onClose:function(){return o(d)}},r.a.createElement(Qe.a,{className:s.title,disableTypography:!0},r.a.createElement(ke.a,{className:s.dlgTitle},a),r.a.createElement(oo.a,{className:s.closeButton,onClick:i},r.a.createElement(ii.a,null))),r.a.createElement(Ye.a,{className:s.dlgContent},r.a.createElement(Oc,{className:s.field,tags:d,tagConfig:c,onChange:p})),r.a.createElement(Xe.a,null,r.a.createElement(He.a,{onClick:i},"Cancel"),r.a.createElement("div",{style:{flexGrow:1}}),r.a.createElement(He.a,{onClick:function(){return p(l)}},"Reset"),r.a.createElement(He.a,{onClick:function(){return o(d)}},"Ok")))},Ac=Object(je.a)(function(e){return{root:{},rootEdit:{},formControl:{width:"100%"},textBody:{whiteSpace:"pre-line"},actionButtons:{textAlign:"right"}}}),_c=function(e){var t=e.label,a=e.value,n=e.className,o=Ac();return r.a.createElement("div",{className:yr()(o.root,n)},r.a.createElement(ke.a,{variant:"overline",className:o.fieldTitle},t),r.a.createElement(ke.a,{variant:"body1",className:o.hint},a?Object(si.d)(a):""))},Rc=Object(je.a)(function(e){return{root:{height:"90%",width:"85%"},dlgTitleContainer:{display:"flex",padding:0},catTagTitle:{marginTop:e.spacing(2)},dlgTitle:{flexGrow:1,paddingTop:e.spacing(2),paddingBottom:e.spacing(1),paddingLeft:e.spacing(3)},field:{marginBottom:e.spacing(2)}}}),Mc="noteEdit",Dc="noteView",Lc="tag",Fc=function(e){var t=e.canEdit,a=e.photo,o=e.delta,i=e.onChange,l=e.hideUser,c=Rc(),s=Object(n.useContext)(mi).seriesConfig,u=Object(n.useState)({}),m=Object(We.a)(u,2),d=m[0],p=d.activeDialog,g=d.activeDialogContext,h=m[1],f="string"===typeof o.note?o.note:a.note||"",b=new Vi(s,o.tags||a.tags),y=[];try{y=a.meta?Object.keys(JSON.parse(a.meta)):[]}catch(v){console.error(v)}return r.a.createElement("div",null,!l&&a.createdUser&&r.a.createElement(r.a.Fragment,null,r.a.createElement(ri,{user:a.createdUser,secondary:"uploaded this photo"}),r.a.createElement(Bo.a,null)),t?r.a.createElement(wc,{className:c.field,label:"Photo taken on",value:o.takenOn||a.takenOn,onChange:function(e){return i({takenOn:e})},canEdit:t}):r.a.createElement(_c,{label:"Photo taken on",value:o.takenOn||a.takenOn}),(t||a.note)&&r.a.createElement(ai,{label:"Photo Note",placeholder:t?"Click to edit":"None",text:f,onClick:function(){h(t?{activeDialog:Mc}:{activeDialog:Dc})}}),r.a.createElement(ke.a,{variant:"subtitle1",className:c.catTagTitle},"Category tags"),r.a.createElement(Bo.a,null),b.seriesConfig.getNonXYTagTypes().map(function(e,n){return r.a.createElement("div",{key:"tagtype-".concat(n),onClick:function(){return t?h({activeDialog:Lc,activeDialogContext:e}):null}},r.a.createElement(vc,{className:c.field,label:e.label,tags:o.tags||a.tags,tagConfig:e}))}),y.length>0&&Object.keys(s.meta).length>0&&r.a.createElement(r.a.Fragment,null,r.a.createElement(ke.a,{className:c.heading},"Metadata"),r.a.createElement(Bo.a,null),r.a.createElement(Wo.a,{className:c.list},y.map(function(e,t){return s.meta[e]?r.a.createElement(Go.a,{key:"metadata".concat(t)},r.a.createElement(Fo.a,{primary:s.meta[e].label,secondary:s.meta[e].render(a.meta[e])})):null}))),p&&p===Mc&&r.a.createElement(Jl,{open:!0,multiline:!0,onOk:function(e){i({note:e}),h({})},title:"Edit Photo Note",body:f}),p&&p===Dc&&r.a.createElement(ci,{open:!0,multiline:!0,onClose:function(){return h({})},title:"Photo Note",body:f}),p&&p===Lc&&r.a.createElement(zc,{open:!0,title:"Edit Tags: ".concat(g.label),onOk:function(e){h({}),i({tags:e})},onCancel:function(){return h({})},tags:o.tags||a.tags,tagConfig:g}))},Bc=Object(je.a)(function(e){return{root:{height:"90%",width:"85%"},dlgTitleContainer:{color:e.palette.primary.contrastText,background:e.palette.primary.main,display:"flex",padding:0},dlgTitle:{flexGrow:1,paddingTop:e.spacing(2),paddingBottom:e.spacing(1),paddingLeft:e.spacing(3)},field:{marginBottom:e.spacing(2)}}}),Uc="cancel",Wc=function(e){var t=e.canEdit,a=e.photo,o=e.onCancel,i=e.onOk,l=e.open,c=Bc(),s=Object(n.useState)(null),m=Object(We.a)(s,2),d=m[0],p=m[1],g=Object(n.useState)({}),h=Object(We.a)(g,2),f=h[0],b=h[1],y=f&&Object.keys(f).length>0;return r.a.createElement(qe.a,{fullScreen:!0,onClose:function(){y?p(Uc):o()},"aria-labelledby":"customized-dialog-title",open:l},r.a.createElement(Qe.a,{disableTypography:!0,className:c.dlgTitleContainer},r.a.createElement(ke.a,{variant:"h5",className:c.dlgTitle},"Photo Properties"),r.a.createElement(oo.a,{onClick:o,color:"inherit"},r.a.createElement(ii.a,null))),r.a.createElement(Ye.a,null,r.a.createElement(Fc,{photo:a,delta:f,onChange:function(e){return b(Object(u.a)({},f,e))},canEdit:t})),r.a.createElement(Xe.a,null,!t&&r.a.createElement(He.a,{onClick:o,color:"primary"},"Ok"),t&&!y&&r.a.createElement(He.a,{onClick:o,color:"primary"},"Back"),t&&y&&r.a.createElement(r.a.Fragment,null,r.a.createElement(He.a,{onClick:function(){return p(Uc)},color:"primary"},"Cancel"),r.a.createElement(He.a,{onClick:function(){return b({})},color:"primary"},"Reset"),r.a.createElement(He.a,{onClick:function(){return i(f)},color:"primary"},"Ok"))),d&&d===Uc&&r.a.createElement(fc,{open:!0,title:"Lose unsaved changes?",message:"You will lose any changes you made to this form",onConfirm:function(e){p(null),e&&o()}}))},Gc=Object(je.a)(function(e){return{root:{display:"flex",height:"100%",flexDirection:"column",overflow:"hidden"},appBar:{flexGrow:0},appBarEdit:{color:e.palette.secondary.contrastText,background:e.palette.secondary.main},grow:{flexGrow:1},photoWrapper:{height:"100%"},inner:{flex:"1 1",position:"relative"},tabMenu:{marginTop:e.spacing(7)},tipChip:{position:"absolute",zIndex:11,bottom:20,left:"50%",opacity:.6,transform:"translateX(-50%)"},mobileStepper:{background:"none"},dots:{margin:"0 auto"},dot:{border:"1px solid #FFFFFF77"},dotActive:{background:e.palette.secondary.main},activeButton:{color:e.palette.primary.main,opacity:1}}}),Hc=0,qc=1,Qc=2,Yc=3,$c=4,Vc=function(e){var t=e.photos,a=e.initPhotoId,o=e.onMenuBack,i=e.onUpdatePhoto,l=e.newPhoto,c=Gc(),s=Object(Xo.a)(),m=Object(n.useContext)(mi),d=m.series,p=m.seriesConfig,g=m.ac,h=Object(ra.a)(t);h.sort(function(e,t){return parseInt(t.takenOn,10)-parseInt(e.takenOn,10)});var f=Object(n.useState)(a?h.findIndex(function(e){return e.id===a}):0),b=Object(We.a)(f,2),y=b[0],v=b[1],E=t[y],w=Object(n.useState)(l?E:{}),x=Object(We.a)(w,2),O=x[0],k=x[1],S=Object(n.useState)({current:l?$c:Hc,last:null}),j=Object(We.a)(S,2),C=j[0],N=j[1],T=new Vi(p,O.tags||E.tags),I=function(e){N({current:e,last:C.current})},P=function(){I(Qc),i(E,Object(u.a)({id:E.id},O))},z={update:g.canUser("update",d,"series")||g.canUser("update",E,"photo")};return r.a.createElement("div",{className:c.root},r.a.createElement(Se.a,null)," ",r.a.createElement(ro.a,{position:"static",className:yr()(c.appBar,C.current!==Hc?c.appBarEdit:null)},r.a.createElement(Ga.a,{disableGutters:!0},C.current!==$c&&r.a.createElement(oo.a,{className:c.menuButton,color:"inherit","aria-label":"Menu",onClick:function(){return o()}},r.a.createElement(so.a,null)),r.a.createElement("div",{className:c.grow},r.a.createElement(ke.a,{variant:"subtitle2",color:"inherit"},l?"Add Tags":"Photo View (".concat(y+1,"/").concat(t.length,")")),r.a.createElement(ke.a,{variant:"subtitle2",color:"inherit"},Object(si.d)(E.takenOn,"lll"))),C.current===Yc&&r.a.createElement(He.a,{color:"inherit",onClick:function(){I(Qc),k(E)}},"Cancel"),C.current===Yc&&r.a.createElement(He.a,{color:"inherit",onClick:P},"Save"),C.current===$c&&r.a.createElement(He.a,{color:"inherit",onClick:function(){i(E,Object(u.a)({id:E.id},O)),o()}},"Next"),z.update&&C.current===Qc&&r.a.createElement(He.a,{color:"inherit",onClick:function(){return I(Yc)}},"Edit"),C.current!==Yc&&C.current!==$c&&r.a.createElement(oo.a,{color:"inherit",className:yr()(c.tagButton,C.current===Qc&&c.activeButton),onClick:function(){return I(C.current===Qc?Hc:Qc)}},r.a.createElement(bi.a,{className:c.margin,badgeContent:T.getXYTags().length,color:"primary"},r.a.createElement(vi.a,{color:"inherit"}))),C.current!==Yc&&C.current!==$c&&r.a.createElement(oo.a,{color:"inherit",className:yr()(c.infoButton,C.current===qc&&c.activeButton),onClick:function(){return I(C.current===qc?Hc:qc)}},r.a.createElement(gc.a,null)))),r.a.createElement("div",{className:c.inner},r.a.createElement(Si.a,{axis:"rtl"===s.direction?"x-reverse":"x",index:y,containerStyle:{height:"100%"},style:{height:"100%"},disabled:C.current!==Hc,onChangeIndex:function(e){return v(e)},enableMouseEvents:!0},h.map(function(e,t){return r.a.createElement("div",{className:c.photoWrapper,key:"swipeshowpic-".concat(t)},r.a.createElement(ol,{showTags:C.current===Qc,photo:Object(u.a)({},e,O),edit:z.update&&(C.current===Yc||C.current===$c),onChange:k,onCommitTags:P}))})),C.current===Hc&&r.a.createElement(hi.a,{steps:h.length,position:"bottom",activeStep:y,classes:{root:c.mobileStepper,dots:c.dots,dot:c.dot,dotActive:c.dotActive}})),r.a.createElement(Wc,{open:C.current===qc,photo:E,canEdit:z.update,onOk:function(e){i(E,Object(u.a)({id:E.id},e)),I(C.last)},onCancel:function(){return I(C.last)}}),(C.current===Yc||C.current===$c)&&r.a.createElement(Yo.a,{label:"Tap to tag features...",onClick:function(){},className:c.tipChip}))},Xc=a(1039),Zc=Object(je.a)(function(e){return{root:{color:"white",zIndex:10,display:"flex",flexDirection:"column",position:"absolute",height:"50%",top:"45%",left:"0",transform:"translateY(-50%)"},sliderLabel:{display:"block",flexGrow:1,textAlign:"center",padding:e.spacing(3,0,3,0),textShadow:"0 0 5px black, 0 0 5px black"},vertical:{padding:"0px 31px!important",width:"4px!important"},rail:{width:"4px!important",background:e.palette.primary.dark,boxShadow:"0 0 10px 5px black"},track:{width:"4px!important",background:e.palette.primary.main},thumb:{background:e.palette.primary.main,border:"1px solid ".concat(e.palette.primary.dark),marginLeft:"-8px !important",width:20,height:20}}}),Jc=function(e){var t=e.defaultValue,a=e.onChange,o=Zc(),i=Object(n.useState)(t),l=Object(We.a)(i,2),c=l[0],s=l[1];return r.a.createElement("div",{className:o.root},r.a.createElement(ke.a,{className:o.sliderLabel,color:"inherit",variant:"caption"},"New"),r.a.createElement($l.a,{classes:{vertical:o.vertical,rail:o.rail,track:o.track,thumb:o.thumb},value:c,"aria-labelledby":"label",onChange:function(e,t){s(t),a(t)},orientation:"vertical"}),r.a.createElement(ke.a,{className:o.sliderLabel,color:"inherit",variant:"caption"},"Reference"))};Jc.defaultProps={defaultValue:100,onChange:function(){}};var Kc=Jc,es=Object(je.a)(function(e){return{root:{background:"rgb(150,150, 150)",height:"100%",width:"100%"},captured:{zIndex:3,position:"absolute",height:"100%",width:"100%"},reference:{zIndex:2,position:"absolute",height:"100%",width:"100%"},libraryFab:{position:"absolute",zIndex:10,"@media (orientation: landscape)":{left:"15px",top:"15px",height:"15vh",width:"15vh"},"@media (orientation: portrait)":{left:"15px",top:"15px",height:"15vw",width:"15vw"}},swipeDrawer:{width:"50%"},referenceTextContainer:{width:"100%",display:"flex",color:"white",background:"rgba(0,0,0,0.5)",padding:e.spacing(3),position:"absolute",zIndex:4,top:0},newText:{flexGrow:1,color:"white",textShadow:"1 1 1 black",textAlign:"right"},refText:{flexGrow:1,color:"white",textShadow:"1 1 1 black"}}}),ts=function(e){var t=e.captured,a=e.defaultRefPhotoId,o=e.onConfirm,i=e.onCancel,l=e.onRetry,c=e.dataUrl,s=Object(n.useContext)(mi),u=s.series,m=s.seriesConfig,d=u&&u.photos?u.photos:null,p=es(),g=a?d.find(function(e){return e.id===a}):d&&d.length>0?d[0]:null,h=Object(n.useState)(g),f=Object(We.a)(h,2),b=f[0],y=f[1],v=Object(n.useState)(!1),E=Object(We.a)(v,2),w=E[0],x=E[1],O=Object(n.useState)(100),k=Object(We.a)(O,2),S=k[0],j=k[1];return t?r.a.createElement("div",{className:p.root},r.a.createElement(Se.a,null),Boolean(b)&&r.a.createElement(Kc,{defaultValue:100,onChange:j}),r.a.createElement("div",{className:p.captured},r.a.createElement(nl,{sizePriority:["large","medium","thumb"],style:{opacity:S/100},dataUrl:c,photo:t})),Boolean(b)&&r.a.createElement("div",{className:p.reference},r.a.createElement(nl,{sizePriority:["large","medium","thumb"],getPhotoUrls:m.getPhotoUrls,photo:b})),r.a.createElement(En.a,{open:!0,autoHideDuration:null,ContentProps:{"aria-describedby":"snackbar-fab-message-id",className:p.snackbarContent},message:r.a.createElement("span",{id:"snackbar-fab-message-id"},"Keep this photo?"),action:r.a.createElement("div",null,r.a.createElement(He.a,{color:"inherit",size:"small",onClick:i},"Cancel"),Boolean(l)&&r.a.createElement(He.a,{color:"inherit",size:"small",onClick:l},"Retry"),r.a.createElement(He.a,{color:"inherit",size:"small",onClick:o},"Keep")),className:p.snackbar}),u&&u.photos&&r.a.createElement(To.a,{"aria-label":"library",className:yr()(p.libraryFab,p.buttonFab),classes:{disabled:p.disabledFab},disabled:!u||!u.photos||0===u.photos.length,onClick:function(){return x(!0)}},r.a.createElement(Ao.a,{className:p.libraryIcon})),u&&u.photos&&r.a.createElement(Xc.a,{anchor:"left",open:w,classes:{paperAnchorLeft:p.swipeDrawer},onClose:function(){return x(!1)},onOpen:function(){return x(!0)}},r.a.createElement("div",{tabIndex:0,className:p.swipeDrawerContainer,role:"button",onClick:function(){return x(!1)},onKeyDown:function(){return x(!1)}},r.a.createElement(vl,{multiSelect:!1,columns:1,photos:u.photos,onTileClick:function(e){y(u.photos.find(function(t){return t.id===e})),x(!1)}})))):"Loading..."},as=a(256),ns=a.n(as),rs=function(e,t,a){var r=Object(n.useState)(!1),o=Object(We.a)(r,2),i=o[0],l=o[1],c=Object(n.useState)(!1),s=Object(We.a)(c,2),m=s[0],d=s[1],p=Object(n.useRef)();Object(n.useEffect)(function(){p.current=new os(document.getElementById("webcam"),document.createElement("canvas")),p.current.setup(a||window.innerWidth,t||window.innerHeight).then(function(e){d(!0)}).catch(function(e){console.error(e),l(!0)})},[]),Object(n.useEffect)(function(){p.current&&p.current.setup(t,a).then(function(e){d(!0)}).catch(function(e){console.error(e),l(!0)})},[t,a]),Object(n.useEffect)(function(){return function(){p.current&&(p.current.destroy(),p.current=null)}},[]);return{cameraError:i,captureImage:function(){if(p.current&&m){var t=p.current.takeDataURLPhoto({type:"jpeg",quality:1});e(Object(u.a)({},t,{name:"upload.jpg",ext:"jpg"}))}},cameraOnline:m,captureRawData:function(){if(p.current&&m){var t=p.current.takeImageData();e(t)}}}},os=function(){function e(t,a){Object(Me.a)(this,e),this.webcamElement=t,this.canvasElement=a,"https:"!==window.location.protocol&&"localhost"!==window.location.hostname&&console.warn("getUserMedia() must be run from a secure origin: https or localhost.\nChanging protocol to https."),navigator.mediaDevices||navigator.getUserMedia||console.warn("Your browser doesn't support navigator.mediaDevices.getUserMedia and navigator.getUserMedia.")}return Object(De.a)(e,[{key:"adjustVideoSize",value:function(e,t){var a=e/t;e>=t?this.webcamElement.width=a*this.webcamElement.height:e<t&&(this.webcamElement.height=this.webcamElement.width/a)}},{key:"destroy",value:function(){var e=Object(s.a)(c.a.mark(function e(){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{this.webcamElement.srcObject.getTracks()[0].stop(),this.canvasElement=null}catch(t){console.error(t)}case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"setup",value:function(){var e=Object(s.a)(c.a.mark(function e(t,a){var n=this;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,r){void 0!==navigator.mediaDevices.getUserMedia?(n.webcamElement.srcObject&&(n.webcamElement.srcObject.getTracks()[0].stop(),n.webcamElement.srcObject=null),navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment",width:t,height:a}}).then(function(t){"srcObject"in n.webcamElement?n.webcamElement.srcObject=t:n.webcamElement.src=window.URL.createObjectURL(t),n.webcamElement.onloadedmetadata=function(e){n.webcamElement.play()},n.webcamElement.onplaying=function(t){e()}}).catch(function(e){return r(e)})):r(new Error("Error accessing camera"))}));case 1:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"_drawImage",value:function(){var e=this.webcamElement.videoWidth,t=this.webcamElement.videoHeight,a=this.canvasElement.getContext("2d");return this.canvasElement.width=e,this.canvasElement.height=t,a.drawImage(this.webcamElement,0,0,e,t),{imageHeight:t,imageWidth:e}}},{key:"takeImageData",value:function(){var e=this._drawImage(),t=e.imageHeight,a=e.imageWidth,n={data:null,imageHeight:t,imageWidth:a};try{n.data=this.canvasElement.getContext("2d").getImageData(0,0,a,t).data}catch(r){}return n}},{key:"takeBlobPhoto",value:function(){var e=this,t=this._drawImage(),a=t.imageWidth,n=t.imageHeight;return new Promise(function(t,r){e.canvasElement.toBlob(function(e){t({fileBlob:e,imageHeight:n,imageWidth:a})})})}},{key:"takeDataURLPhoto",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{type:"jpeg",quality:1},t=e.type,a=e.quality,n=this._drawImage(),r=n.imageHeight,o=n.imageWidth;return{dataUrl:this.canvasElement.toDataURL("image/"+t,a),imageHeight:r,imageWidth:o,type:"image/"+t}}}]),e}(),is=Object(je.a)(function(e){return{root:{background:"black",height:"100%",width:"100%"},cameraErrorText:{color:"white",position:"absolute",top:"50%",left:"50%",width:"90%",transform:"translateY(-50%) translateX(-50%)",textAlign:"center"},disabledFab:{color:"#AAAAA!important",background:"#DDDDDD!important",opacity:.2},cameraFab:{position:"absolute",zIndex:10,"@media (orientation: landscape)":{right:"20px",top:"50%",transform:"translateY(-50%)",height:"25vh",width:"25vh"},"@media (orientation: portrait)":{bottom:"20px",left:"50%",transform:"translateX(-50%)",height:"25vw",width:"25vw"}},cameraIcon:{height:"100%",width:"100%"},cancelFab:{position:"absolute",zIndex:10,"@media (orientation: landscape)":{right:"15px",top:"15px",height:"15vh",width:"15vh"},"@media (orientation: portrait)":{right:"15px",bottom:"15px",height:"15vw",width:"15vw"}},cancelIcon:{height:"100%",width:"100%"},swipeDrawer:{width:"50%"},libraryFab:{position:"absolute",zIndex:10,"@media (orientation: landscape)":{left:"15px",top:"15px",height:"15vh",width:"15vh"},"@media (orientation: portrait)":{left:"15px",top:"15px",height:"15vw",width:"15vw"}},myLocationFab:{position:"absolute",zIndex:10,"@media (orientation: landscape)":{right:"15px",bottom:"15px",height:"15vh",width:"15vh"},"@media (orientation: portrait)":{left:"15px",bottom:"15px",height:"15vw",width:"15vw"}},myLocationIcon:{height:"80%",width:"80%"},captured:{},reference:{position:"absolute",zIndex:2,top:0,left:0,height:"100%",width:"100%"},video:{position:"absolute",zIndex:1,top:0,left:0,height:"100%",width:"100%"}}}),ls=function(e){var t=e.onCancel,a=e.onShutter,o=e.defaultRefPhotoId,i=is(),l=Object(n.useState)(50),c=Object(We.a)(l,2),s=c[0],u=c[1],m=Object(n.useState)([null,null]),d=Object(We.a)(m,2),p=d[0],g=d[1],h=Object(n.useContext)(mi),f=h.series,b=h.seriesConfig,y=o?f.photos.find(function(e){return e.id===o}):f&&f.photos&&f.photos.length>0?f.photos[0]:null,v=Object(n.useState)(y),E=Object(We.a)(v,2),w=E[0],x=E[1],O=Object(n.useState)(!1),k=Object(We.a)(O,2),S=k[0],j=k[1],C=rs(function(e){return a(e,w?w.id:null)},p[0],p[1]),N=C.cameraError,T=C.captureImage,I=C.cameraOnline,P=function(){g([window.innerWidth,window.innerHeight])};return Object(n.useLayoutEffect)(function(){return P(),window.addEventListener("resize",P),function(){window.removeEventListener("resize",P)}},[]),r.a.createElement("div",{className:i.root},r.a.createElement(Se.a,null),!N&&Boolean(w)&&r.a.createElement(Kc,{defaultValue:s,onChange:u}),N&&r.a.createElement("div",{className:i.cameraErrorText},r.a.createElement(ke.a,{variant:"subtitle1",color:"inherit"},"No Camera Access"),r.a.createElement(ke.a,{variant:"body2",color:"inherit"},"Please enabled access in your settings.")),Boolean(w)&&r.a.createElement("div",{className:i.reference},r.a.createElement(nl,{sizePriority:["large","medium","thumb"],getPhotoUrls:b.getPhotoUrls,style:{opacity:s/100},photo:w})),!N&&r.a.createElement("video",{autoPlay:!0,playsInline:!0,muted:!0,id:"webcam",width:window.innerWidth,height:window.innerHeight,className:i.video}),r.a.createElement(To.a,{color:"primary","aria-label":"Take Photo",classes:{disabled:i.disabledFab},disabled:N||!I,className:yr()(i.cameraFab,i.buttonFab),onClick:T},r.a.createElement(ns.a,{className:i.cameraIcon})),r.a.createElement(To.a,{color:"secondary","aria-label":"cancel",onClick:t,classes:{disabled:i.disabledFab},className:yr()(i.cancelFab,i.buttonFab)},r.a.createElement(Vo.a,{className:i.cancelIcon})),f&&f.photos&&r.a.createElement(To.a,{"aria-label":"library",className:yr()(i.libraryFab,i.buttonFab),classes:{disabled:i.disabledFab},disabled:!f||!f.photos||0===f.photos.length,onClick:function(){return j(!0)}},r.a.createElement(Ao.a,{className:i.libraryIcon})),f&&f.photos&&r.a.createElement(Xc.a,{anchor:"left",open:S,classes:{paperAnchorLeft:i.swipeDrawer},onClose:function(){return j(!1)},onOpen:function(){return j(!0)}},r.a.createElement("div",{tabIndex:0,className:i.swipeDrawerContainer,role:"button",onClick:function(){return j(!1)},onKeyDown:function(){return j(!1)}},r.a.createElement(vl,{multiSelect:!1,columns:1,photos:f.photos,onTileClick:function(e){x(f.photos.find(function(t){return t.id===e})),j(!1)}}))))},cs=Object(je.a)(function(e){return{root:{},formLabel:{color:e.palette.text.secondary},dlgTitleContainer:{color:e.palette.primary.contrastText,background:e.palette.primary.main},mapFormLabel:{marginTop:e.spacing(2),marginBottom:e.spacing(1),color:e.palette.text.secondary},map:{marginBottom:e.spacing(2)},mapWrapper:{marginBottom:e.spacing(2)},field:{marginBottom:e.spacing(2)}}}),ss=function(e){var t=e.photo,a=e.newSeries,o=e.onCancel,i=e.onSave,l=cs(),c=Object(n.useState)(a||{}),s=Object(We.a)(c,2),m=s[0],d=s[1],p=Object(n.useState)(t),g=Object(We.a)(p,2),h=g[0],f=g[1],b=!a||m.name&&m.name.length>=3;return r.a.createElement("div",{className:l.root},r.a.createElement(Se.a,null)," ",r.a.createElement(qe.a,{fullScreen:!0,scroll:"paper",disableBackdropClick:!0,disableEscapeKeyDown:!0,onClose:o,"aria-labelledby":"customized-dialog-title",open:!0},r.a.createElement(Qe.a,{disableTypography:!0,className:l.dlgTitleContainer},r.a.createElement(ke.a,{variant:"h5",className:l.dlgTitle},a?"New Series Details":"New Photo Details")),r.a.createElement(Ye.a,null,!!a&&r.a.createElement(ac,{series:a,delta:m,onChange:d}),!!a&&r.a.createElement("div",null,r.a.createElement(ke.a,{variant:"h5",className:l.photoTitle},"New photo details"),r.a.createElement(Bo.a,null)),r.a.createElement(Fc,{photo:t,canEdit:!0,hideUser:!0,delta:h,onChange:function(e){return f(Object(u.a)({},h,e))}})),r.a.createElement(Xe.a,null,r.a.createElement(He.a,{onClick:o,color:"primary"},"Cancel"),r.a.createElement(He.a,{onClick:function(){return i(m,h)},disabled:!b,color:"primary"},"Next"))))},us=a(489),ms=a.n(us),ds=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=arguments.length>1?arguments[1]:void 0,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=Object(n.useRef)(),l=Object(n.useRef)(),c=r.a.createElement("input",{style:{display:"none"},ref:i,type:"file",accept:o?null:"image/*",capture:t});return Object(n.useEffect)(function(){var t=function(t){var a=Object(ra.a)(i.current.files)[0];if(a){console.log("file",a);var n=new FileReader;n.onloadend=function(){var t=a.type,r=a.name,o=a.size;e({dataUrl:n.result,type:t,name:r,size:o,ext:ps(a)})},n.readAsDataURL(a)}i.current.value=null};return i.current&&(i.current.addEventListener("change",t),l.current||(a&&i.current.click(),l.current=!0)),function(){i.current&&i.current.removeEventListener("change",t)}},[i.current]),{fileClickEl:c,forceClick:function(){i.current&&i.current.click()},inputRef:i}},ps=function(e){switch(e.type){case"image/jpeg":case"image/jpg":return"jpeg";case"image/png":return"png";default:return"jpg"}},gs=Object(je.a)(function(e){return{root:{height:"100%",display:"flex",flexDirection:"column",textAlign:"center",color:e.palette.grey[600],border:"20px solid ".concat(e.palette.grey[400])},icon:{color:e.palette.grey[600],margin:"auto",flex:"1 1 50%",height:"70%",width:"70%"},button:{margin:e.spacing(2)}}}),hs=function(e){var t=e.onLibraryAdd,a=e.onCancel,n=e.cameraPicker,o=gs(),i=ds(t,n),l=i.fileClickEl,c=i.forceClick,s="Library",u=Ao.a;return n&&(s="Camera",u=ms.a),r.a.createElement("div",{className:o.root},l,r.a.createElement(u,{className:o.icon,color:"inherit",onClick:c}),r.a.createElement(He.a,{variant:"contained",className:o.button,color:"primary",onClick:c},"Import from ",s),r.a.createElement(He.a,{variant:"outlined",className:o.button,color:"secondary",onClick:a},"Cancel"))},fs=a(263),bs=function e(t,a){var n=this;Object(Me.a)(this,e),this.setMeta=function(){n.meta=JSON.stringify(n.config.getSeriesMeta())},this.newSeries=function(){return{id:"L-".concat(wa()()),meta:JSON.stringify(n.config.getSeriesMeta()),photos:[]}},this.config=new ui.a(t),this.series=a||this.newSeries()},ys="camera",vs="library",Es="photoreview",ws="photoinfoedit",xs=function(e){var t=e.inputMethod,a=e.onCreate,o=e.onCancel,i=e.isNewSeries,l=Object(n.useContext)(mi),c=l.seriesConfig,s=l.series,m=Object(n.useRef)(),d=Object(n.useState)(null),p=Object(We.a)(d,2),g=p[0],h=p[1],f=Object(n.useState)(i?new bs(c).series:s),b=Object(We.a)(f,2),y=b[0],v=b[1],E=Object(n.useState)(new fs.a(c).photo),w=Object(We.a)(E,2),x=w[0],O=w[1],k=Object(n.useState)(null),S=Object(We.a)(k,2),j=S[0],C=S[1],N=Object(n.useState)({current:t,history:[]}),T=Object(We.a)(N,2),I=T[0],P=T[1],z=function(){var e=Object(n.useState)({absolute:!1,alpha:null,beta:null,gamma:null}),t=Object(We.a)(e,2),a=t[0],r=t[1];function o(e){r({absolute:e.absolute,alpha:e.alpha,beta:e.beta,gamma:e.gamma})}return Object(n.useEffect)(function(){return window.addEventListener("deviceorientation",o,!0),function(){window.removeEventListener("deviceorientation",o)}},[]),a}(),A=bn();m.current=A;var _=!i&&s&&s.photos?s.photos:[],R=function(e){console.log("NEWPHOTO changeMode",I,e),P({current:e,history:[].concat(Object(ra.a)(I.history),[I.current])})},M=function(e){console.log("onLibraryAdd Debug GOT DATA",{data:e,isNewSeries:i}),h(e);var t=Object(fs.b)(e.dataUrl),a=t.exif,n=t.exifDateTime,r=t.exifGPS,o=r,l=n||String(Date.now());if(!o)if(m.current&&m.current.latitude&&m.current.longitude){var c=m.current,s=c.latitude;o=[c.longitude,s]}else o=[-123.1398254,49.3050394];i&&v(Object(u.a)({},y,{coords:o})),console.log("LATLONG FOR LIB PICK",{coords:o,exifGPS:r,geo:A});var d=Object(u.a)({},x,{takenOn:l,coords:o,rawData:JSON.stringify({exif:a,sensors:{orientation:z,geo:A}})});O(d),console.log("onLibraryAdd",d),R(Es),console.log("onLibraryAdd FINISHED",d)},D=null;switch(I.current){case ys:D=c.isIos?r.a.createElement(hs,{onCancel:o,cameraPicker:!0,onLibraryAdd:M}):r.a.createElement(ls,{photos:_,onShutter:function(e,t){h(e),console.log("onShutter Debug GOT DATA",{data:e});var a=Object(fs.b)(e.dataUrl),n=a.exif,r=a.exifGPS,o=String(Date.now()),l=[-123.1398254,49.3050394];if(m.current&&m.current.latitude&&m.current.longitude){var c=m.current,s=c.latitude;l=[c.longitude,s]}else r&&(l=r);i&&v(Object(u.a)({},y,{coords:l}));var d=Object(u.a)({},x,{takenOn:o,coords:l,rawData:JSON.stringify({exif:n,sensors:{orientation:z,geo:A}})});O(d),console.log("onShutter",{_newPhoto:d,newSeries:Object(u.a)({},y,{coords:l})}),C(t),R(Es)},onCancel:o});break;case vs:D=r.a.createElement(hs,{onCancel:o,onLibraryAdd:M});break;case Es:D=r.a.createElement(ts,{defaultRefPhotoId:j,photos:_,captured:x,dataUrl:g.dataUrl,onConfirm:function(){return R(ws)},onCancel:o,onRetry:function(){if(I.history.length>0){var e=Object(ra.a)(I.history),t=e.pop();P({current:t,history:e})}else o()}});break;case ws:D=r.a.createElement(ss,{photo:x,newSeries:i?y:null,onSave:function(e,t){return a(e,t,g)},onCancel:o});break;default:console.log("NEWPHOTO: default state. you should NEVER see this",I),o()}return D},Os=a(491),ks=a.n(Os),Ss=function(){function e(t,a,n){var r=this;Object(Me.a)(this,e),this.ownOrAny=function(e){if(!e||!e.createdUser||!e.createdUser.id)throw new Error("No Created user found");try{return e.createdUser.id===r.userSub?"Own":"Any"}catch(t){return"Any"}},this.isOwner=function(e){if(!e||!e.createdUser||!e.createdUser.id)throw new Error("No Created user found");try{return e.createdUser.id===r.userSub}catch(t){return!1}},this.canUser=function(e,t,a,n){if(["series","photo"].indexOf(a)<0)throw new Error("canUser: type not supported ".concat(a));try{var o=r.ownOrAny(t),i=r.ac.can(r.role)["".concat(e).concat(o)](a),l=null;return"series"===a&&("PUBLIC"===t.access?l=r.ac.can(r.role)["".concat(e).concat(o)]("series_public"):"OPEN"===t.access&&(l=r.ac.can(r.role)["".concat(e).concat(o)]("series_open"))),n?l?!!i.attributes.find(function(e){return"*"===e||n.indexOf(e)>-1})||!!l.attributes.find(function(e){return"*"===e||n.indexOf(e)>-1}):!!i.attributes.find(function(e){return"*"===e||n.indexOf(e)>-1}):l?i.granted||l.granted:i.granted}catch(c){return console.error(c),!1}},this.userSub=t,this.role=a,this.permissionObj=n,this.ac=new ks.a(n)}return Object(De.a)(e,[{key:"toString",value:function(){console.log("AccessHelper:",{sub:this.userSub,role:this.role})}}]),e}(),js=Object(je.a)(El),Cs=function(e){var t=e.onMenuBack,a=js();return r.a.createElement("div",{className:a.root},r.a.createElement(Se.a,null),r.a.createElement(ro.a,{position:"static",className:a.appBar},r.a.createElement(Ga.a,{disableGutters:!0},r.a.createElement(oo.a,{className:a.menuButton,color:"inherit",onClick:t,"aria-label":"Menu"},r.a.createElement(so.a,null)),r.a.createElement(ke.a,{variant:"subtitle1",color:"inherit",className:a.toolbarTitle},"Series"))),r.a.createElement("div",{className:a.placeholderInner},r.a.createElement("div",{className:a.grow}),r.a.createElement(ke.a,{className:a.placeholderText,variant:"h3"},"Series not found"),r.a.createElement("div",{className:a.grow})))},Ns=Object(je.a)(El),Ts=function(e){var t=e.onMenuBack,a=Ns();return r.a.createElement("div",{className:a.root},r.a.createElement(Se.a,null),r.a.createElement(ro.a,{position:"static",className:a.appBar},r.a.createElement(Ga.a,{disableGutters:!0},r.a.createElement(oo.a,{className:a.menuButton,color:"inherit",onClick:t,"aria-label":"Menu"},r.a.createElement(so.a,null)),r.a.createElement(ke.a,{variant:"subtitle1",color:"inherit",className:a.toolbarTitle},"Series"))),r.a.createElement("div",{className:a.placeholderInner},r.a.createElement("div",{className:a.grow}),r.a.createElement("div",{className:a.progressWrapper},r.a.createElement(Zi.a,{className:a.progress,color:"inherit",size:150,thickness:5})),r.a.createElement(ke.a,{className:a.placeholderText,variant:"h4"},"Loading..."),r.a.createElement("div",{className:a.grow})))},Is="series",Ps="editseries",zs="newphoto",As="newseries",_s="photoviewer",Rs="newphotoviewer",Ms="slideshow",Ds=[Is,_s,Ms],Ls=function(e){var t=e.modeName,a=e.series,o=e.seriesConfig,i=e.inputMethod,l=e.currentUserId,m=e.currentUserRole,d=e.accessControl,p=e.initialPhoto,g=e.onChange,h=e.onClose,f=e.onDelete,b=e.onNewSeries,y=e.onChangePhoto,v=e.onNewPhoto,E=e.onDeletePhoto,w=e.loading,x=e.onFindOnMap,O=e.onWatch,k=e.onUnWatch,S=e.watching,j=e.owned,C=Object(n.useState)({series:a,seriesConfig:o,ac:d?new Ss(l,m,d):null}),N=Object(We.a)(C,2),T=N[0],I=N[1],P=Object(n.useState)({current:{name:t||Is,pid:p,inputMethod:i},history:[]}),z=Object(We.a)(P,2),A=z[0],_=z[1];Object(n.useEffect)(function(){I(Object(u.a)({},T,{series:a})),_({current:{name:t||Is,pid:p,inputMethod:i},history:[]})},[a]);var R=function(e,t){var a=Object(u.a)({},T.series);a.photos=a.photos.map(function(e){return e.id===t.id?Object(u.a)({},e,t):e}),y(e,Object(u.a)({},t,{seriesId:a.id}))},M=function(){var e=Object(s.a)(c.a.mark(function e(t,n,r){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("RepeatablePhotos: waiting for photo ID",{newSeries:t,newPhoto:n,newPhotoData:r}),e.next=3,v(n,r);case 3:I(Object(u.a)({},T,{series:Object(u.a)({},a,{photos:[].concat(Object(ra.a)(a.photos),[n])})})),D(Rs,n.id);case 5:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),D=function(e,t,n){var r=T.ac.canUser("update",a,"series");null===T&&h(),!r&&Ds.indexOf(e)<0?console.error("ILLEGAL MODE CHANGE!!!!!",{from:A.current,to:e,canUpdate:r}):_({current:{name:e,pid:t,inputMethod:n},history:[].concat(Object(ra.a)(A.history),[A.current])})},L=function(){if(A.history.length>0){var e=Object(ra.a)(A.history),t=e.pop();_({current:t,history:e})}else h()},F=null;if(w)return r.a.createElement(Ts,{onMenuBack:h});if(!T.series&&A.current.name!==As)return r.a.createElement(Cs,{onMenuBack:h});switch(A.current.name){case Is:F=r.a.createElement(xl,{onSlideshowStart:function(){return D(Ms)},onChange:function(){console.log("onChange NOT IMPLEMENTED")},watching:S,owned:j,initialPhoto:p,onDeletePhotos:function(e){a.photos.filter(function(t){return e.indexOf(t.id)>-1}).forEach(function(e){return E(e)})},onDeleteSeries:f,onFindOnMap:x,onCameraAdd:function(){return D(zs,null,"camera")},onEditSeries:function(){return D(Ps)},onLibraryAdd:function(){return D(zs,null,"library")},onTileClick:function(e){D(_s,e)},onMenuBack:h,onWatch:O,onUnWatch:k});break;case Ps:F=r.a.createElement(rc,{onCancel:function(){return D(Is)},onOk:function(e){g(a,Object(u.a)({},e,{id:a.id})),D(Is)}});break;case _s:F=r.a.createElement(Vc,{photos:T.series.photos,initPhotoId:A.current.pid,onMenuBack:L,onUpdatePhoto:R});break;case Rs:F=r.a.createElement(Vc,{photos:T.series.photos,initPhotoId:A.current.pid,newPhoto:!0,onMenuBack:function(){return D(Is)},onUpdatePhoto:R});break;case Ms:F=r.a.createElement(mc,{photos:T.series.photos,onCancel:L});break;case zs:F=r.a.createElement(xs,{inputMethod:A.current.inputMethod,photos:a?a.photos:null,onCreate:M,onCancel:L});break;case As:F=r.a.createElement(xs,{inputMethod:A.current.inputMethod,isNewSeries:!0,onCreate:b,onCancel:L});break;default:console.log("REPEATABLEPHOTO: default state. you should NEVER see this",T),F=null}return r.a.createElement(mi.Provider,{value:T},F)};Ls.defaultProps={mode:Is};var Fs=Ls,Bs=Object(d.d)(le,{props:function(e){var t=e.data;t.error&&console.error(t.error),console.log("getWholeSeries:: ",{data:t});var a=null;try{t.loading||t.error||(a=t.series)}catch(n){console.log("getWholeSeries:: error",{data:t,e:n}),console.error(n)}return{data:t,loading:t.loading,series:a}},skip:function(e){var t=e.activeSeries,a=e.isNewSeries;return!t||a},options:function(e){return{variables:{id:e.activeSeries}}}}),Us=Object(d.c)(Bs,va.withMutation,Yr.withMutation,Br.withMutation,Zr.withMutation,Mr.withMutation,Gr.withMutation,eo.withMutation,no.withMutation)(function(e){var t=e.series,a=e.loading,o=e.domain,i=e.activeSeries,l=e.initialPhoto,u=e.onAfterSeriesDelete,m=e.onBack,d=e.queueUpload,p=e.createSeriesMutation,g=e.createPhotoMutation,h=e.updateSeriesMutation,f=e.updatePhotoMutation,b=e.deleteSeriesMutation,y=e.deletePhotoMutation,v=e.watchSeriesMutation,E=e.unWatchSeriesMutation,w=e.onFindOnMap,x=Object(n.useContext)(Oe),O=x.role,k=x.currentUser,S=x.user,j=x.signedIn,C=x.isIos,N=x.onAvatarClick,T=x.getPhotoUrls,I=o===Zt.AppStateTypes.NEW_SERIES_CAMERA?ys:vs,P=Is;o!==Zt.AppStateTypes.SERIES&&(P=As);var z={meta:{},tags:[{id:"freeBothType",label:null,color:$t[0],allowXY:!0,allowNonXY:!0,allowAdditions:!0,getValues:function(){return Promise.resolve(["a","b","c"])},imgStore:xa,values:[]}],onAvatarClick:N,getPhotoUrls:T,isIos:C},A=!1;try{A=S.id===t.createdUser.id}catch(_){}return console.log("[SERIESCONNECT_RENDER]",{activeSeries:i,series:t,loading:a,owned:A,user:S}),r.a.createElement(ze.a,{theme:xe.series},r.a.createElement(Fs,{modeName:P,inputMethod:I,owned:A,watching:j&&S&&S.watching&&S.watching.indexOf(i)>-1,currentUserId:j?k.attributes.sub:null,currentUserRole:O,accessControl:Ar,loading:a,series:t,initialPhoto:l,seriesConfig:z,onNewPhoto:function(){var e=Object(s.a)(c.a.mark(function e(a,n){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("onNewPhoto::",{series:t,newPhoto:a,newPhotoData:n}),e.next=3,xa.setItem(a.uploadToken,n);case 3:return e.abrupt("return",g(t,a,n.ext).then(function(e){var t=e.data,a=t.createPhoto.photo;if(t.createPhoto.preAuth){var r=JSON.parse(t.createPhoto.preAuth);d({id:a.id,uploadToken:a.uploadToken,seriesId:a.seriesId,preAuth:r,ext:n.ext,retry:0})}}).catch(function(e){console.log("onNewPhoto:: Graphql Error",e.stack),console.error(e)}));case 4:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),onChangePhoto:function(e,a){return f(t,e,a).catch(function(e){console.log("onChangePhoto:: Graphql Error",e.stack),console.error(e)})},onDeletePhoto:function(e){return y(e.id).then(function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];console.log("onDeletePhoto:: photo deleted",t)}).catch(function(e){console.log("onDeletePhoto:: Graphql Error",e.stack),console.error(e)})},onChange:function(e,t){return h(e,t).catch(function(e){console.log("onChange:: Graphql Error",e.stack),console.error(e)})},onNewSeries:function(){var e=Object(s.a)(c.a.mark(function e(t,a,n){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Series.connect:: onNewSeries starting",{newSeries:t,newPhoto:a,newPhotoData:n}),e.next=3,xa.setItem(a.uploadToken,n);case 3:return e.abrupt("return",p(t,a,n.ext).then(function(){var e=Object(s.a)(c.a.mark(function e(t){var a,r,o;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:(a=t.data).createSeries.preAuth&&(r=a.createSeries.series.photos[0],o=JSON.parse(a.createSeries.preAuth),d({id:r.id,uploadToken:r.uploadToken,seriesId:r.seriesId,preAuth:o,ext:n.ext,retry:0}));case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){console.log("onNewSeries:: Graphql Error",e.stack),console.error(e)}));case 4:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),onDelete:function(){return u(),b().catch(function(e){console.log("onDelete:: Graphql Error",e.stack),console.error(e)})},onClose:m,onFindOnMap:w,onWatch:j?v:null,onUnWatch:j?E:null}))}),Ws=Object(Ge.b)(function(e,t){var a=e.home.current;return{activeSeries:a.activeSeries,initialPhoto:a.initialPhoto,domain:a.domain}},function(e){return{onBack:function(){e(Qn())},onAfterSeriesDelete:function(){console.log("onAfterSeriesDelete"),e(qn(Zt.AppStateTypes.FEED,{activeSeries:null}))},queueUpload:function(t){e(tr(t))},doneCreatingSeries:function(t){console.log("doneCreatingSeries",t),e(qn(Zt.AppStateTypes.SERIES,{activeSeries:t}))},onFindOnMap:function(){e(qn(Zt.AppStateTypes.MAP))}}})(Us),Gs=a(492),Hs=a.n(Gs),qs=a(69),Qs=function(e,t,a,r,o,i,l){var u=Object(n.useState)([]),m=Object(We.a)(u,2),d=m[0],p=m[1],g=Object(n.useState)({single:[],cluster:[]}),h=Object(We.a)(g,2),f=h[0],b=h[1],y=Object(n.useState)(0),v=Object(We.a)(y,2),E=v[0],w=v[1],x=Object(n.useCallback)(Object(jn.a)(Object(s.a)(c.a.mark(function e(){var t,a=arguments;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ys.apply(void 0,a);case 2:t=e.sent,p(t),w(E+1);case 5:case"end":return e.stop()}},e)})),1e3),[]),O=Object(n.useCallback)(Object(jn.a)(Object(s.a)(c.a.mark(function e(){var t,a=arguments;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$s.apply(void 0,a);case 2:t=e.sent,b(t);case 4:case"end":return e.stop()}},e)})),300),[]);return Object(n.useEffect)(function(){x(e,o,r)},[e.length,i]),Object(n.useEffect)(function(){l||O(d,t,a)},[d,a,t,E,l]),{filteredClusteredData:f}},Ys=function(e,t,a){if(!e)return[];var n=Hs()(9,[".x",".y",".x",".y"]),r=new Nl.a(Object(u.a)({},a,{zoom:0})),o=e.map(function(e){var t=[0,0];try{t=r.project(e.coords)}catch(n){console.error(n)}e.longitude,e.latitude;var a=Object(m.a)(e,["longitude","latitude"]);return{x:t[0],y:t[1],photoCount:a.photoCount,zoomLevels:[],geoJSON:e.coords?Object(qs.point)(e.coords,Object(u.a)({},a)):null}});n.clear(),n.load(o);for(var i=function(e){var a=t/Math.sqrt(2)/Math.pow(2,e);o.forEach(function(t){if(void 0===t.zoomLevels[e]){var r=t.x,o=t.y,i=n.search({minX:r-a,minY:o-a,maxX:r+a,maxY:o+a}).filter(function(t){return void 0===t.zoomLevels[e]});i.forEach(function(a){if(a===t){var n=1===i.length?t.geoJSON:Object(qs.centroid)(Object(qs.featureCollection)(i.map(function(e){return e.geoJSON})));n.properties=Object(u.a)({},n.properties,{id:n.properties.id||wa()(),count:i.length,reducedPhotoCount:i.reduce(function(e,t){var a=t.photoCount;return a?e+a:e},0),points:i.map(function(e){return e.geoJSON})}),t.zoomLevels[e]=n}else a.zoomLevels[e]=null})}})},l=0;l<=20;l++)i(l);return o.map(function(e){return e.zoomLevels})};function $s(e,t,a){return e.filter(function(e){return!!e[a]}).reduce(function(e,n){var r=n[a],o=r.geometry.coordinates,i=r.properties.count;return(!t||t.length<4||t[0]<o[0]&&t[1]<o[1]&&t[2]>o[0]&&t[3]>o[1])&&(i>1?e.cluster.push(r):e.single.push(r)),e},{single:[],cluster:[]})}var Vs=Te()(r.a.createElement(r.a.Fragment,null,r.a.createElement("path",{d:"M16.432,6.104c-2.671,-1.06 -6.842,4.123 -6.572,5.826c-3.78,-7.611 2.788,-8.409 3.682,-10.699c0.64,1.255 5.18,2.608 2.89,4.873Z"}),r.a.createElement("path",{d:"M9.159,5.228c-2.254,1.782 0.149,7.986 1.76,8.604c-8.482,-0.532 -5.889,-6.619 -7.425,-8.538c1.407,0.073 4.848,-3.183 5.665,-0.066Z"}),r.a.createElement("path",{d:"M4.727,11.059c0.417,2.844 6.991,3.864 8.331,2.779c-4.701,7.079 -8.676,1.79 -11.106,2.161c0.766,-1.183 -0.332,-5.791 2.775,-4.94Z"}),r.a.createElement("path",{d:"M7.561,17.813c2.671,1.061 6.842,-4.122 6.572,-5.826c3.781,7.611 -2.788,8.409 -3.681,10.699c-0.641,-1.255 -5.181,-2.607 -2.891,-4.873Z"}),r.a.createElement("path",{d:"M14.828,18.736c2.254,-1.783 -0.149,-7.987 -1.76,-8.605c8.482,0.532 5.889,6.619 7.425,8.538c-1.407,-0.072 -4.849,3.183 -5.665,0.067Z"}),r.a.createElement("path",{d:"M19.26,12.904c-0.417,-2.843 -6.991,-3.864 -8.331,-2.778c4.701,-7.08 8.676,-1.791 11.106,-2.162c-0.767,1.183 0.332,5.791 -2.775,4.94Z"})),"AppLogoSimple"),Xs=Te()(r.a.createElement(r.a.Fragment,null,r.a.createElement("path",{d:"M21.229,18.388c-0.346,0.799 -0.756,1.535 -1.23,2.211c-0.647,0.922 -1.176,1.56 -1.584,1.914c-0.632,0.582 -1.31,0.88 -2.036,0.897c-0.521,0 -1.149,-0.148 -1.88,-0.449c-0.734,-0.299 -1.408,-0.448 -2.025,-0.448c-0.646,0 -1.34,0.149 -2.081,0.448c-0.743,0.301 -1.342,0.457 -1.799,0.473c-0.696,0.03 -1.39,-0.277 -2.082,-0.921c-0.442,-0.385 -0.995,-1.046 -1.657,-1.982c-0.71,-0.999 -1.294,-2.158 -1.752,-3.48c-0.49,-1.427 -0.735,-2.809 -0.735,-4.147c0,-1.533 0.331,-2.855 0.994,-3.963c0.521,-0.89 1.215,-1.591 2.083,-2.107c0.868,-0.515 1.806,-0.778 2.816,-0.794c0.553,0 1.278,0.17 2.179,0.506c0.898,0.338 1.474,0.509 1.727,0.509c0.189,0 0.83,-0.2 1.916,-0.599c1.027,-0.369 1.894,-0.522 2.604,-0.462c1.924,0.155 3.37,0.914 4.331,2.28c-1.721,1.043 -2.572,2.503 -2.555,4.377c0.016,1.459 0.545,2.674 1.585,3.638c0.472,0.447 0.999,0.793 1.584,1.039c-0.127,0.368 -0.261,0.721 -0.403,1.06Zm-4.413,-17.366c0,1.144 -0.418,2.212 -1.251,3.2c-1.005,1.176 -2.221,1.855 -3.54,1.748c-0.017,-0.138 -0.026,-0.282 -0.026,-0.434c0,-1.098 0.478,-2.273 1.327,-3.234c0.423,-0.486 0.962,-0.891 1.616,-1.214c0.652,-0.318 1.269,-0.493 1.85,-0.523c0.016,0.152 0.024,0.305 0.024,0.457l0,0Z"})),"Apple"),Zs=Object(je.a)(function(e){return{root:{},icon:{height:50,width:"100%",margin:"0 auto",color:e.palette.error.main},title:{}}}),Js=function(e){var t=e.title,a=e.message,n=e.onClose,o=e.open,i=e.icon,l=Zs(),c=i||Xs;return r.a.createElement(qe.a,{className:l.root,fullWidth:!0,open:o,PaperProps:{style:{maxWidth:"none"}},onClose:n,maxWidth:"xl","aria-labelledby":"confirmation-dialog-title"},r.a.createElement(Qe.a,{id:"confirmation-dialog-title",className:l.title},t),r.a.createElement(Ye.a,null,r.a.createElement(c,{className:l.icon}),r.a.createElement(ke.a,{component:"div"},a)),r.a.createElement(Xe.a,null,r.a.createElement(He.a,{onClick:n,color:"primary"},"Ok")))},Ks=Te()(r.a.createElement(r.a.Fragment,null,r.a.createElement("path",{d:"M22,2l0,20l-20,0l0,-20l20,0Zm-2,2l-16,0l0,16l16,0l0,-16Z"}),r.a.createElement("rect",{x:"5",y:"5",width:"4",height:"4"}),r.a.createElement("rect",{x:"15",y:"5",width:"4",height:"4"}),r.a.createElement("rect",{x:"5",y:"15",width:"4",height:"4"}),r.a.createElement("rect",{x:"10",y:"10",width:"1",height:"5"}),r.a.createElement("rect",{x:"11",y:"10",width:"6",height:"2"}),r.a.createElement("rect",{x:"11",y:"12",width:"2",height:"2"}),r.a.createElement("rect",{x:"13",y:"7",width:"1",height:"2"}),r.a.createElement("rect",{x:"14",y:"9",width:"1",height:"1"}),r.a.createElement("rect",{x:"8",y:"10",width:"1",height:"4"}),r.a.createElement("rect",{x:"7",y:"11",width:"1",height:"3"}),r.a.createElement("rect",{x:"9",y:"11",width:"1",height:"1"}),r.a.createElement("rect",{x:"10",y:"6",width:"2",height:"3"}),r.a.createElement("rect",{x:"12",y:"7",width:"1",height:"1"}),r.a.createElement("rect",{x:"15",y:"14",width:"2",height:"4"}),r.a.createElement("rect",{x:"14",y:"14",width:"1",height:"1"}),r.a.createElement("rect",{x:"17",y:"15",width:"2",height:"2"}),r.a.createElement("rect",{x:"11",y:"16",width:"1",height:"3"}),r.a.createElement("rect",{x:"12",y:"15",width:"2",height:"2"}),r.a.createElement("rect",{x:"10",y:"18",width:"1",height:"1"})),"QRCode"),eu=a(494),tu=a.n(eu),au=a(493),nu=a.n(au),ru=a(495),ou=a.n(ru),iu=a(496),lu=a.n(iu),cu=a(324),su=a.n(cu),uu=Object(je.a)(function(e){return{drawerInner:{width:250,display:"flex",flexDirection:"column",height:"100%"},disableListItem:{color:"rgba(0, 0, 0, 0.26)"},avatar:{height:e.spacing(7),width:e.spacing(7),border:"3px solid ".concat(e.palette.primary.main),margin:e.spacing(0,1)},gravatarImg:{width:"100%"},spacer:{flexGrow:1},fullList:{width:"auto"}}}),mu=function(e){var t=e.open,a=e.onOpen,o=e.onClose,i=e.onDisabledClick,l=e.onAboutClick,c=uu(),s=Object(n.useContext)(Oe),u=s.signOut,m=s.signedIn,d=s.forceSignIn,p=s.user,g=s.onQRClick,h=s.onSettingsClick,f=s.addToHomeScreen,b=s.onOfflineMenuClick,y=s.isIos;return r.a.createElement(Xc.a,{open:t,onClose:o,onOpen:a},r.a.createElement("div",{className:c.drawerInner,role:"presentation",onClick:o,onKeyDown:o},p&&p.username&&r.a.createElement(Wo.a,null,r.a.createElement(Go.a,{className:c.root,onClick:function(){},disableGutters:!0},r.a.createElement(qo.a,{className:c.avatar},m&&p?r.a.createElement("img",{alt:"profile",className:c.gravatarImg,src:p.gravatar}):r.a.createElement(su.a,{color:"inherit",className:c.loginButton}))),r.a.createElement(Go.a,{className:c.root,onClick:function(){}},r.a.createElement(Fo.a,{primary:p.username}))),r.a.createElement(Bo.a,null),r.a.createElement(Wo.a,null,r.a.createElement(Go.a,{className:y?c.disableListItem:null,button:!0,onClick:y?i:g},r.a.createElement(Lo.a,null,r.a.createElement(Ks,null)),r.a.createElement(Fo.a,{primary:"Scan QR Code"})),f&&r.a.createElement(Go.a,{button:!0,onClick:f},r.a.createElement(Lo.a,null,r.a.createElement(nu.a,null)),r.a.createElement(Fo.a,{primary:"Install this app",secondary:"It works better!"})),r.a.createElement(Go.a,{button:!0,onClick:b},r.a.createElement(Lo.a,null,r.a.createElement(tu.a,null)),r.a.createElement(Fo.a,{primary:"Offline Download"}))),r.a.createElement("div",{className:c.spacer}),r.a.createElement(Bo.a,null),r.a.createElement(Wo.a,null,r.a.createElement(Go.a,{button:!0,onClick:h},r.a.createElement(Lo.a,null,r.a.createElement(ou.a,null)),r.a.createElement(Fo.a,{primary:"App Settings"})),r.a.createElement(Go.a,{button:!0,onClick:l},r.a.createElement(Lo.a,null,r.a.createElement(gc.a,null)),r.a.createElement(Fo.a,{primary:"About"})),m?r.a.createElement(Go.a,{button:!0,onClick:u},r.a.createElement(Lo.a,null,r.a.createElement(lu.a,null)),r.a.createElement(Fo.a,{primary:"Sign Out"})):r.a.createElement(Go.a,{button:!0,onClick:d},r.a.createElement(Lo.a,null,r.a.createElement(su.a,null)),r.a.createElement(Fo.a,{primary:"Sign In"})))))},du=a(1033),pu=a(497),gu=a.n(pu),hu=Object(je.a)(function(e){return{root:{},dialogContent:{display:"flex",flexDirection:"column",overflow:"hidden",height:"100%"},iconContainer:{flex:"1 1 10%",textAlign:"center",padding:e.spacing(1,0,1,0)},icon:{height:200,margin:"0 auto",border:"1px solid ".concat(e.palette.grey[100]),background:e.palette.grey[100],borderRadius:"50%","& path":{fill:"url(#my-cool-gradient) #447799;"}},title:{textAlign:"center"},stop1:{stopColor:e.palette.primary.main},stop2:{stopColor:e.palette.secondary.main},spacer:{flex:"1 1"},buttonIcon:{marginRight:e.spacing(1)},scrollText:{flex:"1 1 60%",overflowX:"hidden",overflowY:"scroll",whiteSpace:"pre-line",paddingBottom:e.spacing(1)}}}),fu=function(e){var t=e.onClose,a=e.open,n=hu();return r.a.createElement(qe.a,{className:n.root,onClose:t,fullWidth:!0,open:a,PaperProps:{style:{}},maxWidth:"xl","aria-labelledby":"confirmation-dialog-title"},r.a.createElement(Ye.a,{className:n.dialogContent},r.a.createElement(du.a,{maxWidth:"xs"},r.a.createElement("div",{className:n.iconContainer},r.a.createElement("svg",{className:n.icon,focusable:"false",viewBox:"0 0 24 24","aria-hidden":"true",role:"presentation"},Ie),r.a.createElement("svg",{style:{width:0,height:0,position:"absolute"},"aria-hidden":"true",focusable:"false"},r.a.createElement("linearGradient",{id:"my-cool-gradient",x2:"1",y2:"1"},r.a.createElement("stop",{offset:"0%",stopColor:"#447799",className:n.stop1}),r.a.createElement("stop",{offset:"100%",stopColor:"#112266",className:n.stop2})))),r.a.createElement("div",{className:n.title},r.a.createElement(ke.a,{component:"div",variant:"h5"},"MorPhoto"),r.a.createElement(ke.a,{component:"div",variant:"caption"},"Version:  ","0.0.436"," ",r.a.createElement("em",null,"BETA"))),r.a.createElement(ke.a,{className:n.scrollText,component:"div",variant:"caption"}),r.a.createElement("div",{className:n.spacer}),r.a.createElement(He.a,{fullWidth:!0,href:"mailto:".concat("info@northarrowresearch.com"),color:"primary",variant:"outlined"},r.a.createElement(gu.a,{className:n.buttonIcon}),"Get in touch"))),r.a.createElement(Xe.a,null,r.a.createElement(He.a,{onClick:t,color:"inherit"},"Close")))},bu=Object(je.a)(function(e){return{root:{display:"flex",alignItems:"center",width:"100%",padding:e.spacing(0,1),backgroundColor:e.palette.primary.main,color:e.palette.primary.contrastText,borderBottom:"2px solid ".concat(e.palette.primary),background:"linear-gradient(90deg, ".concat(e.palette.secondary.main," 0%, ").concat(e.palette.primary.main," 100%)")},searchIcon:{opacity:.3,marginRight:e.spacing(1)},transparent:{backgroundColor:"transparent",background:"none",color:e.palette.text.primary},iOsIcon:{color:"rgba(0, 0, 0, 0.26)"},logo:{padding:e.spacing(0,0),height:40,width:40},transparentLogo:{background:"linear-gradient(90deg, ".concat(e.palette.secondary.main," 0%, ").concat(e.palette.primary.main," 100%)"),padding:e.spacing(.5,.5)},transparentLogoIcon:{color:"white",height:35,width:35},children:{flexGrow:1,padding:e.spacing(0,1)},qrButton:{padding:e.spacing(0,0)},qrButtonTransparent:{background:"white",padding:e.spacing(.5,.5)}}}),yu="APPLE_WARNING",vu="ABOUTAPP",Eu=function(e){var t=e.className,a=e.children,o=e.isTransparent,i=(e.menuItems,e.hideLogo),l=bu(),c=Object(n.useState)(!1),s=Object(We.a)(c,2),u=s[0],m=s[1],d=Object(n.useState)(!1),p=Object(We.a)(d,2),g=p[0],h=p[1],f=Object(n.useContext)(Oe),b=f.onQRClick,y=f.isIos;return r.a.createElement(r.a.Fragment,null,r.a.createElement(ro.a,{position:"static"},r.a.createElement(Ga.a,{className:yr()(l.root,t,o?l.transparent:null),disableGutters:!0},!i&&r.a.createElement(oo.a,{className:o?l.transparentLogo:l.logo,color:"inherit",onClick:function(){return h(!0)}},r.a.createElement(Vs,{className:o?l.transparentLogoIcon:l.logo})),r.a.createElement("div",{className:l.children},a),r.a.createElement(oo.a,{color:"inherit",className:yr()(y?l.iOsIcon:null,o?l.qrButtonTransparent:l.qrButton),"aria-label":"Menu",onClick:y?function(){return m(yu)}:b},r.a.createElement(Ks,{color:"inherit"})))),r.a.createElement(mu,{open:g,onClose:function(){return h(!1)},onOpen:function(){return h(!0)},onDisabledClick:function(){return m(yu)},onAboutClick:function(){return m(vu)}}),r.a.createElement(ze.a,{theme:xe.home},y&&r.a.createElement(Js,{open:u===yu,title:"iOS Feature Disabled",message:r.a.createElement(ke.a,{variant:"body2",component:"div"},r.a.createElement("p",null,"This feature cannot function due to a bug in iOS 12 that prevents ",r.a.createElement("strong",null,"direct camera access from progressive web apps"),"."),r.a.createElement("p",null,"There is good evidence iOS 13 has things sorted. ETA from Apple is mid-September 2019.")),onClose:function(){return m(!1)}}),r.a.createElement(fu,{open:u===vu,onClose:function(){return m(!1)}})))},wu=function(e){return r.a.createElement(ze.a,{theme:xe.topbar},r.a.createElement(Eu,e))},xu=a(1042),Ou=a(498),ku=a.n(Ou),Su=Object(je.a)(function(e){return{root:Object(lr.a)({position:"relative",borderRadius:e.shape.borderRadius,backgroundColor:Object(ue.fade)(e.palette.common.white,.3),"&:hover":{backgroundColor:Object(ue.fade)(e.palette.common.white,.5)},marginRight:e.spacing(2),marginLeft:0,width:"100%"},e.breakpoints.up("sm"),{marginLeft:e.spacing(3),width:"auto"}),transparent:{backgroundColor:Object(ue.fade)(e.palette.common.white,.7),"&:hover":{backgroundColor:Object(ue.fade)(e.palette.common.white,.9)}},inputRoot:{color:"inherit",width:"100%"},inputInput:Object(lr.a)({padding:e.spacing(1,1,1,4),transition:e.transitions.create("width"),width:"100%"},e.breakpoints.up("md"),{width:200}),searchIcon:{width:e.spacing(4),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"}}}),ju=function(e){var t=e.autoFocus,a=e.disabled,o=e.onChange,i=e.onClick,l=e.defaultValue,c=e.isTransparent,s=Object(n.useRef)(),u=Su(),m=Object(n.useCallback)(Object(jn.a)(o,500),[o]);return Object(n.useLayoutEffect)(function(){s.current&&!t&&(console.log("Setting blur"),s.current.blur())},[t]),r.a.createElement("div",{className:yr()(u.root,c?u.transparent:null),onClick:i},r.a.createElement("div",{className:u.searchIcon},r.a.createElement(ku.a,null)),r.a.createElement(xu.a,{autoFocus:!a&&t,inputProps:{onBlur:function(){}},onChange:function(e){m(e.target.value)},placeholder:"Search\u2026",disabled:a,defaultValue:l,inputRef:s,classes:{root:u.inputRoot,input:u.inputInput}}))},Cu=Object(je.a)(function(e){return{root:{margin:0,padding:e.spacing(1)},chipContainer:{display:"flex",width:"100%"},grow:{flexGrow:1},accessLabel:{padding:e.spacing(.5,.5)},accessPUBLIC:{color:"white",background:ea.PUBLIC.color[900]},accessPRIVATE:{color:"white",background:ea.PRIVATE.color[900]},accessOPEN:{color:"white",background:ea.OPEN.color[900]},img:{verticalAlign:"top",objectFit:"cover",height:"100%",width:"100%"},text:{height:"115px",margin:0,padding:e.spacing(0,1),alignSelf:"flex-start",display:"flex",flexDirection:"column"},textSm:{height:"75px",margin:0,padding:e.spacing(0,1),alignSelf:"flex-start",display:"flex",flexDirection:"column"},titleText:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},dateContainer:{display:"flex"},dateLabel:{fontWeight:"bold",flex:"1 1 50px"},dateText:{},imgFiller:{flexGrow:1,background:e.palette.text.primary,overflow:"hidden"},imgContainer:{flex:"0 0 115px",alignSelf:"flex-start",height:115,overflow:"hidden",display:"flex",flexDirection:"column"},imgContainerSm:{flex:"0 0 75px",alignSelf:"flex-start",height:75,overflow:"hidden",display:"flex",flexDirection:"column"}}}),Nu=function(e){var t=e.series,a=e.loading,o=e.onClick,i=e.children,l=e.showCreatedOn,c=e.showLastPhoto,s=e.small,u=Cu();if(a||!t)return"LOADING...";var m=Object(n.useContext)(Oe).getPhotoUrls,d=ea.PRIVATE.label;return d=t.access?ea[t.access].label:ea.PRIVATE.label,r.a.createElement(Go.a,{className:u.root,button:!0,component:"div",disableGutters:!0},r.a.createElement("div",{className:s?u.imgContainerSm:u.imgContainer,onClick:o},r.a.createElement("div",{className:u.imgFiller},r.a.createElement(nl,{photo:t.featured,sizePriority:["thumb","medium","large"],getPhotoUrls:m,className:u.img})),t.access&&r.a.createElement(ke.a,{className:yr()(u.accessLabel,u["access".concat(t.access)]),variant:"caption",component:"div"},"".concat(t.photoCount||0," Photos"),!s&&r.a.createElement("em",null,"(",d,")"))),r.a.createElement(Fo.a,{className:s?u.textSm:u.text,disableTypography:!0,onClick:o},r.a.createElement(ke.a,{variant:"body1",component:"div",className:u.titleText},t.name||a),r.a.createElement(ke.a,{variant:"body2",component:"div"},r.a.createElement("strong",null,"Created by:")," ",t.createdUser.username),r.a.createElement("div",{className:u.grow}),l&&r.a.createElement("div",{className:u.dateContainer},r.a.createElement(ke.a,{variant:"caption",className:u.dateLabel},"Created:"),r.a.createElement(ke.a,{variant:"caption",className:u.dateText},Object(si.d)(t.createdOn,"lll"))),c&&t.latest&&r.a.createElement("div",{className:u.dateContainer},r.a.createElement(ke.a,{variant:"caption",className:u.dateLabel},"Last Photo:"),r.a.createElement(ke.a,{variant:"caption",className:u.dateText},Object(si.d)(t.latest.takenOn,"lll")))),i)},Tu=Nu,Iu=a(499),Pu=a.n(Iu),zu=a(500),Au=a.n(zu),_u=Object(je.a)(function(e){return{root:{},listItemText:{textAlign:"center"},iconButton:{background:e.palette.grey[200]},compoundButton:{textAlign:"center"}}}),Ru=function(e){var t=e.seriesCount,a=e.reducedPhotoCount,n=e.onZoomTo,o=e.onViewList,i=(e.onClose,_u());return console.log("cluster selected",{seriesCount:t,reducedPhotoCount:a}),r.a.createElement(Wo.a,null,r.a.createElement(Go.a,{className:i.root},r.a.createElement(Lo.a,null,r.a.createElement("div",{className:i.compoundButton},r.a.createElement(oo.a,{onClick:n,className:i.iconButton},r.a.createElement(Pu.a,null)),r.a.createElement(ke.a,{variant:"caption",component:"div"},"Zoom In"))),r.a.createElement(Fo.a,{className:i.listItemText,onClick:n,primary:"".concat(t," Photo series"),secondary:"containing ".concat(a," individual photo").concat(1===a?"":"s")}),r.a.createElement(Lo.a,null,r.a.createElement("div",{className:i.compoundButton},r.a.createElement(oo.a,{onClick:o,className:i.iconButton},r.a.createElement(Au.a,null)),r.a.createElement(ke.a,{variant:"caption",component:"div"},"List")))))},Mu=Object(je.a)(function(e){return{root:{},title:{background:e.palette.primary.main,color:e.palette.primary.contrastText,alignSelf:"flex-start",width:"100%",margin:0,display:"flex",padding:e.spacing(2)},dlgTitle:{flexGrow:1},closeButton:{padding:0,alignSelf:"flex-start"},list:{overflowX:"hidden",overflowY:"scroll"}}}),Du=function(e){var t=e.title,a=e.seriesList,n=e.onSelect,o=e.onClose,i=e.open,l=Mu();return r.a.createElement(qe.a,{className:l.root,fullWidth:!0,open:i,onClose:o,maxWidth:"xl","aria-labelledby":"confirmation-dialog-title"},r.a.createElement(Qe.a,{className:l.title,disableTypography:!0},r.a.createElement(ke.a,{className:l.dlgTitle},t),r.a.createElement(oo.a,{color:"inherit",className:l.closeButton,onClick:o},r.a.createElement(ii.a,{color:"inherit"}))),r.a.createElement(Wo.a,{className:l.list,dense:!0,disablePadding:!0},a.map(function(e){return r.a.createElement(Tu,{key:"series".concat(e.id),series:e,small:!0,onClick:function(){return n(e.id)}})})))},Lu=Object(je.a)(function(e){return{root:{color:e.palette.primary.main,width:150,position:"absolute",top:"50%",left:"50%",textAlign:"center",transformOrigin:"50% 50%",transform:"translateY(-50%) translateX(-50%)"},rootActive:{zIndex:60},icon:{},avatar:{position:"relative",margin:"0 auto",background:"green",color:"white",border:"2px solid white",height:40,width:40,zIndex:61,"&.PUBLIC":{background:ea.PUBLIC.color},"&.PRIVATE":{background:ea.PRIVATE.color},"&.OPEN":{background:ea.OPEN.color}},avatarActive:{background:"#FFFF00",color:"black",border:"2px solid black","&.PUBLIC":{background:"#FFFF00"},"&.PRIVATE":{background:"#FFFF00"},"&.OPEN":{background:"#FFFF00"}},badge:{zIndex:62,color:e.palette.secondary.contrastText,background:e.palette.secondary.main,transform:"scale(1) translate(30%, -30%)"},badgeActive:{color:e.palette.primary.contrastText,background:e.palette.primary.main},directionIndicator:{position:"absolute",top:20,left:"50%",zIndex:59},name:{color:"white",fontWeight:"bold",textShadow:"\n        0px 0px 4px #000000, \n        0px 0px 4px #000000 \n    ",zIndex:60,position:"relative"},nameActive:{color:"black",textShadow:"\n    0px 0px 2px #FFFFFF, \n    0px 0px 2px #FFFFFF,\n    0px 0px 4px #FFFFFF \n"}}}),Fu=function(e){var t=e.name,a=e.access,n=e.onClick,o=e.active,i=e.photoCount,l=e.direction,c=Lu();return r.a.createElement("div",{className:yr()(c.root,o?c.rootActive:null,a)},r.a.createElement(bi.a,{classes:{badge:yr()(c.badge,o?c.badgeActive:null,a)},badgeContent:i},r.a.createElement(qo.a,{className:yr()(c.avatar,o?c.avatarActive:null,a),onClick:n},r.a.createElement(ns.a,{className:c.icon,color:"inherit"}))),l&&l>=0?r.a.createElement("div",{className:c.directionIndicator},r.a.createElement("svg",{className:c.svgArc,version:"1.1",width:"100",height:"100",viewBox:"0, 0, 100, 100",style:{transform:"translateY(-50%) translateX(-50%) rotateZ(".concat(l,"deg)")}},r.a.createElement("path",{d:"M50,0 C60.946,0.151 72.136,3.514 80.675,10.56 L50,50 L19.325,10.56 C27.938,3.461 39,0.278 50,0 z",fill:"#009DC1",fillOpacity:"0.444",strokeWidth:"1",strokeOpacity:"0.6",stroke:"#FFFFFF"}))):null,r.a.createElement(ke.a,{variant:"body1",className:yr()(c.name,o?c.nameActive:null)},t))},Bu=a(186),Uu=a.n(Bu),Wu=Object(je.a)(function(e){return{avatar:{background:e.palette.grey[900],border:"2px solid ".concat(e.palette.grey[100]),color:e.palette.grey[100]},avatarActive:{background:"#FFFF00",border:"2px solid black",color:"black",zIndex:50}}}),Gu=function(e){var t=e.seriesCount,a=e.active,n=e.onClick,o=Wu();return r.a.createElement(qo.a,{onClick:n,className:yr()(o.avatar,a?o.avatarActive:null)},Uu()(t).format("0,0"))},Hu=Object(je.a)(function(e){return{root:{position:"relative",height:"100%","& .myPosMarker":{zIndex:1},"& .singleMarker":{zIndex:3},"& .clusterMarker":{zIndex:2}},fab:{background:e.palette.secondary.main,color:e.palette.secondary.contrastText},topBar:{position:"absolute",zIndex:100,top:0},loadingWrapper:{position:"absolute",color:e.palette.text.primary,opacity:.5,zIndex:90,textAlign:"center",top:"50%",left:"50%",transform:"translateY(-50%) translateX(-50%)"},zoomOutFab:{margin:e.spacing(.5),padding:e.spacing(.5),border:"2px solid",borderRadius:e.spacing(1),background:e.palette.common.white,fontSize:20,position:"absolute",zIndex:80,bottom:e.spacing(2),right:e.spacing(10)},selectedPopup:{width:"90%",maxWidth:400,zIndex:100,position:"absolute",bottom:e.spacing(1),left:"50%",transformOrigin:"0% 50%",transform:"translateY(0%) translateX(-50%)"}}}),qu={zoom:4,latitude:44.629701,longitude:-120.333379},Qu=function(e){var t=e.seriesList,a=e.initViewport,o=e.loading,i=e.activeSeries,l=e.queryVersion,c=e.onSeriesNavigate,s=e.onSeriesMapSelect,d=e.onSearchClick,p=(e.popMapHistory,e.pushMapHistory),g=(e.clearMapHistory,Object(n.useState)({viewport:Object(u.a)({},qu,a.viewport),bounds:a.bounds,filterBounds:null})),h=Object(We.a)(g,2),f=h[0],b=h[1],y=Hu(),v=Object(n.useRef)(),E=Object(n.useState)(!1),w=Object(We.a)(E,2),x=w[0],O=w[1],k=Object(n.useRef)(),S=Object(n.useState)(0),j=Object(We.a)(S,2),C=j[0],N=j[1],T=Object(n.useState)(!1),I=Object(We.a)(T,2),P=I[0],z=I[1],A=Object(n.useState)(null),_=Object(We.a)(A,2),R=_[0],M=_[1],D=Object(n.useState)(),L=Object(We.a)(D,2),F=L[0],B=L[1],U=Qs(t||[],f.filterBounds,C,f.viewport,80,l,x).filteredClusteredData;Object(n.useEffect)(function(){if(i&&t&&!F)try{var e=t.find(function(e){return e.id===i});if(e&&e.coords){var a=Object(qs.buffer)(Object(qs.point)(e.coords),10,{units:"meters"}),n=Object(qs.bbox)(a);b(Object(u.a)({},f,{bounds:n}))}}catch(r){console.error(r)}},[t]),Object(n.useEffect)(function(){if(i&&U.single&&!F)try{var e=U.single.find(function(e){return e.properties.id===i});e&&k.current&&B(e)}catch(t){console.error(t)}},[U.single]);var W=function(e){B(e),e&&1===e.properties.count?s(e.properties.id):s(),function(e){var t=v.current?v.current:f.viewport,a=(t.transitionDuration,t.transitionInterpolator,t.transitionInterruption,t.maxZoom,t.minZoom,t.maxPitch,t.minPitch,{viewport:Object(m.a)(t,["transitionDuration","transitionInterpolator","transitionInterruption","maxZoom","minZoom","maxPitch","minPitch"])});e?setTimeout(function(){return p(a)},e):p(a)}()},G=function(e){try{var t=Object(qs.featureCollection)(e.properties.points),a=Object(qs.bbox)(t);if(a[0]===a[2]&&a[1]===a[3]){var n=Object(qs.buffer)(Object(qs.point)([a[0],a[1]]),10,{units:"meters"});a=Object(qs.bbox)(n)}var r=.2*(a[2]-a[0]),o=.2*(a[3]-a[1]),i=[a[0]-r,a[1]-o,a[2]+r,a[3]+o];M({transitionDuration:2e3,transitionInterpolator:new Sl.a,transitionEasing:jl.a}),b(Object(u.a)({},f,{bounds:i})),e.properties.count>1&&setTimeout(function(){return W(null)},2e3)}catch(l){console.error(l)}},H=function(e){F&&F.properties.id===e.properties.id?G(F):(M({transitionDuration:500,transitionInterpolator:new Sl.b,transitionEasing:jl.a}),b({viewport:{longitude:e.geometry.coordinates[0],latitude:e.geometry.coordinates[1]}})),W(e)},q=Object(n.useMemo)(function(){return[].concat(Object(ra.a)(U.single.filter(function(e){return!x||F&&F.properties.id===e.properties.id}).map(function(e){return r.a.createElement(Sl.c,{className:"singleMarker",key:"single-".concat(e.properties.id),latitude:e.geometry.coordinates[1],longitude:e.geometry.coordinates[0],offsetLeft:0,offsetTop:-20},r.a.createElement(Fu,{name:e.properties.name,access:e.properties.access,photoCount:e.properties.photoCount,onClick:function(){return H(e)},direction:C>10&&e.properties.direction?e.properties.direction:null,active:F&&F.properties.id===e.properties.id}))})),Object(ra.a)(U.cluster.filter(function(e){return!x||F&&F.properties.id===e.properties.id&&F.properties.count===e.properties.count}).map(function(e){return r.a.createElement(Sl.c,{className:"clusterMarker",key:"cluster-".concat(e.properties.id),latitude:e.geometry.coordinates[1],longitude:e.geometry.coordinates[0],offsetLeft:-20,offsetTop:-20},r.a.createElement(Gu,{seriesCount:e.properties.count,photoCount:e.properties.reducedPhotoCount,onClick:function(){return H(e)},active:F&&F.properties.id===e.properties.id&&F.properties.count===e.properties.count}))})))},[U,F,x]),Q=Object(n.useMemo)(function(){return!!F&&r.a.createElement(wn.a,{className:y.selectedPopup},1===F.properties.count?r.a.createElement(Tu,{series:F.properties,showCreatedOn:!0,showLastPhoto:!0,onClick:function(){return c(F.properties.id)}}):r.a.createElement(Ru,{seriesCount:F.properties.count,reducedPhotoCount:F.properties.reducedPhotoCount,onViewList:function(){return z(!0)},onClose:function(){return W(null)},onZoomTo:function(){return G(F)}}))},[F]);return r.a.createElement("div",{className:y.root,ref:k},r.a.createElement(wu,{isTransparent:!0,className:y.topBar},r.a.createElement(ju,{isTransparent:!0,onClick:d,defaultValue:""})),o&&r.a.createElement("div",{className:y.loadingWrapper},r.a.createElement(Zi.a,{size:80,thickness:7,color:"inherit"})),r.a.createElement(Fl,Object.assign({showMe:!0,viewport:f.viewport,transitions:R,mapStyles:Ht,controlPadding:{top:56},initStyle:Ht.length>1?1:0},{},{onTransitionStart:function(){O(!0)},onTransitionEnd:function(){O(!1),M(null)},bounds:f.bounds,maxZoom:20,minZoom:1,onViewportChange:function(e){var t=e.viewport,a=e.map;v.current=t;var n=Math.floor(t.zoom);if(!x&&a&&a.getBounds){var r=a.getBounds(),o=r._sw,i=o.lng,l=o.lat,c=r._ne,s=c.lng,m=c.lat,d=f.filterBounds||[i,l,s,m],p=Object(We.a)(d,4),g=p[0],h=p[1],y=p[2],E=p[3];if(n!==C||g>=i||h>=l||y<=s||E<=m){var w=[i-(s-i)/2,l-(m-l)/2,s+(s-i)/2,m+(m-l)/2];b(Object(u.a)({},f,{filterBounds:w}))}}n!==C&&N(n)},onNativeClick:function(){F&&W(null)}}),q),F&&F.properties.count>1&&r.a.createElement(Du,{open:P,title:"".concat(F.properties.count," Series"),onClose:function(){return z(!1)},onSelect:c,seriesList:F.properties.points.map(function(e){return e.properties})}),Q)},Yu=20,$u=Object(d.d)(X,{props:function(e){var t=e.data,a=e.ownProps;return console.log("withAllSeries",{data:t,ownProps:a}),!t.loading&&!t.error&&t.allSeries&&t.allSeries.seriesSummaries.length>0&&t.allSeries.nextToken?t.fetchMore({variables:Object(u.a)({},t.variables,{nextToken:t.allSeries.nextToken}),updateQuery:function(e,t){var a=t.fetchMoreResult;return{allSeries:Object(u.a)({},a.allSeries,{seriesSummaries:[].concat(Object(ra.a)(e.allSeries.seriesSummaries),Object(ra.a)(a.allSeries.seriesSummaries))})}}}):t.loading||t.error?a.setSeriesProps(t):(console.log("withAllSeries polling done"),a.setSeriesProps(Object(u.a)({},t,{readyForPolling:!0}))),null},options:{variables:{limit:100}}}),Vu=Object(d.d)(Z,{skip:function(e){var t=e.lastCheck,a=e.online;return!t||!a},props:function(e){var t=e.data,a=e.ownProps,n=a.seriesProps,r=a.updateIncrement;if(t.error?(console.log("POLL FAIL",t.error,t),console.error(t.error)):console.log("withPollQuery",{data:t,seriesProps:n,updateIncrement:r}),!t.loading&&t.changedSeries&&t.changedSeries.seriesSummaries){var o=t.changedSeries.seriesSummaries,i=n.allSeries.seriesSummaries;if(t.changedSeries){var l=n.allSeries.seriesSummaries;o.forEach(function(e){var t=e.seriesStatus,a=Object(m.a)(e,["seriesStatus"]);if("deleted"===t)console.log("Polling found a series to delete: ",a.id),l=i.filter(function(e){return e.id!==a.id});else{var o=i.findIndex(function(e){return e.id===a.id});o>=0?(console.log("Polling found a series to Update: ",a.id),l=i.map(function(e,t){return t===o?a:e})):(console.log("Polling found a series to add: ",a.id),l=[].concat(Object(ra.a)(i),[a]))}n.updateQuery(function(e,t){try{return Object(u.a)({},e).allSeries.seriesSummaries=l,r(),e}catch(a){return console.error(a),e}})})}}return null},options:function(e){return{variables:{limit:100,lastCheck:e.lastCheck}}}}),Xu=$u(function(){return null}),Zu=Vu(function(){return null}),Ju=Object(Ge.b)(function(e,t){return{activeSeries:e.home.current.activeSeries,initViewport:e.map.slice(-1).pop()}},function(e){return{mapFuncs:{onSeriesNavigate:function(t){e(qn(Zt.AppStateTypes.SERIES,{activeSeries:t}))},onSeriesMapSelect:function(t){e(Yn(t))},onSearchClick:function(){e(qn(Zt.AppStateTypes.SEARCH,{search:{tab:Zt.SEARCH_TABS.LOCATION,text:""}}))},popMapHistory:function(){e(Zn())},pushMapHistory:function(t){e(Jn(t))},clearMapHistory:function(){e(Kn())}}}})(function(e){var t=e.initViewport,a=e.activeSeries,o=e.mapFuncs,i=Object(n.useState)(),l=Object(We.a)(i,2),c=l[0],s=l[1],u=Object(n.useState)(0),m=Object(We.a)(u,2),d=m[0],p=m[1],g=function(){return p(d+1)},h=Object(n.useRef)(),f=Object(n.useState)(0),b=Object(We.a)(f,2),y=b[0],v=b[1];h.current=y;var E=Object(n.useMemo)(function(){return r.a.createElement(Xu,{setSeriesProps:s})},[]),w=Object(n.useMemo)(function(){return r.a.createElement(Zu,{lastCheck:y,seriesProps:c,updateIncrement:g})},[y]);return console.log("withPollQuery (PARENT)",{lastCheck:y,seriesProps:c,updateIncrement:g}),Object(n.useEffect)(function(){if(c)return!h.current&&c.readyForPolling&&(h.current=setInterval(function(){h.current&&v(String(Date.now()-1e3*Yu))},1e3*Yu)),function(){h.current&&(console.log("clear poll timer"),clearInterval(h.current),h.current=null)}},[c]),r.a.createElement(r.a.Fragment,null,E,w,r.a.createElement(Qu,Object.assign({queryVersion:d,seriesList:c&&c.allSeries?c.allSeries.seriesSummaries:[],activeSeries:a,initViewport:t,loading:c&&c.loading},o)))}),Ku=a(257),em=a.n(Ku),tm=Object(je.a)(function(e){return{root:{minHeight:60},chosenItem:{color:e.palette.primary.contrastText,background:e.palette.primary.dark},avatar:{background:e.palette.primary.main},closeIcon:{color:e.palette.primary.contrastText,paddingRight:0},avatarImg:{height:"100%",width:"100%",objectFit:"cover"}}}),am=function(e){var t,a=e.className,n=e.variant,o=e.name,i=e.description,l=e.gravatar,c=e.onClick,s=e.onCancel,u=tm(),m=xo.a;switch(n){case"tag":m=vi.a;break;case"location":m=xo.a;break;case"user":m=l?(t=l,function(){return r.a.createElement(qo.a,{className:u.avatar},r.a.createElement("img",{className:u.avatarImg,alt:"profile",src:t}))}):em.a}return r.a.createElement(Go.a,{className:yr()(a,u.root,s?u.chosenItem:null),button:!!c,onClick:c},r.a.createElement(Ho.a,null,r.a.createElement(qo.a,{className:u.avatar},r.a.createElement(m,{color:"inherit"}))),r.a.createElement(Fo.a,{disableTypography:!0},r.a.createElement(ke.a,{variant:"body1",color:"inherit"},o),r.a.createElement(ke.a,{variant:"body2",color:"inherit"},i)),s&&r.a.createElement(Lo.a,null,r.a.createElement(oo.a,{onClick:s,className:u.closeIcon},r.a.createElement(Vo.a,{color:"inherit"}))))},nm=am,rm=Object(je.a)(function(e){return{root:{height:"100%",backgroundColor:e.palette.background.paper,position:"relative",overflowX:"hidden",overflowY:"scroll",flexGrow:1},listSection:{backgroundColor:"inherit"},placeholderText:{textAlign:"center",padding:e.spacing(3,1),color:e.palette.grey[400]},ul:{backgroundColor:"inherit",padding:0}}}),om=function(e){var t=e.variant,a=e.loading,n=e.contextResults,o=e.setContextChoice,i=rm();return a?r.a.createElement(ke.a,{className:i.placeholderText,variant:"h3"},"Searching..."):n&&0!==n.length?r.a.createElement(Wo.a,{className:i.root},n.map(function(e,a){return r.a.createElement(nm,Object.assign({key:"scr-".concat(a),variant:t,onClick:function(){return o(e)}},e))})):r.a.createElement(ke.a,{className:i.placeholderText,variant:"h4"},"No ",t," results")},im=Object(je.a)(function(e){return{root:{textAlign:"center",fontStyle:"italic",padding:e.spacing(2,1)}}}),lm=function(e){var t=e.style,a=e.icon,n=e.text,o=im();return r.a.createElement(ke.a,{className:o.root,variant:"subtitle1",color:"textSecondary",component:"div",style:t},a,n)},cm=Object(je.a)(function(e){return{root:{height:"100%",flexGrow:1,display:"flex",flexDirection:"column",overflow:"hidden"},ctxItem:{flexGrow:0},list:{flexGrow:1,backgroundColor:e.palette.background.paper,position:"relative",overflowX:"hidden",overflowY:"scroll"},placeholderText:{textAlign:"center",padding:e.spacing(3,1),color:e.palette.grey[400]},listSection:{backgroundColor:"inherit"},ul:{backgroundColor:"inherit",padding:0}}}),sm=function(e){var t=e.variant,a=e.loading,o=e.seriesList,i=e.contextChoice,l=e.onCancel,c=e.onResultClick,s=e.fetchMore,u=cm(),m=Object(n.useRef)(),d=Object(n.useRef)(),p=Object(jn.a)(function(){if(!a&&s&&d.current&&m.current){var e=d.current.offsetTop,t=m.current,n=t.scrollTop,r=t.offsetHeight;e<2*(r+n)&&(console.log("SCROLL",{offsetHeight:r,scrollTop:n,offsetTop:e}),s())}},500);Object(n.useEffect)(p,[o]);var g=null;return a?g=r.a.createElement(ke.a,{className:u.placeholderText,variant:"h3"},"Searching..."):o&&o.length>0?(g=o.map(function(e,t){return r.a.createElement(Tu,{key:"series-".concat(t),series:e,onClick:function(){return c(e.id)},showCreatedOn:!0,showLastPhoto:!0})})).push(r.a.createElement("div",{key:"ender",ref:d},r.a.createElement(lm,{text:s?"Loading...":"No More Results"}))):g=r.a.createElement(ke.a,{className:u.placeholderText,variant:"h4"},"No series found"),r.a.createElement("div",{className:u.root},r.a.createElement(nm,Object.assign({className:u.ctxItem},i,{variant:t,onCancel:l})),r.a.createElement(Wo.a,{className:u.list,subheader:r.a.createElement("li",null),onScroll:p,innerRef:m},g))},um=Object(je.a)(function(e){return{root:{flexGrow:1,padding:"10%",display:"flex",flexDirection:"column",opacity:.3,textAlign:"center"},icon:{width:"100%",flex:"1 1 40%",color:e.palette.primary.light,opacity:.5},primary:{flex:"1 1 30%",width:"100%"},secondary:{flex:"1 1 30%",width:"100%"}}}),mm=function(e){var t=e.icon,a=e.primary,n=e.secondary,o=um(),i=t;return r.a.createElement("div",{className:o.root},r.a.createElement(i,{className:o.icon}),a&&r.a.createElement(ke.a,{className:o.primary,variant:"h3"},a),n&&r.a.createElement(ke.a,{className:o.secondary,variant:"h4"},n))},dm=a(501),pm=a.n(dm),gm=Zt.SEARCH_TABS,hm=Object(je.a)(function(e){return{root:{height:"100%",display:"flex",overflow:"hidden",flexDirection:"column"},tabs:{},ListWrapper:{flexGrow:1,overflow:"hidden",display:"flex",flexDirection:"column"},tab:{flexGrow:1},grow:{flexGrow:1}}}),fm=function(e){e.onMenuBack;var t=e.currentTab,a=e.setCurrentTab,o=e.defaultText,i=e.searchText,l=e.setSearchText,c=e.contextResults,s=e.searchResults,u=e.contextChoice,m=e.loading,d=e.setContextChoice,p=e.onMapClick,g=e.onResultClick,h=e.fetchMore,f=hm(),b=Sn().online;Object(n.useEffect)(function(){c&&!s&&1===c.length&&d(c[0])},[c]);var y={};switch(t){case gm.TAG:y={primary:"Tag search",secondary:"example: 'beaver...'",icon:vi.a};break;case gm.USER:y={primary:"User search",secondary:"example: 'SuperGreg123...'",icon:em.a};break;case gm.LOCATION:y={primary:"Location Search",secondary:"example: 'Vancouver...'",icon:xo.a}}var v=null;return v=b?u&&s?r.a.createElement(sm,{variant:t,loading:m,onResultClick:g,fetchMore:h,seriesList:s,contextChoice:u,onCancel:function(){return d(null)}}):c?r.a.createElement(om,{loading:m,variant:t,contextResults:c,setContextChoice:t===gm.LOCATION?p:d}):o.length>0?r.a.createElement(ke.a,null,"Searching for ","'".concat(i,"'")||"..."):r.a.createElement(mm,y):r.a.createElement(mm,{primary:"Search Disabled",secondary:"(Offline)",icon:pm.a}),r.a.createElement("div",{className:f.root},r.a.createElement(wu,null,r.a.createElement(ju,{disabled:!b,onChange:l,defaultValue:i})),b&&r.a.createElement(io.a,{value:t,disabled:!b,onChange:function(e,t){return a(t)},indicatorColor:"primary",classes:{flexContainer:f.tabs},centered:!0},r.a.createElement(lo.a,{className:f.tab,value:gm.TAG,label:"Tags"}),r.a.createElement(lo.a,{className:f.tab,value:gm.LOCATION,label:"Places"}),r.a.createElement(lo.a,{className:f.tab,value:gm.USER,label:"Users"})),r.a.createElement("div",{className:f.ListWrapper},v))};fm.defaultProps={currentTab:gm.TAGS,defaultText:""};var bm=fm,ym=Object(d.d)(te,{props:function(e){var t=e.data;t.error&&console.error(t.error);var a=null;try{t.loading||t.error||(a=t.series)}catch(n){console.error(t),console.error(n)}return{contextResults:t.tags?t.tags.map(function(e){var t=e.name,a=e.count;return{name:t,description:"~ ".concat(a<10?a:10*Math.ceil(a/10)," Photo series tagged")}}):[],loading:t.loading,series:a}},options:function(e){var t=e.searchText;return{variables:{tag:!t||t.length<3?"":t,limit:10}}}}),vm=Object(d.d)(ie,{props:function(e){var t=e.data;t.error&&console.error(t.error);var a=null;try{t.loading||t.error||(a=t.series)}catch(n){console.error(t),console.error(n)}return{contextResults:t.userSearch?t.userSearch.map(function(e){var t=e.username,a=e.gravatar,n=e.createdOn;return{name:t,id:e.id,description:"Joined ".concat(Object(si.c)(n)),gravatar:a}}):[],loading:t.loading,series:a}},skip:function(e){var t=e.searchText;return!t||t.length<3},options:function(e){return{variables:{searchStr:e.searchText,limit:10}}}}),Em=Object(d.d)(re,{props:function(e){var t=e.data;t.error&&console.error(t.error);var a=null;try{t.loading||t.error||(a=t.series)}catch(n){console.error(t),console.error(n)}return{contextResults:t.geocoder?t.geocoder.map(function(e){var t=e.relevance;return{name:e.text,description:e.placeName,bbox:e.bbox,center:e.center,relevance:t}}):[],loading:t.loading,series:a}},skip:function(e){var t=e.searchText;return!t||t.length<3},options:function(e){return{variables:{search:e.searchText}}}}),wm=Object(d.d)(ee,{props:function(e){var t=e.data;t.error&&console.error(t.error);var a=null;try{t.loading||t.error||(a=t.series)}catch(r){console.error(t),console.error(r)}var n=!t.loading&&t.tagSeries&&t.tagSeries.nextToken?function(){console.log("fetchMore",t),t.fetchMore({variables:Object(u.a)({},t.variables,{nextToken:t.tagSeries.nextToken}),updateQuery:function(e,t){var a=t.fetchMoreResult;return{tagSeries:Object(u.a)({},a.tagSeries,{seriesSummaries:[].concat(Object(ra.a)(e.tagSeries.seriesSummaries),Object(ra.a)(a.tagSeries.seriesSummaries)).filter(function(e){return"deleted"!==e.seriesStatus})})}}})}:null;return{searchResults:t.tagSeries&&t.tagSeries.seriesSummaries?t.tagSeries.seriesSummaries:[],fetchMore:n,loading:t.loading,series:a}},skip:function(e){return!e.contextChoice},options:function(e){return{variables:{tag:e.contextChoice.name,limit:10}}}}),xm=Object(d.d)(J,{props:function(e){var t=e.data;t.error&&console.error(t.error);var a=null;try{t.loading||t.error||(a=t.series)}catch(r){console.error(t),console.error(r)}var n=!t.loading&&t.userSeries&&t.userSeries.nextToken?function(){console.log("fetchMore",t),t.fetchMore({variables:Object(u.a)({},t.variables,{nextToken:t.userSeries.nextToken}),updateQuery:function(e,t){var a=t.fetchMoreResult;return{userSeries:Object(u.a)({},a.userSeries,{seriesSummaries:[].concat(Object(ra.a)(e.userSeries.seriesSummaries),Object(ra.a)(a.userSeries.seriesSummaries)).filter(function(e){return"deleted"!==e.seriesStatus})})}}})}:null;return{searchResults:t.userSeries&&t.userSeries.seriesSummaries?t.userSeries.seriesSummaries:[],fetchMore:n,loading:t.loading,series:a}},skip:function(e){return!e.contextChoice},options:function(e){return{variables:{createdBy:e.contextChoice.id,limit:10}}}}),Om=Object(Ge.b)(function(e,t){var a=e.home.current,n=a.search,r=a.activeSeries,o=a.domain;return{defaultTab:n?n.tab:null,defaultText:n?n.text:null,activeSeries:r,domain:o}},function(e){return{onBack:function(){e(Qn())},jumpToSeries:function(t){e(qn(Zt.AppStateTypes.SERIES,{activeSeries:t}))},jumpToMap:function(t){var a=t.bbox,n=t.center,r=a;if(!r&&n){var o=Object(qs.buffer)(Object(qs.point)(n),500,{units:"meters"});r=Object(qs.bbox)(o)}r&&(e(Jn({mode:Zt.MapModeTypes.FREE,bounds:r})),e(qn(Zt.AppStateTypes.MAP,{activeSeries:null,initialPhoto:null})))}}})(function(e){var t=e.jumpToMap,a=e.jumpToSeries,o=e.defaultTab,i=e.defaultText,l=e.fetchMore,c=Object(n.useState)(o||Zt.SEARCH_TABS.TAG),s=Object(We.a)(c,2),u=s[0],m=s[1],p=Object(n.useState)(i||""),g=Object(We.a)(p,2),h=g[0],f=g[1],b=Object(n.useState)(null),y=Object(We.a)(b,2),v=y[0],E=y[1],w=null,x=null;switch(u){case Zt.SEARCH_TABS.TAG:w=ym,x=wm;break;case Zt.SEARCH_TABS.LOCATION:w=Em;break;case Zt.SEARCH_TABS.USER:w=vm,x=xm}var O=Object(n.useMemo)(function(){return x?Object(d.c)(w,x)(bm):w(bm)},[w,x]);return r.a.createElement(O,Object.assign({currentTab:u,searchText:h,contextChoice:v},{onMenuBack:function(){},onMapClick:t,onResultClick:a,setContextChoice:function(e){E(e)},fetchMore:l,setCurrentTab:function(e){E(null),m(e)},setSearchText:function(e){f(e),E(null)}}))}),km=Object(je.a)(function(e){return{root:{},imgContainer:{flex:"0 0 100px",margin:e.spacing(1,1,0,2)},gravatarImg:{verticalAlign:"top"}}}),Sm=function(e){var t=e.user,a=e.loading,n=e.onAvatarClick,o=km();return a||!t?"LOADING...":r.a.createElement(Go.a,{className:o.root,onClick:n,disableGutters:!0},r.a.createElement(Lo.a,{className:o.imgContainer},r.a.createElement("img",{alt:"profile",className:o.gravatarImg,src:t.gravatar})),r.a.createElement(Fo.a,{primary:t.username,secondary:"Member since: ".concat(Object(si.d)(t.createdOn,"LL"))}))},jm=Object(je.a)(function(e){return{root:{background:e.palette.background.paper,display:"flex",flexDirection:"column",height:"100%"},filterContainer:{color:e.palette.primary.secondary,background:e.palette.background.default,textAlign:"center",padding:e.spacing(1,1)},filterChip:{},seriesListItemWrap:{margin:e.spacing(1,.5)},seriesList:{height:"100%",overflowX:"hidden",overflowY:"scroll"},tabs:{},noneFound:{color:e.palette.text.secondary,textAlign:"center",padding:e.spacing(2)}}}),Cm="Last Photo",Nm="Created",Tm="Name",Im=function(e){var t=e.mySeries,a=e.watchingSeries,o=e.loading,i=e.jumpToSeries,l=(e.jumpToMap,jm()),c=Object(n.useState)(0),s=Object(We.a)(c,2),u=s[0],m=s[1],d=Object(n.useState)(Cm),p=Object(We.a)(d,2),g=p[0],h=p[1],f=Object(n.useState)(!1),b=Object(We.a)(f,2),y=b[0],v=b[1],E=Object(n.useContext)(Oe).user,w=function(e){e===g?v(!y):h(e)},x=0===u?t:a;switch(x||(x=[]),g){case Cm:y?x.sort(function(e,t){return e.latest.takenOn-t.latest.takenOn}):x.sort(function(e,t){return t.latest.takenOn-e.latest.takenOn});break;case Nm:y?x.sort(function(e,t){return e.createdOn-t.createdOn}):x.sort(function(e,t){return t.createdOn-e.createdOn});break;case Tm:y?x.sort(function(e,t){return e.name<t.name?-1:e.name>t.firstname?1:0}):x.sort(function(e,t){return t.name<e.name?-1:t.name>e.name?1:0})}return r.a.createElement("div",{className:l.root},r.a.createElement(wu,null,r.a.createElement(ke.a,null,"My Profile")),r.a.createElement(Sm,{user:E}),r.a.createElement(io.a,{value:u,onChange:function(e,t){return m(t)},indicatorColor:"primary",centered:!0,classes:{flexContainer:l.tabs}},r.a.createElement(lo.a,{className:l.tab,value:0,label:"My Series"}),r.a.createElement(lo.a,{className:l.tab,value:1,label:"Watching"})),r.a.createElement(Bo.a,null),r.a.createElement("div",{className:l.filterContainer},r.a.createElement(zm,{asc:y,active:g===Tm,onClick:function(){return w(Tm)},label:Tm}),"|",r.a.createElement(zm,{asc:y,active:g===Cm,onClick:function(){return w(Cm)},label:Cm}),"|",r.a.createElement(zm,{asc:y,active:g===Nm,onClick:function(){return w(Nm)},label:Nm})),r.a.createElement(Bo.a,null),r.a.createElement("div",{className:l.seriesList},!o&&(!x||0===x.length)&&r.a.createElement(ke.a,{className:l.noneFound,component:"div"},"No Series Found"),o&&r.a.createElement(ke.a,{className:l.noneFound,component:"div"},"Loading..."),x.map(function(e,t){return r.a.createElement(Tu,{key:"seriesListItem".concat(t),series:e,showCreatedOn:!0,showLastPhoto:!0,onClick:function(){return i(e.id)}})})))},Pm=Object(je.a)(function(e){return{root:{margin:e.spacing(0,1,0,1)}}}),zm=function(e){var t=e.active,a=e.asc,n=e.onClick,o=e.label,i=Pm(),l=!0===a?"\u25b2":"\u25bc";return r.a.createElement(He.a,{size:"small",className:i.root,onClick:n,color:t?"secondary":"inherit"},o,r.a.createElement("span",{style:{opacity:t?1:0}},l))},Am=Object(d.d)(J,{props:function(e){var t=e.data,a=e.ownProps;return{data:Object(u.a)({},a.data,{seriesQ:t})}}}),_m=Object(d.d)(K,{props:function(e){var t=e.data,a=e.ownProps;return{data:Object(u.a)({},a.data,{watchedSeriesQ:t})}},skip:function(e){e.data;var t=e.user;try{return t.watching.length<1}catch(a){return!0}},options:function(e){e.data;return{variables:{seriesList:e.user.watching}}}}),Rm=Object(d.c)(Am,_m)(function(e){var t=e.data,a=e.jumpToSeries,n=e.jumpToMap,o=t.seriesQ,i=t.watchedSeriesQ,l=o&&o.userSeries&&o.userSeries.seriesSummaries&&o.userSeries.seriesSummaries.filter(function(e){return"deleted"!==e.seriesStatus})||[],c=i&&i.arraySeries?i.arraySeries:[],s=Boolean(o&&o.loading||i&&i.loading);return r.a.createElement(Im,{loading:s,mySeries:l,watchingSeries:c,jumpToSeries:a,jumpToMap:n})}),Mm=Object(Ge.b)(function(e,t){return{}},function(e){return{jumpToSeries:function(t){e(qn(Zt.AppStateTypes.SERIES,{activeSeries:t}))},jumpToMap:function(t){e(qn(Zt.AppStateTypes.MAP,{activeSeries:t}))}}})(Rm),Dm=a(517),Lm=Object(je.a)(function(e){return{root:{display:"flex",alignItems:"center"},grow:{flexGrow:1},text:{textAlign:"center",fontStyle:"italic",padding:e.spacing(2,1)}}}),Fm=function(e){var t=e.style,a=e.icon,n=e.text,o=Lm();return r.a.createElement("div",{className:o.root},r.a.createElement("div",{className:o.grow}),a,r.a.createElement(ke.a,{className:o.text,variant:"subtitle1",color:"textSecondary",component:"div",style:t},n),r.a.createElement("div",{className:o.grow}))},Bm=Object(je.a)(function(e){return{root:{textAlign:"center"},placeAvatar:{color:e.palette.primary.contrastText,border:"2px solid ".concat(e.palette.primary.contrastText),background:e.palette.text.primary,margin:"auto"},placeIcon:{}}}),Um=function(e){var t=e.onClick,a=Bm();return r.a.createElement("div",{className:a.root},r.a.createElement(qo.a,{className:a.placeAvatar},r.a.createElement(oo.a,{color:"inherit",onClick:function(e){e.preventDefault(),e.stopPropagation(),t()}},r.a.createElement(xo.a,{color:"inherit"}))))},Wm=Object(je.a)(function(e){return{root:{height:"100%",padding:e.spacing(.5,1)},imgContainer:{overflow:"hidden",height:"100%",position:"relative"},findOnMapButtonContainer:{position:"absolute",opacity:.8,bottom:e.spacing(1),right:e.spacing(1)},titleContainer:{background:"#444444AA",textShadow:"1px 1px 10px black",color:"white",position:"absolute",alignItems:"center",display:"flex",top:0,width:"100%",paddingRight:e.spacing(1)},avatar:{border:"1px solid white",margin:e.spacing(0,1)},title:{flex:"1 1 50%",overflow:"hidden"},seriesName:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},img:{},gravatarImg:{width:"100%"}}}),Gm="Added",Hm=function(e){var t=e.event,a=e.onMapClick,o=e.onImageClick,i=e.onProfileClick,l=(e.onSeriesClick,t.series),c=t.photo,s=Wm(),u=Object(n.useContext)(Oe).getPhotoUrls;return r.a.createElement("div",{className:s.root},r.a.createElement(wn.a,{className:s.imgContainer},r.a.createElement(nl,{photo:c,sizePriority:["medium","large","thumb"],cover:!0,className:s.img,onClick:function(){return o(l.id,c.id)},getPhotoUrls:u}),r.a.createElement("div",{className:s.titleContainer},r.a.createElement(qo.a,{onClick:function(){return i(c.createdUser.username)},className:s.avatar},r.a.createElement("img",{alt:"profile",className:s.gravatarImg,src:c.createdUser.gravatar})),r.a.createElement("div",{className:s.title},r.a.createElement(ke.a,{className:s.seriesName,variant:"body1",color:"inherit"},l.name),r.a.createElement(ke.a,{variant:"body2",color:"inherit"},c.createdUser.username," ",Gm," a photo"),r.a.createElement(ke.a,{variant:"caption",color:"inherit"},Object(si.d)(c.updatedOn))),r.a.createElement(Um,{onClick:function(){return a(l.id,c.id)}}))))},qm=Hm,Qm=Object(je.a)(function(e){return{root:{display:"flex",flexDirection:"column",height:"100%"},listContainer:{flexGrow:1,overflow:"hidden"},vList:{height:"100%",width:"100%"},feedContainer:{flexGrow:1,transform:"translateZ(0)"},grow:{flexGrow:1}}}),Ym=function(e){var t=e.events,a=e.loading,o=e.onMapClick,i=e.onImageClick,l=e.onProfileClick,c=e.onSeriesClick,s=(e.fetchNewest,e.fetchMore),u=e.window,m=Qm(),d=Object(n.useRef)(),p=Ci(d).size,g=Sn().online;return r.a.createElement("div",{className:m.root},r.a.createElement(wu,null,r.a.createElement(ke.a,{className:m.grow},"Home Feed")),r.a.createElement("div",{className:m.listContainer,ref:d},r.a.createElement(Dm.a,{height:p.height,width:p.width,className:m.vList,rowCount:t.length+1,rowHeight:300,rowRenderer:function(e){var n,d=e.index,p=(e.isScrolling,e.isVisible,e.key),h=e.parent,f=e.style,b=t[d];if(d<t.length&&b)n=r.a.createElement(qm,{event:t[d],onSeriesClick:c,onImageClick:i,onProfileClick:l,onMapClick:o});else if(d===t.length){var y=u&&0===u[0];n=r.a.createElement(Fm,{icon:r.a.createElement(Zi.a,{size:30,thickness:2,color:"inherit"}),text:"Loading..."});var v=1200+h.state.scrollTop>f.top;g?y?n=r.a.createElement(Fm,{text:"End of feed"}):!a&&v&&s():n=r.a.createElement(Fm,{icon:r.a.createElement(et.a,null),text:"Cannot Refresh Offline"})}return r.a.createElement("div",{className:m.row,key:p,style:f},n)}})))},$m=20,Vm=Object(d.d)(oe,{props:function(e){var t=e.data;t.error&&console.error(t.error);var a=!1,n=!1;return{data:t,loadingNewest:a,loadingMore:n,fetchNewest:function(){a=!0,console.log("fetchNewest",t),t.myFeed&&(console.log("DEBUG fetchNewest1",Object(u.a)({},t.variables,{start:t.myFeed.window[1]})),t.fetchMore({variables:Object(u.a)({},t.variables,{start:t.myFeed.window[1]}),updateQuery:function(e,t){var n=t.fetchMoreResult;return console.log("DEBUG fetchNewest2",{prev:e,fetchMoreResult:n}),a=!1,{myFeed:Object(u.a)({},n.myFeed,{feed:[].concat(Object(ra.a)(n.myFeed.feed),Object(ra.a)(e.myFeed.feed)),window:[e.myFeed.window[0],n.myFeed.window[1]]})}}}))},fetchMore:function(){n=!0,console.log("fetchMore",t),t.myFeed&&t.fetchMore({variables:Object(u.a)({},t.variables,{end:t.myFeed.window[0]}),updateQuery:function(e,t){var a=t.fetchMoreResult;return n=!1,{myFeed:Object(u.a)({},a.myFeed,{feed:[].concat(Object(ra.a)(e.myFeed.feed),Object(ra.a)(a.myFeed.feed)),window:[a.myFeed.window[0],e.myFeed.window[1]]})}}})},loading:t.loading}},options:function(e){e.activeSeries;return{variables:{limit:5}}}}),Xm=Object(Ge.b)(function(e,t){return{}},function(e){return{jumpToSeries:function(t,a){e(qn(Zt.AppStateTypes.SERIES,{activeSeries:t,initialPhoto:a}))},jumpToUser:function(t){e(qn(Zt.AppStateTypes.SEARCH,{search:{tab:Zt.SEARCH_TABS.USER,text:t}}))},jumpToMap:function(t,a){e(Jn({mode:Zt.MapModeTypes.FREE})),e(qn(Zt.AppStateTypes.MAP,{activeSeries:t,initialPhoto:a}))}}})(Vm(function(e){var t=e.data,a=e.loading,o=e.fetchMore,i=e.fetchNewest,l=(e.loadingNewest,e.online),c=(e.loadingMore,e.jumpToSeries),s=e.jumpToMap,u=e.jumpToUser,m=Object(n.useRef)(),d=Object(n.useState)(null),p=Object(We.a)(d,2),g=p[0],h=p[1];m.current=g,Object(n.useEffect)(function(){return m.current||(m.current=setInterval(function(){!a&&l&&i(),m.current&&h(String(Date.now()-1e3*$m))},1e3*$m)),function(){m.current&&(console.log("clear poll timer"),clearInterval(m.current),m.current=null)}},[]);var f=t.myFeed&&t.myFeed.feed.filter(function(e){return"deleted"!==e.seriesStatus})||[],b=t.myFeed&&t.myFeed.window.map(function(e){return parseInt(e,10)})||[null,null];return r.a.createElement(Ym,Object.assign({events:f,loading:a,window:b,fetchMore:o,fetchNewest:i,jumpToSeries:c},{onSeriesClick:function(){},onImageClick:c,onProfileClick:u,onMapClick:s}))})),Zm=a(325),Jm=a.n(Zm),Km=a(217),ed=a(1013),td=a(507),ad=a.n(td),nd=a(508),rd=a.n(nd),od=a(509),id=a.n(od),ld=Object(je.a)(function(e){return{root:{height:"100%",display:"flex",overflow:"hidden",flexDirection:"column"},rectContents:{color:e.palette.common.white,textShadow:"5px 6px 6px ".concat(e.palette.common.black),position:"absolute",padding:e.spacing(2),top:"50%",left:"50%",textAlign:"center",transform:"translateY(-50%) translateX(-50%)"},areaLabel:{position:"absolute",top:0,left:0,width:"100%",transform:"translateY(-110%)"},rectContentsDownloading:{textShadow:"none",color:e.palette.primary.contrastText},rectIcon:{position:"absolute",opacity:.4,width:"50%",height:"50%",top:"50%",left:"50%",transform:"translateY(-50%) translateX(-50%)"},tooBig:{color:e.palette.error.contrastText},tickText:{},svgRect:{position:"absolute",top:0,left:0,zIndex:-1,height:"100%",width:"100%"},svgCutout:{stroke:"none",fill:"#00000099"},svgBorder:{fill:"none",stroke:"none"},svgBorderNavigating:{stroke:"#44444499"},svgBorderLocked:{fill:"#66666666",stroke:"#44444499"},svgBorderTooBig:{opacity:.5,fill:e.palette.error.main,stroke:e.palette.error.dark},svgBorderDownloading:{opacity:.7,fill:e.palette.primary.main,stroke:"#44444499"},downloadingProgress:{},downloadingProgressCircle:{margin:e.spacing(2)},snackError:{background:e.palette.primary.main,color:e.palette.primary.contrastText},mapWrapper:{flex:"1 1",overflow:"hidden",position:"relative"}}}),cd="Locked",sd="Offline",ud="Navigating",md="Downloading",dd="Canceled",pd=function(e){var t=e.onMenuBack,a=e.initViewport,o=e.progress,i=e.toolState,l=e.onStartDownload,c=e.onCancel,s=e.onUnlock,u=e.onCancelComplete,m=ld(),d=Object(n.useRef)(),p=Object(n.useState)(null),g=Object(We.a)(p,2),h=g[0],f=g[1],b=Object(n.useState)(null),y=Object(We.a)(b,2),v=y[0],E=y[1],w=Object(n.useState)(null),x=Object(We.a)(w,2),O=x[0],k=x[1],S=O>Zt.Offline.maxMapTileArea,j=function(e){return i?yr()(m[e],m["".concat(e).concat(i)],S?m["".concat(e,"TooBig")]:null):m[e]},C=Object(n.useCallback)(Object(jn.a)(function(e,t,a){var n=e.longitude,r=e.latitude,o=t?Math.abs(t.metersPerPixel[0]*a*t.metersPerPixel[1]*a/1e6):0,i=a/2*t.degreesPerPixel[0],l=a/2*t.degreesPerPixel[1],c=[n-i,r-l,n+i,r+l];o!==O&&k(o),c!==h&&f(c),E(e)},500),[]),N=null,T=function(){},I=null;switch(i){case ud:N=S?null:r.a.createElement(ed.a,{className:m.snack,"aria-describedby":"client-snackbar",message:"Place the square around the area you wish to download for later use",action:[r.a.createElement(He.a,{key:"action1",color:"inherit",disabled:O>Zt.Offline.maxMapTileArea,onClick:function(){return l(h,v)}},"Start Download")]});break;case md:N=r.a.createElement(ed.a,{className:m.snack,"aria-describedby":"client-snackbar",message:"Downloading...",action:[r.a.createElement(He.a,{key:"action1",color:"inherit",onClick:c},"Cancel")]});break;case cd:N=r.a.createElement(ed.a,{className:m.snack,"aria-describedby":"client-snackbar",message:"This is the area you downloaded last",action:[r.a.createElement(He.a,{key:"action1",color:"secondary",onClick:s},"Download a new Area")]});break;case sd:N=r.a.createElement(ed.a,{className:m.snack,"aria-describedby":"client-snackbar",message:"You cannot download content when you are offline."});break;case dd:N=r.a.createElement(ed.a,{className:m.snackError,"aria-describedby":"client-snackbar",message:"Cancelling..."}),T=u,I=2e3}var P=i===ud;return r.a.createElement("div",{className:m.root},r.a.createElement(Se.a,null)," ",r.a.createElement(ro.a,{position:"static",className:m.appBar},r.a.createElement(Ga.a,{disableGutters:!0},r.a.createElement(oo.a,{className:m.menuButton,color:"inherit",onClick:t,"aria-label":"Menu"},r.a.createElement(so.a,null)),r.a.createElement(ke.a,{variant:"subtitle1",color:"inherit",className:m.toolbarTitle},"Offline data manager"))),r.a.createElement("div",{className:m.mapWrapper,ref:d},r.a.createElement(Fl,{hideNavControls:!0,showMe:P,dragPan:P,dragRotate:!1,scrollZoom:P,doubleClickZoom:!1,touchZoom:P,touchRotate:!1,viewport:a},function(e,t,a,n){var c=.6*Math.min(t,a),s={height:c,width:c},u={x:a/2-c/2,y:t/2-c/2},d=o.tileTick&&o.seriesTick&&o.seriesPhotoTick?[o.tileTick[0]+o.seriesTick[0]+o.seriesPhotoTick[0],o.tileTick[1]+o.seriesTick[1]+o.seriesPhotoTick[1]]:[0,1];return 0===d[1]&&(d[1]=1),C(e,n,c),r.a.createElement("div",{style:{height:t,width:a}},r.a.createElement("div",{className:j("rectContents"),style:s},i!==md&&r.a.createElement(ke.a,{className:yr()(m.areaLabel,S?m.tooBig:null),color:"inherit",variant:"h5",component:"div"},Uu()(O).format("0,0")," km\xb2"),i===ud&&!S&&r.a.createElement(ad.a,{className:m.rectIcon,color:"inherit",onClick:function(){return l(h,v)}}),i===ud&&S?r.a.createElement("div",null,r.a.createElement(ke.a,{color:"inherit",variant:"body1",component:"div"},"> ",Zt.Offline.maxMapTileArea," km\xb2"),r.a.createElement(et.a,{className:m.rectIcon,color:"inherit"}),r.a.createElement(ke.a,{color:"inherit",variant:"body2",component:"div"},"Window too big. Try zooming in.")):null,i===md&&r.a.createElement("div",{className:m.downloadingProgress},r.a.createElement(ke.a,{className:"areaLabel",color:"inherit",variant:"h5"},"Downloading..."),r.a.createElement(Zi.a,{className:m.downloadingProgressCircle,variant:"determinate",size:.4*c,thickness:.013*c,value:Math.floor(100*d[0]/d[1]),color:"inherit"}),o.tileTick&&r.a.createElement(ke.a,{color:"inherit",variant:"body1",component:"div"},"Map Tiles: ",o.tileTick[0]," of ",o.tileTick[1]),o.seriesTick&&r.a.createElement(ke.a,{color:"inherit",variant:"body1",component:"div"},"Series: ",o.seriesTick[0]," of ",o.seriesTick[1]),o.seriesPhotoTick&&r.a.createElement(ke.a,{color:"inherit",variant:"body1",component:"div"},"Series Photos: ",o.seriesPhotoTick[0]," of ",o.seriesPhotoTick[1])),i===cd&&r.a.createElement("div",null,r.a.createElement(rd.a,{className:m.rectIcon,color:"inherit"})),i===sd&&r.a.createElement("div",null,r.a.createElement(id.a,{className:m.rectIcon,color:"inherit"}))),r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",style:{height:t,width:a}},r.a.createElement("defs",null,r.a.createElement("path",{id:"Triangle",d:"M 16,0 L -8,9 v-18 z",fill:"black",stroke:"none"})),r.a.createElement("g",{fillRule:"evenodd",className:j("svgCutout")},r.a.createElement("path",{d:"\n                            M 0 0 L ".concat(a," ",0," L ").concat(a," ").concat(t,"  L ",0," ").concat(t," Z\n                             M ").concat(u.x," ").concat(u.y," \n                             L ").concat(a-u.x," ").concat(u.y,"\n                             L ").concat(a-u.x," ").concat(t-u.y," \n                             L ").concat(u.x," ").concat(t-u.y," Z\n                             ")})),r.a.createElement("g",{fillRule:"evenodd",className:j("svgBorder")},r.a.createElement("path",{d:"\n                             M ".concat(u.x," ").concat(u.y," \n                             L ").concat(a-u.x," ").concat(u.y,"\n                             L ").concat(a-u.x," ").concat(t-u.y," \n                             L ").concat(u.x," ").concat(t-u.y," Z\n                             ")}))))}),N&&r.a.createElement(En.a,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:!0,onClose:T,autoHideDuration:I},N)))},gd=Object(d.d)(ae,{props:function(e){var t=e.data,a=e.ownProps;t.error&&console.error(t.error),console.log("OfflineMap::withGeoSearch:: ",{data:t,ownProps:a});try{!t.loading&&!t.error&&t.seriesInGeoBounds&&t.seriesInGeoBounds.seriesSummaries.length>0&&t.seriesInGeoBounds.nextToken?(a.setSeriesIds({ids:[],loading:!0}),t.fetchMore({variables:Object(u.a)({},t.variables,{nextToken:t.seriesInGeoBounds.nextToken}),updateQuery:function(e,t){var a=t.fetchMoreResult;return{seriesInGeoBounds:Object(u.a)({},a.seriesInGeoBounds,{seriesSummaries:[].concat(Object(ra.a)(e.seriesInGeoBounds.seriesSummaries),Object(ra.a)(a.seriesInGeoBounds.seriesSummaries))})}}})):t.loading||t.error?a.setSeriesIds({ids:[],loading:!0}):(console.log("OfflineMap::withGeoSearch::DONE"),t&&t.seriesInGeoBounds&&a.setSeriesIds({ids:t.seriesInGeoBounds.seriesSummaries.map(function(e){return e.id}),loading:!1}))}catch(n){console.error(t),console.error(n)}return{data:t,loading:t.loading}},skip:function(e){return!e.bounds},options:function(e){return{variables:{bounds:e.bounds,limit:100}}}}),hd=Object(d.d)(le,{skip:function(e){return!e.id},props:function(e){var t=e.data,a=e.ownProps;t.error&&console.error(t.error);var n=null;try{if(!t.loading&&!t.error){n=t.series;var r=[];r.push(n.createdUser.gravatar),r.push(n.updatedUser.gravatar),n.photos.forEach(function(e){r.push(e.createdUser.gravatar),r.push(e.updatedUser.gravatar),Zt.Offline.seriesImgsToCache.map(function(t){return r.push("".concat(e.paths.base).concat(e.paths[t]))})}),a.onDone(Object(ra.a)(new Set(r)))}}catch(o){console.log("OfflineMap::withGetSelectedQuery:: error",{data:t,e:o}),console.error(o)}return{data:t,loading:t.loading,series:n}},options:function(e){return{variables:{id:e.id}}}})(function(){return null}),fd=gd(function(){return null}),bd=Object(Ge.b)(function(e,t){var a=e.map.slice(-1).pop(),n=e.offline;return{lastMapViewport:a,completedDownload:n.completedDownload,viewport:n.viewport}},function(e){return{onMenuBack:function(){e(Qn())},setOfflineCompleted:function(t){e(Xn(t))},setOfflineViewport:function(t){e(Vn(t))}}})(function(e){var t=e.onMenuBack,a=e.lastMapViewport,o=e.completedDownload,i=e.viewport,l=e.setOfflineCompleted,c=e.setOfflineViewport,s=Object(n.useState)(i&&o?cd:ud),u=Object(We.a)(s,2),m=u[0],d=u[1],p=Object(n.useRef)(),g=Object(n.useContext)(Oe).online,h=Object(n.useState)(null),f=Object(We.a)(h,2),b=f[0],y=f[1],v=Object(n.useState)(null),E=Object(We.a)(v,2),w=E[0],x=E[1],O=Object(n.useState)(null),k=Object(We.a)(O,2),S=k[0],j=k[1],C=Object(n.useState)([]),N=Object(We.a)(C,2),T=N[0],I=N[1],P=Object(n.useState)([0,0]),z=Object(We.a)(P,2),A=z[0],_=z[1],R=Object(n.useState)([0,0]),M=Object(We.a)(R,2),D=M[0],L=M[1],F=Object(n.useState)([0,0]),B=Object(We.a)(F,2),U=B[0],W=B[1],G=Object(n.useRef)();G.current={tileTick:A,seriesTick:D,seriesPhotoTick:U,seriesIds:w,seriesPhotos:T};var H=function(){return _([G.current.tileTick[0]+1,G.current.tileTick[1]])},q=function(){W([G.current.seriesPhotoTick[0]+1,G.current.seriesPhotoTick[1]])},Q=function(e){var t,a=G.current.seriesTick,n=G.current.seriesIds.ids,r=G.current.seriesPhotos;if(e){var o=0;e.forEach(function(e){-1===r.indexOf(e)&&(o++,I([].concat(Object(ra.a)(r),[e])),p.current.schedule(function(){return yd("GET",e)}).then(q).catch(q))}),t=o,W([G.current.seriesPhotoTick[0],G.current.seriesPhotoTick[1]+t])}a&&n[a[0]]&&(j(n[a[0]+1]),L([a[0]+1,a[1]]))},Y=Object(n.useMemo)(function(){return g?m:sd},[g,m]),$=Object(n.useMemo)(function(){return r.a.createElement(fd,{bounds:b,setSeriesIds:x})},[b]),V=Object(n.useMemo)(function(){return r.a.createElement(hd,{id:S,onDone:Q})},[S]),X=function(){d(dd),y(null),x(null),_([0,0]),L([0,0]),W([0,0]),I([]),p.current.stop({dropWaitingJobs:!0}),p.current=null,p.current=new Jm.a({maxConcurrent:5})};return Object(n.useEffect)(function(){p.current=new Jm.a({maxConcurrent:5})},[]),Object(n.useEffect)(function(){if(b){var e=function(e,t){for(var a=[],n=t[0];n<=t[1];n++)for(var r=Object(Km.long2tile)(e[0],n),o=Object(Km.long2tile)(e[2],n),i=Object(Km.lat2tile)(e[1],n),l=Object(Km.lat2tile)(e[3],n),c=r;c<=o;c++)for(var s=i;s<=l;s++)a.push(vd("https://api.mapbox.com/v4/mapbox.mapbox-terrain-v2,mapbox.mapbox-streets-v7/{z}/{x}/{y}.vector.pbf",n,c,s)),a.push(vd("https://api.mapbox.com/v4/mapbox.satellite/{z}/{x}/{y}@2x.webp",n,c,s));return a}(b,[0,Zt.Offline.highestOfflineTileZoom]),t=e.length;if(0===t)return;a=t,_([G.current.tileTick[0],G.current.tileTick[1]+a]),e.forEach(function(e){p.current.schedule(function(){return yd("GET",e)}).then(H).catch(H)})}var a},[b]),Object(n.useEffect)(function(){w&&w.ids&&(w.ids.length>0&&j(w.ids[0]),L([0,w.ids.length]),W([0,0]))},[w]),Object(n.useEffect)(function(){var e=[A[0]+D[0]+U[0],A[1]+D[1]+U[1]];e[1]>0&&e[0]===e[1]&&(d(cd),l(!0))},[A,D,U]),r.a.createElement(r.a.Fragment,null,V,$,r.a.createElement(pd,{onMenuBack:function(){X(),t()},onStartDownload:function(e,t){d(md),y(e),c(t)},onCancel:X,initViewport:i||a,progress:{tileTick:A,seriesTick:D,seriesPhotoTick:U},toolState:Y,onCancelComplete:function(){d(ud)},onUnlock:function(){d(ud),l(!1)}}))});function yd(e,t){return new Promise(function(a,n){var r=new XMLHttpRequest;r.open(e,t),r.onload=function(){r.status>=200&&r.status<300?a(r.response):n(new Error(r.statusText))},r.onerror=function(){n(new Error(r.statusText))},r.send()})}var vd=function(e,t,a,n){return(e+"?access_token=".concat("pk.eyJ1IjoicmF5Y2hhc2VyIiwiYSI6IlFHWHVMSW8ifQ.emd44Ibp4cmT9YXitY1ziw")).replace("{z}/{x}/{y}","".concat(t,"/").concat(a,"/").concat(n))};var Ed=a(510),wd=a.n(Ed),xd=Object(je.a)(function(e){return{root:{display:"flex",height:"100%",flexDirection:"column"},qrIcon:{border:"5px solid red",padding:e.spacing(2),position:"absolute",color:"white",opacity:.4,zIndex:2,width:"70%",height:"70%",top:"50%",left:"50%",transformOrigin:"50% 50%",transform:"translateY(-50%) translateX(-50%)"},backupText:{position:"absolute",color:"white",textAlign:"center",zIndex:2,width:"70%",height:"70%",top:"50%",left:"50%",transformOrigin:"50% 50%",transform:"translateY(-50%) translateX(-50%)"},manualImg:{position:"absolute",zIndex:1},appBar:{},inner:{padding:e.spacing(2),height:"100%",flexGrow:1,overflow:"hidden"},tipPaper:{padding:e.spacing(2),margin:e.spacing(2)},docContainer:{flexGrow:1,padding:e.spacing(2)},cameraContainer:{width:"80%",margin:"0 auto",position:"relative","&::before":{content:" ",display:"block",paddingTop:"100%"}},cameraContainerError:{background:"black"},snackErr:{background:Qt.a[500],color:"white"},snackSuccess:{background:qt.a[500],color:"white"},snackMsg:{},video:{height:"100%",width:"100%",verticalAlign:"top"}}}),Od=function(e){var t=e.onMenuBack,a=e.onCapture,o=e.isIos,i=xd(),l=Object(n.useState)(),u=Object(We.a)(l,2),m=u[0],d=u[1],p=Object(n.useState)(null),g=Object(We.a)(p,2),h=g[0],f=g[1],b=Object(n.useState)(null),y=Object(We.a)(b,2),v=y[0],E=y[1],w=rs(d,400,400),x=w.cameraError,O=w.captureRawData,k=w.cameraOnline,S=Object(n.useCallback)(Object(jn.a)(O,100),[k,x]);return Object(n.useEffect)(function(){var e=function(){var e=Object(s.a)(c.a.mark(function e(){var t,a,n,r;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=null,e.prev=1,e.next=4,kd(m);case 4:t=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),console.error(e.t0);case 10:if(e.prev=10,!x||t){e.next=13;break}throw new Error("Captured Image does not have a QR code");case 13:if(!t){e.next=23;break}if(a=t.data.indexOf("?fromqr=")+"?fromqr=".length,n=t.data.slice(a),(r=JSON.parse(decodeURI(n))).type&&r.id){e.next=20;break}throw new Error("Type or ID missing from QR Code");case 20:E(r),f(null),console.log("QRCODE",t);case 23:e.next=29;break;case 25:e.prev=25,e.t1=e.catch(10),f("Not a valid QR Code"),console.error(e.t1);case 29:case"end":return e.stop()}},e,null,[[1,7],[10,25]])}));return function(){return e.apply(this,arguments)}}();!k||x||h||v||(m&&m.data?(e(),S()):S())},[k,m,h,v]),r.a.createElement("div",{className:i.root},r.a.createElement(Se.a,null)," ",r.a.createElement(ro.a,{position:"static",className:i.appBar},r.a.createElement(Ga.a,{disableGutters:!0},r.a.createElement(oo.a,{className:i.menuButton,color:"inherit",onClick:t,"aria-label":"Menu"},r.a.createElement(so.a,null)),r.a.createElement(ke.a,{variant:"subtitle1",color:"inherit",className:i.toolbarTitle},"Capture QR Code"))),r.a.createElement("div",{className:i.inner},r.a.createElement(wn.a,{className:yr()(i.cameraContainer,x?i.cameraContainerError:null)},r.a.createElement(Ks,{className:i.qrIcon}),r.a.createElement("video",{autoPlay:!0,playsInline:!0,muted:!0,id:"webcam",className:i.video})),r.a.createElement(wn.a,{className:i.tipPaper},r.a.createElement(ke.a,null,"TIP: You can find the QR code for a series in the SHARE tab of that series"))),r.a.createElement(En.a,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:!!h,autoHideDuration:2e3,onClose:function(){f(null),d(null)}},r.a.createElement(ed.a,{className:i.snackErr,message:r.a.createElement("span",{className:i.snackMsg},h)})),!o&&r.a.createElement(En.a,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:x},r.a.createElement(ed.a,{className:i.snackErr,message:r.a.createElement("span",{className:i.snackMsg},"Camera Error. Check your device's permissions")})),r.a.createElement(En.a,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:!!v,autoHideDuration:500,onClose:function(){return a(v.type,v.s,v.p)}},r.a.createElement(ed.a,{className:i.snackSuccess,message:r.a.createElement("span",{className:i.snackMsg},"Valid QR Code found!")})))},kd=function(e){var t=e.data,a=e.imageHeight,n=e.imageWidth;return new Promise(function(e,r){try{e(wd()(t,n,a))}catch(o){r(o)}})},Sd=a(511),jd=a.n(Sd),Cd=a(512),Nd=a.n(Cd),Td=Object(je.a)(function(e){return{root:{},nuclear:{color:"red"}}}),Id=function(e){var t=e.onMenuBack,a=Td(),o=Object(n.useContext)(Oe),i=o.resetAllState,l=o.resetApp,c=Object(n.useState)(),s=Object(We.a)(c,2),u=s[0],m=s[1];return r.a.createElement("div",{className:a.root},r.a.createElement(Se.a,null)," ",r.a.createElement(ro.a,{position:"static",className:a.appBar},r.a.createElement(Ga.a,{disableGutters:!0},r.a.createElement(oo.a,{className:a.menuButton,color:"inherit",onClick:t,"aria-label":"Menu"},r.a.createElement(so.a,null)),r.a.createElement(ke.a,{variant:"subtitle1",color:"inherit",className:a.toolbarTitle},"Offline data manager"))),r.a.createElement("div",{className:a.mapWrapper},r.a.createElement(Wo.a,null,r.a.createElement(Go.a,{button:!0,onClick:function(){return m({action:i,title:"Reset App State",message:"Might resolve a temporary glitch. Unfortunately this will wipe your upload queue."})}},r.a.createElement(Lo.a,null,r.a.createElement(jd.a,null)),r.a.createElement(Fo.a,{primary:"Reset app state",secondary:"Might resolve a temporary glitch."})),r.a.createElement(Go.a,{button:!0,className:a.nuclear,onClick:function(){return m({action:l,title:"RESET ALL LOCAL DATA",message:"All local images and data will be reset and you will be logged out. BE VERY SURE ABOUT THIS"})}},r.a.createElement(Lo.a,{color:"inherit"},r.a.createElement(Nd.a,{color:"inherit"})),r.a.createElement(Fo.a,{primary:"RESET ALL LOCAL DATA",secondary:"All local images and data will be reset and you will be logged out"})))),u&&r.a.createElement(fl,{open:!!u,title:u&&u.title,message:u&&u.message,onConfirm:function(e){e&&u.action(),m(null)}}))},Pd=a(137),zd=a.n(Pd),Ad=Object(je.a)(function(e){return{root:{background:"black",color:"white",textAlign:"center"}}}),_d=function(){var e=Ad(),t=Object(n.useContext)(Oe),a=t.online,o=t.offlineSince,i=Object(n.useState)(),l=Object(We.a)(i,2),c=l[0],s=l[1],u=Object(n.useRef)(),m=function(){var e=zd()(o,"x").fromNow();s(e)},d=function(){u.current&&(clearInterval(u.current),u.current=null)};return Object(n.useEffect)(function(){return o&&!u.current?(m(),u.current=setInterval(m,5e3)):o||d(),function(){d()}},[o]),a?null:r.a.createElement(ke.a,{className:e.root,variant:"caption",component:"div"},"Offline (",c,")")},Rd=a(513),Md=a.n(Rd),Dd=a(514),Ld=a.n(Dd),Fd=a(515),Bd=a.n(Fd),Ud=a(516),Wd=a.n(Ud),Gd=Zt.AppStateTypes,Hd=Object(je.a)(function(e){return{root:{borderTop:"2px solid ".concat(e.palette.secondary.main)},text:{padding:e.spacing(2,2,0)},paper:{paddingBottom:50},list:{marginBottom:e.spacing(2)},subheader:{backgroundColor:e.palette.background.paper},grow:{flexGrow:1},addFab:{position:"absolute",bottom:0,left:"50%",transformOrigin:"0% 100%",transform:"translateY(-25%) translateX(-50%) translateZ(0)",zIndex:200},spacer:{width:40,flexGrow:1}}}),qd=function(e){var t=e.className,a=e.domain,o=e.signedIn,i=e.onHomeClick,l=e.onMapClick,c=e.onSearchClick,s=e.onProfileClick,u=e.onCameraClick,m=e.onLibraryClick,d=Hd(),p=Object(n.useContext)(Oe).isIos;return r.a.createElement(ro.a,{position:"static",className:yr()(d.root,t)},r.a.createElement(Ga.a,null,o&&r.a.createElement(He.a,{edge:"start",className:d.grow,color:a===Gd.FEED?"secondary":"inherit",onClick:i},r.a.createElement(Md.a,null)),r.a.createElement(He.a,{edge:"start",className:d.grow,color:a===Gd.MAP?"secondary":"inherit",onClick:l},r.a.createElement(Ld.a,null)),o&&r.a.createElement(Ro,{isIos:p,className:d.addFab,onCameraClick:u,onLibraryClick:m},r.a.createElement(dl.a,null)),r.a.createElement("div",{className:d.spacer}),r.a.createElement(He.a,{color:a===Gd.SEARCH?"secondary":"inherit",className:d.grow,onClick:c},r.a.createElement(Bd.a,null)),o&&r.a.createElement(He.a,{edge:"end",color:a===Gd.PROFILE?"secondary":"inherit",className:d.grow,onClick:s},r.a.createElement(Wd.a,null))))},Qd=qd,Yd=(Object(je.a)(function(e){return{root:{height:"100%",display:"flex",flexDirection:"column"},paper:{flexGrow:1}}}),Zt.AppStateTypes),$d=Object(je.a)(function(e){return{outerRoot:{height:"100%",overflow:"hidden"},root:{height:"100%",overflow:"hidden",display:"flex",flexDirection:"column"},offlineBar:{flex:"0 0"},activeWrapper:{overflow:"hidden",flexGrow:1,flexShrink:1,height:"100%"},uploaderContainer:{zIndex:100,flex:"0 0"}}}),Vd=function(e){var t=e.domain,a=e.onQRCapture,o=e.onMenuBack,i=e.setHomeState,l=e.onCameraClick,c=e.onLibraryClick,s=e.children,u=$d(),m=Object(n.useContext)(Oe),d=m.signedIn,p=m.user,g=m.windowSize,h=m.online;Object(n.useEffect)(function(){!d&&[Yd.MAP,Yd.SEARCH,Yd.SERIES,Yd.QRCAPTURE,Yd.SETTINGS,Yd.OFFLINE_DOWNLOAD].indexOf(t)<0&&i(Yd.MAP)},[t]);var f=!0,b={},y=Xm;switch(t){case Yd.FEED:b={online:h},y=Xm;break;case Yd.MAP:b={online:h},y=Ju;break;case Yd.PROFILE:y=Mm,b={user:p,online:h};break;case Yd.SEARCH:y=Om;break;case Yd.SERIES:y=Ws,b={user:p,online:h},f=!1;break;case Yd.NEW_SERIES_CAMERA:b={user:p,online:h},y=Ws,f=!1;break;case Yd.OFFLINE_DOWNLOAD:y=bd,f=!1;break;case Yd.NEW_SERIES_LIBRARY:b={user:p,online:h},y=Ws,f=!1;break;case Yd.QRCAPTURE:y=Od,f=!1,b={onCapture:a,onMenuBack:o};break;case Yd.SETTINGS:y=Id,f=!1,b={onMenuBack:o}}return r.a.createElement("div",{className:u.outerRoot},r.a.createElement("div",{className:u.root,style:{width:g.width,height:g.height}},r.a.createElement(Se.a,null)," ",r.a.createElement(_d,{className:u.offlineBar}),r.a.createElement("div",{className:u.activeWrapper},r.a.createElement(y,b)),f&&r.a.createElement(ze.a,{theme:xe.bottombar},r.a.createElement(Qd,{signedIn:d,domain:t,onHomeClick:function(){return i(Yd.FEED)},onMapClick:function(){return i(Yd.MAP)},onSearchClick:function(){return i(Yd.SEARCH,{search:null})},onProfileClick:function(){return i(Yd.PROFILE)},onCameraClick:l,onLibraryClick:c})),r.a.createElement(zr,{className:u.uploaderContainer}),s))},Xd=Object(d.c)(fr,Object(Ge.b)(function(e,t){return{domain:e.home.current.domain,flags:e.flags}},function(e){return{setHomeState:function(t,a){e(qn(t,a))},onCameraClick:function(){e(qn(Zt.AppStateTypes.NEW_SERIES_CAMERA,{activeSeries:null}))},onLibraryClick:function(){e(qn(Zt.AppStateTypes.NEW_SERIES_LIBRARY,{activeSeries:null}))},onOfflineMenuClick:function(){e(qn(Zt.AppStateTypes.OFFLINE_DOWNLOAD))},onSettingsClick:function(){e(qn(Zt.AppStateTypes.SETTINGS))},resetAllState:function(){e(er())},dismissInstall:function(){e($n("install",!1))},setUseOffline:function(t){e($n("useLoggedOut",t))},onQRClick:function(){e(qn(Zt.AppStateTypes.QRCAPTURE))},onMenuBack:function(){e(Qn())},onAvatarClick:function(t){e(qn(Zt.AppStateTypes.SEARCH,{search:{tab:Zt.SEARCH_TABS.USER,text:t}}))},onQRCapture:function(t,a,n){switch(t){case"series":e(qn(Zt.AppStateTypes.SERIES,{activeSeries:a,initialPhoto:n}))}}}}),function(e){return function(t){var a=t.onQRClick,o=t.onAvatarClick,i=t.resetAllState,l=t.setUseOffline,p=t.onOfflineMenuClick,g=t.dismissInstall,h=t.onSettingsClick,b=t.flags,y=Object(m.a)(t,["onQRClick","onAvatarClick","resetAllState","setUseOffline","onOfflineMenuClick","dismissInstall","onSettingsClick","flags"]),v=sn(b.useLoggedOut,l),E=v.isGod,w=v.signedIn,x=v.authData,O=v.signOut,k=v.authScreen,S=v.forceSignIn,j=Ma(),C=j.client,N=j.done,T=j.currState,I=Sn(),P=I.online,z=I.offlineSince,A=kn(b.install,g),_=A.installPrompt,R=A.addToHomeScreen,M=Nn();if(Object(n.useEffect)(function(){!0===w&&b.useLoggedOut?l(!1):!1!==w||b.useLoggedOut||l(!0)},[w]),Object(n.useEffect)(function(){try{var e=function(e){try{var t=e.indexOf("?fromqr=");if(t<0)return null;var a=e.slice(t+"?fromqr=".length);return JSON.parse(decodeURI(a))}catch(n){console.error(n)}return null}(window.location.search);if(e&&e.type&&e.s){var t=e.type,a=e.s,n=e.p;switch(console.log("REDIRECTING",{type:t,s:a,p:n}),t){case"series":var r={activeSeries:a,initialPhoto:n};w||l(!0),y.setHomeState(Zt.AppStateTypes.SERIES,r)}}}catch(o){console.log("HERE IS AN ERROR",o),console.error(o)}},[]),!N)return r.a.createElement(Re,{message:Ra[T]});if(null===w&&!b.useLoggedOut)return k;var D=Object(u.a)({signOut:O,forceSignIn:function(){l(!1),S()},onOfflineMenuClick:p,getPhotoUrls:function(){var e=Object(s.a)(c.a.mark(function e(t,a){var n;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!t.uploadToken){e.next=10;break}return e.next=4,xa.keys();case 4:if(!(e.sent.indexOf(t.uploadToken)>-1)){e.next=10;break}return e.next=8,xa.getItem(t.uploadToken);case 8:return n=e.sent,e.abrupt("return",[n.dataUrl]);case 10:return e.abrupt("return",a.map(function(e){return"".concat(t.paths.base).concat(t.paths[e])}));case 13:return e.prev=13,e.t0=e.catch(0),e.abrupt("return",null);case 16:case"end":return e.stop()}},e,null,[[0,13]])}));return function(t,a){return e.apply(this,arguments)}}(),isPhone:vn(),isIos:yn(),resetAllState:i,resetApp:function(){xa.clear(),C.resetStore(),Oa.clear(),i(),O()},onAvatarClick:o,online:P,onSettingsClick:h,offlineSince:z},M,{signedIn:Boolean(w),role:w?E?"admin":"user":"nonuser",currentUser:x,onQRClick:a,addToHomeScreen:R});return r.a.createElement(ze.a,{theme:xe.home},r.a.createElement(d.a,{client:C},r.a.createElement(d.b,{query:ne,skip:!w},function(t){var a=t.loading,n=t.error,o=t.data;return a?r.a.createElement(Re,{message:"UserData"}):(n&&console.error(n),w&&(D.user=o.user),r.a.createElement(Oe.Provider,{value:D},r.a.createElement(f,null,r.a.createElement(e,y,_))))})))}},function(e){return function(t){return r.a.createElement(Ue,{fallback:zt},r.a.createElement(e,t))}})(Vd),Zd=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Jd(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}a(944);a(946),console.log("Rendering Main App"),i.a.render(r.a.createElement(Xd,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/photomon_v0",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/photomon_v0","/service-worker.js");Zd?(function(e,t){fetch(e).then(function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):Jd(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):Jd(t,e)})}}(),navigator.serviceWorker.register("imgCacheWorker.js")}},[[534,2,1]]]);
//# sourceMappingURL=main.7ccb8804.chunk.js.map